

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fuk.png">
  <link rel="icon" href="https://img.dkdun.cn/v1/2024/12/83e0272660805f52.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="butt3rf1y">
  <meta name="keywords" content="">
  
    <meta name="description" content="前面的题比较简单就没写 wp，后面的一些题挺有意思的，遂记录">
<meta property="og:type" content="article">
<meta property="og:title" content="2025极客大挑战-Reverse">
<meta property="og:url" content="http://example.com/2025/11/19/2025%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-Reverse/index.html">
<meta property="og:site_name" content="(｡･ω･｡)Welcome~">
<meta property="og:description" content="前面的题比较简单就没写 wp，后面的一些题挺有意思的，遂记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/e3ac3dfec23c01f1.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/e83886f89d9dd454.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/7b7ac42e396467a9.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/fa8f4acdfc577f59.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/5aa60d8ae8d989e0.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/a773a76ba4be3967.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/3084800f3e138e58.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/bf91604ce95e859c.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/ec3a21cc410096e3.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/51ae3701183213f8.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/2d1d77c39898932f.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/01134e5b4c72855e.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/17081ea59ae609c6.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/cb397eb42ac5b853.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/e9da8f11d2d05df8.png">
<meta property="og:image" content="https://img.dkdun.cn/v1/2025/12/aa342d555c83b21e.png">
<meta property="article:published_time" content="2025-11-19T15:37:29.000Z">
<meta property="article:modified_time" content="2025-12-04T14:37:15.729Z">
<meta property="article:author" content="butt3rf1y">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img.dkdun.cn/v1/2025/12/e3ac3dfec23c01f1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>2025极客大挑战-Reverse - (｡･ω･｡)Welcome~</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/glassBg.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":true,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>butt3rf1y&#39;s Space</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="web_bg" style="
  background-image: url('https://img.dkdun.cn/v1/2025/12/250ec4831b1a4577.png');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
"></div>

<div id="banner" class="banner" parallax=true
     style="background: url('https://img.dkdun.cn/v1/2025/12/250ec4831b1a4577.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2025极客大挑战-Reverse"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-19 23:37" pubdate>
          2025年11月19日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          84 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>


</div>

	<link rel="icon" href="https://img.dkdun.cn/v1/2024/12/e40f2f1a8320e35c.png" type="image/x-icon">
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2025极客大挑战-Reverse</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2025年12月4日 晚上
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>前面的题比较简单就没写 wp，后面的一些题挺有意思的，遂记录</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/e3ac3dfec23c01f1.png"></p>
<span id="more"></span>

<h1 id="Mission-Ghost-Signal"><a href="#Mission-Ghost-Signal" class="headerlink" title="Mission Ghost Signal"></a>Mission Ghost Signal</h1><p>本质是 AES-128-CBC 加密，但 S-box、MixColumns 都是自定义的</p>
<p>进入 main 函数分析，输入长度必须 25 字符，IV 固定 1145141145144332”，Key 在 aSyclover2025ge 中就是 Syclover2025Geek，大概是 AES 加密，最后结果与 byte_406020 比较</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/e83886f89d9dd454.png"></p>
<p>byte_406020</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0xB2</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x13</span><br></code></pre></td></tr></table></figure>

<p>sub_402B57：先进入 sub_402B11 异或再进入 sub_402992 加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_402B57</span><span class="hljs-params">(_DWORD *a1, _DWORD *a2, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp+Ch] [ebp-24h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+10h] [ebp-20h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+14h] [ebp-1Ch]</span><br>  _DWORD *v7; <span class="hljs-comment">// [esp+20h] [ebp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+24h] [ebp-Ch]</span><br><br>  v7 = a1 + <span class="hljs-number">44</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a3; i += <span class="hljs-number">16</span> )<br>  &#123;<br>    sub_402B11(a2, v7);<br>    sub_402992(a2, a1);<br>    v7 = a2;<br>    a2 += <span class="hljs-number">4</span>;<br>  &#125;<br>  v4 = v7[<span class="hljs-number">1</span>];<br>  v5 = v7[<span class="hljs-number">2</span>];<br>  v6 = v7[<span class="hljs-number">3</span>];<br>  a1[<span class="hljs-number">44</span>] = *v7;<br>  a1[<span class="hljs-number">45</span>] = v4;<br>  a1[<span class="hljs-number">46</span>] = v5;<br>  result = v6;<br>  a1[<span class="hljs-number">47</span>] = v6;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><br><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_402B11</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> __int8 i; <span class="hljs-comment">// [esp+Fh] [ebp-5h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &gt; <span class="hljs-number">0xF</span>u )<br>      <span class="hljs-keyword">break</span>;<br>    *(_BYTE *)(i + a1) ^= *(_BYTE *)(i + a2);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_402992</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int8 i; <span class="hljs-comment">// [esp+1Bh] [ebp-1h]</span><br><br>  sub_401CA0(<span class="hljs-number">0</span>, a1, a2);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">9u</span>; ++i )<br>  &#123;<br>    sub_401D41(a1);<br>    sub_401DB1(a1);<br>    sub_401EA2(a1);<br>    sub_401CA0(i, a1, a2);<br>  &#125;<br>  sub_401D41(a1);<br>  sub_401DB1(a1);<br>  <span class="hljs-keyword">return</span> sub_401CA0(<span class="hljs-number">10</span>, a1, a2);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>继续跟进 sub_401D41 -&gt; sub_401929 -&gt; sub_4018B6 -&gt; sub_4017B8 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">sub_4017B8</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> __int8 a1)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [esp+10h] [ebp-1Ch] BYREF</span><br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [esp+18h] [ebp-14h] BYREF</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+20h] [ebp-Ch]</span><br>  <span class="hljs-type">unsigned</span> __int8 v6; <span class="hljs-comment">// [esp+27h] [ebp-5h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+28h] [ebp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>  &#123;<br>    v1 = <span class="hljs-built_in">sub_401546</span>(<span class="hljs-number">1</span> &lt;&lt; i);<br>    v4[i] = v1;<br>  &#125;<br>  <span class="hljs-built_in">sub_4015B4</span>(v4, v3);<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">7</span>; ++j )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( ((a1 &gt;&gt; j) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>      v6 ^= v3[j];<br>  &#125;<br>  <span class="hljs-keyword">return</span> v6;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>sub_4015B4 自定义的 SBOX 变换</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">sub_4015B4</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [esp+Ah] [ebp-4Ah]</span><br>  __int16 v4; <span class="hljs-comment">// [esp+22h] [ebp-32h]</span><br>  <span class="hljs-type">int</span> kk; <span class="hljs-comment">// [esp+24h] [ebp-30h]</span><br>  <span class="hljs-type">char</span> v6; <span class="hljs-comment">// [esp+2Bh] [ebp-29h]</span><br>  <span class="hljs-type">int</span> jj; <span class="hljs-comment">// [esp+2Ch] [ebp-28h]</span><br>  <span class="hljs-type">int</span> ii; <span class="hljs-comment">// [esp+30h] [ebp-24h]</span><br>  <span class="hljs-type">int</span> n; <span class="hljs-comment">// [esp+34h] [ebp-20h]</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// [esp+38h] [ebp-1Ch]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+3Ch] [ebp-18h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [esp+40h] [ebp-14h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+44h] [ebp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v14; <span class="hljs-comment">// [esp+4Bh] [ebp-9h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+4Ch] [ebp-8h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>  &#123;<br>    v14 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">7</span>; ++j )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( ((*(j + a1) &gt;&gt; i) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>        v14 |= <span class="hljs-number">1</span> &lt;&lt; j;<br>    &#125;<br>    *&amp;v3[<span class="hljs-number">2</span> * i + <span class="hljs-number">8</span>] = v14 | (<span class="hljs-number">1</span> &lt;&lt; (i + <span class="hljs-number">8</span>));<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">7</span>; ++k )<br>  &#123;<br>    v11 = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span> ( m = k; m &lt;= <span class="hljs-number">7</span>; ++m )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( ((*&amp;v3[<span class="hljs-number">2</span> * m + <span class="hljs-number">8</span>] &gt;&gt; k) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v11 = m;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-number">-1</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( v11 != k )<br>    &#123;<br>      v4 = *&amp;v3[<span class="hljs-number">2</span> * v11 + <span class="hljs-number">8</span>];<br>      *&amp;v3[<span class="hljs-number">2</span> * v11 + <span class="hljs-number">8</span>] = *&amp;v3[<span class="hljs-number">2</span> * k + <span class="hljs-number">8</span>];<br>      *&amp;v3[<span class="hljs-number">2</span> * k + <span class="hljs-number">8</span>] = v4;<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">0</span>; n &lt;= <span class="hljs-number">7</span>; ++n )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( n != k &amp;&amp; ((*&amp;v3[<span class="hljs-number">2</span> * n + <span class="hljs-number">8</span>] &gt;&gt; k) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>        *&amp;v3[<span class="hljs-number">2</span> * n + <span class="hljs-number">8</span>] ^= *&amp;v3[<span class="hljs-number">2</span> * k + <span class="hljs-number">8</span>];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( ii = <span class="hljs-number">0</span>; ii &lt;= <span class="hljs-number">7</span>; ++ii )<br>    v3[ii] = <span class="hljs-built_in">HIBYTE</span>(*&amp;v3[<span class="hljs-number">2</span> * ii + <span class="hljs-number">8</span>]);<br>  <span class="hljs-keyword">for</span> ( jj = <span class="hljs-number">0</span>; jj &lt;= <span class="hljs-number">7</span>; ++jj )<br>  &#123;<br>    v6 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( kk = <span class="hljs-number">0</span>; kk &lt;= <span class="hljs-number">7</span>; ++kk )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( ((v3[kk] &gt;&gt; jj) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>        v6 |= <span class="hljs-number">1</span> &lt;&lt; kk;<br>    &#125;<br>    *(a2 + jj) = v6;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 sub_401C08 -&gt; sub_4019B7，这里是在进行密钥扩展</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> __cdecl <span class="hljs-title">sub_4019B7</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> v2; <span class="hljs-comment">// [esp+10h] [ebp-14h]</span><br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// [esp+10h] [ebp-14h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v4; <span class="hljs-comment">// [esp+11h] [ebp-13h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// [esp+12h] [ebp-12h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v6; <span class="hljs-comment">// [esp+13h] [ebp-11h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+14h] [ebp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v8; <span class="hljs-comment">// [esp+1Bh] [ebp-9h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+1Ch] [ebp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+20h] [ebp-4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+20h] [ebp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; ++i )<br>  &#123;<br>    *(a1 + <span class="hljs-number">4</span> * i) = *(<span class="hljs-number">4</span> * i + a2);<br>    *(a1 + <span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>) = *(<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span> + a2);<br>    *(a1 + <span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>) = *(<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span> + a2);<br>    *(a1 + <span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>) = *(<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span> + a2);<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">4</span>; j &lt;= <span class="hljs-number">0x2B</span>; ++j )<br>  &#123;<br>    v2 = *(a1 + <span class="hljs-number">4</span> * (j + <span class="hljs-number">0x3FFFFFFF</span>));<br>    v4 = *(<span class="hljs-number">4</span> * (j + <span class="hljs-number">0x3FFFFFFF</span>) + <span class="hljs-number">1</span> + a1);<br>    v5 = *(<span class="hljs-number">4</span> * (j + <span class="hljs-number">0x3FFFFFFF</span>) + <span class="hljs-number">2</span> + a1);<br>    v6 = *(<span class="hljs-number">4</span> * (j + <span class="hljs-number">0x3FFFFFFF</span>) + <span class="hljs-number">3</span> + a1);<br>    <span class="hljs-keyword">if</span> ( (j &amp; <span class="hljs-number">3</span>) == <span class="hljs-number">0</span> )<br>    &#123;<br>      v8 = *(a1 + <span class="hljs-number">4</span> * (j + <span class="hljs-number">0x3FFFFFFF</span>));<br>      v3 = <span class="hljs-built_in">sub_401929</span>(v4);<br>      v4 = <span class="hljs-built_in">sub_401929</span>(v5);<br>      v5 = <span class="hljs-built_in">sub_401929</span>(v6);<br>      v6 = <span class="hljs-built_in">sub_401929</span>(v8);<br>      v2 = v3 ^ unk_407064[j &gt;&gt; <span class="hljs-number">2</span>];<br>    &#125;<br>    v7 = <span class="hljs-number">4</span> * j;<br>    v9 = <span class="hljs-number">4</span> * (j + <span class="hljs-number">1073741820</span>);<br>    *(a1 + <span class="hljs-number">4</span> * j) = *(a1 + v9) ^ v2;<br>    *(v7 + <span class="hljs-number">1</span> + a1) = *(v9 + <span class="hljs-number">1</span> + a1) ^ v4;<br>    *(v7 + <span class="hljs-number">2</span> + a1) = *(v9 + <span class="hljs-number">2</span> + a1) ^ v5;<br>    *(<span class="hljs-number">4</span> * j + <span class="hljs-number">3</span> + a1) = *(v9 + <span class="hljs-number">3</span> + a1) ^ v6;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>unk_407064 这组数据就是 RCON</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0x8D</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x36</span><br></code></pre></td></tr></table></figure>

<p>解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotl8</span>(<span class="hljs-params">x:<span class="hljs-built_in">int</span>,n:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> ((x&lt;&lt;n)&amp;<span class="hljs-number">0xFF</span>)|((x&amp;<span class="hljs-number">0xFF</span>)&gt;&gt;(<span class="hljs-number">8</span>-n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rot</span>(<span class="hljs-params">a1:<span class="hljs-built_in">int</span>,a2:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> rotl8(a1&amp;<span class="hljs-number">0xFF</span>,a2)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_401546</span>(<span class="hljs-params">a1:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    v1=rot(a1,<span class="hljs-number">1</span>)&amp;<span class="hljs-number">0xFF</span><br>    v1=(a1^v1)&amp;<span class="hljs-number">0xFF</span><br>    v2=(rot(a1,<span class="hljs-number">2</span>)^v1)&amp;<span class="hljs-number">0xFF</span><br>    v3=(rot(a1,<span class="hljs-number">3</span>)^v2)&amp;<span class="hljs-number">0xFF</span><br>    <span class="hljs-keyword">return</span> (v3^rot(a1,<span class="hljs-number">4</span>))&amp;<span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gf_mul_by_pow</span>(<span class="hljs-params">a:<span class="hljs-built_in">int</span>,b:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    v6=<span class="hljs-number">0</span>; aa=a&amp;<span class="hljs-number">0xFF</span>; cnt=b<br>    <span class="hljs-keyword">while</span> cnt:<br>        <span class="hljs-keyword">if</span> cnt&amp;<span class="hljs-number">1</span>: v6^=aa<br>        v2=<span class="hljs-number">0</span> <span class="hljs-keyword">if</span> aa&lt;<span class="hljs-number">0x80</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0x1B</span><br>        aa=((aa&lt;&lt;<span class="hljs-number">1</span>)&amp;<span class="hljs-number">0xFF</span>)^v2<br>        cnt&gt;&gt;=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> v6&amp;<span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_4014F6</span>(<span class="hljs-params">a1:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">if</span> a1==<span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    v3=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">253</span>):<br>        v3=gf_mul_by_pow(v3,a1)<br>    <span class="hljs-keyword">return</span> v3&amp;<span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_4015B4</span>(<span class="hljs-params">a1_bytes:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    v3=[<span class="hljs-number">0</span>]*<span class="hljs-number">24</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        v14=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span> ((a1_bytes[j]&gt;&gt;i)&amp;<span class="hljs-number">1</span>)!=<span class="hljs-number">0</span>: v14|=(<span class="hljs-number">1</span>&lt;&lt;j)<br>        word=(v14&amp;<span class="hljs-number">0xFF</span>)|(((<span class="hljs-number">1</span>&lt;&lt;(i+<span class="hljs-number">8</span>))&amp;<span class="hljs-number">0xFFFF</span>)&amp;<span class="hljs-number">0xFF00</span>)<br>        v3[<span class="hljs-number">2</span>*i+<span class="hljs-number">8</span>]=word&amp;<span class="hljs-number">0xFFFF</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        v11=-<span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k,<span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span> ((v3[<span class="hljs-number">2</span>*m+<span class="hljs-number">8</span>]&gt;&gt;k)&amp;<span class="hljs-number">1</span>)!=<span class="hljs-number">0</span>:<br>                v11=m; <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> v11==-<span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">if</span> v11!=k:<br>            tmp=v3[<span class="hljs-number">2</span>*v11+<span class="hljs-number">8</span>]; v3[<span class="hljs-number">2</span>*v11+<span class="hljs-number">8</span>]=v3[<span class="hljs-number">2</span>*k+<span class="hljs-number">8</span>]; v3[<span class="hljs-number">2</span>*k+<span class="hljs-number">8</span>]=tmp<br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span> n!=k <span class="hljs-keyword">and</span> ((v3[<span class="hljs-number">2</span>*n+<span class="hljs-number">8</span>]&gt;&gt;k)&amp;<span class="hljs-number">1</span>)!=<span class="hljs-number">0</span>:<br>                v3[<span class="hljs-number">2</span>*n+<span class="hljs-number">8</span>]^=v3[<span class="hljs-number">2</span>*k+<span class="hljs-number">8</span>]<br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        word=v3[<span class="hljs-number">2</span>*ii+<span class="hljs-number">8</span>]&amp;<span class="hljs-number">0xFFFF</span><br>        v3[ii]=(word&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span><br>    v_out=[<span class="hljs-number">0</span>]*<span class="hljs-number">8</span><br>    <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        v6=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> kk <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span> ((v3[kk]&gt;&gt;jj)&amp;<span class="hljs-number">1</span>)!=<span class="hljs-number">0</span>: v6|=(<span class="hljs-number">1</span>&lt;&lt;kk)<br>        v_out[jj]=v6&amp;<span class="hljs-number">0xFF</span><br>    <span class="hljs-keyword">return</span> v_out<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_4017B8</span>(<span class="hljs-params">a1:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    v3=[<span class="hljs-number">0</span>]*<span class="hljs-number">8</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>): v3[i]=sub_401546((<span class="hljs-number">1</span>&lt;&lt;i)&amp;<span class="hljs-number">0xFF</span>)<br>    v2=sub_4015B4(v3)<br>    v5=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">if</span> ((a1&gt;&gt;j)&amp;<span class="hljs-number">1</span>)!=<span class="hljs-number">0</span>: v5^=v2[j]<br>    <span class="hljs-keyword">return</span> v5&amp;<span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_sbox</span>(<span class="hljs-params">a3:<span class="hljs-built_in">int</span>=<span class="hljs-number">167</span></span>):<br>    S=[<span class="hljs-number">0</span>]*<span class="hljs-number">256</span>; Inv=[<span class="hljs-number">0</span>]*<span class="hljs-number">256</span><br>    _=sub_4017B8(a3)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        v5=sub_4014F6(i)<br>        v4=(a3^sub_401546(v5))&amp;<span class="hljs-number">0xFF</span><br>        S[i]=v4; Inv[v4]=i<br>    <span class="hljs-keyword">return</span> S,Inv<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_401E72</span>(<span class="hljs-params">a1:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> ((<span class="hljs-number">2</span>*a1)^(<span class="hljs-number">27</span>*((a1&amp;<span class="hljs-number">0xFF</span>)&gt;&gt;<span class="hljs-number">7</span>)))&amp;<span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_single_column</span>(<span class="hljs-params">col:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    s0,s1,s2,s3=col<br>    v3=s0<br>    v2=(s2^s1^v3^s3)&amp;<span class="hljs-number">0xFF</span><br>    t0=v2^(sub_401E72((v3^s1)&amp;<span class="hljs-number">0xFF</span>)&amp;<span class="hljs-number">0xFF</span>)^v3<br>    t1=s1^v2^(sub_401E72((s1^s2)&amp;<span class="hljs-number">0xFF</span>)&amp;<span class="hljs-number">0xFF</span>)<br>    t2=s2^v2^(sub_401E72((s2^s3)&amp;<span class="hljs-number">0xFF</span>)&amp;<span class="hljs-number">0xFF</span>)<br>    t3=s3^v2^(sub_401E72((v3^s3)&amp;<span class="hljs-number">0xFF</span>)&amp;<span class="hljs-number">0xFF</span>)<br>    <span class="hljs-keyword">return</span> [t0&amp;<span class="hljs-number">0xFF</span>,t1&amp;<span class="hljs-number">0xFF</span>,t2&amp;<span class="hljs-number">0xFF</span>,t3&amp;<span class="hljs-number">0xFF</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_columns</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    s=state[:]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        col=[s[<span class="hljs-number">0</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">1</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">2</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">3</span>+<span class="hljs-number">4</span>*i]]<br>        coln=mix_single_column(col)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>): s[r+<span class="hljs-number">4</span>*i]=coln[r]<br>    <span class="hljs-keyword">return</span> s<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gf_mul</span>(<span class="hljs-params">a:<span class="hljs-built_in">int</span>,b:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> gf_mul_by_pow(a,b)<br><br>INV_MAT=[[<span class="hljs-number">0x0E</span>,<span class="hljs-number">0x0B</span>,<span class="hljs-number">0x0D</span>,<span class="hljs-number">0x09</span>],[<span class="hljs-number">0x09</span>,<span class="hljs-number">0x0E</span>,<span class="hljs-number">0x0B</span>,<span class="hljs-number">0x0D</span>],[<span class="hljs-number">0x0D</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x0E</span>,<span class="hljs-number">0x0B</span>],[<span class="hljs-number">0x0B</span>,<span class="hljs-number">0x0D</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0x0E</span>]]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inv_mix_single_column</span>(<span class="hljs-params">col:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    res=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        v=<span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>): v^=gf_mul(INV_MAT[row][k],col[k])<br>        res[row]=v&amp;<span class="hljs-number">0xFF</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inv_mix_columns</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    s=state[:]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        col=[s[<span class="hljs-number">0</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">1</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">2</span>+<span class="hljs-number">4</span>*i],s[<span class="hljs-number">3</span>+<span class="hljs-number">4</span>*i]]<br>        coln=inv_mix_single_column(col)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>): s[r+<span class="hljs-number">4</span>*i]=coln[r]<br>    <span class="hljs-keyword">return</span> s<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shift_rows</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    out=[<span class="hljs-number">0</span>]*<span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>): out[r+<span class="hljs-number">4</span>*c]=state[r+<span class="hljs-number">4</span>*((c+r)%<span class="hljs-number">4</span>)]<br>    <span class="hljs-keyword">return</span> out<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inv_shift_rows</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    out=[<span class="hljs-number">0</span>]*<span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>): out[r+<span class="hljs-number">4</span>*c]=state[r+<span class="hljs-number">4</span>*((c-r)%<span class="hljs-number">4</span>)]<br>    <span class="hljs-keyword">return</span> out<br><br>SBOX,INV_SBOX=build_sbox(<span class="hljs-number">167</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_bytes</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-keyword">return</span> [SBOX[b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> state]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inv_sub_bytes</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-keyword">return</span> [INV_SBOX[b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> state]<br><br>RCON=[<span class="hljs-number">0x8D</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0x1B</span>,<span class="hljs-number">0x36</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">key_expansion_bytes</span>(<span class="hljs-params">key_bytes:<span class="hljs-built_in">bytes</span></span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>    w=[<span class="hljs-number">0</span>]*<span class="hljs-number">44</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        b0=key_bytes[<span class="hljs-number">4</span>*i]; b1=key_bytes[<span class="hljs-number">4</span>*i+<span class="hljs-number">1</span>]; b2=key_bytes[<span class="hljs-number">4</span>*i+<span class="hljs-number">2</span>]; b3=key_bytes[<span class="hljs-number">4</span>*i+<span class="hljs-number">3</span>]<br>        w[i]=(b0)|(b1&lt;&lt;<span class="hljs-number">8</span>)|(b2&lt;&lt;<span class="hljs-number">16</span>)|(b3&lt;&lt;<span class="hljs-number">24</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>,<span class="hljs-number">44</span>):<br>        temp=w[j-<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> j%<span class="hljs-number">4</span>==<span class="hljs-number">0</span>:<br>            b0=temp&amp;<span class="hljs-number">0xFF</span>; b1=(temp&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xFF</span>; b2=(temp&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">0xFF</span>; b3=(temp&gt;&gt;<span class="hljs-number">24</span>)&amp;<span class="hljs-number">0xFF</span><br>            rb=[b1,b2,b3,b0]<br>            sb=[SBOX[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> rb]<br>            sb[<span class="hljs-number">0</span>]^=RCON[j//<span class="hljs-number">4</span>]&amp;<span class="hljs-number">0xFF</span><br>            temp=(sb[<span class="hljs-number">0</span>])|(sb[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">8</span>)|(sb[<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">16</span>)|(sb[<span class="hljs-number">3</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        w[j]=w[j-<span class="hljs-number">4</span>]^temp<br>    round_keys=[]<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>):<br>        rk=[<span class="hljs-number">0</span>]*<span class="hljs-number">16</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            word=w[<span class="hljs-number">4</span>*r+i]<br>            rk[<span class="hljs-number">4</span>*i:<span class="hljs-number">4</span>*i+<span class="hljs-number">4</span>]=[(word&gt;&gt;(<span class="hljs-number">8</span>*k))&amp;<span class="hljs-number">0xFF</span> <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>        round_keys.append(rk)<br>    <span class="hljs-keyword">return</span> round_keys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_round_key</span>(<span class="hljs-params">state:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>],round_key:<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>)-&gt;<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-keyword">return</span> [s^rk <span class="hljs-keyword">for</span> s,rk <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(state,round_key)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_decrypt_block</span>(<span class="hljs-params">cipher_block:<span class="hljs-built_in">bytes</span>,round_keys:<span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]</span>)-&gt;<span class="hljs-built_in">bytes</span>:<br>    state=<span class="hljs-built_in">list</span>(cipher_block)<br>    state=add_round_key(state,round_keys[<span class="hljs-number">10</span>])<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):<br>        state=inv_shift_rows(state)<br>        state=inv_sub_bytes(state)<br>        state=add_round_key(state,round_keys[r])<br>        state=inv_mix_columns(state)<br>    state=inv_shift_rows(state)<br>    state=inv_sub_bytes(state)<br>    state=add_round_key(state,round_keys[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(state)<br><br>CIPHER_HEX=<span class="hljs-string">&quot;b2b3dcb9f8d693ffb5a1cc2a6fde2744af2198dd00c10d1c5306813e16abdf13&quot;</span><br>CIPHER=<span class="hljs-built_in">bytes</span>.fromhex(CIPHER_HEX)<br>KEY=<span class="hljs-string">b&quot;Syclover2025Geek&quot;</span><br>IV=<span class="hljs-string">b&quot;1145141145144332&quot;</span><br><br>round_keys = key_expansion_bytes(KEY)<br>c1, c2 = CIPHER[:<span class="hljs-number">16</span>], CIPHER[<span class="hljs-number">16</span>:<span class="hljs-number">32</span>]<br><br>p1 = aes_decrypt_block(c1, round_keys)<br>plain1 = <span class="hljs-built_in">bytes</span>(x^y <span class="hljs-keyword">for</span> x,y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(p1, IV))<br><br>p2 = aes_decrypt_block(c2, round_keys)<br>plain2 = <span class="hljs-built_in">bytes</span>(x^y <span class="hljs-keyword">for</span> x,y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(p2, c1))<br><br>plaintext = plain1 + plain2<br><br><span class="hljs-built_in">print</span>(plaintext.decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>))<br><br></code></pre></td></tr></table></figure>

<p>解除来的是：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">We_ve_Trapped_in_The_Sink</span><br></code></pre></td></tr></table></figure>

<p>作为压缩包密码，打开有一个 wav 音频，可以听出这个音频像信号，所以有可能是 sstv</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sstv -d 1nn3r.wav<br></code></pre></td></tr></table></figure>

<p>解出来是一个有二维码的图片，识别不出来，然后我拿手机微信识别出来的，会跳转网页下载一个 secret.zip 文件</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/7b7ac42e396467a9.png"></p>
<p>解压得到一个音频文件，摩斯电码，在线网站解码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">55</span> <span class="hljs-number">31</span> <span class="hljs-number">6</span>C <span class="hljs-number">44</span> <span class="hljs-number">65</span> <span class="hljs-number">7</span>A <span class="hljs-number">64</span> <span class="hljs-number">6</span>F <span class="hljs-number">4</span>D <span class="hljs-number">54</span> <span class="hljs-number">56</span> <span class="hljs-number">66</span> <span class="hljs-number">4</span>D <span class="hljs-number">56</span> <span class="hljs-number">4</span>E <span class="hljs-number">66</span> <span class="hljs-number">4</span>E <span class="hljs-number">46</span> <span class="hljs-number">38</span> <span class="hljs-number">35</span> <span class="hljs-number">63</span> <span class="hljs-number">6</span>A <span class="hljs-number">52</span> <span class="hljs-number">75</span> <span class="hljs-number">52</span> <span class="hljs-number">46</span> <span class="hljs-number">39</span> <span class="hljs-number">6</span>A <span class="hljs-number">4</span>D <span class="hljs-number">45</span> <span class="hljs-number">34</span> <span class="hljs-number">31</span> <span class="hljs-number">63</span> <span class="hljs-number">44</span> <span class="hljs-number">46</span> <span class="hljs-number">79</span> <span class="hljs-number">51</span> <span class="hljs-number">47</span> <span class="hljs-number">4</span>E <span class="hljs-number">5</span>A <span class="hljs-number">4</span>C <span class="hljs-number">6</span>E <span class="hljs-number">30</span> <span class="hljs-number">3</span>D<br></code></pre></td></tr></table></figure>

<p>hex + base64 解密</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">SYC&#123;<span class="hljs-number">7</span>h<span class="hljs-number">15</span>_<span class="hljs-number">1</span>S_<span class="hljs-number">4</span>_<span class="hljs-number">9</span>r<span class="hljs-number">4</span><span class="hljs-symbol">nD_c0</span><span class="hljs-symbol">N5</span>p<span class="hljs-number">1</span>r@cY.&#125;<br></code></pre></td></tr></table></figure>

<h1 id="stack-bomb"><a href="#stack-bomb" class="headerlink" title="stack_bomb"></a>stack_bomb</h1><p>一个 tea 加密</p>
<p>无法反编译，分析汇编代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push    offset loc_411307		eax = [ebp+8] add [ebp+0Ch]				return a2 + a1<br>push    offset sub_41109B		eax = [ebp+arg_0] sub [ebp+arg_4]		return a1 - a2<br>push    offset sub_4113F2		eax = [ebp+arg_0] xor [ebp+arg_4]		return a2 ^ a1<br>push    offset loc_411186		eax = [ebp+8] and [ebp+0Ch]				return a2 &amp; a1<br>push    offset sub_41115E		eax = [ebp+arg_0] shl [ebp+arg_4]		return a1 &lt;&lt; a2<br>push    offset sub_411091		eax = [ebp+arg_0] shr [ebp+arg_4]		return a1 &gt;&gt; a2<br>push    offset sub_4112D0		eax = [ebp+arg_0] mod [ebp+arg_4]		return a1 % a2<br>push    offset sub_411163		eax = [ebp+arg_0] imul [ebp+arg_4]		return a2 * a1<br>push    offset sub_411005		eax = [ebp+arg_0] idiv [ebp+arg_4]		return a1 / a2<br>push    offset loc_41139D		回调处理<br>push    offset sub_411014		回调处理<br></code></pre></td></tr></table></figure>

<p>输入的 32 字节：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cmp     [ebp+ecx+var_54], 9A8C0C4Bh<br>cmp     [ebp+eax+var_54], 0C412FF1Ch<br>cmp     [ebp+ecx+var_64], 0BFC3A488h<br>cmp     [ebp+eax+var_64], 0B16C8FD0h<br>cmp     [ebp+ecx+var_74], 4136E319h<br>cmp     [ebp+eax+var_74], 8835E4FFh<br>cmp     [ebp+ecx+var_84], 118263A7h<br>cmp     [ebp+eax+var_84], 7C85D629h<br><br>var_54 = Buffer[0:8]<br>var_64 = Buffer[8:16]<br>var_74 = Buffer[16:24]<br>var_84 = Buffer[24:32]<br></code></pre></td></tr></table></figure>

<p>sub_411FE0 中找到 key：1，2，3，4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov     [ebp+var_18], 1<br>mov     [ebp+var_14], 2<br>mov     [ebp+var_10], 3<br>mov     [ebp+var_C], 4<br></code></pre></td></tr></table></figure>

<p>跟踪到 sub_411920，这里是加密核心，循环 a48 的值次数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs assembly">int __cdecl sub_411920(<br>        __int128 a1,<br>        int a2,<br>        int a3,<br>        int a4,<br>        int a5,<br>        int a6,<br>        int a7,<br>        int a8,<br>        int a9,<br>        int a10,<br>        int a11,<br>        int a12,<br>        int a13,<br>        int a14,<br>        int a15,<br>        int a16,<br>        int a17,<br>        int a18,<br>        int a19,<br>        int a20,<br>        int a21,<br>        int a22,<br>        int a23,<br>        int a24,<br>        int a25,<br>        int a26,<br>        int a27,<br>        int a28,<br>        int a29,<br>        int a30,<br>        int a31,<br>        int a32,<br>        int a33,<br>        int a34,<br>        int a35,<br>        int a36,<br>        int a37,<br>        int a38,<br>        int a39,<br>        int a40,<br>        int a41,<br>        int a42,<br>        int a43,<br>        int a44,<br>        int a45,<br>        int a46,<br>        int a47,<br>        signed int a48)<br>&#123;<br>  int v48; // eax<br>  int v49; // eax<br>  int v50; // eax<br>  int v51; // eax<br>  int v52; // eax<br>  int v53; // eax<br>  int v54; // eax<br>  int v55; // eax<br>  int v56; // eax<br>  int v57; // eax<br>  int v59; // [esp+D0h] [ebp-78h]<br>  int v60; // [esp+DCh] [ebp-6Ch]<br>  int v61; // [esp+DCh] [ebp-6Ch]<br>  int v62; // [esp+DCh] [ebp-6Ch]<br>  int v63; // [esp+DCh] [ebp-6Ch]<br>  int v64; // [esp+E8h] [ebp-60h]<br>  int v65; // [esp+F4h] [ebp-54h]<br>  int v66; // [esp+100h] [ebp-48h]<br>  int v67; // [esp+10Ch] [ebp-3Ch]<br>  signed int v68; // [esp+118h] [ebp-30h]<br>  int v69; // [esp+124h] [ebp-24h]<br>  int v70; // [esp+130h] [ebp-18h]<br>  int v71; // [esp+13Ch] [ebp-Ch]<br><br>  v71 = *(_DWORD *)a1;<br>  v70 = *(_DWORD *)(a1 + 4);<br>  v69 = 0;<br>  v67 = *(_DWORD *)DWORD1(a1);<br>  v66 = *(_DWORD *)(DWORD1(a1) + 4);<br>  v65 = *(_DWORD *)(DWORD1(a1) + 8);<br>  v64 = *(_DWORD *)(DWORD1(a1) + 12);<br>  v59 = 1;<br>  v68 = STACK[0x294];<br>  while ( v59 )<br>  &#123;<br>    while ( 1 )<br>    &#123;<br>      STACK[0x26C] = a1;<br>      STACK[0x268] = *(_DWORD *)((char *)&amp;a1 + 1);<br>      STACK[0x264] = v69;<br>      STACK[0x260] = DWORD1(a1);<br>      STACK[0x25C] = *(_DWORD *)((char *)&amp;a1 + 5);<br>      STACK[0x258] = *(_DWORD *)((char *)&amp;a1 + 6);<br>      STACK[0x254] = *(_DWORD *)((char *)&amp;a1 + 7);<br>      STACK[0x250] = dword_41B198;<br>      v69 = ((int (__cdecl *)(unsigned int, unsigned int))STACK[0x2C0])(STACK[0x250], STACK[0x264]);<br>      v48 = ((int (__cdecl *)(int, unsigned int))STACK[0x2B0])(v70, STACK[0x284]);<br>      v60 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v67, v48);<br>      v49 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v69, v70);<br>      v61 = ((int (__cdecl *)(int, int))STACK[0x2B8])(v49, v60);<br>      v50 = ((int (__cdecl *)(int, unsigned int))STACK[0x2AC])(v70, STACK[0x280]);<br>      v51 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v66, v50);<br>      v52 = ((int (__cdecl *)(int, int))STACK[0x2B8])(v61, v51);<br>      v71 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v71, v52);<br>      v53 = ((int (__cdecl *)(int, unsigned int))STACK[0x2B0])(v71, STACK[0x284]);<br>      v62 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v65, v53);<br>      v54 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v69, v71);<br>      v63 = ((int (__cdecl *)(int, int))STACK[0x2B8])(v54, v62);<br>      v55 = ((int (__cdecl *)(int, unsigned int))STACK[0x2AC])(v71, STACK[0x280]);<br>      v56 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v64, v55);<br>      v57 = ((int (__cdecl *)(int, int))STACK[0x2B8])(v63, v56);<br>      v70 = ((int (__cdecl *)(int, int))STACK[0x2C0])(v70, v57);<br>      if ( v68 &gt;= a48 )<br>        break;<br>      ++v68;<br>    &#125;<br>    v59 = 0;<br>  &#125;<br>  *(_DWORD *)a1 = v71;<br>  *(_DWORD *)(a1 + 4) = v70;<br>  return 0;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里对应 key</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">v67 = *DWORD1(a1);				arg_0		*(<span class="hljs-type">uint32_t</span>*)(*(<span class="hljs-type">uint32_t</span>*)ptr + <span class="hljs-number">0</span>)			k[<span class="hljs-number">0</span>]<br>v66 = *(DWORD1(a1) + <span class="hljs-number">4</span>);		arg_4		*(<span class="hljs-type">uint32_t</span>*)(*(<span class="hljs-type">uint32_t</span>*)ptr + <span class="hljs-number">4</span>)			k[<span class="hljs-number">1</span>]<br>v65 = *(DWORD1(a1) + <span class="hljs-number">8</span>);		arg_8		*(<span class="hljs-type">uint32_t</span>*)(*(<span class="hljs-type">uint32_t</span>*)ptr + <span class="hljs-number">8</span>)			k[<span class="hljs-number">2</span>]<br>v64 = *(DWORD1(a1) + <span class="hljs-number">12</span>);		arg_12		*(<span class="hljs-type">uint32_t</span>*)(*(<span class="hljs-type">uint32_t</span>*)ptr + <span class="hljs-number">12</span>)			k[<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure>

<p>x 和 y，sum</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">v71 = *a1;				arg_0		x<br>v70 = *(a1 + <span class="hljs-number">4</span>);		arg_4		y<br>v69 = <span class="hljs-number">0</span>								sum<br></code></pre></td></tr></table></figure>

<p>这里一堆 STACK[]，是因为反编译失败，要获取每个 STACK 代表什么可以在前面 push 每个调用的函数 return 下断点，调试时会调用此函数，同时可以获取 delta 和 key 值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c">a48 = <span class="hljs-number">0x1F</span>+<span class="hljs-number">1</span> = <span class="hljs-number">32</span>;<br><span class="hljs-type">uint32_t</span> sum = <span class="hljs-number">0</span>;    <br><span class="hljs-type">uint32_t</span> i = STACK[<span class="hljs-number">0x284</span>] = <span class="hljs-number">0x4</span>;<br><span class="hljs-type">uint32_t</span> j = STACK[<span class="hljs-number">0x280</span>] = <span class="hljs-number">0x5</span>;<br><span class="hljs-type">uint32_t</span> delta = STACK[<span class="hljs-number">0x250</span>] = <span class="hljs-number">0x9000000</span>;<br><br>STACK[<span class="hljs-number">0x2C0</span>] -&gt; <span class="hljs-string">&quot; + &quot;</span><br>STACK[<span class="hljs-number">0x2B0</span>] -&gt; <span class="hljs-string">&quot; &lt;&lt; &quot;</span><br>STACK[<span class="hljs-number">0x2B8</span>] -&gt; <span class="hljs-string">&quot; ^ &quot;</span><br>STACK[<span class="hljs-number">0x2AC</span>] -&gt; <span class="hljs-string">&quot; &gt;&gt; &quot;</span><br>    <br>.data:<span class="hljs-number">00B</span>FB198 dword_BFB198 dd <span class="hljs-number">9000000</span>h<br><br>v69 = (STACK[<span class="hljs-number">0x2C0</span>])(STACK[<span class="hljs-number">0x250</span>], STACK[<span class="hljs-number">0x264</span>])	sum = (STACK[<span class="hljs-number">0x2C0</span>])(delta,sum)			-&gt; sum = delta + sum<br>v48 = (STACK[<span class="hljs-number">0x2B0</span>])(v70, STACK[<span class="hljs-number">0x284</span>]);			t0 = (STACK[<span class="hljs-number">0x2B0</span>])(y,i)				-&gt; t0 = y &lt;&lt; <span class="hljs-number">4</span><br>v60 = (STACK[<span class="hljs-number">0x2C0</span>])(v67, v48);						t1 = (STACK[<span class="hljs-number">0x2C0</span>])(k[<span class="hljs-number">0</span>],t0)			-&gt; t1 = <span class="hljs-number">1</span> + t0<br>v49 = (STACK[<span class="hljs-number">0x2C0</span>])(v69, v70);						t2 = (STACK[<span class="hljs-number">0x2C0</span>])(sum,y)				-&gt; t2 = sum + y<br>v61 = (STACK[<span class="hljs-number">0x2B8</span>])(v49, v60);						t3 = (STACK[<span class="hljs-number">0x2B8</span>])(t2,t1)				-&gt; t3 = t2 ^ t1<br>v50 = (STACK[<span class="hljs-number">0x2AC</span>])(v70, STACK[<span class="hljs-number">0x280</span>]);			t4 = (STACK[<span class="hljs-number">0x2AC</span>])(y,<span class="hljs-number">5</span>)				-&gt; t4 = y &gt;&gt; <span class="hljs-number">5</span><br>v51 = (STACK[<span class="hljs-number">0x2C0</span>])(v66, v50);						t5 = (STACK[<span class="hljs-number">0x2C0</span>])(k[<span class="hljs-number">1</span>],t4)			-&gt; t5 = <span class="hljs-number">2</span> + t4<br>v52 = (STACK[<span class="hljs-number">0x2B8</span>])(v61, v51);						t6 = (STACK[<span class="hljs-number">0x2B8</span>])(t3,t5)				-&gt; t6 = t3 ^ t5<br>v71 = (STACK[<span class="hljs-number">0x2C0</span>])(v71, v52);						x = (STACK[<span class="hljs-number">0x2C0</span>])(x, t6)				-&gt; x = x + t6<br>v53 = (STACK[<span class="hljs-number">0x2B0</span>])(v71, STACK[<span class="hljs-number">0x284</span>]);			t7 = (STACK[<span class="hljs-number">0x2B0</span>])(x,<span class="hljs-number">4</span>)				-&gt; t7 = x &lt;&lt; <span class="hljs-number">4</span><br>v62 = (STACK[<span class="hljs-number">0x2C0</span>])(v65, v53);						t8 = (STACK[<span class="hljs-number">0x2C0</span>])(k[<span class="hljs-number">2</span>],t7)			-&gt; t8 = <span class="hljs-number">3</span> + t7<br>v54 = (STACK[<span class="hljs-number">0x2C0</span>])(v69, v71);						t9 = (STACK[<span class="hljs-number">0x2C0</span>])(sum, x)				-&gt; t9 = sum + x<br>v63 = (STACK[<span class="hljs-number">0x2B8</span>])(v54, v62);						t10 = (STACK[<span class="hljs-number">0x2B8</span>])(t9, t8)			-&gt; t10 = t9 ^ t8<br>v55 = (STACK[<span class="hljs-number">0x2AC</span>])(v71, STACK[<span class="hljs-number">0x280</span>]);			t11 = (STACK[<span class="hljs-number">0x2AC</span>])(x, <span class="hljs-number">5</span>)				-&gt; t11 = x &gt;&gt; <span class="hljs-number">5</span><br>v56 = (STACK[<span class="hljs-number">0x2C0</span>])(v64, v55);						t12 = (STACK[<span class="hljs-number">0x2C0</span>])(k[<span class="hljs-number">3</span>], t11)			-&gt; t12 = <span class="hljs-number">4</span> + t11<br>v57 = (STACK[<span class="hljs-number">0x2B8</span>])(v63, v56);						t13 = (STACK[<span class="hljs-number">0x2B8</span>])(t10, t12)			-&gt; t13 = t10 ^ t12<br>v70 = (STACK[<span class="hljs-number">0x2C0</span>])(v70, v57);						y = (STACK[<span class="hljs-number">0x2C0</span>])(y,t13)				-&gt; y = y + t13<br>    <br><br>x += (((sum+y) ^ (k[<span class="hljs-number">0</span>]+(y&lt;&lt;<span class="hljs-number">4</span>)) ^ (k[<span class="hljs-number">1</span>]+(y&gt;&gt;<span class="hljs-number">5</span>)))<br>y += (((sum+x) ^ (k[<span class="hljs-number">2</span>]+(x&lt;&lt;<span class="hljs-number">4</span>)) ^ (k[<span class="hljs-number">3</span>]+(x&gt;&gt;<span class="hljs-number">5</span>)))<br></code></pre></td></tr></table></figure>

<p>由此可还原 AES 加密逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">encrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">uint32_t</span> *k)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> y = v[<span class="hljs-number">1</span>], x = v[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint32_t</span> sum = <span class="hljs-number">0</span>, delta = <span class="hljs-number">0x9000000</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n = <span class="hljs-number">0</span>; n &lt;= <span class="hljs-number">32</span>; ++n) &#123;<br>        sum += delta;<br>        x += ((y &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (y + sum) ^ ((y &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>]);<br>        y += ((x &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (x + sum) ^ ((x &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>]);<br>    &#125;<br>    v[<span class="hljs-number">0</span>] = x;<br>    v[<span class="hljs-number">1</span>] = y;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解密脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">v, k</span>):<br>    v0, v1 = v<br>    delta, <span class="hljs-built_in">sum</span> = <span class="hljs-number">0x09000000</span>, <span class="hljs-number">0x09000000</span> * <span class="hljs-number">32</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        v1 = (v1 - (((v0 + s) ^ (k[<span class="hljs-number">2</span>] + (v0 &lt;&lt; <span class="hljs-number">4</span>)) ^ (k[<span class="hljs-number">3</span>] + (v0 &gt;&gt; <span class="hljs-number">5</span>))))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        v0 = (v0 - (((v1 + s) ^ (k[<span class="hljs-number">0</span>] + (v1 &lt;&lt; <span class="hljs-number">4</span>)) ^ (k[<span class="hljs-number">1</span>] + (v1 &gt;&gt; <span class="hljs-number">5</span>))))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <span class="hljs-built_in">sum</span> = (<span class="hljs-built_in">sum</span> - delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> v0, v1<br><br>k = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>data = [<span class="hljs-number">0x9A8C0C4B</span>, <span class="hljs-number">0xC412FF1C</span>, <span class="hljs-number">0xBFC3A488</span>, <span class="hljs-number">0xB16C8FD0</span>,<br>          <span class="hljs-number">0x4136E319</span>, <span class="hljs-number">0x8835E4FF</span>, <span class="hljs-number">0x118263A7</span>, <span class="hljs-number">0x7C85D629</span>]<br><br>plain = <span class="hljs-string">b&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>    v0, v1 = decrypt(data[i:i+<span class="hljs-number">2</span>], k)<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> (v0, v1):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            plain += <span class="hljs-built_in">bytes</span>([(x &gt;&gt; (<span class="hljs-number">8</span> * j)) &amp; <span class="hljs-number">0xFF</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> plain))<br></code></pre></td></tr></table></figure>

<p>拿到 flag</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">syc&#123;QYQS_F<span class="hljs-number">1</span><span class="hljs-symbol">nD_Th3</span>_@<span class="hljs-symbol">nswer_H3</span>re~~&#125;<br></code></pre></td></tr></table></figure>

<h1 id="GeekBinder"><a href="#GeekBinder" class="headerlink" title="GeekBinder"></a>GeekBinder</h1><p>加密很简单，按 i%8 和 geek2025 异或，密文在 attr_get_hidden_cipher 函数中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">attr_xor_cipher</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">size_t</span> a2, _QWORD *a3, <span class="hljs-type">size_t</span> *a4)</span><br>&#123;<br>  <span class="hljs-type">void</span> *v7; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  <span class="hljs-keyword">if</span> ( !a1 || !a2 || !a3 || !a4 )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0xFFFFFFFF</span>LL;<br>  v7 = <span class="hljs-built_in">malloc</span>(a2);<br>  <span class="hljs-keyword">if</span> ( !v7 )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">4294967294LL</span>;<br>  sub_1119(a1, a2, v7);<br>  *a3 = v7;<br>  *a4 = a2;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_1119</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">unsigned</span> __int64 a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+20h] [rbp-8h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; ; ++i )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= a2 )<br>      <span class="hljs-keyword">break</span>;<br>    *(a3 + i) = *(a1 + i) ^ aGeek2025[i % <span class="hljs-number">8</span>];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br>data_qwords = [<br>    <span class="hljs-number">0x7C725E7310263C34</span>,<br>    <span class="hljs-number">0x5D666F5505541F1E</span>,<br>    <span class="hljs-number">0x4601535D19153A54</span>,<br>    <span class="hljs-number">0x4266037034165614</span>,<br>    <span class="hljs-number">0x505E5974340B0002</span>,<br>    <span class="hljs-number">0x5B5D536D18543A54</span>,<br>    <span class="hljs-number">0x5A666F4B19251713</span>,<br>    <span class="hljs-number">0x6A5E705F19550B38</span>,<br>    <span class="hljs-number">0x0651594608251717</span>,<br>    <span class="hljs-number">0x506D5560340B5438</span>,<br>    <span class="hljs-number">0x0440555705540209</span>,<br>]<br><br>buf = <span class="hljs-string">b&#x27;&#x27;</span>.join(struct.pack(<span class="hljs-string">&quot;&lt;Q&quot;</span>, x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data_qwords)<br>buf += struct.pack(<span class="hljs-string">&quot;&lt;H&quot;</span>, <span class="hljs-number">521</span>)<br>buf += struct.pack(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">24</span>) <br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(buf) == <span class="hljs-number">91</span><br><br>key = <span class="hljs-string">b&quot;geek2025&quot;</span><br>out = <span class="hljs-built_in">bytearray</span>(<span class="hljs-built_in">len</span>(buf))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(buf)):<br>    out[i] = buf[i] ^ key[i % <span class="hljs-built_in">len</span>(key)]<br><br><span class="hljs-built_in">print</span>(out.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, errors=<span class="hljs-string">&#x27;replace&#x27;</span>))<br></code></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">SYC&#123;<span class="hljs-symbol">An@</span><span class="hljs-symbol">Iyz1ng_Th3_proc3ss3s_B3Tween_File3_1s_contr@</span><span class="hljs-symbol">ry_To_n0rm@</span><span class="hljs-symbol">l_pr@</span>ctic3_1n_Re_eng1neer1ng&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Her"><a href="#Her" class="headerlink" title="Her"></a>Her</h1><p>这个题有个 SEH，也就是 Windows 的异常处理，反编译隐藏正确的调用代码</p>
<p>主要跟进 sub_4011B3() 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_4024A0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v2; <span class="hljs-comment">// [esp+0h] [ebp-F0h]</span><br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// [esp+0h] [ebp-F0h]</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [esp+0h] [ebp-F0h]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-F0h]</span><br>  <span class="hljs-type">size_t</span> i; <span class="hljs-comment">// [esp+D0h] [ebp-20h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+DCh] [ebp-14h]</span><br>  <span class="hljs-type">size_t</span> v8; <span class="hljs-comment">// [esp+E8h] [ebp-8h]</span><br><br>  sub_40123A(&amp;unk_40D0A4);<br>  v0 = sub_402760(<span class="hljs-number">0</span>);<br>  srand(v0);<br>  sub_401177();<br>  sub_401087(<span class="hljs-string">&quot;Enter the flag: &quot;</span>, v2);<br>  sub_401023(<span class="hljs-string">&quot;%127s&quot;</span>, (<span class="hljs-type">char</span>)&amp;Str);<br>  v8 = <span class="hljs-built_in">strlen</span>(&amp;Str);<br>  <span class="hljs-keyword">if</span> ( v8 == dword_40B020 )<br>  &#123;<br>    sub_4011B3();<br>    sub_401087(<span class="hljs-string">&quot;\nVerifying encrypted flag...\n&quot;</span>, v3);<br>    v7 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v8; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( byte_40B260[i] != byte_40B000[i] )<br>        v7 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v7 )<br>    &#123;<br>      sub_401087(<span class="hljs-string">&quot;\n&quot;</span>, v4);<br>      sub_401087(<span class="hljs-string">&quot;YES!YES!&quot;</span>, v5);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      sub_401087(<span class="hljs-string">&quot;\nWrong\n&quot;</span>, v4);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    sub_401087(<span class="hljs-string">&quot;\nWrong\n&quot;</span>, v3);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>一直跟进到 sub_401D30 函数，这里有一个 BUG 函数，反汇编能看到 SEH 的关键代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">sub_401D30</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">size_t</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">size_t</span> i; <span class="hljs-comment">// [esp+F4h] [ebp-14h]</span><br>  <span class="hljs-type">size_t</span> v2; <span class="hljs-comment">// [esp+100h] [ebp-8h]</span><br><br>  v2 = <span class="hljs-built_in">strlen</span>(&amp;Str);<br>  <span class="hljs-keyword">if</span> ( sub_4010CD() )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>    &#123;<br>      result = i;<br>      <span class="hljs-keyword">if</span> ( i &gt;= v2 )<br>        <span class="hljs-keyword">break</span>;<br>      rand();<br>      byte_40B260[i] = sub_401177();<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    result = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( v2 )<br>    &#123;<br>      dword_40B1DC = <span class="hljs-number">0</span>;<br>      BUG();<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如下，这里是 SEH 链的注册，这里注册了三个函数，根据栈的规则 sub_401091 最先被调用，sub_401091-&gt;sub_401186-&gt;sub_401181</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:00401DCD                 push    offset sub_401181			// 将异常处理函数的地址压栈<br>.text:00401DD2                 push    large dword ptr fs:0			// 将当前的 SEH 链头指针压栈<br>.text:00401DD9                 mov     large fs:0, esp				// 将 fs:0 更新为当前栈顶<br>.text:00401DE0                 push    offset sub_401186<br>.text:00401DE5                 push    large dword ptr fs:0<br>.text:00401DEC                 mov     large fs:0, esp<br>.text:00401DF3                 push    offset sub_401091<br>.text:00401DF8                 push    large dword ptr fs:0<br>.text:00401DFF                 mov     large fs:0, esp<br>.text:00401E06                 ud2									// 抛出非法异常<br></code></pre></td></tr></table></figure>

<p>跟进 sub_401091 ，与 0xAA 异或</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_401EA0</span><span class="hljs-params">(_DWORD *a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// bl</span><br><br>  <span class="hljs-keyword">if</span> ( *a1 != <span class="hljs-number">-1073741795</span> || dword_40B1DC &gt;= <span class="hljs-built_in">strlen</span>(Str) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  byte_40B2E0[dword_40B1DC] = ++dword_40B1D8 ^ Str[dword_40B1DC] ^ <span class="hljs-number">0xAA</span>;<br>  <span class="hljs-keyword">if</span> ( sub_4010CD() )<br>  &#123;<br>    rand();<br>    v3 = sub_401177();<br>    byte_40B260[dword_40B1D8 % <span class="hljs-built_in">strlen</span>(Str)] = v3;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    *(_DWORD *)(a3 + <span class="hljs-number">184</span>) += <span class="hljs-number">2</span>;<br>    ++dword_40B360;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>并且这里还调用了 sub_401186 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">00401F</span>60                 push    offset sub_401186<br>.text:<span class="hljs-number">00401F</span>65                 push    large dword ptr fs:<span class="hljs-number">0</span><br>.text:<span class="hljs-number">00401F</span>6C                 mov     large fs:<span class="hljs-number">0</span>, esp<br>.text:<span class="hljs-number">00401F</span>73                 xor     ecx, ecx<br>.text:<span class="hljs-number">00401F</span>75                 mov     eax, <span class="hljs-number">1</span><br>.text:<span class="hljs-number">00401F</span>7A                 div     ecx<br>.text:<span class="hljs-number">00401F</span>7C                 mov     eax, [esp+<span class="hljs-number">0E0</span>h+var_E0]<br>.text:<span class="hljs-number">00401F</span>7F                 mov     large fs:<span class="hljs-number">0</span>, eax<br></code></pre></td></tr></table></figure>

<p>跟进 sub_401186 ，进行加法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_402010</span><span class="hljs-params">(_DWORD *a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// bl</span><br><br>  <span class="hljs-keyword">if</span> ( *a1 != <span class="hljs-number">-1073741676</span> || dword_40B1DC &gt;= <span class="hljs-built_in">strlen</span>(&amp;Str) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  byte_40B2E0[dword_40B1DC] += ++dword_40B1D8 % <span class="hljs-number">0x100</span>u + dword_40B1DC * dword_40B1DC;<br>  <span class="hljs-keyword">if</span> ( sub_4010CD() )<br>  &#123;<br>    rand();<br>    v3 = sub_401177();<br>    byte_40B260[dword_40B1D8 % <span class="hljs-built_in">strlen</span>(&amp;Str)] = v3;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    *(_DWORD *)(a3 + <span class="hljs-number">184</span>) += <span class="hljs-number">2</span>;<br>    ++dword_40B360;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>并且也调用了 sub_401181</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:004020DD                 push    offset sub_401181<br>.text:004020E2                 push    large dword ptr fs:0<br>.text:004020E9                 mov     large fs:0, esp<br>.text:004020F0                 xor     eax, eax<br>.text:004020F2                 mov     al, [eax]<br>.text:004020F4                 mov     eax, [esp+0E0h+var_E0]<br>.text:004020F7                 mov     large fs:0, eax<br></code></pre></td></tr></table></figure>

<p>sub_401181 这边进行了循环移动</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_402190</span><span class="hljs-params">(_DWORD *a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+E8h] [ebp-8h]</span><br><br>  sub_40123A(&amp;unk_40D0A4);<br>  <span class="hljs-keyword">if</span> ( *a1 != <span class="hljs-number">-1073741819</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  v5 = dword_40B1DC;<br>  <span class="hljs-keyword">if</span> ( dword_40B1DC &gt;= <span class="hljs-built_in">strlen</span>(Str) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  ++dword_40B1D8;<br>  <span class="hljs-keyword">if</span> ( sub_4010CD() )<br>  &#123;<br>    rand();<br>    v3 = sub_401177();<br>    byte_40B260[dword_40B1D8 % <span class="hljs-built_in">strlen</span>(Str)] = v3;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    byte_40B260[v5] = ((<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)byte_40B2E0[v5] &gt;&gt; <span class="hljs-number">5</span>) | (<span class="hljs-number">8</span> * byte_40B2E0[v5]);<br>    *(_DWORD *)(a3 + <span class="hljs-number">184</span>) += <span class="hljs-number">2</span>;<br>    ++dword_40B360;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>加密比较简单，动调获取密文，主要是 SEH 处理，解密脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_char</span>(<span class="hljs-params">c, i, cnt</span>):<br>    v = <span class="hljs-built_in">ord</span>(c)<br>    rol3 = <span class="hljs-keyword">lambda</span> x: ((x &gt;&gt; <span class="hljs-number">5</span>) | (x &lt;&lt; <span class="hljs-number">3</span>)) &amp; <span class="hljs-number">0xFF</span><br><br>    ops = &#123;<br>        <span class="hljs-number">1</span>: <span class="hljs-keyword">lambda</span> v, cnt: ((cnt ^ v ^ <span class="hljs-number">0xAA</span>) &amp; <span class="hljs-number">0xFF</span>, <span class="hljs-literal">None</span>),<br>        <span class="hljs-number">2</span>: <span class="hljs-keyword">lambda</span> v, cnt: ((v + (cnt % <span class="hljs-number">256</span> + i * i)) &amp; <span class="hljs-number">0xFF</span>, <span class="hljs-literal">None</span>),<br>        <span class="hljs-number">3</span>: <span class="hljs-keyword">lambda</span> v, cnt: (v, rol3(v)),<br>    &#125;<br><br>    out = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>):<br>        cnt += <span class="hljs-number">1</span><br>        v, tmp = ops[step](v, cnt)<br>        <span class="hljs-keyword">if</span> tmp <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            out = tmp<br>        cnt ^= <span class="hljs-number">0x1A373</span><br>    <span class="hljs-keyword">return</span> out, cnt<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">cipher</span>):<br>    res = []<br>    cnt = <span class="hljs-number">0x1A373</span><br><br>    <span class="hljs-keyword">for</span> i, t <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(cipher):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            enc, new_cnt = encrypt_char(<span class="hljs-built_in">chr</span>(x), i, cnt)<br>            <span class="hljs-keyword">if</span> enc == t:<br>                res.append(<span class="hljs-built_in">chr</span>(x))<br>                cnt = new_cnt<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            res.append(<span class="hljs-string">&#x27;?&#x27;</span>)<br>            _, cnt = encrypt_char(<span class="hljs-string">&#x27;A&#x27;</span>, i, cnt)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(res)<br><br><br>cipher = [<br>    <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x9F</span>,<br>    <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x9C</span>,<br>    <span class="hljs-number">0x71</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x0A</span>,<br>    <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x99</span><br>]<br><br><span class="hljs-built_in">print</span>(decrypt(cipher))<br></code></pre></td></tr></table></figure>

<p>拿到 flag</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">SYC&#123;<span class="hljs-symbol">M@</span>y_bE_m3et_HeR_1s_A_Err0R&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ez-Android"><a href="#ez-Android" class="headerlink" title="ez_Android"></a>ez_Android</h1><p>加密的 flag 密文在 res&#x2F;raw 中，function1 为 des 加密，key 为 12345678</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.syc;<br><br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-comment">/* loaded from: classes.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">function1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">function1</span><span class="hljs-params">(String input1)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">byte</span>[] data = input1.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> data.length;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">padLen</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span> - (len % <span class="hljs-number">8</span>);<br>            <span class="hljs-type">byte</span>[] padded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[len + padLen];<br>            System.arraycopy(data, <span class="hljs-number">0</span>, padded, <span class="hljs-number">0</span>, len);<br>            <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">keySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;12345678&quot;</span>.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>), <span class="hljs-string">&quot;DES&quot;</span>);<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;DES/ECB/NoPadding&quot;</span>);<br>            cipher.init(<span class="hljs-number">1</span>, keySpec);<br>            <span class="hljs-type">byte</span>[] encrypted = cipher.doFinal(padded);<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span> b : encrypted) &#123;<br>                sb.append(String.format(<span class="hljs-string">&quot;%02X&quot;</span>, Byte.valueOf(b)));<br>            &#125;<br>            <span class="hljs-keyword">return</span> sb.toString();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://img.dkdun.cn/v1/2025/12/fa8f4acdfc577f59.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Th1s_1s_<br></code></pre></td></tr></table></figure>

<p>function2，JNI_onLoad 动态调用了真正的 so，获取真正加载的 so</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">JNI_OnLoad</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">if</span> ( (*(*a1 + <span class="hljs-number">48LL</span>))(a1, v3, <span class="hljs-number">65542LL</span>) )<br>  &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    load_real_so(<span class="hljs-string">&quot;/data/data/com.example.syc/files/libreal_tmp.so&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">65542</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>load_real_so 加载真实 so 的 wrapper，它从内存中解密内置的 encrypted_so →-&gt;写入临时文件 -&gt; dlopen -&gt; dlsym 加载真正的 JNI 方法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">load_real_so</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *handle; <span class="hljs-comment">// [rsp+8h] [rbp-88h]</span><br>  <span class="hljs-type">int</span> fd; <span class="hljs-comment">// [rsp+14h] [rbp-7Ch]</span><br>  <span class="hljs-type">void</span> *ptr; <span class="hljs-comment">// [rsp+18h] [rbp-78h]</span><br><br>  ptr = <span class="hljs-built_in">malloc</span>(encrypted_so_len);<br>  <span class="hljs-keyword">if</span> ( ptr )<br>  &#123;<br>    __memcpy_chk(ptr, &amp;encrypted_so, encrypted_so_len, <span class="hljs-number">-1LL</span>);<br>    decrypt_xor(ptr, encrypted_so_len, <span class="hljs-number">170LL</span>);<br>    fd = open(a1, <span class="hljs-number">578</span>, <span class="hljs-number">448LL</span>);<br>    <span class="hljs-keyword">if</span> ( fd &gt;= <span class="hljs-number">0</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( __write_chk(fd, ptr, encrypted_so_len, <span class="hljs-number">-1LL</span>) == encrypted_so_len )<br>      &#123;<br>        close(fd);<br>        <span class="hljs-built_in">free</span>(ptr);<br>        handle = dlopen(a1, <span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">if</span> ( handle )<br>        &#123;<br>          qword_AEE8 = dlsym(handle, <span class="hljs-string">&quot;Java_com_example_syc_function2_function2&quot;</span>);<br>          <span class="hljs-keyword">if</span> ( qword_AEE8 )<br>          &#123;<br>            __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;Real SO loaded successfully!&quot;</span>);<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            v6 = dlerror();<br>            __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;dlsym error: %s&quot;</span>, v6);<br>            dlclose(handle);<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v5 = dlerror();<br>          __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;dlopen error: %s&quot;</span>, v5);<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v3 = __errno();<br>        v4 = strerror(*v3);<br>        __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;write failed: %s&quot;</span>, v4);<br>        close(fd);<br>        <span class="hljs-built_in">free</span>(ptr);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v1 = __errno();<br>      v2 = strerror(*v1);<br>      __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;open tmp file failed: %s&quot;</span>, v2);<br>      <span class="hljs-built_in">free</span>(ptr);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    __android_log_print(<span class="hljs-number">3LL</span>, <span class="hljs-string">&quot;wrapper&quot;</span>, <span class="hljs-string">&quot;malloc failed&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解密 so 脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys, os<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">3</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Usage: python3 find_xor_elf_aa.py &lt;inputfile&gt; &lt;outprefix&gt;&quot;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br><br>infile = sys.argv[<span class="hljs-number">1</span>]<br>prefix = sys.argv[<span class="hljs-number">2</span>]<br>key = <span class="hljs-number">0xAA</span><br>magic = <span class="hljs-string">b&#x27;\x7fELF&#x27;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(infile, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = f.read()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;File <span class="hljs-subst">&#123;infile&#125;</span> size <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span> bytes. Scanning for XOR 0x<span class="hljs-subst">&#123;key:02X&#125;</span> -&gt; ELF magic&quot;</span>)<br><br>hits = []<br><span class="hljs-keyword">for</span> off <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data) - <span class="hljs-number">4</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">bytes</span>([data[off+i] ^ key <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]) == magic:<br>        hits.append(off)<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> hits:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No hits found for key 0xAA.&quot;</span>)<br>    sys.exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(hits)&#125;</span> hit(s) at offsets: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;, &#x27;</span>.join(<span class="hljs-built_in">hex</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> hits)&#125;</span>&quot;</span>)<br><span class="hljs-keyword">for</span> off <span class="hljs-keyword">in</span> hits:<br>    outname = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;prefix&#125;</span>_<span class="hljs-subst">&#123;off:08X&#125;</span>_aa.so&quot;</span><br>    cand = <span class="hljs-built_in">bytes</span>([b ^ key <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> data[off:]])<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(outname, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> out:<br>        out.write(cand)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Wrote <span class="hljs-subst">&#123;outname&#125;</span> (size <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(cand)&#125;</span> bytes)&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done.&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<p><img src="https://img.dkdun.cn/v1/2025/12/5aa60d8ae8d989e0.png"></p>
<p>分析发现 function2 是标准 rc4 加密，key 为 mysecret，解出来</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-symbol">Th3_R3@</span>l<br></code></pre></td></tr></table></figure>

<p>function3 是 des，但是被魔改了，提取其中数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct, sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rint</span>(<span class="hljs-params">f,o,n</span>):<br>    f.seek(o);<span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(struct.unpack(<span class="hljs-string">f&#x27;&lt;<span class="hljs-subst">&#123;n&#125;</span>I&#x27;</span>,f.read(n*<span class="hljs-number">4</span>)))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rbytes</span>(<span class="hljs-params">f,o,n</span>):<br>    f.seek(o);<span class="hljs-keyword">return</span> f.read(n)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr_arr</span>(<span class="hljs-params">name,arr,w</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> &#123;&#123;&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(arr),w):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    &quot;</span> + <span class="hljs-string">&quot;, &quot;</span>.join(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;x:3d&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr[i:i+w]) + <span class="hljs-string">&quot;,&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;;\n&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr_box</span>(<span class="hljs-params">name,arr</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;name&#125;</span> = &#123;&#123;&quot;</span>)<br>    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;    &#123;&#123; // S<span class="hljs-subst">&#123;b+<span class="hljs-number">1</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            s=b*<span class="hljs-number">64</span>+r*<span class="hljs-number">16</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;        &quot;</span> + <span class="hljs-string">&quot;, &quot;</span>.join(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;arr[s+i]:2d&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)) + <span class="hljs-string">&quot;,&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;    &#125;,&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;;\n&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract</span>(<span class="hljs-params">p</span>):<br>    f=<span class="hljs-built_in">open</span>(p,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>    f.seek(<span class="hljs-number">0x20</span>);phoff=struct.unpack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>,f.read(<span class="hljs-number">8</span>))[<span class="hljs-number">0</span>]<br>    f.seek(<span class="hljs-number">0x36</span>);phnum=struct.unpack(<span class="hljs-string">&#x27;&lt;H&#x27;</span>,f.read(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br>    ro_offset=<span class="hljs-number">0</span>;ro_vaddr=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(phnum):<br>        o=phoff+i*<span class="hljs-number">0x38</span><br>        f.seek(o);t=struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>,f.read(<span class="hljs-number">4</span>))[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> t==<span class="hljs-number">1</span>:<br>            f.seek(o+<span class="hljs-number">8</span>);off=struct.unpack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>,f.read(<span class="hljs-number">8</span>))[<span class="hljs-number">0</span>]<br>            va=struct.unpack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>,f.read(<span class="hljs-number">8</span>))[<span class="hljs-number">0</span>]<br>            sz=struct.unpack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>,f.read(<span class="hljs-number">8</span>))[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">if</span> va&lt;=<span class="hljs-number">0x1520</span>&lt;va+sz:<br>                ro_offset,ro_vaddr=off,va<br>                <span class="hljs-keyword">break</span><br>    v2f=<span class="hljs-keyword">lambda</span> x:x-ro_vaddr+ro_offset<br><br>    f=<span class="hljs-built_in">open</span>(p,<span class="hljs-string">&#x27;rb&#x27;</span>)<br><br>    key=rbytes(f,v2f(<span class="hljs-number">0x1520</span>),<span class="hljs-number">8</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;unsigned char key[8] = &#123;&quot;</span> + <span class="hljs-string">&quot;, &quot;</span>.join(<span class="hljs-string">f&quot;0x<span class="hljs-subst">&#123;b:02X&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> key) + <span class="hljs-string">&quot;&#125;;\n&quot;</span>)<br><br>    pr_arr(<span class="hljs-string">&quot;int PC1[56] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x800</span>),<span class="hljs-number">56</span>),<span class="hljs-number">8</span>)<br>    shifts=rint(f,v2f(<span class="hljs-number">0x8E0</span>),<span class="hljs-number">16</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;int SHIFTS[16] = &#123;&quot;</span> + <span class="hljs-string">&quot;, &quot;</span>.join(<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> shifts) + <span class="hljs-string">&quot;&#125;;\n&quot;</span>)<br>    pr_arr(<span class="hljs-string">&quot;int PC2[48] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x920</span>),<span class="hljs-number">48</span>),<span class="hljs-number">8</span>)<br>    pr_arr(<span class="hljs-string">&quot;int E[48] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x9E0</span>),<span class="hljs-number">48</span>),<span class="hljs-number">8</span>)<br>    pr_box(<span class="hljs-string">&quot;int SBOX[8][64]&quot;</span>, rint(f,v2f(<span class="hljs-number">0xAA0</span>),<span class="hljs-number">512</span>))<br>    pr_arr(<span class="hljs-string">&quot;int P[32] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x12A0</span>),<span class="hljs-number">32</span>),<span class="hljs-number">8</span>)<br>    pr_arr(<span class="hljs-string">&quot;int IP[64] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x1320</span>),<span class="hljs-number">64</span>),<span class="hljs-number">8</span>)<br>    pr_arr(<span class="hljs-string">&quot;int FP[64] =&quot;</span>, rint(f,v2f(<span class="hljs-number">0x1420</span>),<span class="hljs-number">64</span>),<span class="hljs-number">8</span>)<br><br>extract(sys.argv[<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>

<p>这是一个魔改的 des，解密脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python">KEY = <span class="hljs-built_in">bytes</span>([<span class="hljs-number">0x13</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xF1</span>])<br>CIPHERTEXT = <span class="hljs-built_in">bytes</span>([<span class="hljs-number">0xAE</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA7</span>])<br><br>PC1 = [<span class="hljs-number">57</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">33</span>,<span class="hljs-number">25</span>,<span class="hljs-number">17</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">58</span>,<span class="hljs-number">50</span>,<span class="hljs-number">42</span>,<span class="hljs-number">34</span>,<span class="hljs-number">26</span>,<span class="hljs-number">18</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,<span class="hljs-number">59</span>,<span class="hljs-number">51</span>,<span class="hljs-number">43</span>,<span class="hljs-number">35</span>,<span class="hljs-number">27</span>,<span class="hljs-number">19</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">60</span>,<span class="hljs-number">52</span>,<span class="hljs-number">44</span>,<span class="hljs-number">36</span>,<span class="hljs-number">63</span>,<span class="hljs-number">55</span>,<span class="hljs-number">47</span>,<span class="hljs-number">39</span>,<span class="hljs-number">31</span>,<span class="hljs-number">23</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>,<span class="hljs-number">62</span>,<span class="hljs-number">54</span>,<span class="hljs-number">46</span>,<span class="hljs-number">38</span>,<span class="hljs-number">30</span>,<span class="hljs-number">22</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">61</span>,<span class="hljs-number">53</span>,<span class="hljs-number">45</span>,<span class="hljs-number">37</span>,<span class="hljs-number">29</span>,<span class="hljs-number">21</span>,<span class="hljs-number">13</span>,<span class="hljs-number">5</span>,<span class="hljs-number">28</span>,<span class="hljs-number">20</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>]<br>SHIFTS = [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]<br>PC2 = [<span class="hljs-number">14</span>,<span class="hljs-number">17</span>,<span class="hljs-number">11</span>,<span class="hljs-number">24</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">28</span>,<span class="hljs-number">15</span>,<span class="hljs-number">6</span>,<span class="hljs-number">21</span>,<span class="hljs-number">10</span>,<span class="hljs-number">23</span>,<span class="hljs-number">19</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">26</span>,<span class="hljs-number">8</span>,<span class="hljs-number">16</span>,<span class="hljs-number">7</span>,<span class="hljs-number">27</span>,<span class="hljs-number">20</span>,<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">41</span>,<span class="hljs-number">52</span>,<span class="hljs-number">31</span>,<span class="hljs-number">37</span>,<span class="hljs-number">47</span>,<span class="hljs-number">55</span>,<span class="hljs-number">30</span>,<span class="hljs-number">40</span>,<span class="hljs-number">51</span>,<span class="hljs-number">45</span>,<span class="hljs-number">33</span>,<span class="hljs-number">48</span>,<span class="hljs-number">44</span>,<span class="hljs-number">49</span>,<span class="hljs-number">39</span>,<span class="hljs-number">56</span>,<span class="hljs-number">34</span>,<span class="hljs-number">53</span>,<span class="hljs-number">46</span>,<span class="hljs-number">42</span>,<span class="hljs-number">50</span>,<span class="hljs-number">36</span>,<span class="hljs-number">29</span>,<span class="hljs-number">32</span>]<br>E = [<span class="hljs-number">32</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>,<span class="hljs-number">23</span>,<span class="hljs-number">24</span>,<span class="hljs-number">25</span>,<span class="hljs-number">24</span>,<span class="hljs-number">25</span>,<span class="hljs-number">26</span>,<span class="hljs-number">27</span>,<span class="hljs-number">28</span>,<span class="hljs-number">29</span>,<span class="hljs-number">28</span>,<span class="hljs-number">29</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">32</span>,<span class="hljs-number">1</span>]<br>P = [<span class="hljs-number">16</span>,<span class="hljs-number">7</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">29</span>,<span class="hljs-number">12</span>,<span class="hljs-number">28</span>,<span class="hljs-number">17</span>,<span class="hljs-number">1</span>,<span class="hljs-number">15</span>,<span class="hljs-number">23</span>,<span class="hljs-number">26</span>,<span class="hljs-number">5</span>,<span class="hljs-number">18</span>,<span class="hljs-number">31</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">24</span>,<span class="hljs-number">14</span>,<span class="hljs-number">32</span>,<span class="hljs-number">27</span>,<span class="hljs-number">3</span>,<span class="hljs-number">9</span>,<span class="hljs-number">19</span>,<span class="hljs-number">13</span>,<span class="hljs-number">30</span>,<span class="hljs-number">6</span>,<span class="hljs-number">22</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">25</span>]<br>IP = [<span class="hljs-number">58</span>,<span class="hljs-number">50</span>,<span class="hljs-number">42</span>,<span class="hljs-number">34</span>,<span class="hljs-number">26</span>,<span class="hljs-number">18</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,<span class="hljs-number">60</span>,<span class="hljs-number">52</span>,<span class="hljs-number">44</span>,<span class="hljs-number">36</span>,<span class="hljs-number">28</span>,<span class="hljs-number">20</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">62</span>,<span class="hljs-number">54</span>,<span class="hljs-number">46</span>,<span class="hljs-number">38</span>,<span class="hljs-number">30</span>,<span class="hljs-number">22</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">64</span>,<span class="hljs-number">56</span>,<span class="hljs-number">48</span>,<span class="hljs-number">40</span>,<span class="hljs-number">32</span>,<span class="hljs-number">24</span>,<span class="hljs-number">16</span>,<span class="hljs-number">8</span>,<span class="hljs-number">57</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">33</span>,<span class="hljs-number">25</span>,<span class="hljs-number">17</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">59</span>,<span class="hljs-number">51</span>,<span class="hljs-number">43</span>,<span class="hljs-number">35</span>,<span class="hljs-number">27</span>,<span class="hljs-number">19</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">61</span>,<span class="hljs-number">53</span>,<span class="hljs-number">45</span>,<span class="hljs-number">37</span>,<span class="hljs-number">29</span>,<span class="hljs-number">21</span>,<span class="hljs-number">13</span>,<span class="hljs-number">5</span>,<span class="hljs-number">63</span>,<span class="hljs-number">55</span>,<span class="hljs-number">47</span>,<span class="hljs-number">39</span>,<span class="hljs-number">31</span>,<span class="hljs-number">23</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>]<br>FP = [<span class="hljs-number">40</span>,<span class="hljs-number">8</span>,<span class="hljs-number">48</span>,<span class="hljs-number">16</span>,<span class="hljs-number">56</span>,<span class="hljs-number">24</span>,<span class="hljs-number">64</span>,<span class="hljs-number">32</span>,<span class="hljs-number">39</span>,<span class="hljs-number">7</span>,<span class="hljs-number">47</span>,<span class="hljs-number">15</span>,<span class="hljs-number">55</span>,<span class="hljs-number">23</span>,<span class="hljs-number">63</span>,<span class="hljs-number">31</span>,<span class="hljs-number">38</span>,<span class="hljs-number">6</span>,<span class="hljs-number">46</span>,<span class="hljs-number">14</span>,<span class="hljs-number">54</span>,<span class="hljs-number">22</span>,<span class="hljs-number">62</span>,<span class="hljs-number">30</span>,<span class="hljs-number">37</span>,<span class="hljs-number">5</span>,<span class="hljs-number">45</span>,<span class="hljs-number">13</span>,<span class="hljs-number">53</span>,<span class="hljs-number">21</span>,<span class="hljs-number">61</span>,<span class="hljs-number">29</span>,<span class="hljs-number">36</span>,<span class="hljs-number">4</span>,<span class="hljs-number">44</span>,<span class="hljs-number">12</span>,<span class="hljs-number">52</span>,<span class="hljs-number">20</span>,<span class="hljs-number">60</span>,<span class="hljs-number">28</span>,<span class="hljs-number">35</span>,<span class="hljs-number">3</span>,<span class="hljs-number">43</span>,<span class="hljs-number">11</span>,<span class="hljs-number">51</span>,<span class="hljs-number">19</span>,<span class="hljs-number">59</span>,<span class="hljs-number">27</span>,<span class="hljs-number">34</span>,<span class="hljs-number">2</span>,<span class="hljs-number">42</span>,<span class="hljs-number">10</span>,<span class="hljs-number">50</span>,<span class="hljs-number">18</span>,<span class="hljs-number">58</span>,<span class="hljs-number">26</span>,<span class="hljs-number">33</span>,<span class="hljs-number">1</span>,<span class="hljs-number">41</span>,<span class="hljs-number">9</span>,<span class="hljs-number">49</span>,<span class="hljs-number">17</span>,<span class="hljs-number">57</span>,<span class="hljs-number">25</span>]<br><br>SBOX = [<br>    [<span class="hljs-number">14</span>,<span class="hljs-number">4</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">11</span>,<span class="hljs-number">8</span>,<span class="hljs-number">3</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">14</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">3</span>,<span class="hljs-number">10</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">12</span>,<span class="hljs-number">8</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">14</span>,<span class="hljs-number">10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">13</span>],<br>    [<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">13</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">15</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">14</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>],<br>    [<span class="hljs-number">10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">14</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">15</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">15</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>],<br>    [<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">14</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">14</span>],<br>    [<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">11</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">15</span>,<span class="hljs-number">9</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">11</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>],<br>    [<span class="hljs-number">12</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>,<span class="hljs-number">13</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">15</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">14</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">6</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>],<br>    [<span class="hljs-number">4</span>,<span class="hljs-number">11</span>,<span class="hljs-number">2</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">3</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">12</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">10</span>,<span class="hljs-number">7</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">12</span>],<br>    [<span class="hljs-number">0</span>]*<span class="hljs-number">64</span><br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bytes_to_bits</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">return</span> [(byte &gt;&gt; (<span class="hljs-number">7</span>-i)) &amp; <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bits_to_bytes</span>(<span class="hljs-params">bits</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>([<span class="hljs-built_in">sum</span>(bits[i*<span class="hljs-number">8</span>+j] &lt;&lt; (<span class="hljs-number">7</span>-j) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(bits)//<span class="hljs-number">8</span>)])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">permute</span>(<span class="hljs-params">bits, table</span>):<br>    <span class="hljs-keyword">return</span> [bits[i-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor_bits</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> [x ^ y <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">left_shift_32bit</span>(<span class="hljs-params">a_bytes, n</span>):<br>    val = <span class="hljs-built_in">int</span>.from_bytes(a_bytes, <span class="hljs-string">&#x27;big&#x27;</span>)<br>    val = ((val &lt;&lt; n) | (val &gt;&gt; (<span class="hljs-number">32</span> - n))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> val.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_subkeys_modified</span>(<span class="hljs-params">key_bytes</span>):<br>    key_bits = bytes_to_bits(key_bytes)<br>    pc1_bits = permute(key_bits, PC1)<br>    s_bytes = bits_to_bytes(pc1_bits)<br>    C = s_bytes[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]<br>    D = s_bytes[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>]<br>    subkeys = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        C = left_shift_32bit(C, SHIFTS[i])<br>        D = left_shift_32bit(D, SHIFTS[i])<br>        cd_bytes = C[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>] + D[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]<br>        cd_bits = bytes_to_bits(cd_bytes)<br>        subkeys.append(permute(cd_bits, PC2))<br>    <span class="hljs-keyword">return</span> subkeys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s_box_modified</span>(<span class="hljs-params">bits48</span>):<br>    result_val = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        block = bits48[j*<span class="hljs-number">6</span> : (j+<span class="hljs-number">1</span>)*<span class="hljs-number">6</span>]<br>        row = (block[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">1</span>) | block[<span class="hljs-number">5</span>]<br>        col = (block[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">3</span>) | (block[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">2</span>) | (block[<span class="hljs-number">3</span>] &lt;&lt; <span class="hljs-number">1</span>) | block[<span class="hljs-number">4</span>]<br>        val = SBOX[j][row * <span class="hljs-number">16</span> + col]<br>        <span class="hljs-keyword">if</span> j % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            result_val |= (val &lt;&lt; (<span class="hljs-number">28</span> - j//<span class="hljs-number">2</span> * <span class="hljs-number">8</span>))<br>        <span class="hljs-keyword">else</span>:<br>            result_val |= (val &lt;&lt; (<span class="hljs-number">24</span> - j//<span class="hljs-number">2</span> * <span class="hljs-number">8</span>))<br>    <span class="hljs-keyword">return</span> bytes_to_bits(result_val.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;big&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">feistel</span>(<span class="hljs-params">R, subkey</span>):<br>    expanded = permute(R, E)<br>    xored = xor_bits(expanded, subkey)<br>    substituted = s_box_modified(xored)<br>    <span class="hljs-keyword">return</span> permute(substituted, P)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">des_decrypt</span>(<span class="hljs-params">ciphertext, key</span>):<br>    cipher_bits = bytes_to_bits(ciphertext)<br>    subkeys = generate_subkeys_modified(key)<br>    ip_result = permute(cipher_bits, IP)<br>    L, R = ip_result[:<span class="hljs-number">32</span>], ip_result[<span class="hljs-number">32</span>:]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        L, R = R, xor_bits(L, feistel(R, subkeys[<span class="hljs-number">15</span> - i]))<br>    combined = R + L<br>    <span class="hljs-keyword">return</span> bits_to_bytes(permute(combined, FP))<br><br>flag = des_decrypt(CIPHERTEXT, KEY)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p>拿到最后部分</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">ly_F1ag!<br></code></pre></td></tr></table></figure>

<p>拼好 flag</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">SYC&#123;<span class="hljs-symbol">Th1s_1s_Th3_R3@</span>lly_F1ag!&#125;<br></code></pre></td></tr></table></figure>

<h1 id="reReverse"><a href="#reReverse" class="headerlink" title="reReverse"></a>reReverse</h1><p>这个题用了信号处理混淆和 xxtea</p>
<p>这里的 init 函数为入口</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a1, __int64 a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-type">signed</span> __int64 v4; <span class="hljs-comment">// rbp</span><br>  __int64 i; <span class="hljs-comment">// rbx</span><br><br>  init_proc();<br>  v4 = &amp;off_402DD8 - &amp;funcs_400FC9;<br>  <span class="hljs-keyword">if</span> ( v4 )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i != v4; ++i )<br>      (*(&amp;funcs_400FC9 + i))(a1, a2, a3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进来到 sub_400810，自定义了一个 SIGTRAP 信号函数 sub_400EF</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">sub_400810</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v0; <span class="hljs-comment">// kr00_8</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> <span class="hljs-title">v2</span>;</span> <span class="hljs-comment">// [rsp+8h] [rbp-A8h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+A0h] [rbp-10h]</span><br><br>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(&amp;v2.sa_mask, <span class="hljs-number">0</span>, <span class="hljs-number">0x90</span>uLL);<br>  v2.sa_flags = <span class="hljs-number">4</span>;<br>  v2.sa_handler = sub_400EF0;<br>  <span class="hljs-keyword">if</span> ( sigaction(<span class="hljs-number">5</span>, &amp;v2, <span class="hljs-number">0LL</span>) &lt; <span class="hljs-number">0</span> )<br>    <span class="hljs-built_in">abort</span>();<br>  v0 = __readeflags();<br>  __writeeflags(v0 ^ <span class="hljs-number">0x100</span>);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>sub_400EF0  通过查询 bit 表 byte_403080 判断该地址是否需要处理，最终会造成代码倒退执行，调试会乱</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_400EF0</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// r8</span><br>  __int64 v6; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">unsigned</span> __int64 v7; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">unsigned</span> __int64 v8; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v9; <span class="hljs-comment">// cl</span><br><br>  result = *(a3 + <span class="hljs-number">168</span>);<br>  <span class="hljs-keyword">if</span> ( sub_400800 &lt;= result &amp;&amp; result &lt; byte_400FF5 )<br>  &#123;<br>    v4 = byte_403080[(result - sub_400800) &gt;&gt; <span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">if</span> ( _bittest(&amp;v4, (result - sub_400800) &amp; <span class="hljs-number">7</span>) )<br>    &#123;<br>      v5 = result - <span class="hljs-number">1</span>;<br>      v6 = <span class="hljs-number">0LL</span>;<br>      v7 = result + ~sub_400800;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8 = v7;<br>        v9 = v7--;<br>        v6 += (byte_403080[v8 &gt;&gt; <span class="hljs-number">3</span>] &gt;&gt; (v9 &amp; <span class="hljs-number">7</span>)) &amp; <span class="hljs-number">1</span>;<br>        result = v5--;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v6 != <span class="hljs-number">2</span> );<br>      *(a3 + <span class="hljs-number">168</span>) = result;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>倒着看，oc_400D8E 开始接收输入的字符，loc_400C80 有密钥常量和 tea 的 delta 值 9E3779B9h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">key -&gt; 0DEADh, 0BEEFh, 5A7Dh, 0C0FFh<br>delta -&gt; 9E3779B9h<br>ciper -&gt;<br>    0x2973BD37, # r9  (Input[0])<br>    0x1BA99AA3, # edi (Input[1])<br>    0xB3C20088, # esi (Input[2])<br>    0x0BFC393AB, # ecx (Input[3])<br>    0x352ADCCF, # edx (Input[4])<br>    0x3B98E6E6, # r8  (Input[5])<br>    0xAE421991, # ebx (Input[6])<br>    0xD7B702CF, # ebp (Input[7])<br>    0x0EEF6889, # r11 (Input[8])<br>    0x08662435  # r10 (Input[9])<br></code></pre></td></tr></table></figure>

<p>分析汇编根据 loc_400942 的左右移位和 xor 可以找到是 xxtea</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br>ciper = [<br>    <span class="hljs-number">0x2973bd37</span>, <span class="hljs-number">0x1ba99aa3</span>, <span class="hljs-number">0xb3c20088</span>, <span class="hljs-number">0xbfc393ab</span>, <span class="hljs-number">0x352adccf</span>,<br>    <span class="hljs-number">0x3b98e6e6</span>, <span class="hljs-number">0xae421991</span>, <span class="hljs-number">0xd7b702cf</span>, <span class="hljs-number">0x0eef6889</span>, <span class="hljs-number">0x08662435</span><br>]<br><br>key = [<span class="hljs-number">0xDEAD</span>, <span class="hljs-number">0xBEEF</span>, <span class="hljs-number">0x5A7D</span>, <span class="hljs-number">0xC0FF</span>]<br>DELTA = <span class="hljs-number">0x9E3779B9</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xxtea_dec</span>(<span class="hljs-params">v, k, delta=DELTA</span>):<br>    n = <span class="hljs-built_in">len</span>(v)<br>    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> v<br>    r = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // n<br>    s = (r + <span class="hljs-number">1</span>) * delta &amp; <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(r):<br>        s = (s - delta) &amp; <span class="hljs-number">0xffffffff</span><br>        e = (s &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>            y = v[(i+<span class="hljs-number">1</span>) % n]<br>            z = v[(i-<span class="hljs-number">1</span>) % n]<br>            mx = (((z&gt;&gt;<span class="hljs-number">5</span> ^ y&lt;&lt;<span class="hljs-number">2</span>) + (y&gt;&gt;<span class="hljs-number">3</span> ^ z&lt;&lt;<span class="hljs-number">4</span>)) ^ ((s ^ y) + (k[(i&amp;<span class="hljs-number">3</span>) ^ e] ^ z)))<br>            v[i] = (v[i] - mx) &amp; <span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> v<br><br>dres = xxtea_dec(ciper.copy(), key)<br>flag_bytes = <span class="hljs-string">b&quot;&quot;</span>.join(struct.pack(<span class="hljs-string">&quot;&lt;I&quot;</span>, x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> dres)<br><span class="hljs-built_in">print</span>(flag_bytes.rstrip(<span class="hljs-string">b&quot;\x00&quot;</span>).decode(<span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-string">&quot;ignore&quot;</span>))<br><br></code></pre></td></tr></table></figure>

<p>拿到 flag</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">SYC&#123;sakurakouji_runasam<span class="hljs-built_in">a_wa</span>_seikai_ichi&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h1><p>flutter 架构的 app，flutter 使用的是 dart 语言，并且采用了 dartVM 的方法进行拍摄快照，一般需要对 .so 文件进行快照解析，解析之后在 ida 中导入生成的脚本恢复符号表，但是这道题只需要看 libverify.so </p>
<p>sub_19550 是主要 VM 实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> __fastcall <span class="hljs-title function_">sub_19550</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// r13d</span><br>  <span class="hljs-type">unsigned</span> __int8 *v2; <span class="hljs-comment">// r14</span><br>  __int64 v3; <span class="hljs-comment">// r15</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// rbp</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span><br>  __int64 (__fastcall *v6)(); <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int8 *v7; <span class="hljs-comment">// r14</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v10; <span class="hljs-comment">// dl</span><br><br>  v2 = ptr;<br>  <span class="hljs-keyword">if</span> ( *(&amp;ptr + <span class="hljs-number">1</span>) == ptr )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  v3 = <span class="hljs-number">0LL</span>;<br>  v4 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v5 = v2[v3];<br>    <span class="hljs-keyword">if</span> ( v5 &gt; <span class="hljs-number">0xF</span> || (v6 = funcs_195B4[v5]) == <span class="hljs-number">0LL</span> )<br>    &#123;<br>      *(a1 + <span class="hljs-number">28</span>) = <span class="hljs-number">1</span>;<br>      v9 = <span class="hljs-number">2</span>;<br>      v10 = <span class="hljs-number">0</span>;<br>LABEL_9:<br>      v8 = v1;<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>    &#125;<br>    v7 = &amp;v2[v3];<br>    (v6)(a1, v7);<br>    v8 = *v7;<br>    v9 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( v8 == <span class="hljs-number">9</span> )<br>    &#123;<br>      v10 = <span class="hljs-number">0</span>;<br>      v8 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v8 == <span class="hljs-number">8</span> )<br>      &#123;<br>        LOBYTE(v8) = *(a1 + <span class="hljs-number">28</span>) == <span class="hljs-number">0</span>;<br>        v10 = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_10;<br>      &#125;<br>      v10 = <span class="hljs-number">0</span>;<br>      v8 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( !*(a1 + <span class="hljs-number">28</span>) )<br>      &#123;<br>        v10 = <span class="hljs-number">1</span>;<br>        v9 = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_9;<br>      &#125;<br>    &#125;<br>LABEL_10:<br>    <span class="hljs-keyword">if</span> ( !v10 )<br>      <span class="hljs-keyword">return</span> v8 &amp; (v9 != <span class="hljs-number">2</span>);<br>    ++v4;<br>    v2 = ptr;<br>    v3 += <span class="hljs-number">3LL</span>;<br>    v1 = v8;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v4 &lt; <span class="hljs-number">0xAAAAAAAAAAAAAAAB</span>LL * (*(&amp;ptr + <span class="hljs-number">1</span>) - ptr) );<br>  v9 = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">return</span> v8 &amp; (v9 != <span class="hljs-number">2</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>funcs_195B4 是 VM 根据 opcode 调用的函数表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.data.rel.ro:0000000000039E78 funcs_195B4     dq offset sub_1A1B0   // opcode 0 初始化 VM 状态                     <br>.data.rel.ro:0000000000039E80                 dq offset sub_1A1D0	// opcode 1	读取输入到 acc<br>.data.rel.ro:0000000000039E88                 dq offset sub_1A1F0	// opcode 2 acc -= arg1<br>.data.rel.ro:0000000000039E90                 dq offset sub_1A200	// opcode 3 acc ^= arg1<br>.data.rel.ro:0000000000039E98                 dq offset sub_1A210	// opcode 4 acc ^ byte_FC00[arg1] == 82<br>.data.rel.ro:0000000000039EA0                 dq offset sub_1A230	// opcode 5 index++<br>.data.rel.ro:0000000000039EA8                 dq offset sub_1A240	// opcode 6 检查 index ≤ agr1<br>.data.rel.ro:0000000000039EB0                 dq offset nullsub_2	// opcode 7 空操作<br>.data.rel.ro:0000000000039EB8                 dq offset sub_1A260	// opcode 8 检查 index == input_length<br>.data.rel.ro:0000000000039EC0                 dq offset sub_1A270	// opcode 9 结束<br></code></pre></td></tr></table></figure>

<p>校验函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> __fastcall <span class="hljs-title function_">sub_1A210</span><span class="hljs-params">(__int64 a1, __int64 a2)</span><br>&#123;<br>  <span class="hljs-type">char</span> result; <span class="hljs-comment">// al</span><br><br>  result = *(a1 + <span class="hljs-number">24</span>) ^ byte_FC00[*(a2 + <span class="hljs-number">1</span>)];<br>  <span class="hljs-keyword">if</span> ( result != <span class="hljs-number">82</span> )<br>    *(a1 + <span class="hljs-number">28</span>) = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>那么其实加解密流程如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">acc = ciper[i] (0x01)<br>acc -= 3 (0x02)<br>acc ^= 0x55 (0x03)<br>byte_FF92[i] ^ acc == 0x52 (0x04)<br>-&gt;<br>ciper[i] = (byte_FF92[i] ^ 0x07) + 3<br></code></pre></td></tr></table></figure>

<p>解密脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">byte_FF92 = [<br>    <span class="hljs-number">0x57</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x76</span>, <br>    <span class="hljs-number">0x76</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x5B</span>,<br>    <span class="hljs-number">0x55</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x68</span>, <br>    <span class="hljs-number">0x71</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x7D</span><br>]<br><br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> byte_FF92:<br>    val = (b ^ <span class="hljs-number">0x07</span>) + <span class="hljs-number">3</span><br>    flag += <span class="hljs-built_in">chr</span>(val)<br><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p>flag 如下</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">SYC&#123;<span class="hljs-symbol">F1utt3r_c@</span>n_Us3_ev3rywHer3!&#125;<br></code></pre></td></tr></table></figure>

<h1 id="国产の光"><a href="#国产の光" class="headerlink" title="国产の光"></a>国产の光</h1><p>Index 中找到比对的密文</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/a773a76ba4be3967.png"></p>
<p>通过本地的 AES 加密</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/3084800f3e138e58.png"></p>
<p>分析 check 这里，有两个 info 字符串传入</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/bf91604ce95e859c.png"></p>
<p>分析 libentry.so 有 AES-CBC 加密和 Base85</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/ec3a21cc410096e3.png"></p>
<p>标准 AES，key 为 “welcometosyc2025”，iv 为 “helloimsamsaramiao” ，直接解</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/51ae3701183213f8.png"></p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">SYC&#123;HarmonyOS_1s_right?<span class="hljs-built_in">right</span>!&#125;<br></code></pre></td></tr></table></figure>

<h1 id="obfuscat3"><a href="#obfuscat3" class="headerlink" title="obfuscat3"></a>obfuscat3</h1><p>算是魔改的 RC4，改的不算多，主要是混淆</p>
<p>密钥 ”arasmaS“，传入 obf_encode加密，输出和 cipher 的密文比较</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/2d1d77c39898932f.png"></p>
<p>这里重点的 obf_encode，混淆的一大堆可以不看，根据参数来定位关键，传入的 s 在此函数中为 *a1，那么这里定位到最后，进行了加法操作</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/01134e5b4c72855e.png"></p>
<p>跟进 init_encode，初始化 S 盒，exchange_encode 交换 S 盒元素</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/17081ea59ae609c6.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int8 __fastcall <span class="hljs-title function_">exchange_encode</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> __int8 *a1, <span class="hljs-type">unsigned</span> __int8 *a2)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int8 result; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [rsp+1h] [rbp-11h]</span><br><br>  v3 = *a1;<br>  *a1 = *a2;<br>  result = v3;<br>  *a2 = v3;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>因此可以知道这里是 RC4 的变种算法，将异或换成了加法，并且跟进函数调用可以发现 key 是 “Samsara”，也就是 v5 的逆向</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br>key_str = <span class="hljs-string">&quot;Samsara&quot;</span><br>key = [<span class="hljs-built_in">ord</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> key_str]<br>key_len = <span class="hljs-built_in">len</span>(key)<br>cipher_bytes = [<br>    <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x6A</span>,<br>    <span class="hljs-number">0x44</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x65</span>,<br>    <span class="hljs-number">0x06</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x0D</span>,<br>    <span class="hljs-number">0x60</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x92</span>,<br>    <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x7A</span>,<br>    <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xED</span>,<br>    <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x91</span>,<br>    <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x17</span>,<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x75</span>,<br>    <span class="hljs-number">0x72</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x0E</span>,<br>    <span class="hljs-number">0x69</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x8F</span>,<br>    <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xDC</span><br>]<br><br>S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>j = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    j = (j + S[i] + key[i % key_len]) % <span class="hljs-number">256</span><br>    S[i], S[j] = S[j], S[i]<br><br>i = <span class="hljs-number">0</span><br>j = <span class="hljs-number">0</span><br>plaintext = []<br><br><span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> cipher_bytes:<br>    i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>    j = (j + S[i]) % <span class="hljs-number">256</span><br>    S[i], S[j] = S[j], S[i]<br><br>    k = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>    pt_byte = (byte - k) % <span class="hljs-number">256</span><br>    plaintext.append(pt_byte)<br><br>decoded_bytes = <span class="hljs-built_in">bytes</span>(plaintext)<br>flag = decoded_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">SYC&#123;Alright<span class="hljs-number">_</span>I<span class="hljs-number">_</span>sti<span class="hljs-number">1</span>l<span class="hljs-number">_</span>h<span class="hljs-number">0p</span>e<span class="hljs-number">_</span>th<span class="hljs-number">3</span>t<span class="hljs-number">_</span>you<span class="hljs-number">_</span>solved<span class="hljs-number">_</span>the<span class="hljs-number">_</span>chall<span class="hljs-number">3n</span>ge<span class="hljs-number">_</span><span class="hljs-meta">by</span><span class="hljs-number">_</span>deobfuscating<span class="hljs-number">_</span>them<span class="hljs-number">_G</span>eek<span class="hljs-number">_</span><span class="hljs-keyword">is</span><span class="hljs-number">_</span>just<span class="hljs-number">_</span>the<span class="hljs-number">_f</span>irst<span class="hljs-number">_</span>step<span class="hljs-number">_</span><span class="hljs-keyword">of</span><span class="hljs-number">_</span>your<span class="hljs-number">_</span>CTF<span class="hljs-number">_</span>journey<span class="hljs-number">_</span>Im<span class="hljs-number">_</span>glad<span class="hljs-number">_</span>I<span class="hljs-number">_</span>could<span class="hljs-number">_</span>be<span class="hljs-number">_p</span>art<span class="hljs-number">_</span><span class="hljs-keyword">of</span><span class="hljs-number">_</span>your<span class="hljs-number">_</span>growth<span class="hljs-number">_G</span>ood<span class="hljs-number">_</span>luck<span class="hljs-number">_f</span>or<span class="hljs-number">_</span>y<span class="hljs-number">0u</span>!&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Last-one"><a href="#Last-one" class="headerlink" title="Last_one"></a>Last_one</h1><p>sub_403A80 要求在 64-bit Windows 以 32-bit 模式运行，这就是 WoW64 机制，天堂之门</p>
<p>sub_402330 这里对 Buffer 的字节进行了变换，unk_40C040 是 8 段 VM 字节码，对应 off_40C000 是一个调用函数的表</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __cdecl <span class="hljs-title function_">sub_402330</span><span class="hljs-params">(<span class="hljs-type">int</span> a1)</span><br>&#123;<br>  __int64 v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// edx</span><br>  __int64 v4; <span class="hljs-comment">// [esp-8h] [ebp-CC0h]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-CB8h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+3E8h] [ebp-8D0h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+3F4h] [ebp-8C4h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+400h] [ebp-8B8h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+40Ch] [ebp-8ACh]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+418h] [ebp-8A0h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+424h] [ebp-894h]</span><br>  <span class="hljs-type">void</span> *lpAddress; <span class="hljs-comment">// [esp+458h] [ebp-860h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp+464h] [ebp-854h] BYREF</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [esp+468h] [ebp-850h]</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [esp+46Ch] [ebp-84Ch]</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [esp+470h] [ebp-848h]</span><br>  <span class="hljs-type">int</span> savedregs; <span class="hljs-comment">// [esp+CB8h] [ebp+0h] BYREF</span><br><br>  VirtualAlloc(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>u, <span class="hljs-number">0x3000</span>u, <span class="hljs-number">0x40</span>u);<br>  lpAddress = (<span class="hljs-type">void</span> *)sub_401186();<br>  <span class="hljs-keyword">if</span> ( lpAddress )<br>  &#123;<br>    <span class="hljs-built_in">memcpy</span>(lpAddress, &amp;unk_40C260, <span class="hljs-number">0x38</span>u);<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i )<br>      *((_BYTE *)lpAddress + i + <span class="hljs-number">2</span>) = sub_40105A(<span class="hljs-number">8</span> * i, <span class="hljs-number">0</span>);<br>    ::lpAddress = (<span class="hljs-type">int</span> (__cdecl *)(_DWORD, _DWORD, _DWORD))lpAddress;<br>    *((_WORD *)&amp;::lpAddress + <span class="hljs-number">2</span>) = <span class="hljs-number">51</span>;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; ++j )<br>    &#123;<br>      sub_4010B4(&amp;v13);<br>      <span class="hljs-keyword">if</span> ( sub_4011DB(&amp;v13, (<span class="hljs-type">char</span> *)&amp;unk_40C040 + <span class="hljs-number">64</span> * j, dword_40C240[j]) )<br>      &#123;<br>        sub_401091(<span class="hljs-string">&quot;[!] Wrong\n&quot;</span>, v5);<br>        VirtualFree(lpAddress, <span class="hljs-number">0</span>, <span class="hljs-number">0x8000</span>u);<br>        LODWORD(v1) = sub_401186();<br>        <span class="hljs-keyword">goto</span> LABEL_12;<br>      &#125;<br>      v9 = v13;<br>      v8 = v14;<br>      v7 = v15;<br>      v6 = v16;<br>      <span class="hljs-built_in">memset</span>(&amp;dword_40C4E8, <span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>u);<br>      dword_40C4E8 = v13;<br>      dword_40C4EC = <span class="hljs-number">0</span>;<br>      dword_40C4F0 = v14;<br>      dword_40C4F4 = <span class="hljs-number">0</span>;<br>      dword_40C4F8 = v15;<br>      dword_40C4FC = <span class="hljs-number">0</span>;<br>      dword_40C500 = v16;<br>      dword_40C504 = <span class="hljs-number">0</span>;<br>      dword_40C508 = <span class="hljs-number">-1</span>;<br>      MK_FP(*((_WORD *)&amp;::lpAddress + <span class="hljs-number">2</span>), ::lpAddress)(v16, v2, <span class="hljs-number">0</span>);<br>      off_40C000[dword_40C508 &amp; <span class="hljs-number">0xF</span>](a1 + <span class="hljs-number">4</span> * j, <span class="hljs-number">4</span>, (v8 + v6 * v7) ^ (<span class="hljs-number">40503</span> * v9));<br>      sub_401186();<br>    &#125;<br>    VirtualFree(lpAddress, <span class="hljs-number">0</span>, <span class="hljs-number">0x8000</span>u);<br>    LODWORD(v1) = sub_401186();<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    LODWORD(v1) = sub_401091(<span class="hljs-string">&quot;[!] Wrong\n&quot;</span>, v5);<br>  &#125;<br>LABEL_12:<br>  v4 = v1;<br>  sub_40113B(&amp;savedregs, &amp;dword_402674);<br>  <span class="hljs-keyword">return</span> v4;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>sub_402850 是一个 VM 解释器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs assembly">a1 (Context/CPU Environment): 指向 VM 上下文结构的指针。这个结构体包含了寄存器和堆栈<br>a2 (Bytecode): 指向要执行的字节码数组的指针<br>a3 (Bytecode Size): 字节码的长度<br><br>0x00: NOP - 空操作<br>0x01: PUSH IMM - 读取 4 字节立即数 (v49) 压入堆栈<br>0x02: PUSH REG - 读取 1 字节寄存器索引，将该寄存器的值压入堆栈<br>0x03: POP REG - 读取 1 字节寄存器索引，从堆栈弹出一个值存入该寄存器<br>0x10: MOV REG, IMM - 将 4 字节立即数赋值给寄存器<br>0x11: MOV REG, REG - Reg[dst] = Reg[src]<br>0x30: XCHG REG, REG - 交换两个寄存器的值<br>0x20: ADD REG, IMM<br>0x21: SUB REG, IMM<br>0x22: XOR REG, IMM<br>0x23: MUL REG, IMM<br>0x24: DIV REG, IMM (包含除0检查)<br>0x25: MOD REG, IMM (取模，包含除0检查)<br>0x26: SHL REG, IMM (左移，位移量 &amp; 0x1F)<br>0x27: SHR REG, IMM (右移，位移量 &amp; 0x1F)<br>0x28: AND REG, IMM<br>0x29: OR REG, IMM<br>0x2A: NOT REG (单操作数，取反)<br>0x2B: CALL_FUNC1 REG, IMM <br>0x2C: CALL_FUNC2 REG, IMM <br>0x31: INC REG - 寄存器自增<br>0x32: DEC REG - 寄存器自减<br>0x40: ADD REG, REG (Reg[A] += Reg[B])<br>0x41: SUB REG, REG<br>0x42: XOR REG, REG<br>0x43: MUL REG, REG<br></code></pre></td></tr></table></figure>

<p>解析出字节码的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># 段 0：0x40C040<br>prog0 = [<br>    (&#x27;MOVI&#x27;, 0, 0x12),      # 10 00 12...<br>    (&#x27;MOVI&#x27;, 1, 0x34),      # 10 01 34...<br>    (&#x27;MULI&#x27;, 0, 3),         # 23 00 03...<br>    (&#x27;XORI&#x27;, 1, 0xAB),      # 22 01 AB...<br>    (&#x27;ADD&#x27;,  0, 1),         # 40 00 01<br>    (&#x27;MOVI&#x27;, 2, 7),         # 10 02 07...<br>    (&#x27;MOVI&#x27;, 3, 0x11),      # 10 03 11...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 1：0x40C080<br>prog1 = [<br>    (&#x27;MOVI&#x27;, 0, 0xAB),      # 10 00 AB...<br>    (&#x27;MOVI&#x27;, 1, 0xCD),      # 10 01 CD...<br>    (&#x27;ROL&#x27;,  0, 4),         # 2B 00 04...<br>    (&#x27;ROR&#x27;,  1, 2),         # 2C 01 02...<br>    (&#x27;XORI&#x27;, 0, 0x55),      # 22 00 55...<br>    (&#x27;MOVI&#x27;, 2, 9),         # 10 02 09...<br>    (&#x27;MOVI&#x27;, 3, 0x22),      # 10 03 22...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 2：0x40C0C0<br>prog2 = [<br>    (&#x27;MOVI&#x27;, 0, 0xFF),      # 10 00 FF...<br>    (&#x27;MOVI&#x27;, 1, 0xAA),      # 10 01 AA...<br>    (&#x27;SHLI&#x27;, 0, 2),         # 26 00 02...<br>    (&#x27;MODI&#x27;, 0, 0x64),      # 25 00 64...<br>    (&#x27;ADDI&#x27;, 1, 0x11),      # 20 01 11...<br>    (&#x27;MOVI&#x27;, 2, 0x0D),      # 10 02 0D...<br>    (&#x27;MOVI&#x27;, 3, 0x33),      # 10 03 33...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 3：0x40C100<br>prog3 = [<br>    (&#x27;MOVI&#x27;, 0, 0x11),      # 10 00 11...<br>    (&#x27;MOVI&#x27;, 1, 0x22),      # 10 01 22...<br>    (&#x27;ANDI&#x27;, 0, 0x0F),      # 28 00 0F...<br>    (&#x27;ORI&#x27;,  1, 0xF0),      # 29 01 F0...<br>    (&#x27;XORI&#x27;, 0, 0x33),      # 22 00 33...<br>    (&#x27;MOVI&#x27;, 2, 0x0E),      # 10 02 0E...<br>    (&#x27;MOVI&#x27;, 3, 0x44),      # 10 03 44...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 4：0x40C140<br>prog4 = [<br>    (&#x27;MOVI&#x27;, 0, 0xDE),      # 10 00 DE...<br>    (&#x27;MOVI&#x27;, 1, 0xAD),      # 10 01 AD...<br>    (&#x27;INC&#x27;,  0),            # 31 00<br>    (&#x27;DEC&#x27;,  1),            # 32 01<br>    (&#x27;XCHG&#x27;, 0, 1),         # 30 00 01<br>    (&#x27;ADDI&#x27;, 0, 0x10),      # 20 00 10...<br>    (&#x27;MOVI&#x27;, 2, 2),         # 10 02 02...<br>    (&#x27;MOVI&#x27;, 3, 0x55),      # 10 03 55...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 5：0x40C180<br>prog5 = [<br>    (&#x27;MOVI&#x27;, 0, 0xBE),      # 10 00 BE...<br>    (&#x27;MOVI&#x27;, 1, 0xEF),      # 10 01 EF...<br>    (&#x27;MULI&#x27;, 0, 2),         # 23 00 02...<br>    (&#x27;DIVI&#x27;, 1, 3),         # 24 01 03...<br>    (&#x27;ADD&#x27;,  0, 1),         # 40 00 01<br>    (&#x27;MOVI&#x27;, 2, 0x0A),      # 10 02 0A...<br>    (&#x27;MOVI&#x27;, 3, 0x66),      # 10 03 66...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 6：0x40C1C0<br>prog6 = [<br>    (&#x27;MOVI&#x27;, 0, 0xCA),      # 10 00 CA...<br>    (&#x27;MOVI&#x27;, 1, 0xFE),      # 10 01 FE...<br>    (&#x27;NOT&#x27;,  0),            # 2A 00<br>    (&#x27;ANDI&#x27;, 0, 0xFF),      # 28 00 FF... (通常用于掩码操作，防止NOT后溢出32位)<br>    (&#x27;XORI&#x27;, 1, 0x7F),      # 22 01 7F...<br>    (&#x27;MOVI&#x27;, 2, 0x0F),      # 10 02 0F...<br>    (&#x27;MOVI&#x27;, 3, 0x77),      # 10 03 77...<br>    (&#x27;END&#x27;,),               # FF<br>]<br><br># 段 7：0x40C200<br>prog7 = [<br>    (&#x27;MOVI&#x27;, 0, 0x99),      # 10 00 99...<br>    (&#x27;MOVI&#x27;, 1, 0x88),      # 10 01 88...<br>    (&#x27;ADDI&#x27;, 0, 0x11),      # 20 00 11...<br>    (&#x27;SUBI&#x27;, 1, 8),         # 21 01 08...<br>    (&#x27;ROL&#x27;,  0, 3),         # 2B 00 03...<br>    (&#x27;MOVI&#x27;, 2, 5),         # 10 02 05...<br>    (&#x27;MOVI&#x27;, 3, 0x88),      # 10 03 88...<br>    (&#x27;END&#x27;,),               # FF<br>]<br></code></pre></td></tr></table></figure>

<p>计算出 (v8 + v6 * v7) ^ (40503 * v9) 后传入的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror</span>(<span class="hljs-params">val, n, width=<span class="hljs-number">32</span></span>):<br>    <span class="hljs-keyword">return</span> ((val &gt;&gt; n) | (val &lt;&lt; (width - n))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rol</span>(<span class="hljs-params">val, n, width=<span class="hljs-number">32</span></span>):<br>    <span class="hljs-keyword">return</span> ((val &lt;&lt; n) | (val &gt;&gt; (width - n))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_keys</span>():<br>    keys = []<br>    <br>    <span class="hljs-comment"># MOVI R0,0x12; MOVI R1,0x34; MULI R0,3; XORI R1,0xAB; ADD R0,R1; MOVI R2,7; MOVI R3,0x11</span><br>    R0 = (<span class="hljs-number">0x12</span> * <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span> <span class="hljs-comment"># 54</span><br>    R1 = <span class="hljs-number">0x34</span> ^ <span class="hljs-number">0xAB</span>             <span class="hljs-comment"># 159 (0x9F)</span><br>    R0 = (R0 + R1) &amp; <span class="hljs-number">0xFFFFFFFF</span>  <span class="hljs-comment"># 213 (0xD5)</span><br>    R2 = <span class="hljs-number">7</span><br>    R3 = <span class="hljs-number">0x11</span><br>    <br>    <span class="hljs-comment"># (R1 + R3 * R2) ^ (40503 * R0)</span><br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0xAB; MOVI R1,0xCD; ROL R0,4; ROR R1,2; XORI R0,0x55; MOVI R2,9; MOVI R3,0x22</span><br>    R0 = rol(<span class="hljs-number">0xAB</span>, <span class="hljs-number">4</span>) ^ <span class="hljs-number">0x55</span>     <span class="hljs-comment"># 0xAE5</span><br>    R1 = ror(<span class="hljs-number">0xCD</span>, <span class="hljs-number">2</span>)            <span class="hljs-comment"># 0x40000033</span><br>    R2 = <span class="hljs-number">9</span><br>    R3 = <span class="hljs-number">0x22</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0xFF; MOVI R1,0xAA; SHLI R0,2; MODI R0,0x64; ADDI R1,0x11; MOVI R2,0xD; MOVI R3,0x33</span><br>    R0 = ((<span class="hljs-number">0xFF</span> &lt;&lt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span>) % <span class="hljs-number">0x64</span> <span class="hljs-comment"># 20 (0x14)</span><br>    R1 = <span class="hljs-number">0xAA</span> + <span class="hljs-number">0x11</span>                       <span class="hljs-comment"># 187 (0xBB)</span><br>    R2 = <span class="hljs-number">0x0D</span><br>    R3 = <span class="hljs-number">0x33</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0x11; MOVI R1,0x22; ANDI R0,0xF; ORI R1,0xF0; XORI R0,0x33; MOVI R2,0xE; MOVI R3,0x44</span><br>    R0 = (<span class="hljs-number">0x11</span> &amp; <span class="hljs-number">0xF</span>) ^ <span class="hljs-number">0x33</span>     <span class="hljs-comment"># 50 (0x32)</span><br>    R1 = <span class="hljs-number">0x22</span> | <span class="hljs-number">0xF0</span>             <span class="hljs-comment"># 242 (0xF2)</span><br>    R2 = <span class="hljs-number">0x0E</span><br>    R3 = <span class="hljs-number">0x44</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0xDE; MOVI R1,0xAD; INC R0; DEC R1; XCHG R0,R1; ADDI R0,0x10; MOVI R2,2; MOVI R3,0x55</span><br>    <span class="hljs-comment"># R0=DE-&gt;DF, R1=AD-&gt;AC. Swap: R0=AC, R1=DF. R0+=10 -&gt; BC</span><br>    R0 = <span class="hljs-number">0xBC</span><br>    R1 = <span class="hljs-number">0xDF</span><br>    R2 = <span class="hljs-number">2</span><br>    R3 = <span class="hljs-number">0x55</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0xBE; MOVI R1,0xEF; MULI R0,2; DIVI R1,3; ADD R0,R1; MOVI R2,0xA; MOVI R3,0x66</span><br>    t_r1 = <span class="hljs-number">0xEF</span> // <span class="hljs-number">3</span>             <span class="hljs-comment"># 79 (0x4F)</span><br>    R0 = ((<span class="hljs-number">0xBE</span> * <span class="hljs-number">2</span>) + t_r1) &amp; <span class="hljs-number">0xFFFFFFFF</span> <span class="hljs-comment"># 459 (0x1CB)</span><br>    R1 = t_r1<br>    R2 = <span class="hljs-number">0x0A</span><br>    R3 = <span class="hljs-number">0x66</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment"># MOVI R0,0xCA; MOVI R1,0xFE; NOT R0; ANDI R0,0xFF; XORI R1,0x7F; MOVI R2,0xF; MOVI R3,0x77</span><br>    R0 = (~<span class="hljs-number">0xCA</span>) &amp; <span class="hljs-number">0xFF</span>          <span class="hljs-comment"># 53 (0x35)</span><br>    R1 = <span class="hljs-number">0xFE</span> ^ <span class="hljs-number">0x7F</span>             <span class="hljs-comment"># 129 (0x81)</span><br>    R2 = <span class="hljs-number">0x0F</span><br>    R3 = <span class="hljs-number">0x77</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br><br>    <span class="hljs-comment">#  MOVI R0,0x99; MOVI R1,0x88; ADDI R0,0x11; SUBI R1,8; ROL R0,3; MOVI R2,5; MOVI R3,0x88</span><br>    R0 = rol(<span class="hljs-number">0x99</span> + <span class="hljs-number">0x11</span>, <span class="hljs-number">3</span>)     <span class="hljs-comment"># 1360 (0x550)</span><br>    R1 = <span class="hljs-number">0x88</span> - <span class="hljs-number">8</span>                <span class="hljs-comment"># 128 (0x80)</span><br>    R2 = <span class="hljs-number">5</span><br>    R3 = <span class="hljs-number">0x88</span><br>    <br>    k = (R1 + R3 * R2) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    k ^= (<span class="hljs-number">40503</span> * R0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    keys.append(k)<br>    <br>    <span class="hljs-keyword">return</span> keys<br><br>keys = calculate_keys()<br><span class="hljs-keyword">for</span> i, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(keys):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;0x<span class="hljs-subst">&#123;k:07X&#125;</span>, // Block <span class="hljs-subst">&#123;i&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-number">0</span>x083A2D5, // Block <span class="hljs-number">0</span><br><span class="hljs-number">0</span>x46BBAC56, // Block <span class="hljs-number">1</span><br><span class="hljs-number">0</span>x00C5F1E, // Block <span class="hljs-number">2</span><br><span class="hljs-number">0</span>x01EE214, // Block <span class="hljs-number">3</span><br><span class="hljs-number">0</span>x07431ED, // Block <span class="hljs-number">4</span><br><span class="hljs-number">0</span>x11BA8D6, // Block <span class="hljs-number">5</span><br><span class="hljs-number">0</span>x020C619, // Block <span class="hljs-number">6</span><br><span class="hljs-number">0</span>x3488718, // Block <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure>

<p>下断点调试，查看 dword_10C508 的值</p>
<p><img src="https://img.dkdun.cn/v1/2025/12/cb397eb42ac5b853.png"></p>
<p><img src="https://img.dkdun.cn/v1/2025/12/e9da8f11d2d05df8.png"></p>
<p><img src="https://img.dkdun.cn/v1/2025/12/aa342d555c83b21e.png"></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-number">0</span>x0D, <span class="hljs-number">0</span>x04, <span class="hljs-number">0</span>x00, <span class="hljs-number">0</span>x0C, <span class="hljs-number">0</span>x04, <span class="hljs-number">0</span>x06, <span class="hljs-number">0</span>x03, <span class="hljs-number">0</span>x00<br></code></pre></td></tr></table></figure>

<p>对应 off_40C000 的 D，4，0，C，4，6，3，0 索引的函数 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">D 	每字节 = HIBYTE(a3) ^ (8 * *(i + a1)) ^ (a3 * *(i + a1))<br>4	数组长度&gt;=2 进行首尾元素交换<br>0	每字节 ^= a3 &gt;&gt; (8 * (i % 4))<br>C	按字节异或<br>6	反转数组<br>3	每字节 -= a3 &gt;&gt; (8 * (i % 4))<br></code></pre></td></tr></table></figure>

<p>解密脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br>cipher_data = [<br>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x2D</span>,  <br>    <span class="hljs-number">0x74</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x31</span>,  <br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x45</span>,  <br>    <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x36</span>,  <br>    <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x6E</span>,  <br>    <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x49</span>,  <br>    <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x79</span>,  <br>    <span class="hljs-number">0x28</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x7E</span>   <br>]<br><br>keys = [<br>    <span class="hljs-number">0x0083A2D5</span>, <br>    <span class="hljs-number">0x46BBAC56</span>, <br>    <span class="hljs-number">0x000C5F1E</span>, <br>    <span class="hljs-number">0x001EE214</span>, <br>    <span class="hljs-number">0x007431ED</span>, <br>    <span class="hljs-number">0x011BA8D6</span>, <br>    <span class="hljs-number">0x0020C619</span>, <br>    <span class="hljs-number">0x03488718</span>  <br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_xor</span>(<span class="hljs-params">block, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        k = (key &gt;&gt; (<span class="hljs-number">8</span> * i)) &amp; <span class="hljs-number">0xFF</span><br>        block[i] ^= k<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_sub</span>(<span class="hljs-params">block, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        k = (key &gt;&gt; (<span class="hljs-number">8</span> * i)) &amp; <span class="hljs-number">0xFF</span><br>        block[i] = (block[i] + k) &amp; <span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_swap</span>(<span class="hljs-params">block, key</span>):<br>    block[<span class="hljs-number">0</span>], block[<span class="hljs-number">3</span>] = block[<span class="hljs-number">3</span>], block[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_reverse</span>(<span class="hljs-params">block, key</span>):<br>    block.reverse()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_chain_xor</span>(<span class="hljs-params">block, key</span>):<br>    c = <span class="hljs-built_in">list</span>(block)<br>    k0 = key &amp; <span class="hljs-number">0xFF</span><br>    <span class="hljs-comment"># p[0] = c[0] ^ k0</span><br>    block[<span class="hljs-number">0</span>] = c[<span class="hljs-number">0</span>] ^ k0<br>    <span class="hljs-comment"># p[i] = c[i] ^ c[i-1]</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>        block[i] = c[i] ^ c[i-<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_affine</span>(<span class="hljs-params">block, key</span>):<br>    key_lo = key &amp; <span class="hljs-number">0xFF</span><br>    key_hi = (key &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>  <br><br>    inv_map = &#123;&#125;<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        term1 = (<span class="hljs-number">8</span> * x) &amp; <span class="hljs-number">0xFF</span><br>        term2 = (key_lo * x) &amp; <span class="hljs-number">0xFF</span><br>        y = key_hi ^ term1 ^ term2<br>        inv_map[y] = x<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">if</span> block[i] <span class="hljs-keyword">in</span> inv_map:<br>            block[i] = inv_map[block[i]]<br>        <span class="hljs-keyword">else</span>:<br>            block[i] = <span class="hljs-number">0x3F</span><br>final_flag = []<br>blocks = [<span class="hljs-built_in">bytearray</span>(cipher_data[i:i+<span class="hljs-number">4</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>, <span class="hljs-number">4</span>)]<br><br>decrypt_affine(blocks[<span class="hljs-number">0</span>], keys[<span class="hljs-number">0</span>])<br>final_flag += blocks[<span class="hljs-number">0</span>]<br><br>decrypt_swap(blocks[<span class="hljs-number">1</span>], keys[<span class="hljs-number">1</span>])<br>final_flag += blocks[<span class="hljs-number">1</span>]<br><br>decrypt_xor(blocks[<span class="hljs-number">2</span>], keys[<span class="hljs-number">2</span>])<br>final_flag += blocks[<span class="hljs-number">2</span>]<br><br>decrypt_chain_xor(blocks[<span class="hljs-number">3</span>], keys[<span class="hljs-number">3</span>])<br>final_flag += blocks[<span class="hljs-number">3</span>]<br><br>decrypt_swap(blocks[<span class="hljs-number">4</span>], keys[<span class="hljs-number">4</span>])<br>final_flag += blocks[<span class="hljs-number">4</span>]<br><br>decrypt_reverse(blocks[<span class="hljs-number">5</span>], keys[<span class="hljs-number">5</span>])<br>final_flag += blocks[<span class="hljs-number">5</span>]<br><br>decrypt_sub(blocks[<span class="hljs-number">6</span>], keys[<span class="hljs-number">6</span>])<br>final_flag += blocks[<span class="hljs-number">6</span>]<br><br>decrypt_xor(blocks[<span class="hljs-number">7</span>], keys[<span class="hljs-number">7</span>])<br>final_flag += blocks[<span class="hljs-number">7</span>]<br><br>flag_str = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">if</span> <span class="hljs-number">32</span> &lt;= x &lt;= <span class="hljs-number">126</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> final_flag])<br><br><span class="hljs-built_in">print</span>(flag_str)<br></code></pre></td></tr></table></figure>

<p>拿到 flag</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">SYC&#123;<span class="hljs-symbol">1@</span>St_0nE_THanKs_I_lOvE_y0U!&#125;<br></code></pre></td></tr></table></figure>

<h1 id="obfuscat3-revenge"><a href="#obfuscat3-revenge" class="headerlink" title="obfuscat3_revenge"></a>obfuscat3_revenge</h1><p>主函数这里是有两个十六字节的 key，输入经过一系列加密之后对密文进行比对</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int8 s1[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-280h] BYREF</span><br>  <span class="hljs-type">void</span> *src; <span class="hljs-comment">// [rsp+60h] [rbp-260h]</span><br>  <span class="hljs-type">size_t</span> n; <span class="hljs-comment">// [rsp+68h] [rbp-258h]</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-250h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int8 v8[<span class="hljs-number">256</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp-220h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int8 v9[<span class="hljs-number">256</span>]; <span class="hljs-comment">// [rsp+1A0h] [rbp-120h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int8 v10[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+2A0h] [rbp-20h] BYREF</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+2A8h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [rsp+2BCh] [rbp-4h]</span><br><br>  v12 = <span class="hljs-number">0</span>;<br>  *v10 = <span class="hljs-number">0x8877665540302010</span>LL;<br>  v11 = <span class="hljs-number">0x2301EFDECDBCAB90</span>LL;<br>  gen(v9, v8, v10);<br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x24</span>uLL);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input the flag: &quot;</span>);<br>  <span class="hljs-keyword">if</span> ( fgets(s, <span class="hljs-number">36</span>, <span class="hljs-built_in">stdin</span>) )<br>  &#123;<br>    n = <span class="hljs-built_in">strcspn</span>(s, <span class="hljs-string">&quot;\r\n&quot;</span>);<br>    s[n] = <span class="hljs-number">0</span>;<br>    src = s;<br>    <span class="hljs-keyword">if</span> ( n &gt;= <span class="hljs-number">3</span> &amp;&amp; *src == <span class="hljs-number">239</span> &amp;&amp; *(src + <span class="hljs-number">1</span>) == <span class="hljs-number">187</span> &amp;&amp; *(src + <span class="hljs-number">2</span>) == <span class="hljs-number">191</span> )<br>    &#123;<br>      src = src + <span class="hljs-number">3</span>;<br>      n = n - <span class="hljs-number">0x13DB8EEDDCB822FC</span>LL + <span class="hljs-number">0x13DB8EEDDCB822F9</span>LL;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( n &amp;&amp; n &lt;= <span class="hljs-number">0x20</span> )<br>    &#123;<br>      <span class="hljs-built_in">memset</span>(s1, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(s1));<br>      <span class="hljs-built_in">memcpy</span>(s1, src, n);<br>      real_en(s1, v10, v9, v8);<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">memcmp</span>(s1, &amp;main::target_enc, <span class="hljs-number">0x20</span>uLL) )<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations!\n&quot;</span>);<br>      <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Try again?\n&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Try again?\n&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input error.\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>gen 这里主要是生成 S-Box，还有 S-Box 的逆置换，a1 &#x3D; S-box，a2 &#x3D; S-box 的逆映射表，a3 &#x3D; 16-byte key</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">gen</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> __int8 *a1, <span class="hljs-type">unsigned</span> __int8 *a2, <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> __int8 *a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// ecx</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// si</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+8h] [rbp-2Ch]</span><br>  <span class="hljs-type">unsigned</span> __int8 v7; <span class="hljs-comment">// [rsp+Fh] [rbp-25h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+10h] [rbp-24h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v9; <span class="hljs-comment">// [rsp+17h] [rbp-1Dh]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-1Ch]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i = -v3 )<br>  &#123;<br>    a1[i] = i;<br>    v3 = -i - <span class="hljs-number">2101855413</span> + <span class="hljs-number">2101855412</span>;<br>    result = -v3;<br>  &#125;<br>  v9 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; ++j )<br>  &#123;<br>    v5 = a1[j] + v9;<br>    v9 = a3[j % <span class="hljs-number">16</span>] + v5;<br>    v7 = a1[j];<br>    a1[j] = a1[v9];<br>    a1[v9] = v7;<br>    result = <span class="hljs-number">1850779768LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">256</span>; k = k - <span class="hljs-number">1366467913</span> + <span class="hljs-number">1366467914</span> )<br>  &#123;<br>    a2[a1[k]] = k;<br>    result = <span class="hljs-number">1366467914LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>D810 插件去掉混淆，分析发现进行了循环异或，循环左移</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">en1</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> __int8 *s1, <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> __int8 *a2, <span class="hljs-type">int</span> n32)</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10h] [rbp-30h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= n32 )<br>      <span class="hljs-keyword">break</span>;<br>    v4 = a2[i % <span class="hljs-number">16</span>] &amp; (s1[i] ^ a2[i % <span class="hljs-number">16</span>]);<br>    s1[i] = ~(a2[i % <span class="hljs-number">16</span>] | ~s1[i] | ~v4) | (a2[i % <span class="hljs-number">16</span>] | ~s1[i]) ^ <span class="hljs-number">0x8D</span> ^ v4 ^ <span class="hljs-number">0x72</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><br>__int64 __fastcall <span class="hljs-title function_">F</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a2, <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> __int8 *a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// [rsp+4h] [rbp-3Ch]</span><br>  <span class="hljs-type">unsigned</span> __int8 v6; <span class="hljs-comment">// [rsp+5h] [rbp-3Bh]</span><br>  <span class="hljs-type">unsigned</span> __int8 v7; <span class="hljs-comment">// [rsp+6h] [rbp-3Ah]</span><br>  <span class="hljs-type">unsigned</span> __int8 v8; <span class="hljs-comment">// [rsp+7h] [rbp-39h]</span><br><br>  v8 = a3[(a1 ^ a2)];<br>  v7 = a3[(a1 ^ a2) &gt;&gt; <span class="hljs-number">8</span>];<br>  v6 = a3[((a1 ^ a2) &gt;&gt; <span class="hljs-number">16</span>)];<br>  v5 = a3[(a1 ^ a2) &gt;&gt; <span class="hljs-number">24</span>];<br>  v3 = ~((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) &amp; <span class="hljs-number">0x1E7532C0</span>;<br>  <span class="hljs-keyword">return</span> not_en(<br>           (v5 &lt;&lt; <span class="hljs-number">24</span>) &amp; ((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) | ((v5 &lt;&lt; <span class="hljs-number">24</span>) ^ <span class="hljs-number">0xE18ACD3F</span>) &amp; (~(~((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) | <span class="hljs-number">0x1E7532C0</span> | ~v3) | ((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) &amp; <span class="hljs-number">0xE18ACD3F</span> ^ v3) | ~(~(~((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) | <span class="hljs-number">0x1E7532C0</span> | ~v3) | ((v6 &lt;&lt; <span class="hljs-number">16</span>) | (v7 &lt;&lt; <span class="hljs-number">8</span>) | v8) &amp; <span class="hljs-number">0xE18ACD3F</span> ^ v3) &amp; ((v5 &lt;&lt; <span class="hljs-number">24</span>) ^ <span class="hljs-number">0x1E7532C0</span>),<br>           <span class="hljs-number">5</span>);<br>&#125;<br><br><br>__int64 __fastcall <span class="hljs-title function_">not_en</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> a2)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v3; <span class="hljs-comment">// edi</span><br><br>  v2 = a1 &lt;&lt; a2;<br>  v3 = a1 &gt;&gt; (<span class="hljs-number">32</span> - a2);<br>  <span class="hljs-keyword">return</span> v3 &amp; v2 | (v3 &amp; <span class="hljs-number">0x18B2001</span> | ~v3 &amp; <span class="hljs-number">0x643081A4</span> | <span class="hljs-number">0x82444848</span>) ^ ~v3 &amp; <span class="hljs-number">0x18001612</span> ^ (v3 &amp; <span class="hljs-number">0x82444848</span> | <span class="hljs-number">0x643081A4</span>) ^ v2 ^ <span class="hljs-number">0x9A445E5A</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br>MASK32 = <span class="hljs-number">0xFFFFFFFF</span><br><br>KEY_HEX = <span class="hljs-string">&quot;102030405566778890ABBCCDDEEF0123&quot;</span><br>PERM_HEX = <span class="hljs-string">&quot;1F000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E&quot;</span><br>ENC_HEX = <span class="hljs-string">&quot;CA5A96FF084972393618138A14C00C78F87C49C7BEE891ED7FB002AD7774D434&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rol32</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span>, r: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    r &amp;= <span class="hljs-number">31</span><br>    <span class="hljs-keyword">return</span> ((x &lt;&lt; r) &amp; MASK32) | ((x &amp; MASK32) &gt;&gt; (<span class="hljs-number">32</span> - r))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror32</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span>, r: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    r &amp;= <span class="hljs-number">31</span><br>    <span class="hljs-keyword">return</span> ((x &amp; MASK32) &gt;&gt; r) | ((x &lt;&lt; (<span class="hljs-number">32</span> - r)) &amp; MASK32)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">b2nle</span>(<span class="hljs-params">b: <span class="hljs-built_in">bytes</span>, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">int</span>.from_bytes(b[i:i+n], <span class="hljs-string">&#x27;little&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(b), n)]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">n2ble</span>(<span class="hljs-params">na: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    out = <span class="hljs-built_in">bytearray</span>()<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> na:<br>        out.extend((a &amp; ((<span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">8</span>*n)) - <span class="hljs-number">1</span>)).to_bytes(n, <span class="hljs-string">&#x27;little&#x27;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_sbox</span>(<span class="hljs-params">key: <span class="hljs-built_in">bytes</span></span>):<br>    S = <span class="hljs-built_in">bytearray</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) &amp; <span class="hljs-number">0xFF</span><br>        S[i], S[j] = S[j], S[i]<br><br>    invS = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">256</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        invS[S[i]] = i<br>    <span class="hljs-keyword">return</span> S, invS<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">F</span>(<span class="hljs-params">a1: <span class="hljs-built_in">int</span>, key_word: <span class="hljs-built_in">int</span>, S: <span class="hljs-built_in">bytearray</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    idx = (a1 ^ key_word) &amp; MASK32<br>    b0 = S[(idx      ) &amp; <span class="hljs-number">0xFF</span>]<br>    b1 = S[(idx &gt;&gt; <span class="hljs-number">8</span> ) &amp; <span class="hljs-number">0xFF</span>]<br>    b2 = S[(idx &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>]<br>    b3 = S[(idx &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>]<br>    T = (b3 &lt;&lt; <span class="hljs-number">24</span>) | (b2 &lt;&lt; <span class="hljs-number">16</span>) | (b1 &lt;&lt; <span class="hljs-number">8</span>) | b0<br>    <span class="hljs-keyword">return</span> rol32(T, <span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_real_en</span>(<span class="hljs-params">enc_bytes: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">bytes</span>, perm_bytes: <span class="hljs-built_in">bytes</span>, S: <span class="hljs-built_in">bytearray</span>, invS: <span class="hljs-built_in">bytearray</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    dkey = b2nle(key, <span class="hljs-number">4</span>)<br>    blocks = b2nle(enc_bytes, <span class="hljs-number">4</span>)[::-<span class="hljs-number">1</span>]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>):<br>            L = blocks[j]<br>            R = blocks[j+<span class="hljs-number">1</span>]<br>            prevL = R<br>            prevR = L ^ F(R, dkey[i], S)<br>            blocks[j] = prevL &amp; MASK32<br>            blocks[j+<span class="hljs-number">1</span>] = prevR &amp; MASK32<br><br>    blocks = blocks[::-<span class="hljs-number">1</span>]<br>    mid_bytes = <span class="hljs-built_in">bytearray</span>(n2ble(blocks, <span class="hljs-number">4</span>))<br>    rec = mid_bytes[<span class="hljs-number">1</span>:] + mid_bytes[:<span class="hljs-number">1</span>]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        rec[i] = invS[rec[i]]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        rec[i] ^= key[i % <span class="hljs-number">16</span>]<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(rec)<br><br>key = <span class="hljs-built_in">bytearray</span>.fromhex(KEY_HEX)<br>perm = <span class="hljs-built_in">bytearray</span>.fromhex(PERM_HEX)<br>enc = <span class="hljs-built_in">bytes</span>.fromhex(ENC_HEX)<br><br>S, invS = gen_sbox(key)<br>plaintext = decrypt_real_en(enc, key, perm, S, invS)<br><br><span class="hljs-built_in">print</span>(plaintext.rstrip(<span class="hljs-string">b&#x27;\x00&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;replace&#x27;</span>))<br></code></pre></td></tr></table></figure>

<p>拿到 flag</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">SYC</span><span class="hljs-template-variable">&#123;Then_you_are_1mpressivse&#125;</span><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%8F%AA%E5%85%B3%E4%BA%8E-Reverse/" class="category-chain-item">只关于 Reverse</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Reverse/" class="print-no-link">#Reverse</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2025极客大挑战-Reverse</div>
      <div>http://example.com/2025/11/19/2025极客大挑战-Reverse/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>butt3rf1y</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年11月19日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/11/29/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-11%E6%9C%88/" title="2025年Solar应急响应公益月赛-11月">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2025年Solar应急响应公益月赛-11月</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/11/19/RCTF-2025/" title="RCTF-2025">
                        <span class="hidden-mobile">RCTF-2025</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments">
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"rWKtzRd76Kz6dC7Vd9dUwQux-gzGzoHsz","appKey":"DxMgc7gveh6B1aJKyAZnoFNj","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span> </a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/snow.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>

<!--浏览器搞笑标题-->
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<script type="text/javascript" src="\js\snow.js"></script>
<script type="text/javascript" src="\js\backgroundize.js"></script>

